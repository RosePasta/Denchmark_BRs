{"BR": {"BR_id": "6651", "BR_author": "reyoung", "BRopenT": "2017-12-15T05:32:48Z", "BRcloseT": "2017-12-15T08:24:28Z", "BR_text": {"BRsummary": "Wrong logic in `gpu_info.cc` for reserving memory", "BRdescription": "\n These lines are wrong about how to reserve memory in GPU\n \n \n \n Paddle/paddle/platform/gpu_info.cc\n \n \n         Lines 78 to 88\n       in\n       d7b67f2\n \n \n \n \n \n \n  size_t reserving = 0.05 * total; \n \n \n \n  \n \n \n \n  // If available less than minimum chunk size, no usable memory exists. \n \n \n \n  available = \n \n \n \n  std::max(std::max(available, GpuMinChunkSize()) - GpuMinChunkSize(), \n \n \n \n               reserving) - \n \n \n \n      reserving; \n \n \n \n  \n \n \n \n  size_t allocating = FLAGS_fraction_of_gpu_memory_to_use * total; \n \n \n \n  \n \n \n \n  PADDLE_ENFORCE_LT(allocating, available); \n \n \n \n \n \n It should be:\n size_t total = ...\n size_t avail = ...\n size_t reserving = ...\n avail = std::min(avail, total-reserving);\n allocating = Ratio* (total-reserving);\n \t"}, "comments": {}}, "commit": {"commit_id": "1b0c7d7c7afd4c5f09eb43358dd4851ba1735c3f", "commit_author": "Yu Yang", "commitT": "2017-12-15 16:24:27+08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\memory\\detail\\system_allocator.cc", "file_new_name": "paddle\\memory\\detail\\system_allocator.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "81,82,84,85,87,88,89,90,91,92,93", "deleted_lines": "80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95", "method_info": {"method_name": "paddle::memory::detail::GPUAllocator::Alloc", "method_params": "index,size", "method_startline": "77", "method_endline": "95"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\platform\\gpu_info.cc", "file_new_name": "paddle\\platform\\gpu_info.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "76,77,78,81,82,83,84,86,87,89", "deleted_lines": "76,77,78,79,82,83,84,86,88", "method_info": {"method_name": "paddle::platform::GpuMaxChunkSize", "method_params": "", "method_startline": "71", "method_endline": "92"}}}}}}}