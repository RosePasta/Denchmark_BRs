{"BR": {"BR_id": "8032", "BR_author": "Yancey1989", "BRopenT": "2018-02-01T06:22:36Z", "BRcloseT": "2018-02-11T03:53:01Z", "BR_text": {"BRsummary": "Adapt learning rate decay with Fluid distributed training", "BRdescription": "\n 2trainers + 2pservers, following is pserver logs:\n E0201 06:20:34.945315  5910 listen_and_serv_op.cc:156] run sub program error enforce framework::product(lr_dims) == 1 failed, 0 != 1\n Learning rate should have 1 element at [/paddle/paddle/operators/sgd_op.cc:36]\n PaddlePaddle Call Stacks:\n 0       0x7f3a9cecfde7p paddle::platform::EnforceNotMet::EnforceNotMet(std::__exception_ptr::exception_ptr, char const*, int) + 727\n 1       0x7f3a9d4d4eaap paddle::operators::SGDOp::InferShape(paddle::framework::InferShapeContext*) const + 986\n 2       0x7f3a9d57602fp paddle::framework::OperatorWithKernel::Run(paddle::framework::Scope const&, boost::variant<paddle::platform::CUDAPlace, paddle::platform::CPUPlace, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_> const&) const + 2527\n 3       0x7f3a9cf95630p paddle::framework::Executor::Run(paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool) + 1504\n 4       0x7f3a9d51e143p paddle::operators::ListenAndServOp::Run(paddle::framework::Scope const&, boost::variant<paddle::platform::CUDAPlace, paddle::platform::CPUPlace, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_> const&) const + 3443\n 5       0x7f3a9cf95630p paddle::framework::Executor::Run(paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool) + 1504\n 6       0x7f3a9ceeeac3p void pybind11::cpp_function::initialize<pybind11::cpp_function::initialize<void, paddle::framework::Executor, paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool, pybind11::name, pybind11::is_method, pybind11::sibling>(void (paddle::framework::Executor::*)(paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool), pybind11::name const&, pybind11::is_method const&, pybind11::sibling const&)::{lambda(paddle::framework::Executor*, paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool)#1}, void, paddle::framework::Executor*, paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool, pybind11::name, pybind11::is_method, pybind11::sibling>(pybind11::cpp_function::initialize<void, paddle::framework::Executor, paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool, pybind11::name, pybind11::is_method, pybind11::sibling>(void (paddle::framework::Executor::*)(paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool), pybind11::name const&, pybind11::is_method const&, pybind11::sibling const&)::{lambda(paddle::framework::Executor*, paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool)#1}&&, void (*)(paddle::framework::Executor*, paddle::framework::ProgramDesc const&, paddle::framework::Scope*, int, bool, bool), pybind11::name const&, pybind11::is_method const&, pybind11::sibling const&)::{lambda(pybind11::detail::function_call&)#3}::_FUN(pybind11::detail::function_call) + 579\n 7       0x7f3a9ceec754p pybind11::cpp_function::dispatcher(_object*, _object*, _object*) + 1236\n 8             0x4cad00p PyEval_EvalFrameEx + 28048\n 9             0x4c2705p PyEval_EvalCodeEx + 597\n 10            0x4ca088p PyEval_EvalFrameEx + 24856\n 11            0x4c9d7fp PyEval_EvalFrameEx + 24079\n 12            0x4c2705p PyEval_EvalCodeEx + 597\n 13            0x4c24a9p PyEval_EvalCode + 25\n 14            0x4f19efp\n 15            0x4ec372p PyRun_FileExFlags + 130\n 16            0x4eaaf1p PyRun_SimpleFileExFlags + 401\n 17            0x49e208p Py_Main + 1736\n 18      0x7f3ae5dd8830p __libc_start_main + 240\n 19            0x49da59p _start + 41\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Yancey1989", "commentT": "2018-02-01T11:50:21Z", "comment_text": "\n \t\tAfter PR <denchmark-link:https://github.com/PaddlePaddle/Paddle/pull/7892>#7892</denchmark-link>\n   merged(implement decay LR), LR became a dynamic value, and each parameter's LR was be initialized in  instead of . So I think the distributed transpiler need to refine to adapt this new feature.\n \t\t"}}}, "commit": {"commit_id": "279aa626ab25385093dcfc7e1a932a37535dc5a4", "commit_author": "Yancey", "commitT": "2018-02-11 11:53:00+08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\fluid\\operators\\listen_and_serv_op.cc", "file_new_name": "paddle\\fluid\\operators\\listen_and_serv_op.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "109,130,131,132,134,135,137,152,160", "deleted_lines": "130,132,133,134,135,147,151,159", "method_info": {"method_name": "paddle::operators::ListenAndServOp::Run", "method_params": "scope,dev_place", "method_startline": "85", "method_endline": "163"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 15, "file_old_name": "python\\paddle\\v2\\fluid\\distribute_transpiler.py", "file_new_name": "python\\paddle\\v2\\fluid\\distribute_transpiler.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "60,61,62,63,64,65,66,67,68,69,70", "deleted_lines": null, "method_info": {"method_name": "find", "method_params": "self,x", "method_startline": "60", "method_endline": "70"}}, "hunk_1": {"Ismethod": 1, "added_lines": "526,527,528,529,530,531,532,533,534,535,536,537,538", "deleted_lines": null, "method_info": {"method_name": "_is_opt_op_on_pserver", "method_params": "self,endpoint,op", "method_startline": "526", "method_endline": "538"}}, "hunk_2": {"Ismethod": 1, "added_lines": "81,82,83,84", "deleted_lines": null, "method_info": {"method_name": "is_connected", "method_params": "self,x,y", "method_startline": "81", "method_endline": "84"}}, "hunk_3": {"Ismethod": 1, "added_lines": "49,50,51,52,53,54,55,56,57,58", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,elementes", "method_startline": "49", "method_endline": "58"}}, "hunk_4": {"Ismethod": 1, "added_lines": "461,462,463,464,476,477,478,479,480,481,482,483,484,485,486", "deleted_lines": "472,473,481,482,483,484,485,486,487,488,489,490,491", "method_info": {"method_name": "_append_pserver_non_opt_ops", "method_params": "self,optimize_block,opt_op", "method_startline": "456", "method_endline": "491"}}, "hunk_5": {"Ismethod": 1, "added_lines": null, "deleted_lines": "303,304", "method_info": {"method_name": "_op_input_var", "method_params": "self,op,varname", "method_startline": "303", "method_endline": "304"}}, "hunk_6": {"Ismethod": 1, "added_lines": "507,508,509,510,511,512,513,514,515,516", "deleted_lines": null, "method_info": {"method_name": "_create_ufind", "method_params": "self,optimize_ops", "method_startline": "507", "method_endline": "516"}}, "hunk_7": {"Ismethod": 1, "added_lines": null, "deleted_lines": "306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348", "method_info": {"method_name": "_is_op_on_pserver", "method_params": "self,endpoint,all_ops,idx", "method_startline": "306", "method_endline": "348"}}, "hunk_8": {"Ismethod": 1, "added_lines": "566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589", "deleted_lines": null, "method_info": {"method_name": "get_pserver_program", "method_params": "self,endpoint", "method_startline": "540", "method_endline": "609"}}, "hunk_9": {"Ismethod": 1, "added_lines": "72,73,74,75,76,77,78,79", "deleted_lines": null, "method_info": {"method_name": "union", "method_params": "self,x,y", "method_startline": "72", "method_endline": "79"}}, "hunk_10": {"Ismethod": 1, "added_lines": "493,494,495,496,497,498,499,500,501,502,503,504,505", "deleted_lines": null, "method_info": {"method_name": "_is_op_connected", "method_params": "self,op1,op2", "method_startline": "493", "method_endline": "505"}}, "hunk_11": {"Ismethod": 1, "added_lines": "369,370,371,372,373,374,375,376,377", "deleted_lines": "369,370", "method_info": {"method_name": "_fetch_var_names", "method_params": "self,param_dict", "method_startline": "369", "method_endline": "377"}}, "hunk_12": {"Ismethod": 1, "added_lines": "234,235,236,237,238,239,240,241,242,243,244,245", "deleted_lines": null, "method_info": {"method_name": "_create_lr_param_mapping", "method_params": "self", "method_startline": "234", "method_endline": "245"}}, "hunk_13": {"Ismethod": 1, "added_lines": "518,519,520,521,522,523,524", "deleted_lines": null, "method_info": {"method_name": "_is_opt_op", "method_params": "self,op", "method_startline": "518", "method_endline": "524"}}, "hunk_14": {"Ismethod": 1, "added_lines": "395,426,427,428,429,430,433,434,436,449,453", "deleted_lines": "403,407,418,419,423,431,432,433,434,435", "method_info": {"method_name": "_append_pserver_ops", "method_params": "self,optimize_block,opt_op,endpoint", "method_startline": "379", "method_endline": "454"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "python\\paddle\\v2\\fluid\\layers\\math_op_patch.py", "file_new_name": "python\\paddle\\v2\\fluid\\layers\\math_op_patch.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "120", "deleted_lines": null, "method_info": {"method_name": "monkey_patch_variable", "method_params": "", "method_startline": "22", "method_endline": "159"}}, "hunk_1": {"Ismethod": 1, "added_lines": "120", "deleted_lines": null, "method_info": {"method_name": "monkey_patch_variable.monkey_patch_variable._elemwise_method_creator_.__impl__", "method_params": "self,other_var", "method_startline": "86", "method_endline": "126"}}, "hunk_2": {"Ismethod": 1, "added_lines": "120", "deleted_lines": null, "method_info": {"method_name": "monkey_patch_variable._elemwise_method_creator_", "method_params": "method_name,op_type,reverse", "method_startline": "85", "method_endline": "140"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\paddle\\v2\\fluid\\tests\\book_distribute\\notest_dist_word2vec.py", "file_new_name": "python\\paddle\\v2\\fluid\\tests\\book_distribute\\notest_dist_word2vec.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "102", "deleted_lines": "102"}}}}}}