{"BR": {"BR_id": "11591", "BR_author": "Purpleslz", "BRopenT": "2020-10-24T07:51:03Z", "BRcloseT": "2020-11-25T19:28:47Z", "BR_text": {"BRsummary": "[rllib] SAC does not multiply importance weights when calculating loss", "BRdescription": "\n SAC should multiply importance weights here:\n <denchmark-code>    critic_loss = [\n         0.5 * torch.mean(torch.pow(q_t_selected_target - q_t_selected, 2.0)) \n         # <- here should multiply importance weights like ddpg/dqn implementation.\n     ]\n </denchmark-code>\n \n SAC code(without multiplying importance weights): <denchmark-link:https://github.com/ray-project/ray/blob/master/rllib/agents/sac/sac_torch_policy.py#L265>https://github.com/ray-project/ray/blob/master/rllib/agents/sac/sac_torch_policy.py#L265</denchmark-link>\n \n DQN/DDPG code(with multiplying importance weights): \n \n <denchmark-link:https://github.com/ray-project/ray/blob/master/rllib/agents/ddpg/ddpg_torch_policy.py#L140>https://github.com/ray-project/ray/blob/master/rllib/agents/ddpg/ddpg_torch_policy.py#L140</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Purpleslz", "commentT": "2020-11-25T08:37:33Z", "comment_text": "\n \t\tYes, you are right. This is a bug. Will provide a fix PR.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Purpleslz", "commentT": "2020-11-25T08:53:55Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Purpleslz>@Purpleslz</denchmark-link>\n \n PR: <denchmark-link:https://github.com/ray-project/ray/pull/12394>#12394</denchmark-link>\n \n Added Huber-loss as well.\n \t\t"}}}, "commit": {"commit_id": "b7dbbfbf4111698145bb9e0bf2e34e36fef0430c", "commit_author": "Sven Mika", "commitT": "2020-11-25 11:28:46-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "rllib\\agents\\sac\\sac_tf_policy.py", "file_new_name": "rllib\\agents\\sac\\sac_tf_policy.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "15,16,31,343,344,346,347", "deleted_lines": "15,341,342,343,344,346,347"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "rllib\\agents\\sac\\sac_torch_policy.py", "file_new_name": "rllib\\agents\\sac\\sac_torch_policy.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "26,271,274,275", "deleted_lines": "270,273,274"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "rllib\\agents\\sac\\tests\\test_sac.py", "file_new_name": "rllib\\agents\\sac\\tests\\test_sac.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "17,527,528", "deleted_lines": "17,527"}}}}}}