{"BR": {"BR_id": "10511", "BR_author": "edoakes", "BRopenT": "2020-09-02T21:20:41Z", "BRcloseT": "2020-09-03T18:30:34Z", "BR_text": {"BRsummary": "Unnecessary output when connecting to a cluster", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n When connecting to a cluster, ray.init() spews a lot of unnecessary output to the terminal:\n <denchmark-code>code/ray % python\n Python 3.6.4 |Anaconda, Inc.| (default, Jan 16 2018, 12:04:33) \n [GCC 4.2.1 Compatible Clang 4.0.1 (tags/RELEASE_401/final)] on darwin\n Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n >>> import ray\n ray.>>> ray.init(address=\"auto\")\n WARNING: Logging before InitGoogleLogging() is written to STDERR\n I0902 16:19:37.690042 64563 225873344 global_state_accessor.cc:25] Redis server address = 192.168.0.174:6379, is test flag = 0\n I0902 16:19:37.691146 64563 225873344 redis_client.cc:146] RedisClient connected.\n I0902 16:19:37.693325 64563 225873344 redis_gcs_client.cc:84] RedisGcsClient Connected.\n I0902 16:19:37.694304 64563 225873344 service_based_gcs_client.cc:195] Reconnected to GCS server: 192.168.0.174:60618\n I0902 16:19:37.694643 64563 225873344 service_based_accessor.cc:92] Reestablishing subscription for job info.\n I0902 16:19:37.694655 64563 225873344 service_based_accessor.cc:422] Reestablishing subscription for actor info.\n I0902 16:19:37.694664 64563 225873344 service_based_accessor.cc:808] Reestablishing subscription for node info.\n I0902 16:19:37.694670 64563 225873344 service_based_accessor.cc:1084] Reestablishing subscription for task info.\n I0902 16:19:37.694674 64563 225873344 service_based_accessor.cc:1259] Reestablishing subscription for object locations.\n I0902 16:19:37.694682 64563 225873344 service_based_accessor.cc:1370] Reestablishing subscription for worker failures.\n I0902 16:19:37.694692 64563 225873344 service_based_gcs_client.cc:86] ServiceBasedGcsClient Connected.\n {'node_ip_address': '192.168.0.174', 'raylet_ip_address': '192.168.0.174', 'redis_address': '192.168.0.174:6379', 'object_store_address': '/tmp/ray/session_2020-09-02_16-19-29_803218_64494/sockets/plasma_store', 'raylet_socket_name': '/tmp/ray/session_2020-09-02_16-19-29_803218_64494/sockets/raylet', 'webui_url': 'localhost:8265', 'session_dir': '/tmp/ray/session_2020-09-02_16-19-29_803218_64494', 'metrics_export_port': 62780} \n </denchmark-code>\n \n If we cannot run your script, we cannot fix your issue.\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "edoakes", "commentT": "2020-09-02T21:22:57Z", "comment_text": "\n \t\tP0 because this needs to be fixed before 1.0 branch cut.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "edoakes", "commentT": "2020-09-02T21:28:50Z", "comment_text": "\n \t\tI've narrowed it down to happening on this line and the line below:\n <denchmark-link:https://github.com/ray-project/ray/blob/master/python/ray/state.py#L79>https://github.com/ray-project/ray/blob/master/python/ray/state.py#L79</denchmark-link>\n \n The issue is that the GlobalStateAccessor is being constructed before glog is initialized (happens in the core worker process constructor).\n \t\t"}}}, "commit": {"commit_id": "71274954d108a9c1ae0cc67ff46cb3ad53b75be0", "commit_author": "Edward Oakes", "commitT": "2020-09-03 13:30:33-05:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\worker.py", "file_new_name": "python\\ray\\worker.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "625", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\gcs\\gcs_client\\global_state_accessor.cc", "file_new_name": "src\\ray\\gcs\\gcs_client\\global_state_accessor.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "25,26", "deleted_lines": "25,26", "method_info": {"method_name": "ray::gcs::GlobalStateAccessor::GlobalStateAccessor", "method_params": "redis_address,redis_password,is_test", "method_startline": "22", "method_endline": "47"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "src\\ray\\gcs\\gcs_client\\service_based_accessor.cc", "file_new_name": "src\\ray\\gcs\\gcs_client\\service_based_accessor.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1084", "deleted_lines": "1084", "method_info": {"method_name": "ray::gcs::ServiceBasedTaskInfoAccessor::AsyncResubscribe", "method_params": "is_pubsub_server_restarted", "method_startline": "1083", "method_endline": "1109"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1259", "deleted_lines": "1259", "method_info": {"method_name": "ray::gcs::ServiceBasedObjectInfoAccessor::AsyncResubscribe", "method_params": "is_pubsub_server_restarted", "method_startline": "1258", "method_endline": "1282"}}, "hunk_2": {"Ismethod": 1, "added_lines": "422", "deleted_lines": "422", "method_info": {"method_name": "ray::gcs::ServiceBasedActorInfoAccessor::AsyncResubscribe", "method_params": "is_pubsub_server_restarted", "method_startline": "421", "method_endline": "453"}}, "hunk_3": {"Ismethod": 1, "added_lines": "92", "deleted_lines": "92", "method_info": {"method_name": "ray::gcs::ServiceBasedJobInfoAccessor::AsyncResubscribe", "method_params": "is_pubsub_server_restarted", "method_startline": "91", "method_endline": "106"}}, "hunk_4": {"Ismethod": 1, "added_lines": "1370", "deleted_lines": "1370", "method_info": {"method_name": "ray::gcs::ServiceBasedWorkerInfoAccessor::AsyncResubscribe", "method_params": "is_pubsub_server_restarted", "method_startline": "1369", "method_endline": "1375"}}, "hunk_5": {"Ismethod": 1, "added_lines": "808", "deleted_lines": "808", "method_info": {"method_name": "ray::gcs::ServiceBasedNodeInfoAccessor::AsyncResubscribe", "method_params": "is_pubsub_server_restarted", "method_startline": "807", "method_endline": "828"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\ray\\gcs\\gcs_client\\service_based_gcs_client.cc", "file_new_name": "src\\ray\\gcs\\gcs_client\\service_based_gcs_client.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "86", "deleted_lines": "86", "method_info": {"method_name": "ray::gcs::ServiceBasedGcsClient::Connect", "method_params": "io_service", "method_startline": "30", "method_endline": "88"}}, "hunk_1": {"Ismethod": 1, "added_lines": "195,196", "deleted_lines": "195,196", "method_info": {"method_name": "ray::gcs::ServiceBasedGcsClient::ReconnectGcsServer", "method_params": "", "method_startline": "187", "method_endline": "211"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\gcs\\redis_client.cc", "file_new_name": "src\\ray\\gcs\\redis_client.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "146", "deleted_lines": "146", "method_info": {"method_name": "ray::gcs::RedisClient::Connect", "method_params": "io_services", "method_startline": "101", "method_endline": "149"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\gcs\\redis_gcs_client.cc", "file_new_name": "src\\ray\\gcs\\redis_gcs_client.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "84", "deleted_lines": "84", "method_info": {"method_name": "ray::gcs::RedisGcsClient::Connect", "method_params": "io_service", "method_startline": "35", "method_endline": "87"}}}}}}}