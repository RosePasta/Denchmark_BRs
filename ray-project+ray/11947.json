{"BR": {"BR_id": "11947", "BR_author": "hartikainen", "BRopenT": "2020-11-11T18:41:39Z", "BRcloseT": "2020-11-12T16:43:16Z", "BR_text": {"BRsummary": "[tune] tune fails with deeply-nested configs due to `unflatten_dict`", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Tune fails when using >2 levels deep configs.\n  <denchmark-link:https://github.com/ray-project/ray/commit/543f7809a6e81a346472662a1dcdf5d3263f6e27>543f780</denchmark-link>\n \n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Add deeply-nested value, such as \"a\": {\"b\": {\"c\": {\"d\": tune.choice([1, 2])}}} to the BOHB config here:: \n \n \n ray/python/ray/tune/examples/bohb_example.py\n \n \n          Line 53\n       in\n       396ae0b\n \n \n \n \n \n \n  \"activation\": tune.choice([\"relu\", \"tanh\"]) \n \n \n \n \n \n Then run python ./python/ray/tune/examples/bohb_example.py. It fails with:\n <denchmark-code>$ python ./python/ray/tune/examples/bohb_example.py\n File descriptor limit 256 is too low for production servers and may result in connection errors. At least 8192 is recommended. --- Fix with 'ulimit -n 8192'\n 2020-11-11 20:38:44,944 INFO services.py:1110 -- View the Ray dashboard at http://127.0.0.1:8265\n Traceback (most recent call last):\n   File \"./python/ray/tune/examples/bohb_example.py\", line 87, in <module>\n     stop={\"training_iteration\": 100})\n   File \"/Users/hartikainen/github/ray-project/ray/python/ray/tune/tune.py\", line 416, in run\n     runner.step()\n   File \"/Users/hartikainen/github/ray-project/ray/python/ray/tune/trial_runner.py\", line 380, in step\n     next_trial = self._get_next_trial()  # blocking\n   File \"/Users/hartikainen/github/ray-project/ray/python/ray/tune/trial_runner.py\", line 479, in _get_next_trial\n     self._update_trial_queue(blocking=wait_for_trial)\n   File \"/Users/hartikainen/github/ray-project/ray/python/ray/tune/trial_runner.py\", line 855, in _update_trial_queue\n     trial = self._search_alg.next_trial()\n   File \"/Users/hartikainen/github/ray-project/ray/python/ray/tune/suggest/search_generator.py\", line 114, in next_trial\n     self._experiment.dir_name)\n   File \"/Users/hartikainen/github/ray-project/ray/python/ray/tune/suggest/search_generator.py\", line 121, in create_trial_if_possible\n     suggested_config = self.searcher.suggest(trial_id)\n   File \"/Users/hartikainen/github/ray-project/ray/python/ray/tune/suggest/bohb.py\", line 175, in suggest\n     return unflatten_dict(config)\n   File \"/Users/hartikainen/github/ray-project/ray/python/ray/tune/utils/util.py\", line 276, in unflatten_dict\n     item = item[k]\n KeyError: 'b'\n </denchmark-code>\n \n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "hartikainen", "commentT": "2020-11-11T18:43:03Z", "comment_text": "\n \t\tThanks for this issue, I'll look into this tomorrow.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "hartikainen", "commentT": "2020-11-11T18:47:18Z", "comment_text": "\n \t\tAwesome, thanks for the PR. We'll merge it once the tests pass\n \t\t"}}}, "commit": {"commit_id": "07f401d99d38a73164072fbbb7208a63d6460590", "commit_author": "Kristian Hartikainen", "commitT": "2020-11-12 08:43:15-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\tune\\utils\\util.py", "file_new_name": "python\\ray\\tune\\utils\\util.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "271,272,277,279", "deleted_lines": "271,276,278", "method_info": {"method_name": "unflatten_dict", "method_params": "dt,delimiter", "method_startline": "269", "method_endline": "279"}}}}, "file_1": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "python\\ray\\tune\\utils\\util_test.py"}}}}