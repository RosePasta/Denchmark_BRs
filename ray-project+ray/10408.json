{"BR": {"BR_id": "10408", "BR_author": "ericl", "BRopenT": "2020-08-28T22:16:54Z", "BRcloseT": "2020-09-07T03:54:45Z", "BR_text": {"BRsummary": "[autoscaler] Multi node autoscaler doesn't take into account existing resource usage", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n When we calculate the resources available in the cluster, we should take into account the existing usage from : <denchmark-link:https://github.com/ray-project/ray/blob/master/python/ray/autoscaler/resource_demand_scheduler.py#L54>https://github.com/ray-project/ray/blob/master/python/ray/autoscaler/resource_demand_scheduler.py#L54</denchmark-link>\n \n Otherwise, we might not scale up even when tasks cannot be scheduled. This should be fixed:\n \n Subtract the usage of the node when calculating node resources by looking at LoadMetrics.\n Add unit tests for this scenario.\n \n \t"}, "comments": {}}, "commit": {"commit_id": "8906c1a59ff7004e6cd806317a5b456dcdc7482b", "commit_author": "Alex Wu", "commitT": "2020-09-06 20:54:44-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\autoscaler\\autoscaler.py", "file_new_name": "python\\ray\\autoscaler\\autoscaler.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "516,517", "deleted_lines": "512", "method_info": {"method_name": "log_info_string", "method_params": "self,nodes,target", "method_startline": "508", "method_endline": "520"}}, "hunk_1": {"Ismethod": 1, "added_lines": "202,203,208,209,210", "deleted_lines": "202", "method_info": {"method_name": "_update", "method_params": "self", "method_startline": "134", "method_endline": "265"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "python\\ray\\autoscaler\\load_metrics.py", "file_new_name": "python\\ray\\autoscaler\\load_metrics.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "152,153", "deleted_lines": null, "method_info": {"method_name": "_info", "method_params": "self", "method_startline": "151", "method_endline": "194"}}, "hunk_1": {"Ismethod": 1, "added_lines": "102,103", "deleted_lines": null, "method_info": {"method_name": "get_resource_utilization", "method_params": "self", "method_startline": "102", "method_endline": "103"}}, "hunk_2": {"Ismethod": 1, "added_lines": "19,25,26", "deleted_lines": "19,25", "method_info": {"method_name": "__init__", "method_params": "self,local_ip", "method_startline": "19", "method_endline": "28"}}, "hunk_3": {"Ismethod": 1, "added_lines": "105", "deleted_lines": null, "method_info": {"method_name": "_get_resource_usage", "method_params": "self", "method_startline": "105", "method_endline": "142"}}, "hunk_4": {"Ismethod": 1, "added_lines": "102,103,104,105", "deleted_lines": "101", "method_info": {"method_name": "get_resource_usage", "method_params": "self", "method_startline": "101", "method_endline": "138"}}, "hunk_5": {"Ismethod": 1, "added_lines": "19,25,26", "deleted_lines": "19,25", "method_info": {"method_name": "__init__", "method_params": "self", "method_startline": "19", "method_endline": "27"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 8, "file_old_name": "python\\ray\\autoscaler\\resource_demand_scheduler.py", "file_new_name": "python\\ray\\autoscaler\\resource_demand_scheduler.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "44,45", "deleted_lines": "46", "method_info": {"method_name": "get_nodes_to_launch", "method_params": "self,NodeType", "method_startline": "44", "method_endline": "47"}}, "hunk_1": {"Ismethod": 1, "added_lines": "110,111", "deleted_lines": "111", "method_info": {"method_name": "debug_string", "method_params": "self,NodeID", "method_startline": "110", "method_endline": "111"}}, "hunk_2": {"Ismethod": 1, "added_lines": "83,84", "deleted_lines": null, "method_info": {"method_name": "calculate_node_resources", "method_params": "self,NodeID,str", "method_startline": "82", "method_endline": "84"}}, "hunk_3": {"Ismethod": 1, "added_lines": "91", "deleted_lines": "88,94,95", "method_info": {"method_name": "add_node", "method_params": "node_type", "method_startline": "88", "method_endline": "96"}}, "hunk_4": {"Ismethod": 1, "added_lines": null, "deleted_lines": "81", "method_info": {"method_name": "calculate_node_resources", "method_params": "self,NodeID", "method_startline": "80", "method_endline": "81"}}, "hunk_5": {"Ismethod": 1, "added_lines": "44,45", "deleted_lines": "42,43,46", "method_info": {"method_name": "get_nodes_to_launch", "method_params": "self,NodeType,str", "method_startline": "42", "method_endline": "46"}}, "hunk_6": {"Ismethod": 1, "added_lines": "91,97,98,99,100,101,102", "deleted_lines": "94,95,102", "method_info": {"method_name": "add_node", "method_params": "node_type,existing_resource_usages", "method_startline": "91", "method_endline": "103"}}, "hunk_7": {"Ismethod": 1, "added_lines": "120,121", "deleted_lines": null, "method_info": {"method_name": "debug_string", "method_params": "self,NodeID,str", "method_startline": "119", "method_endline": "121"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\tests\\test_multi_node_2.py", "file_new_name": "python\\ray\\tests\\test_multi_node_2.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "79", "deleted_lines": "79", "method_info": {"method_name": "verify_load_metrics", "method_params": "monitor,expected_resource_usage,timeout", "method_startline": "76", "method_endline": "110"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\tests\\test_resource_demand_scheduler.py", "file_new_name": "python\\ray\\tests\\test_resource_demand_scheduler.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316", "deleted_lines": null, "method_info": {"method_name": "testScaleUpIgnoreUsed", "method_params": "self", "method_startline": "280", "method_endline": "316"}}, "hunk_1": {"Ismethod": 1, "added_lines": "166,167,168,169,170,171,172,173,174,175,176,177,178,179,180", "deleted_lines": null, "method_info": {"method_name": "test_get_nodes_to_launch_limits", "method_params": "", "method_startline": "166", "method_endline": "180"}}}}}}}