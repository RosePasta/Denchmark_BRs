{"BR": {"BR_id": "6612", "BR_author": "ericl", "BRopenT": "2019-12-26T20:06:30Z", "BRcloseT": "2019-12-27T19:36:20Z", "BR_text": {"BRsummary": "[master] Actor calls hang forever after creation task failure", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n This occurs on master after <denchmark-link:https://github.com/ray-project/ray/pull/6570/files>https://github.com/ray-project/ray/pull/6570/files</denchmark-link>\n \n <denchmark-h:h3>Reproduction</denchmark-h>\n \n <denchmark-code>import os\n import random\n import ray\n \n \n @ray.remote(max_reconstructions=0)\n class Actor(object):\n     def __init__(self):\n         if random.random() < 0.8:\n             print(\"crash\")\n             os._exit(0)\n         else:\n             print(\"no crash\")\n \n     def f(self):\n         return \"ACTOR OK\"\n \n ray.init()\n \n a = Actor.remote()\n ray.get(a.f.remote())  # this hangs forever after the change\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ericl", "commentT": "2019-12-26T20:12:37Z", "comment_text": "\n \t\tNote that if max_reconstructions > 0, then the hang will occur after resubmissions fail. I think the issue is that the owner is no longer publishing the actor death if the task fails.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ericl", "commentT": "2019-12-27T04:40:41Z", "comment_text": "\n \t\tyes, thanks for the catch. I've verified the hang issue is fixed with this PR.\n <denchmark-link:https://github.com/ray-project/ray/pull/6617>#6617</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "088ce2d1e1ce05f1451dc1823c7d32440e0c01d1", "commit_author": "Zhijun Fu", "commitT": "2019-12-27 10:48:17-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "python\\ray\\tests\\test_actor.py", "file_new_name": "python\\ray\\tests\\test_actor.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1456,1457", "deleted_lines": null, "method_info": {"method_name": "test_actor_creation_task_crash.f", "method_params": "self", "method_startline": "1456", "method_endline": "1457"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1482,1483,1484,1485,1486,1487,1488", "deleted_lines": null, "method_info": {"method_name": "test_actor_creation_task_crash.get_count", "method_params": "self", "method_startline": "1482", "method_endline": "1488"}}, "hunk_2": {"Ismethod": 1, "added_lines": "1452,1453,1454", "deleted_lines": null, "method_info": {"method_name": "test_actor_creation_task_crash.__init__", "method_params": "self", "method_startline": "1452", "method_endline": "1454"}}, "hunk_3": {"Ismethod": 1, "added_lines": "1490,1491", "deleted_lines": null, "method_info": {"method_name": "test_actor_creation_task_crash.set_count", "method_params": "self,count", "method_startline": "1490", "method_endline": "1491"}}, "hunk_4": {"Ismethod": 1, "added_lines": "1448,1449,1450,1451,1452,1453,1454,1455,1456,1457,1458,1459,1460,1461,1462,1463,1464,1465,1466,1467,1468,1469,1470,1471,1472,1473,1474,1475,1476,1477,1478,1479,1480,1481,1482,1483,1484,1485,1486,1487,1488,1489,1490,1491,1492,1493,1494,1495", "deleted_lines": null, "method_info": {"method_name": "test_actor_creation_task_crash", "method_params": "ray_start_regular", "method_startline": "1448", "method_endline": "1495"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\ray\\core_worker\\actor_manager.cc", "file_new_name": "src\\ray\\core_worker\\actor_manager.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "10,11,12,13,14,15,16,17,18", "deleted_lines": "6,7,8,9,10,11,12,13,18", "method_info": {"method_name": "ray::ActorManager::PublishTerminatedActor", "method_params": "actor_creation_task", "method_startline": "6", "method_endline": "19"}}, "hunk_1": {"Ismethod": 1, "added_lines": "10,11,12", "deleted_lines": "6,7,8,9,10,11,12", "method_info": {"method_name": "ray::ActorManager::PublishCreatedActor", "method_params": "actor_creation_task,address", "method_startline": "6", "method_endline": "12"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\ray\\core_worker\\actor_manager.h", "file_new_name": "src\\ray\\core_worker\\actor_manager.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "23,24", "deleted_lines": "23,24", "method_info": {"method_name": "ray::ActorManager::ActorManager", "method_params": "global_actor_table", "method_startline": "23", "method_endline": "24"}}, "hunk_1": {"Ismethod": 1, "added_lines": "23,24", "deleted_lines": "23,24", "method_info": {"method_name": "ray::ActorManager::ActorManager", "method_params": "actor_accessor", "method_startline": "23", "method_endline": "24"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\core_worker\\core_worker.cc", "file_new_name": "src\\ray\\core_worker\\core_worker.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "105,106,192,193", "deleted_lines": "190", "method_info": {"method_name": "ray::CoreWorker::CoreWorker", "method_params": "worker_type,language,store_socket,raylet_socket,job_id,gcs_options,log_dir,node_ip_address,node_manager_port,task_execution_callback,check_signals,ref_counting_enabled", "method_startline": "67", "method_endline": "247"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\ray\\core_worker\\core_worker.h", "file_new_name": "src\\ray\\core_worker\\core_worker.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "620,621,622", "deleted_lines": null}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\core_worker\\task_manager.cc", "file_new_name": "src\\ray\\core_worker\\task_manager.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "206,207,208,209,210,211", "deleted_lines": null, "method_info": {"method_name": "ray::TaskManager::MarkPendingTaskFailed", "method_params": "task_id,spec,error_type", "method_startline": "194", "method_endline": "212"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\core_worker\\test\\task_manager_test.cc", "file_new_name": "src\\ray\\core_worker\\test\\task_manager_test.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "24,25,26,27", "method_info": {"method_name": "ray::MockActorManager::PublishCreatedActor", "method_params": "actor_creation_task,address", "method_startline": "24", "method_endline": "27"}}}}}}}