{"BR": {"BR_id": "7296", "BR_author": "devin-petersohn", "BRopenT": "2020-02-24T16:45:57Z", "BRcloseT": "2020-02-25T03:18:17Z", "BR_text": {"BRsummary": "pyarrow._plasma.ObjectNotAvailable when passing multiple copies of the same object to a taks", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Ray no longer supports passing multiple copies of the same ObjectID to a task as of 0.8.1. This works in 0.8.0. In Modin we often reuse partitions and data to reduce our memory footprint. This issue is significant and we cannot update our Ray dependency until it is resolved.\n Ray version and other system information (Python version, TensorFlow version, OS): 0.8.1+\n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Please provide a script that can be run to reproduce the issue. The script should have no external library dependencies (i.e., use fake or mock data / environments):\n import ray\n ray.init()\n \n a = ray.put(1)\n \n @ray.remote\n def f(a, b):\n     return a + b\n \n ray.get(f.remote(a, a))\n Traceback produced:\n <denchmark-code>---------------------------------------------------------------------------\n RayTaskError(TypeError)                   Traceback (most recent call last)\n <ipython-input-8-fa22ff5137ff> in <module>\n ----> 1 ray.get(f.remote(z, z))\n \n /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ray/worker.py in get(object_ids, timeout)\n    1502                     worker.core_worker.dump_object_store_memory_usage()\n    1503                 if isinstance(value, RayTaskError):\n -> 1504                     raise value.as_instanceof_cause()\n    1505                 else:\n    1506                     raise value\n \n RayTaskError(TypeError): ray::__main__.f() (pid=42163, ip=192.168.42.4)\n   File \"python/ray/_raylet.pyx\", line 452, in ray._raylet.execute_task\n   File \"<ipython-input-6-8ee2d2129fdd>\", line 3, in f\n TypeError: unsupported operand type(s) for +: 'int' and 'type'\n </denchmark-code>\n \n The second object is of type pyarrow._plasma.ObjectNotAvailable\n cc <denchmark-link:https://github.com/gshimansky>@gshimansky</denchmark-link>\n \n cc <denchmark-link:https://github.com/simon-mo>@simon-mo</denchmark-link>\n \n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "devin-petersohn", "commentT": "2020-02-24T18:12:27Z", "comment_text": "\n \t\tcc <denchmark-link:https://github.com/edoakes>@edoakes</denchmark-link>\n  any hints?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "devin-petersohn", "commentT": "2020-02-24T19:38:59Z", "comment_text": "\n \t\tAs a separate note, for anyone who found this issue, a short term workaround is to pack the same argument into a list\n a = ray.put(...)\n my_task.remote([a, a])\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "devin-petersohn", "commentT": "2020-02-24T19:41:48Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/simon-mo>@simon-mo</denchmark-link>\n  The function signature will have to change in your example as well, and the new task will have to do a  on the list passed in.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "devin-petersohn", "commentT": "2020-02-24T23:34:25Z", "comment_text": "\n \t\tCorrect. We will definitely fix this in upcoming release.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "devin-petersohn", "commentT": "2020-02-25T04:38:54Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/edoakes>@edoakes</denchmark-link>\n  and <denchmark-link:https://github.com/simon-mo>@simon-mo</denchmark-link>\n !\n \t\t"}}}, "commit": {"commit_id": "f2faf8d26e489e0d879fd691abddeb3140c86bee", "commit_author": "Edward Oakes", "commitT": "2020-02-24 19:18:16-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\tests\\test_basic.py", "file_new_name": "python\\ray\\tests\\test_basic.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1736,1737,1738,1739,1740,1741", "deleted_lines": null, "method_info": {"method_name": "test_duplicate_args.f", "method_params": "arg1,arg2,arg1_duplicate,kwarg1,kwarg2,kwarg1_duplicate", "method_startline": "1736", "method_endline": "1741"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1734,1735,1736,1737,1738,1739,1740,1741,1742,1743,1744,1745,1746,1747,1748,1749,1750,1751,1752,1753,1754,1755,1756,1757,1758,1759,1760", "deleted_lines": null, "method_info": {"method_name": "test_duplicate_args", "method_params": "ray_start_regular", "method_startline": "1734", "method_endline": "1760"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\core_worker\\core_worker.cc", "file_new_name": "src\\ray\\core_worker\\core_worker.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1105,1120,1121,1122,1123,1124,1125,1163,1164,1165", "deleted_lines": "1105,1120,1158", "method_info": {"method_name": "ray::CoreWorker::BuildArgsForExecutor", "method_params": "task,args,arg_reference_ids,borrowed_ids", "method_startline": "1096", "method_endline": "1169"}}}}}}}