{"BR": {"BR_id": "8002", "BR_author": "PovelikinRostislav", "BRopenT": "2020-04-13T13:35:32Z", "BRcloseT": "2020-04-17T00:55:28Z", "BR_text": {"BRsummary": "[sgd] dcgan.py needs a better reference to mnist_cnn.pt", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n dcgan.py sample identifies classification model path as following:\n <denchmark-code>\"classification_model_path\": os.path.join(\n             os.path.dirname(ray.__file__),\n             \"util/sgd/torch/examples/mnist_cnn.pt\")\n </denchmark-code>\n \n But Ray doesn't have samples in the package. In case I just want to run the sample using pre-installed ray from pip, I got the following error:\n <denchmark-code>$ python dcgan.py --num-workers 44\n 2020-04-13 16:32:44,305 INFO resource_spec.py:204 -- Starting Ray with 120.21 GiB memory available for workers and up to 55.52 GiB for objects. You can adjust these settings with ray.init(me\n mory=<bytes>, object_store_memory=<bytes>).\n 2020-04-13 16:32:44,732 INFO services.py:1146 -- View the Ray dashboard at localhost:8265\n Traceback (most recent call last):\n   File \"dcgan.py\", line 283, in <module>\n     trainer = train_example(\n   File \"dcgan.py\", line 236, in train_example\n     trainer = TorchTrainer(\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/ray/util/sgd/torch/torch_trainer.py\", line 233, in __init__\n     self._start_workers(self.max_replicas)\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/ray/util/sgd/torch/torch_trainer.py\", line 320, in _start_workers\n     self.local_worker.setup(address, 0, num_workers)\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/ray/util/sgd/torch/distributed_torch_runner.py\", line 46, in setup\n     self._setup_training()\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/ray/util/sgd/torch/distributed_torch_runner.py\", line 92, in _setup_training\n     self.training_operator = self.training_operator_cls(\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/ray/util/sgd/torch/training_operator.py\", line 96, in __init__\n     self.setup(config)\n   File \"dcgan.py\", line 136, in setup\n     torch.load(config[\"classification_model_path\"]))\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/torch/serialization.py\", line 525, in load\n     with _open_file_like(f, 'rb') as opened_file:\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/torch/serialization.py\", line 212, in _open_file_like\n     return _open_file(name_or_buffer, mode)\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/torch/serialization.py\", line 193, in __init__\n     super(_open_file, self).__init__(open(name, mode))\n FileNotFoundError: [Errno 2] No such file or directory: '/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/ray/util/sgd/torch/examples/mnist_cnn.pt'\n 2020-04-13 16:32:49,606 ERROR worker.py:1011 -- Possible unhandled error from worker: ray::DistributedTorchRunner.setup() (pid=67029, ip=10.125.21.189)\n   File \"python/ray/_raylet.pyx\", line 452, in ray._raylet.execute_task\n   File \"python/ray/_raylet.pyx\", line 407, in ray._raylet.execute_task.function_executor\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/ray/util/sgd/torch/distributed_torch_runner.py\", line 46, in setup\n     self._setup_training()\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/ray/util/sgd/torch/distributed_torch_runner.py\", line 92, in _setup_training\n     self.training_operator = self.training_operator_cls(\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/ray/util/sgd/torch/training_operator.py\", line 96, in __init__\n     self.setup(config)\n   File \"dcgan.py\", line 136, in setup\n     torch.load(config[\"classification_model_path\"]))\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/torch/serialization.py\", line 525, in load\n     with _open_file_like(f, 'rb') as opened_file:\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/torch/serialization.py\", line 212, in _open_file_like\n     return _open_file(name_or_buffer, mode)\n   File \"/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/torch/serialization.py\", line 193, in __init__\n     super(_open_file, self).__init__(open(name, mode))\n FileNotFoundError: [Errno 2] No such file or directory: '/rpovelik/installed/miniconda3/envs/ray/lib/python3.8/site-packages/ray/util/sgd/torch/examples/mnist_cnn.pt'\n </denchmark-code>\n \n Ray version and other system information (Python version, TensorFlow version, OS):\n ray 0.8.4,\n Ubuntu 18.04,\n Torch 1.4.0\n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Please provide a script that can be run to reproduce the issue. The script should have no external library dependencies (i.e., use fake or mock data / environments):\n python dcgan.py from ./ray/python/ray/util/sgd/torch/examples directory of the repo\n If we cannot run your script, we cannot fix your issue.\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "PovelikinRostislav", "commentT": "2020-04-13T21:34:48Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/PovelikinRostislav>@PovelikinRostislav</denchmark-link>\n  Thanks for opening this issue! The solution to this is just to download it from Git rather than packaging it with Ray.\n I can get to this later this week, but feel free to push a PR!\n \t\t"}}}, "commit": {"commit_id": "65455348054583081d8d4bf74a55b4ecfea957cb", "commit_author": "Richard Liaw", "commitT": "2020-04-16 17:55:27-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ci\\jenkins_tests\\run_sgd_tests.sh", "file_new_name": "ci\\jenkins_tests\\run_sgd_tests.sh", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "67,68,69", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\tune\\examples\\pbt_dcgan_mnist\\pbt_dcgan_mnist.py", "file_new_name": "python\\ray\\tune\\examples\\pbt_dcgan_mnist\\pbt_dcgan_mnist.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "52,53,310,311,312,313,314,315,316,317,318,319,337", "deleted_lines": "325,326,327,328"}}}, "file_2": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "python\\ray\\util\\sgd\\torch\\examples\\__init__.py", "file_new_name": "python\\ray\\util\\sgd\\torch\\examples\\__init__.py"}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\util\\sgd\\torch\\examples\\benchmarks\\benchmark.py", "file_new_name": "python\\ray\\util\\sgd\\torch\\examples\\benchmarks\\benchmark.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "90,94", "deleted_lines": "83", "method_info": {"method_name": "train_epoch", "method_params": "self,pargs,kwargs", "method_startline": "82", "method_endline": "97"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\util\\sgd\\torch\\examples\\dcgan.py", "file_new_name": "python\\ray\\util\\sgd\\torch\\examples\\dcgan.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "232", "deleted_lines": "230,231,232", "method_info": {"method_name": "train_example", "method_params": "num_workers,use_gpu,test_mode", "method_startline": "228", "method_endline": "255"}}}}, "file_5": {"file_change_type": "DELETE", "file_Nmethod": 0, "file_old_name": "python\\ray\\util\\sgd\\torch\\examples\\mnist_cnn.pt", "file_new_name": "python\\ray\\util\\sgd\\torch\\examples\\mnist_cnn.pt"}}}}