{"BR": {"BR_id": "4503", "BR_author": "robertnishihara", "BRopenT": "2019-03-28T23:43:39Z", "BRcloseT": "2019-04-23T18:59:54Z", "BR_text": {"BRsummary": "Test failure in test_actor.py::test_resource_assignment on Travis.", "BRdescription": "\n I've seen Travis fail on the following test\n <denchmark-code>python -m pytest -s python/ray/tests/test_actor.py::test_resource_assignment\n </denchmark-code>\n \n I can reproduce the failure locally after trying maybe 10 times (on MacOS).\n When I check the raylet logs, I see the following crash\n <denchmark-code>$ cat raylet.out\n $ cat raylet.err\n WARNING: Logging before InitGoogleLogging() is written to STDERR\n I0328 16:39:47.504840 2466321280 stats.h:41] Succeeded to initialize stats: exporter address is 127.0.0.1:8888\n F0328 16:39:51.485983 2466321280 scheduling_resources.cc:261]  Check failed: fractional_pair_it->second <= 1 \n *** Check failure stack trace: ***\n *** Aborted at 1553816391 (unix time) try \"date -d @1553816391\" if you are using GNU date ***\n PC: @                0x0 (unknown)\n *** SIGABRT (@0x7fff5a64ab66) received by PID 31035 (TID 0x7fff93011380) stack trace: ***\n     @     0x7fff5a808f5a _sigtramp\n     @        0x10eb78608 (unknown)\n     @     0x7fff5a5a61ae abort\n     @        0x102061a69 google::logging_fail()\n     @        0x102060742 google::LogMessage::SendToLog()\n     @        0x102060e45 google::LogMessage::Flush()\n     @        0x102060f22 google::LogMessage::~LogMessage()\n     @        0x10205a705 ray::RayLog::~RayLog()\n     @        0x101f900ed ray::raylet::ResourceIds::Release()\n     @        0x101f91db4 ray::raylet::ResourceIdSet::Release()\n     @        0x101f65941 ray::raylet::NodeManager::ProcessDisconnectClientMessage()\n     @        0x101f646f3 ray::raylet::NodeManager::ProcessClientMessage()\n     @        0x101f84a7c std::__1::__function::__func<>::operator()()\n     @        0x10204ed5c ray::ClientConnection<>::ProcessMessage()\n     @        0x102056b98 boost::asio::detail::reactive_socket_recv_op<>::do_complete()\n     @        0x101f472ff boost::asio::detail::scheduler::do_run_one()\n     @        0x101f46d22 boost::asio::detail::scheduler::run()\n     @        0x101f3a34e main\n     @     0x7fff5a4fa015 start\n </denchmark-code>\n \n cc <denchmark-link:https://github.com/williamma12>@williamma12</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "robertnishihara", "commentT": "2019-04-02T04:05:01Z", "comment_text": "\n \t\tIt appears that the error is caused by the double machine precision error and <denchmark-link:https://github.com/ray-project/ray/pull/4533>#4533</denchmark-link>\n  should fix it\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "robertnishihara", "commentT": "2019-04-07T15:59:13Z", "comment_text": "\n \t\tI am having issues with this too. A workaround is to set a required resource to x - epsilon instead of x.\n \t\t"}}}, "commit": {"commit_id": "c99e3caaca3b46d4f02ae5830927c5662d872ae7", "commit_author": "William Ma", "commitT": "2019-04-23 11:59:53-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\tests\\test_actor.py", "file_new_name": "python\\ray\\tests\\test_actor.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1405,1411", "deleted_lines": "1405,1411", "method_info": {"method_name": "test_actor_init_fails", "method_params": "ray_start_cluster_head", "method_startline": "1391", "method_endline": "1413"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "python\\ray\\tests\\test_basic.py", "file_new_name": "python\\ray\\tests\\test_basic.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "867,868,869,870,871,872,873,874,875,876,877,878,879,880,881,882,883,884,885,886,887,888,889,890,891,892,893,894,895,896,897,898,899,900,901,902,903,904,905,906,907,908,909,910,911,912,913,914,915,916,917,918,919,920,921,922,923,924,925,926,927,928,929", "deleted_lines": null, "method_info": {"method_name": "test_many_fractional_resources", "method_params": "shutdown_only", "method_startline": "867", "method_endline": "929"}}, "hunk_1": {"Ismethod": 1, "added_lines": "871,872", "deleted_lines": null, "method_info": {"method_name": "test_many_fractional_resources.g", "method_params": "", "method_startline": "871", "method_endline": "872"}}, "hunk_2": {"Ismethod": 1, "added_lines": "2201,2204,2209,2210,2211", "deleted_lines": null, "method_info": {"method_name": "test_zero_capacity_deletion_semantics.test", "method_params": "", "method_startline": "2199", "method_endline": "2213"}}, "hunk_3": {"Ismethod": 1, "added_lines": "875,876,877,878,879,880,881,882", "deleted_lines": null, "method_info": {"method_name": "test_many_fractional_resources.f", "method_params": "block,accepted_resources", "method_startline": "875", "method_endline": "882"}}, "hunk_4": {"Ismethod": 1, "added_lines": "2201,2204,2209,2210,2211", "deleted_lines": null, "method_info": {"method_name": "test_zero_capacity_deletion_semantics", "method_params": "shutdown_only", "method_startline": "2196", "method_endline": "2221"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "src\\ray\\raylet\\node_manager.cc", "file_new_name": "src\\ray\\raylet\\node_manager.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1471,1477", "deleted_lines": "1471,1472,1473,1474,1475,1481", "method_info": {"method_name": "ray::raylet::NodeManager::HandleTaskBlocked", "method_params": "client,required_object_ids,current_task_id", "method_startline": "1457", "method_endline": "1500"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1520", "deleted_lines": "1524,1525,1526,1527,1528,1529", "method_info": {"method_name": "ray::raylet::NodeManager::HandleTaskUnblocked", "method_params": "client,current_task_id", "method_startline": "1502", "method_endline": "1558"}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "2040,2041", "method_info": {"method_name": "ray::raylet::NodeManager::ForwardTaskOrResubmit", "method_params": "task,node_manager_id", "method_startline": "2029", "method_endline": "2078"}}, "hunk_3": {"Ismethod": 1, "added_lines": "1627,1628", "deleted_lines": "1636", "method_info": {"method_name": "ray::raylet::NodeManager::AssignTask", "method_params": "task", "method_startline": "1581", "method_endline": "1726"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\ray\\raylet\\node_manager.h", "file_new_name": "src\\ray\\raylet\\node_manager.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "114", "deleted_lines": null}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\raylet\\scheduling_policy.cc", "file_new_name": "src\\ray\\raylet\\scheduling_policy.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "52,53,54,55", "deleted_lines": "52,53,54", "method_info": {"method_name": "ray::raylet::SchedulingPolicy::Schedule", "method_params": "cluster_resources,local_client_id", "method_startline": "17", "method_endline": "120"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 43, "file_old_name": "src\\ray\\raylet\\scheduling_resources.cc", "file_new_name": "src\\ray\\raylet\\scheduling_resources.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "42,43,44", "deleted_lines": "42,43,44", "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::operator -=", "method_params": "rhs", "method_startline": "42", "method_endline": "44"}}, "hunk_1": {"Ismethod": 1, "added_lines": "12", "deleted_lines": "12", "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::FractionalResourceQuantity", "method_params": "", "method_startline": "12", "method_endline": "12"}}, "hunk_2": {"Ismethod": 1, "added_lines": "71,72", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::ToDouble", "method_params": "", "method_startline": "71", "method_endline": "73"}}, "hunk_3": {"Ismethod": 1, "added_lines": "81,82,83,84,85", "deleted_lines": "87", "method_info": {"method_name": "ray::raylet::ResourceSet::ResourceSet", "method_params": "resource_map", "method_startline": "81", "method_endline": "87"}}, "hunk_4": {"Ismethod": 1, "added_lines": "58,59,60", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::operator >", "method_params": "rhs", "method_startline": "58", "method_endline": "60"}}, "hunk_5": {"Ismethod": 1, "added_lines": "201,202,203,204,206,208,209,210,211,212,213,215,216,217,218,219,221,222", "deleted_lines": "206,207,210,211,212", "method_info": {"method_name": "ray::raylet::ResourceSet::ToString", "method_params": "", "method_startline": "200", "method_endline": "223"}}, "hunk_6": {"Ismethod": 1, "added_lines": "442,444", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::ResourceIdSet::Acquire", "method_params": "resource_set", "method_startline": "439", "method_endline": "454"}}, "hunk_7": {"Ismethod": 1, "added_lines": "189,193,194,195,196,197,198,201,202,203,204", "deleted_lines": "187,188,190,191", "method_info": {"method_name": "ray::raylet::ResourceIds::Contains", "method_params": "resource_quantity", "method_startline": "187", "method_endline": "204"}}, "hunk_8": {"Ismethod": 1, "added_lines": "19,20,21,24", "deleted_lines": "19,20,21,22,23", "method_info": {"method_name": "ray::raylet::EqualsOneEpsilon", "method_params": "quantity", "method_startline": "19", "method_endline": "24"}}, "hunk_9": {"Ismethod": 1, "added_lines": "31,32,33,34,35,36", "deleted_lines": "31,32,33", "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::operator -", "method_params": "rhs", "method_startline": "31", "method_endline": "36"}}, "hunk_10": {"Ismethod": 1, "added_lines": "93,94,95", "deleted_lines": "90,93,94,95", "method_info": {"method_name": "ray::raylet::ResourceSet::ResourceSet", "method_params": "resource_labels,resource_capacity", "method_startline": "89", "method_endline": "97"}}, "hunk_11": {"Ismethod": 1, "added_lines": "225,226,227,228,229,230,231", "deleted_lines": "230", "method_info": {"method_name": "ray::raylet::ResourceSet::GetResourceMap", "method_params": "", "method_startline": "225", "method_endline": "231"}}, "hunk_12": {"Ismethod": 1, "added_lines": "495", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::ResourceIdSet::ToResourceSet", "method_params": "", "method_startline": "494", "method_endline": "500"}}, "hunk_13": {"Ismethod": 1, "added_lines": "256,257,258", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::ResourceIds::ResourceIds", "method_params": "whole_ids,fractional_ids", "method_startline": "256", "method_endline": "259"}}, "hunk_14": {"Ismethod": 1, "added_lines": "62,63,64", "deleted_lines": "63,64", "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::operator <=", "method_params": "rhs", "method_startline": "62", "method_endline": "64"}}, "hunk_15": {"Ismethod": 1, "added_lines": "177,179", "deleted_lines": "180", "method_info": {"method_name": "ray::raylet::ResourceSet::AddResources", "method_params": "other", "method_startline": "176", "method_endline": "182"}}, "hunk_16": {"Ismethod": 1, "added_lines": "252,253", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::ResourceIds::ResourceIds", "method_params": "fractional_ids", "method_startline": "252", "method_endline": "254"}}, "hunk_17": {"Ismethod": 1, "added_lines": "234", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::ResourceSet::GetResourceAmountMap", "method_params": "", "method_startline": "234", "method_endline": "236"}}, "hunk_18": {"Ismethod": 1, "added_lines": "12,13,14,15,16,17", "deleted_lines": "12,13,14,15,16", "method_info": {"method_name": "ray::raylet::EqualsZeroEpsilon", "method_params": "quantity", "method_startline": "12", "method_endline": "17"}}, "hunk_19": {"Ismethod": 1, "added_lines": "24,25,26,27,28,29", "deleted_lines": "28,29", "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::operator +", "method_params": "rhs", "method_startline": "24", "method_endline": "29"}}, "hunk_20": {"Ismethod": 1, "added_lines": "193,194,195,196,197,198", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::ResourceSet::GetNumCpus", "method_params": "", "method_startline": "193", "method_endline": "198"}}, "hunk_21": {"Ismethod": 1, "added_lines": "46,47,48", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::operator ==", "method_params": "rhs", "method_startline": "46", "method_endline": "48"}}, "hunk_22": {"Ismethod": 1, "added_lines": "77,78,79", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::ResourceSet::ResourceSet", "method_params": "resource_map", "method_startline": "77", "method_endline": "79"}}, "hunk_23": {"Ismethod": 1, "added_lines": "377,378,379", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::ResourceIds::TotalQuantity", "method_params": "", "method_startline": "377", "method_endline": "384"}}, "hunk_24": {"Ismethod": 1, "added_lines": "114,115", "deleted_lines": "110,111,112,113,114,115", "method_info": {"method_name": "ray::raylet::ResourceSet::IsSubset", "method_params": "other", "method_startline": "110", "method_endline": "122"}}, "hunk_25": {"Ismethod": 1, "added_lines": "54,55,56", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::operator <", "method_params": "rhs", "method_startline": "54", "method_endline": "56"}}, "hunk_26": {"Ismethod": 1, "added_lines": "139,140,141,143,146,147,148", "deleted_lines": "141,144,146,148,149,150,151", "method_info": {"method_name": "ray::raylet::ResourceSet::SubtractResources", "method_params": "other", "method_startline": "138", "method_endline": "151"}}, "hunk_27": {"Ismethod": 1, "added_lines": "156,158,162,163,164,165,166,167,168,169", "deleted_lines": "154,155,156,157,159,162", "method_info": {"method_name": "ray::raylet::ResourceSet::SubtractResourcesStrict", "method_params": "other", "method_startline": "153", "method_endline": "173"}}, "hunk_28": {"Ismethod": 1, "added_lines": "184,185,186,189", "deleted_lines": "184,187,188,190,191", "method_info": {"method_name": "ray::raylet::ResourceSet::GetResource", "method_params": "resource_name", "method_startline": "184", "method_endline": "191"}}, "hunk_29": {"Ismethod": 1, "added_lines": "423,425", "deleted_lines": "424", "method_info": {"method_name": "ray::raylet::ResourceIdSet::Contains", "method_params": "resource_set", "method_startline": "422", "method_endline": "437"}}, "hunk_30": {"Ismethod": 1, "added_lines": "50,51,52", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::operator !=", "method_params": "rhs", "method_startline": "50", "method_endline": "52"}}, "hunk_31": {"Ismethod": 1, "added_lines": "534", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::ResourceIdSet::ToFlatbuf", "method_params": "fbb", "method_startline": "521", "method_endline": "545"}}, "hunk_32": {"Ismethod": 1, "added_lines": "14,15,16,17,18,19,20,21", "deleted_lines": "14,15,16,19,20,21,22", "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::FractionalResourceQuantity", "method_params": "resource_quantity", "method_startline": "14", "method_endline": "22"}}, "hunk_33": {"Ismethod": 1, "added_lines": "66,67,68,69", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::operator >=", "method_params": "rhs", "method_startline": "66", "method_endline": "69"}}, "hunk_34": {"Ismethod": 1, "added_lines": "261,263,264,265", "deleted_lines": "261,262,263,264,265,270,271,272,274,276,277,278", "method_info": {"method_name": "ray::raylet::ResourceIds::Contains", "method_params": "resource_quantity", "method_startline": "261", "method_endline": "278"}}, "hunk_35": {"Ismethod": 1, "added_lines": "339,340,341,342,343,348,350,352", "deleted_lines": "346,348,349,350,351", "method_info": {"method_name": "ray::raylet::ResourceIds::Release", "method_params": "resource_ids", "method_startline": "328", "method_endline": "358"}}, "hunk_36": {"Ismethod": 1, "added_lines": "184,185", "deleted_lines": "183,184", "method_info": {"method_name": "ray::raylet::ResourceIds::ResourceIds", "method_params": "whole_ids,fractional_ids", "method_startline": "183", "method_endline": "185"}}, "hunk_37": {"Ismethod": 1, "added_lines": "393,395", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::ResourceIds::ToString", "method_params": "", "method_startline": "386", "method_endline": "399"}}, "hunk_38": {"Ismethod": 1, "added_lines": "38,39,40", "deleted_lines": null, "method_info": {"method_name": "ray::raylet::FractionalResourceQuantity::operator +=", "method_params": "rhs", "method_startline": "38", "method_endline": "40"}}, "hunk_39": {"Ismethod": 1, "added_lines": "206,208,209,210,211,212,213,215,216,217,218,219,221,222,225,226,227,228,229,230,231,232,233,234", "deleted_lines": "206,207,210,211,212,230,245", "method_info": {"method_name": "ray::raylet::ResourceIds::Acquire", "method_params": "resource_quantity", "method_startline": "206", "method_endline": "248"}}, "hunk_40": {"Ismethod": 1, "added_lines": "280,283,284,285,286,304,319,320,321,322,323", "deleted_lines": "294,302,303,318", "method_info": {"method_name": "ray::raylet::ResourceIds::Acquire", "method_params": "resource_quantity", "method_startline": "280", "method_endline": "326"}}, "hunk_41": {"Ismethod": 1, "added_lines": null, "deleted_lines": "180", "method_info": {"method_name": "ray::raylet::ResourceIds::ResourceIds", "method_params": "fractional_ids", "method_startline": "180", "method_endline": "181"}}, "hunk_42": {"Ismethod": 1, "added_lines": "369", "deleted_lines": "370,371", "method_info": {"method_name": "ray::raylet::ResourceIds::FractionalIds", "method_params": "", "method_startline": "369", "method_endline": "371"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\ray\\raylet\\scheduling_resources.h", "file_new_name": "src\\ray\\raylet\\scheduling_resources.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "15,16,17,18,19,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,72,73,74,75,126,127,128,129,135,136,147,152,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,207,208,214,215,216,228,235,257,258,268,286,455", "deleted_lines": "11,12,19,20,21,22,23,25,26,27,28,29,89,90,96,97,98,99,110,115,123,128,129,157,163,164,176,183,205,215,233,402"}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\raylet\\task_spec.cc", "file_new_name": "src\\ray\\raylet\\task_spec.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "206,207,208,209,210,211", "method_info": {"method_name": "ray::raylet::TaskSpecification::GetRequiredResource", "method_params": "resource_name", "method_startline": "206", "method_endline": "211"}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\ray\\raylet\\task_spec.h", "file_new_name": "src\\ray\\raylet\\task_spec.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": null, "deleted_lines": "186"}}}}}}