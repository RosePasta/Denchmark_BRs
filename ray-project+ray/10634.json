{"BR": {"BR_id": "10634", "BR_author": "simon-mo", "BRopenT": "2020-09-08T01:50:03Z", "BRcloseT": "2020-09-29T02:49:35Z", "BR_text": {"BRsummary": "Metric agent fails in certain condition", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Ray version and other system information (Python version, TensorFlow version, OS):\n The report logs output the following and prometheus endpoint return 500\n <denchmark-code>Traceback (most recent call last):\n   File \"/root/anaconda3/lib/python3.7/wsgiref/handlers.py\", line 137, in run\n     self.result = application(self.environ, self.start_response)\n   File \"/root/anaconda3/lib/python3.7/site-packages/prometheus_client/exposition.py\", line 52, in prometheus_app\n     status, header, output = _bake_output(registry, accept_header, params)\n   File \"/root/anaconda3/lib/python3.7/site-packages/prometheus_client/exposition.py\", line 40, in _bake_output\n     output = encoder(registry)\n   File \"/root/anaconda3/lib/python3.7/site-packages/prometheus_client/openmetrics/exposition.py\", line 14, in generate_latest\n     for metric in registry.collect():\n   File \"/root/anaconda3/lib/python3.7/site-packages/prometheus_client/registry.py\", line 82, in collect\n     for metric in collector.collect():\n   File \"/root/anaconda3/lib/python3.7/site-packages/ray/prometheus_exporter.py\", line 234, in collect\n     metric = self.to_metric(desc, tag_values, agg_data)\n   File \"/root/anaconda3/lib/python3.7/site-packages/ray/prometheus_exporter.py\", line 159, in to_metric\n     assert (len(tag_values) == len(label_keys))\n AssertionError\n </denchmark-code>\n \n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Please provide a script that can be run to reproduce the issue. The script should have no external library dependencies (i.e., use fake or mock data / environments):\n I didn't get to find the exactly reproducible case but it involves adding and removing serve cluster, and adding and killing named actors, all attached to existing Ray cluster. I will spend more time to figure it out\n If we cannot run your script, we cannot fix your issue.\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "simon-mo", "commentT": "2020-09-08T01:50:14Z", "comment_text": "\n \t\tcc <denchmark-link:https://github.com/rkooo567>@rkooo567</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "simon-mo", "commentT": "2020-09-09T02:14:00Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/yiranwang52>@yiranwang52</denchmark-link>\n  also reported this bug.\n \t\t"}}}, "commit": {"commit_id": "8abe13023f72dabeb233278c0b7b4f80f84c5cc3", "commit_author": "SangBin Cho", "commitT": "2020-09-25 09:11:05-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\gcs\\gcs_server\\gcs_server_main.cc", "file_new_name": "src\\ray\\gcs\\gcs_server\\gcs_server_main.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "62,63,64,65", "deleted_lines": "62,63", "method_info": {"method_name": "main", "method_params": "argc", "method_startline": "32", "method_endline": "106"}}}}}}}