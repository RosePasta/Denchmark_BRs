{"BR": {"BR_id": "6130", "BR_author": "robertnishihara", "BRopenT": "2019-11-10T05:54:22Z", "BRcloseT": "2019-11-26T17:19:20Z", "BR_text": {"BRsummary": "Function definitions are not always updated when redefined.", "BRdescription": "\n <denchmark-h:h3>System information</denchmark-h>\n \n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): MacOS\n Ray installed from (source or binary): source at ccbcc4b\n Python version: 3.6\n \n Run the following in IPython.\n import ray\n \n ray.init()\n \n @ray.remote\n def f():\n     time.sleep(1)\n \n ray.get(f.remote())  # This will raise an exception because 'time' is not defined.\n Then in the same interpreter, run\n import time\n \n @ray.remote\n def f():\n     time.sleep(1)\n \n ray.get(f.remote())\n It should work the second time, since time has now been imported and f has been redefined. However, instead it fails with the same error as the first time.\n <denchmark-code>RayTaskError(NameError): ray_worker:__main__.f() (pid=27630, ip=192.168.42.11)\n   File \"python/ray/_raylet.pyx\", line 548, in ray._raylet.execute_task\n     with core_worker.profile_event(b\"task:execute\"):\n   File \"python/ray/_raylet.pyx\", line 550, in ray._raylet.execute_task\n     outputs = function_executor(*args, **kwargs)\n   File \"<ipython-input-1-eadbd19a0c80>\", line 7, in f\n NameError: name 'time' is not defined\n </denchmark-code>\n \n Note that if I modify the code in f slightly, e.g., to sleep for 2 seconds instead of 1, then it works.\n <denchmark-link:https://github.com/edoakes>@edoakes</denchmark-link>\n  <denchmark-link:https://github.com/pcmoritz>@pcmoritz</denchmark-link>\n  I assume that we're hashing the function source code instead of the pickled function and that's what's causing the issue. Forgetting import statements happens all the time in interactive development in IPython and you often need to import them and then redefine the function.\n \t"}, "comments": {}}, "commit": {"commit_id": "ffb9c0ecae5e1d4be9e917788a38860c75fe177c", "commit_author": "Robert Nishihara", "commitT": "2019-11-26 11:19:19-06:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "python\\ray\\function_manager.py", "file_new_name": "python\\ray\\function_manager.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "368,371,372", "deleted_lines": "354,355", "method_info": {"method_name": "export", "method_params": "self,remote_function", "method_startline": "344", "method_endline": "375"}}, "hunk_1": {"Ismethod": 1, "added_lines": "310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342", "deleted_lines": "342", "method_info": {"method_name": "compute_collision_identifier", "method_params": "self,function_or_class", "method_startline": "310", "method_endline": "342"}}, "hunk_2": {"Ismethod": 1, "added_lines": "580", "deleted_lines": null, "method_info": {"method_name": "export_actor_class", "method_params": "self,Class,actor_method_names", "method_startline": "560", "method_endline": "588"}}, "hunk_3": {"Ismethod": 1, "added_lines": "106,117,118,119,128,131", "deleted_lines": "105,124,125,126,127,128,129,130,131,132,133,134,135,136,139", "method_info": {"method_name": "from_function", "method_params": "cls,function", "method_startline": "105", "method_endline": "139"}}, "hunk_4": {"Ismethod": 1, "added_lines": "106,117,118,119,128,131", "deleted_lines": "124,125,126,127,128,129,130,131", "method_info": {"method_name": "from_function", "method_params": "cls,function,pickled_function", "method_startline": "106", "method_endline": "131"}}, "hunk_5": {"Ismethod": 1, "added_lines": "382,383", "deleted_lines": null, "method_info": {"method_name": "fetch_and_register_remote_function", "method_params": "self,key", "method_startline": "377", "method_endline": "437"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "python\\ray\\import_thread.py", "file_new_name": "python\\ray\\import_thread.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "102,103,104,105,106,107,108,109,110,111,112", "deleted_lines": null, "method_info": {"method_name": "_get_import_info_for_collision_detection", "method_params": "self,key", "method_startline": "102", "method_endline": "112"}}, "hunk_1": {"Ismethod": 1, "added_lines": "121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146", "deleted_lines": null, "method_info": {"method_name": "_process_key", "method_params": "self,key", "method_startline": "114", "method_endline": "166"}}, "hunk_2": {"Ismethod": 1, "added_lines": "47", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,worker,mode,threads_stopped", "method_startline": "42", "method_endline": "47"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\ray_constants.py", "file_new_name": "python\\ray\\ray_constants.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "54,55,56,57", "deleted_lines": null}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\remote_function.py", "file_new_name": "python\\ray\\remote_function.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "9,28,29,30,31,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168", "deleted_lines": "27,60,61,62,150,151,152"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 8, "file_old_name": "python\\ray\\tests\\test_basic.py", "file_new_name": "python\\ray\\tests\\test_basic.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1059,1060", "deleted_lines": null, "method_info": {"method_name": "test_redefining_remote_functions.test_redefining_remote_functions.h.j", "method_params": "", "method_startline": "1059", "method_endline": "1060"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1038,1039", "deleted_lines": null, "method_info": {"method_name": "test_redefining_remote_functions.g", "method_params": "", "method_startline": "1038", "method_endline": "1039"}}, "hunk_2": {"Ismethod": 1, "added_lines": "1017,1018", "deleted_lines": null, "method_info": {"method_name": "test_redefining_remote_functions.f", "method_params": "x", "method_startline": "1017", "method_endline": "1018"}}, "hunk_3": {"Ismethod": 1, "added_lines": "1044,1045", "deleted_lines": null, "method_info": {"method_name": "test_redefining_remote_functions.nonexistent", "method_params": "", "method_startline": "1044", "method_endline": "1045"}}, "hunk_4": {"Ismethod": 1, "added_lines": "1012,1013,1014,1015,1016,1017,1018,1019,1020,1021,1022,1023,1024,1025,1026,1027,1028,1029,1030,1031,1032,1033,1034,1035,1036,1037,1038,1039,1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065", "deleted_lines": null, "method_info": {"method_name": "test_redefining_remote_functions", "method_params": "shutdown_only", "method_startline": "1012", "method_endline": "1065"}}, "hunk_5": {"Ismethod": 1, "added_lines": null, "deleted_lines": "969,970", "method_info": {"method_name": "test_defining_remote_functions.f", "method_params": "x", "method_startline": "969", "method_endline": "970"}}, "hunk_6": {"Ismethod": 1, "added_lines": "1012,1013,1014,1015,1016,1017,1018,1019,1020,1021,1022,1023,1024,1025,1026,1027,1028,1029", "deleted_lines": "967,968,969,970,971,972,973,974,975,976,977,978,979,980,981,982,983,984,985,986", "method_info": {"method_name": "test_defining_remote_functions", "method_params": "shutdown_only", "method_startline": "964", "method_endline": "1029"}}, "hunk_7": {"Ismethod": 1, "added_lines": "1057,1058,1059,1060,1061,1062", "deleted_lines": null, "method_info": {"method_name": "test_redefining_remote_functions.h", "method_params": "i", "method_startline": "1057", "method_endline": "1062"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "python\\ray\\tests\\test_failure.py", "file_new_name": "python\\ray\\tests\\test_failure.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "687,688,689,690,691,692,693,694", "deleted_lines": null, "method_info": {"method_name": "test_warning_for_many_duplicate_remote_functions_and_actors.create_actor_class", "method_params": "", "method_startline": "687", "method_endline": "694"}}, "hunk_1": {"Ismethod": 1, "added_lines": "652,653", "deleted_lines": null, "method_info": {"method_name": "test_warning_for_many_duplicate_remote_functions_and_actors.test_warning_for_many_duplicate_remote_functions_and_actors.create_remote_function.g", "method_params": "", "method_startline": "652", "method_endline": "653"}}, "hunk_2": {"Ismethod": 1, "added_lines": "646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670,671,672,673,674,675,676,677,678,679,680,681,682,683,684,685,686,687,688,689,690,691,692,693,694,695,696,697,698,699,700,701,702,703,704,705,706,707,708,709,710,711,712,713,714,715,716,717,718", "deleted_lines": null, "method_info": {"method_name": "test_warning_for_many_duplicate_remote_functions_and_actors", "method_params": "shutdown_only", "method_startline": "646", "method_endline": "718"}}, "hunk_3": {"Ismethod": 1, "added_lines": "650,651,652,653,654,655", "deleted_lines": null, "method_info": {"method_name": "test_warning_for_many_duplicate_remote_functions_and_actors.create_remote_function", "method_params": "", "method_startline": "650", "method_endline": "655"}}}}}}}