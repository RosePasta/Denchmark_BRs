{"BR": {"BR_id": "1496", "BR_author": "beasteers", "BRopenT": "2020-05-25T05:02:01Z", "BRcloseT": "2020-07-08T00:46:25Z", "BR_text": {"BRsummary": "Error during exception handling in st.write - TypeError: exception() takes 3 positional arguments but 4 were given", "BRdescription": "\n <denchmark-h:h1>Summary</denchmark-h>\n \n I'm trying to display a dataframe with st.write and it fails with a streamlit error while trying to handle an error from rendering the object.\n TypeError: exception() takes 3 positional arguments but 4 were given\n Traceback:\n File \"/home/bs3639/.conda/envs/bosch/lib/python3.6/site-packages/streamlit/ScriptRunner.py\", line 322, in _run_script\n     exec(code, module.__dict__)\n File \"/scratch/bs3639/bosch-urban-sound/boschurbansnd/app.py\", line 256, in <module>\n     data_summary(dflabels, dffiles)\n File \"/scratch/bs3639/bosch-urban-sound/boschurbansnd/app.py\", line 130, in data_summary\n     st.write(dffiles.reset_index(drop=True).head())\n File \"/home/bs3639/.conda/envs/bosch/lib/python3.6/site-packages/streamlit/__init__.py\", line 411, in write\n     exception(exc, exc_tb)  # noqa: F821\n File \"/home/bs3639/.conda/envs/bosch/lib/python3.6/site-packages/streamlit/DeltaGenerator.py\", line 122, in wrapped_method\n     return dg._enqueue_new_element_delta(marshall_element, delta_type, last_index)\n File \"/home/bs3639/.conda/envs/bosch/lib/python3.6/site-packages/streamlit/DeltaGenerator.py\", line 367, in _enqueue_new_element_delta\n     rv = marshall_element(msg.delta.new_element)\n File \"/home/bs3639/.conda/envs/bosch/lib/python3.6/site-packages/streamlit/DeltaGenerator.py\", line 120, in marshall_element\n     return method(dg, element, *args, **kwargs)\n <denchmark-h:h1>Steps to reproduce</denchmark-h>\n \n It happens when you raise an exception during type conversion in st.write.\n Here's the simplest example I could think of that throws the same error.\n import streamlit as st\n \n class breakstuff:\n     def __str__(self):\n         raise ValueError\n \n st.write(breakstuff())\n <denchmark-h:h2>Expected behavior:</denchmark-h>\n \n It should display the ValueError\n <denchmark-h:h2>Actual behavior:</denchmark-h>\n \n Instead it throws a streamlit internal TypeError error (see above traceback).\n It means that I can't actually debug the exception that is throwing that code.\n <denchmark-h:h1>Debug info</denchmark-h>\n \n \n Streamlit version: Streamlit, version 0.60.0 (get it with $ streamlit version)\n Python version: Python 3.6.10 :: Anaconda, Inc. (get it with $ python --version)\n Using Conda? PipEnv? PyEnv? Pex?  -  Conda\n OS version:\n Browser version:\n \n <denchmark-h:h1>Additional information</denchmark-h>\n \n From a quick spin following the traceback, I believe I can see the issue.\n The traceback says that the error originates here:\n \n \n \n streamlit/lib/streamlit/DeltaGenerator.py\n \n \n          Line 120\n       in\n       a9be677\n \n \n \n \n \n \n  return method(dg, element, *args, **kwargs) \n \n \n \n \n \n The wrapper provides 2 args and it says it's receiving 4 while expecting 3, so that means that the wrapped method is being called with 2 instead of an expected 1 argument.\n Earlier in the traceback, it says that it's being raised in st.write by exception (notice it's being called with 2 arguments):\n \n \n \n streamlit/lib/streamlit/__init__.py\n \n \n         Lines 409 to 411\n       in\n       a9be677\n \n \n \n \n \n \n  except Exception: \n \n \n \n  _, exc, exc_tb = _sys.exc_info() \n \n \n \n  exception(exc, exc_tb)  # noqa: F821 \n \n \n \n \n \n Looking at its definition, exception is wrapped with _with_element and takes 3 arguments, 2 of which are provided by the wrapper.\n \n \n \n streamlit/lib/streamlit/DeltaGenerator.py\n \n \n         Lines 788 to 789\n       in\n       a9be677\n \n \n \n \n \n \n  @_with_element \n \n \n \n  def exception(self, element, exception): \n \n \n \n \n \n tl;dr - you probably shouldn't be passing the traceback into the exception function (or perhaps you meant to and you haven't finished implementing it on the other side.) Either way, it's broken rn.\n <denchmark-h:h1>Possible Solution?</denchmark-h>\n \n From a cursory glance, it looks like you should just simplify to this and this issue will go away:\n # change here: https://github.com/streamlit/streamlit/blob/a9be6773eceba186c4094908c5403575810d760a/lib/streamlit/__init__.py#L409-L411\n try:\n     ...\n except Exception as exc:\n     exception(exc)\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "beasteers", "commentT": "2020-06-13T21:20:27Z", "comment_text": "\n \t\tI have the exact same problem. I think that the dataframe is too big. By just not printing it out the problem went await\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "beasteers", "commentT": "2020-07-07T23:31:24Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/beasteers>@beasteers</denchmark-link>\n  for the excellent and thorough bug report! This is fixed in <denchmark-link:https://github.com/streamlit/streamlit/pull/1682>#1682</denchmark-link>\n , which should go out in the next release.\n \t\t"}}}, "commit": {"commit_id": "077e7facef4cb7f46dca5957721c65d27f0a86df", "commit_author": "Tim Conkling", "commitT": "2020-07-07 17:46:24-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "lib\\streamlit\\__init__.py", "file_new_name": "lib\\streamlit\\__init__.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "410,411", "deleted_lines": "410,411", "method_info": {"method_name": "write", "method_params": "args,kwargs", "method_startline": "233", "method_endline": "411"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "lib\\tests\\streamlit\\write_test.py", "file_new_name": "lib\\tests\\streamlit\\write_test.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "187,188,189,190,191,192", "deleted_lines": "187", "method_info": {"method_name": "test_exception", "method_params": "self", "method_startline": "185", "method_endline": "196"}}}}}}}