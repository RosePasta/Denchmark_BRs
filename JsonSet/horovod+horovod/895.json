{"BR": {"BR_id": "895", "BR_author": "eric-haibin-lin", "BRopenT": "2019-03-08T04:29:00Z", "BRcloseT": "2019-03-28T03:35:35Z", "BR_text": {"BRsummary": "mxnet+hvd with different random seed won't work with Gluon API", "BRdescription": "\n Environment:\n \n Framework: (MXNet)\n Framework version: 1.4\n Horovod version: v0.16.0\n MPI version:\n CUDA version:\n NCCL version:\n Python version: 2.7/3.6\n OS and version:\n \n Checklist:\n \n Did you search issues to find if somebody asked this question before?\n If your question is about hang, did you read this doc?\n If your question is about docker, did you read this doc?\n \n Bug report:\n Please describe errorneous behavior you're observing and steps to reproduce it.\n If the shape of a parameter has to be inferred after a batch of data is seen, the parameter will not be broadcast. Therefore, the correctness of the program depends on whether all workers are initialized with the same random seed. So the following program will not work:\n <denchmark-code>random.seed(hvd.local_rank())\n data = ..\n model = mx.gluon.nn.Dense(10)\n model.initialize()\n \n // no parameters are broadcast, because initialization is deferred.\n hvd.broadcast_parameters(model.collect_parameters())\n \n for batch in data:\n     // params are initialized after shape is known\n     pred = model(batch.data[0])\n     ...\n ...\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "eric-haibin-lin", "commentT": "2019-03-08T04:36:33Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/eric-haibin-lin>@eric-haibin-lin</denchmark-link>\n  append \"using Gluon API\" in the title to avoid confusion?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "eric-haibin-lin", "commentT": "2019-03-08T06:42:56Z", "comment_text": "\n \t\tAdded. Thanks\n \t\t"}}}, "commit": {"commit_id": "3a1083e2ddd22ce8b38bfd8564564a7c290808ad", "commit_author": "Yuxi Hu", "commitT": "2019-03-27 20:35:34-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "examples\\mxnet_mnist.py", "file_new_name": "examples\\mxnet_mnist.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "115,120", "deleted_lines": "115,119,120"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "horovod\\mxnet\\__init__.py", "file_new_name": "horovod\\mxnet\\__init__.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "75,76,77,78", "deleted_lines": null, "method_info": {"method_name": "_append_broadcast_init.wrapped_init_impl", "method_params": "self,args,kwargs", "method_startline": "75", "method_endline": "78"}}, "hunk_1": {"Ismethod": 1, "added_lines": "103,104,105,106", "deleted_lines": "92,93", "method_info": {"method_name": "broadcast_parameters", "method_params": "params,root_rank", "method_startline": "82", "method_endline": "117"}}, "hunk_2": {"Ismethod": 1, "added_lines": "73,74,75,76,77,78,79", "deleted_lines": null, "method_info": {"method_name": "_append_broadcast_init", "method_params": "param,root_rank", "method_startline": "73", "method_endline": "79"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "test\\test_mxnet.py", "file_new_name": "test\\test_mxnet.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "358", "method_info": {"method_name": "test_horovod_broadcast_grad", "method_params": "self", "method_startline": "340", "method_endline": "377"}}, "hunk_1": {"Ismethod": 1, "added_lines": "447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471", "deleted_lines": null, "method_info": {"method_name": "test_horovod_broadcast_deferred_init_parameters", "method_params": "self", "method_startline": "447", "method_endline": "471"}}}}}}}