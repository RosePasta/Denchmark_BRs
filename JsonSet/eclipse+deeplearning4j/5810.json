{"BR": {"BR_id": "5810", "BR_author": "AlexDBlack", "BRopenT": "2018-07-05T06:35:18Z", "BRcloseT": "2018-07-06T08:47:31Z", "BR_text": {"BRsummary": "DL4J Spark - Gradient Sharing - Small Data Issue (empty RDD partition?)", "BRdescription": "\n I ran into the following due to misconfigured data pipeline:\n 7 workers, 8 DataSets/minibatches, 256 examples total.\n I suspect this is simply an empty RDD partition - one of the workers isn't getting getting any data\n <denchmark-code>2018-07-05 06:03:25 INFO  ParallelWrapper:468 - Using workspaceMode ENABLED for training\n 2018-07-05 06:03:25 INFO  ParallelWrapper:480 - Creating asynchronous prefetcher...\n 2018-07-05 06:03:25 INFO  ParallelWrapper:498 - Starting ParallelWrapper training round...\n 2018-07-05 06:03:25 ERROR SparkUncaughtExceptionHandler:91 - Uncaught exception in thread Thread[ADSI prefetch thread,5,main]\n java.lang.RuntimeException: java.util.NoSuchElementException: next on empty iterator\n \tat org.deeplearning4j.datasets.iterator.AsyncDataSetIterator$AsyncPrefetchThread.run(AsyncDataSetIterator.java:414)\n Caused by: java.util.NoSuchElementException: next on empty iterator\n \tat scala.collection.Iterator$$anon$2.next(Iterator.scala:39)\n \tat scala.collection.Iterator$$anon$2.next(Iterator.scala:37)\n \tat scala.collection.Iterator$$anon$12.next(Iterator.scala:444)\n \tat scala.collection.Iterator$$anon$11.next(Iterator.scala:409)\n \tat org.apache.spark.util.CompletionIterator.next(CompletionIterator.scala:28)\n \tat org.apache.spark.InterruptibleIterator.next(InterruptibleIterator.scala:40)\n \tat scala.collection.Iterator$$anon$11.next(Iterator.scala:409)\n \tat scala.collection.convert.Wrappers$IteratorWrapper.next(Wrappers.scala:31)\n \tat org.deeplearning4j.spark.parameterserver.iterators.VirtualIterator.next(VirtualIterator.java:40)\n \tat org.deeplearning4j.spark.parameterserver.iterators.VirtualDataSetIterator.next(VirtualDataSetIterator.java:92)\n \tat org.deeplearning4j.spark.parameterserver.iterators.VirtualDataSetIterator.next(VirtualDataSetIterator.java:18)\n \tat org.deeplearning4j.datasets.iterator.AsyncDataSetIterator$AsyncPrefetchThread.run(AsyncDataSetIterator.java:388)\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "AlexDBlack", "commentT": "2018-09-21T15:59:28Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "68a5d9db8ba017ea85ef1a2eec6f238f6bbcd5ca", "commit_author": "Alex Black", "commitT": "2018-07-06 18:47:30+10:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapDataSet.java", "file_new_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapDataSet.java", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "38,39,40,41,42", "deleted_lines": null, "method_info": {"method_name": "SharedFlatMapDataSetAdapter<R::call", "method_params": "dataSetIterator", "method_startline": "37", "method_endline": "58"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapMultiDataSet.java", "file_new_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapMultiDataSet.java", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "39,40,41,42", "deleted_lines": null, "method_info": {"method_name": "SharedFlatMapMultiDataSetAdapter<R::call", "method_params": "dataSetIterator", "method_startline": "38", "method_endline": "58"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapMultiPDS.java", "file_new_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapMultiPDS.java", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "58,59,60,61", "deleted_lines": null, "method_info": {"method_name": "SharedFlatMapMultiPDSAdapter<R::call", "method_params": "dataSetIterator", "method_startline": "57", "method_endline": "71"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapPDS.java", "file_new_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapPDS.java", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "55,56,57,58", "deleted_lines": null, "method_info": {"method_name": "SharedFlatMapPDSAdapter<R::call", "method_params": "dataSetIterator", "method_startline": "54", "method_endline": "68"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapPaths.java", "file_new_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapPaths.java", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "38,39,40,41", "deleted_lines": null, "method_info": {"method_name": "SharedFlatMapPathsAdapter<R::call", "method_params": "dataSetIterator", "method_startline": "37", "method_endline": "52"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapPathsMDS.java", "file_new_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\functions\\SharedFlatMapPathsMDS.java", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "37,38,39,40", "deleted_lines": null, "method_info": {"method_name": "SharedFlatMapPathsMDSAdapter<R::call", "method_params": "dataSetIterator", "method_startline": "36", "method_endline": "51"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\pw\\SharedTrainingWrapper.java", "file_new_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\pw\\SharedTrainingWrapper.java", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "90", "deleted_lines": null, "method_info": {"method_name": "SharedTrainingWrapper::attachDS", "method_params": "iterator", "method_startline": "89", "method_endline": "105"}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\training\\SharedTrainingMaster.java", "file_new_name": "deeplearning4j\\deeplearning4j-scaleout\\spark\\dl4j-spark-parameterserver\\src\\main\\java\\org\\deeplearning4j\\spark\\parameterserver\\training\\SharedTrainingMaster.java", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "237,238,239", "deleted_lines": "235", "method_info": {"method_name": "SharedTrainingMaster::getWorkerInstance", "method_params": "graph", "method_startline": "230", "method_endline": "256"}}, "hunk_1": {"Ismethod": 1, "added_lines": "103,121", "deleted_lines": "102", "method_info": {"method_name": "SharedTrainingMaster::SharedTrainingMaster", "method_params": "voidConfiguration,numWorkers,rddTrainingApproach,storageLevel,collectTrainingStats,repartitionStrategy,repartition,threshold,minThreshold,thresholdStep,stepTrigger,stepDelay,shakeFrequency,batchSizePerWorker,debugLongerIterations,numWorkersPerNode,workerPrefetchBatches", "method_startline": "99", "method_endline": "131"}}, "hunk_2": {"Ismethod": 1, "added_lines": "1228", "deleted_lines": null, "method_info": {"method_name": "SharedTrainingMaster::Builder::build", "method_params": "", "method_startline": "1224", "method_endline": "1233"}}, "hunk_3": {"Ismethod": 1, "added_lines": "1219,1220,1221,1222", "deleted_lines": null, "method_info": {"method_name": "SharedTrainingMaster::Builder::workerPrefetchNumBatches", "method_params": "prefetchNumBatches", "method_startline": "1219", "method_endline": "1222"}}, "hunk_4": {"Ismethod": 1, "added_lines": "103,121", "deleted_lines": "102", "method_info": {"method_name": "SharedTrainingMaster::SharedTrainingMaster", "method_params": "voidConfiguration,numWorkers,rddTrainingApproach,storageLevel,collectTrainingStats,repartitionStrategy,repartition,threshold,minThreshold,thresholdStep,stepTrigger,stepDelay,shakeFrequency,batchSizePerWorker,debugLongerIterations,numWorkersPerNode", "method_startline": "98", "method_endline": "129"}}}}}}}