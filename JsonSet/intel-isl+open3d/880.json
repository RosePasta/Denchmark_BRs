{"BR": {"BR_id": "880", "BR_author": "mike239x", "BRopenT": "2019-03-26T23:06:56Z", "BRcloseT": "2019-06-13T07:29:59Z", "BR_text": {"BRsummary": "EstimateNormals not working for flat patches", "BRdescription": "\n It appears the EstimateNormals function does not work properly for completely flat patches, also somehow depending on the orientation.\n To reproduce:\n import numpy as np\n import open3d\n \n X,Y = np.mgrid[0:1:0.1,0:1:0.1]\n X = X.flatten()\n Y = Y.flatten()\n \n pts = np.zeros((3, X.size))\n pts[0] = X\n pts[1] = Y\n \n shape  = open3d.PointCloud()\n shape.points = open3d.Vector3dVector(pts.T)\n shape.paint_uniform_color([0, 0.651, 0.929]) # blue\n \n open3d.estimate_normals(shape, open3d.KDTreeSearchParamHybrid(radius = 0.5, max_nn = 30))\n \n # show the shape\n open3d.draw_geometries([shape])\n If you write\n pts[1] = X\n pts[2] = Y\n instead - it works as expected; if you use 0 and 1 or 0 and 2 as indices - it no longer works.\n Expected:\n <denchmark-link:https://user-images.githubusercontent.com/8998317/55039032-f4578f80-5022-11e9-8aef-d9322402f6b8.png></denchmark-link>\n \n Got:\n <denchmark-link:https://user-images.githubusercontent.com/8998317/55039065-0cc7aa00-5023-11e9-9c88-b7d085588528.png></denchmark-link>\n \n Environment (please complete the following information):\n \n OS: Ubuntu 18.04\n Python version: 3.6.7\n Open3D version: 0.5 release (also tested on the commit 6f493ef)\n Is this remote workstation?: no\n How did you install Open3D?: pip for the release; build myself the newer version\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "mike239x", "commentT": "2019-03-26T23:18:03Z", "comment_text": "\n \t\tGood catch. Looks like a numerical issue of this function:\n <denchmark-link:https://github.com/IntelVCL/Open3D/blob/377fc7d6a47ea47681c25a1e07a5383d62a612aa/src/Open3D/Geometry/EstimateNormals.cpp#L40>https://github.com/IntelVCL/Open3D/blob/377fc7d6a47ea47681c25a1e07a5383d62a612aa/src/Open3D/Geometry/EstimateNormals.cpp#L40</denchmark-link>\n \n I will dig into it when I got time.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "mike239x", "commentT": "2019-03-27T10:08:06Z", "comment_text": "\n \t\tFun fact: adding minimal noise to the points fixes the problem.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "mike239x", "commentT": "2019-06-13T07:29:59Z", "comment_text": "\n \t\tFixed in <denchmark-link:https://github.com/intel-isl/Open3D/pull/1011>#1011</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "46f08061b19f8320a50ae10aa840d260eeb9d31b", "commit_author": "Gernot", "commitT": "2019-06-12 11:40:12-07:00", "changed_files": {"file_0": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "examples\\Python\\Basic\\pointcloud_estimate_normals.py"}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 8, "file_old_name": "src\\Open3D\\Geometry\\EstimateNormals.cpp", "file_new_name": "src\\Open3D\\Geometry\\EstimateNormals.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "136,137,138,139,140,141,142,143,144,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,211,212,213,214,215,216,217,218", "deleted_lines": "137", "method_info": {"method_name": "open3d::FastEigen3x3", "method_params": "A", "method_startline": "136", "method_endline": "220"}}, "hunk_1": {"Ismethod": 1, "added_lines": "268,269,284", "deleted_lines": null, "method_info": {"method_name": "open3d::geometry::PointCloud::EstimateNormals", "method_params": "search_param,fast_normal_computation", "method_startline": "267", "method_endline": "302"}}, "hunk_2": {"Ismethod": 1, "added_lines": "121,122,123,124,125,126,127,128,129,131,134,136,137,138,139,140,141,142,143,144,146,147,148,149,150,151,152,153,154,155", "deleted_lines": "122,137", "method_info": {"method_name": "open3d::geometry::PointCloud::EstimateNormals", "method_params": "search_param", "method_startline": "121", "method_endline": "155"}}, "hunk_3": {"Ismethod": 1, "added_lines": "70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,118,119,120,121,122,123,124,125,126,127,128,129,131,134", "deleted_lines": "70,71,72,73,76,81,111,112,113,114,122", "method_info": {"method_name": "open3d::ComputeEigenvector1", "method_params": "A,evec0,eval1", "method_startline": "70", "method_endline": "134"}}, "hunk_4": {"Ismethod": 1, "added_lines": "223,224,254,255,256,257,258,259,260", "deleted_lines": null, "method_info": {"method_name": "open3d::ComputeNormal", "method_params": "cloud,indices,fast_normal_computation", "method_startline": "222", "method_endline": "261"}}, "hunk_5": {"Ismethod": 1, "added_lines": "40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68", "deleted_lines": "40,41,42,43,44,45,46,47,48,50,51,52,53,54,55,56,57,58,59,60,62,64,65,66", "method_info": {"method_name": "open3d::ComputeEigenvector0", "method_params": "A,eval0", "method_startline": "40", "method_endline": "68"}}, "hunk_6": {"Ismethod": 1, "added_lines": "80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115", "deleted_lines": "81,111,112,113,114", "method_info": {"method_name": "open3d::ComputeNormal", "method_params": "cloud,indices", "method_startline": "80", "method_endline": "115"}}, "hunk_7": {"Ismethod": 1, "added_lines": "40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78", "deleted_lines": "40,41,42,43,44,45,46,47,48,50,51,52,53,54,55,56,57,58,59,60,62,64,65,66,69,70,71,72,73,76", "method_info": {"method_name": "open3d::FastEigen3x3", "method_params": "A", "method_startline": "40", "method_endline": "78"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\Open3D\\Geometry\\PointCloud.h", "file_new_name": "src\\Open3D\\Geometry\\PointCloud.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "141,142", "deleted_lines": "141"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\Python\\geometry\\pointcloud.cpp", "file_new_name": "src\\Python\\geometry\\pointcloud.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "109,110,224,225,226,227,228", "deleted_lines": "109,223", "method_info": {"method_name": "pybind_pointcloud", "method_params": "m", "method_startline": "37", "method_endline": "250"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\UnitTest\\Geometry\\PointCloud.cpp", "file_new_name": "src\\UnitTest\\Geometry\\PointCloud.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "688,689,690,691,692,693,694,695,696,697,699,700,701,702,703,704,705", "deleted_lines": "688", "method_info": {"method_name": "TEST", "method_params": "PointCloud,EstimateNormals", "method_startline": "656", "method_endline": "707"}}}}}}}