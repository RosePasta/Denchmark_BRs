{"BR": {"BR_id": "2366", "BR_author": "PaperclipBadger", "BRopenT": "2020-03-13T17:53:57Z", "BRcloseT": "2020-03-13T20:54:43Z", "BR_text": {"BRsummary": "[bug] pyro.distributions.InverseGamma.sample does not work on GPU", "BRdescription": "\n <denchmark-h:h3>Issue Description</denchmark-h>\n \n pyro.distributions.InverseGamma.sample fails with the following error when its arguments are on the GPU:\n <denchmark-code>RuntimeError: iter.device(arg).is_cuda() INTERNAL ASSERT FAILED at /pytorch/aten/src/ATen/native/cuda/Loops.cuh:197, please report a bug to PyTorch.\n </denchmark-code>\n \n I think the problem is in __init__:\n     def __init__(self, concentration, rate, validate_args=None):\n         base_dist = Gamma(concentration, rate)\n         super().__init__(base_dist, PowerTransform(-1.0), validate_args=validate_args)\n The argument to PowerTransform should probably be something like -torch.ones_like(rate).\n <denchmark-h:h3>Environment</denchmark-h>\n \n Ubuntu 16.04, Python 3.7, PyTorch 1.4.0, Pyro 1.3.0\n <denchmark-h:h3>Code Snippet</denchmark-h>\n \n >>> import torch\n >>> from pyro.distributions import Gamma, InverseGamma, TransformedDistribution\n >>> from pyro.distributions.transforms import PowerTransform\n >>>\n >>> concentration = torch.tensor(1.0).to(\"cuda\")\n >>> rate = torch.tensor(1.0).to(\"cuda\")\n >>> \n >>> # InverseGamma.sample fails with an error\n >>> InverseGamma(concentration, rate).sample()\n RuntimeError: iter.device(arg).is_cuda() INTERNAL ASSERT FAILED at /pytorch/aten/src/ATen/native/cuda/Loops.cuh:197, please report a bug to PyTorch.\n >>> \n >>> # The equivalent TransformedDistribution is fine\n >>> TransformedDistribution(\n ...     Gamma(concentration, rate),\n ...     PowerTransform(torch.tensor(-1.0).to(\"cuda\")),\n ... ).sample()\n tensor(0.5707, device='cuda:0')\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "PaperclipBadger", "commentT": "2020-03-13T18:40:54Z", "comment_text": "\n \t\tGood catch, you can probably work around via torch.set_default_tensor_type(\"torch.cuda.FloatTensor\") for now.\n \t\t"}}}, "commit": {"commit_id": "fe3fc2ab33b30417857c1ee7ac71559319da249f", "commit_author": "Fritz Obermeyer", "commitT": "2020-03-13 13:54:41-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pyro\\distributions\\inverse_gamma.py", "file_new_name": "pyro\\distributions\\inverse_gamma.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "26,27", "deleted_lines": "26", "method_info": {"method_name": "__init__", "method_params": "self,concentration,rate,validate_args", "method_startline": "24", "method_endline": "27"}}}}}}}