{"BR": {"BR_id": "1620", "BR_author": "yukw777", "BRopenT": "2020-04-26T17:06:09Z", "BRcloseT": "2020-04-27T11:46:36Z", "BR_text": {"BRsummary": "horovod cicd tests are failing on ubuntu 18.04 python 3.6 latest", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n The failed job: <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/runs/620109522>https://github.com/PyTorchLightning/pytorch-lightning/runs/620109522</denchmark-link>\n \n We see two errors:\n \n RuntimeError: Failed to determine if NCCL support has been built. Run again with --verbose for more details.\n ImportError: /opt/hostedtoolcache/Python/3.6.10/x64/lib/python3.6/site-packages/horovod/torch/mpi_lib_v2.cpython-36m-x86_64-linux-gnu.so: undefined symbol: _ZTIN3c1021AutogradMetaInterfaceE\n \n My hunch is that both are caused by the same horovod compilation issue.\n Another thing to note is that the same tests are passing on ubuntu 18.04 python 3.6 minimal.\n <denchmark-link:https://github.com/tgaddair>@tgaddair</denchmark-link>\n  maybe you have an idea?\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n Run the cicd test suite.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "yukw777", "commentT": "2020-04-26T17:28:06Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/yukw777>@yukw777</denchmark-link>\n , I have seen this issue before.  If I remember correctly, it is related to having a corrupted pip cache.  I would suggest commenting out the step \"Cache pip\" and see if that fixes the issue.\n My suspicion is that the CI system used a cached version of Horovod, but reinstalled a new version of PyTorch.  Because Horovod is built against a specific version of PyTorch, that can lead to these incompatibilities and runtime if the PyTorch version is swapped out.\n If I remember correctly, the pip cache didn't save that much time, so it may be worth removing it.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "yukw777", "commentT": "2020-04-26T17:45:53Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Borda>@Borda</denchmark-link>\n  <denchmark-link:https://github.com/williamFalcon>@williamFalcon</denchmark-link>\n  shall I send you guys a PR that removes the pip caching step for now?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "yukw777", "commentT": "2020-04-26T19:23:40Z", "comment_text": "\n \t\tcheck <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/pull/1558>#1558</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "yukw777", "commentT": "2020-04-26T19:26:00Z", "comment_text": "\n \t\t\n My suspicion is that the CI system used a cached version of Horovod, but reinstalled a new version of PyTorch. Because Horovod is built against a specific version of PyTorch, that can lead to these incompatibilities and runtime if the PyTorch version is swapped out.\n \n that would perfectly fit our case as Horovod has been adding fro about two weeks and just last week new PyTorch was released so other cache stuck with Horovod and reinstalled only PyTorch as Horovod version hold...\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "yukw777", "commentT": "2020-04-26T19:46:42Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/pull/1558>#1558</denchmark-link>\n  should fix it for now. Currently there's no way to manually invalidate the cache, so whenever this happens again, we can add a version number to the cache key and bump that up to invalidate the old cache.\n \t\t"}}}, "commit": {"commit_id": "813e37916d9b17224be3d6c4d1672876bfb88a54", "commit_author": "J. Borovec", "commitT": "2020-04-27 15:48:58+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": ".github\\workflows\\ci-testing.yml", "file_new_name": ".github\\workflows\\ci-testing.yml", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "63,64,65,66,67,68,69,73,74,76,89,90,91,92,93,94,95,129", "deleted_lines": "66,67,68,70,71,72,73,74,75,76,77,78,114,125"}}}}}}