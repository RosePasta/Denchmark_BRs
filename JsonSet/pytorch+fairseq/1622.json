{"BR": {"BR_id": "1622", "BR_author": "erip", "BRopenT": "2020-01-15T02:21:39Z", "BRcloseT": "2020-01-24T18:30:50Z", "BR_text": {"BRsummary": "Division by zero in Windows builds", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n With the introduction of the new metrics API, there are issues with division by zero.\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n To reproduce, run the most minimal  on a Windows machine. The error is also seen in the test failures from <denchmark-link:https://github.com/pytorch/fairseq/pull/1595/checks?check_run_id=390286089>Windows CI</denchmark-link>\n \n <denchmark-h:h4>Code sample</denchmark-h>\n \n N/A\n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n There shouldn't be division by zero errors.\n <denchmark-h:h3>Environment</denchmark-h>\n \n \n fairseq Version (e.g., 1.0 or master): master\n PyTorch Version (e.g., 1.0) 1.3.1\n OS (e.g., Linux): Windows\n How you installed fairseq (pip, source): source\n Build command you used (if compiling from source): See the build script.\n Python version: 3.6.7\n CUDA/cuDNN version: N/A\n GPU models and configuration: N/A\n Any other relevant information: N/A\n \n <denchmark-h:h3>Additional context</denchmark-h>\n \n Strangely, this doesn't seem to happen in Unix builds...\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "erip", "commentT": "2020-01-18T13:38:52Z", "comment_text": "\n \t\tI suspect this has something to do with the way TimeMeter.reset is defined -- it's got a different signature than the other Meter subclass's reset. I don't know why it would be platform dependent, but maybe it's an initialization issue, too.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "erip", "commentT": "2020-01-20T15:23:27Z", "comment_text": "\n \t\tI found the immediate issue: Windows uses a 16ms precision clock, but this in not the case in unix. This can be observed by using this in both windows and unix: python -c \"import time; start=time.time(); print(time.time() - start)\"\n On Windows, this yields 0.0 consistently; on unix, it yields some tiny delta. An alternative would be to use time.perf_counter. I think there are some slightly nuanced (but likely negligible) differences in semantics -- I'll submit a PR for this and let someone smarter than me review it. \ud83d\ude04\n \t\t"}}}, "commit": {"commit_id": "f1d856e006a0fcb2b22afaad2eb456a671204557", "commit_author": "Elijah Rippeth", "commitT": "2020-01-24 10:32:20-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": ".github\\workflows\\build.yml", "file_new_name": ".github\\workflows\\build.yml", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "16", "deleted_lines": "16,18"}}}, "file_1": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": ".github\\workflows\\build_windows.yml"}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "examples\\speech_recognition\\infer.py", "file_new_name": "examples\\speech_recognition\\infer.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "189", "deleted_lines": "189", "method_info": {"method_name": "main", "method_params": "args", "method_startline": "162", "method_endline": "257"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "fairseq\\hub_utils.py", "file_new_name": "fairseq\\hub_utils.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "72", "deleted_lines": "72"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "fairseq\\meters.py", "file_new_name": "fairseq\\meters.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "145", "deleted_lines": "145", "method_info": {"method_name": "stop", "method_params": "self,n", "method_startline": "143", "method_endline": "147"}}, "hunk_1": {"Ismethod": 1, "added_lines": "121", "deleted_lines": "121", "method_info": {"method_name": "elapsed_time", "method_params": "self", "method_startline": "120", "method_endline": "121"}}, "hunk_2": {"Ismethod": 1, "added_lines": "141", "deleted_lines": "141", "method_info": {"method_name": "start", "method_params": "self", "method_startline": "140", "method_endline": "141"}}, "hunk_3": {"Ismethod": 1, "added_lines": "94", "deleted_lines": "94", "method_info": {"method_name": "reset", "method_params": "self,init,n", "method_startline": "92", "method_endline": "95"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "fairseq\\tasks\\language_modeling.py", "file_new_name": "fairseq\\tasks\\language_modeling.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "113", "deleted_lines": "113", "method_info": {"method_name": "setup_task", "method_params": "cls,args,kwargs", "method_startline": "104", "method_endline": "138"}}, "hunk_1": {"Ismethod": 1, "added_lines": "157", "deleted_lines": "157", "method_info": {"method_name": "load_dataset", "method_params": "self,split,epoch,combine,kwargs", "method_startline": "151", "method_endline": "198"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "fairseq\\tasks\\semisupervised_translation.py", "file_new_name": "fairseq\\tasks\\semisupervised_translation.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "53", "deleted_lines": "53", "method_info": {"method_name": "parse_lambda_config", "method_params": "x", "method_startline": "40", "method_endline": "57"}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "fairseq_cli\\eval_lm.py", "file_new_name": "fairseq_cli\\eval_lm.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "71", "deleted_lines": "70", "method_info": {"method_name": "main", "method_params": "parsed_args", "method_startline": "57", "method_endline": "234"}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "fairseq_cli\\generate.py", "file_new_name": "fairseq_cli\\generate.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "68", "deleted_lines": "68", "method_info": {"method_name": "_main", "method_params": "args,output_file", "method_startline": "37", "method_endline": "222"}}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "fairseq_cli\\interactive.py", "file_new_name": "fairseq_cli\\interactive.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "94", "deleted_lines": "93", "method_info": {"method_name": "main", "method_params": "args", "method_startline": "71", "method_endline": "204"}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "fairseq_cli\\train.py", "file_new_name": "fairseq_cli\\train.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "121,122,123,124,125", "deleted_lines": "120,121,122", "method_info": {"method_name": "main", "method_params": "args,init_distributed", "method_startline": "36", "method_endline": "127"}}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\speech_recognition\\asr_test_base.py", "file_new_name": "tests\\speech_recognition\\asr_test_base.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "80,86", "deleted_lines": "80,86", "method_info": {"method_name": "get_dummy_input", "method_params": "T,D,B,K", "method_startline": "70", "method_endline": "101"}}}}}}}