{"BR": {"BR_id": "441", "BR_author": "caisq", "BRopenT": "2018-06-18T03:48:18Z", "BRcloseT": "2018-06-19T19:06:37Z", "BR_text": {"BRsummary": "Loading models consisting of LSTM layers leads to incorrect prediction result", "BRdescription": "\n To get help from the community, check out our <denchmark-link:https://groups.google.com/a/tensorflow.org/forum/#!forum/tfjs>Google group</denchmark-link>\n .\n <denchmark-h:h4>TensorFlow.js version</denchmark-h>\n \n 0.11.6\n <denchmark-h:h4>Browser version</denchmark-h>\n \n Doesn't matter\n See original discussion in <denchmark-link:https://groups.google.com/a/tensorflow.org/forum/#!topic/tfjs/nM6NFw_LT3s>https://groups.google.com/a/tensorflow.org/forum/#!topic/tfjs/nM6NFw_LT3s</denchmark-link>\n \n Code for reproducing this issue:\n   const xs = tf.ones([1, 2, 3]);\n   const modelSaveLocation = 'file:///tmp/tfjs-node-model-1';\n \n   const model = tf.sequential({layers: [\n     tf.layers.lstm({units: 2, inputShape: [2, 3]})\n   ]});\n   model.predict(xs).print();\n \n   await model.save(modelSaveLocation);\n   const model2 = await tf.loadModel(modelSaveLocation + '/model.json');\n   model2.predict(xs).print();\n The output may look something like:\n <denchmark-code>Tensor\n      [[0.2161175, 0.4266523],]\n (node:234122) Warning: N-API is an experimental feature and could change at any time.\n Tensor\n      [[-0.3356292, 0.041971],]\n </denchmark-code>\n \n Interesting points:\n \n Interestingly, the topology and weight values of the loaded model all match exactly to the original model.\n The issue occurs with GRU as well.\n But this issue does not occur with SimpleRNN.\n \n \t"}, "comments": {}}, "commit": {"commit_id": "dbb121f131ad07edc8ac5a8dbd157300144c1606", "commit_author": "Shanqing Cai", "commitT": "2018-06-19 15:06:36-04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\layers\\recurrent.ts", "file_new_name": "src\\layers\\recurrent.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1847,1848,1849", "deleted_lines": null, "method_info": {"method_name": "constructor", "method_params": "LSTMCellLayerConfig", "method_startline": "1839", "method_endline": "1878"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1374,1375,1376", "deleted_lines": "1374,1375", "method_info": {"method_name": "constructor", "method_params": "GRUCellLayerConfig", "method_startline": "1366", "method_endline": "1404"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "src\\layers\\recurrent_test.ts", "file_new_name": "src\\layers\\recurrent_test.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "50,57,58,59,60,61,62,63,65,66,67,68,69,70,71,72,73,74,75,76,77,80,81,82,83", "deleted_lines": "50,57,58,59,60,61,62,63,65,66,67,68,69,70,71,72,73,74,75,76,77,80,81,82,83", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "48", "method_endline": "84"}}, "hunk_1": {"Ismethod": 1, "added_lines": "462,463", "deleted_lines": "462", "method_info": {"method_name": "tfc.ones", "method_params": "2", "method_startline": "462", "method_endline": "464"}}, "hunk_2": {"Ismethod": 1, "added_lines": "462,463", "deleted_lines": "462", "method_info": {"method_name": "K.scalarTimesArray", "method_params": "2", "method_startline": "462", "method_endline": "472"}}}}}}}