{"BR": {"BR_id": "37777", "BR_author": "shiningrain", "BRopenT": "2020-03-21T10:12:31Z", "BRcloseT": "2020-03-26T18:26:53Z", "BR_text": {"BRsummary": "It seems that Tensorflow needs a check for the unreasonable parameter `input_dim=0` in the layer `Embedding`.", "BRdescription": "\n <denchmark-h:h2>System information</denchmark-h>\n \n \n Have I written custom code (as opposed to using example directory):\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10 & Linux Ubuntu 18.04\n Tensorflow version\uff1a2.1.0-cpu (using 'pip install TensorFlow' to download directly)\n Python version: 3.6.9\n CUDA/cuDNN version: -\n GPU model and memory: -\n \n <denchmark-h:h2>Describe the current behavior</denchmark-h>\n \n When I build the model with an illogical parameter input_dim = 0in the layer Embedding, Tensorflow uses this unreasonably parameter to build and even save the model. The detailed performance in building the model is shown in the following picture\u3002\n <denchmark-link:https://user-images.githubusercontent.com/46860123/77224293-27355480-6b9f-11ea-9d96-df3e852ca4b3.png></denchmark-link>\n \n <denchmark-h:h2>Key insights</denchmark-h>\n \n To sum up, input_dim or output_dim = 0 are unreasonable corner cases. ** Tensorflow seems to lack in checking this corner case**. This may lead Tensorflow users to create and even save a wrong model, which will bring potential risks in the subsequent usage.\n <denchmark-h:h2>Code to reproduce the issue</denchmark-h>\n \n import numpy as np\n import tensorflow.keras.layers as L \n from tensorflow.keras import Model, Input\n import tensorflow\n import os\n \n print(tensorflow.__version__) \n \n kwargs = {\n     'input_dim': 0, # you can also set input_dim to 0 to test\n \t'output_dim': 18,\n \t'mask_zero': True\n }\n input = (10 * np.random.random((32,10)))\n layer = L.Embedding(**kwargs)\n x = Input(batch_shape=input.shape)\n y = layer(x)\n bk_model = Model(x, y)\n model_path = os.path.join('./', 'mode.h5')\n bk_model.save(model_path, bk_model)\n print('finish')\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "shiningrain", "commentT": "2020-03-22T20:04:17Z", "comment_text": "\n \t\tThe code you have written is not correct you are not passing any input to the model.TensorFlow creates a static graph and the checks for the correct dimension during execution\n Write you code then at the end writebk_model(input) .You will see some error this is because the dimension of your tensor is (32,10) now change 'input_dim': 0 to 'input_dim': 10 and run again,it will work.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "shiningrain", "commentT": "2020-03-23T04:25:20Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/shiningrain>@shiningrain</denchmark-link>\n \n Could you please update on the above comment\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "shiningrain", "commentT": "2020-03-24T02:42:51Z", "comment_text": "\n \t\t\n The code you have written is not correct you are not passing any input to the model.TensorFlow creates a static graph and the checks for the correct dimension during execution\n Write you code then at the end writebk_model(input) .You will see some error this is because the dimension of your tensor is (32,10) now change 'input_dim': 0 to 'input_dim': 10 and run again,it will work.\n \n Hello! Thank you for your reply!\n I have tested the code with the change you said. And when I set the  ,it did make a normal prediction.  But as I described above, \n I saw on the TensorFlow document <denchmark-link:https://www.tensorflow.org/api_docs/python/tf/keras/layers/Embedding>here</denchmark-link>\n . On this page, it mentions that the inputdim should be greater than zero, but it seems that we can still build the model with .\n I want to emphasize that , thus the corner case like can be used to build a model by TensorFlow and save a corresponding model----even if this model is just a static graph. This may confuse users.\n Additionally, adding a check for the illogical parameter is not a difficult job. As shown <denchmark-link:https://github.com/tensorflow/tensorflow/commit/1e102f63964365d82d7f22402b7ba21e0e0e64fe>here</denchmark-link>\n , Tensorflow has previously fixed a similar problem that people can build a model when using \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "shiningrain", "commentT": "2020-03-26T08:22:35Z", "comment_text": "\n \t\tClosing this since it has been fixed <denchmark-link:https://github.com/tensorflow/tensorflow/commit/1e102f63964365d82d7f22402b7ba21e0e0e64fe>here</denchmark-link>\n .\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "shiningrain", "commentT": "2020-03-26T08:22:37Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/37777>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/37777>No</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "shiningrain", "commentT": "2020-03-26T09:03:37Z", "comment_text": "\n \t\t\n Closing this since it has been fixed here.\n \n Thank you for your reply!\n I wonder if you are using a wrong <denchmark-link:https://github.com/tensorflow/tensorflow/commit/1e102f63964365d82d7f22402b7ba21e0e0e64fe>link</denchmark-link>\n in your reply, because this link is the same as the one in my comments and it is related to the conv layer, not the Embedding.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "shiningrain", "commentT": "2020-03-26T09:12:31Z", "comment_text": "\n \t\t\n \n Closing this since it has been fixed here.\n \n Thank you for your reply!\n I wonder if you are using a wrong linkin your reply, because this link is the same as the one in my comments and it is related to the conv layer, not the Embedding.\n \n Oh sorry, I meant to close another issue\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "shiningrain", "commentT": "2020-03-26T18:26:55Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/37777>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/37777>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "f61175812426009a4c96e51befb2951612990903", "commit_author": "A. Unique TensorFlower", "commitT": "2020-03-26 11:25:22-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\python\\keras\\layers\\embeddings.py", "file_new_name": "tensorflow\\python\\keras\\layers\\embeddings.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "115,116,117", "deleted_lines": null}}}}}}