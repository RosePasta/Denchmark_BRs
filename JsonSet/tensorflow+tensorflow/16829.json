{"BR": {"BR_id": "16829", "BR_author": "x10000year", "BRopenT": "2018-02-07T11:27:24Z", "BRcloseT": "2018-02-13T22:48:05Z", "BR_text": {"BRsummary": "tf.contrib.estimator.replicate_model_fn fails when a trainable variable doesn't have gradient", "BRdescription": "\n tf.contrib.estimator.replicate_model_fn fails when the gradient of a trainable variable is None. The error messages are:\n <denchmark-code>  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 302, in train\n     loss = self._train_model(input_fn, hooks, saving_listeners)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 711, in _train_model\n     features, labels, model_fn_lib.ModeKeys.TRAIN, self.config)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/estimator/estimator.py\", line 694, in _call_model_fn\n     model_fn_results = self._model_fn(features=features, **kwargs)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/estimator/python/estimator/replicate_model_fn.py\", line 235, in replicated_model_fn\n     local_ps_devices=ps_devices)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/estimator/python/estimator/replicate_model_fn.py\", line 558, in _get_loss_towers\n     **optional_params)\n   File \"model-60m-1280-2gpus-16-32-64-128-bn50000/net.py\", line 38, in model_fn\n     train_op = optimizer.minimize(model.total_loss, global_step)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/training/optimizer.py\", line 353, in minimize\n     name=name)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/estimator/python/estimator/replicate_model_fn.py\", line 317, in apply_gradients\n     with ops_lib.control_dependencies(_extract_tensors(grads_and_vars)):\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 4304, in control_dependencies\n     return get_default_graph().control_dependencies(control_inputs)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 4017, in control_dependencies\n     c = self.as_graph_element(c)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 3035, in as_graph_element\n     return self._as_graph_element_locked(obj, allow_tensor, allow_operation)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 3124, in _as_graph_element_locked\n     types_str))\n TypeError: Can not convert a NoneType into a Tensor or Operation.\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "x10000year", "commentT": "2018-02-07T19:36:32Z", "comment_text": "\n \t\tThank you for your post. We noticed you have not filled out the following field in the issue template. Could you update them if they are relevant in your case, or leave them as N/A? Thanks.\n Have I written custom code\n OS Platform and Distribution\n TensorFlow installed from\n TensorFlow version\n Bazel version\n CUDA/cuDNN version\n GPU model and memory\n Exact command to reproduce\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "x10000year", "commentT": "2018-02-12T06:38:49Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/isaprykin>@isaprykin</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "x10000year", "commentT": "2018-02-13T18:40:28Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/x10000year>@x10000year</denchmark-link>\n  Hi!  I fixed this yesterday and the fix is coming.  Thanks for reporting.\n I'll link the commit when it's available and then close the issue.  I hope you can re-built or take the nightly build to take advantage of the fix.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "x10000year", "commentT": "2018-02-25T13:34:05Z", "comment_text": "\n \t\tThank you!\n \t\t"}}}, "commit": {"commit_id": "96564330fb0508a50a0515be11c9202c64b0f5b7", "commit_author": "Igor Saprykin", "commitT": "2018-02-12 16:28:14-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\contrib\\estimator\\python\\estimator\\replicate_model_fn.py", "file_new_name": "tensorflow\\contrib\\estimator\\python\\estimator\\replicate_model_fn.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "793", "deleted_lines": "793", "method_info": {"method_name": "_extract_tensors", "method_params": "tensors_and_vars", "method_startline": "787", "method_endline": "795"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tensorflow\\contrib\\estimator\\python\\estimator\\replicate_model_fn_test.py", "file_new_name": "tensorflow\\contrib\\estimator\\python\\estimator\\replicate_model_fn_test.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "243,244,245,246,247,248,249", "deleted_lines": null, "method_info": {"method_name": "test_train_with_mean_reduction", "method_params": "self", "method_startline": "238", "method_endline": "267"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "1122,1123", "method_info": {"method_name": "test_sparse_tensor_can_be_split_unevenly_repeated_row", "method_params": "self", "method_startline": "1108", "method_endline": "1135"}}}}}}}