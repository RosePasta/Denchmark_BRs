{"BR": {"BR_id": "7543", "BR_author": "simon-mo", "BRopenT": "2020-03-10T16:52:18Z", "BRcloseT": "2020-03-10T23:27:03Z", "BR_text": {"BRsummary": "Idle ray worker uses too much memory", "BRdescription": "\n It turns out each ServerCall objects are pre-created given the max concurrency. So declarations like\n <denchmark-code>RPC_SERVICE_HANDLER(CoreWorkerService, GetCoreWorkerStats, 9999)\n </denchmark-code>\n \n will create 9999 ServerCall objects. This increase the memory consumptions in each workers.\n We actually don't need to create so many server calls since the calls are only used for \"accepting\" the request instead of of \"handling\" them.\n \t"}, "comments": {}}, "commit": {"commit_id": "119a303ea04893c0f7f898c6b29d8d89d51c6424", "commit_author": "Edward Oakes", "commitT": "2020-03-10 16:27:02-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 16, "file_old_name": "src\\ray\\rpc\\gcs_server\\gcs_rpc_server.h", "file_new_name": "src\\ray\\rpc\\gcs_server\\gcs_rpc_server.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "340,341", "deleted_lines": null, "method_info": {"method_name": "ray::rpc::StatsGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "338", "method_endline": "342"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "384,385,386", "method_info": {"method_name": "ray::rpc::ErrorInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "382", "method_endline": "387"}}, "hunk_2": {"Ismethod": 1, "added_lines": "410,411", "deleted_lines": null, "method_info": {"method_name": "ray::rpc::WorkerInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "408", "method_endline": "412"}}, "hunk_3": {"Ismethod": 1, "added_lines": "301,302,303,304,305,306", "deleted_lines": null, "method_info": {"method_name": "ray::rpc::TaskInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "299", "method_endline": "307"}}, "hunk_4": {"Ismethod": 1, "added_lines": "250,251,252,253", "deleted_lines": null, "method_info": {"method_name": "ray::rpc::ObjectInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "248", "method_endline": "254"}}, "hunk_5": {"Ismethod": 1, "added_lines": "76,77,78", "deleted_lines": "79", "method_info": {"method_name": "ray::rpc::JobInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "74", "method_endline": "79"}}, "hunk_6": {"Ismethod": 1, "added_lines": null, "deleted_lines": "256,257,258,259,260", "method_info": {"method_name": "ray::rpc::ObjectInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "254", "method_endline": "261"}}, "hunk_7": {"Ismethod": 1, "added_lines": null, "deleted_lines": "348,349,350", "method_info": {"method_name": "ray::rpc::StatsGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "346", "method_endline": "351"}}, "hunk_8": {"Ismethod": 1, "added_lines": "203,204,205,206,207,208", "deleted_lines": "205,206,207,208,209,210,211,212,213,214", "method_info": {"method_name": "ray::rpc::NodeInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "203", "method_endline": "215"}}, "hunk_9": {"Ismethod": 1, "added_lines": "132,133,134,135,136,137,138", "deleted_lines": "136,137,138,139", "method_info": {"method_name": "ray::rpc::ActorInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "130", "method_endline": "139"}}, "hunk_10": {"Ismethod": 1, "added_lines": null, "deleted_lines": "420,421,422", "method_info": {"method_name": "ray::rpc::WorkerInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "418", "method_endline": "423"}}, "hunk_11": {"Ismethod": 1, "added_lines": "200,201,202,203,204,205,206,207,208", "deleted_lines": "205,206,207,208,209", "method_info": {"method_name": "ray::rpc::NodeInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "198", "method_endline": "209"}}, "hunk_12": {"Ismethod": 1, "added_lines": "134,135,136,137,138", "deleted_lines": "136,137,138,139,140,141,142,143", "method_info": {"method_name": "ray::rpc::ActorInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "134", "method_endline": "144"}}, "hunk_13": {"Ismethod": 1, "added_lines": "77,78", "deleted_lines": "79,80,81,82", "method_info": {"method_name": "ray::rpc::JobInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "77", "method_endline": "83"}}, "hunk_14": {"Ismethod": 1, "added_lines": "375,376", "deleted_lines": null, "method_info": {"method_name": "ray::rpc::ErrorInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "373", "method_endline": "377"}}, "hunk_15": {"Ismethod": 1, "added_lines": "306", "deleted_lines": "308,309,310,311,312,313,314", "method_info": {"method_name": "ray::rpc::TaskInfoGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "306", "method_endline": "315"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\ray\\rpc\\grpc_server.cc", "file_new_name": "src\\ray\\rpc\\grpc_server.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "67,68,69", "deleted_lines": "67,68,69,70", "method_info": {"method_name": "ray::rpc::GrpcServer::Run", "method_params": "", "method_startline": "30", "method_endline": "78"}}, "hunk_1": {"Ismethod": 1, "added_lines": "84", "deleted_lines": "85", "method_info": {"method_name": "ray::rpc::GrpcServer::RegisterService", "method_params": "service", "method_startline": "80", "method_endline": "86"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\ray\\rpc\\grpc_server.h", "file_new_name": "src\\ray\\rpc\\grpc_server.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "30,36,111,112,149,153", "deleted_lines": "30,36,37,112,113,114,115,152,156,157"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\ray\\rpc\\node_manager\\node_manager_server.h", "file_new_name": "src\\ray\\rpc\\node_manager\\node_manager_server.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "89", "deleted_lines": "89,90", "method_info": {"method_name": "ray::rpc::NodeManagerGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "87", "method_endline": "92"}}, "hunk_1": {"Ismethod": 1, "added_lines": "89", "deleted_lines": "89,90", "method_info": {"method_name": "ray::rpc::NodeManagerGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "87", "method_endline": "91"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\ray\\rpc\\object_manager\\object_manager_server.h", "file_new_name": "src\\ray\\rpc\\object_manager\\object_manager_server.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "70", "deleted_lines": "70,71", "method_info": {"method_name": "ray::rpc::ObjectManagerGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "68", "method_endline": "72"}}, "hunk_1": {"Ismethod": 1, "added_lines": "70", "deleted_lines": "70,71", "method_info": {"method_name": "ray::rpc::ObjectManagerGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "68", "method_endline": "73"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\rpc\\server_call.h", "file_new_name": "src\\ray\\rpc\\server_call.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "156,157,158,159", "deleted_lines": "172,173,174", "method_info": {"method_name": "ray::rpc::ServerCallImpl::HandleRequestImpl", "method_params": "", "method_startline": "151", "method_endline": "174"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\ray\\rpc\\worker\\core_worker_server.h", "file_new_name": "src\\ray\\rpc\\worker\\core_worker_server.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "87", "deleted_lines": "87,88", "method_info": {"method_name": "ray::rpc::CoreWorkerGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories_and_concurrencies", "method_startline": "85", "method_endline": "90"}}, "hunk_1": {"Ismethod": 1, "added_lines": "87", "deleted_lines": "87,88", "method_info": {"method_name": "ray::rpc::CoreWorkerGrpcService::InitServerCallFactories", "method_params": "cq,server_call_factories", "method_startline": "85", "method_endline": "89"}}}}}}}