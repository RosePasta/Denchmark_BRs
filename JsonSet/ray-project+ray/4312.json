{"BR": {"BR_id": "4312", "BR_author": "williamma12", "BRopenT": "2019-03-08T19:05:35Z", "BRcloseT": "2019-03-24T22:49:37Z", "BR_text": {"BRsummary": "Actor resources set when during decoration instead of instantiation", "BRdescription": "\n <denchmark-h:h3>Describe the problem</denchmark-h>\n \n Actor's resources are set during decoration instead of during instantiation, which causes errors similar to <denchmark-link:https://github.com/ray-project/ray/issues/4255>#4255</denchmark-link>\n  and below.\n <denchmark-h:h3>Source code / logs</denchmark-h>\n \n <denchmark-code>import ray\n ray.init()\n \n @ray.remote\n class Actor:\n     def __init__(self):\n         x = 1\n \n     def method(self):\n         x += 1\n \n a = actor._remote([], {}, num_cpus=0.1)\n a.method.remote()\n </denchmark-code>\n \n The above code results in\n <denchmark-code>ObjectID(01000000242c0f1ad83b6cb4f21ed5d78d541556)\n 2019-03-08 10:54:51,920     ERROR worker.py:1752 -- A worker died or was killed while executing task 00000000242c0f1ad83b6cb4f21ed5d78d541556.\n 2019-03-08 10:54:51,921 ERROR worker.py:1752 -- A worker died or was killed while executing task 00000000acf22b4eb780458806ffed9e8a45b60e.\n (pid=3883) WARNING: Logging before InitGoogleLogging() is written to STDERR\n (pid=3883) F0308 10:54:51.906103 1691321792 raylet_client.cc:263]  Check failed: whole_fraction == resource_fraction\n (pid=3883) *** Check failure stack trace: ***\n (pid=3883) Fatal Python error: Aborted\n (pid=3883)\n (pid=3883) Stack (most recent call first):\n (pid=3883)   File \"/Users/William/Documents/ray/python/ray/worker.py\", line 992 in _get_next_task_from_local_scheduler\n (pid=3883)   File \"/Users/William/Documents/ray/python/ray/worker.py\", line 1009 in main_loop\n (pid=3883)   File \"/Users/William/Documents/ray/python/ray/workers/default_worker.py\", line 111 in <module>\n (pid=3886) WARNING: Logging before InitGoogleLogging() is written to STDERR\n (pid=3886) F0308 10:54:51.906775 1758442944 raylet_client.cc:263]  Check failed: whole_fraction == resource_fraction\n (pid=3886) *** Check failure stack trace: ***\n (pid=3886) Fatal Python error: Aborted\n (pid=3886)\n (pid=3886) Stack (most recent call first):\n (pid=3886)   File \"/Users/William/Documents/ray/python/ray/worker.py\", line 992 in _get_next_task_from_local_scheduler\n (pid=3886)   File \"/Users/William/Documents/ray/python/ray/worker.py\", line 1009 in main_loop\n (pid=3886)   File \"/Users/William/Documents/ray/python/ray/workers/default_worker.py\", line 111 in <module>\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "williamma12", "commentT": "2019-03-08T19:06:04Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/robertnishihara>@robertnishihara</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "11580fb7dc449c94db81feb08c47bdb5a0b84171", "commit_author": "William Ma", "commitT": "2019-03-24 15:49:36-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ci\\long_running_tests\\workloads\\many_actor_tasks.py", "file_new_name": "ci\\long_running_tests\\workloads\\many_actor_tasks.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "39,49", "deleted_lines": "39,40,41,50,51,53"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "python\\ray\\actor.py", "file_new_name": "python\\ray\\actor.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "167", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,modified_class,class_id,max_reconstructions,num_cpus,num_gpus,resources", "method_startline": "166", "method_endline": "167"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "169", "method_info": {"method_name": "__init__", "method_params": "self,modified_class,class_id,max_reconstructions,num_cpus,num_gpus,resources,actor_method_cpus", "method_startline": "168", "method_endline": "169"}}, "hunk_2": {"Ismethod": 1, "added_lines": "683,738", "deleted_lines": "723", "method_info": {"method_name": "make_actor", "method_params": "cls,num_cpus,num_gpus,resources,max_reconstructions", "method_startline": "683", "method_endline": "738"}}, "hunk_3": {"Ismethod": 1, "added_lines": null, "deleted_lines": "667,668", "method_info": {"method_name": "make_actor", "method_params": "cls,num_cpus,num_gpus,resources,actor_method_cpus,max_reconstructions", "method_startline": "667", "method_endline": "668"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\ray_constants.py", "file_new_name": "python\\ray\\ray_constants.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "28,29,30,31,32,33,34,35,36,37,38", "deleted_lines": null}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "python\\ray\\tests\\test_actor.py", "file_new_name": "python\\ray\\tests\\test_actor.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "515,516", "deleted_lines": null, "method_info": {"method_name": "test_resource_assignment.get_actor_resources", "method_params": "self", "method_startline": "515", "method_endline": "516"}}, "hunk_1": {"Ismethod": 1, "added_lines": "505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585", "deleted_lines": null, "method_info": {"method_name": "test_resource_assignment", "method_params": "shutdown_only", "method_startline": "505", "method_endline": "585"}}, "hunk_2": {"Ismethod": 1, "added_lines": "512,513", "deleted_lines": null, "method_info": {"method_name": "test_resource_assignment.__init__", "method_params": "self", "method_startline": "512", "method_endline": "513"}}, "hunk_3": {"Ismethod": 1, "added_lines": "518,519", "deleted_lines": null, "method_info": {"method_name": "test_resource_assignment.get_actor_method_resources", "method_params": "self", "method_startline": "518", "method_endline": "519"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\tests\\test_basic.py", "file_new_name": "python\\ray\\tests\\test_basic.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "810", "deleted_lines": "810", "method_info": {"method_name": "test_submit_api", "method_params": "shutdown_only", "method_startline": "809", "method_endline": "864"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\tests\\test_object_manager.py", "file_new_name": "python\\ray\\tests\\test_object_manager.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "142,143,144,145,146", "deleted_lines": "142,143", "method_info": {"method_name": "test_actor_broadcast", "method_params": "ray_start_cluster_with_resource", "method_startline": "130", "method_endline": "203"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\worker.py", "file_new_name": "python\\ray\\worker.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "2474,2475", "deleted_lines": null, "method_info": {"method_name": "decorator", "method_params": "function_or_class", "method_startline": "2454", "method_endline": "2478"}}}}}}}