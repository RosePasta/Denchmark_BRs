{"BR": {"BR_id": "18773", "BR_author": "alalek", "BRopenT": "2020-11-11T09:47:21Z", "BRcloseT": "2020-11-19T07:20:30Z", "BR_text": {"BRsummary": "G-API: sporadic failures in GAPI_Streaming_Desync.* tests", "BRdescription": "\n Observed on different configurations in nightly builds. Some of them are below:\n \n Ubuntu 20.04 + OpenVINO 2021.1 (AVX512 builder):\n \n <denchmark-code>[ RUN      ] GAPI_Streaming_Desync.UseSpecialPull\n /build/master_openvino-opencl-skx-lin64/opencv/modules/gapi/test/streaming/gapi_streaming_tests.cpp:1359: Failure\n Expected equality of these values:\n   100u\n     Which is: 100\n   num_frames\n     Which is: 99\n [  FAILED  ] GAPI_Streaming_Desync.UseSpecialPull (146 ms)\n </denchmark-code>\n \n \n Coverage:\n \n <denchmark-code>[ RUN      ] GAPI_Streaming_Desync.SmokeTest_Streaming\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/kernels.cpp (255) expandKernels Final graph: 15 nodes\n \n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/exec.cpp (636) fuseGeneral island_#0x55b98dde2490 can be merged into island_#0x55b98e38e6b0\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/exec.cpp (656) fuseGeneral merge(island_#0x55b98e38e6b0,island_#0x55b98dde2490) was successful!\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/exec.cpp (636) fuseGeneral island_#0x55b98e38e310 can be merged into island_#0x55b98de349c0\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/exec.cpp (656) fuseGeneral merge(island_#0x55b98de349c0,island_#0x55b98e38e310) was successful!\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/exec.cpp (636) fuseGeneral island_#0x55b98e38e9e0 can be merged into island_#0x55b98e3a72d0\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/exec.cpp (647) fuseGeneral merge(island_#0x55b98e3a72d0,island_#0x55b98e38e9e0) caused cycle, rolling back...\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/exec.cpp (636) fuseGeneral island_#0x55b98de34dc0 can be merged into island_#0x55b98e3a72d0\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/exec.cpp (656) fuseGeneral merge(island_#0x55b98e3a72d0,island_#0x55b98de34dc0) was successful!\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/exec.cpp (636) fuseGeneral island_#0x55b98e38e9e0 can be merged into island_#0x55b98de335f0\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/passes/exec.cpp (656) fuseGeneral merge(island_#0x55b98de335f0,island_#0x55b98e38e9e0) was successful!\n [ INFO:0] global /build/master_coverage-lin64-debug/opencv/modules/gapi/src/compiler/gcompiler.cpp (401) runPasses All compiler passes are successful\n /build/master_coverage-lin64-debug/opencv/modules/gapi/test/streaming/gapi_streaming_tests.cpp:1174: Failure\n Expected equality of these values:\n   100u\n     Which is: 100\n   out1_hits\n     Which is: 99\n Got 99 out1's and 98 out2's\n [  FAILED  ] GAPI_Streaming_Desync.SmokeTest_Streaming (5275 ms)\n </denchmark-code>\n \n \n AVX2 Clang:\n \n <denchmark-code>[ RUN      ] GAPI_Streaming_Desync.UseSpecialPull\n /build/master_opt-avx2_noICV-skl-lin64-clang/opencv/modules/gapi/test/streaming/gapi_streaming_tests.cpp:1359: Failure\n Expected equality of these values:\n   100u\n     Which is: 100\n   num_frames\n     Which is: 99\n [  FAILED  ] GAPI_Streaming_Desync.UseSpecialPull (164 ms)\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "alalek", "commentT": "2020-11-12T06:16:04Z", "comment_text": "\n \t\tThanks, will have a look on tihs\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "alalek", "commentT": "2020-11-16T18:40:34Z", "comment_text": "\n \t\tCan't reproduce locally so far, continuing investigating. <denchmark-link:https://github.com/opencv/opencv/pull/18793>#18793</denchmark-link>\n  is blocked due to this issue.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "alalek", "commentT": "2020-11-17T08:43:22Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/alalek>@alalek</denchmark-link>\n  the issue is found! Will push the solution to the same <denchmark-link:https://github.com/opencv/opencv/pull/18793>#18793</denchmark-link>\n  branch.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "alalek", "commentT": "2020-11-19T06:31:19Z", "comment_text": "\n \t\tSo does the issue still reproduce? Can the ticket be closed?\n \t\t"}}}, "commit": {"commit_id": "b866d0dc388dd9705c1171cfbbe16e7aebe1f84c", "commit_author": "Dmitry Matveev", "commitT": "2020-11-17 14:04:19+00:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "modules\\gapi\\CMakeLists.txt", "file_new_name": "modules\\gapi\\CMakeLists.txt", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "60,135,138,142,146,147", "deleted_lines": "134,137,141,145"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "modules\\gapi\\include\\opencv2\\gapi\\garg.hpp", "file_new_name": "modules\\gapi\\include\\opencv2\\gapi\\garg.hpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "145,146,147,148,149,150,151", "deleted_lines": null, "method_info": {"method_name": "cv::GAPI_EXPORTSGRunArg::GRunArg", "method_params": "t,m,type", "method_startline": "145", "method_endline": "151"}}, "hunk_1": {"Ismethod": 1, "added_lines": "152,153,154,155,156,157", "deleted_lines": null, "method_info": {"method_name": "cv::GAPI_EXPORTSGRunArg::operator =", "method_params": "t", "method_startline": "152", "method_endline": "157"}}, "hunk_2": {"Ismethod": 1, "added_lines": "137,138,139,140,141,142,143", "deleted_lines": null, "method_info": {"method_name": "cv::GAPI_EXPORTSGRunArg::GRunArg", "method_params": "t,m,type", "method_startline": "137", "method_endline": "143"}}, "hunk_3": {"Ismethod": 1, "added_lines": "158,159,160,161,162,163", "deleted_lines": null, "method_info": {"method_name": "cv::GAPI_EXPORTSGRunArg::operator =", "method_params": "t", "method_startline": "158", "method_endline": "163"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "modules\\gapi\\include\\opencv2\\gapi\\gopaque.hpp", "file_new_name": "modules\\gapi\\include\\opencv2\\gapi\\gopaque.hpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "218,219,220", "deleted_lines": null, "method_info": {"method_name": "cv::detail::OpaqueRefT::set", "method_params": "a", "method_startline": "218", "method_endline": "220"}}, "hunk_1": {"Ismethod": 1, "added_lines": "296,297,298,299,300", "deleted_lines": null, "method_info": {"method_name": "cv::detail::OpaqueRef::operator =", "method_params": "a", "method_startline": "296", "method_endline": "300"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\gapi\\include\\opencv2\\gapi\\streaming\\cap.hpp", "file_new_name": "modules\\gapi\\include\\opencv2\\gapi\\streaming\\cap.hpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "87,89,90,91,92,93,94,95,96,97,98,100,101,102,103,104,105", "deleted_lines": "83,85,86,87,88,89,91,92,94,95", "method_info": {"method_name": "cv::gapi::wip::GCaptureSource::pull", "method_params": "data", "method_startline": "79", "method_endline": "107"}}}}, "file_4": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "modules\\gapi\\include\\opencv2\\gapi\\streaming\\meta.hpp"}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "modules\\gapi\\src\\api\\gbackend.cpp", "file_new_name": "modules\\gapi\\src\\api\\gbackend.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "265,266,267,268,269,270,273,274,275,276,277,278,279,280,281", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::magazine::getArg", "method_params": "mag,ref", "method_startline": "260", "method_endline": "286"}}, "hunk_1": {"Ismethod": 1, "added_lines": "146,147,148,149,150,151,152,153,165,170,171,175,176,180,181", "deleted_lines": "161,165,169", "method_info": {"method_name": "cv::gimpl::magazine::bindInArg", "method_params": "mag,rc,arg,handleRMat", "method_startline": "134", "method_endline": "187"}}}}, "file_6": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "modules\\gapi\\src\\api\\grunarg.cpp"}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "modules\\gapi\\src\\backends\\common\\gbackend.hpp", "file_new_name": "modules\\gapi\\src\\backends\\common\\gbackend.hpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "75,76,77,78", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::magazine::Class::meta", "method_params": "", "method_startline": "75", "method_endline": "78"}}, "hunk_1": {"Ismethod": 1, "added_lines": "79,80,81,82", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::magazine::Class::meta", "method_params": "", "method_startline": "79", "method_endline": "82"}}}}, "file_8": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "modules\\gapi\\src\\backends\\common\\gmetabackend.cpp"}, "file_9": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "modules\\gapi\\src\\backends\\common\\gmetabackend.hpp"}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\gapi\\src\\compiler\\gcompiler.cpp", "file_new_name": "modules\\gapi\\src\\compiler\\gcompiler.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "62,63", "deleted_lines": "61", "method_info": {"method_name": "getKernelPackage", "method_params": "args", "method_startline": "55", "method_endline": "83"}}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\gapi\\src\\compiler\\gislandmodel.cpp", "file_new_name": "modules\\gapi\\src\\compiler\\gislandmodel.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "365,366,367,368,369,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,402,403", "deleted_lines": "360,361,364,368,369,370,371,377,378,379,390", "method_info": {"method_name": "cv::gimpl::GIslandExecutable::run", "method_params": "in,out", "method_startline": "339", "method_endline": "405"}}}}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "modules\\gapi\\src\\compiler\\gislandmodel.hpp", "file_new_name": "modules\\gapi\\src\\compiler\\gislandmodel.hpp", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "175,176,177,178", "deleted_lines": null}}}, "file_13": {"file_change_type": "MODIFY", "file_Nmethod": 9, "file_old_name": "modules\\gapi\\src\\executor\\gexecutor.cpp", "file_new_name": "modules\\gapi\\src\\executor\\gexecutor.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "268", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::GExecutor::Output::post", "method_params": "", "method_startline": "268", "method_endline": "268"}}, "hunk_1": {"Ismethod": 1, "added_lines": "267", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::GExecutor::Output::post", "method_params": "", "method_startline": "267", "method_endline": "267"}}, "hunk_2": {"Ismethod": 1, "added_lines": "269,270,271,272,273", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::GExecutor::Output::meta", "method_params": "out,m", "method_startline": "269", "method_endline": "273"}}, "hunk_3": {"Ismethod": 1, "added_lines": "164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::magazine::assignMetaStubExec", "method_params": "mag,rc,meta", "method_startline": "164", "method_endline": "180"}}, "hunk_4": {"Ismethod": 1, "added_lines": "110,111,112", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::magazine::bindInArgExec", "method_params": "mag,rc,arg", "method_startline": "94", "method_endline": "113"}}, "hunk_5": {"Ismethod": 1, "added_lines": "275,276,277,278,279", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::GExecutor::Output::Output", "method_params": "m,rcs", "method_startline": "275", "method_endline": "279"}}, "hunk_6": {"Ismethod": 1, "added_lines": "139", "deleted_lines": "134", "method_info": {"method_name": "cv::gimpl::magazine::getObjPtrExec", "method_params": "mag,rc", "method_startline": "133", "method_endline": "140"}}, "hunk_7": {"Ismethod": 1, "added_lines": "374", "deleted_lines": "333", "method_info": {"method_name": "cv::gimpl::GExecutor::run", "method_params": "args", "method_startline": "282", "method_endline": "386"}}, "hunk_8": {"Ismethod": 1, "added_lines": "260,261,262,263,264,265,266", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::GExecutor::Output::get", "method_params": "idx", "method_startline": "260", "method_endline": "266"}}}}, "file_14": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "modules\\gapi\\src\\executor\\gstreamingexecutor.cpp", "file_new_name": "modules\\gapi\\src\\executor\\gstreamingexecutor.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "777,792,793", "deleted_lines": "786,788", "method_info": {"method_name": "collectorThread", "method_params": "in_queues,in_mapping,out_size,out_queue", "method_startline": "769", "method_endline": "793"}}, "hunk_1": {"Ismethod": 1, "added_lines": "777,792,793,795,796,797,798,799", "deleted_lines": "786,788", "method_info": {"method_name": "collectorThread", "method_params": "in_queues,in_mapping,out_size,handle_stop,out_queue", "method_startline": "774", "method_endline": "804"}}, "hunk_2": {"Ismethod": 1, "added_lines": "707,708,709,710,711,712,713,714", "deleted_lines": null, "method_info": {"method_name": "StreamingOutput::meta", "method_params": "out,m", "method_startline": "707", "method_endline": "714"}}, "hunk_3": {"Ismethod": 1, "added_lines": "667,677", "deleted_lines": "669,670,680,681", "method_info": {"method_name": "StreamingOutput::post", "method_params": "argp", "method_startline": "645", "method_endline": "681"}}, "hunk_4": {"Ismethod": 1, "added_lines": "353,360,383", "deleted_lines": "353,354,361,362,385", "method_info": {"method_name": "QueueReader::getInputVector", "method_params": "in_queues,in_constants,isl_inputs", "method_startline": "331", "method_endline": "405"}}, "hunk_5": {"Ismethod": 1, "added_lines": "1277,1278,1284,1286,1287,1288,1289,1290,1291,1292", "deleted_lines": null, "method_info": {"method_name": "cv::gimpl::GStreamingExecutor::setSource", "method_params": "ins", "method_startline": "1073", "method_endline": "1295"}}}}, "file_15": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "modules\\gapi\\test\\gapi_graph_meta_tests.cpp"}}}}