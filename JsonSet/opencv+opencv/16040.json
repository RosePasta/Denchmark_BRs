{"BR": {"BR_id": "16040", "BR_author": "hanseun", "BRopenT": "2019-12-03T00:25:07Z", "BRcloseT": "2019-12-05T18:24:09Z", "BR_text": {"BRsummary": "When using solvePnPGeneric to get reprojectionError, exception occurred.", "BRdescription": "\n solvePnPGeneric work normally when reprojectionError parameter is skipped, but exception occurred reprojectionError parameter was sent to the function.\n ...\n Mat reprojectionError = new Mat(2,1,CvType.CV_64FC1);\n Calib3d.solvePnPGeneric(objectPoints, imgPointsMat, cameraMatrix, distCoeffs, rvecs, tvecs, false, Calib3d.SOLVEPNP_IPPE, rvec, tvec, reprojectionError);\n ...\n \n Environment : java\n Version : opencv 4.1.1 / opencv_contrib 4.1.1\n Log:\n \n Caused by: CvException [org.opencv.core.CvException: cv::Exception: OpenCV(4.1.1) ../modules/core/src/norm.cpp:1018: error: (-215:Assertion failed) _src1.sameSize(_src2) && _src1.type() == _src2.type() in function 'norm'\n ]\n at org.opencv.calib3d.Calib3d.solvePnPGeneric_0(Native Method)\n at org.opencv.calib3d.Calib3d.solvePnPGeneric(Calib3d.java:6641)\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "hanseun", "commentT": "2019-12-03T05:57:53Z", "comment_text": "\n \t\tPlease provide minimal complete reproducer (including some input data).\n Take a look on current Java <denchmark-link:https://github.com/opencv/opencv/blob/4.1.2/modules/calib3d/misc/java/test/Calib3dTest.java>tests</denchmark-link>\n .\n Could you try this too?\n -Mat reprojectionError = new Mat(2,1,CvType.CV_64FC1);\n +Mat reprojectionError = new Mat();\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "hanseun", "commentT": "2019-12-03T14:31:16Z", "comment_text": "\n \t\tI was testing solvePnpGeneric in Python (4.1.2) today and encountered the same error.\n Here is the code:\n import numpy as np\n import cv2\n \n obj_points = np.array([[0, 0, 0], [0, 1, 0], [1, 1, 0], [1, 0, 0]], dtype=np.float32)\n img_points = np.array(\n     [[700, 400], [700, 600], [900, 600], [900, 400]], dtype=np.float32\n )\n \n cameraMatrix = np.array(\n     [[712.0634, 0, 800], [0, 712.540, 500], [0, 0, 1]], dtype=np.float32\n )\n distCoeffs = np.array([[0, 0, 0, 0]], dtype=np.float32)\n r = np.array([], dtype=np.float32)\n x, r, t, e = cv2.solvePnPGeneric(\n     obj_points, img_points, cameraMatrix, distCoeffs, reprojectionError=r\n )\n print(e)\n print(t)\n Traceback (most recent call last):\n   File \"error.py\", line 20, in <module>\n     x, r, t, e = cv2.solvePnPGeneric(obj_points, img_points, cameraMatrix, distCoeffs, reprojectionError=r)\n cv2.error: OpenCV(4.1.2) /io/opencv/modules/core/src/norm.cpp:1081: error: (-215:Assertion failed) _src1.sameSize(_src2) && _src1.type() == _src2.type() in function 'norm'\n I can fix the error if I create img_points in this way (notice the extra array).\n img_points = np.array(\n     [[[700, 400], [700, 600], [900, 600], [900, 400]]], dtype=np.float32\n )\n Hope this can help debugging!\n \t\t"}}}, "commit": {"commit_id": "72f35e0626c2a4a87d4617ad4a8a6b1ff3b2fb09", "commit_author": "Alexander Alekhin", "commitT": "2019-12-05 15:36:39+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\calib3d\\misc\\java\\test\\Calib3dTest.java", "file_new_name": "modules\\calib3d\\misc\\java\\test\\Calib3dTest.java", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670,671,672,673,674,675,676,677,678,679,680,681,682,683,684", "deleted_lines": null, "method_info": {"method_name": "Calib3dTest::testSolvePnPGeneric_regression_16040", "method_params": "", "method_startline": "645", "method_endline": "684"}}}}, "file_1": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "modules\\calib3d\\misc\\python\\test\\test_solvepnp.py"}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\calib3d\\src\\solvepnp.cpp", "file_new_name": "modules\\calib3d\\src\\solvepnp.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "756,757,797,1018,1020,1024,1026,1028,1032,1039,1044,1048", "deleted_lines": "756,757,758,759,799,1020,1022,1026,1028,1030,1034,1041,1046,1050", "method_info": {"method_name": "cv::solvePnPGeneric", "method_params": "_opoints,_ipoints,_cameraMatrix,_distCoeffs,_rvecs,_tvecs,useExtrinsicGuess,flags,_rvec,_tvec,reprojectionError", "method_startline": "743", "method_endline": "1054"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\core\\src\\norm.cpp", "file_new_name": "modules\\core\\src\\norm.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1065,1066", "deleted_lines": "1065", "method_info": {"method_name": "cv::norm", "method_params": "_src1,_src2,normType,_mask", "method_startline": "1061", "method_endline": "1221"}}}}}}}