{"BR": {"BR_id": "2518", "BR_author": "lara-hdr", "BRopenT": "2019-12-02T22:05:19Z", "BRcloseT": "2020-01-29T23:42:44Z", "BR_text": {"BRsummary": "Unexpected Shape with ConvTranspose with Dilation !=1", "BRdescription": "\n Describe the bug\n ConvTranspose has unexpected output shape when dilation !=1.\n In the documentation:\n output_shape[i] = stride[i] * (input_size[i] - 1) + output_padding[i] + ((kernel_shape[i] - 1) * dilations[i] + 1) - pads[start_i] - pads[end_i]\n With :\n input_size = (1, 1, 50, 50)\n dilations = (3,1)\n group = 1\n kernel_shape = (3, 5)\n pads = (4, 2, 4, 2)\n strides = (2, 1)\n output_padding = (0, 0)\n The output shape is : (1, 3, 95, 50)\n But from the above formula, with i = 0 :\n output_shape = 2 * (50 - 1) + 0 + ((3 - 1) * 3 + 1) - 4 - 4 = 97 and not 95.\n So the expected output shape is : (1, 3, 97, 50)\n I attached a repro to this issue.\n System information\n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04):\n ONNX Runtime installed from (source or binary): pip\n ONNX Runtime version: ort-nightly 11/29\n Python version: 3.7.1\n \n <denchmark-link:https://github.com/microsoft/onnxruntime/files/3913495/convtranspose.zip>convtranspose.zip</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "lara-hdr", "commentT": "2019-12-10T23:29:42Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/lara-hdr>@lara-hdr</denchmark-link>\n  Can you, please, specify the urgency of the issue? This would help us to prioritize it.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "lara-hdr", "commentT": "2019-12-17T21:31:19Z", "comment_text": "\n \t\tIt seems like there is a single node test  - convtranspose_dilations and ORT passes that. I think the problem might be non-default stride (>1)+ non-default dilations (>1).\n \t\t"}}}, "commit": {"commit_id": "1239de3efec67db3de0974f86958973018743a3a", "commit_author": "Hariharan Seshadri", "commitT": "2020-01-29 15:42:43-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "onnxruntime\\core\\providers\\cpu\\nn\\conv_transpose_attributes.h", "file_new_name": "onnxruntime\\core\\providers\\cpu\\nn\\conv_transpose_attributes.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "191,213,220", "deleted_lines": "191,213,220", "method_info": {"method_name": "onnxruntime::ConvTransposeAttributes::ComputeTransposePadAndOutputShape", "method_params": "in_size,stride,kernel,dilation,adj,pad_type,pad_head,pad_tail,out_size", "method_startline": "178", "method_endline": "222"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "onnxruntime\\test\\providers\\cpu\\nn\\conv_transpose_op_test.cc", "file_new_name": "onnxruntime\\test\\providers\\cpu\\nn\\conv_transpose_op_test.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "57", "method_info": {"method_name": "onnxruntime::test::TestConvTransposeOp", "method_params": "attributes,inputs,input_shapes,expected_output,expected_output_shape,expect_result,err_str,excluded_provider_types", "method_startline": "22", "method_endline": "59"}}, "hunk_1": {"Ismethod": 1, "added_lines": "535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::test::onnxruntime::test::TEST.onnxruntime::test::onnxruntime::test::TEST.TEST.onnxruntime::test::onnxruntime::test::TEST.onnxruntime::test::onnxruntime::test::TEST.TEST.TEST.TEST", "method_params": "ConvTransposeTest,ConvTranspose_2D_NonDefaultStridesAndDilations", "method_startline": "535", "method_endline": "556"}}, "hunk_2": {"Ismethod": 1, "added_lines": "63,64,65,66,67,68,69", "deleted_lines": "64,65,66,67,68,69,70", "method_info": {"method_name": "onnxruntime::test::TEST", "method_params": "ConvTransposeTest,ConvTranspose_1D", "method_startline": "61", "method_endline": "79"}}}}}}}