{"BR": {"BR_id": "1869", "BR_author": "miso-ramen", "BRopenT": "2020-07-08T23:55:06Z", "BRcloseT": "2020-07-10T09:06:42Z", "BR_text": {"BRsummary": "Dump Annotation Error: ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\\n", "BRdescription": "\n Tried to dump annotations from a task with polygons and rectangles. I received the following error:\n Could not dump annotations for the task 2\n Error: Request failed with status code 500. \"ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\\n\".\n I don't understand where I would use a.any() or a.all()?\n <denchmark-h:h3>My actions before raising this issue</denchmark-h>\n \n \n  Read/searched the docs\n  Searched past issues\n \n <denchmark-h:h3>Expected Behaviour</denchmark-h>\n \n I expected annotations to be successfully dumped.\n <denchmark-h:h3>Current Behaviour</denchmark-h>\n \n I set up a different task (very few frames) with simple labels (both rectangles and polygons including overlaps) and the dump was successful. I'm wondering if it's unhappy with the size of the task (over 15,500 frames), or if my labeler did something weird in hiding/overlapping labels/shapes? I tried docker-compose down and docker-compose up -d and the error is always the same for this particular task.\n <denchmark-h:h3>Your Environment</denchmark-h>\n \n Docker version 19.03.12\n OS: Ubuntu 18.04 LTS\n <denchmark-h:h3>Next steps</denchmark-h>\n \n You may <denchmark-link:https://gitter.im/opencv-cvat/public>join our Gitter</denchmark-link>\n  channel for community support.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "miso-ramen", "commentT": "2020-07-09T12:03:51Z", "comment_text": "\n \t\tHi, could you provide docker logs cvat output?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "miso-ramen", "commentT": "2020-07-09T12:09:13Z", "comment_text": "\n \t\t2020-07-09 09:10:15,805 DEBG 'rqworker_default_1' stderr output:\n INFO:rq.worker:default: Job OK (65cdab24-20b4-404f-923c-d00fcefed425)\n 2020-07-09 09:10:15,806 DEBG 'rqworker_default_1' stderr output:\n INFO:rq.worker:Result is kept for 500 seconds\n 2020-07-09 09:10:15,815 DEBG 'rqworker_default_1' stderr output:\n INFO:rq.worker:Cleaning registries for queue: default\n 2020-07-09 12:00:18,851 DEBG 'runserver' stderr output:\n [Thu Jul 09 12:00:18.850947 2020] [wsgi:error] [pid 266:tid 140033706432256] [remote 172.18.0.6:39570] INFO:cvat.client:{\"client_id\":702842,\"name\":\"Send user activity\",\"username\":\"mike\",\"is_active\":true,\"payload\":{\"working_time\":14019},\"time\":\"2020-07-09T12:00:18.834000Z\"}\n 2020-07-09 12:00:30,704 DEBG 'rqworker_default_0' stderr output:\n INFO:rq.worker:default: cvat.apps.dataset_manager.views.export_task_annotations(2, 'CVAT for video 1.1', '<denchmark-link:http://localhost:8080>http://localhost:8080</denchmark-link>\n ') (/api/v1/tasks/2/annotations/CVAT for video 1.1)\n 2020-07-09 12:00:31,505 DEBG 'rqworker_default_0' stderr output:\n [2020-07-09 12:00:31,503] ERROR cvat.server.task_2: [cvat.apps.dataset_manager.views @ export_task]: exception occurred\n Traceback (most recent call last):\n File \"/home/django/cvat/apps/dataset_manager/views.py\", line 62, in export_task\n server_url=server_url, save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/task.py\", line 723, in export_task\n save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/task.py\", line 619, in export\n exporter(dst_file, task_data, **options)\n File \"/home/django/cvat/apps/dataset_manager/formats/registry.py\", line 36, in call\n f_or_cls(*args, **kwargs)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 539, in _export_video\n anno_callback=dump_as_cvat_interpolation, save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 517, in _export\n anno_callback(f, task_data)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 378, in dump_as_cvat_interpolation\n for track in annotations.tracks:\n File \"/home/django/cvat/apps/dataset_manager/bindings.py\", line 288, in tracks\n track, 0, self._db_task.data.size)\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 739, in get_interpolated_shapes\n shapes.extend(interpolate(prev_shape, shape))\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 719, in interpolate\n shapes = polyshape_interpolation(shape0, shape1)\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 692, in polyshape_interpolation\n shapes.append(copy_shape(shape0, frame, points))\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 449, in copy_shape\n if points:\n ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n 2020-07-09 12:00:31,505 DEBG 'rqworker_default_0' stderr output:\n ERROR:cvat.server.task_2:[cvat.apps.dataset_manager.views @ export_task]: exception occurred\n Traceback (most recent call last):\n File \"/home/django/cvat/apps/dataset_manager/views.py\", line 62, in export_task\n server_url=server_url, save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/task.py\", line 723, in export_task\n save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/task.py\", line 619, in export\n exporter(dst_file, task_data, **options)\n File \"/home/django/cvat/apps/dataset_manager/formats/registry.py\", line 36, in call\n f_or_cls(*args, **kwargs)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 539, in _export_video\n anno_callback=dump_as_cvat_interpolation, save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 517, in _export\n anno_callback(f, task_data)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 378, in dump_as_cvat_interpolation\n for track in annotations.tracks:\n File \"/home/django/cvat/apps/dataset_manager/bindings.py\", line 288, in tracks\n track, 0, self._db_task.data.size)\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 739, in get_interpolated_shapes\n shapes.extend(interpolate(prev_shape, shape))\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 719, in interpolate\n shapes = polyshape_interpolation(shape0, shape1)\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 692, in polyshape_interpolation\n shapes.append(copy_shape(shape0, frame, points))\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 449, in copy_shape\n if points:\n ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n 2020-07-09 12:00:31,507 DEBG 'rqworker_default_0' stderr output:\n ERROR:rq.worker:ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n Traceback (most recent call last):\n File \"/usr/local/lib/python3.5/dist-packages/rq/worker.py\", line 812, in perform_job\n rv = job.perform()\n File \"/usr/local/lib/python3.5/dist-packages/rq/job.py\", line 588, in perform\n self._result = self._execute()\n File \"/usr/local/lib/python3.5/dist-packages/rq/job.py\", line 594, in _execute\n return self.func(*self.args, **self.kwargs)\n File \"/home/django/cvat/apps/dataset_manager/views.py\", line 87, in export_task_annotations\n return export_task(task_id, dst_format, server_url=server_url, save_images=False)\n File \"/home/django/cvat/apps/dataset_manager/views.py\", line 62, in export_task\n server_url=server_url, save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/task.py\", line 723, in export_task\n save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/task.py\", line 619, in export\n exporter(dst_file, task_data, **options)\n File \"/home/django/cvat/apps/dataset_manager/formats/registry.py\", line 36, in call\n f_or_cls(*args, **kwargs)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 539, in _export_video\n anno_callback=dump_as_cvat_interpolation, save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 517, in _export\n anno_callback(f, task_data)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 378, in dump_as_cvat_interpolation\n for track in annotations.tracks:\n File \"/home/django/cvat/apps/dataset_manager/bindings.py\", line 288, in tracks\n track, 0, self._db_task.data.size)\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 739, in get_interpolated_shapes\n shapes.extend(interpolate(prev_shape, shape))\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 719, in interpolate\n shapes = polyshape_interpolation(shape0, shape1)\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 692, in polyshape_interpolation\n shapes.append(copy_shape(shape0, frame, points))\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 449, in copy_shape\n if points:\n ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n Traceback (most recent call last):\n File \"/usr/local/lib/python3.5/dist-packages/rq/worker.py\", line 812, in perform_job\n rv = job.perform()\n File \"/usr/local/lib/python3.5/dist-packages/rq/job.py\", line 588, in perform\n self._result = self._execute()\n File \"/usr/local/lib/python3.5/dist-packages/rq/job.py\", line 594, in _execute\n return self.func(*self.args, **self.kwargs)\n File \"/home/django/cvat/apps/dataset_manager/views.py\", line 87, in export_task_annotations\n return export_task(task_id, dst_format, server_url=server_url, save_images=False)\n File \"/home/django/cvat/apps/dataset_manager/views.py\", line 62, in export_task\n server_url=server_url, save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/task.py\", line 723, in export_task\n save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/task.py\", line 619, in export\n exporter(dst_file, task_data, **options)\n File \"/home/django/cvat/apps/dataset_manager/formats/registry.py\", line 36, in call\n f_or_cls(*args, **kwargs)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 539, in _export_video\n anno_callback=dump_as_cvat_interpolation, save_images=save_images)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 517, in _export\n anno_callback(f, task_data)\n File \"/home/django/cvat/apps/dataset_manager/formats/cvat.py\", line 378, in dump_as_cvat_interpolation\n for track in annotations.tracks:\n File \"/home/django/cvat/apps/dataset_manager/bindings.py\", line 288, in tracks\n track, 0, self._db_task.data.size)\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 739, in get_interpolated_shapes\n shapes.extend(interpolate(prev_shape, shape))\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 719, in interpolate\n shapes = polyshape_interpolation(shape0, shape1)\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 692, in polyshape_interpolation\n shapes.append(copy_shape(shape0, frame, points))\n File \"/home/django/cvat/apps/dataset_manager/annotation.py\", line 449, in copy_shape\n if points:\n ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n 2020-07-09 12:00:31,525 DEBG 'rqworker_default_0' stderr output:\n INFO:rq.worker:Cleaning registries for queue: default\n 2020-07-09 12:00:33,747 DEBG 'runserver' stderr output:\n [Thu Jul 09 12:00:33.747057 2020] [wsgi:error] [pid 266:tid 140033698039552] [remote 172.18.0.6:39604] [2020-07-09 12:00:33,746] ERROR django.request: Internal Server Error: /api/v1/tasks/2/annotations\n 2020-07-09 12:00:33,747 DEBG 'runserver' stderr output:\n [Thu Jul 09 12:00:33.747201 2020] [wsgi:error] [pid 266:tid 140033698039552] [remote 172.18.0.6:39604] ERROR:django.request:Internal Server Error: /api/v1/tasks/2/annotations\n \t\t"}}}, "commit": {"commit_id": "a46b9c523cd09b4428ff320675c52a10fa7ea2ef", "commit_author": "zhiltsov-max", "commitT": "2020-07-10 12:06:41+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "92", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "cvat\\apps\\dataset_manager\\annotation.py", "file_new_name": "cvat\\apps\\dataset_manager\\annotation.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "445,449", "deleted_lines": "445,449", "method_info": {"method_name": "get_interpolated_shapes", "method_params": "track,start_frame,end_frame", "method_startline": "444", "method_endline": "755"}}, "hunk_1": {"Ismethod": 1, "added_lines": "445,449", "deleted_lines": "445,449", "method_info": {"method_name": "get_interpolated_shapes.copy_shape", "method_params": "source,frame,points", "method_startline": "445", "method_endline": "451"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "cvat\\apps\\dataset_manager\\tests\\test_annotation.py", "file_new_name": "cvat\\apps\\dataset_manager\\tests\\test_annotation.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "11,39", "deleted_lines": "11", "method_info": {"method_name": "test_single_point_interpolation", "method_params": "self", "method_startline": "11", "method_endline": "39"}}, "hunk_1": {"Ismethod": 1, "added_lines": "41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69", "deleted_lines": null, "method_info": {"method_name": "test_polygon_interpolation", "method_params": "self", "method_startline": "41", "method_endline": "69"}}, "hunk_2": {"Ismethod": 1, "added_lines": "71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99", "deleted_lines": null, "method_info": {"method_name": "test_bbox_interpolation", "method_params": "self", "method_startline": "71", "method_endline": "99"}}, "hunk_3": {"Ismethod": 1, "added_lines": "101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128", "deleted_lines": null, "method_info": {"method_name": "test_line_interpolation", "method_params": "self", "method_startline": "101", "method_endline": "129"}}, "hunk_4": {"Ismethod": 1, "added_lines": "11,39", "deleted_lines": "11", "method_info": {"method_name": "test_point_interpolation", "method_params": "self", "method_startline": "11", "method_endline": "39"}}}}}}}