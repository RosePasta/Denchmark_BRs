{"BR": {"BR_id": "4281", "BR_author": "kunmingg", "BRopenT": "2019-10-11T21:20:18Z", "BRcloseT": "2019-10-30T00:34:04Z", "BR_text": {"BRsummary": "central dashboard profile creation: use dns1123 name when auto fill and check names and 2 profiles created", "BRdescription": "\n /kind bug\n On profile setup page, I got auto filled name kunming-google.com, which is not compatible with sub resources name.\n We should apply <denchmark-link:https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apimachinery/pkg/util/validation/validation.go#L110>format check</denchmark-link>\n  to profile names that either user input or we auto-fill.\n Environment:\n \n central dashboard version: v0.6.2\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "kunmingg", "commentT": "2019-10-11T21:20:33Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the labels  to this issue, with the confidence of 0.33.\n Please mark this comment with  or  to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "kunmingg", "commentT": "2019-10-11T23:50:35Z", "comment_text": "\n \t\tAnd seems auto fill will change input field after user click finish.\n It might be confusing as if user click finish again, they'll end up have 2 profiles created.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "kunmingg", "commentT": "2019-10-12T02:04:49Z", "comment_text": "\n \t\tThe 2 profiles never succeed since only 1 profile can be made by a given name. Though yes, it's a less than ideal situation sometimes\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "kunmingg", "commentT": "2019-10-12T18:23:32Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n  I observed two profiles being created. Can we fix this?\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "kunmingg", "commentT": "2019-10-14T22:23:28Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n \n I think 2 profiles being created is because after user click \"submit\", auto-fill will change the profile name, and user thought it was auto-suggestion and click again.\n So they end up have 2 created.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "kunmingg", "commentT": "2019-10-15T01:14:29Z", "comment_text": "\n \t\tOk all of these are tackled in <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4283>#4283</denchmark-link>\n \n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "kunmingg", "commentT": "2019-10-16T22:23:18Z", "comment_text": "\n \t\tnew image: gcr.io/kubeflow-dev/centraldashboard:v20191016-v0.7.0-rc.2-2-g4fdb2d1b\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "kunmingg", "commentT": "2019-10-16T23:01:54Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n \n Seems register page is not auto-redirecting to dashboard main page after profile created?\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "kunmingg", "commentT": "2019-10-16T23:11:08Z", "comment_text": "\n \t\tHey Kunming, are you sure the profile is actually created? The only way that happens is if kfam replied with a success, but the new call to fetch namespaces returns an empty list.\n I'd double-check the response you get after /api/workgroups/create and /api/env-info\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "kunmingg", "commentT": "2019-10-17T22:54:00Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n  <denchmark-link:https://github.com/prodonjs>@prodonjs</denchmark-link>\n  Is it possible to begin writing some quick and dirty tests with selenium or similar (related to <denchmark-link:https://github.com/kubeflow/testing/issues/288>kubeflow/testing#288</denchmark-link>\n )? Maybe we can just script a curl command?\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "kunmingg", "commentT": "2019-10-17T23:09:15Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/jlewi>@jlewi</denchmark-link>\n  to add some context on this. This issue only seems to happen on the first profile setup in the cluster, and the behavior being seen here is that:\n \n We hit profiles-kfam with the create call\n It replies with a success\n We query profiles, and get an empty list (perhaps it hasn't propagated yet, and profiles-kfam early replies with a success)\n Dashboard thinks profile creation failed, keeps you on registration flow. (this is expected behavior).\n \n Addendum: dashboard already has tests for this scenario via API mocks, but we expect that the API, when sending a success response, means that the network will list the profile created\n \n \n \n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "kunmingg", "commentT": "2019-10-18T01:12:22Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n  Can we make the centraldashboard code more robust? Lets assume KFam isn't immediately consistent; how can the registration flow handle that better?\n If the central dashboard just create a create call why does it immediately redirect back to the central dashboard and cause the looping behavior? Could the registration flow instead poll with some timeout to see if profiles returns non empty list before redirecting?\n <denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n  Can we automate the E2E testing though so we can begin to get an automated signal that this is working? Can we create an E2E test for KFam that calls create?\n <denchmark-link:https://github.com/kunmingg>@kunmingg</denchmark-link>\n  Can you think of any reason why KFam API wouldn't be consistent? It looks like its just calling the K8s APi\n <denchmark-link:https://github.com/kubeflow/kubeflow/blob/master/components/access-management/kfam/profiles.go>https://github.com/kubeflow/kubeflow/blob/master/components/access-management/kfam/profiles.go</denchmark-link>\n \n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "kunmingg", "commentT": "2019-10-18T15:40:14Z", "comment_text": "\n \t\tAFAIK, name is required to conform to DNS-1035.\n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "kunmingg", "commentT": "2019-10-18T22:42:40Z", "comment_text": "\n \t\tChatted with <denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n \n <denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n  and <denchmark-link:https://github.com/prodonjs>@prodonjs</denchmark-link>\n  will look into adding some kind of polling mechanism to make the centraldashboard more robust in the event the backend API is not consistent.\n ETA EOD Monday.\n \t\t"}, "comments_14": {"comment_id": 15, "comment_author": "kunmingg", "commentT": "2019-10-21T22:18:59Z", "comment_text": "\n \t\t/assign <denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n \n \t\t"}, "comments_15": {"comment_id": 16, "comment_author": "kunmingg", "commentT": "2019-10-24T04:44:48Z", "comment_text": "\n \t\tIt doesn't look like the image has been updated on the v0.7-branch\n <denchmark-link:https://github.com/kubeflow/manifests/blob/v0.7-branch/common/centraldashboard/base/kustomization.yaml>https://github.com/kubeflow/manifests/blob/v0.7-branch/common/centraldashboard/base/kustomization.yaml</denchmark-link>\n \n Nor has it been updated on master\n <denchmark-link:https://github.com/kubeflow/manifests/blob/master/common/centraldashboard/base/kustomization.yaml>https://github.com/kubeflow/manifests/blob/master/common/centraldashboard/base/kustomization.yaml</denchmark-link>\n \n \t\t"}, "comments_16": {"comment_id": 17, "comment_author": "kunmingg", "commentT": "2019-10-24T20:56:01Z", "comment_text": "\n \t\tNew image\n gcr.io/kubeflow-images-public/centraldashboard:v0.7.0-rc.5-5-g0ba828a1\n sha256:fa4ab9421b691eadaaa3a30d5ba69542f0c33e1c01da05298d0b5bd01856465b\n \t\t"}, "comments_17": {"comment_id": 18, "comment_author": "kunmingg", "commentT": "2019-10-25T02:59:40Z", "comment_text": "\n \t\tNew image based on latest fix\n gcr.io/kubeflow-images-public/centraldashboard:v0.7.0-rc.5-15-g62d91774\n sha256:bcf462b61b7f39e1479c4ac6dd0eb5a1b2504f2d2e18e325c6e8404a28f09a60\n We should update master; verify it works and then cherry pick it if it looks good.\n This should have: 4384\n \t\t"}, "comments_18": {"comment_id": 19, "comment_author": "kunmingg", "commentT": "2019-10-25T12:46:27Z", "comment_text": "\n \t\tTested on master. Everything looks good with image\n gcr.io/kubeflow-images-public/centraldashboard@sha256:bcf462b61b7f39e1479c4ac6dd0eb5a1b2504f2d2e18e325c6e8404a28f09a60\n A short screen cast to verify it works.\n <denchmark-link:https://drive.google.com/file/d/1swFa0OSk_QkQMLWAys5nyTRJBqB_z79p/view?usp=sharing>https://drive.google.com/file/d/1swFa0OSk_QkQMLWAys5nyTRJBqB_z79p/view?usp=sharing</denchmark-link>\n \n \t\t"}, "comments_19": {"comment_id": 20, "comment_author": "kunmingg", "commentT": "2019-10-30T00:07:58Z", "comment_text": "\n \t\tSeems this is fixed?\n \t\t"}, "comments_20": {"comment_id": 21, "comment_author": "kunmingg", "commentT": "2019-10-30T00:34:04Z", "comment_text": "\n \t\tLets close this.\n \t\t"}}}, "commit": {"commit_id": "4fdb2d1b7131b490b596b4da7e9bcbe10a5c2c5e", "commit_author": "Apoorv Verma [AP]", "commitT": "2019-10-16 14:54:39-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "components\\centraldashboard\\package-lock.json", "file_new_name": "components\\centraldashboard\\package-lock.json", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "4642,4643,4644,4645,4646,4647,4648,8676,8697,8717,8722,8727,8844,8877,8981,9078,9176,9181,13018,13433,13532,13537,13995,14410,14509,14514", "deleted_lines": "4642,4643,4644,4645,8673,8674,8695,8696,8702,8717,8718,8723,8724,8729,8730,8847,8848,8860,8875,8883,8884,8890,8909,8990,8991,9003,9089,9090,9126,9146,9190,9191,9196,9197,13034,13035,13450,13451,13507,13551,13552,13557,13558,14016,14017,14432,14433,14489,14533,14534,14539,14540"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "components\\centraldashboard\\public\\components\\main-page.pug", "file_new_name": "components\\centraldashboard\\public\\components\\main-page.pug", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "83", "deleted_lines": "83"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "components\\centraldashboard\\public\\components\\registration-page.js", "file_new_name": "components\\centraldashboard\\public\\components\\registration-page.js", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "90,92,94,95,96,97,98,99,100,101,102,103", "deleted_lines": null, "method_info": {"method_name": "finishSetup", "method_params": "", "method_startline": "90", "method_endline": "104"}}, "hunk_1": {"Ismethod": 1, "added_lines": "41", "deleted_lines": null, "method_info": {"method_name": "properties", "method_params": "", "method_startline": "33", "method_endline": "50"}}, "hunk_2": {"Ismethod": 1, "added_lines": "77,78,79", "deleted_lines": "78", "method_info": {"method_name": "showError", "method_params": "msg", "method_startline": "77", "method_endline": "79"}}, "hunk_3": {"Ismethod": 1, "added_lines": "81,82,83,84,85,86,87,88", "deleted_lines": null, "method_info": {"method_name": "validateNamespace", "method_params": "", "method_startline": "81", "method_endline": "88"}}, "hunk_4": {"Ismethod": 1, "added_lines": "60,61", "deleted_lines": "59", "method_info": {"method_name": "_onUserDetails", "method_params": "d", "method_startline": "57", "method_endline": "63"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "components\\centraldashboard\\public\\components\\registration-page.pug", "file_new_name": "components\\centraldashboard\\public\\components\\registration-page.pug", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "20", "deleted_lines": "20,28"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "components\\centraldashboard\\public\\components\\registration-page_test.js", "file_new_name": "components\\centraldashboard\\public\\components\\registration-page_test.js", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "20", "method_endline": "119"}}, "hunk_1": {"Ismethod": 1, "added_lines": "99", "deleted_lines": null, "method_info": {"method_name": "$e", "method_params": "", "method_startline": "99", "method_endline": "99"}}}}}}}