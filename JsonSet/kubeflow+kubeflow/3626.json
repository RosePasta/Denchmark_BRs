{"BR": {"BR_id": "3626", "BR_author": "lluunn", "BRopenT": "2019-07-09T18:45:59Z", "BRcloseT": "2019-07-17T04:52:35Z", "BR_text": {"BRsummary": "kfctl without platform not working", "BRdescription": "\n <denchmark-code>kfctl init ${KFAPP}\n cd ${KFAPP}\n kfctl generate k8s -V\n </denchmark-code>\n \n This will give error:\n ERRO[0000] Couldn't find component istio-crds filename=\"kustomize/kustomize.go:454\"\n After removed the istio components from app.yaml, the generate succeeds.\n But apply failed with:\n <denchmark-code>Error: couldn't apply KfApp:  (kubeflow.error): Code 500 with message: kfApp Apply failed for kustomize:  (kubeflow.error): Code 500 with message: couldn't create resources from /Users/lunkai/kfdev/kops-test/kf0708/kustomize/minio.yaml Error: persistentvolumes \"minio-pv\" is forbidden: error querying GCE PD volume dls-kf-storage-artifact-store: disk is not found\n </denchmark-code>\n \n See <denchmark-link:https://github.com/kubeflow/kubeflow/issues/3618>#3618</denchmark-link>\n  3618\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "lluunn", "commentT": "2019-07-09T18:46:02Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the label kind/bug to this issue, with a confidence of 0.96. Please mark this comment with \ud83d\udc4d or \ud83d\udc4e to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "lluunn", "commentT": "2019-07-09T18:54:35Z", "comment_text": "\n \t\tremove minio and mysql from components, the apply succeeded.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "lluunn", "commentT": "2019-07-11T17:58:28Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/lluunn>@lluunn</denchmark-link>\n , I'd like to say that I bumped into very similar problems while writing the  config file, which is tailored towards running on existing kubernetes clusters.\n For example, I changed minio and mysql to use a default storage class.\n Because of that, I propose using the existing_arrikto config file, with the following procedure:\n # Apply Istio\n kubectl apply -f deployment/existing/istio\n # Deploy for existing K8s\n kfctl init --config=bootstrap/config/kfctl_existing_arrikto.0.6.yaml\n kfctl generate k8s\n kfctl apply k8s\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "lluunn", "commentT": "2019-07-15T00:02:23Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/yanniszark>@yanniszark</denchmark-link>\n  see my comments in in <denchmark-link:https://github.com/kubeflow/kubeflow/pull/3627>#3627</denchmark-link>\n  about the use cases I think we want to support.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "lluunn", "commentT": "2019-07-17T11:43:54Z", "comment_text": "\n \t\tI tested the config  from the master branch (commit <denchmark-link:https://github.com/kubeflow/kubeflow/commit/d0c11dd67ebd514f4d6e584b74fecf880245a86c>d0c11dd</denchmark-link>\n ) on my Kubernetes cluster with these steps:\n <denchmark-code>kfctl init ${KFAPP} --config=bootstrap/config/kfctl_k8s_istio.yaml -V\n cd ${KFAPP}\n kfctl generate all -V\n kfctl apply all -V\n </denchmark-code>\n \n The deployment succeeded, all pods seemed to be running fine and I was able to access the dashboard. However, creation of new notebook servers got stuck to a state that to the end user looks like this:\n <denchmark-link:https://user-images.githubusercontent.com/207474/61372600-4ce7bc80-a8a0-11e9-8d66-55b9a37b3aac.png></denchmark-link>\n \n <denchmark-link:https://github.com/lluunn>@lluunn</denchmark-link>\n  I was curious if you tested notebook server creation as part of fixing this issue? If yes and if that is tested to work with latest master branch, I'll keep debugging my setup.\n As further information, I had istio injection enabled for the used namespace:\n <denchmark-code>$ kubectl get ns --show-labels | grep kubeflow\n kubeflow       Active   4h52m   istio-injection=enabled\n </denchmark-code>\n \n In the notebook-controller-deployment logs I can see something like this:\n <denchmark-code>$ kubectl logs notebook-controller-deployment-66b548f989-9ckjz -n kubeflow\n ...\n {\"level\":\"info\",\"ts\":1563346365.466873,\"logger\":\"controller\",\"msg\":\"Creating Service\",\"namespace\":\"kubeflow\",\"name\":\"nbserver\"}\n {\"level\":\"info\",\"ts\":1563346365.536583,\"logger\":\"controller\",\"msg\":\"Creating virtual service\",\"namespace\":\"kubeflow\",\"name\":\"notebook-kubeflow-nbserver\"}\n {\"level\":\"info\",\"ts\":1563346365.647643,\"logger\":\"controller\",\"msg\":\"Pod not found...\"}\n {\"level\":\"info\",\"ts\":1563346365.6479487,\"logger\":\"controller\",\"msg\":\"Updating StatefulSet\",\"namespace\":\"kubeflow\",\"name\":\"nbserver\"}\n {\"level\":\"info\",\"ts\":1563346365.6991074,\"logger\":\"controller\",\"msg\":\"Pod not found...\"}\n {\"level\":\"info\",\"ts\":1563346365.6993618,\"logger\":\"controller\",\"msg\":\"Updating StatefulSet\",\"namespace\":\"kubeflow\",\"name\":\"nbserver\"}\n {\"level\":\"info\",\"ts\":1563346365.7126508,\"logger\":\"controller\",\"msg\":\"Pod not found...\"}\n ...\n </denchmark-code>\n \n However, after that, I can't seem to find any logs that would indicate what the root cause is.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "lluunn", "commentT": "2019-07-17T14:04:57Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/lluunn>@lluunn</denchmark-link>\n  I think I found the problem now:\n <denchmark-code>create Pod nbserver-0 in StatefulSet nbserver failed error: pods \"nbserver-0\" is forbidden: error looking up service account kubeflow/default-editor: serviceaccount \"default-editor\" not found\n </denchmark-code>\n \n Those seem to be set in file components/profile-controller/pkg/controller/profile/profile_controller.go. I wonder should that be executed with the kfctl_k8s_istio config?\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "lluunn", "commentT": "2019-07-17T16:22:16Z", "comment_text": "\n \t\tPlease see this issue: <denchmark-link:https://github.com/kubeflow/kubeflow/issues/3639>#3639</denchmark-link>\n \n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "lluunn", "commentT": "2019-07-18T23:53:19Z", "comment_text": "\n \t\tminio and mysql comes from kustomize overlay. Ideally, it should use PVC and default storage class. Any reason it use a separate PV there?\n \t\t"}}}, "commit": {"commit_id": "d0c11dd67ebd514f4d6e584b74fecf880245a86c", "commit_author": "Lun-Kai Hsu", "commitT": "2019-07-16 21:52:34-07:00", "changed_files": {"file_0": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "bootstrap\\config\\kfctl_k8s_istio.yaml"}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\v2\\pkg\\kfapp\\kustomize\\kustomize.go", "file_new_name": "bootstrap\\v2\\pkg\\kfapp\\kustomize\\kustomize.go", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "725,730", "deleted_lines": null}}}}}}