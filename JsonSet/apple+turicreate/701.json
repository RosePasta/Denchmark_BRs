{"BR": {"BR_id": "701", "BR_author": "amiraeitan", "BRopenT": "2018-06-16T20:41:48Z", "BRcloseT": "2018-07-23T21:44:01Z", "BR_text": {"BRsummary": "Error reading protobuf spec. validator error: The .mlmodel supplied is of version 3, intended for a newer version of Xcode. This version of Xcode supports model version 2 or earlier.\".", "BRdescription": "\n I'm getting the above error when trying to run:\n model.export_coreml('MyCustomObjectDetector.mlmodel')\n <denchmark-code>model.export_coreml('MyCustomObjectDetector.mlmodel')\n Traceback (most recent call last):\n   File \"<stdin>\", line 1, in <module>\n   File \"/Users/amir/anaconda/envs/CVision/lib/python2.7/site-packages/turicreate/toolkits/object_detector/object_detector.py\", line 1477, in export_coreml\n     mlmodel = coremltools.models.MLModel(model)\n   File \"/Users/amir/anaconda/envs/CVision/lib/python2.7/site-packages/coremltools/models/model.py\", line 209, in __init__\n     self.__proxy__ = _get_proxy_from_spec(filename)\n   File \"/Users/amir/anaconda/envs/CVision/lib/python2.7/site-packages/coremltools/models/model.py\", line 103, in _get_proxy_from_spec\n     return _MLModelProxy(filename)\n </denchmark-code>\n \n I'm on coremltools 2.0b1\n pip 9.0.1\n turicreate 5.0b1\n python 2.7.13\n Xcode 10.0 beta\n macOS High Sierra 10.13.4\n Not sure what to do, I wish the error would be more descriptive about what one should do in order to resolve this.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "amiraeitan", "commentT": "2018-06-18T22:30:23Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/amiraeitan>@amiraeitan</denchmark-link>\n  This message means that Turi Create tried to save a model, while running on macOS 10.13, that isn't actually compatible with macOS 10.13. This seems like a bug, assuming we should be able to export object detector models that run on 10.13.\n <denchmark-link:https://github.com/gustavla>@gustavla</denchmark-link>\n  Is it expected that a 5.0b1 object detector model, when exported to Core ML, requires Xcode 10+ (macOS 10.14+)? That's the behavior we're seeing here. We should make sure the spec version is the minimum needed to execute the model (in this case probably 1 or 2?).\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "amiraeitan", "commentT": "2018-06-18T22:39:56Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/amiraeitan>@amiraeitan</denchmark-link>\n  In the meantime, you can work around this bug by setting  to . See <denchmark-link:https://apple.github.io/turicreate/docs/api/generated/turicreate.object_detector.ObjectDetector.export_coreml.html#turicreate.object_detector.ObjectDetector.export_coreml>https://apple.github.io/turicreate/docs/api/generated/turicreate.object_detector.ObjectDetector.export_coreml.html#turicreate.object_detector.ObjectDetector.export_coreml</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "amiraeitan", "commentT": "2018-06-18T23:38:01Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/znation>@znation</denchmark-link>\n  I'm a bit uncertain about this now. Linux doesn't have a runtime support for the Core ML model, but it can still export the file itself. Shouldn't this also be true for macOS 10.13 then?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "amiraeitan", "commentT": "2018-06-18T23:47:44Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/gustavla>@gustavla</denchmark-link>\n  I think the behavior we're seeing is due to the logic in coremltools, which seems intended but may not be the logic we want going forward:\n \n If on macOS, attempt to load, validate, and compile the model (so that the predict function will be available).\n If on Linux, don't do any of that, and of course there is no predict function.\n \n For this, I opened <denchmark-link:https://github.com/apple/coremltools/issues/198>apple/coremltools#198</denchmark-link>\n  to track in coremltools; when that's resolved, we can fix this issue by taking a dependency on the coremltools version that has the fix.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "amiraeitan", "commentT": "2018-06-20T02:31:56Z", "comment_text": "\n \t\tThanks guys! I've downgraded to the 4.0 version for now and the export was working fine.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "amiraeitan", "commentT": "2018-07-23T21:44:01Z", "comment_text": "\n \t\tThis should be fixed by <denchmark-link:https://github.com/apple/turicreate/pull/778>#778</denchmark-link>\n  and <denchmark-link:https://github.com/apple/coremltools/pull/207>apple/coremltools#207</denchmark-link>\n \n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "amiraeitan", "commentT": "2020-11-13T01:51:59Z", "comment_text": "\n \t\tI'm getting a similar issue: <denchmark-link:https://stackoverflow.com/questions/64814282/error-reading-protobuf-spec-validator-error>https://stackoverflow.com/questions/64814282/error-reading-protobuf-spec-validator-error</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "de6377f7b87fbc1f2ba209151eaa8740fdbe756c", "commit_author": "Shantanu Chhabra", "commitT": "2018-07-09 14:17:05-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\unity\\python\\turicreate\\toolkits\\_coreml_utils.py", "file_new_name": "src\\unity\\python\\turicreate\\toolkits\\_coreml_utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "16,18,19,29", "deleted_lines": "16,17,19,20", "method_info": {"method_name": "_get_model_metadata", "method_params": "model_class,metadata,version", "method_startline": "16", "method_endline": "29"}}, "hunk_1": {"Ismethod": 1, "added_lines": "32,33,34,35,36,37", "deleted_lines": null, "method_info": {"method_name": "_set_model_metadata", "method_params": "mlmodel,model_class,metadata,version", "method_startline": "32", "method_endline": "38"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\unity\\python\\turicreate\\toolkits\\object_detector\\object_detector.py", "file_new_name": "src\\unity\\python\\turicreate\\toolkits\\object_detector\\object_detector.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1535,1536,1537,1540,1544,1546,1547,1548,1549,1550,1551,1552,1553,1554,1555,1556,1557,1558,1559,1560,1561,1562,1563,1564,1565,1566,1567,1568,1569,1570,1571", "deleted_lines": "1534,1536,1537,1538,1541,1545,1547,1548,1549,1550,1551,1552,1553,1554,1555,1556,1557,1558,1559,1560,1561,1562,1563,1564,1565"}}}}}}