{"BR": {"BR_id": "10858", "BR_author": "aaronmarkham", "BRopenT": "2018-05-09T03:12:16Z", "BRcloseT": "2018-11-13T20:17:45Z", "BR_text": {"BRsummary": "make docs on Mac - scala docs failure", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n Making docs on a Mac is broken if you use the latest version of scala, maven, and sbt.\n <denchmark-h:h2>Minimum reproducible example</denchmark-h>\n \n On a Mac, run make docs.\n Unrelated, but this actually fails unless you do make first.\n Then you'll see you need some dependencies like in the <denchmark-link:https://github.com/apache/incubator-mxnet/blob/master/docs/build_version_doc/setup_docs_ubuntu.sh>setup_docs_ubuntu script</denchmark-link>\n  and then follow up with these to make sure you're getting the system installs for Mac (you must have Sphinx 1.5.6 just like CI):\n <denchmark-code>pip install sphinx==1.5.6\n brew install maven\n brew upgrade maven\n brew install sbt\n brew install scala\n make\n make docs\n </denchmark-code>\n \n That's pretty much what I had to do to get the docs to get even close to building on the Mac.\n But, then it will fail when it tries to move some scala docs files that don't exist.\n <denchmark-h:h2>What have you tried to solve it?</denchmark-h>\n \n I sort of solved it, but it isn't something I think I can commit because it might break what's happening in CI on Ubuntu.\n \n Remove index and package.html from mxdoc.py line 89\n Run make docs again and it's fine. Even better than fine, because the docs seem to be much more modern and usable than the current docs.\n \n <denchmark-h:h2>Comments</denchmark-h>\n \n If you get stuck building docs locally with a Mac, do what I did in step 1 above.\n I'd like to see how to upgrade the Ubuntu scaladocs in CI to what I'm seeing on the Mac. CI docker setup uses no version info when installing the scala deps, so it's not obvious at the moment. Acquiring a different version of scala deps would need to be thoroughly tested since it could break any number of other things.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "aaronmarkham", "commentT": "2018-05-10T20:32:15Z", "comment_text": "\n \t\tI compared versions.\n <denchmark-h:h1>mac</denchmark-h>\n \n maven 3.5.3\n java 1.8.0_171\n scala 2.12.6\n <denchmark-h:h1>ubuntu</denchmark-h>\n \n maven 3.3.9\n java 1.8.0_162\n scala 2.11.6\n sbt 1.1.5\n I believe the fix for this - to get Mac and Ubuntu on the same version scala, and this will fix the Mac docs build, by getting everything to work with the latest version of scala:\n \n Remove index and package.html from mxdoc.py line 89\n For CI and general Ubuntu deps, run the following:\n \n <denchmark-code>sudo apt-get remove scala-library scala\n sudo wget http://scala-lang.org/files/archive/scala-2.12.6.deb\n sudo dpkg -i scala-2.12.6.deb\n </denchmark-code>\n \n You go from 2000 and <denchmark-link:https://mxnet.incubator.apache.org/api/scala/docs/index.html#org.apache.mxnet.Accuracy>late</denchmark-link>\n .\n To 2000 and <denchmark-link:http://54.172.99.8/api/scala/docs/org/apache/mxnet/Accuracy.html>next</denchmark-link>\n .\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "aaronmarkham", "commentT": "2018-05-10T20:51:26Z", "comment_text": "\n \t\tIs adding platform check in mxdoc.py could be a solution to this for short term? I think we really need a version control for dependencies of docs, update them on a timely manner.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "aaronmarkham", "commentT": "2018-05-11T21:32:27Z", "comment_text": "\n \t\tThis will pin Scala. Sbt and Maven should be pinned too. Would need to dig further on how that would work for those. Also, even for this Scala upgrade, we'd want to see if it has any impact.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "aaronmarkham", "commentT": "2018-07-30T18:39:26Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/sandeep-krishnamurthy>@sandeep-krishnamurthy</denchmark-link>\n  I don't think this is a Doc issue. This is a bug in building docs, so I'd recommend removing Doc and Scala label and adding Bug and Build labels.\n \t\t"}}}, "commit": {"commit_id": "ea6ee0d217dcdac29fe0a22bdce019168a76a060", "commit_author": "Aaron Markham", "commitT": "2018-11-13 12:17:44-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "docs\\mxdoc.py", "file_new_name": "docs\\mxdoc.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "114,118,121", "deleted_lines": "112,118", "method_info": {"method_name": "build_scala_docs", "method_params": "app", "method_startline": "110", "method_endline": "121"}}, "hunk_1": {"Ismethod": 1, "added_lines": "143", "deleted_lines": null, "method_info": {"method_name": "build_clojure_docs", "method_params": "app", "method_startline": "135", "method_endline": "143"}}, "hunk_2": {"Ismethod": 1, "added_lines": "123,124,125,126,127,128,129,130,131,132,133", "deleted_lines": "128", "method_info": {"method_name": "build_java_docs", "method_params": "app", "method_startline": "123", "method_endline": "133"}}, "hunk_3": {"Ismethod": 1, "added_lines": "436,437,438", "deleted_lines": null, "method_info": {"method_name": "setup", "method_params": "app", "method_startline": "421", "method_endline": "451"}}, "hunk_4": {"Ismethod": 1, "added_lines": "106", "deleted_lines": null, "method_info": {"method_name": "build_scala", "method_params": "app", "method_startline": "105", "method_endline": "108"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\settings.ini", "file_new_name": "docs\\settings.ini", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "13,20,27,34,41,48,55,62,69,76,83", "deleted_lines": null}}}}}}