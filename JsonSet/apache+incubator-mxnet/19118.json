{"BR": {"BR_id": "19118", "BR_author": "sxjscience", "BRopenT": "2020-09-11T08:04:46Z", "BRcloseT": "2020-10-07T18:17:03Z", "BR_text": {"BRsummary": "[Bug][Numpy] MXNet fp16 initialization bug", "BRdescription": "\n Ignore the following reproducible and see the comment later.\n import mxnet as mx\n mx.npx.set_np()\n net = mx.gluon.nn.Dense(16, in_units=16)\n net.cast(\"float16\")\n net.initialize(ctx=mx.gpu())\n net.hybridize()\n net(mx.np.random.normal(0, 1, (16, 16), dtype=mx.np.float16, ctx=mx.gpu()))\n Error:\n <denchmark-code>MXNetError: Traceback (most recent call last):\n   File \"../src/imperative/./imperative_utils.h\", line 306\n MXNetError: Check failed: outputs[i]->dtype() == out_types[i] (2 vs. 0) : 0-th output has invalid dtype. Expecting 0 got 2 in operator _npi_uniform\n </denchmark-code>\n \n Root cause:\n \n \n \n incubator-mxnet/python/mxnet/initializer.py\n \n \n          Line 510\n       in\n       fb73de7\n \n \n \n \n \n \n  uniform_fn(-self.scale, self.scale, arr.shape, out=arr) \n \n \n \n \n \n This should be changed to uniform_fn(-self.scale, self.scale, arr.shape, dtype=arr.dtype, out=arr)\n <denchmark-link:https://github.com/mk-61>@mk-61</denchmark-link>\n  This should also be related to AMP.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "sxjscience", "commentT": "2020-09-11T13:33:57Z", "comment_text": "\n \t\tI think the following line should be added to convert the model to FP16.\n net = net.cast(\"float16\")\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "sxjscience", "commentT": "2020-09-11T17:11:53Z", "comment_text": "\n \t\tForgot to add the cast in the example. The error I met is as follows:\n import mxnet as mx\n mx.npx.set_np()\n net = mx.gluon.nn.Dense(16, in_units=16)\n net.cast(\"float16\")\n net.initialize(ctx=mx.gpu())\n net.hybridize()\n net(mx.np.random.normal(0, 1, (16, 16), dtype=mx.np.float16, ctx=mx.gpu()))\n Error:\n <denchmark-code>MXNetError: Traceback (most recent call last):\n   File \"../src/imperative/./imperative_utils.h\", line 306\n MXNetError: Check failed: outputs[i]->dtype() == out_types[i] (2 vs. 0) : 0-th output has invalid dtype. Expecting 0 got 2 in operator _npi_uniform\n </denchmark-code>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "sxjscience", "commentT": "2020-09-11T17:16:37Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/kohillyang>@kohillyang</denchmark-link>\n  Sorry that I forgot the past the  call when creating the issue, updated the code.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "sxjscience", "commentT": "2020-10-02T00:46:08Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/sxjscience>@sxjscience</denchmark-link>\n  I want to fix this issue. Please assign me. Thanks\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "sxjscience", "commentT": "2020-10-02T00:47:43Z", "comment_text": "\n \t\tThanks for the contribution <denchmark-link:https://github.com/AnshuTrivedi>@AnshuTrivedi</denchmark-link>\n  . You may try to fix the initializers and add a test case in <denchmark-link:https://github.com/apache/incubator-mxnet/blob/master/tests/python/unittest/test_numpy_gluon.py>https://github.com/apache/incubator-mxnet/blob/master/tests/python/unittest/test_numpy_gluon.py</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "sxjscience", "commentT": "2020-10-02T05:48:36Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/sxjscience>@sxjscience</denchmark-link>\n  i'm facing difficulty in <denchmark-link:https://github.com/apache/incubator-mxnet/blob/2d3ce934f8ef95940744a84c24ba389bf307bb5a/tests/python/unittest/test_numpy_gluon.py#L66>test_numpy_gluon</denchmark-link>\n .\n I think test is writen ,what changes have to make there?\n Please help me.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "sxjscience", "commentT": "2020-10-07T18:17:33Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/AnshuTrivedi>@AnshuTrivedi</denchmark-link>\n  and <denchmark-link:https://github.com/szha>@szha</denchmark-link>\n  . This is now closed.\n \t\t"}}}, "commit": {"commit_id": "c2d56dcde0c4256c91635670d49d90448865ab25", "commit_author": "Anshu Trivedi", "commitT": "2020-10-07 11:17:01-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\mxnet\\initializer.py", "file_new_name": "python\\mxnet\\initializer.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "644,647", "deleted_lines": "644,647", "method_info": {"method_name": "_init_weight", "method_params": "self,name,arr", "method_startline": "623", "method_endline": "649"}}, "hunk_1": {"Ismethod": 1, "added_lines": "510", "deleted_lines": "510", "method_info": {"method_name": "_init_weight", "method_params": "self,_,arr", "method_startline": "508", "method_endline": "510"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\python\\unittest\\test_smoke.py", "file_new_name": "tests\\python\\unittest\\test_smoke.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "70", "deleted_lines": "69", "method_info": {"method_name": "test_18934_empty_leaky_relu", "method_params": "", "method_startline": "63", "method_endline": "70"}}, "hunk_1": {"Ismethod": 1, "added_lines": "89,90,91,92,93,94", "deleted_lines": null, "method_info": {"method_name": "test_19118", "method_params": "initializer,dtype", "method_startline": "89", "method_endline": "94"}}}}}}}