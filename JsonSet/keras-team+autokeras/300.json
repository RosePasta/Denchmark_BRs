{"BR": {"BR_id": "300", "BR_author": "csteel45", "BRopenT": "2018-11-07T14:51:22Z", "BRcloseT": "2018-11-12T07:49:23Z", "BR_text": {"BRsummary": "Autokeras does not work on Windows due to fork", "BRdescription": "\n I have windows machine with CUDA 10.0, Cudnn 7.5, and Python 3.7. I have successfully installed Tensorflow 1.11 and confirmed it works with non-trivial examples.\n I installed Autokeras 0.2.19 and tried to run the example below:\n import autokeras as ak\n from keras.datasets import mnist\n if name == 'main':\n (x_train, y_train), (x_test, y_test) = mnist.load_data()\n x_train = x_train.reshape(x_train.shape + (1,))\n x_test = x_test.reshape(x_test.shape + (1,))\n <denchmark-code>clf = ak.ImageClassifier(verbose=True)\n clf.fit(x_train, y_train, time_limit=12 * 60 * 60)\n clf.final_fit(x_train, y_train, x_test, y_test, retrain=True)\n y = clf.evaluate(x_test, y_test)\n print(y)\n </denchmark-code>\n \n The following is the output:\n Using TensorFlow backend.\n Initializing search.\n Initialization finished.\n +----------------------------------------------+\n |               Training model 0               |\n +----------------------------------------------+\n Traceback (most recent call last):\n File \"akerastest.py\", line 10, in \n clf.fit(x_train, y_train, time_limit=12 * 60 * 60)\n File \"C:\\Users\\Chris\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\autokeras\\image\\image_supervised.py\", line 161, in fit\n self.cnn.fit(self.get_n_output_node(), x_train.shape, train_data, test_data, time_limit)\n File \"C:\\Users\\Chris\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\autokeras\\cnn_module.py\", line 50, in fit\n searcher.search(train_data, test_data, int(time_remain))\n File \"C:\\Users\\Chris\\Anaconda3\\envs\\tensorflow\\lib\\site-packages\\autokeras\\search.py\", line 175, in search\n ctx = mp.get_context('fork')\n File \"C:\\Users\\Chris\\Anaconda3\\envs\\tensorflow\\lib\\multiprocessing\\context.py\", line 238, in get_context\n return super().get_context(method)\n File \"C:\\Users\\Chris\\Anaconda3\\envs\\tensorflow\\lib\\multiprocessing\\context.py\", line 192, in get_context\n raise ValueError('cannot find context for %r' % method) from None\n ValueError: cannot find context for 'fork'\n It looks like Autokeras is using fork, which I believe from Googling is not supported on Windows. If this is the case, is there a work-around or is this a known limitation?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "csteel45", "commentT": "2018-11-07T14:53:07Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/tl-yang>@tl-yang</denchmark-link>\n  Would you please look into this issue?\n Thanks.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "csteel45", "commentT": "2018-11-08T00:45:49Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/csteel45>@csteel45</denchmark-link>\n  Yes, you're right, Windows doesn't support . The recent why we use  is just to be able to run it on Google Colab. So I think this issue can be easily addressed by detecting the current structure. I'll take care of it ASAP!\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "csteel45", "commentT": "2018-11-08T05:15:29Z", "comment_text": "\n \t\tGreat. Please also ensure that you address the use of virtual environments. I changed my local copy to use spawn instead of fork but I am having issues that I believe may be related to my virtualenv for tensorflow.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "csteel45", "commentT": "2018-11-08T06:24:13Z", "comment_text": "\n \t\tFinally got it working after I copied some code from a post showing how to copy the environment info over. Also, when I first ran it, I kept getting an access denied error. I found a different post that suggested that I change to the directory of the process (my virtualenv). That fixed the issue. Lastly, you need to add the NVDIA-SMI directory to your path or you get:\n 'nvidia-smi' is not recognized as an internal or external command\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "csteel45", "commentT": "2018-11-10T21:54:38Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/csteel45>@csteel45</denchmark-link>\n  , will the error cause Autokeras to crash? Or it just appear on the terminal?\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "csteel45", "commentT": "2018-11-11T02:40:29Z", "comment_text": "\n \t\tIt will crash\n \n \n \n From: tl-yang <notifications@github.com>\n Reply-To: jhfjhfj1/autokeras <reply@reply.github.com>\n Date: Saturday, November 10, 2018 at 4:54 PM\n To: jhfjhfj1/autokeras <autokeras@noreply.github.com>\n Cc: Christopher Steel <csteel@fortmoon.com>, Mention <mention@noreply.github.com>\n Subject: Re: [jhfjhfj1/autokeras] Autokeras does not work on Windows due to fork (<denchmark-link:https://github.com/keras-team/autokeras/issues/300>#300</denchmark-link>\n )\n \n \n \n Hi <denchmark-link:https://github.com/csteel45>@csteel45</denchmark-link>\n  , will the error cause Autokeras to crash? Or it just appear on the terminal?\n \n \u2014\n You are receiving this because you were mentioned.\n Reply to this email directly, view it on GitHub, or mute the thread.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "csteel45", "commentT": "2018-11-12T16:09:35Z", "comment_text": "\n \t\tSo I got i right, under Ubuntu it will work and i didnt get the fork error?\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "csteel45", "commentT": "2018-11-12T16:56:02Z", "comment_text": "\n \t\tCorrect. It doesn\u2019t work under Windows which doesn\u2019t support fork. Instead, you need to change the fork to a spawn so that it is cross-platform. The alternative is to check the OS and call fork for Unix-based systems and Spawn for Windows-based systems.\n <denchmark-link:#>\u2026</denchmark-link>\n \n \n -Chris\n \n \n \n From: Timmmeyyy <notifications@github.com>\n Reply-To: jhfjhfj1/autokeras <reply@reply.github.com>\n Date: Monday, November 12, 2018 at 11:12 AM\n To: jhfjhfj1/autokeras <autokeras@noreply.github.com>\n Cc: Christopher Steel <csteel@fortmoon.com>, Mention <mention@noreply.github.com>\n Subject: Re: [jhfjhfj1/autokeras] Autokeras does not work on Windows due to fork (#300)\n \n \n \n So I got i right, under Ubuntu it will work and i didnt get the fork error?\n \n \u2014\n You are receiving this because you were mentioned.\n Reply to this email directly, view it on GitHub, or mute the thread.\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "csteel45", "commentT": "2018-11-13T08:45:09Z", "comment_text": "\n \t\tThx for your answer chris, can you give me the changes i have to do, to get it working under windows?\n Greetz Tim\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "csteel45", "commentT": "2018-11-14T04:53:59Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/csteel45>@csteel45</denchmark-link>\n  I got the same error, could you please explain how to fix this error?\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "csteel45", "commentT": "2018-11-16T13:15:17Z", "comment_text": "\n \t\t\n @csteel45 I got the same error, could you please explain how to fix this error?\n \n <denchmark-link:https://github.com/Bjoux2>@Bjoux2</denchmark-link>\n   Sorry, I was on travel this week.\n In search.py change the line: ctx = mp.get_context('fork')\n to\n ctx = mp.get_context('spawn')\n I added some extra code to address running in a virtualenv so I don't have the exact line number.\n \t\t"}}}, "commit": {"commit_id": "85da4149f4100ca0aab1257311a277dcd2e11e9e", "commit_author": "tl-yang", "commitT": "2018-11-12 01:49:22-06:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "autokeras\\constant.py", "file_new_name": "autokeras\\constant.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "48,50,54,55,56,57,58,59", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "autokeras\\search.py", "file_new_name": "autokeras\\search.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "176,177,178,179,180,182,183,220", "deleted_lines": "175,177,178,215", "method_info": {"method_name": "search", "method_params": "self,train_data,test_data,timeout", "method_startline": "163", "method_endline": "232"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "autokeras\\utils.py", "file_new_name": "autokeras\\utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "54,55,56,57,58,59,60,61,62,63", "deleted_lines": "51,52,53,54,55,72", "method_info": {"method_name": "get_device", "method_params": "", "method_startline": "44", "method_endline": "76"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "72", "method_info": {"method_name": "temp_folder_generator", "method_params": "", "method_startline": "71", "method_endline": "76"}}, "hunk_2": {"Ismethod": 1, "added_lines": "174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191", "deleted_lines": null, "method_info": {"method_name": "get_system", "method_params": "", "method_startline": "174", "method_endline": "191"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "examples\\mnist.py", "file_new_name": "examples\\mnist.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": null, "deleted_lines": "3,6"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\common.py", "file_new_name": "tests\\common.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "287,288,289,290,291,292", "deleted_lines": null, "method_info": {"method_name": "mock_nvidia_smi_output", "method_params": "arg,kwargs", "method_startline": "287", "method_endline": "292"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\test_utils.py", "file_new_name": "tests\\test_utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "60,61,62,63,64,65,66,67,68,69,70,71,72,73", "deleted_lines": null, "method_info": {"method_name": "test_get_device", "method_params": "mock_check_output,mock_is_available", "method_startline": "60", "method_endline": "73"}}, "hunk_1": {"Ismethod": 1, "added_lines": "50,51,52,53,54,55", "deleted_lines": null, "method_info": {"method_name": "test_get_system", "method_params": "", "method_startline": "50", "method_endline": "55"}}}}}}}