{"BR": {"BR_id": "2361", "BR_author": "ansgar-t", "BRopenT": "2018-05-24T16:00:48Z", "BRcloseT": "2018-05-28T16:36:45Z", "BR_text": {"BRsummary": "displacy.render produces invalid svg by not escaping \"&lt;\"", "BRdescription": "\n <denchmark-h:h2>How to reproduce the behaviour</denchmark-h>\n \n <denchmark-code>import spacy\n from spacy import displacy\n nlp = spacy.load('de_core_news_sm')\n \n doc = nlp('eins < zwei')\n print(displacy.render(doc))\n </denchmark-code>\n \n In the resulting svg code you can see that the \"<\" is not escaped:\n <denchmark-code>...\n <text class=\"displacy-token\" fill=\"currentColor\" text-anchor=\"middle\" y=\"134.5\">\n     <tspan class=\"displacy-word\" fill=\"currentColor\" x=\"225\"><</tspan>\n     <tspan class=\"displacy-tag\" dy=\"2em\" fill=\"currentColor\" x=\"225\">CONJ</tspan>\n </text>\n ...\n </denchmark-code>\n \n <denchmark-h:h2>My Environment</denchmark-h>\n \n \n Operating System: Mac OS 10.12.6\n Python Version Used: 3.5.1\n spaCy Version Used: 2.0.11\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ansgar-t", "commentT": "2018-05-25T10:52:09Z", "comment_text": "\n \t\tThanks, good point! This should definitely be fixed. I'll also tag this issue help wanted in case someone else wants to take it on in the meantime.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ansgar-t", "commentT": "2018-05-26T13:45:39Z", "comment_text": "\n \t\tI've prepared a fix for it and am trying to test everything locally.\n However, there are some models referenced in conftest.py that are not available via the download command:\n - de_core_news_md\n - xx_ent_web_md\n Am I missing something?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "ansgar-t", "commentT": "2018-05-26T13:58:35Z", "comment_text": "\n \t\tAh, thank you so much! \ud83d\ude4f\n \n However, there are some models referenced in conftest.py that are not available via the download command:\n \n Yes, that looks like a typo and should be xx_ent_web_sm and de_core_news_sm. We probably never noticed because the model tests will skip if a model isn't installed (I admit, not the most elegant solution).\n Btw, in this case, it's also totally fine if you don't run all the model tests. You didn't edit anything that would make a difference here and the test you added only needs the tokenizer anyways.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "ansgar-t", "commentT": "2018-05-26T14:03:45Z", "comment_text": "\n \t\t\n Btw, in this case, it's also totally fine if you don't run all the model tests. You didn't edit anything that would make a difference here and the test you added only needs the tokenizer anyways.\n \n yeah, the risk seems small... :)\n But when I did run them, I saw some failures, which also appeared using the commit before my fix:\n <denchmark-code>============================================================================================= FAILURES =============================================================================================\n _______________________________________________________________________ test_issue401[en_core_web_sm-Jane's got a new car-1] _______________________________________________________________________\n \n EN = <spacy.lang.en.English object at 0x10f2c6e48>, text = \"Jane's got a new car\", i = 1\n \n     @pytest.mark.models('en')\n     @pytest.mark.parametrize('text,i', [(\"Jane's got a new car\", 1),\n                                         (\"Jane thinks that's a nice car\", 3)])\n     def test_issue401(EN, text, i):\n         \"\"\"Text that 's in contractions is not lemmatized as '.\"\"\"\n         tokens = EN(text)\n >       assert tokens[i].lemma_ != \"'\"\n E       AttributeError: 'str' object has no attribute 'lemma_'\n \n spacy/tests/regression/test_issue401.py:13: AttributeError\n __________________________________________________________________ test_issue401[en_core_web_sm-Jane thinks that's a nice car-3] ___________________________________________________________________\n \n EN = <spacy.lang.en.English object at 0x10f2c6e48>, text = \"Jane thinks that's a nice car\", i = 3\n \n     @pytest.mark.models('en')\n     @pytest.mark.parametrize('text,i', [(\"Jane's got a new car\", 1),\n                                         (\"Jane thinks that's a nice car\", 3)])\n     def test_issue401(EN, text, i):\n         \"\"\"Text that 's in contractions is not lemmatized as '.\"\"\"\n         tokens = EN(text)\n >       assert tokens[i].lemma_ != \"'\"\n E       AttributeError: 'str' object has no attribute 'lemma_'\n \n spacy/tests/regression/test_issue401.py:13: AttributeError\n ___________________________________________________________________________ test_issue686[en_core_web_sm-He is the man] ____________________________________________________________________________\n \n EN = <spacy.lang.en.English object at 0x10f2c6e48>, text = 'He is the man'\n \n     @pytest.mark.models('en')\n     @pytest.mark.parametrize('text', [\"He is the man\", \"he is the man\"])\n     def test_issue686(EN, text):\n         \"\"\"Test that pronoun lemmas are assigned correctly.\"\"\"\n         tokens = EN(text)\n >       assert tokens[0].lemma_ == \"-PRON-\"\n E       AttributeError: 'str' object has no attribute 'lemma_'\n \n spacy/tests/regression/test_issue686.py:12: AttributeError\n ___________________________________________________________________________ test_issue686[en_core_web_sm-he is the man] ____________________________________________________________________________\n \n EN = <spacy.lang.en.English object at 0x10f2c6e48>, text = 'he is the man'\n \n     @pytest.mark.models('en')\n     @pytest.mark.parametrize('text', [\"He is the man\", \"he is the man\"])\n     def test_issue686(EN, text):\n         \"\"\"Test that pronoun lemmas are assigned correctly.\"\"\"\n         tokens = EN(text)\n >       assert tokens[0].lemma_ == \"-PRON-\"\n E       AttributeError: 'str' object has no attribute 'lemma_'\n \n spacy/tests/regression/test_issue686.py:12: AttributeError\n _____________________________________________________________________ test_issue717[en_core_web_sm-You're happy-You are happy] _____________________________________________________________________\n \n EN = <spacy.lang.en.English object at 0x10f2c6e48>, text1 = \"You're happy\", text2 = 'You are happy'\n \n     @pytest.mark.models('en')\n     @pytest.mark.parametrize('text1,text2',\n         [(\"You're happy\", \"You are happy\"),\n          (\"I'm happy\", \"I am happy\"),\n          (\"he's happy\", \"he's happy\")])\n     def test_issue717(EN, text1, text2):\n         \"\"\"Test that contractions are assigned the correct lemma.\"\"\"\n         doc1 = EN(text1)\n         doc2 = EN(text2)\n >       assert doc1[1].lemma_ == doc2[1].lemma_\n E       AttributeError: 'str' object has no attribute 'lemma_'\n \n spacy/tests/regression/test_issue717.py:16: AttributeError\n ________________________________________________________________________ test_issue717[en_core_web_sm-I'm happy-I am happy] ________________________________________________________________________\n \n EN = <spacy.lang.en.English object at 0x10f2c6e48>, text1 = \"I'm happy\", text2 = 'I am happy'\n \n     @pytest.mark.models('en')\n     @pytest.mark.parametrize('text1,text2',\n         [(\"You're happy\", \"You are happy\"),\n          (\"I'm happy\", \"I am happy\"),\n          (\"he's happy\", \"he's happy\")])\n     def test_issue717(EN, text1, text2):\n         \"\"\"Test that contractions are assigned the correct lemma.\"\"\"\n         doc1 = EN(text1)\n         doc2 = EN(text2)\n >       assert doc1[1].lemma_ == doc2[1].lemma_\n E       AttributeError: 'str' object has no attribute 'lemma_'\n \n spacy/tests/regression/test_issue717.py:16: AttributeError\n _______________________________________________________________________ test_issue717[en_core_web_sm-he's happy-he's happy] ________________________________________________________________________\n \n EN = <spacy.lang.en.English object at 0x10f2c6e48>, text1 = \"he's happy\", text2 = \"he's happy\"\n \n     @pytest.mark.models('en')\n     @pytest.mark.parametrize('text1,text2',\n         [(\"You're happy\", \"You are happy\"),\n          (\"I'm happy\", \"I am happy\"),\n          (\"he's happy\", \"he's happy\")])\n     def test_issue717(EN, text1, text2):\n         \"\"\"Test that contractions are assigned the correct lemma.\"\"\"\n         doc1 = EN(text1)\n         doc2 = EN(text2)\n >       assert doc1[1].lemma_ == doc2[1].lemma_\n E       AttributeError: 'str' object has no attribute 'lemma_'\n \n spacy/tests/regression/test_issue717.py:16: AttributeError\n ________________________________________________________________________________ test_issue719[en_core_web_sm-s...] ________________________________________________________________________________\n \n EN = <spacy.lang.en.English object at 0x10f2c6e48>, text = 's...'\n \n     @pytest.mark.models('en')\n     @pytest.mark.parametrize('text', [\"s...\"])\n     def test_issue719(EN, text):\n         \"\"\"Test that the token 's' is not lemmatized into empty string.\"\"\"\n         tokens = EN(text)\n >       assert tokens[0].lemma_ != ''\n E       IndexError: string index out of range\n \n spacy/tests/regression/test_issue719.py:12: IndexError\n __________________________________________________________________________________ test_issue955[en_core_web_sm] ___________________________________________________________________________________\n \n EN = <spacy.lang.en.English object at 0x10f2c6e48>\n \n     @pytest.mark.models('en')\n     def test_issue955(EN):\n         '''Test that we don't have any nested noun chunks'''\n         doc = EN('Does flight number three fifty-four require a connecting flight'\n                  ' to get to Boston?')\n         seen_tokens = set()\n >       for np in doc.noun_chunks:\n E       AttributeError: 'str' object has no attribute 'noun_chunks'\n \n spacy/tests/regression/test_issue995.py:12: AttributeError\n =========================================================== 9 failed, 1408 passed, 132 skipped, 46 xfailed, 10 xpassed in 250.05 seconds ===========================================================\n </denchmark-code>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "ansgar-t", "commentT": "2018-05-26T16:16:20Z", "comment_text": "\n \t\tHmm, this is mysterious! \ud83e\udd14 For some reason, the EN object seems to produce strings instead of tokens... but I don't see why this would only occur with the English model in those particular cases and not with any of the others. Maybe you could open a separate issue for that so we can investigate what's going on?\n Feel free to submit the PR btw!\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "ansgar-t", "commentT": "2018-05-27T10:04:36Z", "comment_text": "\n \t\tand here's the separate issue for the failed tests: <denchmark-link:https://github.com/explosion/spaCy/issues/2379>#2379</denchmark-link>\n \n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "ansgar-t", "commentT": "2018-06-27T16:42:06Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "973298895119ed703b38630d3d7db01a0b08f1ea", "commit_author": "ansgar-t", "commitT": "2018-05-28 18:36:41+02:00", "changed_files": {"file_0": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": ".github\\contributors\\ansgar-t.md"}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "spacy\\displacy\\render.py", "file_new_name": "spacy\\displacy\\render.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "87,88", "deleted_lines": "87", "method_info": {"method_name": "render_word", "method_params": "self,text,tag,i", "method_startline": "77", "method_endline": "88"}}}}, "file_2": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "spacy\\tests\\regression\\test_issue2361.py"}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "spacy\\util.py", "file_new_name": "spacy\\util.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "593,594,595,596,597,598,599,600,601,602,603,604", "deleted_lines": null, "method_info": {"method_name": "escape_html", "method_params": "text", "method_startline": "593", "method_endline": "604"}}}}}}}