{"BR": {"BR_id": "725", "BR_author": "jinserk", "BRopenT": "2018-01-30T20:56:26Z", "BRcloseT": "2018-01-31T02:36:19Z", "BR_text": {"BRsummary": "NotImplementedError in examples/ss_vae_M2.py", "BRdescription": "\n Hi,\n I had no error before, but after recent update I got an error when run ss_vae_M2.py as:\n <denchmark-code>$ python ss_vae_M2.py -enum\n Traceback (most recent call last):\n   File \"ss_vae_M2.py\", line 464, in <module>\n     run_inference_ss_vae(args)\n   File \"ss_vae_M2.py\", line 371, in run_inference_ss_vae\n     run_inference_for_epoch(data_loaders, losses, periodic_interval_batches)\n   File \"ss_vae_M2.py\", line 268, in run_inference_for_epoch\n     new_loss = losses[loss_id].step(xs)\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/infer/svi.py\", line 98, in step\n     loss = self.loss_and_grads(self.model, self.guide, *args, **kwargs)\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/infer/elbo.py\", line 65, in loss_and_grads\n     return self.which_elbo.loss_and_grads(model, guide, *args, **kwargs)\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/infer/trace_elbo.py\", line 146, in loss_and_grads\n     for weight, model_trace, guide_trace, log_r in self._get_traces(model, guide, *args, **kwargs):\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/infer/trace_elbo.py\", line 79, in _get_traces\n     check_enum_discrete_can_run(model_trace, guide_trace)\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/infer/trace_elbo.py\", line 45, in check_enum_discrete_can_run\n     for shape, (source, name) in sorted(shapes.items())])))\n NotImplementedError: enum_discrete does not support mixture of batched and un-batched variables. Try rewriting your model to avoid batching or running with enum_discrete=False. Found the following variables of different batch shapes:\n guide y: shape = (200,)\n guide z: shape = (200, 50)\n model x: shape = (200, 784)\n </denchmark-code>\n \n with -enum option. What to do to avoid this?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jinserk", "commentT": "2018-01-30T21:15:19Z", "comment_text": "\n \t\tHi, what version of PyTorch are you using?  Did you install Pyro from pip or from GitHub?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jinserk", "commentT": "2018-01-30T21:25:46Z", "comment_text": "\n \t\tI'm using Pytorch 0.4.0a0+5b43c22 and Pyro 0.1.2+4d4ffbc. I've installed them both from each repo.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "jinserk", "commentT": "2018-01-30T21:47:49Z", "comment_text": "\n \t\tPre-release Pyro and PyTorch are both somewhat unstable at the moment due to the ongoing work on .  This looks like a bug in  caused by the new broadcasting semantics in  (cc <denchmark-link:https://github.com/fritzo>@fritzo</denchmark-link>\n ).  For now, I'd suggest using the  branch of Pyro and the current release of PyTorch.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "jinserk", "commentT": "2018-01-31T00:25:46Z", "comment_text": "\n \t\tThanks for the detailed bug report, <denchmark-link:https://github.com/jinserk>@jinserk</denchmark-link>\n ! This should be fixed by <denchmark-link:https://github.com/pyro-ppl/pyro/pull/728>#728</denchmark-link>\n \n You're welcome to use Pyro dev if you are up for and adventure. We certainly appreciate your help finding bugs as we refactor to use PyTorch distributions.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "jinserk", "commentT": "2018-01-31T14:44:38Z", "comment_text": "\n \t\tThank you for such quick fix, <denchmark-link:https://github.com/eb8680>@eb8680</denchmark-link>\n  and <denchmark-link:https://github.com/fritzo>@fritzo</denchmark-link>\n !\n By the way, I have another error if  is on:\n <denchmark-code>Traceback (most recent call last):\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/poutine/trace.py\", line 81, in log_pdf\n     site_log_p = site[\"log_pdf\"]\n KeyError: 'log_pdf'\n \n During handling of the above exception, another exception occurred:\n \n Traceback (most recent call last):\n   File \"ss_vae_M2.py\", line 453, in <module>\n     run_inference_ss_vae(args)\n   File \"ss_vae_M2.py\", line 360, in run_inference_ss_vae\n     run_inference_for_epoch(data_loaders, losses, periodic_interval_batches)\n   File \"ss_vae_M2.py\", line 254, in run_inference_for_epoch\n     new_loss = losses[loss_id].step(xs, ys)\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/infer/svi.py\", line 98, in step\n     loss = self.loss_and_grads(self.model, self.guide, *args, **kwargs)\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/infer/elbo.py\", line 65, in loss_and_grads\n     return self.which_elbo.loss_and_grads(model, guide, *args, **kwargs)\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/infer/trace_elbo.py\", line 146, in loss_and_grads\n     for weight, model_trace, guide_trace, log_r in self._get_traces(model, guide, *args, **kwargs):\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/infer/trace_elbo.py\", line 95, in _get_traces\n     log_r = model_trace.log_pdf() - guide_trace.log_pdf()\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/poutine/trace.py\", line 85, in log_pdf\n     site[\"value\"], *args, **kwargs).sum() * site[\"scale\"]\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/distributions/random_primitive.py\", line 52, in log_prob\n     return self.dist_class(*args, **kwargs).log_prob(x)\n   File \"/home/jbaik/.pyenv/versions/3.6.4/lib/python3.6/site-packages/pyro_ppl-0.1.2-py3.6.egg/pyro/distributions/torch_wrapper.py\", line 48, in log_prob\n     assert len(self.log_pdf_mask.size()) <= len(log_prob.size())\n AttributeError: 'int' object has no attribute 'size'\n </denchmark-code>\n \n Could you take a look for this too?\n \t\t"}}}, "commit": {"commit_id": "29a6bd878cca4f310fd52a9b8b972fbed8189118", "commit_author": "Fritz Obermeyer", "commitT": "2018-01-30 18:36:18-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "examples\\ss_vae_M2.py", "file_new_name": "examples\\ss_vae_M2.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "112,127", "deleted_lines": "122", "method_info": {"method_name": "model", "method_params": "self,xs,ys", "method_startline": "90", "method_endline": "127"}}, "hunk_1": {"Ismethod": 1, "added_lines": "154", "deleted_lines": "137", "method_info": {"method_name": "guide", "method_params": "self,xs,ys", "method_startline": "129", "method_endline": "154"}}, "hunk_2": {"Ismethod": 1, "added_lines": "207,211", "deleted_lines": null, "method_info": {"method_name": "model_sample", "method_params": "self,ys,batch_size", "method_startline": "203", "method_endline": "212"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\test_examples.py", "file_new_name": "tests\\test_examples.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "33,34,35,37,38,39", "deleted_lines": "34,36", "method_info": {"method_name": "discover_examples", "method_params": "", "method_startline": "15", "method_endline": "39"}}, "hunk_1": {"Ismethod": 1, "added_lines": "45,46", "deleted_lines": null, "method_info": {"method_name": "make_ids", "method_params": "examples", "method_startline": "45", "method_endline": "46"}}}}}}}