{"BR": {"BR_id": "2122", "BR_author": "fritzo", "BRopenT": "2019-11-06T05:48:26Z", "BRcloseT": "2019-11-06T18:09:00Z", "BR_text": {"BRsummary": "Predictive class fails for non-scalar sites", "BRdescription": "\n I usually use raw poutines to for prediction:\n vectorize = pyro.plate(\"_vectorize\", num_samples, dim=-2)\n trace = poutine.trace(vectorize(guide)).get_trace()\n samples = poutine.replay(vectorize(model), trace)()\n When instead I try the new Predictive class, this fails on models with nontrivial plate structure:\n predictive = Predictive(model, guide=guide, return_sites=[\"x\", \"y\"],\n                         num_samples=num_samples, parallel=True)\n samples = predictive.get_samples()\n I believe this is due to reshaping of posterior samples without regard to their event shape. I don't know why _predictive() even needs to reshape samples.\n I have added a failing test in this branch. Feel free to take over the branch and create a PR:\n <denchmark-link:https://github.com/pyro-ppl/pyro/pull/new/fix-preditive-shapes>https://github.com/pyro-ppl/pyro/pull/new/fix-preditive-shapes</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "fritzo", "commentT": "2019-11-06T06:08:33Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/fehiepsi>@fehiepsi</denchmark-link>\n  let me know if you need more failing examples, this came up in an uber internal model.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "fritzo", "commentT": "2019-11-06T16:04:22Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/fritzo>@fritzo</denchmark-link>\n  Sure, more failing examples would be helpful! I'll also test some related cases which I can think about.\n \t\t"}}}, "commit": {"commit_id": "e5073c19e6ea7370c609771f222fb8bac8117745", "commit_author": "Du Phan", "commitT": "2019-11-06 10:08:59-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pyro\\infer\\predictive.py", "file_new_name": "pyro\\infer\\predictive.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "31", "deleted_lines": "31", "method_info": {"method_name": "_predictive_sequential", "method_params": "model,posterior_samples,model_args,model_kwargs,num_samples,sample_sites,return_trace", "method_startline": "30", "method_endline": "31"}}, "hunk_1": {"Ismethod": 1, "added_lines": "31", "deleted_lines": "31", "method_info": {"method_name": "_predictive_sequential", "method_params": "model,posterior_samples,model_args,model_kwargs,num_samples,return_site_shapes,return_trace", "method_startline": "30", "method_endline": "31"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\infer\\test_predictive.py", "file_new_name": "tests\\infer\\test_predictive.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121", "deleted_lines": null, "method_info": {"method_name": "test_shapes", "method_params": "parallel", "method_startline": "98", "method_endline": "121"}}, "hunk_1": {"Ismethod": 1, "added_lines": "101,102,103,104,105,106", "deleted_lines": null, "method_info": {"method_name": "test_shapes.model", "method_params": "", "method_startline": "101", "method_endline": "106"}}}}}}}