{"BR": {"BR_id": "1244", "BR_author": "Nic-Ma", "BRopenT": "2020-11-17T02:56:58Z", "BRcloseT": "2020-11-18T18:54:07Z", "BR_text": {"BRsummary": "Issues with compute_confusion_matrix metric", "BRdescription": "\n Describe the bug\n There are 2 minor issues in compute_confusion_matrix metric:\n \n If reduction mode is SUMBATCH, should not do SUM on not_nans, otherwise we don't know which class is nan when computing the final result.\n If compute_sample is False, should return the confusion matrix elements of current batch directly, then compute the final metric value for the whole epoch. Current implementation computes metric for every batch, if batch size changed, the metric value will be different.\n So in summary, should have 2 modes:\n (1) Compute metric for every sample image first, then average or sum the whole epoch to get the final result.\n (2) Keep the confusion matrix elements of every image, then average or sum the whole epoch, then compute metric.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Nic-Ma", "commentT": "2020-11-17T02:57:26Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/yiheng-wang-nv>@yiheng-wang-nv</denchmark-link>\n  ,\n Could you please help fix this issue as we discussed?\n Thanks in advance.\n \t\t"}}}, "commit": {"commit_id": "5ccfe7e58f25de7c1fb0c48c00dd2206bd2981ad", "commit_author": "Yiheng Wang", "commitT": "2020-11-18 18:54:06+00:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "monai\\handlers\\confusion_matrix.py", "file_new_name": "monai\\handlers\\confusion_matrix.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "97,98,99,100,101,102,103,104,105,106,107,108,109,110", "deleted_lines": "89,90,91,92,93,94,95,96,97,103,104,105", "method_info": {"method_name": "update", "method_params": "self", "method_startline": "85", "method_endline": "110"}}, "hunk_1": {"Ismethod": 1, "added_lines": "35", "deleted_lines": "34,35", "method_info": {"method_name": "__init__", "method_params": "self,bool,str,bool,bool,Callable,None", "method_startline": "30", "method_endline": "37"}}, "hunk_2": {"Ismethod": 1, "added_lines": "79,80,81,82", "deleted_lines": null, "method_info": {"method_name": "reset", "method_params": "self", "method_startline": "76", "method_endline": "82"}}, "hunk_3": {"Ismethod": 1, "added_lines": "35", "deleted_lines": "34,35", "method_info": {"method_name": "__init__", "method_params": "self,bool,str,bool,Callable,None", "method_startline": "31", "method_endline": "37"}}, "hunk_4": {"Ismethod": 1, "added_lines": "113,119,120,121,122,123,124,125,126,127", "deleted_lines": null, "method_info": {"method_name": "compute", "method_params": "self", "method_startline": "113", "method_endline": "127"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "monai\\metrics\\__init__.py", "file_new_name": "monai\\metrics\\__init__.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "12", "deleted_lines": "12"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "monai\\metrics\\confusion_matrix.py", "file_new_name": "monai\\metrics\\confusion_matrix.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "59,61", "deleted_lines": "60", "method_info": {"method_name": "__init__", "method_params": "self,bool,bool,MetricReduction,MEAN", "method_startline": "56", "method_endline": "61"}}, "hunk_1": {"Ismethod": 1, "added_lines": "49,50,51,52", "deleted_lines": "52,54", "method_info": {"method_name": "__init__", "method_params": "self,bool,str,bool,bool", "method_startline": "49", "method_endline": "54"}}, "hunk_2": {"Ismethod": 1, "added_lines": "101,102,103,104,106,107,108,109,110,111,112,113,114,116", "deleted_lines": "94,95,96,98,100,101,102,103,104,105,106,107,108,109", "method_info": {"method_name": "__call__", "method_params": "self,Tensor,Tensor", "method_startline": "69", "method_endline": "116"}}, "hunk_3": {"Ismethod": 1, "added_lines": "211,229,230,238,239,247,248,252,253,257,258,266", "deleted_lines": "222,223,231,232,240,241,245,246,250,251,259", "method_info": {"method_name": "compute_confusion_matrix_metric", "method_params": "str,Tensor", "method_startline": "174", "method_endline": "269"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\min_tests.py", "file_new_name": "tests\\min_tests.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "40,41", "deleted_lines": "96", "method_info": {"method_name": "run_testsuit", "method_params": "", "method_startline": "18", "method_endline": "111"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 7, "file_old_name": "tests\\test_compute_confusion_matrix.py", "file_new_name": "tests\\test_compute_confusion_matrix.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "228", "deleted_lines": "221,222,223,224,225,226,227,228", "method_info": {"method_name": "test_compute_sample", "method_params": "self,input_data,expected_value", "method_startline": "221", "method_endline": "228"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "284,290,291", "method_info": {"method_name": "test_no_compute_sample", "method_params": "self,input_data,expected_value", "method_startline": "284", "method_endline": "291"}}, "hunk_2": {"Ismethod": 1, "added_lines": "255,261,262", "deleted_lines": "255,256,257,258,259", "method_info": {"method_name": "test_clf_with_nan", "method_params": "self,input_data,expected_value", "method_startline": "255", "method_endline": "262"}}, "hunk_3": {"Ismethod": 1, "added_lines": "215,218", "deleted_lines": "211,212,213,214,215,216,217,218", "method_info": {"method_name": "test_value", "method_params": "self,input_data,expected_value", "method_startline": "211", "method_endline": "218"}}, "hunk_4": {"Ismethod": 1, "added_lines": "251,252", "deleted_lines": "244,245,246,247,248,249,250,251,252", "method_info": {"method_name": "test_compute_sample_with_nan", "method_params": "self,input_data,expected_value,expected_not_nans", "method_startline": "244", "method_endline": "252"}}, "hunk_5": {"Ismethod": 1, "added_lines": "231,237,238,239,240,241", "deleted_lines": "232,233,234,235,236,237,238,240,241", "method_info": {"method_name": "test_compute_sample_multiple_metrics", "method_params": "self,input_data,expected_values", "method_startline": "231", "method_endline": "241"}}, "hunk_6": {"Ismethod": 1, "added_lines": null, "deleted_lines": "305,311,312,313", "method_info": {"method_name": "test_clf_with_nan", "method_params": "self,input_data,expected_value,expected_not_nans", "method_startline": "305", "method_endline": "313"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\test_handler_confusion_matrix.py", "file_new_name": "tests\\test_handler_confusion_matrix.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "74,75,76,77,78,79,80,81,82,83,84,85,86,87,88", "deleted_lines": null, "method_info": {"method_name": "test_compute_seg", "method_params": "self,input_params,expected_avg", "method_startline": "74", "method_endline": "88"}}}}, "file_6": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\test_handler_confusion_matrix_dist.py"}}}}