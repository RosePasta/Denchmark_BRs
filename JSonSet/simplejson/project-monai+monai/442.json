{"BR": {"BR_id": "442", "BR_author": "wyli", "BRopenT": "2020-05-27T12:28:30Z", "BRcloseT": "2020-05-28T12:05:00Z", "BR_text": {"BRsummary": "model checkpoint saver/loader dictionary", "BRdescription": "\n Describe the bug\n when save_dict of monai.handlers.CheckpointSaver is a dictionary with a single item,\n loading the file with monai.handlers.CheckpointLoader raises an error.\n To Reproduce\n To reproduce the issue:\n import logging\n import sys\n \n import torch\n from ignite.engine import Engine\n \n from monai.handlers import CheckpointLoader, CheckpointSaver\n \n logging.basicConfig(stream=sys.stdout, level=logging.INFO)\n \n net = torch.nn.PReLU()\n engine = Engine(lambda e, b: None)\n \n CheckpointSaver(save_dir=\".\", save_dict={\"net\": net}, save_final=True).attach(engine)\n engine.run([0] * 8, max_epochs=5)\n \n CheckpointLoader(load_path=\"./net_final_iteration=40.pth\", load_dict={\"net\": net}).attach(engine)\n engine.run([0] * 8, max_epochs=1)\n the output (showing loader failure) is:\n <denchmark-code>INFO:ignite.engine.engine.Engine:Engine run starting with max_epochs=5.\n INFO:ignite.engine.engine.Engine:Epoch[1] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Epoch[2] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Epoch[3] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Epoch[4] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Epoch[5] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Train completed, saved final checkpoint: ./net_final_iteration=40.pth\n INFO:ignite.engine.engine.Engine:Engine run complete. Time taken 00:00:00\n INFO:ignite.engine.engine.Engine:Engine run starting with max_epochs=1.\n ERROR:ignite.engine.engine.Engine:Engine run is terminating due to exception: Object labeled by 'net' from `to_load` is not found in the checkpoint.\n INFO:ignite.engine.engine.Engine:Exception_raised, saved exception checkpoint: ./net_final_iteration=40.pth\n </denchmark-code>\n \n Expected behavior\n the loader should be able to read this dict structure, to be consistent with the case of  save_dict where the dict has more than one item, example:\n logging.basicConfig(stream=sys.stdout, level=logging.INFO)\n \n net = torch.nn.PReLU()\n engine = Engine(lambda e, b: None)\n \n CheckpointSaver(save_dir=\".\", save_dict={\"net\": net, 'net1': net}, save_final=True).attach(engine)\n engine.run([0] * 8, max_epochs=5)\n \n CheckpointLoader(load_path=\"./checkpoint_final_iteration=40.pth\", load_dict={\"net\": net}).attach(engine)\n engine.run([0] * 8, max_epochs=1)\n this example uses {\"net\": net, 'net1': net} and the output is expected:\n <denchmark-code>INFO:ignite.engine.engine.Engine:Engine run starting with max_epochs=5.\n INFO:ignite.engine.engine.Engine:Epoch[1] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Epoch[2] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Epoch[3] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Epoch[4] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Epoch[5] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Train completed, saved final checkpoint: ./checkpoint_final_iteration=40.pth\n INFO:ignite.engine.engine.Engine:Engine run complete. Time taken 00:00:00\n INFO:ignite.engine.engine.Engine:Engine run starting with max_epochs=1.\n INFO:ignite.engine.engine.Engine:Restored all variables from ./checkpoint_final_iteration=40.pth\n INFO:ignite.engine.engine.Engine:Epoch[1] Complete. Time taken: 00:00:00\n INFO:ignite.engine.engine.Engine:Train completed, saved final checkpoint: ./checkpoint_final_iteration=40.pth\n INFO:ignite.engine.engine.Engine:Engine run complete. Time taken 00:00:00\n </denchmark-code>\n \n Environment (please complete the following information):\n \n OS macos\n Python version 3.6\n MONAI version 1d73f65\n \n \n see also <denchmark-link:https://github.com/pytorch/ignite/issues/770>pytorch/ignite#770</denchmark-link>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "b637e0134d38af206fb91d201c64f5c92f748a8d", "commit_author": "Nic Ma", "commitT": "2020-05-28 13:04:59+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "monai\\handlers\\checkpoint_loader.py", "file_new_name": "monai\\handlers\\checkpoint_loader.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "53,54,55,56,57", "deleted_lines": null, "method_info": {"method_name": "__call__", "method_params": "self,engine", "method_startline": "51", "method_endline": "59"}}}}, "file_1": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\test_handler_checkpoint_loader.py"}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tests\\test_handler_checkpoint_saver.py", "file_new_name": "tests\\test_handler_checkpoint_saver.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "18", "deleted_lines": "18,100,101,102"}}}}}}