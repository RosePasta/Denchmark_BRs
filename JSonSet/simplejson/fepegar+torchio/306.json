{"BR": {"BR_id": "306", "BR_author": "fepegar", "BRopenT": "2020-09-18T11:37:15Z", "BRcloseT": "2020-09-21T10:29:14Z", "BR_text": {"BRsummary": "RandomGamma turns negative values to NaN", "BRdescription": "\n I will elaborate later, but I think it's related to this the issue: <denchmark-link:https://stackoverflow.com/questions/45384602/numpy-runtimewarning-invalid-value-encountered-in-power>https://stackoverflow.com/questions/45384602/numpy-runtimewarning-invalid-value-encountered-in-power</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "fepegar", "commentT": "2020-09-18T11:37:21Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/GFabien>@GFabien</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "fepegar", "commentT": "2020-09-18T11:37:48Z", "comment_text": "\n \t\tIn [14]: x\n Out[14]:\n tensor([ 0.0574, -0.2568,  0.3255,  0.0427, -0.2941, -0.2175, -0.2347, -0.4489,\n         -0.0622, -0.4478])\n \n In [15]: x ** 1.2\n Out[15]:\n tensor([0.0324,    nan, 0.2600, 0.0227,    nan,    nan,    nan,    nan,    nan,\n            nan])\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "fepegar", "commentT": "2020-09-18T11:43:02Z", "comment_text": "\n \t\tThat seems fair enough. I'm not sure how we should deal with this, introducing complex numbers is probably not a good idea. Doing as advised in the stackoverflow's answer sounds reasonable but it has to be mentioned in the doc. What do you think?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "fepegar", "commentT": "2020-09-18T11:44:30Z", "comment_text": "\n \t\tWhat about the SO answer suggesting np.sign(a) * (np.abs(a)) ** (1 / 3)? What needs to be mentioned in the doc?\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "fepegar", "commentT": "2020-09-18T11:46:58Z", "comment_text": "\n \t\t\n What about the SO answer suggesting np.sign(a) * (np.abs(a)) ** (1 / 3)? What needs to be mentioned in the doc?\n \n Sorry I was referring to this answer. Even if it's natural it's not obvious that it is what the transform will do so maybe it's better to mention it in the doc.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "fepegar", "commentT": "2020-09-18T11:59:47Z", "comment_text": "\n \t\tI see what you mean. Here's some more info: <denchmark-link:https://math.stackexchange.com/questions/317528/how-do-you-compute-negative-numbers-to-fractional-powers>https://math.stackexchange.com/questions/317528/how-do-you-compute-negative-numbers-to-fractional-powers</denchmark-link>\n \n I'm not sure what the best option would be. If we implement it like that, maybe that should indeed be explained in the docs and a Warning should be raised.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "fepegar", "commentT": "2020-09-18T12:12:55Z", "comment_text": "\n \t\t\n I'm not sure what the best option would be. If we implement it like that, maybe that should indeed be explained in the docs and a Warning should be raised.\n \n I agree, if we think about contrast I think it makes more sense to not raise  at any power. This also avoids checking for fractional power to retrieve the power to which raise  when it is legal to do so (as explained in <denchmark-link:https://math.stackexchange.com/questions/317528/how-do-you-compute-negative-numbers-to-fractional-powers>https://math.stackexchange.com/questions/317528/how-do-you-compute-negative-numbers-to-fractional-powers</denchmark-link>\n ).\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "fepegar", "commentT": "2020-09-18T12:36:59Z", "comment_text": "\n \t\tI'm not sure what you mean. It's the abs that's raised, not the sign, right?\n I've tried with gamma 1.28, here are some results for reference:\n Original\n <denchmark-link:https://user-images.githubusercontent.com/12688084/93597994-e7b3bd80-f9b3-11ea-92e0-b18b1514ecf5.png></denchmark-link>\n \n After rescale (0, 1)\n <denchmark-link:https://user-images.githubusercontent.com/12688084/93598027-f7cb9d00-f9b3-11ea-959e-9f66fadd9899.png></denchmark-link>\n \n After rescale (-0.5, 0.5)\n <denchmark-link:https://user-images.githubusercontent.com/12688084/93598041-0023d800-f9b4-11ea-906b-2e3b81197869.png></denchmark-link>\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "fepegar", "commentT": "2020-09-18T12:42:39Z", "comment_text": "\n \t\t\n I'm not sure what you mean. It's the abs that's raised, not the sign, right?\n \n Yes.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "fepegar", "commentT": "2020-09-21T10:30:32Z", "comment_text": "\n \t\tFixed in v0.17.39.\n \t\t"}}}, "commit": {"commit_id": "d677aee754d6e03b1481e7a365931efb7d20ef6b", "commit_author": "Fernando P\u00e9rez-Garc\u00eda", "commitT": "2020-09-21 11:29:13+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\transforms\\augmentation\\test_random_gamma.py", "file_new_name": "tests\\transforms\\augmentation\\test_random_gamma.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "36,37,38", "deleted_lines": null, "method_info": {"method_name": "test_negative_values", "method_params": "self", "method_startline": "36", "method_endline": "38"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "torchio\\transforms\\augmentation\\intensity\\random_gamma.py", "file_new_name": "torchio\\transforms\\augmentation\\intensity\\random_gamma.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "57,61,62,63,64,65,66,67,68,69,70,71,72", "deleted_lines": null, "method_info": {"method_name": "apply_transform", "method_params": "self,Subject", "method_startline": "55", "method_endline": "74"}}}}}}}