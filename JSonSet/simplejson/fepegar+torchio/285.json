{"BR": {"BR_id": "285", "BR_author": "fepegar", "BRopenT": "2020-08-19T13:49:36Z", "BRcloseT": "2020-08-19T19:16:29Z", "BR_text": {"BRsummary": "4D I/O is incompatible with ITK", "BRdescription": "\n import SimpleITK as sitk\n import torchio as tio\n import torch\n image = tio.ScalarImage(tensor=torch.rand(3, 4, 5, 6))\n im_itk = image.as_sitk()\n im_itk.GetSize()  # (4, 5, 6)\n im_itk.GetNumberOfComponentsPerPixel()  # 3\n path = 'image_4d.nii'\n sitk.WriteImage(im_itk, path)\n tio.ScalarImage(path).shape\n ---------------------------------------------------------------------------\n ValueError                                Traceback (most recent call last)\n <ipython-input-10-cc0c80d0d703> in <module>\n ----> 1 tio.ScalarImage('image_4d.nii').shape\n \n ~/git/torchio/torchio/data/image.py in shape(self)\n     219     @property\n     220     def shape(self) -> Tuple[int, int, int, int]:\n --> 221         return tuple(self.data.shape)\n     222\n     223     @property\n \n ~/git/torchio/torchio/data/image.py in data(self)\n     203     @property\n     204     def data(self):\n --> 205         return self[DATA]\n     206\n     207     @property\n \n ~/git/torchio/torchio/data/image.py in __getitem__(self, item)\n     183         if item in (DATA, AFFINE):\n     184             if item not in self:\n --> 185                 self.load()\n     186         return super().__getitem__(item)\n     187\n \n ~/git/torchio/torchio/data/image.py in load(self)\n     396         paths = self.path if isinstance(self.path, list) else [self.path]\n     397         tensor, affine = read_image(paths[0])\n --> 398         tensor = self.parse_tensor_shape(\n     399             tensor,\n     400             self.num_spatial_dims,\n \n ~/git/torchio/torchio/data/image.py in parse_tensor_shape(self, tensor, num_spatial_dims, channels_last)\n     371             channels_last: Optional[bool],\n     372             ) -> torch.Tensor:\n --> 373         return ensure_4d(tensor, channels_last, num_spatial_dims)\n     374\n     375     @staticmethod\n \n ~/git/torchio/torchio/utils.py in ensure_4d(tensor, channels_last, num_spatial_dims)\n     293             f' issue in {REPO_URL} if you would like support for them'\n     294         )\n --> 295         raise ValueError(message)\n     296     assert tensor.ndim == 4\n     297     return tensor\n \n ValueError: 5D images not supported yet. Please create an issue in https://github.com/fepegar/torchio/ if you would like support for them\n \t"}, "comments": {}}, "commit": {"commit_id": "47d3da6f7a197ec3b8ad9835337287f782628567", "commit_author": "Fernando P\u00e9rez-Garc\u00eda", "commitT": "2020-08-19 20:16:28+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\data\\test_image.py", "file_new_name": "tests\\data\\test_image.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "110", "deleted_lines": "109", "method_info": {"method_name": "test_nans_tensor", "method_params": "self", "method_startline": "106", "method_endline": "111"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "112,113,114,115", "method_info": {"method_name": "test_nans_file", "method_params": "self", "method_startline": "112", "method_endline": "115"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "tests\\data\\test_io.py", "file_new_name": "tests\\data\\test_io.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "91,92,93,94", "method_info": {"method_name": "test_nd", "method_params": "self", "method_startline": "91", "method_endline": "94"}}, "hunk_1": {"Ismethod": 1, "added_lines": "84", "deleted_lines": "74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89", "method_info": {"method_name": "save_load_save_load", "method_params": "self,dimensions", "method_startline": "74", "method_endline": "89"}}, "hunk_2": {"Ismethod": 1, "added_lines": "44,45,46,47", "deleted_lines": null, "method_info": {"method_name": "test_save_rgb", "method_params": "self", "method_startline": "44", "method_endline": "47"}}, "hunk_3": {"Ismethod": 1, "added_lines": "43", "deleted_lines": "43", "method_info": {"method_name": "test_read_image", "method_params": "self", "method_startline": "40", "method_endline": "43"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\transforms\\preprocessing\\test_histogram_standardization.py", "file_new_name": "tests\\transforms\\preprocessing\\test_histogram_standardization.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "17,18,19,20,21,22,23", "deleted_lines": "17", "method_info": {"method_name": "setUp", "method_params": "self", "method_startline": "12", "method_endline": "27"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\utils.py", "file_new_name": "tests\\utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "140", "deleted_lines": null, "method_info": {"method_name": "get_image_path", "method_params": "self,stem,binary,shape,20,30", "method_startline": "131", "method_endline": "141"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 9, "file_old_name": "torchio\\data\\image.py", "file_new_name": "torchio\\data\\image.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "339,340", "deleted_lines": null, "method_info": {"method_name": "parse_tensor_shape", "method_params": "self,Tensor", "method_startline": "339", "method_endline": "340"}}, "hunk_1": {"Ismethod": 1, "added_lines": "101,102", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,TypePath,None,str,None,None,bool,bool,str", "method_startline": "95", "method_endline": "104"}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "367,368,369,370,371,372", "method_info": {"method_name": "parse_tensor_shape", "method_params": "self,Tensor,int", "method_startline": "367", "method_endline": "372"}}, "hunk_3": {"Ismethod": 1, "added_lines": null, "deleted_lines": "444,451,452,459", "method_info": {"method_name": "save", "method_params": "self,path,squeeze,channels_last", "method_startline": "444", "method_endline": "460"}}, "hunk_4": {"Ismethod": 1, "added_lines": null, "deleted_lines": "492,493,494,495,496,497,498", "method_info": {"method_name": "guess_channels_last", "method_params": "self,Path", "method_startline": "492", "method_endline": "498"}}, "hunk_5": {"Ismethod": 1, "added_lines": "388,389,390,391,392,393,394,395", "deleted_lines": "395", "method_info": {"method_name": "read_and_check", "method_params": "self,path", "method_startline": "388", "method_endline": "395"}}, "hunk_6": {"Ismethod": 1, "added_lines": "397", "deleted_lines": "397,398,399,400,401,402,403,404,405,406,409,410", "method_info": {"method_name": "save", "method_params": "self,TypePath,bool", "method_startline": "397", "method_endline": "410"}}, "hunk_7": {"Ismethod": 1, "added_lines": null, "deleted_lines": "116,117,118", "method_info": {"method_name": "__init__", "method_params": "self,TypePath,None,str,None,None,bool,None,None,str", "method_startline": "110", "method_endline": "120"}}, "hunk_8": {"Ismethod": 1, "added_lines": "363,366", "deleted_lines": "367,368,369,370,371,372,373", "method_info": {"method_name": "load", "method_params": "self", "method_startline": "352", "method_endline": "386"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "torchio\\data\\io.py", "file_new_name": "torchio\\data\\io.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "15,16,17,18,21,22", "deleted_lines": "15,16,17,18,19,21,22", "method_info": {"method_name": "read_image", "method_params": "TypePath", "method_startline": "15", "method_endline": "23"}}, "hunk_1": {"Ismethod": 1, "added_lines": "83", "deleted_lines": "79,80,81,82,83,84", "method_info": {"method_name": "_write_nibabel", "method_params": "TypeData,TypeData,TypePath,bool", "method_startline": "79", "method_endline": "84"}}, "hunk_2": {"Ismethod": 1, "added_lines": "29,30,31", "deleted_lines": "26,27,28", "method_info": {"method_name": "_read_nibabel", "method_params": "TypePath", "method_startline": "26", "method_endline": "34"}}, "hunk_3": {"Ismethod": 1, "added_lines": "90,91,92,93,94,95,96", "deleted_lines": "94,95", "method_info": {"method_name": "_write_nibabel", "method_params": "TypeData,TypeData,TypePath,bool,bool", "method_startline": "90", "method_endline": "96"}}, "hunk_4": {"Ismethod": 1, "added_lines": "15,16,17,18", "deleted_lines": "15,16,17,18", "method_info": {"method_name": "read_image", "method_params": "TypePath,bool", "method_startline": "15", "method_endline": "18"}}, "hunk_5": {"Ismethod": 1, "added_lines": "73,74,75,76", "deleted_lines": "73,75", "method_info": {"method_name": "write_image", "method_params": "Tensor,TypeData,TypePath,bool,bool,bool", "method_startline": "69", "method_endline": "76"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "torchio\\transforms\\preprocessing\\intensity\\histogram_standardization.py", "file_new_name": "torchio\\transforms\\preprocessing\\intensity\\histogram_standardization.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "166,167", "deleted_lines": "166,167"}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "torchio\\utils.py", "file_new_name": "torchio\\utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "252", "deleted_lines": "248,249,250,251,252", "method_info": {"method_name": "ensure_4d", "method_params": "TypeData,bool,num_spatial_dims", "method_startline": "248", "method_endline": "252"}}, "hunk_1": {"Ismethod": 1, "added_lines": "252,255,256,257", "deleted_lines": "252,253,254,255,256,257,258,259,260,261,262,263,266,269,270,271,276,277", "method_info": {"method_name": "ensure_4d", "method_params": "TypeData,num_spatial_dims", "method_startline": "252", "method_endline": "283"}}}}}}}