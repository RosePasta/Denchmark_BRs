{"BR": {"BR_id": "239", "BR_author": "GFabien", "BRopenT": "2020-07-21T07:09:04Z", "BRcloseT": "2020-07-21T13:49:30Z", "BR_text": {"BRsummary": "Cropping gets rid of some attributes", "BRdescription": "\n \ud83d\udc1bBug\n Cropping now:\n \n removes every key that is not among DATA, AFFINE and TYPE at the Image level;\n reinitializes every attribute that was already set at the Subject level.\n \n It was introduced in <denchmark-link:https://github.com/fepegar/torchio/commit/aaae0560a45ac2477c8c7e5bea627320e17143d6>aaae056</denchmark-link>\n . (I guess you already knew about it <denchmark-link:https://github.com/fepegar>@fepegar</denchmark-link>\n  since there is a TODO in the  method.)\n To reproduce\n from torchio import RandomBlur\n from torchio.datasets import Colin27\n \n colin = Colin27(2008)\n transform = RandomBlur()\n transformed = transform(colin)\n cropped = transformed.crop((0, 0, 0), (10, 10, 10))\n \n print('Path before cropping:\\t\\t', transformed['t1']['path'])\n print('Path after cropping: \\t\\t', cropped['t1']['path'])\n \n print('History before cropping:\\t', transformed.history)\n print('History after cropping: \\t', cropped.history)\n \n >>> Using cache found in /.../.cache/torchio/mni_colin27_2008_nifti\n >>> Path before cropping:\t /.../.cache/torchio/mni_colin27_2008_nifti/colin27_t1_tal_hires.nii\n >>> Path after cropping: \t\t \n >>> History before cropping:\t [('RandomBlur', {'t1': {'std': array([2.6496408, 1.359108 , 3.448594 ], dtype=float32)}, 't2': {'std': array([3.449116  , 0.23409271, 0.9134309 ], dtype=float32)}, 'pd': {'std': array([0.53169155, 3.554979  , 0.03398538], dtype=float32)}})]\n >>> History after cropping: \t []\n Therefore, you lose access to the original path of the Image (but you would also have lost any custom attribute that you would have added) and you lose access to the history of the Subject.\n Expected behavior\n I expect that information is preserved after cropping. It is important to be able to reproduce results are trying to understand why we get especially good or bad results on given patches.\n TorchIO version\n 0.17.7\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "GFabien", "commentT": "2020-07-21T13:49:51Z", "comment_text": "\n \t\tThanks, <denchmark-link:https://github.com/GFabien>@GFabien</denchmark-link>\n . Fixed in .\n \t\t"}}}, "commit": {"commit_id": "c4f8cea759a0a2cd891d506f0f2c412cbd595350", "commit_author": "Fernando", "commitT": "2020-07-21 14:48:41+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "tests\\data\\test_image.py", "file_new_name": "tests\\data\\test_image.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "16", "deleted_lines": "16", "method_info": {"method_name": "test_image_not_found", "method_params": "self", "method_startline": "14", "method_endline": "16"}}, "hunk_1": {"Ismethod": 1, "added_lines": "22,23,24", "deleted_lines": "22,23,24", "method_info": {"method_name": "test_wrong_affine", "method_params": "self", "method_startline": "22", "method_endline": "24"}}, "hunk_2": {"Ismethod": 1, "added_lines": "32", "deleted_lines": "32", "method_info": {"method_name": "test_tensor_affine", "method_params": "self", "method_startline": "30", "method_endline": "32"}}, "hunk_3": {"Ismethod": 1, "added_lines": "20", "deleted_lines": "20", "method_info": {"method_name": "test_wrong_path_type", "method_params": "self", "method_startline": "18", "method_endline": "20"}}, "hunk_4": {"Ismethod": 1, "added_lines": "34,35,36", "deleted_lines": null, "method_info": {"method_name": "test_crop_attributes", "method_params": "self", "method_startline": "34", "method_endline": "36"}}, "hunk_5": {"Ismethod": 1, "added_lines": "22,23,24", "deleted_lines": "22,23,24", "method_info": {"method_name": "test_incompatible_arguments", "method_params": "self", "method_startline": "22", "method_endline": "24"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "torchio\\data\\image.py", "file_new_name": "torchio\\data\\image.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "326,327,328,329,330", "deleted_lines": "323", "method_info": {"method_name": "crop", "method_params": "self,index_ini,index_fin", "method_startline": "319", "method_endline": "330"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "torchio\\data\\subject.py", "file_new_name": "torchio\\data\\subject.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "144,145,146", "deleted_lines": "144", "method_info": {"method_name": "crop", "method_params": "self,index_ini,index_fin", "method_startline": "135", "method_endline": "146"}}}}}}}