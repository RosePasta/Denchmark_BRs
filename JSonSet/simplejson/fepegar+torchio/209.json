{"BR": {"BR_id": "209", "BR_author": "SamuelJoutard", "BRopenT": "2020-06-26T11:31:00Z", "BRcloseT": "2020-06-26T12:23:45Z", "BR_text": {"BRsummary": "Problem when creating a Dataloader from a torchio.ImagesDataset", "BRdescription": "\n \ud83d\udc1bBug\n Hi,\n I recently updated my torchio version to the latest one (0.17.0) and there seems to be some problems when creating Dataloader from torchio.ImagesDataset objects. In my case, the following code works well in 0.16.0 but fails under torchio 0.17.0.\n To reproduce\n path_data = \"Data/preprocessed_data\"\n     train_list = [\"07\"]\n     path_lbl_m = os.path.join(os.path.join(path_data, \"label\"), \"label00\"+train_list[0]+\".nii.gz\")\n     path_im_m = os.path.join(os.path.join(path_data, \"img\"), \"img00\"+train_list[0]+\".nii.gz\")\n     subj_list = [torchio.Subject(label=torchio.Image(path_lbl_m, torchio.LABEL),\n                                  img=torchio.Image(path_im_m, torchio.INTENSITY))]\n     dataset = torchio.ImagesDataset(subj_list)\n     print(dataset[0][\"img\"][\"data\"].shape)\n     print(dataset[0][\"label\"][\"data\"].shape)\n     \n     DL = DataLoader(dataset, batch_size=1, shuffle=True)\n     for b in DL:\n         print(b[\"img\"][torchio.DATA])\n         print(b[\"label\"][torchio.DATA])\n torch.Size([1, 348, 272, 108])\n torch.Size([1, 348, 272, 108])\n Traceback (most recent call last):\n   File \"Code/non_local_feature_alignment/dataset_manager.py\", line 88, in <module>\n     print(b[\"img\"][torchio.DATA])\n KeyError: 'data'\n Expected behavior\n TorchIO version\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "SamuelJoutard", "commentT": "2020-06-26T12:12:44Z", "comment_text": "\n \t\tHi Sam,\n Thanks for reporting, I can reproduce. This was introduced in <denchmark-link:https://github.com/fepegar/torchio/pull/204>#204</denchmark-link>\n .\n This is the code I'm using to reproduce:\n import torchio\n from torch.utils.data import DataLoader\n \n subj_list = [torchio.datasets.Colin27()]\n dataset = torchio.ImagesDataset(subj_list)\n print(dataset[0]['t1'][torchio.DATA].shape)\n print(dataset[0]['brain'][torchio.DATA].shape)\n \n loader = DataLoader(dataset, batch_size=1, shuffle=True)\n for batch in loader:\n     print(batch['t1'][torchio.DATA])\n     print(batch['brain'][torchio.DATA])\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "SamuelJoutard", "commentT": "2020-06-26T12:25:35Z", "comment_text": "\n \t\tFixed in <denchmark-link:https://github.com/fepegar/torchio/pull/210>#210</denchmark-link>\n  \n Should work in v0.17.2.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "SamuelJoutard", "commentT": "2020-06-26T12:26:44Z", "comment_text": "\n \t\tThanks a lot Fernando :)\n \t\t"}}}, "commit": {"commit_id": "63061a24d6eb02bfe2e63af246e375343e477b77", "commit_author": "Fernando P\u00e9rez-Garc\u00eda", "commitT": "2020-06-26 13:23:44+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\data\\test_images_dataset.py", "file_new_name": "tests\\data\\test_images_dataset.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "72,73,74,75,76,77,78,79", "deleted_lines": null, "method_info": {"method_name": "test_data_loader", "method_params": "self", "method_startline": "72", "method_endline": "79"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "torchio\\data\\dataset.py", "file_new_name": "torchio\\data\\dataset.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "105", "deleted_lines": null, "method_info": {"method_name": "__getitem__", "method_params": "self,int", "method_startline": "100", "method_endline": "110"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "torchio\\data\\image.py", "file_new_name": "torchio\\data\\image.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "251", "deleted_lines": "251", "method_info": {"method_name": "load", "method_params": "self", "method_startline": "239", "method_endline": "266"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "torchio\\data\\subject.py", "file_new_name": "torchio\\data\\subject.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "126,127,128", "deleted_lines": null, "method_info": {"method_name": "load", "method_params": "self", "method_startline": "126", "method_endline": "128"}}}}}}}