{"BR": {"BR_id": "10507", "BR_author": "gmedan", "BRopenT": "2018-01-04T11:20:42Z", "BRcloseT": "2018-06-13T19:07:03Z", "BR_text": {"BRsummary": "Multi channel 32F Mat setTo NaN is not setting to NaN", "BRdescription": "\n <denchmark-h:h5>System information (version)</denchmark-h>\n \n \n OpenCV => 3.3.1\n Operating System / Platform => Windows 64 Bit\n Compiler => Visual Studio 2017 (15.5.2)\n \n <denchmark-h:h5>Detailed description</denchmark-h>\n \n Setting 3 or 4 channel 32F Mat to NaN using mask actually sets the value to 3.40282347e+38.\n 1 or 2 channels works fine.\n 64F works fine.\n No mask works fine.\n Problem is not reproduced in opencv 3.2.0\n <denchmark-h:h5>Steps to reproduce</denchmark-h>\n \n #include <opencv2/opencv.hpp>\n #include <iostream>\n \n int main(void)\n {\n     for (int chans = 1; chans <= 4; chans++)\n     {\n         cv::Mat A(1, 1, CV_MAKE_TYPE(CV_32F, chans), cv::Scalar::all(0));\n         A.setTo(cv::Scalar::all(std::numeric_limits<float>::quiet_NaN()), cv::Mat(1, 1, CV_8UC1, cv::Scalar::all(255)));\n         std::cout << \"Number of NaN pixels in \" << chans << \" channels image is \" << (cv::countNonZero((A == A) == 0)) << \" (should be 1)\" << std::endl;\n     }\n }\n output:\n Number of NaN pixels in 1 channels image is 1 (should be 1)\n Number of NaN pixels in 2 channels image is 1 (should be 1)\n Number of NaN pixels in 3 channels image is 0 (should be 1)\n Number of NaN pixels in 4 channels image is 0 (should be 1)\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "gmedan", "commentT": "2018-06-11T15:23:30Z", "comment_text": "\n \t\t\n 3.3.1\n \n Please try the latest code from 3.4 branch.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "gmedan", "commentT": "2018-06-11T16:21:37Z", "comment_text": "\n \t\tI ran this code with the latest 3.4,  but all channels have NaN values.\n Is this bug fixed already? Should I close this pull request?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "gmedan", "commentT": "2018-06-11T16:25:36Z", "comment_text": "\n \t\tLooks like it is get fixed here: <denchmark-link:https://github.com/opencv/opencv/pull/11192>#11192</denchmark-link>\n  (resolves similar problem with  values)\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "gmedan", "commentT": "2018-06-11T16:33:39Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/alalek>@alalek</denchmark-link>\n \n Thank you for a comment.\n In <denchmark-link:https://github.com/opencv/opencv/pull/11192>#11192</denchmark-link>\n  , only the test with INF values has been done, but is it unnecessary to add a test with NAN values?\n \t\t"}}}, "commit": {"commit_id": "4fe648b15c0cf90e9e47f01454261f731f5e92ea", "commit_author": "yuki takehara", "commitT": "2018-06-12 18:05:44+00:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\core\\src\\copy.cpp", "file_new_name": "modules\\core\\src\\copy.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "466,468,469,470,472,473", "deleted_lines": "467", "method_info": {"method_name": "cv::ipp_Mat_setTo_Mat", "method_params": "dst,_val,mask", "method_startline": "451", "method_endline": "506"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\core\\test\\test_mat.cpp", "file_new_name": "modules\\core\\test\\test_mat.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1625,1626,1627,1628,1629,1630,1631,1632,1633,1634,1635,1636,1637,1638,1639", "deleted_lines": null, "method_info": {"method_name": "opencv_test::TEST", "method_params": "Mat,regression_10507_mat_setTo", "method_startline": "1615", "method_endline": "1639"}}}}}}}