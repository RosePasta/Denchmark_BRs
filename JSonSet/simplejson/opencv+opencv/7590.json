{"BR": {"BR_id": "7590", "BR_author": "btut", "BRopenT": "2016-10-31T12:32:25Z", "BRcloseT": "2016-11-15T19:35:56Z", "BR_text": {"BRsummary": "Cannot build shared libs in android due to undefined references in sample hello-android", "BRdescription": "\n <denchmark-h:h5>System information (version)</denchmark-h>\n \n \n OpenCV => commit 4c66772\n Operating System / Platform => macOS Sierra 10.12.1 / 64 Bit\n Compiler => Android NDK r13 (using g++ 4.9)\n \n <denchmark-h:h5>Detailed description</denchmark-h>\n \n Cannot build OpenCV shared libraries for android due to undefined references in hello-android/main.cpp. Build works fine if I just set the main method in hello-android/main.cpp to do nothing and return 0.\n CMakeFiles/hello-android.dir/hello-android/main.cpp.o:main.cpp:function main: error: undefined reference to 'cv::getTextSize(cv::String const&, int, double, int, int*)'\n CMakeFiles/hello-android.dir/hello-android/main.cpp.o:main.cpp:function main: error: undefined reference to 'cv::putText(cv::InputOutputArray const&, cv::String const&, cv::Point, int, double, cv::Scalar_, int, int, bool)'\n collect2: error: ld returned 1 exit status\n make[3]: *** [bin/hello-android] Error 1\n make[2]: *** [samples/android/CMakeFiles/hello-android.dir/all] Error 2\n <denchmark-h:h5>Steps to reproduce</denchmark-h>\n \n build with the following commands:\n <denchmark-code>cd OpenCV/platforms; \\\n \n mkdir -p build_android_arm; \\\n \n cd build_android_arm; \\\n \n cmake -DBUILD_SHARED_LIBS=ON -DANDROID_NATIVE_API_LEVEL=21 -DBUILD_EXAMPLES=OFF -DBUILD_DOCS=OFF -DBUILD_opencv_xfeatures2d=OFF -DWITH_CUDA=OFF -DWITH_OPENCL=ON -DOPENCV_EXTRA_MODULES_PATH=../../../OpenCVContrib/modules -DCMAKE_BUILD_WITH_INSTALL_RPATH=ON -DCMAKE_TOOLCHAIN_FILE=../android/android.toolchain.cmake $@ ../.. && \\\n \n make -j12\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "btut", "commentT": "2016-10-31T13:04:16Z", "comment_text": "\n \t\tandroid-ndk-r10e works fine:\n <denchmark-link:http://pullrequest.opencv.org/buildbot/builders/master_noOCL-android/builds/458>http://pullrequest.opencv.org/buildbot/builders/master_noOCL-android/builds/458</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "btut", "commentT": "2016-10-31T13:20:47Z", "comment_text": "\n \t\tI cannot confirm. I just tried with ndk r10e and it failed as well. I am unable to read from the buildbot if DBUILD_SHARED_LIBS is set, because I only get this error when building the shared libs, static libs work fine.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "btut", "commentT": "2016-11-15T14:10:51Z", "comment_text": "\n \t\tI confirm that I can reproduce this problem.\n <denchmark-code>cd platforms\n export PATH=/home/declan/Documents/zone/mid/bin/android/google/sdk/cmake/3.6.3155560/bin:$PATH\n export ANDROID_NDK=/home/declan/Documents/zone/mid/bin/android/google/sdk/ndk-bundle\n \n scripts/cmake_android_arm.sh  -DBUILD_SHARED_LIBS=ON -DANDROID_NATIVE_API_LEVEL=9 -DANDROID_STL=gnustl_shared\n \n cd build_android_arm\n make -j8\n </denchmark-code>\n \n [ 60%] Built target opencv_superres /home/declan/Documents/zone/mid/bin/android/opencv/opencv_github_fork_dec1/samples/android/hello-android/main.cpp:16: error: undefined reference to 'cv::getTextSize(cv::String const&, int, double, int, int*)' /home/declan/Documents/zone/mid/bin/android/opencv/opencv_github_fork_dec1/samples/android/hello-android/main.cpp:18: error: undefined reference to 'cv::putText(cv::_InputOutputArray const&, cv::String const&, cv::Point_<int>, int, double, cv::Scalar_<double>, int, int, bool)' collect2: error: ld returned 1 exit status \n Ive created a pull request that would resolve this:\n <denchmark-link:https://github.com/opencv/opencv/pull/7678>#7678</denchmark-link>\n \n samples/android/hello-android is not being linked to libopencv_imgproc.so\n \t\t"}}}, "commit": {"commit_id": "a49e50a33b891a7895bf7395220500a176735ac8", "commit_author": "Declan Moran", "commitT": "2016-11-15 15:02:10+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "samples\\android\\CMakeLists.txt", "file_new_name": "samples\\android\\CMakeLists.txt", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "21,22", "deleted_lines": "21,22"}}}}}}