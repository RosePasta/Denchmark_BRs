{"BR": {"BR_id": "5010", "BR_author": "opencv-pushbot", "BRopenT": "2015-07-27T11:28:10Z", "BRcloseT": "2015-10-06T12:24:42Z", "BR_text": {"BRsummary": "Mat/UMat may be out of sync.", "BRdescription": "\n Transferred from <denchmark-link:http://code.opencv.org/issues/4380>http://code.opencv.org/issues/4380</denchmark-link>\n \n <denchmark-code>|| Pavel  Vlasov on 2015-06-04 10:11\n || Priority: Normal\n || Affected: branch 'master' (3.0-dev)\n || Category: None\n || Tracker: Bug\n || Difficulty: \n || PR: \n || Platform: x64 / Windows\n </denchmark-code>\n \n <denchmark-h:h2>Mat/UMat may be out of sync.</denchmark-h>\n \n <denchmark-code>I created this test as a reproducer:\n <pre>\n TEST(UMat, SyncTemp)\n {\n     Mat m(10, 10, CV_8UC1);\n \n     {\n         UMat um = m.getUMat(ACCESS_WRITE);\n \n         {\n             Mat m2 = um.getMat(ACCESS_WRITE);\n             m2.setTo(cv::Scalar::all(17));\n         }\n \n         um.setTo(cv::Scalar::all(19));\n \n         EXPECT_EQ(0, cvtest::norm(um.getMat(ACCESS_READ), cv::Mat(um.size(), um.type(), 19), NORM_INF));\n     }\n }\n </pre>\n \n This will create the following exception:\n <pre>\n error: (-215) u->refcount == 0 in function cv::UMat::handle\n </pre>\n </denchmark-code>\n \n <denchmark-h:h2>History</denchmark-h>\n \n <denchmark-h:h5>Alexander Alekhin on 2015-07-07 13:58</denchmark-h>\n \n <denchmark-code>Related issue: http://code.opencv.org/issues/4468\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "opencv-pushbot", "commentT": "2015-08-27T09:52:53Z", "comment_text": "\n \t\tThe related PR is <denchmark-link:https://github.com/opencv/opencv/pull/5242>#5242</denchmark-link>\n .\n \t\t"}}}, "commit": {"commit_id": "21467d817b68721d8ce6f3f4b313e87e54ac6135", "commit_author": "Alexander Alekhin", "commitT": "2015-08-05 16:08:48+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\core\\test\\test_umat.cpp", "file_new_name": "modules\\core\\test\\test_umat.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "832,833,834,835,836,837,838,839,840,841,842,843,844,845,846,847,848", "deleted_lines": null, "method_info": {"method_name": "cvtest::ocl::TEST", "method_params": "UMat,SyncTemp", "method_startline": "832", "method_endline": "848"}}}}}}}