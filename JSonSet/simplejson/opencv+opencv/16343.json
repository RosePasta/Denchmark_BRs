{"BR": {"BR_id": "16343", "BR_author": "cwreynolds", "BRopenT": "2020-01-14T00:46:17Z", "BRcloseT": "2020-02-17T22:41:59Z", "BR_text": {"BRsummary": "\u201cy\u201d argument to moveWindow() being ignored?", "BRdescription": "\n <denchmark-h:h5>System information (version)</denchmark-h>\n \n \n OpenCV => 4.1.2\n Operating System / Platform => macOS Catalina 10.15.2\n Compiler => Xcode / clang / c++\n \n <denchmark-h:h5>Detailed description</denchmark-h>\n \n (I must be doing something wrong. This seems too obvious to be a real bug.)\n Running a version of OpenCV 4.1.2, recently installed (via homebrew) on macOS Catalina 10.15.2, I tried to show several images in individual windows. I wanted to offset the windows along a diagonal:\n <denchmark-code>    int window_counter = 0;\n     int window_position = 0;\n     for (int i = 0; i < 4; i++)\n     {\n         std::string window_name = \"TexSyn\" + std::to_string(window_counter++);\n         cv::namedWindow(window_name);\n         cv::moveWindow(window_name, window_position, window_position);\n         window_position += 30;\n         cv::imshow(window_name, opencv_image);\n     }\n     cv::waitKey(0);\n </denchmark-code>\n \n The windows appear. They are offset in \u201cx\u201d but not in \u201cy\u201d:\n <denchmark-link:https://user-images.githubusercontent.com/1909341/72303679-e3642300-3622-11ea-9f47-fbc62c4180cd.png></denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "cwreynolds", "commentT": "2020-01-14T00:58:30Z", "comment_text": "\n \t\tWhich GUI backend is used? (check getBuildInformation())\n There is corresponding code for these backends:\n \n COCOA\n Carbon\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "cwreynolds", "commentT": "2020-01-14T01:28:40Z", "comment_text": "\n \t\tThanks for looking at this. Down below it says GUI: Cocoa: YES:\n <denchmark-code>General configuration for OpenCV 4.1.2 =====================================\n   Version control:               unknown\n \n   Extra modules:\n     Location (extra):            /tmp/opencv-20191101-13084-e06xvq/opencv-4.1.2/opencv_contrib/modules\n     Version control (extra):     unknown\n \n   Platform:\n     Timestamp:                   2019-11-01T12:57:08Z\n     Host:                        Darwin 19.0.0 x86_64\n     CMake:                       3.15.4\n     CMake generator:             Unix Makefiles\n     CMake build tool:            /usr/local/Homebrew/Library/Homebrew/shims/mac/super/gmake\n     Configuration:               Release\n \n   CPU/HW features:\n     Baseline:                    SSE SSE2 SSE3 SSSE3 SSE4_1 POPCNT SSE4_2\n       requested:                 DETECT\n       disabled:                  AVX AVX2\n     Dispatched code generation:  FP16 AVX AVX2 AVX512_SKX\n       requested:                 SSE4_1 SSE4_2 AVX FP16 AVX2 AVX512_SKX\n       FP16 (0 files):            + FP16 AVX\n       AVX (4 files):             + AVX\n       AVX2 (27 files):           + FP16 FMA3 AVX AVX2\n       AVX512_SKX (3 files):      + FP16 FMA3 AVX AVX2 AVX_512F AVX512_COMMON AVX512_SKX\n \n   C/C++:\n     Built as dynamic libs?:      YES\n     C++ Compiler:                /usr/local/Homebrew/Library/Homebrew/shims/mac/super/clang++  (ver 11.0.0.11000033)\n     C++ flags (Release):         -I/Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include -I/Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include/darwin   -fsigned-char -W -Wall -Werror=return-type -Werror=non-virtual-dtor -Werror=address -Werror=sequence-point -Wformat -Werror=format-security -Wmissing-declarations -Wmissing-prototypes -Wstrict-prototypes -Wundef -Winit-self -Wpointer-arith -Wshadow -Wsign-promo -Wuninitialized -Winit-self -Wno-delete-non-virtual-dtor -Wno-unnamed-type-template-args -Wno-comment -fdiagnostics-show-option -Wno-long-long -Qunused-arguments -Wno-semicolon-before-method-body -ffunction-sections -fdata-sections  -fvisibility=hidden -fvisibility-inlines-hidden -DNDEBUG  -DNDEBUG\n     C++ flags (Debug):           -I/Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include -I/Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include/darwin   -fsigned-char -W -Wall -Werror=return-type -Werror=non-virtual-dtor -Werror=address -Werror=sequence-point -Wformat -Werror=format-security -Wmissing-declarations -Wmissing-prototypes -Wstrict-prototypes -Wundef -Winit-self -Wpointer-arith -Wshadow -Wsign-promo -Wuninitialized -Winit-self -Wno-delete-non-virtual-dtor -Wno-unnamed-type-template-args -Wno-comment -fdiagnostics-show-option -Wno-long-long -Qunused-arguments -Wno-semicolon-before-method-body -ffunction-sections -fdata-sections  -fvisibility=hidden -fvisibility-inlines-hidden -g  -O0 -DDEBUG -D_DEBUG\n     C Compiler:                  /usr/local/Homebrew/Library/Homebrew/shims/mac/super/clang\n     C flags (Release):           -I/Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include -I/Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include/darwin   -fsigned-char -W -Wall -Werror=return-type -Werror=non-virtual-dtor -Werror=address -Werror=sequence-point -Wformat -Werror=format-security -Wmissing-declarations -Wmissing-prototypes -Wstrict-prototypes -Wundef -Winit-self -Wpointer-arith -Wshadow -Wsign-promo -Wuninitialized -Winit-self -Wno-delete-non-virtual-dtor -Wno-unnamed-type-template-args -Wno-comment -fdiagnostics-show-option -Wno-long-long -Qunused-arguments -Wno-semicolon-before-method-body -ffunction-sections -fdata-sections  -fvisibility=hidden -fvisibility-inlines-hidden -DNDEBUG  -DNDEBUG\n     C flags (Debug):             -I/Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include -I/Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include/darwin   -fsigned-char -W -Wall -Werror=return-type -Werror=non-virtual-dtor -Werror=address -Werror=sequence-point -Wformat -Werror=format-security -Wmissing-declarations -Wmissing-prototypes -Wstrict-prototypes -Wundef -Winit-self -Wpointer-arith -Wshadow -Wsign-promo -Wuninitialized -Winit-self -Wno-delete-non-virtual-dtor -Wno-unnamed-type-template-args -Wno-comment -fdiagnostics-show-option -Wno-long-long -Qunused-arguments -Wno-semicolon-before-method-body -ffunction-sections -fdata-sections  -fvisibility=hidden -fvisibility-inlines-hidden -g  -O0 -DDEBUG -D_DEBUG\n     Linker flags (Release):      -Wl,-dead_strip  \n     Linker flags (Debug):        -Wl,-dead_strip  \n     ccache:                      NO\n     Precompiled headers:         NO\n     Extra dependencies:\n     3rdparty dependencies:\n \n   OpenCV modules:\n     To be built:                 aruco bgsegm bioinspired calib3d ccalib core datasets dnn dnn_objdetect dnn_superres dpm face features2d flann freetype fuzzy gapi hfs highgui img_hash imgcodecs imgproc line_descriptor ml objdetect optflow phase_unwrapping photo plot python3 quality reg rgbd saliency sfm shape stereo stitching structured_light superres surface_matching text tracking video videoio videostab xfeatures2d ximgproc xobjdetect xphoto\n     Disabled:                    python2 world\n     Disabled by dependency:      -\n     Unavailable:                 cnn_3dobj cudaarithm cudabgsegm cudacodec cudafeatures2d cudafilters cudaimgproc cudalegacy cudaobjdetect cudaoptflow cudastereo cudawarping cudev cvv hdf java js matlab ovis ts viz\n     Applications:                apps\n     Documentation:               NO\n     Non-free algorithms:         YES\n \n   GUI: \n     Cocoa:                       YES\n \n   Media I/O: \n     ZLib:                        /usr/lib/libz.dylib (ver 1.2.11)\n     JPEG:                        build-libjpeg-turbo (ver 2.0.2-62)\n     WEBP:                        build (ver encoder: 0x020e)\n     PNG:                         /usr/local/lib/libpng.dylib (ver 1.6.37)\n     TIFF:                        /usr/local/lib/libtiff.dylib (ver 42 / 4.0.10)\n     OpenEXR:                     /usr/local/lib/libImath.dylib /usr/local/lib/libIlmImf.dylib /usr/local/lib/libIex.dylib /usr/local/lib/libHalf.dylib /usr/local/lib/libIlmThread.dylib (ver 2.3.0)\n     HDR:                         YES\n     SUNRASTER:                   YES\n     PXM:                         YES\n     PFM:                         YES\n \n   Video I/O:\n     FFMPEG:                      YES\n       avcodec:                   YES (58.54.100)\n       avformat:                  YES (58.29.100)\n       avutil:                    YES (56.31.100)\n       swscale:                   YES (5.5.100)\n       avresample:                YES (4.0.0)\n     AVFoundation:                YES\n \n   Parallel framework:            TBB (ver 2019.9 interface 11009)\n \n   Trace:                         YES (with Intel ITT)\n \n   Other third-party libraries:\n     Intel IPP:                   2019.0.0 Gold [2019.0.0]\n            at:                   /tmp/opencv-20191101-13084-e06xvq/opencv-4.1.2/build/3rdparty/ippicv/ippicv_mac/icv\n     Intel IPP IW:                sources (2019.0.0)\n               at:                /tmp/opencv-20191101-13084-e06xvq/opencv-4.1.2/build/3rdparty/ippicv/ippicv_mac/iw\n     Lapack:                      YES (/usr/local/opt/openblas/lib/libopenblas.dylib)\n     Eigen:                       YES (ver 3.3.7)\n     Custom HAL:                  NO\n     Protobuf:                    build (3.5.1)\n \n   OpenCL:                        YES (no extra features)\n     Include path:                NO\n     Link libraries:              -framework OpenCL\n \n   Python 3:\n     Interpreter:                 /usr/local/opt/python/bin/python3 (ver 3.7.5)\n     Libraries:                   /usr/local/opt/python/Frameworks/Python.framework/Versions/3.7/lib/python3.7/config-3.7m-darwin/libpython3.7.dylib (ver 3.7.5)\n     numpy:                       /usr/local/lib/python3.7/site-packages/numpy/core/include (ver 1.17.2)\n     install path:                lib/python3.7/site-packages/cv2/python-3.7\n \n   Python (for build):            /usr/bin/python2.7\n \n   Java:                          \n     ant:                         NO\n     JNI:                         /Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include /Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include/darwin /Library/Java/JavaVirtualMachines/adoptopenjdk-13.jdk/Contents/Home/include\n     Java wrappers:               NO\n     Java tests:                  NO\n \n   Install to:                    /usr/local/Cellar/opencv/4.1.2\n -----------------------------------------------------------------\n </denchmark-code>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "cwreynolds", "commentT": "2020-01-15T05:16:45Z", "comment_text": "\n \t\tI think there may be a clue here: <denchmark-link:https://github.com/opencv/opencv/blob/master/modules/highgui/src/window_cocoa.mm#L290>window_cocoa.mm Line 290</denchmark-link>\n  in the Cocoa handling of \n y = [[window screen] frame].size.height - y; ? Maybe this explains why all the windows are anchored to the top (I think that's what I see in your screenshot).\n What do you think? I don't do iOS so why that special handling exists for the y direction is beyond me.\ud83e\udd37\n <denchmark-link:https://github.com/alalek>@alalek</denchmark-link>\n  <denchmark-link:https://github.com/cwreynolds>@cwreynolds</denchmark-link>\n   I'm tempted to take that line out but there must be a story why that special handling exists. Seems like lot of debug string comments are also left out in that file, maybe someone forgot to remove debug lines and this special y-direction handling was for debug? \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "cwreynolds", "commentT": "2020-01-15T18:01:47Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/saskatchewancatch>@saskatchewancatch</denchmark-link>\n  <denchmark-link:https://github.com/alalek>@alalek</denchmark-link>\n \n Thanks. Before I saw your note I was thinking the same thing. There is very little that goes on in that Cocoa-specific function besides flipping the y coordinate. I know next to nothing about the macOS native windowing system. When I web searched I <denchmark-link:https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CocoaDrawingGuide/Transforms/Transforms.html>saw</denchmark-link>\n  that the origin is normally in the lower left, but that sometimes may be \u201cflipped\u201d due to coordinate transforms. Which comes down to: \u201cincreasing y is up, unless it is down.\u201d\n I was considering trying it without that line, but having installed OpenCV via homebrew I would first have to clone the repo and get set up to build. If someone can try that easier than me I would be just as happy.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "cwreynolds", "commentT": "2020-02-03T21:56:36Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/vpisarev>@vpisarev</denchmark-link>\n  I see you've taken this issue. I tried something last week, maybe this will help your debug efforts.\n When I use OP's repro code, I am able to repro the issue. But when I try my own, the behaviour is as expected. This will produce 3 cascaded windows:\n <denchmark-code>int main()\n {\n         Mat a = Mat::zeros(Size(100, 100), CV_8U);\n         namedWindow(\"1\");\n         namedWindow(\"2\");\n         namedWindow(\"3\");\n \n         moveWindow(\"1\", 100, 100 );\n         moveWindow(\"2\", 200, 200);\n         moveWindow(\"3\", 300, 300);\n \n         imshow(\"1\", a);\n         imshow(\"2\", a);\n         imshow(\"3\", a);\n \n         waitKey(0);\n \n         return 0;\n }\n </denchmark-code>\n \n <denchmark-link:https://user-images.githubusercontent.com/21051160/73694441-e1730a00-468c-11ea-9321-db7600c087e9.png></denchmark-link>\n \n But OP's code will repro the issue as shown in his screenshot.\n My MacBook Pro SSD is busted and I left the issue last week.\n Perhaps this finding is helpful to you.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "cwreynolds", "commentT": "2020-02-03T22:03:43Z", "comment_text": "\n \t\tUpdate: I am mistaken. In my repro screenshot above, things are not working correctly. As you can see, first window (1) is supposed to be at 100, 100. But it is clearly not at 100, 100. More like 0, 100.\n It seems that y coordinates given to moveWindow may be off by like 100.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "cwreynolds", "commentT": "2020-02-03T23:12:20Z", "comment_text": "\n \t\t(Sorry if this is just spectator noise, but I am baffled by how this symptom got  after <denchmark-link:https://github.com/saskatchewancatch>@saskatchewancatch</denchmark-link>\n \u2019s experiment. In his screen shot, the vertical position difference between window 1 and 2 is  than between window 2 and 3. I\u2019d be tempted to guess that the windows are moved to the given position, but with the Y shifted  about 128 pixels, then clipped at the top of the screen.)\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "cwreynolds", "commentT": "2020-02-05T22:20:22Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/vpisarev>@vpisarev</denchmark-link>\n : One more observation, then I  I will shut up. I ran <denchmark-link:https://github.com/saskatchewancatch>@saskatchewancatch</denchmark-link>\n \u2019s test case, then overlaid a green diagonal line. It passes very close the the lower-left corner of windows 2 and 3. Window 1 is displaced down to keep it on the screen.\n It looks like the x, y arguments to moveWindow() are being applied to the lower left corner of the window.\n The <denchmark-link:https://docs.opencv.org/4.2.0/d7/dfc/group__highgui.html#ga8d86b207f7211250dbe6e28f76307ffb>doc</denchmark-link>\n  is ambiguous on this detail, but I assumed the x, y arguments to moveWindow() should refer to the upper-left corner of the window\n <denchmark-link:https://user-images.githubusercontent.com/1909341/73887496-870ab280-4820-11ea-96d8-8d6c714c0fd4.png></denchmark-link>\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "cwreynolds", "commentT": "2020-02-06T01:26:24Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/cwreynolds>@cwreynolds</denchmark-link>\n  Interesting observation. Though it's interesting that the  implementation is calling setFrameTopLeftPoint which supposedly sets the window position using the top left part of the window as the anchor.\n I think another part of the problem is that the moveWindow function is relying on the resolution of the whole screen to figure out where to set the top-left of the window. This is a problem because it does not account for the fact that the MacOs menu bar takes up some space at the top. Thus, if Cocoa functions to set the top-left of the window are called to set position to (0, 0), the window will get placed not at (0, 0), but just right under the menu bar.\n The workaround to this would be to get the visibleFrame property of the screen instead of just the frame, as is done currently in moveWindow.  visibleFrame will return the position/size of the screen area that is not occupied by the menu bar.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "cwreynolds", "commentT": "2020-02-14T20:02:45Z", "comment_text": "\n \t\tDear <denchmark-link:https://github.com/cwreynolds>@cwreynolds</denchmark-link>\n , <denchmark-link:https://github.com/saskatchewancatch>@saskatchewancatch</denchmark-link>\n , thank you for the help! This discussion and the advice to use \"visibleFrame\" property worked out well. Also, I had to postpone the actual repositioning of newly created windows until the very first imshow.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "cwreynolds", "commentT": "2020-02-15T02:08:19Z", "comment_text": "\n \t\tGreat! Thank you for the fix <denchmark-link:https://github.com/vpisarev>@vpisarev</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "d67a6c1be4df52100f1a6c4648904da54914700b", "commit_author": "Vadim Pisarevsky", "commitT": "2020-02-17 14:54:36+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "modules\\highgui\\src\\window_cocoa.mm", "file_new_name": "modules\\highgui\\src\\window_cocoa.mm", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "577,578", "deleted_lines": null, "method_info": {"method_name": "cvNamedWindow", "method_params": "name,flags", "method_startline": "540", "method_endline": "594"}}, "hunk_1": {"Ismethod": 1, "added_lines": "301,302,303,304,305,306,307,308", "deleted_lines": "289,290", "method_info": {"method_name": "cvMoveWindow", "method_params": "name,x,y", "method_startline": "288", "method_endline": "313"}}, "hunk_2": {"Ismethod": 1, "added_lines": "257,258,259,260,261,262,263,264,265,266", "deleted_lines": null, "method_info": {"method_name": "cvShowImage", "method_params": "name,arr", "method_startline": "212", "method_endline": "272"}}}}}}}