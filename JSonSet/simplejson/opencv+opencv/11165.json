{"BR": {"BR_id": "11165", "BR_author": "haydenhsieh", "BRopenT": "2018-03-27T01:24:57Z", "BRcloseT": "2018-03-29T13:47:32Z", "BR_text": {"BRsummary": "Segmentation fault when save UMat by cv::imwrite", "BRdescription": "\n <denchmark-h:h5>System information (version)</denchmark-h>\n \n \n OpenCV => 3.4.1\n Operating System / Platform => Ubuntu 16.04.4 LTS(4.4.0-116-generic)\n Compiler => g++ (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609\n \n <denchmark-h:h5>Detailed description</denchmark-h>\n \n Segmentation fault when save UMat by cv::imwrite.\n The img_vec is 0 size when argument _img is UMat type.\n <denchmark-code>    std::vector<Mat> img_vec;\n     //Did we get a Mat or a vector of Mats?\n     if (_img.isMat())\n         img_vec.push_back(_img.getMat());\n     else if (_img.isMatVector())\n         _img.getMatVector(img_vec);\n \n     return imwrite_(filename, img_vec, params, false);\n </denchmark-code>\n \n <denchmark-h:h5>Steps to reproduce</denchmark-h>\n \n <denchmark-code>Mat img = imread(argv[1]);\n UMat umat_img = img.getUMat(ACCESS_RW);\n imwrite(\"output.png\", umat_img);\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "haydenhsieh", "commentT": "2018-03-28T04:21:35Z", "comment_text": "\n \t\tThe problem is that that bit of code was ignorant of UMat's and its vectors. I created a PR that addresses this: <denchmark-link:https://github.com/opencv/opencv/pull/11176>#11176</denchmark-link>\n  . This is a touchy area of image loading and saving and I would appreciate someone's kind review to see if the proposed solution is fine. :)\n \t\t"}}}, "commit": {"commit_id": "6d83a8038525cf64b0edd866ebbd94906eb5691d", "commit_author": "RAJKIRAN NATARAJAN", "commitT": "2018-03-29 16:47:31+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\imgcodecs\\src\\loadsave.cpp", "file_new_name": "modules\\imgcodecs\\src\\loadsave.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "720,722,724,725,727", "deleted_lines": "720,722", "method_info": {"method_name": "cv::imwrite", "method_params": "filename,_img,params", "method_startline": "714", "method_endline": "729"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\imgcodecs\\test\\test_read_write.cpp", "file_new_name": "modules\\imgcodecs\\test\\test_read_write.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148", "deleted_lines": null, "method_info": {"method_name": "opencv_test::TEST", "method_params": "Imgcodecs_Image,write_umat", "method_startline": "132", "method_endline": "148"}}}}}}}