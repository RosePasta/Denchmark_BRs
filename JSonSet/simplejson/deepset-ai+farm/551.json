{"BR": {"BR_id": "551", "BR_author": "ftesser", "BRopenT": "2020-09-21T13:32:33Z", "BRcloseT": "2020-10-08T05:26:01Z", "BR_text": {"BRsummary": "Natural Questions Inference return just one prediction result if there are more than one questions", "BRdescription": "\n Describe the bug\n Given a QA_input dictionary with more than one question e.g.:\n  QA_input = [\n         {\n             \"qas\": [\"Did GameTrailers rated Twilight Princess as one of the best games ever created?\", \"Did GameTrailers rated Twilight Princess as one of the worst games ever created?\"],\n             \"context\":  \"Twilight Princess was released to universal critical acclaim and commercial success. It received perfect scores from major publications such as 1UP.com, Computer and Video Games, Electronic Gaming Monthly, Game Informer, GamesRadar, and GameSpy. On the review aggregators GameRankings and Metacritic, Twilight Princess has average scores of 95% and 95 for the Wii version and scores of 95% and 96 for the GameCube version. GameTrailers in their review called it one of the greatest games ever created.\"\n         }\n     ]\n the returned inference object:\n result = model.inference_from_dicts(dicts=QA_input, return_json=False)\n is a list that contains just one QApred object:\n [<farm.modeling.predictions.QAPred object at 0x7f50dcb73e20>]\n that contains just the results for the first question.\n Expected behavior\n Do return a list of QAPred objects of the same size of the number questions listed in qas (like the \"normal\" Squad model does).\n Additional context\n I understand that probably the reason of that is because the original NQ dataset contains just a question for each document, but I think that the API user it expect to receive answers for each question (or at least to be warned that Natural Questions Inference return just one prediction also of there are more questions).\n To Reproduce\n Modify  the QA_input in examples/natural_questions.py adding one or more questions (like above).\n Then run examples/natural_questions.py (to save time: the same error is obtained  running the script just from point 9 (\n \n \n FARM/examples/natural_questions.py\n \n \n          Line 125\n       in\n       c6871b6\n \n \n \n \n \n \n  # 9. Since training on the whole NQ corpus requires substantial compute resources we trained and uploaded a model on s3 \n \n \n \n \n )\n System:\n \n OS:\n GPU/CPU:\n FARM version:\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ftesser", "commentT": "2020-09-21T14:02:22Z", "comment_text": "\n \t\tHey thanks for raising this issue, agreed this is unexpected behaviour but I would not necessarily call it a bug. We are currently refactoring the input dicts and will possibly handle this case differently.\n As you suggested: a warning message would be nice for now. Would you like to create a PR with it?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ftesser", "commentT": "2020-09-23T09:43:22Z", "comment_text": "\n \t\tHello <denchmark-link:https://github.com/Timoeller>@Timoeller</denchmark-link>\n , yes I will make a PR for a warning message.\n But I really like to have this feature in FARM, I am going to explain why:\n In some scenarios, given a document, it is usual to make several questions for the same document, making just one call of:\n result = model.inference_from_dicts(dicts=QA_input, return_json=False)\n is more efficient because the tokenization (and feature computation?) of the document is made just one time for document.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "ftesser", "commentT": "2020-09-23T09:47:27Z", "comment_text": "\n \t\tThis is a good idea we also were trying to implement,\n but at least the feature computation has to be handled on one question + one document level, since question and doc text is concatenated when put into the language model.\n The time it takes to tokenize a doc is really negligible, especially with fast tokenizers. So tokenizing twice to have a more clear structure and readable code is something we decided to go for. Do you agree with this?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "ftesser", "commentT": "2020-09-23T10:09:37Z", "comment_text": "\n \t\tOK, you are right about feature computation (my fault). I just experiments some differences in performances between squadprocessor and naturalquestionprocessor, and I was thinking about the re-tokenization.\n I will make a try with fast tokenizers.\n I agree that the structure is more clear with the constraint of [one doc + one question], and if the tokenization time is negligible I agree that is simple to manage that structure.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "ftesser", "commentT": "2020-10-05T20:33:01Z", "comment_text": "\n \t\tPlease <denchmark-link:https://github.com/Timoeller>@Timoeller</denchmark-link>\n  see this last PR <denchmark-link:https://github.com/deepset-ai/FARM/pull/565>#565</denchmark-link>\n .\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "ftesser", "commentT": "2020-10-07T17:15:05Z", "comment_text": "\n \t\tThanks for adding the warning. Is it ok with you if we close this issue now while still working on a solution for including multiple questions in NQ inferencing?\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "ftesser", "commentT": "2020-10-08T05:26:01Z", "comment_text": "\n \t\tYes, it is ok. Thanks!\n \t\t"}}}, "commit": {"commit_id": "2ea428f81d82de8edf2c5f92fe885980ddd48384", "commit_author": "ftesser", "commitT": "2020-10-07 19:13:08+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "farm\\infer.py", "file_new_name": "farm\\infer.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "13,658,659,660,661", "deleted_lines": "13"}}}}}}