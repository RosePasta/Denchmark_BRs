{"BR": {"BR_id": "1051", "BR_author": "deliahu", "BRopenT": "2020-05-09T15:52:39Z", "BRcloseT": "2020-05-11T11:38:39Z", "BR_text": {"BRsummary": "Adding certain pip and/or conda packages removes pre-installed packages", "BRdescription": "\n <denchmark-h:h4>Version</denchmark-h>\n \n 0.16, master\n <denchmark-h:h4>Steps to reproduce</denchmark-h>\n \n 1. deploy a gpu cluster (SSHing into a GPU machine and running locally should work too)\n 2. modify examples/pytorch/iris-classifier as follows:\n update requirements.txt to be:\n <denchmark-code>torch\n scikit-learn\n \n asciitree==0.3.3\n gin-config==0.3.0\n requests==2.23.0\n tensorboard==2.2.1\n tqdm==4.30.0\n OpenNMT-py==1.1.1\n </denchmark-code>\n \n create conda-packages.txt:\n <denchmark-code>conda-forge::boto3=1.12.39=pyh9f0ad1d_0\n chembl::chembl_structure_pipeline=1.0.0=py38_0\n cudatoolkit=10.1.243=h6bb024c_0\n cudnn=7.6.5=cuda10.1_0\n conda-forge::matplotlib=3.1.3=py37_0\n conda-forge::networkx=2.4=py_1\n conda-forge::numpy=1.18.1=py37h8960a57_1\n conda-forge::pandas=1.0.3=py37h0da4684_1\n conda-forge::pathos=0.2.5=py_0\n defaults::python=3.7.7=hcf32534_0_cpython\n pytorch::pytorch=1.5.0=py3.7_cuda10.1.243_cudnn7.6.3_0\n conda-forge::rdkit=2020.03.1=py37hdd87690_3\n conda-forge::scipy=1.4.1=py37ha3d9a3c_3\n </denchmark-code>\n \n update cortex.yaml to be:\n - name: iris-classifier\n   predictor:\n     type: python\n     path: predictor.py\n     image: cortexlabs/python-predictor-gpu-slim:master\n     config:\n       model: s3://cortex-examples/pytorch/iris-classifier/weights.pth\n   monitoring:\n     model_type: classification\n   compute:\n     cpu: 3\n     gpu: 1\n     mem: 15G\n if you are running off the 0.16 branch, replace image: cortexlabs/python-predictor-gpu-slim:master with image: cortexlabs/python-predictor-gpu-slim:0.16.0\n \n \n cortex deploy\n \n \n cortex logs iris-classifier will show this error:\n \n \n <denchmark-code>ModuleNotFoundError: No module named 'uvicorn'\n </denchmark-code>\n \n <denchmark-h:h4>Additional context</denchmark-h>\n \n It seems that all of the pre-installed cortex packages are removed or not able to be found. When appending the cortex-required packages to the requirements.txt above, the API works:\n <denchmark-code>torch\n scikit-learn\n \n asciitree==0.3.3\n gin-config==0.3.0\n requests==2.23.0\n tensorboard==2.2.1\n tqdm==4.30.0\n OpenNMT-py==1.1.1\n \n boto3==1.12.31\n datadog==0.35.0\n dill==0.3.1.1\n fastapi==0.53.0\n msgpack==1.0.0\n numpy==1.18.2\n pyyaml==5.3.1\n requests==2.23.0\n uvicorn==0.11.3\n </denchmark-code>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "32343f21686903c14e1759f0a8e28fc598cdd9f2", "commit_author": "Robert Lucian Chiriac", "commitT": "2020-05-11 07:38:38-04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\deployments\\python-packages.md", "file_new_name": "docs\\deployments\\python-packages.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "81,82", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pkg\\workloads\\cortex\\serve\\run.sh", "file_new_name": "pkg\\workloads\\cortex\\serve\\run.sh", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "45,46,47,49,50,51,52,53,54,55,56,57", "deleted_lines": null}}}}}}