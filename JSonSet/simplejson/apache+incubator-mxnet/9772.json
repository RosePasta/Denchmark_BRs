{"BR": {"BR_id": "9772", "BR_author": "ashishlal", "BRopenT": "2018-02-12T19:32:14Z", "BRcloseT": "2018-04-16T03:50:47Z", "BR_text": {"BRsummary": "ndarray indexing issues", "BRdescription": "\n I am new to mxnet. I just installed mxnet 1.0.0 and python 3.5 on a Ubuntu 14.04 machine with CUDA 8.0 and cudnn 7.0.5.\n My code is given below. I am trying to store image data in an ndarray. (see <denchmark-link:https://github.com/ypwhs/DogBreed_gluon/blob/master/get_features_v3.ipynb>https://github.com/ypwhs/DogBreed_gluon/blob/master/get_features_v3.ipynb</denchmark-link>\n  for the original code) -\n <denchmark-code>X_224 = nd.zeros((n, 3, 224, 224))\n X_299 = nd.zeros((n, 3, 299, 299))\n \n mean = np.array([0.485, 0.456, 0.406])\n std = np.array([0.229, 0.224, 0.225])\n \n for i, (fname, breed) in tqdm(df.iterrows(), total=n):\n     img = cv2.imread('data/train/%s.jpg' % fname)\n     img_224 = ((cv2.resize(img, (224, 224))[:, :, ::-1] / 255.0 - mean) / std).transpose((2, 0, 1))\n     img_299 = ((cv2.resize(img, (299, 299))[:, :, ::-1] / 255.0 - mean) / std).transpose((2, 0, 1))\n \n     X_224[i] = nd.array(img_224) <-- I get error in this line\n     X_299[i] = nd.array(img_299)\n </denchmark-code>\n \n ValueError: Indexing NDArray with index=0 and type=class 'numpy.int64' is not supported.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ashishlal", "commentT": "2018-02-13T17:52:31Z", "comment_text": "\n \t\tIssue is that isinstance is not working as expected by the code and returns false in python3. Workaround is to force the type of i to be int instead of numpy.int64.  I think this should also be fixed on the mxnet side. The problem is that we are calling isinstance with int and in the check isinstance(np.int64, int) is not reliable (<denchmark-link:https://github.com/numpy/numpy/issues/2951>numpy/numpy#2951</denchmark-link>\n ). Please see: <denchmark-link:https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/ndarray/ndarray.py#L2039>https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/ndarray/ndarray.py#L2039</denchmark-link>\n . The suggested fix is to check with np.integer for numpy data types. WDYT <denchmark-link:https://github.com/reminisce>@reminisce</denchmark-link>\n  ?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ashishlal", "commentT": "2018-02-15T00:16:01Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/reminisce>@reminisce</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "ashishlal", "commentT": "2018-02-15T02:23:40Z", "comment_text": "\n \t\tThe problem is that in MXNet, integer_types are defined as native python integer types: int and long, while np.int32 and np.int64 are different classes. That's why isinstance check failed. This happens for both python2 and python3.\n <denchmark-link:https://github.com/piiswrong>@piiswrong</denchmark-link>\n  Is there any concern of adding  and  to the definition of  here?\n <denchmark-link:https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/base.py#L40>https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/base.py#L40</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "ashishlal", "commentT": "2018-02-15T03:29:07Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/reminisce>@reminisce</denchmark-link>\n  I wasnt able to reproduce the issue for python 2. The int type changed in python3 and the type is not related to numpy classes\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "ashishlal", "commentT": "2018-02-15T03:34:31Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/anirudh2290>@anirudh2290</denchmark-link>\n  Have you tried the following?\n Python 2.7.14 |Anaconda custom (64-bit)| (default, Oct  5 2017, 02:28:52) \n [GCC 4.2.1 Compatible Clang 4.0.1 (tags/RELEASE_401/final)] on darwin\n Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n >>> import mxnet as mx\n /Users/jwum/anaconda2/lib/python2.7/site-packages/h5py/__init__.py:34: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.\n   from ._conv import register_converters as _register_converters\n /Users/jwum/anaconda2/lib/python2.7/site-packages/mxnet-1.1.0-py2.7.egg/mxnet/optimizer.py:136: UserWarning: WARNING: New optimizer mxnet.optimizer.NAG is overriding existing optimizer mxnet.optimizer.NAG\n   Optimizer.opt_registry[name].__name__))\n imp/Users/jwum/anaconda2/lib/python2.7/site-packages/urllib3/contrib/pyopenssl.py:46: DeprecationWarning: OpenSSL.rand is deprecated - you should use os.urandom instead\n   import OpenSSL.SSL\n >>> import numpy as np\n >>> a = np.array([0], dtype='int32')\n >>> b = mx.nd.array(a)\n >>> b[a[0]]\n Traceback (most recent call last):\n   File \"<stdin>\", line 1, in <module>\n   File \"/Users/jwum/anaconda2/lib/python2.7/site-packages/mxnet-1.1.0-py2.7.egg/mxnet/ndarray/ndarray.py\", line 504, in __getitem__\n     % (str(key), str(type(key))))\n ValueError: Indexing NDArray with index=0 and type=<type 'numpy.int32'> is not supported\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "ashishlal", "commentT": "2018-02-15T04:06:08Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/reminisce>@reminisce</denchmark-link>\n  away from laptop. Will give that a try. Tried with np.int64\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "ashishlal", "commentT": "2018-02-15T06:25:39Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/reminisce>@reminisce</denchmark-link>\n  verified that it works for np.int64 on python2, doesn't work for np.int32. For python3, it doesnt work for either np.int32 or np.int64. This is probably because in python2, the int is 64 bit because of python build on my machine and isinstance check passed for np.int64. In python3 since int is changed and is not related to np.int32 or np.int64,  it fails isinstance checks for both np.int32 and np.int64.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "ashishlal", "commentT": "2018-04-14T06:56:25Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ashishlal>@ashishlal</denchmark-link>\n  related pr merged. can this be closed ?\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "ashishlal", "commentT": "2018-04-16T03:50:47Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/apache/incubator-mxnet/pull/10434>#10434</denchmark-link>\n  fixes this\n \t\t"}}}, "commit": {"commit_id": "4fb5241b47c8147690fd6408b55cb694d544656e", "commit_author": "reminisce", "commitT": "2018-04-07 19:08:15-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\mxnet\\base.py", "file_new_name": "python\\mxnet\\base.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "40,47", "deleted_lines": "40,47"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tests\\python\\unittest\\test_ndarray.py", "file_new_name": "tests\\python\\unittest\\test_ndarray.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1065,1066,1067,1068,1069", "deleted_lines": "1068,1069", "method_info": {"method_name": "test_ndarray_indexing.test_ndarray_indexing.np_int.convert", "method_params": "num", "method_startline": "1065", "method_endline": "1069"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,1104,1105,1106,1107,1108,1109,1110,1111,1112,1113,1115,1116,1118,1119,1120,1121,1122,1123,1124,1125,1127,1128,1130,1131,1133,1134,1136,1137,1142,1144,1146,1148,1150,1152,1154,1156,1158,1160", "deleted_lines": "1068,1069,1070,1071,1072,1075", "method_info": {"method_name": "test_ndarray_indexing", "method_params": "", "method_startline": "979", "method_endline": "1177"}}, "hunk_2": {"Ismethod": 1, "added_lines": "1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082", "deleted_lines": "1068,1069,1070,1071,1072,1075", "method_info": {"method_name": "test_ndarray_indexing.np_int", "method_params": "index,int_type", "method_startline": "1064", "method_endline": "1082"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\python\\unittest\\test_sparse_ndarray.py", "file_new_name": "tests\\python\\unittest\\test_sparse_ndarray.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "641,642,643,644,645,646,647,648,649", "deleted_lines": null, "method_info": {"method_name": "test_create_row_sparse", "method_params": "", "method_startline": "625", "method_endline": "649"}}}}}}}