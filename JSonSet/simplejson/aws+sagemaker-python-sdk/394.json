{"BR": {"BR_id": "394", "BR_author": "vbvg2008", "BRopenT": "2018-09-19T03:18:34Z", "BRcloseT": "2018-12-20T21:09:52Z", "BR_text": {"BRsummary": "Using customized tensor name for prediction after deploying the model", "BRdescription": "\n Please fill out the form below.\n <denchmark-h:h3>System Information</denchmark-h>\n \n \n Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans): TensorFlow\n Framework Version: 1.10\n Python Version: 2.7\n CPU or GPU: GPU\n Are you using a custom image: No\n \n <denchmark-h:h3>Describe the problem</denchmark-h>\n \n All of the Sagemaker tensorflow tutorial uses \"inputs\" as the input name for prediction.  for example, in \"tensorflow_resnet_cifar10_with_tensorboard\" example, the prediction is simply done by\n random_image = np.random.rand(32, 32, 3)\n predictor.predict(random_image_data)\n but what if I trained a tensorflow model with a customized input name?  say my model inputs only accepts a dictionary like this:\n inputs = {\"input_image\": tf.placeholder(tf.float32, [None, 32, 32, 3])}\n Although I successfully trained and deployed the model, but when I try to do the prediction such as:\n random_image = np.random.rand(32, 32, 3)\n predictor.predict({'input_image':random_image})\n it gives me error saying my data is not JSON serializable. How do I use a customized name as input name for prediction?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "vbvg2008", "commentT": "2018-09-20T00:31:39Z", "comment_text": "\n \t\tHello <denchmark-link:https://github.com/vbvg2008>@vbvg2008</denchmark-link>\n  ,\n I believe that this issue is related to <denchmark-link:https://github.com/aws/sagemaker-tensorflow-training-toolkit/issues/71>aws/sagemaker-tensorflow-training-toolkit#71</denchmark-link>\n .\n We are in the process to release a newer container with these codefixes. I will update you in this ticket when it happens.\n Thanks for using SageMaker!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "vbvg2008", "commentT": "2018-09-25T22:20:40Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/mvsusp>@mvsusp</denchmark-link>\n  The problem is fixed on the container side, but now we need to make a fix to the Python SDK to serialize numpy arrays in dicts correctly.\n <denchmark-link:https://github.com/vbvg2008>@vbvg2008</denchmark-link>\n  in the meantime, if you want to unblock yourself, try the workaround described here:\n <denchmark-link:https://github.com/aws/sagemaker-tensorflow-training-toolkit/issues/71#issuecomment-422101489>aws/sagemaker-tensorflow-training-toolkit#71 (comment)</denchmark-link>\n \n Basically, convert your numpy arrays into lists before putting them in the dict.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "vbvg2008", "commentT": "2018-10-05T04:03:02Z", "comment_text": "\n \t\thi <denchmark-link:https://github.com/winstonaws>@winstonaws</denchmark-link>\n ,\n I am running into an issue that seems like it may be related.  I have logged it under issue <denchmark-link:https://github.com/aws/sagemaker-python-sdk/issues/413>#413</denchmark-link>\n .\n If you have any idea on how to coerce my input data into an acceptable format I would very much appreciate it.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "vbvg2008", "commentT": "2018-10-10T17:08:26Z", "comment_text": "\n \t\thi @eL0ck,\n We have merged in a change to accept dicts with numpy arrays on the python sdk side - <denchmark-link:https://github.com/aws/sagemaker-python-sdk/pull/404>#404</denchmark-link>\n  .\n Your original way to do the prediction should work now:\n random_image = np.random.rand(32, 32, 3)\n predictor.predict({'input_image':random_image})\n Please let us know if the problems persists.\n \t\t"}}}, "commit": {"commit_id": "d3ef9813d7b2d2a0072407491d8e318ff5ab1153", "commit_author": "winstonaws", "commitT": "2018-10-04 13:23:07-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.rst", "file_new_name": "CHANGELOG.rst", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "9", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "src\\sagemaker\\predictor.py", "file_new_name": "src\\sagemaker\\predictor.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "270,271", "method_info": {"method_name": "_json_serialize_python_object", "method_params": "data", "method_startline": "270", "method_endline": "271"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "278,279", "method_info": {"method_name": "_json_serialize_object", "method_params": "data", "method_startline": "278", "method_endline": "279"}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "265,266,267", "method_info": {"method_name": "_json_serialize_numpy_array", "method_params": "data", "method_startline": "265", "method_endline": "267"}}, "hunk_3": {"Ismethod": 1, "added_lines": "242,243,249", "deleted_lines": "240,241,242,243,244,245,246,247,248,249", "method_info": {"method_name": "__call__", "method_params": "self,data", "method_startline": "231", "method_endline": "249"}}, "hunk_4": {"Ismethod": 1, "added_lines": "255,256", "deleted_lines": null, "method_info": {"method_name": "_ndarray_to_list", "method_params": "data", "method_startline": "255", "method_endline": "256"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "tests\\unit\\test_predictor.py", "file_new_name": "tests\\unit\\test_predictor.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "66", "deleted_lines": "65,66", "method_info": {"method_name": "test_json_serializer_python_dictionary_invalid_empty", "method_params": "", "method_startline": "65", "method_endline": "66"}}, "hunk_1": {"Ismethod": 1, "added_lines": "43,44", "deleted_lines": "43,44,45,46,47", "method_info": {"method_name": "test_json_serializer_numpy_invalid_empty", "method_params": "", "method_startline": "43", "method_endline": "47"}}, "hunk_2": {"Ismethod": 1, "added_lines": "62", "deleted_lines": null, "method_info": {"method_name": "test_json_serializer_python_invalid_empty", "method_params": "", "method_startline": "61", "method_endline": "62"}}, "hunk_3": {"Ismethod": 1, "added_lines": "43,44", "deleted_lines": "43,44", "method_info": {"method_name": "test_json_serializer_empty", "method_params": "", "method_startline": "43", "method_endline": "44"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tests\\unit\\test_tf_predictor.py", "file_new_name": "tests\\unit\\test_tf_predictor.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "341,342,343,344,345,346", "deleted_lines": null, "method_info": {"method_name": "test_json_serialize_dict", "method_params": "", "method_startline": "341", "method_endline": "346"}}, "hunk_1": {"Ismethod": 1, "added_lines": "349,350,351,352,353,354", "deleted_lines": null, "method_info": {"method_name": "test_json_serialize_dict_with_numpy", "method_params": "", "method_startline": "349", "method_endline": "354"}}, "hunk_2": {"Ismethod": 1, "added_lines": "357,358,359", "deleted_lines": null, "method_info": {"method_name": "test_json_serialize_numpy", "method_params": "", "method_startline": "357", "method_endline": "359"}}}}}}}