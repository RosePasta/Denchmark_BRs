{"BR": {"BR_id": "1011", "BR_author": "amchang", "BRopenT": "2019-08-29T20:42:45Z", "BRcloseT": "2019-09-09T17:48:46Z", "BR_text": {"BRsummary": "Bug: Cannot use spot instances with hyperparameter tuning job", "BRdescription": "\n Please fill out the form below.\n <denchmark-h:h3>System Information</denchmark-h>\n \n \n Python Version:\n 3.6.9\n Python SDK Version:\n 1.38.3\n \n <denchmark-h:h3>Describe the problem</denchmark-h>\n \n Not possible to use spot instances with the hyperparameter tuning job.\n <denchmark-h:h3>Minimal repro / logs</denchmark-h>\n \n <denchmark-link:https://github.com/aws/sagemaker-python-sdk/blob/9765de68ad8b776740d800148c861ca0e4794716/src/sagemaker/job.py>https://github.com/aws/sagemaker-python-sdk/blob/9765de68ad8b776740d800148c861ca0e4794716/src/sagemaker/job.py</denchmark-link>\n \n Doesn't appear at all to copy over the train_use_spot_instances attribute of an estimator yet even though train_max_wait is used when set. This is problematic as you cannot use spot instances for hyperparameter tuning even though you can for individual tuning to the point where it's an issue if train_max_wait is set.\n File \"/lib/python3.6/site-packages/sagemaker/tuner.py\", line 362, in fit\n self.latest_tuning_job = _TuningJob.start_new(self, inputs)\n File \"/lib/python3.6/site-packages/sagemaker/tuner.py\", line 893, in start_new\n tuner.estimator.sagemaker_session.tune(**tuner_args)\n File \"/lib/python3.6/site-packages/sagemaker/session.py\", line 574, in tune\n self.sagemaker_client.create_hyper_parameter_tuning_job(**tune_request)\n File \"/lib/python3.6/site-packages/botocore/client.py\", line 357, in _api_call\n return self._make_api_call(operation_name, kwargs)\n File \"/lib/python3.6/site-packages/botocore/client.py\", line 661, in _make_api_call\n raise error_class(parsed_response, operation_name)\n botocore.exceptions.ClientError: An error occurred (ValidationException) when calling the CreateHyperParameterTuningJob operation: Invalid MaxWaitTimeInSeconds. It is only supported when EnableManagedSpotTraining is set to true\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "amchang", "commentT": "2019-09-01T14:54:46Z", "comment_text": "\n \t\tI also encountered the same problem. I will send a pull request later.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "amchang", "commentT": "2019-09-09T17:48:46Z", "comment_text": "\n \t\tfix has been released: <denchmark-link:https://github.com/aws/sagemaker-python-sdk/blob/master/CHANGELOG.md#v1390-2019-09-09>https://github.com/aws/sagemaker-python-sdk/blob/master/CHANGELOG.md#v1390-2019-09-09</denchmark-link>\n .\n \t\t"}}}, "commit": {"commit_id": "c70110079bc6d53f8004605df4b3f82b0dcd2377", "commit_author": "Takahiro Yano", "commitT": "2019-09-04 15:09:01-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\sagemaker\\session.py", "file_new_name": "src\\sagemaker\\session.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "428", "deleted_lines": "428", "method_info": {"method_name": "tune", "method_params": "self,job_name,strategy,objective_type,objective_metric_name,max_jobs,max_parallel_jobs,parameter_ranges,static_hyperparameters,input_mode,metric_definitions,role,input_config,output_config,resource_config,stop_condition,tags,warm_start_config,enable_network_isolation,image,algorithm_arn,early_stopping_type,encrypt_inter_container_traffic,vpc_config", "method_startline": "428", "method_endline": "452"}}, "hunk_1": {"Ismethod": 1, "added_lines": "428,453,454,455", "deleted_lines": "428", "method_info": {"method_name": "tune", "method_params": "self,job_name,strategy,objective_type,objective_metric_name,max_jobs,max_parallel_jobs,parameter_ranges,static_hyperparameters,input_mode,metric_definitions,role,input_config,output_config,resource_config,stop_condition,tags,warm_start_config,enable_network_isolation,image,algorithm_arn,early_stopping_type,encrypt_inter_container_traffic,vpc_config,train_use_spot_instances,checkpoint_s3_uri,checkpoint_local_path", "method_startline": "428", "method_endline": "455"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\sagemaker\\tuner.py", "file_new_name": "src\\sagemaker\\tuner.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "893,894,895,896", "deleted_lines": null, "method_info": {"method_name": "start_new", "method_params": "cls,tuner,inputs", "method_startline": "839", "method_endline": "899"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\unit\\test_session.py", "file_new_name": "tests\\unit\\test_session.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "569,570,571,572,573,574,575,576,577,578,579,580,581,582,583", "deleted_lines": null, "method_info": {"method_name": "test_tune_with_spot_and_checkpoints.assert_create_tuning_job_request", "method_params": "kwrags", "method_startline": "569", "method_endline": "583"}}, "hunk_1": {"Ismethod": 1, "added_lines": "568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610", "deleted_lines": null, "method_info": {"method_name": "test_tune_with_spot_and_checkpoints", "method_params": "sagemaker_session", "method_startline": "568", "method_endline": "610"}}}}}}}