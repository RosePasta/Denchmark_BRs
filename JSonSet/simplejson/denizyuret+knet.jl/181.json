{"BR": {"BR_id": "181", "BR_author": "swiesend", "BRopenT": "2017-10-23T20:49:39Z", "BRcloseT": "2017-11-29T16:44:54Z", "BR_text": {"BRsummary": "curand.curandCreateGenerator error 203 in notebook examples/softmax.ipynb", "BRdescription": "\n When I try to run the MLP with the dropout function at <denchmark-link:https://github.com/denizyuret/Knet.jl/blame/master/examples/softmax.ipynb#L673-L687>MLP with dropout</denchmark-link>\n , then CUDA complains with:\n curand.curandCreateGenerator error 203\n \n Stacktrace:\n  [1] macro expansion at /home/sebastian/.julia/v0.6/Knet/src/gpu.jl:13 [inlined]\n  [2] rng(::Bool) at /home/sebastian/.julia/v0.6/Knet/src/random.jl:13\n  [3] rand!(::Knet.KnetArray{Float32,2}) at /home/sebastian/.julia/v0.6/Knet/src/random.jl:4\n  [4] dropout(::Knet.KnetArray{Float32,2}, ::Float64) at ./In[71]:4\n  [5] #mlp#78(::Tuple{Float64,Int64}, ::Function, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}) at ./In[71]:11\n  [6] (::#kw##mlp)(::Array{Any,1}, ::#mlp, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}) at ./<missing>:0\n  [7] #softloss#5(::Int64, ::Int64, ::Array{Any,1}, ::Function, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}, ::Knet.KnetArray{Float32,2}, ::#mlp) at ./In[14]:4\n  [8] (::#kw##softloss)(::Array{Any,1}, ::#softloss, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}, ::Knet.KnetArray{Float32,2}, ::Function) at ./<missing>:0\n  [9] forward_pass(::Function, ::Tuple{Array{Knet.KnetArray{Float32,2},1},Knet.KnetArray{Float32,2},Knet.KnetArray{Float32,2},#mlp}, ::Array{Any,1}, ::Int64) at /home/sebastian/.julia/v0.6/AutoGrad/src/core.jl:88\n  [10] (::AutoGrad.##gradfun#1#3{#softloss,Int64})(::Array{Any,1}, ::Function, ::Array{Knet.KnetArray{Float32,2},1}, ::Vararg{Any,N} where N) at /home/sebastian/.julia/v0.6/AutoGrad/src/core.jl:39\n  [11] (::AutoGrad.#kw##gradfun#2)(::Array{Any,1}, ::AutoGrad.#gradfun#2, ::Array{Knet.KnetArray{Float32,2},1}, ::Vararg{Any,N} where N) at ./<missing>:0\n  [12] #train#12(::Int64, ::Float64, ::Array{Any,1}, ::Function, ::Array{Knet.KnetArray{Float32,2},1}, ::Array{Any,1}, ::Function) at ./In[32]:6\n  [13] (::#kw##train)(::Array{Any,1}, ::#train, ::Array{Knet.KnetArray{Float32,2},1}, ::Array{Any,1}, ::Function) at ./<missing>:0\n  [14] include_string(::String, ::String) at ./loading.jl:515\n Is this a CUDA configuration problem or maybe even a Hardware issue? Or did I hit some deprecated code/example?\n Thank you for making this great library available and the neat examples, which really help me to get started again with NNs in general and Knet in specific!\n I develop on  with the offical <denchmark-link:https://developer.nvidia.com/cuda-downloads?target_os=Linux&target_arch=x86_64&target_distro=Ubuntu&target_version=1604&target_type=deblocal>.deb</denchmark-link>\n  package installed.\n Here some additional info about my device:\n <denchmark-code>sebastian@home:~/develop/cuda/samples/NVIDIA_CUDA-9.0_Samples/bin/x86_64/linux/release$ ./deviceQuery\n ./deviceQuery Starting...\n \n  CUDA Device Query (Runtime API) version (CUDART static linking)\n \n Detected 1 CUDA Capable device(s)\n \n Device 0: \"GeForce 940M\"\n   CUDA Driver Version / Runtime Version          9.0 / 9.0\n   CUDA Capability Major/Minor version number:    5.0\n   Total amount of global memory:                 2003 MBytes (2100232192 bytes)\n   ( 3) Multiprocessors, (128) CUDA Cores/MP:     384 CUDA Cores\n   GPU Max Clock rate:                            1176 MHz (1.18 GHz)\n   Memory Clock rate:                             900 Mhz\n   Memory Bus Width:                              64-bit\n   L2 Cache Size:                                 1048576 bytes\n   Maximum Texture Dimension Size (x,y,z)         1D=(65536), 2D=(65536, 65536), 3D=(4096, 4096, 4096)\n   Maximum Layered 1D Texture Size, (num) layers  1D=(16384), 2048 layers\n   Maximum Layered 2D Texture Size, (num) layers  2D=(16384, 16384), 2048 layers\n   Total amount of constant memory:               65536 bytes\n   Total amount of shared memory per block:       49152 bytes\n   Total number of registers available per block: 65536\n   Warp size:                                     32\n   Maximum number of threads per multiprocessor:  2048\n   Maximum number of threads per block:           1024\n   Max dimension size of a thread block (x,y,z): (1024, 1024, 64)\n   Max dimension size of a grid size    (x,y,z): (2147483647, 65535, 65535)\n   Maximum memory pitch:                          2147483647 bytes\n   Texture alignment:                             512 bytes\n   Concurrent copy and kernel execution:          Yes with 1 copy engine(s)\n   Run time limit on kernels:                     Yes\n   Integrated GPU sharing Host Memory:            No\n   Support host page-locked memory mapping:       Yes\n   Alignment requirement for Surfaces:            Yes\n   Device has ECC support:                        Disabled\n   Device supports Unified Addressing (UVA):      Yes\n   Supports Cooperative Kernel Launch:            No\n   Supports MultiDevice Co-op Kernel Launch:      No\n   Device PCI Domain ID / Bus ID / location ID:   0 / 1 / 0\n   Compute Mode:\n      < Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) >\n \n deviceQuery, CUDA Driver = CUDART, CUDA Driver Version = 9.0, CUDA Runtime Version = 9.0, NumDevs = 1\n Result = PASS\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "swiesend", "commentT": "2017-10-24T09:22:04Z", "comment_text": "\n \t\tAccording to curand.h error 203 is CURAND_STATUS_INITIALIZATION_FAILED.\n \n One theory is that you may have run out of gpu memory before curand was\n initialized (Knet greedily grabs as much gpu memory as it needs).  If that\n is the problem, then calling curand (e.g. by using rand!(::KnetArray)) in\n the beginning, before running training etc. will initialize the library\n when memory is plenty.  Let me know if this solves the problem and I will\n try to automate this in Knet initialization.\n \n best,\n deniz\n <denchmark-link:#>\u2026</denchmark-link>\n \n \n On Mon, Oct 23, 2017 at 11:49 PM Sebastian Wiesendahl < ***@***.***> wrote:\n  When I try to run the MLP with the dropout function at MLP with *dropout*\n  <https://github.com/denizyuret/Knet.jl/blame/master/examples/softmax.ipynb#L673-L687>,\n  then CUDA complains with:\n \n  curand.curandCreateGenerator error 203\n \n  Stacktrace:\n   [1] macro expansion at /home/sebastian/.julia/v0.6/Knet/src/gpu.jl:13 [inlined]\n   [2] rng(::Bool) at /home/sebastian/.julia/v0.6/Knet/src/random.jl:13\n   [3] rand!(::Knet.KnetArray{Float32,2}) at /home/sebastian/.julia/v0.6/Knet/src/random.jl:4\n   [4] dropout(::Knet.KnetArray{Float32,2}, ::Float64) at ./In[71]:4\n   [5] #mlp#78(::Tuple{Float64,Int64}, ::Function, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}) at ./In[71]:11\n   [6] (::#kw##mlp)(::Array{Any,1}, ::#mlp, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}) at ./<missing>:0\n   [7] #softloss#5(::Int64, ::Int64, ::Array{Any,1}, ::Function, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}, ::Knet.KnetArray{Float32,2}, ::#mlp) at ./In[14]:4\n   [8] (::#kw##softloss)(::Array{Any,1}, ::#softloss, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}, ::Knet.KnetArray{Float32,2}, ::Function) at ./<missing>:0\n   [9] forward_pass(::Function, ::Tuple{Array{Knet.KnetArray{Float32,2},1},Knet.KnetArray{Float32,2},Knet.KnetArray{Float32,2},#mlp}, ::Array{Any,1}, ::Int64) at /home/sebastian/.julia/v0.6/AutoGrad/src/core.jl:88\n   [10] (::AutoGrad.##gradfun#1#3{#softloss,Int64})(::Array{Any,1}, ::Function, ::Array{Knet.KnetArray{Float32,2},1}, ::Vararg{Any,N} where N) at /home/sebastian/.julia/v0.6/AutoGrad/src/core.jl:39\n   [11] (::AutoGrad.#kw##gradfun#2)(::Array{Any,1}, ::AutoGrad.#gradfun#2, ::Array{Knet.KnetArray{Float32,2},1}, ::Vararg{Any,N} where N) at ./<missing>:0\n   [12] #train#12(::Int64, ::Float64, ::Array{Any,1}, ::Function, ::Array{Knet.KnetArray{Float32,2},1}, ::Array{Any,1}, ::Function) at ./In[32]:6\n   [13] (::#kw##train)(::Array{Any,1}, ::#train, ::Array{Knet.KnetArray{Float32,2},1}, ::Array{Any,1}, ::Function) at ./<missing>:0\n   [14] include_string(::String, ::String) at ./loading.jl:515\n \n  Is this a CUDA configuration problem or maybe even a Hardware issue? Or\n  did I hit some deprecated code/example?\n \n  Thank you for making this great library available and the neat examples,\n  which really help me to get started!\n \n  \u2014\n  You are receiving this because you are subscribed to this thread.\n  Reply to this email directly, view it on GitHub\n  <#181>, or mute the thread\n  <https://github.com/notifications/unsubscribe-auth/ABvNpsiFT2k79JrL4rRAYNZm3t8PpXhrks5svPvkgaJpZM4QDeWF>\n  .\n \n \n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "swiesend", "commentT": "2017-11-01T18:58:51Z", "comment_text": "\n \t\tCurrently, I am having the same error (in my own LeNet example with dropout). I've also tried to convert MNIST data to KnetArray batch by batch in every individual gradient calculation. However, it also fails in that way, too.\n Calling predict function with desired training dropout probability once just before accuracy/lost calculation (where we have zero dropout) solved my problem.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "swiesend", "commentT": "2017-11-17T19:40:46Z", "comment_text": "\n \t\t\n Let me know if this solves the problem and I will try to automate this in Knet initialization.\n \n <denchmark-link:https://github.com/denizyuret>@denizyuret</denchmark-link>\n  doing something like\n rand!(KnetArray(ones(10)))\n solves the problem in my case\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "swiesend", "commentT": "2017-11-17T22:48:12Z", "comment_text": "\n \t\tSorry for replying so late.\n When opening a new REPL, then everything is fine:\n <denchmark-code>julia> using Knet\n \n julia> rand!(KnetArray(ones(10)))\n 10-element Knet.KnetArray{Float64,1}:\n  0.438451 \n  0.460365 \n  0.250215 \n  0.494744 \n  0.0530111\n  0.337699 \n  0.396763 \n  0.874419 \n  0.482167 \n  0.0428398\n </denchmark-code>\n \n When doing rand!(KnetArray(ones(10))) at the beginning of the softmax.ipynb notebook then everything seems to be fine! That trick helped!\n I only get errors when initializing too late. I am not sure if this can be reproduced on others machines than mine. Currently I am running a source built version of Julia v0.6, which was not the case, when I initially posted the question.\n When I run it immediately before the training of the dropout\n rand!(KnetArray(ones(10)))\n srand(1)\n @time trn5=train(winit(64),dtrn,mlp;lr=0.1,pdrop=(0.2,0))\n @time trnloss5 = [ avgloss(w,dtrn,mlp) for w in trn5 ]\n @time tstloss5 = [ avgloss(w,dtst,mlp) for w in trn5 ]\n @time trnerr5 = [ zeroone(w,dtrn,mlp) for w in trn5 ]\n @time tsterr5 = [ zeroone(w,dtst,mlp) for w in trn5 ]\n minimum(tstloss5),minimum(tsterr5)\n then I get:\n <denchmark-code>curand.curandCreateGenerator error 203\n \n Stacktrace:\n  [1] macro expansion at /home/sebastian/.julia/v0.6/Knet/src/gpu.jl:13 [inlined]\n  [2] rng(::Bool) at /home/sebastian/.julia/v0.6/Knet/src/random.jl:13\n  [3] rand!(::Knet.KnetArray{Float64,1}) at /home/sebastian/.julia/v0.6/Knet/src/random.jl:5\n  [4] include_string(::String, ::String) at ./loading.jl:515\n </denchmark-code>\n \n And even before defining dropout, then I get this\n <denchmark-h:h1>MLP with dropout</denchmark-h>\n \n rand!(KnetArray(ones(10)))\n \u200b# Dropout is another way to address overfitting\n function dropout(x,p)\n     if p > 0\n         x .* (rand!(similar(x)) .> p) ./ (1-p)\n     else\n         x\n     end\n end\n \u200b\n function mlp(w,x; pdrop=(0,0))\n     x = dropout(x,pdrop[1])\n     for i=1:2:length(w)-2\n         x = relu.(w[i]*x .+ w[i+1])\n         x = dropout(x,pdrop[2])\n     end\n     return w[end-1]*x .+ w[end]\n end\n <denchmark-code>curand.curandGenerateUniformDouble error 202\n \n Stacktrace:\n  [1] macro expansion at /home/sebastian/.julia/v0.6/Knet/src/gpu.jl:13 [inlined]\n  [2] rand!(::Knet.KnetArray{Float64,1}) at /home/sebastian/.julia/v0.6/Knet/src/random.jl:5\n  [3] include_string(::String, ::String) at ./loading.jl:515\n </denchmark-code>\n \n srand(1)\n @time trn5=train(winit(64),dtrn,mlp;lr=0.1,pdrop=(0.2,0))\n @time trnloss5 = [ avgloss(w,dtrn,mlp) for w in trn5 ]\n @time tstloss5 = [ avgloss(w,dtst,mlp) for w in trn5 ]\n @time trnerr5 = [ zeroone(w,dtrn,mlp) for w in trn5 ]\n @time tsterr5 = [ zeroone(w,dtst,mlp) for w in trn5 ]\n minimum(tstloss5),minimum(tsterr5)\n <denchmark-code>curand.curandGenerateUniform error 102\n \n Stacktrace:\n  [1] macro expansion at /home/sebastian/.julia/v0.6/Knet/src/gpu.jl:13 [inlined]\n  [2] rand!(::Knet.KnetArray{Float32,2}) at /home/sebastian/.julia/v0.6/Knet/src/random.jl:4\n  [3] dropout(::Knet.KnetArray{Float32,2}, ::Float64) at ./In[127]:4\n  [4] #mlp#102(::Tuple{Float64,Int64}, ::Function, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}) at ./In[127]:11\n  [5] (::#kw##mlp)(::Array{Any,1}, ::#mlp, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}) at ./<missing>:0\n  [6] #softloss#30(::Int64, ::Int64, ::Array{Any,1}, ::Function, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}, ::Knet.KnetArray{Float32,2}, ::#mlp) at ./In[69]:4\n  [7] (::#kw##softloss)(::Array{Any,1}, ::#softloss, ::AutoGrad.Rec{Array{Knet.KnetArray{Float32,2},1}}, ::Knet.KnetArray{Float32,2}, ::Knet.KnetArray{Float32,2}, ::Function) at ./<missing>:0\n  [8] forward_pass(::Function, ::Tuple{Array{Knet.KnetArray{Float32,2},1},Knet.KnetArray{Float32,2},Knet.KnetArray{Float32,2},#mlp}, ::Array{Any,1}, ::Int64) at /home/sebastian/.julia/v0.6/AutoGrad/src/core.jl:88\n  [9] (::AutoGrad.##gradfun#1#3{#softloss,Int64})(::Array{Any,1}, ::Function, ::Array{Knet.KnetArray{Float32,2},1}, ::Vararg{Any,N} where N) at /home/sebastian/.julia/v0.6/AutoGrad/src/core.jl:39\n  [10] (::AutoGrad.#kw##gradfun#2)(::Array{Any,1}, ::AutoGrad.#gradfun#2, ::Array{Knet.KnetArray{Float32,2},1}, ::Vararg{Any,N} where N) at ./<missing>:0\n  [11] #train#37(::Int64, ::Float64, ::Array{Any,1}, ::Function, ::Array{Knet.KnetArray{Float32,2},1}, ::Array{Any,1}, ::Function) at ./In[84]:6\n  [12] (::#kw##train)(::Array{Any,1}, ::#train, ::Array{Knet.KnetArray{Float32,2},1}, ::Array{Any,1}, ::Function) at ./<missing>:0\n  [13] include_string(::String, ::String) at ./loading.jl:515\n </denchmark-code>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "swiesend", "commentT": "2017-11-29T16:44:54Z", "comment_text": "\n \t\tI now initialize curand at startup to avoid this issue.\n \t\t"}}}, "commit": {"commit_id": "dcbfe1ad5a7fd59fb2505c14186630a6dec3d36d", "commit_author": "Deniz Yuret", "commitT": "2017-11-29 19:43:52+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\gpu.jl", "file_new_name": "src\\gpu.jl", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "109,110,111,112,116,117,119,122", "deleted_lines": "109,110,115,118"}}}}}}