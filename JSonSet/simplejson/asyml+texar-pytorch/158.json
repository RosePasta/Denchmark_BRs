{"BR": {"BR_id": "158", "BR_author": "TomNong", "BRopenT": "2019-08-17T03:11:13Z", "BRcloseT": "2019-09-05T19:01:56Z", "BR_text": {"BRsummary": "Potential position embedding issue in decoders.", "BRdescription": "\n Currently there is a potential issue in some decoders(e.g. AttentionRNNDecoder) which support position embedder.\n In eval mode, given max_decoding_length, the dynamic_decode will stop at time==max_decoding_length - 1, while decoder helper may pass time = time + 1 to its position embedder. Since position_size of the position embedder  is usually equal to max_decoding_length, inputing time==max_decoding_length will cause index out of range error on position embedder.\n Suggested by <denchmark-link:https://github.com/huzecong>@huzecong</denchmark-link>\n  , \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "TomNong", "commentT": "2019-08-17T15:58:48Z", "comment_text": "\n \t\tA better way to deal with this might be: split decoder.step into two methods, one for computing next_state and output, another for computing the next input. This way we can perform a check in dynamic_decode, without requiring all decoder classes to check for themselves.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "TomNong", "commentT": "2019-08-19T16:35:20Z", "comment_text": "\n \t\tDoes TransformerDecoder have such issue?\n Does Texar-TF have such issue? <denchmark-link:https://github.com/TomNong>@TomNong</denchmark-link>\n  can you double-check?\n Performing the check in dynamic_decode is good. We can refactor the decoder a bit (though I don't know the full details of your suggestion)\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "TomNong", "commentT": "2019-08-19T16:54:05Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ZhitingHu>@ZhitingHu</denchmark-link>\n  For  it does not have such issue.\n For texar-TF, this issue is related with <denchmark-link:https://github.com/asyml/texar/issues/199>asyml/texar#199</denchmark-link>\n , actually we used  to avoid this issue.\n \t\t"}}}, "commit": {"commit_id": "aedf40a55dbe324840186e870fc0e414bb94d0c3", "commit_author": "Pengzhi Gao", "commitT": "2019-09-05 15:01:55-04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "examples\\seq2seq_attn\\seq2seq_attn.py", "file_new_name": "examples\\seq2seq_attn\\seq2seq_attn.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "102", "deleted_lines": "102", "method_info": {"method_name": "forward", "method_params": "self,batch,mode", "method_startline": "71", "method_endline": "107"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "texar\\torch\\modules\\decoders\\decoder_base.py", "file_new_name": "texar\\torch\\modules\\decoders\\decoder_base.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "520,521,522,523,524,525,526,527,528,529,530,531,532", "deleted_lines": null, "method_info": {"method_name": "next_inputs", "method_params": "self,Helper,int,Output", "method_startline": "520", "method_endline": "538"}}, "hunk_1": {"Ismethod": 1, "added_lines": "501", "deleted_lines": null, "method_info": {"method_name": "step", "method_params": "self,Helper,int,Tensor", "method_startline": "499", "method_endline": "501"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "texar\\torch\\modules\\decoders\\rnn_decoder_base.py", "file_new_name": "texar\\torch\\modules\\decoders\\rnn_decoder_base.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "215,216", "deleted_lines": null, "method_info": {"method_name": "next_inputs", "method_params": "self,Helper,int,Output", "method_startline": "215", "method_endline": "217"}}, "hunk_1": {"Ismethod": 1, "added_lines": "212", "deleted_lines": "212", "method_info": {"method_name": "step", "method_params": "self,Helper,int,Tensor", "method_startline": "210", "method_endline": "212"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "texar\\torch\\modules\\decoders\\rnn_decoders.py", "file_new_name": "texar\\torch\\modules\\decoders\\rnn_decoders.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "249,250,251", "deleted_lines": "250", "method_info": {"method_name": "next_inputs", "method_params": "self,Helper,int,BasicRNNDecoderOutput", "method_startline": "249", "method_endline": "251"}}, "hunk_1": {"Ismethod": 1, "added_lines": "239,240,241", "deleted_lines": "239,240,241", "method_info": {"method_name": "step", "method_params": "self,Helper,int,Tensor", "method_startline": "239", "method_endline": "241"}}, "hunk_2": {"Ismethod": 1, "added_lines": "591,592,593", "deleted_lines": null, "method_info": {"method_name": "next_inputs", "method_params": "self,Helper,int,AttentionRNNDecoderOutput", "method_startline": "591", "method_endline": "593"}}, "hunk_3": {"Ismethod": 1, "added_lines": "572,573,574", "deleted_lines": null, "method_info": {"method_name": "step", "method_params": "self,Helper,int,Tensor", "method_startline": "572", "method_endline": "574"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "texar\\torch\\modules\\decoders\\transformer_decoders.py", "file_new_name": "texar\\torch\\modules\\decoders\\transformer_decoders.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "752,753,754", "deleted_lines": "752,753,754", "method_info": {"method_name": "next_inputs", "method_params": "self,Helper,int,TransformerDecoderOutput", "method_startline": "752", "method_endline": "754"}}, "hunk_1": {"Ismethod": 1, "added_lines": "733,734,735", "deleted_lines": "734,735", "method_info": {"method_name": "step", "method_params": "self,Helper,int,Tensor", "method_startline": "733", "method_endline": "735"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "texar\\torch\\modules\\decoders\\xlnet_decoder.py", "file_new_name": "texar\\torch\\modules\\decoders\\xlnet_decoder.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "284,285,286", "deleted_lines": "284,285", "method_info": {"method_name": "next_inputs", "method_params": "self,Helper,int,Output", "method_startline": "284", "method_endline": "286"}}, "hunk_1": {"Ismethod": 1, "added_lines": "260,261,262", "deleted_lines": "260,261,262", "method_info": {"method_name": "step", "method_params": "self,Helper,int,Tensor", "method_startline": "260", "method_endline": "262"}}}}}}}