{"BR": {"BR_id": "1118", "BR_author": "fengxueem", "BRopenT": "2019-07-17T02:20:44Z", "BRcloseT": "2019-07-17T11:59:39Z", "BR_text": {"BRsummary": "convolutiondepthwise\u4e0d\u80fd\u53d6\u56de\u7ed3\u679c\uff0c\u7c7b\u4f3cissue #329", "BRdescription": "\n \u572820190611 release\u7248\u7684\u4ee3\u7801\u4e2d\uff0c\u611f\u89c9\u8fd9\u4e2a\u95ee\u9898\u4f9d\u65e7\u5b58\u5728\u5462\u3002\u6211\u8bd5\u9a8c\u7684\u7cfb\u7edf\u662fandroid aarch64\n \u5b58\u5728\u95ee\u9898\u7684\u662f\u4e00\u4e2aconvolutiondepthwise\u5c42\u8f93\u51fa\u901a\u9053\u4e3a256\uff0cgroup\u4e3a2\uff0ckernel 3*3\uff0c step 1.\u8ffd\u8e2a\u4e86\u4e00\u4e0b\u4ee3\u7801\uff0c\u65b0\u5efa\u7684op\u662fconvolution_arm\uff0ctop_blob_g\u8fd8\u662f\u4f1a\u5728op\u4e2d\u91cd\u65b0\u521b\u5efa\u3002\u5177\u4f53\u7684op\u662fconv3x3s1_winograd64_neon5\u3002\u5b83\u5728\u5b8c\u6210\u8ba1\u7b97\u540e\u4f1a\u4f7f\u7528crop\u5c42\u5c06\u7ed3\u679c\u4ece\u4e00\u5757\u4e34\u65f6\u521b\u5efa\u7684\u5e26border\u7684mat\u653e\u5165top_blob_g\u4e2d\uff0c\u4f46\u662f\u5728crop\u5c42\u7684\u5b9e\u73b0\u4e2d\uff0c\u5f53bottom_blob\u4e0etop_blob\u7684c,h,w\u7ef4\u5ea6\u4e00\u81f4\u65f6\uff0c\u76f4\u63a5\u6d45\u62f7\u8d1d,\u95ee\u9898\u51fa\u5728\u4e86\u8fd9\u91cc\uff0ctop_blob_g\u7684\u5185\u5b58\u5730\u5740\u5728\u8fd9\u6b21\u6d45\u62f7\u8d1d\u4e2d\u88ab\u8986\u76d6\u4e86\u3002\n \u7ed9\u90a3\u4e9b\u53ef\u80fd\u9047\u5230\u76f8\u540c\u95ee\u9898\u7684\u5b69\u5b50\u4eec\uff0c\u7b80\u5355patch\u662f\u5728convolutiondepthwise_arm.cpp\u4e2d\u8ba1\u7b97\u5b8c\u6bcf\u4e2agroup\u540e\u5c06\u5b83\u4eec\u7684\u7ed3\u679c\u590d\u5236\u56detop_blob,\u7c7b\u4f3c\u8fd9\u6837\u3002\u4e0d\u8fc7\u901f\u5ea6\u5c31\u4e0d\u592a\u5408\u9002\u4e86\u3002\n \n    int top_w = top_blob.w;\n    int top_h = top_blob.h;\n    int top_channel_step = top_blob.cstep;\n    memcpy((unsigned char*)top_blob.data + top_channel_step * num_output_g * g * elemsize, top_blob_g.data, top_w * top_w * num_output_g * elemsize);\n \n \n \u662f\u4e0d\u662f\u4e5f\u53ef\u4ee5\u5728crop\u5c42\u7684forward\u51fd\u6570\u4e2d\u5f53c,h,w\u7ef4\u5ea6\u76f8\u540c\u65f6\u62d2\u7eddtop_blob\u4e0d\u4e3a\u7a7a\u65f6\u7684\u6d45\u62f7\u8d1d\uff1f\u7b80\u5355\u7684\u6539\u4e86\u4e00\u4e0b\uff0c\u4e0d\u77e5\u9053\u5408\u4e0d\u5408\u9002\uff0c\u56e0\u4e3a\u6ca1\u6709\u901a\u8bfb\u8fc7ncnn\u6e90\u7801\uff0c\u4e0d\u6562\u778e\u63d0\u3002\n \n if(_outw == w && _outh == h && _outc == channels)\n {\n   if(top_blob.empty())\n   {\n     top_blob = bottom_blob;\n     return 0;\n   }\n   // gerantee that top blob holds enough mem space, maybe not necessary?\n   top_blob.create(_outw, _outh, _outc, elemsize, opt.blob_allocator);\n   if(top_blob.empty()) return -100;\n   // deep copy if top blob is not empty\n   memcpy(top_blob.data, bottom_blob.data, bottom_blob.total() * elemsize);\n }\n \n \n \u611f\u8c22ncnn\u7684\u5f00\u53d1\u8005\u4eec\uff01\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "fengxueem", "commentT": "2019-07-17T11:28:44Z", "comment_text": "\n \t\tconfirmed\n \t\t"}}}, "commit": {"commit_id": "e9c890ad8a253345fa97799e88e28a227c87fa8b", "commit_author": "nihuini", "commitT": "2019-07-17 19:59:22+08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\layer\\arm\\convolution_3x3.h", "file_new_name": "src\\layer\\arm\\convolution_3x3.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "10926,10927,10928,10929,10930,10931,10932,10933,11709,11710", "deleted_lines": "10926,11702", "method_info": {"method_name": "conv3x3s1_winograd64_neon5", "method_params": "bottom_blob,top_blob,kernel_tm,_bias,opt", "method_startline": "8347", "method_endline": "11711"}}}}}}}