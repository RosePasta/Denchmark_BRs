{"BR": {"BR_id": "797", "BR_author": "xinyu391", "BRopenT": "2019-02-26T02:58:30Z", "BRcloseT": "2019-03-14T11:01:21Z", "BR_text": {"BRsummary": "\u8ba1\u7b97\u7ed3\u679c\u5f02\u5e38", "BRdescription": "\n \u6211\u8fd9\u91cc\u4e00\u4e2a\u6587\u672c\u68c0\u6d4b\u6a21\u578b\uff0c\n \u540c\u5f20\u56fe\u50cf\u7f29\u653e\u5230\u4e0d\u540c\u5927\u5c0f\uff0c\u53d1\u73b0\u7ed3\u679c\u7ed3\u679c\u504f\u5dee\u5f88\u5927\n 1601\u5927\u5c0f\u5c31\u6b63\u5e38\uff0c1600\u5927\u5c0f\uff0c\u9519\u7684\u79bb\u8c31\u3002\n \u6000\u7591\u662f\u67d0\u5c42\u8ba1\u7b97\u7ed3\u679c\u4e0d\u5bf9\uff0c\u628a\u6bcf\u5c42\u8ba1\u7b97\u7ed3\u679c\u4fdd\u5b58\u4e0b\u6765\u8ddfcaffe\u8dd1\u7684\u8fdb\u884c\u5bf9\u6bd4\n \u7ed3\u679c\u53c8\u5bf9\u4e86\uff08\u8ba1\u7b97\u6570\u503c\u6709\u5dee\u522b\uff0c\u4f46\u6700\u7ec8\u6587\u672c\u884c\u68c0\u6d4b\u6b63\u5e38\uff09\uff0c\n \u540e\u6765\u6709\u8bbe\u7f6eset_light_mode(false);\u53d1\u73b0\u7ed3\u679c\u4e5f\u5bf9\u3002\n \u6000\u7591\uff0c\u6709\u5185\u5b58\u8d8a\u754c\u9519\u8bef\u3002\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "xinyu391", "commentT": "2019-02-26T08:14:30Z", "comment_text": "\n \t\t\u7ecf\u4e00\u4e0b\u5348\u7684\u8c03\u8bd5\u53d1\u73b0\u662fCrop\u5c42\u8c03\u7528\u7684\u4ee3\u7801copy_cut_border()\u5b58\u5728\u95ee\u9898\n crop.cpp\n int Crop::forward(const Mat& bottom_blob, Mat& top_blob, const Option& opt) const\n {\n     int w = bottom_blob.w;\n     int h = bottom_blob.h;\n     int channels = bottom_blob.c;\n \n     int _outw = outw == -233 ? w - woffset : outw;\n     int _outh = outh == -233 ? h - hoffset : outh;\n     int _outc = outc == -233 ? channels - coffset : outc;\n #\u8fd9\u91ccbottom_blob_sliced\u7528\u7684\u662fbottom\u7684\u90e8\u5206\u5185\u5b58\n     const Mat bottom_blob_sliced(w, h, _outc, (void*)(const float*)bottom_blob.channel(coffset));\n \n     int top = hoffset;\n     int bottom = h - _outh - hoffset;\n     int left = woffset;\n     int right = w - _outw - woffset;\n \n     copy_cut_border(bottom_blob_sliced, top_blob, top, bottom, left, right, opt.blob_allocator, opt.num_threads);\n mat.cpp\n void copy_cut_border(const Mat& src, Mat& dst, int top, int bottom, int left, int right, Allocator* allocator, int num_threads)\n {\n     int w = src.w - left - right;\n     int h = src.h - top - bottom;\n     size_t elemsize = src.elemsize;\n \n     if (w == src.w && h == src.h)\n     {\n         dst = src;  ##\u8fd9\u91cc\u76f4\u63a5\u8d4b\u503c\uff0c\u662f\u5730\u5740\u8d4b\u503c\n         return;\n     }\n \u5728light_mode\u4e0b\uff0c\u4f1a\u5bf9bottom\u8fdb\u884c\u91ca\u653e\u3002\n net.cpp forward_layer()\n  if (opt.lightmode)\n         {\n             // delete after taken in light mode\n ## \u8fd9\u91cc\u8fdb\u884c\u4e86release\uff0c\u4f1a\u91ca\u653e\u5185\u5b58##\n             blob_mats[bottom_blob_index].release();\n             // deep copy for inplace forward if data is shared\n             if (layer->support_inplace && *bottom_blob.refcount != 1)\n             {\n                 bottom_blob = bottom_blob.clone();\n             }\n         }\n \u4fee\u590d\uff1a\n dst=src.clone()\u5373\u53ef\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "xinyu391", "commentT": "2019-02-26T08:19:10Z", "comment_text": "\n \t\t\u6539\u6210\u8fd9\u6837\u66f4\u597d\n         if(src.refcount)\n         {\n             dst = src;\n         }\n         else\n         {\n             dst = src.clone();\n         }\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "xinyu391", "commentT": "2019-02-26T08:22:54Z", "comment_text": "\n \t\t\u611f\u8c22\u8be6\u7ec6\u7684\u95ee\u9898\u53cd\u9988\uff5e\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "xinyu391", "commentT": "2019-06-18T06:49:46Z", "comment_text": "\n \t\t\u641e\u4e86\u4e09\u5929\uff0c\u6211\u4e5f\u53d1\u73b0\u8fd9\u4e2a\u95ee\u9898\uff0c\u6709\u8d8a\u754c\u73b0\u8c61\uff0c\u770b\u6e90\u7801\u8c03\u8bd5\uff0c\u8c03\u51fa\u6765\u3002\u8981\u662f\u65e9\u70b9\u8fc7\u6765\u770b\u8fd9\u4e2a\uff0c\u4f30\u8ba1\u65e9\u89e3\u51b3\u4e86\u3002\n \t\t"}}}, "commit": {"commit_id": "6f9ffca7e3538c03eab91aa1b8e567ebaee295ef", "commit_author": "nihuini", "commitT": "2019-03-14 19:00:58+08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\layer\\crop.cpp", "file_new_name": "src\\layer\\crop.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97", "deleted_lines": "82,109", "method_info": {"method_name": "ncnn::Crop::forward", "method_params": "bottom_blob,top_blob,opt", "method_startline": "51", "method_endline": "109"}}, "hunk_1": {"Ismethod": 1, "added_lines": "120,121,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141", "deleted_lines": "116,117", "method_info": {"method_name": "ncnn::Crop::forward", "method_params": "bottom_blobs,top_blobs,opt", "method_startline": "111", "method_endline": "153"}}}}}}}