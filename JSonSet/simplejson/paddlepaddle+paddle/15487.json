{"BR": {"BR_id": "15487", "BR_author": "kebinC", "BRopenT": "2019-01-23T09:51:48Z", "BRcloseT": "2019-01-28T02:08:56Z", "BR_text": {"BRsummary": "fluid.layers.affine_grid \u4e0e fluid.layers.grid_sampler\u8054\u5408\u4f7f\u7528\u5f02\u5e38", "BRdescription": "\n \u8fd9\u4e2a\u6211\u7684\u6d4b\u8bd5\u4ee3\u7801\uff1a\n <denchmark-code>import paddle\n import paddle.fluid as fluid\n import numpy as np\n #from stn import STN\n \n \n def test():\n \n     input_np = np.random.randn(2, 3, 224, 224).astype(np.float32)\n     input = fluid.layers.create_global_var(\n                 shape=[2, 3, 224, 224], value=0, dtype='float32', persistable=True)\n     fluid.layers.assign(input_np, input)\n \n     theta_np = np.random.randn(2, 2, 3).astype(np.float32)\n     theta = fluid.layers.create_global_var(\n                 shape=[2, 2, 3], value=0, dtype='float32', persistable=True)\n     fluid.layers.assign(theta_np, theta)\n \n     #stn = STN()\n     #output = stn.net(input)\n     grid = fluid.layers.affine_grid(theta, out_shape=input.shape)\n     out = fluid.layers.grid_sampler(input, grid=grid)\n \n \n     fetch_list = [output.name]\n     place = fluid.CPUPlace()\n     exe = fluid.Executor(place)\n     exe.run(fluid.default_startup_program())\n \n     res = exe.run(\n                 fluid.default_main_program(),\n                 fetch_list=fetch_list\n             )\n     #print res\n     print res[0].shape\n \n test()\n </denchmark-code>\n \n \u9519\u8bef\u4fe1\u606f\uff1a\n Traceback (most recent call last):\n File \"test_stn.py\", line 37, in \n test()\n File \"test_stn.py\", line 22, in test\n out = fluid.layers.grid_sampler(input, grid=grid)\n File \"/home/users/chenkaibing/env/paddle-release/python-gcc482-paddle/lib/python2.7/site-packages/paddle/fluid/layers/nn.py\", line 8870, in grid_sampler\n helper.append_op(type='grid_sampler', inputs=ipts, outputs={'Output': out})\n File \"/home/users/chenkaibing/env/paddle-release/python-gcc482-paddle/lib/python2.7/site-packages/paddle/fluid/layer_helper.py\", line 50, in append_op\n return self.main_program.current_block().append_op(*args, **kwargs)\n File \"/home/users/chenkaibing/env/paddle-release/python-gcc482-paddle/lib/python2.7/site-packages/paddle/fluid/framework.py\", line 1208, in append_op\n op = Operator(block=self, desc=op_desc, *args, **kwargs)\n File \"/home/users/chenkaibing/env/paddle-release/python-gcc482-paddle/lib/python2.7/site-packages/paddle/fluid/framework.py\", line 657, in init\n self.desc.infer_shape(self.block.desc)\n paddle.fluid.core.EnforceNotMet: Enforce failed. Expected grid_dims[1] == x_dims[2], but received grid_dims[1]:-1 != x_dims[2]:224.\n Input(X) dims[2] and Input(Grid) dims[1] should be equal. at [/sharefolder/duyuning/Paddle/paddle/fluid/operators/grid_sampler_op.cc:48]\n PaddlePaddle Call Stacks:\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "kebinC", "commentT": "2019-01-23T12:04:16Z", "comment_text": "\n \t\t\u5b9a\u4f4d\u4e3aaffine_grid\u56e0\u4e3a\u53ef\u4ee5\u63a5\u53d7Variable\u7684out_shape\u8f93\u5165\uff0c\u6240\u4ee5\u5728InferShape\u7684\u65f6\u5019\u8bbe\u7f6e\u7684OutputDim\u4e3a{theta_dims[0], -1, -1, 2}, \u800cgrid_sampler\u5728InferShape\u9636\u6bb5\u4f1a\u5224\u65adgrid_dims[1, 2]\u4e0ex_dims[2, 3]\u662f\u5426\u76f8\u7b49\uff0c\u800cgrid_dims[1, 2]\u88ab\u8bbe\u7f6e\u6210-1\uff0c\u6240\u4ee5\u62a5\u9519\u3002\u6211\u4eec\u4f1a\u5c3d\u5feb\u786e\u8ba4\u4fee\u6539\u65b9\u6848\u5e76\u5b8c\u6210\u4fee\u6539\u3002\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "kebinC", "commentT": "2019-01-27T12:55:11Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/PaddlePaddle/Paddle/pull/15542>#15542</denchmark-link>\n  \u5df2\u4fee\u6539\uff0c\u9884\u8ba1\u5468\u4e00\u5468\u4e8c\u5408\u5165\n \t\t"}}}, "commit": {"commit_id": "aeca5c50b20dfa69509b14b820a66c83a1921eff", "commit_author": "Kaipeng Deng", "commitT": "2019-01-28 10:08:55+08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\fluid\\operators\\grid_sampler_op.cc", "file_new_name": "paddle\\fluid\\operators\\grid_sampler_op.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "46,47,48,49,50,51,52,53", "deleted_lines": "46,47,48,49,50,51", "method_info": {"method_name": "paddle::operators::GridSampleOp::InferShape", "method_params": "ctx", "method_startline": "29", "method_endline": "57"}}}}}}}