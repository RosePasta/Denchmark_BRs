{"BR": {"BR_id": "10944", "BR_author": "jlherren", "BRopenT": "2018-08-20T07:47:35Z", "BRcloseT": "2018-08-21T22:51:01Z", "BR_text": {"BRsummary": "Keras &gt;= 2.2.1 no longer respects fit_generator(validation_steps=...)", "BRdescription": "\n It seems that starting with Keras 2.2.1 fit_generator() no longer stops the validation process after validation_steps steps, but continues through the entire sequence. See this example code:\n <denchmark-code>import numpy\n from keras import Input, Model\n from keras.layers import Dense\n from keras.utils import Sequence\n \n class Gen(Sequence):\n     def __init__(self, name):\n         super().__init__()\n         self.name = name\n \n     def __len__(self):\n         return 1000\n \n     def __getitem__(self, index):\n         print('Generate %s %d' % (self.name, index))\n         return numpy.zeros(shape=(10, 10)), numpy.zeros(shape=(10, 2))\n \n i = Input(shape=(10,))\n o = Dense(units=2)(i)\n m = Model(i, o)\n m.compile('sgd', 'mse')\n m.fit_generator(\n     generator=Gen('training_data'),\n     shuffle=False,\n     steps_per_epoch=5,\n     validation_data=Gen('validation_data'),\n     validation_steps=5,\n     workers=1,\n     max_queue_size=1,\n     verbose=0,\n )\n </denchmark-code>\n \n Which will output\n <denchmark-code>Generate validation_data 0\n Generate validation_data 1\n Generate training_data 0\n Generate training_data 1\n Generate training_data 2\n Generate training_data 3\n Generate training_data 4\n Generate training_data 5\n Generate training_data 6\n Generate validation_data 2\n Generate validation_data 3\n Generate validation_data 4\n Generate validation_data 5\n Generate validation_data 6\n Generate validation_data 7\n ...\n Generate validation_data 998\n Generate validation_data 999\n </denchmark-code>\n \n This was working fine in keras 2.2.0.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jlherren", "commentT": "2018-08-20T15:25:49Z", "comment_text": "\n \t\tMy bad, I'll submit a PR right away.\n Culprit : <denchmark-link:https://github.com/keras-team/keras/blob/master/keras/engine/training_generator.py#L114>https://github.com/keras-team/keras/blob/master/keras/engine/training_generator.py#L114</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "6746bda3dcda273580fef2d911c6cc333c8a626c", "commit_author": "Fr\u00e9d\u00e9ric Branchaud-Charron", "commitT": "2018-08-21 15:51:01-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "keras\\engine\\training_generator.py", "file_new_name": "keras\\engine\\training_generator.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "114", "deleted_lines": "114"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tests\\keras\\engine\\test_training.py", "file_new_name": "tests\\keras\\engine\\test_training.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "26", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,batch_size,sequence_length", "method_startline": "23", "method_endline": "26"}}, "hunk_1": {"Ismethod": 1, "added_lines": "32", "deleted_lines": null, "method_info": {"method_name": "__getitem__", "method_params": "self,idx", "method_startline": "31", "method_endline": "36"}}, "hunk_2": {"Ismethod": 1, "added_lines": "416,421,423,427,432,436,440", "deleted_lines": "418,430", "method_info": {"method_name": "test_model_methods", "method_params": "", "method_startline": "99", "method_endline": "526"}}}}}}}