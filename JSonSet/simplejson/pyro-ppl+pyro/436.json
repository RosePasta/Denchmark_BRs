{"BR": {"BR_id": "436", "BR_author": "null-a", "BRopenT": "2017-11-01T17:42:08Z", "BRcloseT": "2017-11-02T00:30:49Z", "BR_text": {"BRsummary": "New Bernoulli parameterization lead to subtle bug in AIR model", "BRdescription": "\n When I merged <denchmark-link:https://github.com/pyro-ppl/pyro/pull/416>#416</denchmark-link>\n  into a local branch it broke the AIR example.\n Here's a simplified instance of the problem:\n import torch\n from torch.autograd import Variable\n from pyro.distributions import Bernoulli\n from torch.nn.functional import sigmoid\n \n p = Variable(torch.Tensor([0]), requires_grad=True)\n b = Bernoulli(sigmoid(p) * 0.0)\n log_pdf = b.batch_log_pdf(Variable(torch.Tensor([0])))\n log_pdf.sum().backward()\n print(p.grad)\n Prior to <denchmark-link:https://github.com/pyro-ppl/pyro/pull/416>#416</denchmark-link>\n  this returned a  of zero as expected, but it now returns :\n <denchmark-code>pyro$ git rev-parse --short HEAD\n 71bca18\n pyro$ python3 bern.py \n Variable containing:\n -0\n [torch.FloatTensor of size 1]\n \n pyro$ git rev-parse --short HEAD\n a85525a\n pyro$ python3 bern.py \n Variable containing:\n nan\n [torch.FloatTensor of size 1]\n </denchmark-code>\n \n I suspect that the problem is that converting between probabilities and log odds introduces an intemediate -inf, which messes up autograd.\n I may be able to adjust the model to work around this, but either way, should this be considered a bug? (It seems like it could trip other people up, and chasing down the source of the nans is tricky.)\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "null-a", "commentT": "2017-11-01T18:10:39Z", "comment_text": "\n \t\tThanks for the reproducible example, <denchmark-link:https://github.com/null-a>@null-a</denchmark-link>\n ! I'll try to get a fix in today, failing which, it may be better to revert the logit PR instead. Will keep you posted.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "null-a", "commentT": "2017-11-01T18:28:20Z", "comment_text": "\n \t\t\n Thanks for the reproducible example,\n \n <denchmark-link:https://github.com/neerajprad>@neerajprad</denchmark-link>\n  No problem, thanks for taking a look!\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "null-a", "commentT": "2017-11-02T00:54:05Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/null-a>@null-a</denchmark-link>\n  - Let me know if you continue to see any issues. And thanks again for bringing this to our notice!\n \t\t"}}}, "commit": {"commit_id": "7b6cf5860d9600e229dd5b5f47a555164d894f7b", "commit_author": "Neeraj Pradhan", "commitT": "2017-11-01 17:30:48-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pyro\\distributions\\util.py", "file_new_name": "pyro\\distributions\\util.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "138,139,140,141,142,143,144", "deleted_lines": null, "method_info": {"method_name": "_get_clamping_buffer", "method_params": "tensor", "method_startline": "138", "method_endline": "144"}}, "hunk_1": {"Ismethod": 1, "added_lines": "163,164,165,170,175", "deleted_lines": "158,163", "method_info": {"method_name": "get_probs_and_logits", "method_params": "ps,logits,is_multidimensional", "method_startline": "147", "method_endline": "176"}}}}, "file_1": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\distributions\\test_gradient_flow.py"}}}}