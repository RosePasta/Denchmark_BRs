{"BR": {"BR_id": "43", "BR_author": "edubart", "BRopenT": "2017-09-16T02:49:26Z", "BRcloseT": "2017-09-22T21:21:36Z", "BR_text": {"BRsummary": "Span slicing inside dynamic type procs fails to compile", "BRdescription": "\n Minor test case:\n import arraymancer\n \n proc boo[T](): T =\n   var a = zeros([2,2], int)\n   echo a[1,_]\n \n discard boo[int]()\n When compiling the following error is shown:\n <denchmark-code>test.nim(4, 12) Error: undeclared identifier: '_'\n </denchmark-code>\n \n Removing dynamic type [T] from the proc the code works fine.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "edubart", "commentT": "2017-09-16T08:45:38Z", "comment_text": "\n \t\tI've reproduced it and reported it to Nim upstream.\n It seems like for generic procs, there is an identifier resolution happening before the macros kick-in and replace \"_\".\n I may have a workaround by exporting a dummy \"_\" but I don't want to pollute namespace with that symbol. And it's used in tuple pattern-matching as well and maybe by other libs.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "edubart", "commentT": "2017-09-19T21:41:34Z", "comment_text": "\n \t\tYou can workaround that issue by using mixin _ from module macros in the procs that uses \"_\"\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "edubart", "commentT": "2017-09-19T22:25:56Z", "comment_text": "\n \t\tThis workaround does not work with more complex silicing, like x[_, _, ^1..0|-1]\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "edubart", "commentT": "2017-09-20T21:00:28Z", "comment_text": "\n \t\tNot sure which identifier poses the issue here, with seq I can \"solve\" it by adding everything as mixin :/\n proc foo4[T](): CustomSeq[T] =\n   result.data.newSeq(10)\n   # weird fancy corner case that feels special and wants special treatment\n   mixin _,`|-`\n   # why?\n   echo result[_, _, ^1..0|-1]\n Case is closed upstream, but I really think generics have an issue as detailed by Krux\n \t\t"}}}, "commit": {"commit_id": "9c061fd017351aa9d381c8aeccf69b982c9a55d7", "commit_author": "Mamy Ratsimbazafy", "commitT": "2017-09-22 23:21:24+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\arraymancer\\global_config.nim", "file_new_name": "src\\arraymancer\\global_config.nim", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "31,32,33,34", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tests\\all_tests.nim", "file_new_name": "tests\\all_tests.nim", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "25,26", "deleted_lines": "25"}}}, "file_2": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\test_bugtracker.nim"}}}}