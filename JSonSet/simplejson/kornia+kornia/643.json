{"BR": {"BR_id": "643", "BR_author": "FGeri", "BRopenT": "2020-08-26T15:38:08Z", "BRcloseT": "2020-08-31T06:47:12Z", "BR_text": {"BRsummary": "[BUG] Flipping augmentations return wrong transformation matrices", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n RandomHorizontalFlip  and RandomVerticalFlip return wrong transformation matrices in case of flipping. Transforming a [x,y,1] vector with the returned transformation matrix results in values with +1 off in the x and respectively in the y dimensions.\n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n Steps to reproduce the behavior:\n <denchmark-code>>>> import kornia as K\n >>> input = torch.tensor([[[[0., 0., 0.],\n                          [0., 0., 0.],\n                          [0., 1., 1.]]]])\n >>> hflip = K.augmentation.RandomHorizontalFlip(p=1.0,return_transform=True)\n >>> _, T_h = hflip(input)\n >>> h_data = torch.tensor([[0.,1.,2.],\n                                              [0.,0.,0.],\n                                              [1.,1.,1.]])\n >>> T_h @ h_data \n tensor([[[3., 2., 1.],\n              [0., 0., 0.],\n              [1., 1., 1.]]])\n \n >>> T_h\n tensor([[[-1.,  0.,  3.],\n               [ 0.,  1.,  0.],\n               [ 0.,  0.,  1.]]])\n </denchmark-code>\n \n <denchmark-h:h2>Expected behavior</denchmark-h>\n \n Returned transformation matrix should be for RandomHorizontalFlip :\n <denchmark-code>tensor([[[-1.,  0.,  w-1],\n               [ 0.,  1.,  0.   ],\n               [ 0.,  0.,  1.   ]]])\n </denchmark-code>\n \n Returned transformation matrix should be for RandomVerticalFlip :\n <denchmark-code>tensor([[[ 1.,   0.,  0   ],\n               [ 0., -1.,  h-1],\n               [ 0.,   0.,  1.  ]]])\n </denchmark-code>\n \n <denchmark-h:h2>Environment</denchmark-h>\n \n PyTorch version: 1.6.0\n Is debug build: False\n CUDA used to build PyTorch: 10.2\n OS: Ubuntu 18.04.4 LTS (x86_64)\n GCC version: (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0\n Clang version: Could not collect\n CMake version: version 3.18.1\n Python version: 3.6 (64-bit runtime)\n Is CUDA available: True\n CUDA runtime version: 10.2.89\n GPU models and configuration: GPU 0: GeForce RTX 2080 Ti\n Nvidia driver version: 440.44\n cuDNN version: /usr/lib/x86_64-linux-gnu/libcudnn.so.7.6.5\n Versions of relevant libraries:\n [pip3] numpy==1.19.1\n [pip3] torch==1.6.0\n [pip3] torchvision==0.7.0\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "FGeri", "commentT": "2020-08-31T06:47:12Z", "comment_text": "\n \t\tFixed with <denchmark-link:https://github.com/kornia/kornia/pull/648>#648</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "6434c36c890c01427b4e2538acb9e0aafb1699ee", "commit_author": "FGeri", "commitT": "2020-08-30 20:31:54+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "kornia\\augmentation\\functional.py", "file_new_name": "kornia\\augmentation\\functional.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "303,315", "deleted_lines": "303,315", "method_info": {"method_name": "compute_vflip_transformation", "method_params": "Tensor,str", "method_startline": "297", "method_endline": "320"}}, "hunk_1": {"Ismethod": 1, "added_lines": "255,265", "deleted_lines": "255,265", "method_info": {"method_name": "compute_hflip_transformation", "method_params": "Tensor,str", "method_startline": "249", "method_endline": "270"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 7, "file_old_name": "test\\augmentation\\test_augmentation.py", "file_new_name": "test\\augmentation\\test_augmentation.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239", "deleted_lines": null, "method_info": {"method_name": "test_random_hflip_coord_check", "method_params": "self,device,dtype", "method_startline": "203", "method_endline": "239"}}, "hunk_1": {"Ismethod": 1, "added_lines": "335", "deleted_lines": "339", "method_info": {"method_name": "test_batch_random_vflip", "method_params": "self,device", "method_startline": "319", "method_endline": "352"}}, "hunk_2": {"Ismethod": 1, "added_lines": "115", "deleted_lines": "115", "method_info": {"method_name": "test_random_hflip", "method_params": "self,device", "method_startline": "96", "method_endline": "131"}}, "hunk_3": {"Ismethod": 1, "added_lines": "148", "deleted_lines": "148", "method_info": {"method_name": "test_batch_random_hflip", "method_params": "self,device", "method_startline": "133", "method_endline": "166"}}, "hunk_4": {"Ismethod": 1, "added_lines": "190", "deleted_lines": "190", "method_info": {"method_name": "test_sequential", "method_params": "self,device", "method_startline": "174", "method_endline": "201"}}, "hunk_5": {"Ismethod": 1, "added_lines": "388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424", "deleted_lines": null, "method_info": {"method_name": "test_random_vflip_coord_check", "method_params": "self,device,dtype", "method_startline": "388", "method_endline": "424"}}, "hunk_6": {"Ismethod": 1, "added_lines": "303", "deleted_lines": "297", "method_info": {"method_name": "test_random_vflip", "method_params": "self,device", "method_startline": "285", "method_endline": "317"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "test\\augmentation\\test_transformation_matrix.py", "file_new_name": "test\\augmentation\\test_transformation_matrix.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "97", "deleted_lines": "97", "method_info": {"method_name": "test_batch_random_vflip", "method_params": "self,device", "method_startline": "86", "method_endline": "109"}}, "hunk_1": {"Ismethod": 1, "added_lines": "26", "deleted_lines": "26", "method_info": {"method_name": "test_random_hflip", "method_params": "self,device", "method_startline": "17", "method_endline": "35"}}, "hunk_2": {"Ismethod": 1, "added_lines": "47", "deleted_lines": "47", "method_info": {"method_name": "test_batch_random_hflip", "method_params": "self,device", "method_startline": "37", "method_endline": "60"}}, "hunk_3": {"Ismethod": 1, "added_lines": "76", "deleted_lines": "76", "method_info": {"method_name": "test_random_vflip", "method_params": "self,device", "method_startline": "65", "method_endline": "84"}}}}}}}