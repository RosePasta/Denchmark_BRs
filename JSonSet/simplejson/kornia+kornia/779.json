{"BR": {"BR_id": "779", "BR_author": "ddetone", "BRopenT": "2020-11-13T18:37:35Z", "BRcloseT": "2020-11-26T14:37:17Z", "BR_text": {"BRsummary": "[Bug] 2D motion blur kernel seems wrong", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n I'm seeing some issues with the kernel returned by the call kornia.filters.get_motion_kernel2d()\n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n Steps to reproduce the behavior:\n \n kornia.filters.get_motion_kernel2d(5, 0., 0.)\n kornia.filters.get_motion_kernel2d(3, 215., -0.5)\n \n <denchmark-h:h2>What I am seeing</denchmark-h>\n \n >>> kornia.filters.get_motion_kernel2d(5, 0., 0.)\n tensor([[[nan, nan, nan, nan, nan],\n          [nan, nan, nan, nan, nan],\n          [inf, inf, nan, -inf, -inf],\n          [nan, nan, nan, nan, nan],\n          [nan, nan, nan, nan, nan]]])\n >>> kornia.filters.get_motion_kernel2d(3, 215., -0.5)\n tensor([[[-0.0000, -0.0000, -0.3333],\n          [-0.0000,  0.3333, -0.0000],\n          [ 1.0000, -0.0000, -0.0000]]])\n <denchmark-h:h2>Expected behavior</denchmark-h>\n \n According to <denchmark-link:https://github.com/kornia/kornia/blob/master/kornia/filters/kernels.py#L634>https://github.com/kornia/kornia/blob/master/kornia/filters/kernels.py#L634</denchmark-link>\n , I would expect\n >>> kornia.filters.get_motion_kernel2d(5, 0., 0.)\n tensor([[0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n               [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n               [0.2000, 0.2000, 0.2000, 0.2000, 0.2000],\n               [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n               [0.0000, 0.0000, 0.0000, 0.0000, 0.0000]])\n >>> kornia.filters.get_motion_kernel2d(3, 215., -0.5)\n tensor([[0.0000, 0.0412, 0.0732],\n               [0.1920, 0.3194, 0.0804],\n               [0.2195, 0.0743, 0.0000]])\n <denchmark-h:h2>Environment</denchmark-h>\n \n Collecting environment information...\n PyTorch version: 1.7.0\n Is debug build: True\n CUDA used to build PyTorch: None\n ROCM used to build PyTorch: N/A\n OS: Mac OSX 10.15.7 (x86_64)\n GCC version: Could not collect\n Clang version: 12.0.0 (clang-1200.0.32.2)\n CMake version: Could not collect\n Python version: 3.7 (64-bit runtime)\n Is CUDA available: False\n CUDA runtime version: No CUDA\n GPU models and configuration: No CUDA\n Nvidia driver version: No CUDA\n cuDNN version: No CUDA\n HIP runtime version: N/A\n MIOpen runtime version: N/A\n Versions of relevant libraries:\n [pip3] numpy==1.16.1\n [pip3] torch==1.7.0\n [pip3] torchvision==0.8.1\n [conda] Could not collect\n <denchmark-h:h2>Extra info</denchmark-h>\n \n I am seeing this issue on both mac and linux, both with pytorch 1.7 and kornia 0.4.1\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ddetone", "commentT": "2020-11-14T03:05:06Z", "comment_text": "\n \t\tThanks for the bug report. This will be fixed in <denchmark-link:https://github.com/kornia/kornia/pull/782>#782</denchmark-link>\n .\n \t\t"}}}, "commit": {"commit_id": "ee45c6c2da78ae944d6bb0043d6414122590299e", "commit_author": "shijianjian", "commitT": "2020-11-26 15:37:16+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "Makefile", "file_new_name": "Makefile", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "42", "deleted_lines": "42"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "kornia\\augmentation\\augmentation.py", "file_new_name": "kornia\\augmentation\\augmentation.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "916,917,918,919,920", "deleted_lines": "916,917,918,919,920"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "kornia\\augmentation\\augmentation3d.py", "file_new_name": "kornia\\augmentation\\augmentation3d.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "474,475,476,477,478,480,481,482,483,484,486,487,488,489,490", "deleted_lines": "474,475,476,477,478,480,481,482,483,484,486,487,488,489,490"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "kornia\\filters\\kernels.py", "file_new_name": "kornia\\filters\\kernels.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "625,626,627,628,629,630,631,632,633,634,635,636,637,672,673,689,691,701,704,705,706,707,708,709,710,711,712,713,714,715,716,717,718,719,720,721,722,723,724,725,726,727,732,733,734,735,736,738,746,759,762,763", "deleted_lines": "625,626,627,628,629,630,631,632,633,634,635,636,637,639,673,674,690,701,704,705,706,707,708,709,710,711,712,713,715,720,728,741,744,745"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "kornia\\filters\\motion.py", "file_new_name": "kornia\\filters\\motion.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "172", "deleted_lines": "172"}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "kornia\\geometry\\camera\\pinhole.py", "file_new_name": "kornia\\geometry\\camera\\pinhole.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "549,550,551,553", "deleted_lines": "549,550,551", "method_info": {"method_name": "homography_i_H_ref", "method_params": "pinhole_i,pinhole_ref", "method_startline": "516", "method_endline": "563"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "kornia\\geometry\\transform\\crop\\crop2d.py", "file_new_name": "kornia\\geometry\\transform\\crop\\crop2d.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "356,357,358,361,362,363", "deleted_lines": "356,357,358,361,362,363"}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "kornia\\utils\\helpers.py", "file_new_name": "kornia\\utils\\helpers.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "10,11,12", "deleted_lines": null, "method_info": {"method_name": "_extract_device_dtype", "method_params": "", "method_startline": "6", "method_endline": "32"}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "test\\augmentation\\test_motionblur.py", "file_new_name": "test\\augmentation\\test_motionblur.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "61,62,63,64,65,66,67,68,69,70,71", "deleted_lines": null, "method_info": {"method_name": "test_against_functional", "method_params": "self,input_shape", "method_startline": "61", "method_endline": "71"}}, "hunk_1": {"Ismethod": 1, "added_lines": "29", "deleted_lines": null, "method_info": {"method_name": "test_smoke", "method_params": "self,device", "method_startline": "27", "method_endline": "31"}}, "hunk_2": {"Ismethod": 1, "added_lines": "76", "deleted_lines": "75,85", "method_info": {"method_name": "test_gradcheck", "method_params": "self,device", "method_startline": "73", "method_endline": "86"}}, "hunk_3": {"Ismethod": 1, "added_lines": "142", "deleted_lines": null, "method_info": {"method_name": "test_gradcheck", "method_params": "self,device,dtype", "method_startline": "139", "method_endline": "151"}}, "hunk_4": {"Ismethod": 1, "added_lines": "96", "deleted_lines": null, "method_info": {"method_name": "test_smoke", "method_params": "self,device,dtype", "method_startline": "93", "method_endline": "98"}}, "hunk_5": {"Ismethod": 1, "added_lines": "39,40,41,58", "deleted_lines": "55", "method_info": {"method_name": "test_random_motion_blur", "method_params": "self,same_on_batch,return_transform,p,device,dtype", "method_startline": "36", "method_endline": "58"}}}}, "file_9": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "test\\utils\\test_helpers.py"}}}}