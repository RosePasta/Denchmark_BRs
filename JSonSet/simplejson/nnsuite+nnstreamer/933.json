{"BR": {"BR_id": "933", "BR_author": "myungjoo", "BRopenT": "2018-11-29T01:48:42Z", "BRcloseT": "2018-11-29T08:02:11Z", "BR_text": {"BRsummary": "[Sync-Errors in Tensor_Repo] Possible deadlock / data inconsistency", "BRdescription": "\n By looking at the code again, I'm seeing possible sync-errors that may cause DEADLOCKs:\n \n tensor_repo.c::gst_tensor_repo_add_repodata\n \n   GST_REPO_LOCK ();\n   gpointer check = g_hash_table_lookup (_repo.hash, GINT_TO_POINTER (nth));\n \n   if (check != NULL) {\n     return TRUE;\n }\n You are returning without releasing the lock.\n \n \n _repo.hash is often accessed without protection. You need to define which lock is protecting (GST_REPO_LOCK()??) and enforce using it whenever _repo.has is used.\n \n \n When \"nth\" of _repo.hash is used, you need to ensure that nth's LOCK is ACQUIRED.\n \n \n For 2.3., if an operation can be guaranteed to be atomic, it can be skipped with some special conditions, but it doesn't appear to be applicable in this code.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "myungjoo", "commentT": "2018-11-29T01:48:44Z", "comment_text": "\n \t\t : Thank you for posting issue <denchmark-link:https://github.com/nnstreamer/nnstreamer/issues/933>#933</denchmark-link>\n . The person in charge will reply soon.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "myungjoo", "commentT": "2018-11-29T02:09:10Z", "comment_text": "\n \t\t\n Return without Releasing. I fixed. (PR #934)\n I think we do not need to get the _repo.hash lock except some cases.\n . remove and add nth TensorRepoData structure into hash table.\n . create and remove has table.\n For the access and wirte the GstBuffer, we could use TensorRepoData->lock and cond variables.\n In order to make sure set and get the buffer correctly, another cond variable is introduced. (cond_pull, cond_push : PR #922).\n I concerned this when I wrote the code, but I will check again.\n \n \t\t"}}}, "commit": {"commit_id": "d83e7bb63f7b6328ef7e02e5a4e0c55128e612fe", "commit_author": "jijoong.moon", "commitT": "2018-11-29 08:02:10+00:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "gst\\nnstreamer\\tensor_repo.c", "file_new_name": "gst\\nnstreamer\\tensor_repo.c", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "150,151", "deleted_lines": "144", "method_info": {"method_name": "gst_tensor_repo_get_buffer", "method_params": "nth", "method_startline": "143", "method_endline": "173"}}, "hunk_1": {"Ismethod": 1, "added_lines": "93,94,95,96,97", "deleted_lines": "92", "method_info": {"method_name": "gst_tensor_repo_set_buffer", "method_params": "nth,buffer", "method_startline": "88", "method_endline": "108"}}, "hunk_2": {"Ismethod": 1, "added_lines": "63", "deleted_lines": null, "method_info": {"method_name": "gst_tensor_repo_add_repodata", "method_params": "nth", "method_startline": "54", "method_endline": "82"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "gst\\tensor_reposrc\\tensor_reposrc.c", "file_new_name": "gst\\tensor_reposrc\\tensor_reposrc.c", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "269,270,271", "method_info": {"method_name": "gst_tensor_reposrc_create", "method_params": "src,buffer", "method_startline": "262", "method_endline": "298"}}}}}}}