{"BR": {"BR_id": "504", "BR_author": "omrihar", "BRopenT": "2020-01-29T08:35:08Z", "BRcloseT": "2020-02-11T00:46:51Z", "BR_text": {"BRsummary": "Failed deployments to sagemaker cannot be deleted from deployments list", "BRdescription": "\n \n I tried to deploy to sagemaker while debugging a problem with deployment to AWS Lambda. Twice the deployment failed, one because of a bug in the deployment script (\"Service\" tag does not appear for all AWS Roles, see <denchmark-link:https://bentoml.slack.com/archives/CKRANBHPH/p1577026534009000>https://bentoml.slack.com/archives/CKRANBHPH/p1577026534009000</denchmark-link>\n ) and once because of some permissions issue with this role.\n The problem is that now both failed deployments appear in the deployment list and delete fails because it does not find the endpoints.\n To Reproduce\n Steps to reproduce the behavior:\n \n Make sure a deployment script to sagemaker will fail.\n Deploy to sagemaker\n Run bentoml deployment delete <deployment name>\n See error\n \n Expected behavior\n The deployment should be deleted as best is possible and not appear in the list.\n Screenshots/Logs\n <denchmark-code>[2020-01-29 09:28:38,670] ERROR - AWS ClientError - operation: DeleteEndpoint, code: ValidationException, message: Could not find endpoint \"arn:aws:sagemaker:eu-central-1:436054152060:endpoint/dev-hektor-sagemaker-2\".\n Failed to delete deployment hektor-sagemaker-2. INTERNAL:AWS ClientError - operation: DeleteEndpoint, code: ValidationException, message: Could not find endpoint \"arn:aws:sagemaker:eu-central-1:436054152060:endpoint/dev-hektor-sagemaker-2\".\n \n </denchmark-code>\n \n Environment:\n \n OS: Linux omri-pc 5.4.14-2-MANJARO #1 SMP PREEMPT Fri Jan 24 09:34:16 UTC 2020 x86_64 GNU/Linux\n Python/BentoML Version Python 3.7.6, BentoML-0.6.1\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "omrihar", "commentT": "2020-02-10T21:42:33Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/omrihar>@omrihar</denchmark-link>\n  , I believe the first issue you mentioned has been fixed in <denchmark-link:https://github.com/bentoml/BentoML/pull/510>#510</denchmark-link>\n \n To delete a deployment record without confirming cloud resource being deleted, try out the -f/--force option: bentoml deployment delete -f <deployment name>\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "omrihar", "commentT": "2020-02-11T00:10:29Z", "comment_text": "\n \t\tPR <denchmark-link:https://github.com/bentoml/BentoML/pull/522>#522</denchmark-link>\n  has also just introduced a fix for the second issue when the SageMaker endpoint has already been deleted.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "omrihar", "commentT": "2020-02-11T00:46:51Z", "comment_text": "\n \t\t0.6.2 has just been released with the fix in <denchmark-link:https://github.com/bentoml/BentoML/pull/522>#522</denchmark-link>\n  <denchmark-link:https://github.com/bentoml/BentoML/releases/tag/v0.6.2>https://github.com/bentoml/BentoML/releases/tag/v0.6.2</denchmark-link>\n \n <denchmark-link:https://github.com/omrihar>@omrihar</denchmark-link>\n  feel free to reopen if you ran into any issue with the new version\n \t\t"}}}, "commit": {"commit_id": "5442dbd5c9b68c867d632452e3099246657be664", "commit_author": "Bozhao", "commitT": "2020-02-10 16:24:02-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "bentoml\\deployment\\sagemaker\\__init__.py", "file_new_name": "bentoml\\deployment\\sagemaker\\__init__.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "709", "deleted_lines": "708,709,710,711,712,713", "method_info": {"method_name": "delete", "method_params": "self,deployment_pb", "method_startline": "699", "method_endline": "713"}}, "hunk_1": {"Ismethod": 1, "added_lines": "331,338", "deleted_lines": "331,338", "method_info": {"method_name": "_try_clean_up_sagemaker_deployment_resource", "method_params": "deployment_pb", "method_startline": "331", "method_endline": "344"}}, "hunk_2": {"Ismethod": 1, "added_lines": "331,338,345", "deleted_lines": "331,338", "method_info": {"method_name": "delete_sagemaker_deployment_resources_if_exist", "method_params": "deployment_pb", "method_startline": "331", "method_endline": "345"}}, "hunk_3": {"Ismethod": 1, "added_lines": "539", "deleted_lines": "538", "method_info": {"method_name": "_add", "method_params": "self,deployment_pb,bento_pb,bento_path", "method_startline": "493", "method_endline": "542"}}, "hunk_4": {"Ismethod": 1, "added_lines": "694", "deleted_lines": "693", "method_info": {"method_name": "_update", "method_params": "self,deployment_pb,current_deployment,bento_pb,bento_path", "method_startline": "572", "method_endline": "697"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\deployment\\sagemaker\\sagemaker_moto\\model.py", "file_new_name": "tests\\deployment\\sagemaker\\sagemaker_moto\\model.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "121,122,123,124,125,126,127,128,129", "deleted_lines": "121", "method_info": {"method_name": "delete_endpoint", "method_params": "self,endpoint_name", "method_startline": "119", "method_endline": "131"}}}}}}}