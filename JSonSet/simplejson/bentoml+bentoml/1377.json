{"BR": {"BR_id": "1377", "BR_author": "terrykong", "BRopenT": "2021-01-04T19:50:39Z", "BRcloseT": "2021-01-11T23:11:55Z", "BR_text": {"BRsummary": "`request_id` in response header seems broken", "BRdescription": "\n Describe the bug\n It appears that there is something wrong with the request_id value that is returned from a prediction request's response headers\n To Reproduce\n What I\u2019m observing is if I make multiple requests:\n <denchmark-code>curl -L -i \\\n -H \"Content-Type: application/json\" \\\n -d \"{\\\"query\\\":[[\\\"hello world\\\"]]}\" \\\n -X POST $URL\n </denchmark-code>\n \n I will observe the same \u201crequest_id\u201d a2f075c1-91a1-4a9c-9b25-6b634cf33f95 even if i make different requests. see\n <denchmark-code>HTTP/1.1 200 OK\n X-DNS-Prefetch-Control: off\n X-Frame-Options: SAMEORIGIN\n Strict-Transport-Security: max-age=15552000; includeSubDomains\n X-Download-Options: noopen\n X-Content-Type-Options: nosniff\n X-XSS-Protection: 1; mode=block\n X-Request-Id: 6d7afbf0-c72c-48d5-9818-0b87bcf873bc\n content-length: 100\n content-type: application/json\n date: Mon, 04 Jan 2021 17:42:28 GMT\n request_id: a2f075c1-91a1-4a9c-9b25-6b634cf33f95\n server: gunicorn/20.0.4\n connection: close\n Vary: Accept-Encoding\n </denchmark-code>\n \n Also, aside from the \u201crequest_id\u201d not changing, it also appears that the request_id that\u2019s logged in predictions.log is just different, see this line\n <denchmark-code>{\"service_name\": \"FooService\", \"service_version\": \"20201216204449_CC2735\", \"api\": \"is_it_correct\", \"request_id\": \"2ae81393-30b4-4a04-8029-d8c14530f43d\", \"task\": {\"data\": \"{\\\"query\\\":[[\\\"hello world\\\"]]}\", \"task_id\": \"2ae81393-30b4-4a04-8029-d8c14530f43d\", \"http_headers\": [[\"Host\", \"--redacted--\"], [\"User-Agent\", \"curl/7.71.1\"], [\"Content-Length\", \"49\"], [\"Accept\", \"*/*\"], [\"Content-Type\", \"application/json\"], [\"X-Forwarded-For\", \"192.168.192.1\"], [\"X-Forwarded-Host\", \"--redacted--\"], [\"X-Forwarded-Port\", \"8093\"], [\"X-Forwarded-Prefix\", \"/predict\"], [\"X-Forwarded-Proto\", \"http\"], [\"X-Forwarded-Server\", \"6e1efdeb5044\"], [\"X-Real-Ip\", \"192.168.192.1\"], [\"Accept-Encoding\", \"gzip\"]]}, \"result\": {\"data\": \"{\\\"top_tags\\\": [[\\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"\\\", \\\"?\\\"]], \\\"result\\\": [\\\"correct\\\"]}\", \"http_status\": 200, \"http_headers\": [[\"Content-Type\", \"application/json\"]]}, \"asctime\": \"2021-01-04 17:42:28,634\"}\n </denchmark-code>\n \n Interestingly, a2f075c1-91a1-4a9c-9b25-6b634cf33f95 doesn\u2019t appear anywhere in predictions.log\n Expected behavior\n Screenshots/Logs\n Environment:\n \n OS: [e.g. MacOS 10.14.3]\n Python Version [e.g. Python 3.7.1]\n BentoML Version [e.g. BentoML-0.8.6]\n \n Additional context\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "terrykong", "commentT": "2021-01-11T23:12:27Z", "comment_text": "\n \t\tThis issue has been fixed in <denchmark-link:https://github.com/bentoml/BentoML/pull/1390>#1390</denchmark-link>\n  and will be available in the upcoming release 0.11.0\n \t\t"}}}, "commit": {"commit_id": "568c44877027cf1e6032a7f0e0aaee7d0756cdad", "commit_author": "bojiang", "commitT": "2021-01-11 15:11:54-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bentoml\\adapters\\json_output.py", "file_new_name": "bentoml\\adapters\\json_output.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "19", "deleted_lines": "19,20,21,22"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "bentoml\\server\\api_server.py", "file_new_name": "bentoml\\server\\api_server.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "335,336", "method_info": {"method_name": "bento_service_api_func_wrapper.api_func", "method_params": "", "method_startline": "301", "method_endline": "337"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "299,335,336", "method_info": {"method_name": "bento_service_api_func_wrapper", "method_params": "self,InferenceAPI", "method_startline": "294", "method_endline": "345"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "bentoml\\service\\inference_api.py", "file_new_name": "bentoml\\service\\inference_api.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "301,302,303,304", "deleted_lines": "300", "method_info": {"method_name": "handle_batch_request", "method_params": "self", "method_startline": "294", "method_endline": "304"}}, "hunk_1": {"Ismethod": 1, "added_lines": "291", "deleted_lines": null, "method_info": {"method_name": "handle_request", "method_params": "self,Request", "method_startline": "285", "method_endline": "292"}}}}}}}