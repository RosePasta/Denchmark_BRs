{"BR": {"BR_id": "329", "BR_author": "tholor", "BRopenT": "2020-08-20T12:32:02Z", "BRcloseT": "2020-08-21T07:24:49Z", "BR_text": {"BRsummary": "Slow FAISSDocumentStore due to SQL bottleneck", "BRdescription": "\n Describe the bug\n The FAISSDocumentStore becomes incredibly slow when increasing the number of documents.\n For 1000 docs it currently already takes > 10s (using sqlite).\n The bottleneck is not the embedding similarity in FAISS, but rather the inefficient lookup of the documents in SQL for the vector_ids returned from FAISS:\n \n \n \n haystack/haystack/database/faiss.py\n \n \n         Lines 153 to 155\n       in\n       a54d6a5\n \n \n \n \n \n \n  documents = [ \n \n \n \n  self.get_all_documents(filters={\"vector_id\": [vector_id]})[0] for vector_id in vector_ids_for_query \n \n \n \n  ] \n \n \n \n \n \n Expected behavior\n Scalable and efficient lookup in SQL > 1s\n Suggested Improvements\n \n Only executing the query once by removing several .all() calls in get_all_documents()\n index for vector_ids\n Single query for all vector_ids instead of list comprehension\n \n To Reproduce\n Run Tutorial 6\n System:\n \n OS: Ubuntu 18.04\n GPU/CPU: CPU\n Haystack version (commit or version number): latest master (a54d6a5)\n DocumentStore: FAISS\n Reader: FARMReader\n Retriever: DPR\n \n \t"}, "comments": {}}, "commit": {"commit_id": "7d2a8f19fc4b8e5aec61559dc2fa2915afa30dbe", "commit_author": "Tanay Soni", "commitT": "2020-08-21 09:24:49+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "haystack\\database\\faiss.py", "file_new_name": "haystack\\database\\faiss.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "153,154,155", "deleted_lines": "153,154,155"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "haystack\\database\\sql.py", "file_new_name": "haystack\\database\\sql.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "83,84", "deleted_lines": "83,84", "method_info": {"method_name": "get_all_documents", "method_params": "self,None,str,None", "method_startline": "83", "method_endline": "84"}}, "hunk_1": {"Ismethod": 1, "added_lines": "83,84,87", "deleted_lines": "83,84,85,86,87,88", "method_info": {"method_name": "get_all_documents", "method_params": "self,None,None,None,str,None", "method_startline": "83", "method_endline": "88"}}}}}}}