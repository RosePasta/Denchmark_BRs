{"BR": {"BR_id": "655", "BR_author": "dmit25", "BRopenT": "2020-04-25T09:34:47Z", "BRcloseT": "2020-05-28T14:38:54Z", "BR_text": {"BRsummary": "PRF evaluator: list index out of range", "BRdescription": "\n Hi!\n I'm getting list index out of range when prf evaluator is used.\n Config:\n Model: TransformerRelative\n params:\n beam_width: 1\n train:\n maximum_features_length: 50\n maximum_labels_length: 50\n save_summary_steps: 100\n sample_buffer_size: 1000000\n keep_checkpoint_max: 20\n save_checkpoints_steps: 5000\n max_step: 2000000\n eval:\n batch_size: 32\n steps: 5000\n export_on_best: bleu\n external_evaluators: [ \"bleu\", \"prf\", \"wer\" ]\n infer:\n batch_size: 1024\n Full stack:\n W tensorflow/core/kernels/data/generator_dataset_op.cc:103] Error occurred when finalizing GeneratorDataset iterator: Cancelled: Operation was cancelled\n Traceback (most recent call last):\n File \"/home/dima/anaconda3/envs/tf/bin/onmt-main\", line 8, in \n sys.exit(main())\n File \"/home/dima/anaconda3/envs/tf/lib/python3.7/site-packages/opennmt/bin/main.py\", line 224, in main\n hvd=hvd)\n File \"/home/dima/anaconda3/envs/tf/lib/python3.7/site-packages/opennmt/runner.py\", line 217, in train\n moving_average_decay=train_config.get(\"moving_average_decay\"))\n File \"/home/dima/anaconda3/envs/tf/lib/python3.7/site-packages/opennmt/training.py\", line 118, in call\n early_stop = self._evaluate(evaluator, step, moving_average=moving_average)\n File \"/home/dima/anaconda3/envs/tf/lib/python3.7/site-packages/opennmt/training.py\", line 140, in _evaluate\n evaluator(step)\n File \"/home/dima/anaconda3/envs/tf/lib/python3.7/site-packages/opennmt/evaluation.py\", line 299, in call\n score = scorer(self._labels_file, output_path)\n File \"/home/dima/anaconda3/envs/tf/lib/python3.7/site-packages/opennmt/utils/scorers.py\", line 132, in call\n precision_score, recall_score, fmeasure_score = fmeasure(ref_path, hyp_path)\n File \"/home/dima/anaconda3/envs/tf/lib/python3.7/site-packages/opennmt/utils/fmeasure.py\", line 49, in fmeasure\n if tag == classref[linecpt][tagcpt]:\n IndexError: list index out of range\n Can I help you with  the issue? I'm not familiar with the code base, but I can try to reproduce it locally and extract the context if necessary.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "dmit25", "commentT": "2020-04-25T11:34:32Z", "comment_text": "\n \t\tHello,\n <denchmark-link:https://github.com/cservan>@cservan</denchmark-link>\n  Does the error mean anything to you?\n \n Can I help you with the issue? I'm not familiar with the code base, but I can try to reproduce it locally and extract the context if necessary.\n \n Sure, that would be helpful. If you want to go further and fix the issue, you could first try to add a test in  to reproduce the error. (You can find more information on how to run tests <denchmark-link:https://github.com/OpenNMT/OpenNMT-tf/blob/master/CONTRIBUTING.md#testing>here</denchmark-link>\n .)\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "dmit25", "commentT": "2020-04-25T16:01:54Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/guillaumekln>@guillaumekln</denchmark-link>\n  ,\n I'll take a look, it seems it comes from the \"prf\" scorer.\n Cheers,\n C.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "dmit25", "commentT": "2020-05-26T12:30:04Z", "comment_text": "\n \t\tIt is most likely related to an empty hypothesis or reference.\n \t\t"}}}, "commit": {"commit_id": "58315f1bc7da64828309328e3a7f615df57cb7cb", "commit_author": "Guillaume Klein", "commitT": "2020-05-28 16:38:53+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "opennmt\\tests\\scorers_test.py", "file_new_name": "opennmt\\tests\\scorers_test.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "11,12,13,14", "deleted_lines": "11,12,13,14", "method_info": {"method_name": "_run_scorer", "method_params": "self,scorer,refs,hyps", "method_startline": "11", "method_endline": "14"}}, "hunk_1": {"Ismethod": 1, "added_lines": "43,44,45,46", "deleted_lines": null, "method_info": {"method_name": "testPRFScorerEmptyLine", "method_params": "self", "method_startline": "43", "method_endline": "46"}}, "hunk_2": {"Ismethod": 1, "added_lines": "23,24,25", "deleted_lines": "22,26,27,28", "method_info": {"method_name": "testROUGEScorer", "method_params": "self", "method_startline": "22", "method_endline": "30"}}, "hunk_3": {"Ismethod": 1, "added_lines": "11,12,13,14,17", "deleted_lines": "10,11,12,13,14,15,16,17", "method_info": {"method_name": "_make_perfect_hypothesis_file", "method_params": "self", "method_startline": "10", "method_endline": "17"}}, "hunk_4": {"Ismethod": 1, "added_lines": "17,18,19", "deleted_lines": "16,17,20", "method_info": {"method_name": "testBLEUScorer", "method_params": "self", "method_startline": "16", "method_endline": "20"}}, "hunk_5": {"Ismethod": 1, "added_lines": "32,33,34,35,36,37,38,39,40,41", "deleted_lines": null, "method_info": {"method_name": "testPRFScorer", "method_params": "self", "method_startline": "32", "method_endline": "41"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "opennmt\\utils\\fmeasure.py", "file_new_name": "opennmt\\utils\\fmeasure.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "29,34,39,77,78,79,80,81", "deleted_lines": "12,19,20,21,22,26,34,36,37,38,41,44,49,54,61,63,90,91,92,93,94,95"}}}}}}