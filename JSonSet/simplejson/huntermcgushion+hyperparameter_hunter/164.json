{"BR": {"BR_id": "164", "BR_author": "HunterMcGushion", "BRopenT": "2019-07-17T02:49:22Z", "BRcloseT": "2019-07-27T05:09:55Z", "BR_text": {"BRsummary": "Bug matching multiple `Categorical.optional` `EngineerStep`s", "BRdescription": "\n <denchmark-h:h1>Description</denchmark-h>\n \n \n OptPros don\u2019t match with saved results when the space contains multiple Categorical EngineerSteps, wherein a Categorical step that is NOT the last EngineerStep has optional=True\n In other words, using optional anywhere other than the last EngineerStep causes problems for experiment matching\n \n <denchmark-h:h1>Code to Reproduce Bug</denchmark-h>\n \n from hyperparameter_hunter import Environment, CVExperiment, ExtraTreesOptPro\n from hyperparameter_hunter import Categorical\n from hyperparameter_hunter.utils.learning_utils import get_boston_data\n from xgboost import XGBRegressor\n \n #################### Dummy EngineerStep Functions ####################\n def es_a(all_inputs):\n     return all_inputs\n \n def es_b(all_inputs):\n     return all_inputs\n \n #################### Environment ####################\n env = Environment(\n     train_dataset=get_boston_data(),\n     results_path=\"HyperparameterHunterAssets\",\n     target_column=\"DIS\",\n     metrics=[\"r2_score\"],\n     cv_type=\"KFold\",\n     cv_params=dict(n_splits=3, random_state=1),\n )\n \n #################### Two OptPros With Same Params ####################\n feature_engineer = [\n     Categorical([es_a], optional=True),\n     Categorical([es_b], optional=True),\n ]\n \n opt_0 = ExtraTreesOptPro(iterations=4, random_state=32)\n opt_0.forge_experiment(XGBRegressor, feature_engineer=feature_engineer)\n opt_0.go()\n \n opt_1 = ExtraTreesOptPro(iterations=4, random_state=32)\n opt_1.forge_experiment(XGBRegressor, feature_engineer=feature_engineer)\n opt_1.go()\n \n # Assert `opt_1` matched with all Experiments executed by `opt_0`\n assert len(opt_1.similar_experiments) == opt_0.successful_iterations\n <denchmark-h:h1>Log</denchmark-h>\n \n <denchmark-code>Validated Environment with key: \"BqfuzaWOeicbQoF2ew3fALX-y0uU3gDrTvJUdBn3IYI=\"\n Experiments matching cross-experiment key/algorithm: 0\n Experiments fitting in the given space: 0\n Experiments matching current guidelines: 0\n Saved Result Files\n ______________________________________________________________________\n  Step |       ID |   Time |      Value |   (steps, 0) |   (steps, 1) | \n Hyperparameter Optimization\n ______________________________________________________________________\n  Step |       ID |   Time |      Value |   (steps, 0) |   (steps, 1) | \n     0 | aeb59130 | 00m05s |    0.60061 |       <NONE> |         es_b | \n     1 | ee468eb9 | 00m00s |    0.60061 |       <NONE> |       <NONE> | \n     2 | 6cebcb67 | 00m00s |    0.60061 |         es_a |       <NONE> | \n     3 | 95039ec6 | 00m00s |    0.60061 |         es_a |         es_b | \n Optimization loop completed in 0:00:01.287102\n Best score was 0.6006127292026042 from Experiment \"aeb59130-8fb2-45b0-b950-febf134b2dae\"\n \n Validated Environment with key: \"BqfuzaWOeicbQoF2ew3fALX-y0uU3gDrTvJUdBn3IYI=\"\n Experiments matching cross-experiment key/algorithm: 4\n Experiments fitting in the given space: 3\n Experiments matching current guidelines: 3\n Saved Result Files\n ______________________________________________________________________\n  Step |       ID |   Time |      Value |   (steps, 0) |   (steps, 1) | \n     0 | ee468eb9 | 00m02s |    0.60061 |       <NONE> |       <NONE> | \n     1 | 6cebcb67 | 00m00s |    0.60061 |         es_a |       <NONE> | \n     2 | 95039ec6 | 00m00s |    0.60061 |         es_a |         es_b | \n Hyperparameter Optimization\n ______________________________________________________________________\n  Step |       ID |   Time |      Value |   (steps, 0) |   (steps, 1) | \n Hyperparameter search space has been exhausted\n </denchmark-code>\n \n \n Log shows that \"aeb59130\" was not a match, whose first step was nothing, followed by an actual function\n \n \t"}, "comments": {}}, "commit": {"commit_id": "ec4a01eed0ef261a301db76009a0cecfcf68f66e", "commit_author": "Hunter McGushion", "commitT": "2019-07-26 22:09:52-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "hyperparameter_hunter\\optimization\\protocol_core.py", "file_new_name": "hyperparameter_hunter\\optimization\\protocol_core.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "559,560,561", "deleted_lines": "564", "method_info": {"method_name": "_execute_experiment", "method_params": "self", "method_startline": "533", "method_endline": "571"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 26, "file_old_name": "hyperparameter_hunter\\result_reader.py", "file_new_name": "hyperparameter_hunter\\result_reader.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,561,562,563,564,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592", "deleted_lines": null, "method_info": {"method_name": "find", "method_params": "self", "method_startline": "537", "method_endline": "593"}}, "hunk_1": {"Ismethod": 1, "added_lines": "118,119,120,121,122,123,124,125", "deleted_lines": "118,119,120,121,122,123,124", "method_info": {"method_name": "update_match_status.wrapper", "method_params": "wrapped,instance,args,kwargs", "method_startline": "118", "method_endline": "125"}}, "hunk_2": {"Ismethod": 1, "added_lines": "806,807,808,809,810,811,812,813,814,815,816,818,819,820,821,823,824,825,826,827,828,829,830,831,832,833,834,835,837", "deleted_lines": null, "method_info": {"method_name": "does_match_extra_params_guidelines", "method_params": "self,exp_id,params,score", "method_startline": "806", "method_endline": "837"}}, "hunk_3": {"Ismethod": 1, "added_lines": "210,211,212,213,214,215", "deleted_lines": "214", "method_info": {"method_name": "_filter_by_guidelines_multi._visit", "method_params": "path,key,value", "method_startline": "210", "method_endline": "215"}}, "hunk_4": {"Ismethod": 1, "added_lines": "705,706,707,708,712,713,714,715,716,717,723,724,725,726,727,734,736,739,740,742,745,746,747,748,749,750,751,754,755,756,757,758,760,765,768,769,770,771,772,774,775", "deleted_lines": null, "method_info": {"method_name": "does_match_init_params_guidelines_multi", "method_params": "self,exp_id,params,score,location", "method_startline": "705", "method_endline": "777"}}, "hunk_5": {"Ismethod": 1, "added_lines": "824,825,826,827,828", "deleted_lines": null, "method_info": {"method_name": "does_match_extra_params_guidelines.visit_empty_dicts", "method_params": "path,key,value", "method_startline": "824", "method_endline": "828"}}, "hunk_6": {"Ismethod": 1, "added_lines": "162,163,164,165,166,167,168,169,170,171,172,173,174,175", "deleted_lines": "162,163,164,165,169,170,171,172,173,174", "method_info": {"method_name": "_filter_by_guidelines", "method_params": "self,model_params", "method_startline": "162", "method_endline": "175"}}, "hunk_7": {"Ismethod": 1, "added_lines": "481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535", "deleted_lines": null, "method_info": {"method_name": "mini_spaces", "method_params": "self", "method_startline": "481", "method_endline": "535"}}, "hunk_8": {"Ismethod": 1, "added_lines": "351", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,algorithm_name,module_name,cross_experiment_key,target_metric,space,leaderboard_path,descriptions_dir,model_params,sort", "method_startline": "341", "method_endline": "351"}}, "hunk_9": {"Ismethod": 1, "added_lines": "784,785,789,790,791,792,793,794,798,799,800,801,802", "deleted_lines": null, "method_info": {"method_name": "does_match_extra_params_space", "method_params": "self,exp_id,params,score", "method_startline": "784", "method_endline": "802"}}, "hunk_10": {"Ismethod": 1, "added_lines": "182,183,184,185,186,187,188,189,190,191,192,193", "deleted_lines": null, "method_info": {"method_name": "_visit", "method_params": "path,key,value", "method_startline": "182", "method_endline": "193"}}, "hunk_11": {"Ismethod": 1, "added_lines": "155,156,157,158,159,160", "deleted_lines": "155,156,157,158,159", "method_info": {"method_name": "_filter_by_space", "method_params": "self", "method_startline": "155", "method_endline": "160"}}, "hunk_12": {"Ismethod": 1, "added_lines": "225,226,227,228,229,230,231", "deleted_lines": "225,226,227,228,229,230,231", "method_info": {"method_name": "_reinitialize_similar_experiments", "method_params": "self", "method_startline": "225", "method_endline": "231"}}, "hunk_13": {"Ismethod": 1, "added_lines": "765", "deleted_lines": null, "method_info": {"method_name": "does_match_init_params_guidelines_multi._visit", "method_params": "path,key,value", "method_startline": "761", "method_endline": "766"}}, "hunk_14": {"Ismethod": 1, "added_lines": "137,138,139,140,141,142,143,144,145", "deleted_lines": "137,138,139,140,141,142,143,144", "method_info": {"method_name": "_get_ids", "method_params": "self", "method_startline": "137", "method_endline": "145"}}, "hunk_15": {"Ismethod": 1, "added_lines": "460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478", "deleted_lines": null, "method_info": {"method_name": "experiment_ids", "method_params": "self", "method_startline": "460", "method_endline": "478"}}, "hunk_16": {"Ismethod": 1, "added_lines": "601,602", "deleted_lines": null, "method_info": {"method_name": "does_match_feature_engineer", "method_params": "self,exp_id,params,score", "method_startline": "601", "method_endline": "602"}}, "hunk_17": {"Ismethod": 1, "added_lines": "641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658", "deleted_lines": null, "method_info": {"method_name": "does_match_init_params_space", "method_params": "self,exp_id,params,score", "method_startline": "641", "method_endline": "659"}}, "hunk_18": {"Ismethod": 1, "added_lines": "663,664", "deleted_lines": null, "method_info": {"method_name": "does_match_init_params_guidelines", "method_params": "self,exp_id,params,score,template_params", "method_startline": "663", "method_endline": "664"}}, "hunk_19": {"Ismethod": 1, "added_lines": "177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223", "deleted_lines": "177,178,179,194,196,199,203,204,207,208,214,217,219,220,221", "method_info": {"method_name": "_filter_by_guidelines_multi", "method_params": "self,location", "method_startline": "177", "method_endline": "223"}}, "hunk_20": {"Ismethod": 1, "added_lines": "55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127", "deleted_lines": "62,101,112,113,117,118,119,120,121,122,123,124,126,127", "method_info": {"method_name": "update_match_status", "method_params": "target_attr", "method_startline": "55", "method_endline": "127"}}, "hunk_21": {"Ismethod": 1, "added_lines": "147,148,149,150,151,152,153", "deleted_lines": "147,148,149,150,151,152,153", "method_info": {"method_name": "_get_scored_params", "method_params": "self", "method_startline": "147", "method_endline": "153"}}, "hunk_22": {"Ismethod": 1, "added_lines": "233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263", "deleted_lines": "233,234,235,239,240,241,245,246,247,248,249,250,251,252,253,255,256,257,259,260,261,263", "method_info": {"method_name": "_get_initialized_exp", "method_params": "self,dict,Number", "method_startline": "233", "method_endline": "263"}}, "hunk_23": {"Ismethod": 1, "added_lines": "130,131,132,133,134,135", "deleted_lines": "130,131,132,133,134,135", "method_info": {"method_name": "does_match_guidelines", "method_params": "dict,Space,dict,visitors", "method_startline": "130", "method_endline": "135"}}, "hunk_24": {"Ismethod": 1, "added_lines": "209,210", "deleted_lines": null, "method_info": {"method_name": "validate_feature_engineer", "method_params": "dict,FeatureEngineer", "method_startline": "209", "method_endline": "210"}}, "hunk_25": {"Ismethod": 1, "added_lines": "255,256", "deleted_lines": "255,256", "method_info": {"method_name": "validate_fe_steps", "method_params": "list,list", "method_startline": "255", "method_endline": "256"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "hyperparameter_hunter\\utils\\optimization_utils.py", "file_new_name": "hyperparameter_hunter\\utils\\optimization_utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "168,169,170,171,172,173,174,175", "method_info": {"method_name": "filter_by_guidelines", "method_params": "hyperparameters_and_scores,space,model_init_params,model_extra_params,feature_engineer,feature_selector,kwargs", "method_startline": "168", "method_endline": "175"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249", "method_info": {"method_name": "_visit", "method_params": "path,key,value", "method_startline": "229", "method_endline": "249"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\integration_tests\\feature_engineering\\test_feature_optimization.py", "file_new_name": "tests\\integration_tests\\feature_engineering\\test_feature_optimization.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "416,417,418,419", "deleted_lines": null, "method_info": {"method_name": "test_not_similar_experiments", "method_params": "env_boston,fe_experiment,fe_optimizer", "method_startline": "416", "method_endline": "419"}}}}, "file_4": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\test_result_reader.py"}}}}