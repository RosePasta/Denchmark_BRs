{"BR": {"BR_id": "10545", "BR_author": "edoakes", "BRopenT": "2020-09-03T19:02:26Z", "BRcloseT": "2020-09-04T00:48:32Z", "BR_text": {"BRsummary": "Can't clean up named actor (non-detached)", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Non-detached actor names don't seem to be reclaimed when the actor exits.\n Discovered while refactoring Serve to support clusters scoped to the driver program.\n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n <denchmark-code>import time\n import ray\n \n ray.init()\n \n @ray.remote\n class A:\n     pass\n \n a = A.options(name=\"hello\").remote()\n ray.kill(a, no_restart=True)\n del a\n \n # This loop never exits.\n while True:\n     try:\n         ray.get_actor(\"hello\")\n         print(\"Actor still alive\")\n     except:\n         print(\"Actor was deleted\")\n         break\n     time.sleep(1)\n </denchmark-code>\n \n If we cannot run your script, we cannot fix your issue.\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "edoakes", "commentT": "2020-09-03T19:04:03Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ericl>@ericl</denchmark-link>\n  Making this P0 because it is a pretty fundamental issue for the named actor API and it's a blocker for the serve change we want to get in for 1.0. LMK if you disagree.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "edoakes", "commentT": "2020-09-03T19:14:30Z", "comment_text": "\n \t\tLittle outside topic, but Why don't we make actors detached if name is provided but lifetime is not? It will secretly breaks lots of people's codebase otherwise.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "edoakes", "commentT": "2020-09-03T19:40:36Z", "comment_text": "\n \t\tre: <denchmark-link:https://github.com/rkooo567>@rkooo567</denchmark-link>\n  that would prevent users from creating non detached actors that are named, which is a key requirement from Ant and also used in RLlib (this was broken by the recent change to couple named with detached).\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "edoakes", "commentT": "2020-09-03T19:42:17Z", "comment_text": "\n \t\tOk I see, it's just an issue with removing the name label, only read the last comment.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "edoakes", "commentT": "2020-09-03T20:26:55Z", "comment_text": "\n \t\tThis seems like it's probably the culprit:\n <denchmark-link:https://github.com/ray-project/ray/blob/master/src/ray/gcs/gcs_server/gcs_actor_manager.h#L95>https://github.com/ray-project/ray/blob/master/src/ray/gcs/gcs_server/gcs_actor_manager.h#L95</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "ead30ca6557762e22595798f53b3ef68a41281c6", "commit_author": "Edward Oakes", "commitT": "2020-09-03 17:48:31-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\tests\\test_actor_advanced.py", "file_new_name": "python\\ray\\tests\\test_actor_advanced.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "652,653,654,655,656,657", "deleted_lines": null, "method_info": {"method_name": "test_named_but_not_detached.check_name_available", "method_params": "name", "method_startline": "652", "method_endline": "657"}}, "hunk_1": {"Ismethod": 1, "added_lines": "650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669", "deleted_lines": null, "method_info": {"method_name": "test_named_but_not_detached", "method_params": "ray_start_regular", "method_startline": "624", "method_endline": "669"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\ray\\gcs\\gcs_server\\gcs_actor_manager.cc", "file_new_name": "src\\ray\\gcs\\gcs_server\\gcs_actor_manager.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "572,573,574,575,576,577,578,579,580", "deleted_lines": null, "method_info": {"method_name": "ray::gcs::GcsActorManager::DestroyActor", "method_params": "actor_id", "method_startline": "557", "method_endline": "650"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\ray\\gcs\\gcs_server\\gcs_actor_manager.h", "file_new_name": "src\\ray\\gcs\\gcs_server\\gcs_actor_manager.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "95", "deleted_lines": "95"}}}}}}