{"BR": {"BR_id": "12831", "BR_author": "sven1977", "BRopenT": "2020-12-13T10:39:32Z", "BRcloseT": "2020-12-13T15:15:54Z", "BR_text": {"BRsummary": "[RLlib] AttributeError: 'NoneType' object has no attribute 'id' when using custom Atari env.", "BRdescription": "\n Chris reported the following problem on the discuss.ray.io forum:\n <denchmark-h:hr></denchmark-h>\n \n Hi,\n I\u2019m just getting started with RLlib and becoming more and more desperate using a modified Atari environment. I want to utilize the gym.ObserverationWrapper for domain adaptation, hence manipulating the observation.\n It works like a charm for Pong and Breakout with observation type == \u2018ram\u2019, thus not the actual images.\n As soon as I change the observation type to == \u2018image\u2019, I obtain the following error:\n <denchmark-code>  File \"/home/chris/.pyenv/versions/test_env/lib/python3.6/site-packages/ray/rllib/evaluation/rollout_worker.py\", line 404, in __init__\n     self.env: EnvType = wrap(self.env)\n   File \"/home/chris/.pyenv/versions/test_env/lib/python3.6/site-packages/ray/rllib/evaluation/rollout_worker.py\", line 391, in wrap\n     framestack=model_config.get(\"framestack\"))\n   File \"/home/chris/.pyenv/versions/test_env/lib/python3.6/site-packages/ray/rllib/env/atari_wrappers.py\", line 281, in wrap_deepmind\n     if \"NoFrameskip\" in env.spec.id:\n AttributeError: 'NoneType' object has no attribute 'id'\n </denchmark-code>\n \n I have simplified the code to the following and I am still obtaining the same error:\n <denchmark-code>import ray\n from ray import tune\n import ray.rllib.agents.impala as impala\n from gym.envs.atari import AtariEnv\n \n \n class AugmentedPong(AtariEnv):\n     def __init__(self, config):\n         super(AugmentedPong, self).__init__(game='pong', obs_type='image')\n \n \n def env_creator(env_config):\n     return AtariEnv(game='pong', obs_type='image', frameskip=1)\n \n \n config = impala.DEFAULT_CONFIG.copy()\n \n ray.init()\n trainer = impala.ImpalaTrainer(config=config, env=AugmentedPong)\n </denchmark-code>\n \n Ray version and other system information (Python version, TensorFlow version, OS):\n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Please provide a short code snippet (less than 50 lines if possible) that can be copy-pasted to reproduce the issue. The snippet should have no external library dependencies (i.e., use fake or mock data / environments):\n If the code snippet cannot be run by itself, the issue will be closed with \"needs-repro-script\".\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "sven1977", "commentT": "2020-12-13T10:41:55Z", "comment_text": "\n \t\tPR that fixes the issue:\n <denchmark-link:https://github.com/ray-project/ray/pull/12832>#12832</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "3c808835a59f461ccebd8f5ea02c2d491b59b5e0", "commit_author": "Sven Mika", "commitT": "2020-12-13 16:15:54+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\env\\atari_wrappers.py", "file_new_name": "rllib\\env\\atari_wrappers.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "281", "deleted_lines": "281", "method_info": {"method_name": "wrap_deepmind", "method_params": "env,dim,framestack", "method_startline": "270", "method_endline": "291"}}}}}}}