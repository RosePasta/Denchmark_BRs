{"BR": {"BR_id": "12650", "BR_author": "FarzanT", "BRopenT": "2020-12-07T16:12:00Z", "BRcloseT": "2020-12-18T03:17:09Z", "BR_text": {"BRsummary": "[tune] OverflowError: cannot serialize a bytes object larger than 4 GiB in pickle_checkpoint", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Ray[tune] PBT is unable to save trials where the model is larger than 4GB, resulting in the following error stack:\n <denchmark-code>Failure # 1 (occurred at 2020-12-07_10-50-59)\n Traceback (most recent call last):\n   File \"/u/ftaj/anaconda3/envs/drp/lib/python3.7/site-packages/ray/tune/ray_trial_executor.py\", line 348, in start_trial\n     self._start_trial(trial, checkpoint, train=train)\n   File \"/u/ftaj/anaconda3/envs/drp/lib/python3.7/site-packages/ray/tune/ray_trial_executor.py\", line 289, in _start_trial\n     self.restore(trial, checkpoint)\n   File \"/u/ftaj/anaconda3/envs/drp/lib/python3.7/site-packages/ray/tune/ray_trial_executor.py\", line 733, in restore\n     obj = TrainableUtil.checkpoint_to_object(value)\n   File \"/u/ftaj/anaconda3/envs/drp/lib/python3.7/site-packages/ray/tune/trainable.py\", line 86, in checkpoint_to_object\n     data_dict = TrainableUtil.pickle_checkpoint(checkpoint_path)\n   File \"/u/ftaj/anaconda3/envs/drp/lib/python3.7/site-packages/ray/tune/trainable.py\", line 80, in pickle_checkpoint\n     \"data\": data,\n OverflowError: cannot serialize a bytes object larger than 4 GiB\n </denchmark-code>\n \n Ray version and other system information (Python version, TensorFlow version, OS):\n Python 3.7.3\n Pytorch 1.7\n Ubuntu 18 LTS\n Ray Version: 1.0.1.post1 (unable to run on the nightly build as it results in other irrelevan errors)\n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Any model + weights whose size is larger than 4GB\n <denchmark-h:h3>Possible solution</denchmark-h>\n \n Use protocol=4 in pickle to serialize objects larger than 4GB.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "FarzanT", "commentT": "2020-12-08T02:41:28Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/richardliaw>@richardliaw</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "FarzanT", "commentT": "2020-12-14T17:51:14Z", "comment_text": "\n \t\tI think we can fix this by replacing pickle with ray.cloudpickle\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "FarzanT", "commentT": "2020-12-17T19:14:20Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/richardliaw>@richardliaw</denchmark-link>\n  Is there anything else that I can do? I've never submitted a pull request, but want to fix this issue as it's disallowing me to optimize larger models.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "FarzanT", "commentT": "2020-12-17T19:21:40Z", "comment_text": "\n \t\tThanks for the ping! Hmm can you try changing the one line \u201cimport pickle\u201d\n to \u201cimport ray.cloudpickle as pickle\u201d and see if that works?\n \n You may need to do this on all nodes of your cluster if you have multiple.\n <denchmark-link:#>\u2026</denchmark-link>\n \n \n On Thu, Dec 17, 2020 at 11:14 AM Farzan Taj ***@***.***> wrote:\n  @richardliaw <https://github.com/richardliaw> Is there anything else that\n  I can do? I've never submitted a pull request, but want to fix this issue\n  as it's disallowing me to optimize larger models.\n \n  \u2014\n  You are receiving this because you were mentioned.\n  Reply to this email directly, view it on GitHub\n  <#12650 (comment)>,\n  or unsubscribe\n  <https://github.com/notifications/unsubscribe-auth/ABCRZZOGITZ6RBAETTM2RM3SVJKCBANCNFSM4UQVPWOQ>\n  .\n \n \n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "FarzanT", "commentT": "2020-12-17T22:16:36Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/richardliaw>@richardliaw</denchmark-link>\n  Yes it did! Thank you!\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "FarzanT", "commentT": "2020-12-17T22:27:49Z", "comment_text": "\n \t\tVery cool! sorry for the the slow reply... been a bit busy these days. Do you want to push a pull-request? If you're busy I can do it quickly so that it gets fixed in later ray releases.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "FarzanT", "commentT": "2020-12-17T22:28:03Z", "comment_text": "\n \t\t(But it'd be awesome for you to do it :) )\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "FarzanT", "commentT": "2020-12-17T22:29:06Z", "comment_text": "\n \t\tNo problem at all, I understand how busy you are! I'll give it a try, have to do a bit of research on how to do this properly.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "FarzanT", "commentT": "2020-12-17T23:51:13Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/richardliaw>@richardliaw</denchmark-link>\n  Hey, I just made the changes but don't know how to assign you.\n \t\t"}}}, "commit": {"commit_id": "53378170e07441e0bb6c9dbb3581bf6be289936f", "commit_author": "Farzan Taj", "commitT": "2020-12-17 19:17:08-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\tune\\trainable.py", "file_new_name": "python\\ray\\tune\\trainable.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "8", "deleted_lines": "8"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\tune\\utils\\trainable.py", "file_new_name": "python\\ray\\tune\\utils\\trainable.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "8", "deleted_lines": "8"}}}}}}