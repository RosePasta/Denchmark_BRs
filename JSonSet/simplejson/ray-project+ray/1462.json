{"BR": {"BR_id": "1462", "BR_author": "mktal", "BRopenT": "2018-01-24T07:59:07Z", "BRcloseT": "2018-01-26T22:29:53Z", "BR_text": {"BRsummary": "local scheduler crashes", "BRdescription": "\n <denchmark-h:h3>System information</denchmark-h>\n \n \n OS Platform and Distribution: Linux Ubuntu 16.04\n Ray installed from (source or binary): source\n Ray version: f130329\n Python version: 2.7.14\n Exact command to reproduce:\n \n Start ray on one machine:\n <denchmark-code>ray start --head --redis-port=6379\n </denchmark-code>\n \n And running the following code on the same machine results in a core dump:\n class Foo(object):\n     def __init__(self):\n         pass\n \n     def act(self):\n         pass\n \n ray.init(redis_address=\"xx.xx.xxx.xx:6379\")\n wks = [ray.remote(Foo).remote() for i in range(2)]\n The issue won't happen though if we add one more line in the end\n [ray.get(wk.act.remote()) for wk in wks]\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "mktal", "commentT": "2018-01-24T21:21:59Z", "comment_text": "\n \t\tThanks for reporting the bug! I think I can reproduce it when running the code as a script (but not when running it in an interpreter).\n Can you check /tmp/raylogs and looking at the local scheduler logs? When I do this it looks to me like the local scheduler is crashing with\n <denchmark-code>[FATAL] (/Users/rkn/Workspace/ray/src/common/state/redis.cc:977: errno: No such file or directory) Check failure: reply->type != 6\n </denchmark-code>\n \n with the backtrace\n <denchmark-code>0   local_scheduler                     0x000000010872ded4 _Z32redis_task_table_update_callbackP17redisAsyncContextPvS1_ + 548\n 1   local_scheduler                     0x000000010874b3cd redisProcessCallbacks + 813\n 2   local_scheduler                     0x0000000108736003 aeProcessEvents + 659\n 3   local_scheduler                     0x000000010873633b aeMain + 43\n 4   local_scheduler                     0x0000000108710c14 _Z12start_serverPKcS0_S0_iS0_S0_S0_bRKNSt3__113unordered_mapINS1_12basic_stringIcNS1_11char_traitsIcEENS1_9allocatorIcEEEEdNS1_4hashIS8_EENS1_8equal_toIS8_EENS6_INS1_4pairIKS8_dEEEEEES0_i + 1108\n 5   local_scheduler                     0x000000010871114c main + 1292\n 6   libdyld.dylib                       0x00000001087ae235 start + 1\n 7   ???                                 0x0000000000000013 0x0 + 19\n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "mktal", "commentT": "2018-01-25T02:35:25Z", "comment_text": "\n \t\tFrom the local_scheduler.err:\n <denchmark-code>[FATAL] (/home/luban/ray/src/common/state/redis.cc:977: errno: Operation now in progress) Check failure: reply->type != 6\n </denchmark-code>\n \n and from the local_scheduler.out:\n <denchmark-code>local_scheduler(_Z32redis_task_table_update_callbackP17redisAsyncContextPvS1_+0x12c)[0x43e78c]\n local_scheduler(redisProcessCallbacks+0x96)[0x46bda6]\n local_scheduler(aeProcessEvents+0x130)[0x450c80]\n local_scheduler(aeMain+0x2b)[0x45109b]\n local_scheduler(main+0x4e5)[0x415ca5]\n /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7fdaef6cd830]\n local_scheduler(_start+0x29)[0x416659]\n </denchmark-code>\n \n Update: yes, it is running as a script\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "mktal", "commentT": "2018-01-26T06:02:18Z", "comment_text": "\n \t\tThanks! I'm looking into this.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "mktal", "commentT": "2018-01-26T22:31:11Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/mktal>@mktal</denchmark-link>\n  should be fixed now. Thanks for filing the issue!\n \t\t"}}}, "commit": {"commit_id": "3195c6aa63f1b8c7fade85bb4b2e489353355290", "commit_author": "Robert Nishihara", "commitT": "2018-01-26 14:29:53-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 11, "file_old_name": "src\\common\\state\\redis.cc", "file_new_name": "src\\common\\state\\redis.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "228", "deleted_lines": "228", "method_info": {"method_name": "db_connect_shard", "method_params": "db_address,db_port,client,client_type,node_ip_address,args,db,context_out,subscribe_context_out,sync_context_out", "method_startline": "158", "method_endline": "254"}}, "hunk_1": {"Ismethod": 1, "added_lines": "431", "deleted_lines": "431", "method_info": {"method_name": "redis_object_table_remove_callback", "method_params": "c,r,privdata", "method_startline": "419", "method_endline": "441"}}, "hunk_2": {"Ismethod": 1, "added_lines": "385", "deleted_lines": "385", "method_info": {"method_name": "redis_object_table_add_callback", "method_params": "c,r,privdata", "method_startline": "369", "method_endline": "396"}}, "hunk_3": {"Ismethod": 1, "added_lines": "1427", "deleted_lines": "1427", "method_info": {"method_name": "redis_local_scheduler_table_disconnect", "method_params": "db", "method_startline": "1412", "method_endline": "1431"}}, "hunk_4": {"Ismethod": 1, "added_lines": "1635", "deleted_lines": "1635", "method_info": {"method_name": "redis_push_error_hmset_callback", "method_params": "c,r,privdata", "method_startline": "1628", "method_endline": "1648"}}, "hunk_5": {"Ismethod": 1, "added_lines": "805", "deleted_lines": "805", "method_info": {"method_name": "redis_object_table_request_notifications_callback", "method_params": "c,r,privdata", "method_startline": "798", "method_endline": "810"}}, "hunk_6": {"Ismethod": 1, "added_lines": "977", "deleted_lines": "977", "method_info": {"method_name": "redis_task_table_update_callback", "method_params": "c,r,privdata", "method_startline": "957", "method_endline": "990"}}, "hunk_7": {"Ismethod": 1, "added_lines": "329", "deleted_lines": "329", "method_info": {"method_name": "db_disconnect", "method_params": "db", "method_startline": "322", "method_endline": "334"}}, "hunk_8": {"Ismethod": 1, "added_lines": "1197", "deleted_lines": "1197", "method_info": {"method_name": "redis_db_client_table_remove_callback", "method_params": "c,r,privdata", "method_startline": "1191", "method_endline": "1208"}}, "hunk_9": {"Ismethod": 1, "added_lines": "489", "deleted_lines": "489", "method_info": {"method_name": "redis_result_table_add_callback", "method_params": "c,r,privdata", "method_startline": "483", "method_endline": "499"}}, "hunk_10": {"Ismethod": 1, "added_lines": "912", "deleted_lines": "912", "method_info": {"method_name": "redis_task_table_add_task_callback", "method_params": "c,r,privdata", "method_startline": "893", "method_endline": "924"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\local_scheduler\\local_scheduler_algorithm.cc", "file_new_name": "src\\local_scheduler\\local_scheduler_algorithm.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "410,411,412,413,414", "deleted_lines": "410", "method_info": {"method_name": "finish_killed_task", "method_params": "state,execution_spec", "method_startline": "389", "method_endline": "416"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "test\\multi_node_test.py", "file_new_name": "test\\multi_node_test.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195", "deleted_lines": null, "method_info": {"method_name": "testDriverExitingQuickly", "method_params": "self", "method_startline": "158", "method_endline": "195"}}, "hunk_1": {"Ismethod": 1, "added_lines": "13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28", "deleted_lines": null, "method_info": {"method_name": "run_string_as_driver", "method_params": "driver_script", "method_startline": "13", "method_endline": "28"}}, "hunk_2": {"Ismethod": 1, "added_lines": "141", "deleted_lines": "130,131,132,133,134,135,152", "method_info": {"method_name": "testRemoteFunctionIsolation", "method_params": "self", "method_startline": "118", "method_endline": "156"}}, "hunk_3": {"Ismethod": 1, "added_lines": "45", "deleted_lines": null, "method_info": {"method_name": "tearDown", "method_params": "self", "method_startline": "44", "method_endline": "47"}}, "hunk_4": {"Ismethod": 1, "added_lines": "108", "deleted_lines": "89,90,91,92,93,94,95,105,106", "method_info": {"method_name": "testErrorIsolation", "method_params": "self", "method_startline": "49", "method_endline": "116"}}}}}}}