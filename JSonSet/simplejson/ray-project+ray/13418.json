{"BR": {"BR_id": "13418", "BR_author": "edoakes", "BRopenT": "2021-01-13T20:35:51Z", "BRcloseT": "2021-01-13T21:36:02Z", "BR_text": {"BRsummary": "[ray_client] Error in background thread during teardown when using ray.connect", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Running this simple script:\n import ray\n ray.util.connect(\"localhost:61234\")\n @ray.remote\n def f():\n     pass\n ray.get(f.remote())\n print(ray.nodes())\n #import time\n #time.sleep(2)\n If the sleeps are commented out, I get some nasty exception from a gRPC thread:\n <denchmark-code>Exception in thread Thread-1:\n Traceback (most recent call last):\n   File \"/Users/eoakes/anaconda3/lib/python3.8/threading.py\", line 932, in _bootstrap_inner\n     self.run()\n   File \"/Users/eoakes/anaconda3/lib/python3.8/threading.py\", line 870, in run\n     self._target(*self._args, **self._kwargs)\n   File \"src/python/grpcio/grpc/_cython/_cygrpc/thread.pyx.pxi\", line 53, in grpc._cython.cygrpc._run_with_context._run\n   File \"/Users/eoakes/anaconda3/lib/python3.8/site-packages/grpc/_channel.py\", line 1379, in _poll_connectivity\n     connectivity = channel.check_connectivity_state(try_to_connect)\n   File \"src/python/grpcio/grpc/_cython/_cygrpc/channel.pyx.pxi\", line 503, in grpc._cython.cygrpc.Channel.check_connectivity_state\n </denchmark-code>\n \n Reverting <denchmark-link:https://github.com/ray-project/ray/commit/0b22341bc9a693ef94da06fd274f8a7454d9f94b>0b22341</denchmark-link>\n  fixes the issue.\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "edoakes", "commentT": "2021-01-13T21:14:46Z", "comment_text": "\n \t\tDoesn't affect Linux, repros on macOS\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "edoakes", "commentT": "2021-01-13T21:23:58Z", "comment_text": "\n \t\tcan also get a (different but related) crash with Linux\n \t\t"}}}, "commit": {"commit_id": "8f48c64507319585c249e48f0c4ddb7d614986ee", "commit_author": "Barak Michener", "commitT": "2021-01-13 13:36:01-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\util\\client\\worker.py", "file_new_name": "python\\ray\\util\\client\\worker.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "68", "deleted_lines": null}}}}}}