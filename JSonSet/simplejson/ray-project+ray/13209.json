{"BR": {"BR_id": "13209", "BR_author": "PidgeyBE", "BRopenT": "2021-01-05T18:35:25Z", "BRcloseT": "2021-01-07T01:21:18Z", "BR_text": {"BRsummary": "[core] AttributeError: module 'abc' has no attribute '_get_dump'", "BRdescription": "\n ray 1.1.0\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n In ray 1.1.0 the following critical lines where removed from the codebase in <denchmark-link:https://github.com/ray-project/ray/commit/871cde989a45341129aa9bcd7b59115020ef13d2>871cde9</denchmark-link>\n :\n <denchmark-code>            if hasattr(abc, '_get_dump'):\n                 (registry, _, _, _) = abc._get_dump(obj)\n                 clsdict[\"_abc_impl\"] = [subclass_weakref()\n                                         for subclass_weakref in registry]\n             else:\n                 # FIXME(suquark): The upstream cloudpickle cannot work in Ray\n                 # because sometimes both '_abc_registry' and '_get_dump' does\n                 # not exist. Some strange typing objects may cause this issue.\n                 # Here the workaround just set \"_abc_impl\" to None.\n                 clsdict[\"_abc_impl\"] = None\n </denchmark-code>\n \n As a result, our software CICD fails after upgrading to ray 1.1.0 with:\n AttributeError: module 'abc' has no attribute '_get_dump'\n If I just open ipython and import abc, I get the same error on abc._get_dump. We are using python 3.6.\n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n The issue is hard to reproduce in a standalone script. But anyhow\n <denchmark-code>import abc\n abc._get_dump\n </denchmark-code>\n \n result in the same error (in Python 3.6), so I assume the workaround should have stayed?\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "PidgeyBE", "commentT": "2021-01-05T18:39:20Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/suquark>@suquark</denchmark-link>\n  would you mind taking a look a this?\n also <denchmark-link:https://github.com/PidgeyBE>@PidgeyBE</denchmark-link>\n  can you list the  package version if there is one? .\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "PidgeyBE", "commentT": "2021-01-05T18:41:35Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/simon-mo>@simon-mo</denchmark-link>\n \n <denchmark-code># pip freeze | grep typing\n typing-extensions==3.7.4.1\n </denchmark-code>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "PidgeyBE", "commentT": "2021-01-06T08:44:24Z", "comment_text": "\n \t\tAdditionally we see here that some _abc_ cache keys are popped before pickling serialization: \n \n \n ray/python/ray/cloudpickle/cloudpickle_fast.py\n \n \n          Line 187\n       in\n       871cde9\n \n \n \n \n \n \n  clsdict.pop('_abc_negative_cache', None) \n \n \n \n \n \n but not all of them. Is there a reason e.g. _abc_generic_negative_cache and _abc_generic_negative_cache_version are not popped?\n Because these keys/values are causing pickle issues in our use cases...\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "PidgeyBE", "commentT": "2021-01-06T20:15:50Z", "comment_text": "\n \t\t and  are likely generated by third-party libraries, and they do not exist in the python stdlib: <denchmark-link:https://github.com/python/cpython/blob/master/Lib/_py_abc.py>https://github.com/python/cpython/blob/master/Lib/_py_abc.py</denchmark-link>\n .\n we can hardcode these fields in cloudpickle as the workaround. Such issues would not be fully solved before python3.7 (where some patches are appiled), because python typing object has poor serialization support and failed a wide range of softwares: <denchmark-link:https://github.com/python/typing/issues/511>python/typing#511</denchmark-link>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "PidgeyBE", "commentT": "2021-01-07T01:38:18Z", "comment_text": "\n \t\tThe PR was merged. <denchmark-link:https://github.com/PidgeyBE>@PidgeyBE</denchmark-link>\n  please try out latest master!\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "PidgeyBE", "commentT": "2021-01-07T12:12:31Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/simon-mo>@simon-mo</denchmark-link>\n  I've tested it on master and it works!\n \t\t"}}}, "commit": {"commit_id": "dde49b8d48b0203d8230858b8c252b223628c160", "commit_author": "Siyuan (Ryans) Zhuang", "commitT": "2021-01-06 17:21:17-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\cloudpickle\\cloudpickle_fast.py", "file_new_name": "python\\ray\\cloudpickle\\cloudpickle_fast.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "189,190,191,192,195,196,197,198,199,200,201,202,203,204,205,206,207,208", "deleted_lines": "191,192,193,194,195,196,197", "method_info": {"method_name": "_class_getstate", "method_params": "obj", "method_startline": "178", "method_endline": "226"}}}}}}}