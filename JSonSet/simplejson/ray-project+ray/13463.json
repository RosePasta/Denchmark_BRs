{"BR": {"BR_id": "13463", "BR_author": "edoakes", "BRopenT": "2021-01-14T17:37:45Z", "BRcloseT": "2021-01-15T23:49:39Z", "BR_text": {"BRsummary": "[ray_client] Unable to return actor handle from remote call", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n import ray\n ray.util.connect(\"localhost:61234\")\n \n @ray.remote\n class B:\n     pass\n \n @ray.remote\n class A:\n     def __init__(self):\n         self.b = B.remote()\n \n     def get_actor_ref(self):\n         return [self.b]\n \n a = A.remote()\n ray.get(a.get_actor_ref.remote())\n <denchmark-code>Got Error from data channel -- shutting down: <_MultiThreadedRendezvous of RPC that terminated with:           \n         status = StatusCode.UNKNOWN                                                                            \n         details = \"Exception iterating responses: 'ServerPickler' object has no attribute 'actor_refs'\"        \n         debug_error_string = \"{\"created\":\"@1610645797.119742000\",\"description\":\"Error received from peer ipv6:[\n ::1]:61234\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1062,\"grpc_message\":\"Exception iterating response\n s: 'ServerPickler' object has no attribute 'actor_refs'\",\"grpc_status\":2}\"                                     \n >                                                                                                              \n Exception in thread Thread-5:                                                                                  \n Traceback (most recent call last):                                                                             \n   File \"/Users/eoakes/anaconda3/lib/python3.8/threading.py\", line 932, in _bootstrap_inner                     \n     self.run()                                                                                                 \n   File \"/Users/eoakes/anaconda3/lib/python3.8/threading.py\", line 870, in run                                  \n     self._target(*self._args, **self._kwargs)                                                                  \n   File \"/Users/eoakes/code/ray/python/ray/util/client/dataclient.py\", line 76, in _data_main                   \n     raise e                                                                                                    \n   File \"/Users/eoakes/code/ray/python/ray/util/client/dataclient.py\", line 61, in _data_main                   \n     for response in resp_stream:                                                                               \n   File \"/Users/eoakes/anaconda3/lib/python3.8/site-packages/grpc/_channel.py\", line 416, in __next__           \n     return self._next()                                                                                        \n   File \"/Users/eoakes/anaconda3/lib/python3.8/site-packages/grpc/_channel.py\", line 803, in _next              \n     raise self                                                                                                 \n grpc._channel._MultiThreadedRendezvous: <_MultiThreadedRendezvous of RPC that terminated with:                 \n         status = StatusCode.UNKNOWN                                                                            \n         details = \"Exception iterating responses: 'ServerPickler' object has no attribute 'actor_refs'\"\n         debug_error_string = \"{\"created\":\"@1610645797.119742000\",\"description\":\"Error received from peer ipv6:[::1]:61234\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1062,\"grpc_message\":\"Exception iterating responses: 'ServerPickler' object has no attribute 'actor_refs'\",\"grpc_status\":2}\"\n >\n ^CTraceback (most recent call last):\n   File \"test.py\", line 17, in <module>\n     ray.get(a.get_actor_ref.remote())\n   File \"/Users/eoakes/code/ray/python/ray/_private/client_mode_hook.py\", line 46, in wrapper\n     return getattr(ray, func.__name__)(*args, **kwargs) \n   File \"/Users/eoakes/code/ray/python/ray/util/client/api.py\", line 32, in get\n     return self.worker.get(vals, timeout=timeout)\n   File \"/Users/eoakes/code/ray/python/ray/util/client/worker.py\", line 107, in get\n     out = [self._get(x, timeout) for x in to_get]\n   File \"/Users/eoakes/code/ray/python/ray/util/client/worker.py\", line 107, in <listcomp>\n     out = [self._get(x, timeout) for x in to_get]\n   File \"/Users/eoakes/code/ray/python/ray/util/client/worker.py\", line 115, in _get\n     data = self.data_client.GetObject(req)\n   File \"/Users/eoakes/code/ray/python/ray/util/client/dataclient.py\", line 106, in GetObject\n     resp = self._blocking_send(datareq)\n   File \"/Users/eoakes/code/ray/python/ray/util/client/dataclient.py\", line 91, in _blocking_send\n     self.cv.wait_for(lambda: req_id in self.ready_data) \n   File \"/Users/eoakes/anaconda3/lib/python3.8/threading.py\", line 337, in wait_for\n     self.wait(waittime)\n   File \"/Users/eoakes/anaconda3/lib/python3.8/threading.py\", line 302, in wait\n     waiter.acquire()\n KeyboardInterrupt\n </denchmark-code>\n \n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Please provide a short code snippet (less than 50 lines if possible) that can be copy-pasted to reproduce the issue. The snippet should have no external library dependencies (i.e., use fake or mock data / environments):\n If the code snippet cannot be run by itself, the issue will be closed with \"needs-repro-script\".\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {}}, "commit": {"commit_id": "68e3a0e0e1c5a47eea48085764112e2262df7ea3", "commit_author": "Barak Michener", "commitT": "2021-01-15 15:49:38-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "python\\ray\\tests\\test_actor.py", "file_new_name": "python\\ray\\tests\\test_actor.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "871,872", "deleted_lines": null, "method_info": {"method_name": "test_wrapped_actor_handle.__init__", "method_params": "self", "method_startline": "871", "method_endline": "872"}}, "hunk_1": {"Ismethod": 1, "added_lines": "866,867", "deleted_lines": null, "method_info": {"method_name": "test_wrapped_actor_handle.doit", "method_params": "self", "method_startline": "866", "method_endline": "867"}}, "hunk_2": {"Ismethod": 1, "added_lines": "863,864,865,866,867,868,869,870,871,872,873,874,875,876,877,878,879", "deleted_lines": null, "method_info": {"method_name": "test_wrapped_actor_handle", "method_params": "ray_start_regular_shared", "method_startline": "863", "method_endline": "879"}}, "hunk_3": {"Ismethod": 1, "added_lines": "874,875", "deleted_lines": null, "method_info": {"method_name": "test_wrapped_actor_handle.get_actor_ref", "method_params": "self", "method_startline": "874", "method_endline": "875"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\util\\client\\server\\server_pickler.py", "file_new_name": "python\\ray\\util\\client\\server\\server_pickler.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "64,65,66", "deleted_lines": "64,65,66", "method_info": {"method_name": "persistent_id", "method_params": "self,obj", "method_startline": "46", "method_endline": "74"}}}}}}}