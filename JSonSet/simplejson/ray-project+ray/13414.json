{"BR": {"BR_id": "13414", "BR_author": "edoakes", "BRopenT": "2021-01-13T20:12:31Z", "BRcloseT": "2021-01-14T22:37:01Z", "BR_text": {"BRsummary": "[ray_client] ray.get_runtime_context doesn't work with Ray Client", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n ray.get_runtime_context is used in Ray Serve to identify the NodeId of the head node to place specific actors there. I'd expect that this returns the runtime_context of the job that is running on the ray client server. Right now, it just errors.\n import ray\n ray.util.connect(\"localhost:61234\")\n \n print(ray.get_runtime_context().node_id.hex())\n <denchmark-code>Traceback (most recent call last):\n   File \"test.py\", line 4, in <module>\n     print(ray.get_runtime_context().node_id.hex())\n   File \"/Users/eoakes/code/ray/python/ray/runtime_context.py\", line 58, in node_id\n     node_id = self.worker.current_node_id\n   File \"/Users/eoakes/code/ray/python/ray/worker.py\", line 148, in current_node_id\n     return self.core_worker.get_current_node_id()\n AttributeError: 'Worker' object has no attribute 'core_worker'\n </denchmark-code>\n \n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Please provide a short code snippet (less than 50 lines if possible) that can be copy-pasted to reproduce the issue. The snippet should have no external library dependencies (i.e., use fake or mock data / environments):\n If the code snippet cannot be run by itself, the issue will be closed with \"needs-repro-script\".\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {}}, "commit": {"commit_id": "84e110a949e83c4956cca14ed59fd5a92e34f3fe", "commit_author": "Barak Michener", "commitT": "2021-01-14 14:37:00-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\tests\\test_client_metadata.py", "file_new_name": "python\\ray\\tests\\test_client_metadata.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "10", "deleted_lines": null, "method_info": {"method_name": "test_get_ray_metadata", "method_params": "ray_start_regular_shared", "method_startline": "9", "method_endline": "28"}}, "hunk_1": {"Ismethod": 1, "added_lines": "31,32,33,34,35,36,37,38,39,40", "deleted_lines": null, "method_info": {"method_name": "test_get_runtime_context", "method_params": "ray_start_regular_shared", "method_startline": "31", "method_endline": "40"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\util\\client\\api.py", "file_new_name": "python\\ray\\util\\client\\api.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "236,237,238,239,240,241,242", "deleted_lines": null, "method_info": {"method_name": "get_runtime_context", "method_params": "self", "method_startline": "236", "method_endline": "242"}}}}, "file_2": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "python\\ray\\util\\client\\runtime_context.py"}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\util\\client\\server\\server.py", "file_new_name": "python\\ray\\util\\client\\server\\server.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "86,87,88,89,90,91,92,93,94", "deleted_lines": null}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\util\\client\\worker.py", "file_new_name": "python\\ray\\util\\client\\worker.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "281,282", "deleted_lines": null, "method_info": {"method_name": "get_cluster_info", "method_params": "self,TypeEnum", "method_startline": "273", "method_endline": "283"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\ray\\protobuf\\ray_client.proto", "file_new_name": "src\\ray\\protobuf\\ray_client.proto", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "141,153,154,155,156,157,158,159,164", "deleted_lines": null}}}}}}