{"BR": {"BR_id": "13377", "BR_author": "simon-mo", "BRopenT": "2021-01-12T21:53:04Z", "BRcloseT": "2021-01-20T19:09:45Z", "BR_text": {"BRsummary": "[Metrics] Metric.record without default tag set doesn't error.", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n The following doesn't throw any error but it should, because metrics without the tag value cannot be recorded:\n <denchmark-code>\n In [5]: error_counter = metrics.Count( \n    ...:             \"fake_serve_backend_error_counter\", \n    ...:             description=(\"The number of exceptions that have \" \n    ...:                          \"occurred in the backend.\"), \n    ...:             tag_keys=(\"backend\", ))                             \n \n In [6]: error_counter.record(9003)    \n \n </denchmark-code>\n \n Please feel free to change the priority value\n Ray version and other system information (Python version, TensorFlow version, OS):\n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Please provide a short code snippet (less than 50 lines if possible) that can be copy-pasted to reproduce the issue. The snippet should have no external library dependencies (i.e., use fake or mock data / environments):\n If the code snippet cannot be run by itself, the issue will be closed with \"needs-repro-script\".\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {}}, "commit": {"commit_id": "b796de41049aa3b3696a6b7242799284c3f0c641", "commit_author": "Edward Oakes", "commitT": "2021-01-20 13:09:44-06:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\tests\\test_metrics.py", "file_new_name": "python\\ray\\tests\\test_metrics.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "145", "deleted_lines": "144"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "python\\ray\\tests\\test_metrics_agent.py", "file_new_name": "python\\ray\\tests\\test_metrics_agent.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,317,322,325,328", "deleted_lines": "304", "method_info": {"method_name": "test_custom_metrics_validation", "method_params": "ray_start_regular_shared", "method_startline": "295", "method_endline": "330"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "246,247,248,249", "method_info": {"method_name": "test_custom_metrics_default_tags", "method_params": "metric_mock", "method_startline": "238", "method_endline": "257"}}, "hunk_2": {"Ismethod": 1, "added_lines": "202,203", "deleted_lines": "202,203,215,216,217", "method_info": {"method_name": "test_basic_custom_metrics", "method_params": "metric_mock", "method_startline": "197", "method_endline": "217"}}, "hunk_3": {"Ismethod": 1, "added_lines": "304,305,306,307,308,309,310,311,312,313,314", "deleted_lines": "304", "method_info": {"method_name": "test_custom_metrics_tag_validation", "method_params": "ray_start_regular_shared", "method_startline": "304", "method_endline": "316"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\util\\metrics.py", "file_new_name": "python\\ray\\util\\metrics.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "78,79,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105", "deleted_lines": "88,89,90", "method_info": {"method_name": "record", "method_params": "self,float,dict", "method_startline": "75", "method_endline": "105"}}}}}}}