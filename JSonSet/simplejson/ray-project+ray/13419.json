{"BR": {"BR_id": "13419", "BR_author": "edoakes", "BRopenT": "2021-01-13T20:53:19Z", "BRcloseT": "2021-01-19T19:26:52Z", "BR_text": {"BRsummary": "[metrics] Bad error message for non-string tags", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n import ray\n from ray.util.metrics import Count\n \n ray.init()\n \n count = Count(\"abc\", tag_keys=(\"a\", \"b\"))\n count.set_default_tags({\"a\": 1})\n count.record(1.0, {\"b\": 2})\n <denchmark-code>Traceback (most recent call last):                                                                             \n   File \"test.py\", line 8, in <module>                                                                          \n     count.record(1.0, {\"b\": 2})\n   File \"/Users/eoakes/code/ray/python/ray/util/metrics.py\", line 84, in record\n     self._metric.record(value, tags=final_tags)\n   File \"python/ray/includes/metric.pxi\", line 54, in ray._raylet.Metric.record\n     c_tags[tag_k.encode(\"ascii\")] = tag_v.encode(\"ascii\")\n AttributeError: 'int' object has no attribute 'encode'\n </denchmark-code>\n \n Two issues:\n \n The error message is bad.\n The set_default_tags call should have failed.\n \n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {}}, "commit": {"commit_id": "9b071eb449b8efd3faa9e4eae61a9ab0f35ef075", "commit_author": "Edward Oakes", "commitT": "2021-01-19 13:26:51-06:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\tests\\test_metrics_agent.py", "file_new_name": "python\\ray\\tests\\test_metrics_agent.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "273", "deleted_lines": "273", "method_info": {"method_name": "test_custom_metrics_edge_cases", "method_params": "metric_mock", "method_startline": "260", "method_endline": "274"}}, "hunk_1": {"Ismethod": 1, "added_lines": "304,305,306,307,308,309,310,311,312,313,314,315,316", "deleted_lines": null, "method_info": {"method_name": "test_custom_metrics_tag_validation", "method_params": "ray_start_regular_shared", "method_startline": "304", "method_endline": "316"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\util\\metrics.py", "file_new_name": "python\\ray\\util\\metrics.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "82,83,84,85,86,87", "deleted_lines": null, "method_info": {"method_name": "record", "method_params": "self,float,dict", "method_startline": "75", "method_endline": "90"}}, "hunk_1": {"Ismethod": 1, "added_lines": "66,67,68,69,70,71", "deleted_lines": null, "method_info": {"method_name": "set_default_tags", "method_params": "self,str", "method_startline": "48", "method_endline": "73"}}}}}}}