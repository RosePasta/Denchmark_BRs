{"BR": {"BR_id": "4228", "BR_author": "zvadaszi", "BRopenT": "2020-12-03T16:51:35Z", "BRcloseT": "2020-12-23T03:20:58Z", "BR_text": {"BRsummary": "Empirical attention with ResNext backbone", "BRdescription": "\n In mmdetectiom v1 I used ResNext backbone with empirical attention 0010_dcn but in v2 I got an error.\n Any ideas how to fix this?\n My updated config file:\n <denchmark-code>_base_ = '../faster_rcnn/faster_rcnn_r50_fpn_1x_coco.py'\n model = dict(\n \n     pretrained='open-mmlab://resnext50_32x4d',\n     backbone=dict(\n         type='ResNeXt',\n         depth=50,\n         groups=32,\n         base_width=4,\n         num_stages=4,\n         out_indices=(0, 1, 2, 3),\n         frozen_stages=1,\n         norm_cfg=dict(type='BN', requires_grad=True),\n         style='pytorch',\n         plugins=[\n             dict(\n                 cfg=dict(\n                     type='GeneralizedAttention',\n                     spatial_range=-1,\n                     num_heads=8,\n                     attention_type='0010',\n                     kv_stride=2),\n                 stages=(False, False, True, True),\n                 position='after_conv2')\n         ],\n         dcn=dict(type='DCN', deform_groups=1, fallback_on_stride=False),\n         stage_with_dcn=(False, True, True, True)))\n </denchmark-code>\n \n Error:\n <denchmark-code>RuntimeError: Given groups=1, weight of size [256, 256, 1, 1], expected input[2, 512, 41, 73] to have 256 channels, but got 512 channels instead\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "zvadaszi", "commentT": "2020-12-05T06:57:49Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/zvadaszi>@zvadaszi</denchmark-link>\n  ,\n Thanks for your bug report. This is because the code forgets to declare the plugin again in the Bottleneck module of ResNext.\n Add the following code after line 85 in <denchmark-link:>resnext.py</denchmark-link>\n  should works.\n         if self.with_plugins:\n             self.after_conv1_plugin_names = self.make_block_plugins(\n                 width, self.after_conv1_plugins)\n             self.after_conv2_plugin_names = self.make_block_plugins(\n                 width, self.after_conv2_plugins)\n Would you like to create a PR to fix that?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "zvadaszi", "commentT": "2020-12-07T17:43:42Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/ZwwWayne>@ZwwWayne</denchmark-link>\n  ,\n Thanks for you reply. If I follow your suggestion an  would be raised, because the inherited class's constructor already builds this.\n As a quick dirty fix, I tried to comment this code block in resnet.Bottleneck and add it to resnext.Bottleneck, to the place you suggested, but breaks with\n \n \t\t"}}}, "commit": {"commit_id": "b951522ef85baa652d867c7df799ebbcf50bc436", "commit_author": "Haian Huang(\u6df1\u5ea6\u7738)", "commitT": "2020-12-23 11:20:57+08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "mmdet\\models\\backbones\\resnext.py", "file_new_name": "mmdet\\models\\backbones\\resnext.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "97,98,99,100,101,102,103,104,105", "deleted_lines": null, "method_info": {"method_name": "_del_block_plugins", "method_params": "self,plugin_names", "method_startline": "97", "method_endline": "105"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\test_models\\test_backbones.py", "file_new_name": "tests\\test_models\\test_backbones.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "861,862,863,864,865,866,867,868,869,870,871,872,873,874,875,876", "deleted_lines": null, "method_info": {"method_name": "test_renext_bottleneck", "method_params": "", "method_startline": "830", "method_endline": "876"}}}}}}}