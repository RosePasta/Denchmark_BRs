{"BR": {"BR_id": "3620", "BR_author": "AlexisPister", "BRopenT": "2019-04-19T15:01:17Z", "BRcloseT": "2019-05-11T17:15:33Z", "BR_text": {"BRsummary": "Convert command line on .iob Conll-2003 file not working", "BRdescription": "\n <denchmark-h:h2>How to reproduce the behaviour</denchmark-h>\n \n Hello, I would like to convert the conll-2003 dataset from iob to json. I removed the 2 middle columns with python and my files look like this now :\n <denchmark-code>-DOCSTART- O\n  \n CRICKET O\n - O\n LEICESTERSHIRE B-ORG\n TAKE O\n OVER O\n AT O\n TOP O\n AFTER O\n INNINGS O\n VICTORY O\n . O\n </denchmark-code>\n \n I tried to convert them to the json format with the command line convert but I get the following message each time :\n \u2714 Generated output file (0 documents)\n json_output/valid.msg\n An empty file is generated. Here is the command I used :\n python -m spacy convert valid.iob json_output/ -t msg -c iob\n I tried the three output format possible but it always give the same thing\n <denchmark-h:h2>Your Environment</denchmark-h>\n \n \n Operating System: Elementary OS 5.xx\n Python Version Used: 3.7.1\n spaCy Version Used: 2.1.1\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "AlexisPister", "commentT": "2019-04-22T13:19:30Z", "comment_text": "\n \t\tThanks, it looks like there's a bug in the <denchmark-link:https://github.com/explosion/spaCy/tree/master/spacy/cli/converters/iob2json.py>spacy/cli/converters/iob2json.py</denchmark-link>\n  file. The code really doesn't look right there --- possibly an append has ended up in the wrong block?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "AlexisPister", "commentT": "2019-04-24T08:57:11Z", "comment_text": "\n \t\tI would be glad to help, but I really don't understand how the script should be working. The read_iob function is not called anywhere and I don't get what the loop in the iob2json function is doing.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "AlexisPister", "commentT": "2019-05-06T16:38:05Z", "comment_text": "\n \t\tThis has halted my exploration of spacy.io for Gate replacement.  I'm not enough of a pythonista to go through the framework and locate how and why, though I can confirm it simply writes out empty files even with something as simple as:\n Borg|B-ORG\n Inc|I-ORG\n is|O\n back|O\n !|O\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "AlexisPister", "commentT": "2019-05-06T21:21:01Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/AlexisPister>@AlexisPister</denchmark-link>\n  Damn, it looks like that's the problem, yes  I just briefly checked the history of that file and it seems like the converter possibly got messed up in a merge. So it's currently iterating over an empty list, which obviously produces another empty list.\n Here's the previous state of the file: <denchmark-link:https://github.com/explosion/spaCy/blob/9a5003d5c8b03c9ae53f32d7b3fc987726cd5617/spacy/cli/converters/iob2json.py>https://github.com/explosion/spaCy/blob/9a5003d5c8b03c9ae53f32d7b3fc987726cd5617/spacy/cli/converters/iob2json.py</denchmark-link>\n \n The main thing that has changed in v2.1 is that the converters aren't opening and writing the files anymore (which created a lot of code duplication). Instead, they receive the opened file as the first argument  and no output path (<denchmark-link:https://github.com/explosion/spaCy/blob/master/spacy/cli/convert.py#L80>see here</denchmark-link>\n ) and return the contents to write to the JSON file. So in theory, using the old converter and simplifying the main function to something like this should work:\n sentences = read_iob(input_data)\n docs = merge_sentences(sentences, n_sents)\n return docs\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "AlexisPister", "commentT": "2019-06-10T18:26:17Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "0bf6441863433575aebcbd0b238d27d95830c015", "commit_author": "Ines Montani", "commitT": "2019-05-11 19:15:26+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "spacy\\cli\\converters\\iob2json.py", "file_new_name": "spacy\\cli\\converters\\iob2json.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "47,48,49,50,51,52,53,54,55,56", "deleted_lines": null, "method_info": {"method_name": "merge_sentences", "method_params": "docs,n_sents", "method_startline": "47", "method_endline": "56"}}, "hunk_1": {"Ismethod": 1, "added_lines": "45,46,47,48,49,50,51", "deleted_lines": "30", "method_info": {"method_name": "read_iob", "method_params": "raw_sents", "method_startline": "25", "method_endline": "51"}}, "hunk_2": {"Ismethod": 1, "added_lines": "14,15", "deleted_lines": "14,15,16", "method_info": {"method_name": "iob2json", "method_params": "input_data,n_sents,args,kwargs", "method_startline": "10", "method_endline": "16"}}}}}}}