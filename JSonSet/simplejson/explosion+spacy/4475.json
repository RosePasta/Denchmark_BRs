{"BR": {"BR_id": "4475", "BR_author": "jack-rory-staunton", "BRopenT": "2019-10-18T20:46:24Z", "BRcloseT": "2019-10-23T12:41:22Z", "BR_text": {"BRsummary": "Bug in example", "BRdescription": "\n There is a slight error in the logic that causes incorrect deletion of entities which should be kept.\n <denchmark-h:h2>Which page or section is this issue related to?</denchmark-h>\n \n <denchmark-link:https://spacy.io/usage/rule-based-matching>https://spacy.io/usage/rule-based-matching</denchmark-link>\n \n in the section Models and Rules,\n in the example code snippet below,\n <denchmark-code>from spacy.tokens import Span\n \n \n def expand_person_entities(doc):\n     new_ents = []\n     for ent in doc.ents:\n         # Only check for title if it's a person and not the first token\n         if ent.label_ == \"PERSON\" and ent.start != 0:\n             prev_token = doc[ent.start - 1]\n             if prev_token.text in (\"Dr\", \"Dr.\", \"Mr\", \"Mr.\", \"Ms\", \"Ms.\"):\n                 new_ent = Span(doc, ent.start - 1, ent.end, label=ent.label)\n                 new_ents.append(new_ent)\n         else:\n             new_ents.append(ent)\n     doc.ents = new_ents\n     return doc\n </denchmark-code>\n \n One quick way to fix this would be:\n <denchmark-code>from spacy.tokens import Span\n \n def expand_person_entities(doc):\n     new_ents = []\n     for ent in doc.ents:\n         # Only check for title if it's a person and not the first token\n         if ent.label_ == \"PERSON\" and ent.start != 0:\n             prev_token = doc[ent.start - 1]\n             if prev_token.text in (\"Dr\", \"Dr.\", \"Mr\", \"Mr.\", \"Ms\", \"Ms.\"):\n                 new_ent = Span(doc, ent.start - 1, ent.end, label=ent.label)\n                 new_ents.append(new_ent)\n            else:\n               new_ents.append(ent)\n         else:\n             new_ents.append(ent)\n     doc.ents = new_ents\n     return doc\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jack-rory-staunton", "commentT": "2019-10-19T08:50:10Z", "comment_text": "\n \t\tThat does look like a bug. Would you like to submit a PR to fix it?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jack-rory-staunton", "commentT": "2019-11-22T12:55:09Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "7fc39f124c2bf9b62c63caccd005e9ae7add078b", "commit_author": "adrianeboyd", "commitT": "2019-10-23 14:41:21+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "website\\docs\\usage\\rule-based-matching.md", "file_new_name": "website\\docs\\usage\\rule-based-matching.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1138,1139", "deleted_lines": null}}}}}}