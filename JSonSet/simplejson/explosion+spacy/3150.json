{"BR": {"BR_id": "3150", "BR_author": "xrmx", "BRopenT": "2019-01-12T16:38:31Z", "BRcloseT": "2019-01-16T12:46:34Z", "BR_text": {"BRsummary": "Doc.print_tree(flat=True) broken in spacy 2.0.18", "BRdescription": "\n <denchmark-h:h2>How to reproduce the behaviour</denchmark-h>\n \n <denchmark-code>$ python\n Python 3.7.2 (default, Jan  3 2019, 02:55:40) \n [GCC 8.2.0] on linux\n Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n >>> import spacy\n >>> nlp = spacy.load('en_core_web_sm')\n >>> doc = nlp('Alice ate the pizza')\n >>> doc.print_tree(flat=True)\n Traceback (most recent call last):\n   File \"<stdin>\", line 1, in <module>\n   File \"doc.pyx\", line 983, in spacy.tokens.doc.Doc.print_tree\n   File \"/venv/lib/python3.7/site-packages/spacy/tokens/printers.py\", line 74, in parse_tree\n     for sent in doc_clone.sents]\n   File \"/venv/lib/python3.7/site-packages/spacy/tokens/printers.py\", line 74, in <listcomp>\n     for sent in doc_clone.sents]\n   File \"/venv/lib/python3.7/site-packages/spacy/tokens/printers.py\", line 41, in POS_tree\n     subtree[\"modifiers\"].append(POS_tree(c))\n KeyError: 'modifiers'\n </denchmark-code>\n \n doc.print_tree() is the following:\n <denchmark-code>[{'NE': '',\n   'POS_coarse': 'VERB',\n   'POS_fine': 'VBD',\n   'arc': 'ROOT',\n   'lemma': 'eat',\n   'modifiers': [{'NE': '',\n                  'POS_coarse': 'PROPN',\n                  'POS_fine': 'NNP',\n                  'arc': 'nsubj',\n                  'lemma': 'alice',\n                  'modifiers': [],\n                  'word': 'Alice'},\n                 {'NE': '',\n                  'POS_coarse': 'NOUN',\n                  'POS_fine': 'NN',\n                  'arc': 'dobj',\n                  'lemma': 'pizza',\n                  'modifiers': [{'NE': '',\n                                 'POS_coarse': 'DET',\n                                 'POS_fine': 'DT',\n                                 'arc': 'det',\n                                 'lemma': 'the',\n                                 'modifiers': [],\n                                 'word': 'the'}],\n                  'word': 'pizza'}],\n   'word': 'ate'}]\n </denchmark-code>\n \n <denchmark-h:h2>Your Environment</denchmark-h>\n \n \n spaCy version: 2.0.18\n Platform: Linux-4.19.0-1-amd64-x86_64-with-debian-buster-sid\n Python version: 3.7.2\n Models: en_core_web_sm\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "xrmx", "commentT": "2019-01-12T19:28:03Z", "comment_text": "\n \t\tWhen the argument flat = True, the key \"modifiers\" of the dict containing the tree is deleted. I guess putting an if statement in the function POS_tree could fixed the issue.\n def POS_tree(root, light=False, flat=False):\n     \"\"\"Helper: generate a POS tree for a root token. The doc must have\n     `merge_ents(doc)` ran on it.\n     \"\"\"\n     subtree = format_POS(root, light=light, flat=flat)\n     if not flat:\n         for c in root.children:\n             subtree[\"modifiers\"].append(POS_tree(c))\n     return subtree\n If  the solution is approved, I can submit a small PR.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "xrmx", "commentT": "2019-01-13T23:42:42Z", "comment_text": "\n \t\tYes, a PR would be nice!\n One thing to note re : At the moment, we've deprecated  for , because  will introduce a new  method that's also used for training and will output data that exactly matches spaCy's new training format (see <denchmark-link:https://github.com/explosion/spaCy/issues/2928>#2928</denchmark-link>\n ).\n However, Doc.to_json won't actually cover everything that Doc.print_tree covered, so maybe we do want to bring that one back. I'm not 100% sure if people actually use it much, or whether it makes more sense for users to build their own logic that's more specific to their application.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "xrmx", "commentT": "2019-02-15T13:22:43Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "214c2ec2631a5d9d7ae15885c0b7644cbb95b474", "commit_author": "mauryaland", "commitT": "2019-01-14 23:47:05+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "spacy\\tokens\\printers.py", "file_new_name": "spacy\\tokens\\printers.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "40,41,42", "deleted_lines": "40,41", "method_info": {"method_name": "POS_tree", "method_params": "root,light,flat", "method_startline": "35", "method_endline": "43"}}}}}}}