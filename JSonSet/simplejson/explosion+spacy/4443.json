{"BR": {"BR_id": "4443", "BR_author": "danielkingai2", "BRopenT": "2019-10-14T23:29:46Z", "BRcloseT": "2019-10-16T21:18:55Z", "BR_text": {"BRsummary": "Prune vectors error", "BRdescription": "\n <denchmark-h:h2>How to reproduce the behaviour</denchmark-h>\n \n Same issue as <denchmark-link:https://github.com/explosion/spaCy/issues/4386>#4386</denchmark-link>\n , <denchmark-link:https://github.com/explosion/spaCy/pull/4388>#4388</denchmark-link>\n  doesn't quite fix it, as the first element of the tuple here: \n  still has the shape of the full array instead of the batch. Pretty sure it just needs to be turned into this:\n sorted_index = xp.arange(scores.shape[0])[:,None][i:i+batch_size],xp.argsort(scores[i:i+batch_size], axis=1)[:,::-1]\n Will open a PR in case you agree. I would also suggest not sorting if n=1 since its not necessary so I'll also add that in the PR.\n <denchmark-h:h2>Your Environment</denchmark-h>\n \n <denchmark-h:h2>Info about spaCy</denchmark-h>\n \n \n spaCy version: 2.2.1 (master)\n Platform: Linux-4.4.0-112-generic-x86_64-with-debian-stretch-sid\n Python version: 3.6.7\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "danielkingai2", "commentT": "2019-11-15T21:54:36Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "e6469561763a732cf51e6757ecf571d5847f1c06", "commit_author": "Daniel King", "commitT": "2019-10-16 23:18:55+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "spacy\\tests\\vocab_vectors\\test_vectors.py", "file_new_name": "spacy\\tests\\vocab_vectors\\test_vectors.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "300", "deleted_lines": "287", "method_info": {"method_name": "test_vocab_prune_vectors", "method_params": "", "method_startline": "287", "method_endline": "304"}}, "hunk_1": {"Ismethod": 1, "added_lines": "137,138,139,140", "deleted_lines": null, "method_info": {"method_name": "test_vectors_most_similar", "method_params": "most_similar_vectors_data", "method_startline": "137", "method_endline": "140"}}, "hunk_2": {"Ismethod": 1, "added_lines": "54,55,56,57,58", "deleted_lines": null, "method_info": {"method_name": "most_similar_vectors_data", "method_params": "", "method_startline": "54", "method_endline": "58"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "spacy\\vectors.pyx", "file_new_name": "spacy\\vectors.pyx", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "339,340", "deleted_lines": "339,340"}}}}}}