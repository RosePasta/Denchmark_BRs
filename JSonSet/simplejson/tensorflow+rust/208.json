{"BR": {"BR_id": "208", "BR_author": "jocaml", "BRopenT": "2019-05-29T11:36:14Z", "BRcloseT": "2019-06-01T18:26:06Z", "BR_text": {"BRsummary": "Segmentation fault when accessing output consumers", "BRdescription": "\n Using version 0.13.0, when I try to call any method on members of the op.output_consumers(i)vector, I get a segmentation fault:\n fn f(graph: &Graph) {\n     let placeholders = graph\n         .operation_iter()\n         .filter(|op| op.op_type() == Ok(\"Placeholder\".into()));\n \n     for op in placeholders {\n         for i in 0..op.num_outputs() {\n             for (consumer_op, input_index) in op.output_consumers(i) {\n                 consumer_op.input(input_index); // Segmentation fault (core dumped)\n             }\n         }\n     }\n }\n Here is a <denchmark-link:https://github.com/tensorflow/rust/files/3235555/valgrind.log>valgrind log</denchmark-link>\n . Not sure if this should be submitted to the tensorflow repo.\n Here is the cargo project: <denchmark-link:https://github.com/tensorflow/rust/files/3235562/tf.zip>tf.zip</denchmark-link>\n \n Edit: I've uploaded a new valgrind log, the last one had some garbage from other dependencies (though not sure how they ended up in there hm).\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jocaml", "commentT": "2019-05-30T05:19:12Z", "comment_text": "\n \t\tI tried it with all versions from 0.9.0 (tensorflow 1.7.0) and it's the same. On one run I managed to get\n [src/tf.rs:104] consumer_op.input(input_index) = (\n     Operation {\n         inner: 0x0000000000000000,\n         gimpl: GraphImpl {\n             inner: 0x000056278c30bb50,\n             owned: true,\n         },\n     },\n     18446744073709551615,\n )\n Is prebuilt downloaded TensorFlow compiled with jemalloc?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jocaml", "commentT": "2019-05-31T03:34:03Z", "comment_text": "\n \t\tI've tracked it down to a bug in the Rust bindings.  I'll submit a fix.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "jocaml", "commentT": "2019-06-01T18:31:44Z", "comment_text": "\n \t\tBy the way, the prebuilt TensorFlow is compiled with jemalloc.  I have to disable it and compile TensorFlow from scratch (which takes quite a while) to check for memory leaks with valgrind.\n \t\t"}}}, "commit": {"commit_id": "778fe376b0032b5aef860c7d9576bd59e5a155e2", "commit_author": "Adam Crume", "commitT": "2019-05-30 20:43:42-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\graph.rs", "file_new_name": "src\\graph.rs", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "2826,2827,2828,2829,2830,2831,2832,2833,2834,2835,2836,2837,2838,2839,2840,2841,2842,2843,2844", "deleted_lines": null, "method_info": {"method_name": "output_consumers", "method_params": "", "method_startline": "2826", "method_endline": "2844"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1120", "deleted_lines": "1120", "method_info": {"method_name": "output_consumers", "method_params": "self,usize", "method_startline": "1107", "method_endline": "1135"}}}}}}}