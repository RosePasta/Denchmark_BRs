{"BR": {"BR_id": "1288", "BR_author": "zengxy", "BRopenT": "2020-02-24T09:29:40Z", "BRcloseT": "2020-02-26T02:06:10Z", "BR_text": {"BRsummary": "[Bug] NodeFlow.block_compute came up with error \"NodeFlowobject has no attribute num_edges\"", "BRdescription": "\n version v0.4.1\n I found that it has been asked in <denchmark-link:https://discuss.dgl.ai/t/nodeflow-questions/593>https://discuss.dgl.ai/t/nodeflow-questions/593</denchmark-link>\n .\n It only appears when using  build in send / reduce functions, you can reproduce by the following snippet\n import dgl\n import numpy as np\n g = dgl.DGLGraph()\n g.add_nodes(5)\n g.add_edges([1,2], [2,3])\n g.ndata[\"f\"] = np.zeros([5,6])\n g.readonly()\n nfs = dgl.contrib.sampling.NeighborSampler(g, 10, 5)\n for nf in nfs:\n     break\n nf.copy_from_parent()\n nf.apply_block(0, lambda edges: {\"m\": edges.src[\"f\"]})   # running successful\n nf.apply_block(0, dgl.function.copy_src(\"f\", \"m\"))   # throw exception\n The root cause is as following:\n The exception is raised from scheduler._gen_send, in which the  old  DGLBaseGraph.number_of_edges invoking is changed to AdaptedDGLGraph.num_edges in a certain commit. But while all the passed in graphs is wrapped  in DGLGraph, nodeflow dosen't do it.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "zengxy", "commentT": "2020-02-24T10:14:26Z", "comment_text": "\n \t\tConfirmed this is a bug. I actually have met this bug and patched it when I was developing an example for multi-GPU training (<denchmark-link:https://github.com/dmlc/dgl/pull/1143>#1143</denchmark-link>\n  ). Since that PR would take more time to merge, I have pushed a patch in a standalone PR.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "zengxy", "commentT": "2020-02-25T08:08:55Z", "comment_text": "\n \t\tThank you! The pacth is very useful for me.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "zengxy", "commentT": "2020-02-26T02:06:10Z", "comment_text": "\n \t\tDone in PR1289.\n \t\t"}}}, "commit": {"commit_id": "37d992ecf69680e2367eac1a9dcba3de528710d2", "commit_author": "Minjie Wang", "commitT": "2020-02-26 10:05:38+08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "python\\dgl\\runtime\\scheduler.py", "file_new_name": "python\\dgl\\runtime\\scheduler.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "977,987,988,989,990,998", "deleted_lines": "976,986,994", "method_info": {"method_name": "_gen_send", "method_params": "graph,u,v,eid,mfunc,var_src_nf,var_dst_nf,var_ef", "method_startline": "976", "method_endline": "1009"}}, "hunk_1": {"Ismethod": 1, "added_lines": "970,971", "deleted_lines": "970", "method_info": {"method_name": "_mfunc_wrapper", "method_params": "src_data,edge_data,dst_data", "method_startline": "968", "method_endline": "972"}}, "hunk_2": {"Ismethod": 1, "added_lines": "977,987,988,989,990,998", "deleted_lines": "986,994", "method_info": {"method_name": "_gen_send", "method_params": "graph,u,v,eid,mfunc,var_src_nf,var_dst_nf,var_ef,block_id", "method_startline": "977", "method_endline": "1013"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\compute\\test_nodeflow.py", "file_new_name": "tests\\compute\\test_nodeflow.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "222,223,224,225,226,227,228", "deleted_lines": null, "method_info": {"method_name": "check_apply_edges", "method_params": "create_node_flow", "method_startline": "195", "method_endline": "228"}}}}}}}