{"BR": {"BR_id": "876", "BR_author": "xkszltl", "BRopenT": "2019-04-22T00:03:53Z", "BRcloseT": "2019-06-11T20:01:17Z", "BR_text": {"BRsummary": "Undefined symbol from nsync.", "BRdescription": "\n Describe the bug\n Get the same error, with/without LTO.\n <denchmark-code>FAILED: onnxruntime_mlas_test \n : && /opt/rh/devtoolset-8/root/usr/bin/g++  -fdebug-prefix-map='/tmp/scratch'='/usr/local/src' -g -fopenmp -DGSL_THROW_ON_CONTRACT_VIOLATION -Wall -Wextra -ffunction-sections -fdata-sections -Wno-error=sign-compare -Wno-parentheses -O3 -DNDEBUG -march=native -mtune=native -DGSL_UNENFORCED_ON_CONTRACT_VIOLATION   CMakeFiles/onnxruntime_mlas_test.dir/tmp/scratch/onnxruntime/onnxruntime/test/mlas/unittest.cpp.o  -o onnxruntime_mlas_test -L/tmp/scratch/onnxruntime/build/mklml/src/project_mklml/lib  -L/tmp/scratch/onnxruntime/build/mkl-dnn/install/lib64 -Wl,-rpath,/tmp/scratch/onnxruntime/build/mklml/src/project_mklml/lib:/tmp/scratch/onnxruntime/build/mkl-dnn/install/lib64 libonnxruntime_mlas.a libonnxruntime_common.a && :\n libonnxruntime_common.a(ort_mutex.cc.o): In function `onnxruntime::OrtMutex::lock()':\n /usr/local/src/onnxruntime/build/../onnxruntime/core/platform/posix/ort_mutex.cc:24: undefined reference to `nsync::nsync_mu_lock(nsync::nsync_mu_s_*)'\n libonnxruntime_common.a(ort_mutex.cc.o): In function `onnxruntime::OrtMutex::try_lock()':\n /usr/local/src/onnxruntime/build/../onnxruntime/core/platform/posix/ort_mutex.cc:34: undefined reference to `nsync::nsync_mu_trylock(nsync::nsync_mu_s_*)'\n libonnxruntime_common.a(ort_mutex.cc.o): In function `onnxruntime::OrtMutex::unlock()':\n /usr/local/src/onnxruntime/build/../onnxruntime/core/platform/posix/ort_mutex.cc:43: undefined reference to `nsync::nsync_mu_unlock(nsync::nsync_mu_s_*)'\n libonnxruntime_common.a(ort_mutex.cc.o): In function `onnxruntime::OrtCondVar::notify_one()':\n /usr/local/src/onnxruntime/build/../onnxruntime/core/platform/posix/ort_mutex.cc:60: undefined reference to `nsync::nsync_cv_signal(nsync::nsync_cv_s_*)'\n libonnxruntime_common.a(ort_mutex.cc.o): In function `onnxruntime::OrtCondVar::notify_all()':\n /usr/local/src/onnxruntime/build/../onnxruntime/core/platform/posix/ort_mutex.cc:68: undefined reference to `nsync::nsync_cv_broadcast(nsync::nsync_cv_s_*)'\n libonnxruntime_common.a(ort_mutex.cc.o): In function `onnxruntime::OrtCondVar::wait(std::unique_lock<onnxruntime::OrtMutex>&)':\n /usr/local/src/onnxruntime/build/../onnxruntime/core/platform/posix/ort_mutex.cc:78: undefined reference to `nsync::nsync_cv_wait(nsync::nsync_cv_s_*, nsync::nsync_mu_s_*)'\n libonnxruntime_common.a(ort_mutex.cc.o): In function `onnxruntime::OrtCondVar::timed_wait_impl(std::unique_lock<onnxruntime::OrtMutex>&, std::chrono::time_point<std::chrono::_V2::system_clock, std::chrono::duration<long, std::ratio<1l, 1000000000l> > >)':\n /usr/local/src/onnxruntime/build/../onnxruntime/core/platform/posix/ort_mutex.cc:109: undefined reference to `nsync::nsync_cv_wait_with_deadline(nsync::nsync_cv_s_*, nsync::nsync_mu_s_*, timespec, nsync::nsync_note_s_*)'\n collect2: error: ld returned 1 exit status\n </denchmark-code>\n \n System information\n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): CentOS 7\n ONNX Runtime installed from (source or binary): source\n ONNX Runtime version: master\n Python version: 3.6\n GCC/Compiler version (if compiling from source): gcc-8 (devtoolset-8)\n CUDA/cuDNN version: 10.1\n GPU model and memory: Volta\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "xkszltl", "commentT": "2019-04-22T07:14:20Z", "comment_text": "\n \t\tonnxruntime doesn't support CentOS 7. Also, please include exact steps to reproduce to help us help you better. What is your exact build command? Can you reproduce this on Ubuntu 16.04?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "xkszltl", "commentT": "2019-04-22T07:47:53Z", "comment_text": "\n \t\tHard to believe this is distro related as ort carries nsync submodule.\n <denchmark-link:#>\u2026</denchmark-link>\n \n \n  On Apr 22, 2019, at 00:14, Pranav Sharma ***@***.***> wrote:\n \n  onnxruntime doesn't support CentOS 7.\n \n  \u2014\n  You are receiving this because you authored the thread.\n  Reply to this email directly, view it on GitHub <#876 (comment)>, or mute the thread <https://github.com/notifications/unsubscribe-auth/ABHWIULGBCBNIS5KWW4GD3LPRVQVBANCNFSM4HHMU57Q>.\n \n \n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "xkszltl", "commentT": "2019-04-23T18:23:50Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/xkszltl>@xkszltl</denchmark-link>\n  can you share the build details and repro steps as asked above for futher investigation?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "xkszltl", "commentT": "2019-04-23T19:27:04Z", "comment_text": "\n \t\tHere's the build command, except with .\n <denchmark-link:https://github.com/xkszltl/Roaster/blob/5cb4623bbd7875f32f605f0fe294f5dda7e4db33/pkgs/ort.sh#L52-L93>https://github.com/xkszltl/Roaster/blob/5cb4623bbd7875f32f605f0fe294f5dda7e4db33/pkgs/ort.sh#L52-L93</denchmark-link>\n \n <denchmark-code>mkdir -p build\n cd $_\n \n cmake                                               \\\n     -DCMAKE_BUILD_TYPE=Release                      \\\n     -DCMAKE_C_COMPILER=gcc                          \\\n     -DCMAKE_CXX_COMPILER=g++                        \\\n     -DCMAKE_{C,CXX,CUDA}_COMPILER_LAUNCHER=ccache   \\\n     -DCMAKE_C{,XX}_FLAGS=\"-fdebug-prefix-map='$SCRATCH'='$INSTALL_PREFIX/src' -g\"   \\\n     -DCMAKE_INSTALL_PREFIX=\"$INSTALL_ABS\"           \\\n     -DCMAKE_POLICY_DEFAULT_CMP0003=NEW              \\\n     -DCMAKE_POLICY_DEFAULT_CMP0060=NEW              \\\n     -DCMAKE_VERBOSE_MAKEFILE=ON                     \\\n     -Deigen_SOURCE_PATH=\"/usr/local/include/eigen3\" \\\n     -Donnxruntime_BUILD_FOR_NATIVE_MACHINE=ON       \\\n     -Donnxruntime_BUILD_SHARED_LIB=ON               \\\n     -Donnxruntime_CUDNN_HOME='/usr/lib64'           \\\n     -Donnxruntime_ENABLE_PYTHON=ON                  \\\n     -Donnxruntime_ENABLE_LTO=ON                     \\\n     -Donnxruntime_RUN_ONNX_TESTS=ON                 \\\n     -Donnxruntime_USE_BRAINSLICE=OFF                \\\n     -Donnxruntime_USE_CUDA=OFF                      \\\n     -Donnxruntime_USE_EIGEN_FOR_BLAS=OFF            \\\n     -Donnxruntime_USE_EIGEN_THREADPOOL=OFF          \\\n     -Donnxruntime_USE_FULL_PROTOBUF=ON              \\\n     -Donnxruntime_USE_JEMALLOC=OFF                  \\\n     -Donnxruntime_USE_LLVM=ON                       \\\n     -Donnxruntime_USE_MKLDNN=ON                     \\\n     -Donnxruntime_USE_MKLML=ON                      \\\n     -Donnxruntime_USE_NSYNC=OFF                     \\\n     -Donnxruntime_USE_NUPHAR=OFF                    \\\n     -Donnxruntime_USE_OPENBLAS=ON                   \\\n     -Donnxruntime_USE_OPENMP=ON                     \\\n     -Donnxruntime_USE_PREINSTALLED_EIGEN=OFF        \\\n     -Donnxruntime_USE_TENSORRT=OFF                  \\\n     -Donnxruntime_USE_TVM=OFF                       \\\n     -G\"Ninja\"                                       \\\n     ../cmake\n \n time cmake --build .\n time cmake --build . --target install\n </denchmark-code>\n \n \t\t"}}}, "commit": {"commit_id": "6d5ea08936b95558e4601a453442c970c9d69f96", "commit_author": "Changming Sun", "commitT": "2019-06-11 13:01:16-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "cmake\\onnxruntime_unittests.cmake", "file_new_name": "cmake\\onnxruntime_unittests.cmake", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "522,524,525,526,527,528,654,655,656,657,658,659", "deleted_lines": "522,524,650"}}}}}}