{"BR": {"BR_id": "1918", "BR_author": "RotemEmergi", "BRopenT": "2020-07-20T16:36:31Z", "BRcloseT": "2020-07-23T18:49:58Z", "BR_text": {"BRsummary": "Could not dump annotations for the task 1 | COCO 1.0", "BRdescription": "\n Hi !\n I am getting this error when I am trying to dump annotations with COCO 1.0 :\n Error: Request failed with status code 500. \"ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\\n\".\n My branch is release-1.1.0 .\n Error from docker logs :\n <denchmark-code>2020-07-20 16:34:06,445 DEBG 'rqworker_default_1' stderr output:\n [2020-07-20 16:34:06,443] ERROR cvat.server.task_1: [cvat.apps.dataset_manager.views @ export_task]: exception occurred\n Traceback (most recent call last):\n   File \"/home/django/cvat/apps/dataset_manager/views.py\", line 62, in export_task\n     server_url=server_url, save_images=save_images)\n   File \"/home/django/cvat/apps/dataset_manager/task.py\", line 723, in export_task\n     save_images=save_images)\n   File \"/home/django/cvat/apps/dataset_manager/task.py\", line 619, in export\n     exporter(dst_file, task_data, **options)\n   File \"/home/django/cvat/apps/dataset_manager/formats/registry.py\", line 36, in __call__\n     f_or_cls(*args, **kwargs)\n   File \"/home/django/cvat/apps/dataset_manager/formats/coco.py\", line 23, in _export\n     converter(extractor, save_dir=temp_dir)\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 609, in __call__\n     converter.convert()\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 552, in convert\n     task_conv.save_annotations(item)\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 265, in save_annotations\n     instances = [self.find_instance_parts(i, w, h) for i in instances]\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 265, in <listcomp>\n     instances = [self.find_instance_parts(i, w, h) for i in instances]\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 208, in find_instance_parts\n     leader = anno_tools.find_group_leader(anns)\n   File \"/home/django/datumaro/datumaro/util/annotation_tools.py\", line 23, in find_group_leader\n     return max(group, key=lambda x: x.get_area())\n   File \"/home/django/datumaro/datumaro/util/annotation_tools.py\", line 23, in <lambda>\n     return max(group, key=lambda x: x.get_area())\n   File \"/home/django/datumaro/datumaro/components/extractor.py\", line 434, in get_area\n     _, _, w, h = self.get_bbox()\n   File \"/home/django/datumaro/datumaro/components/extractor.py\", line 384, in get_bbox\n     if not points:\n ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n \n 2020-07-20 16:34:06,445 DEBG 'rqworker_default_1' stderr output:\n ERROR:cvat.server.task_1:[cvat.apps.dataset_manager.views @ export_task]: exception occurred\n Traceback (most recent call last):\n   File \"/home/django/cvat/apps/dataset_manager/views.py\", line 62, in export_task\n     server_url=server_url, save_images=save_images)\n   File \"/home/django/cvat/apps/dataset_manager/task.py\", line 723, in export_task\n     save_images=save_images)\n   File \"/home/django/cvat/apps/dataset_manager/task.py\", line 619, in export\n     exporter(dst_file, task_data, **options)\n   File \"/home/django/cvat/apps/dataset_manager/formats/registry.py\", line 36, in __call__\n     f_or_cls(*args, **kwargs)\n   File \"/home/django/cvat/apps/dataset_manager/formats/coco.py\", line 23, in _export\n     converter(extractor, save_dir=temp_dir)\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 609, in __call__\n     converter.convert()\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 552, in convert\n     task_conv.save_annotations(item)\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 265, in save_annotations\n     instances = [self.find_instance_parts(i, w, h) for i in instances]\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 265, in <listcomp>\n     instances = [self.find_instance_parts(i, w, h) for i in instances]\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 208, in find_instance_parts\n     leader = anno_tools.find_group_leader(anns)\n   File \"/home/django/datumaro/datumaro/util/annotation_tools.py\", line 23, in find_group_leader\n     return max(group, key=lambda x: x.get_area())\n   File \"/home/django/datumaro/datumaro/util/annotation_tools.py\", line 23, in <lambda>\n     return max(group, key=lambda x: x.get_area())\n   File \"/home/django/datumaro/datumaro/components/extractor.py\", line 434, in get_area\n     _, _, w, h = self.get_bbox()\n   File \"/home/django/datumaro/datumaro/components/extractor.py\", line 384, in get_bbox\n     if not points:\n ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n \n 2020-07-20 16:34:06,447 DEBG 'rqworker_default_1' stderr output:\n ERROR:rq.worker:ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n Traceback (most recent call last):\n   File \"/usr/local/lib/python3.5/dist-packages/rq/worker.py\", line 812, in perform_job\n     rv = job.perform()\n   File \"/usr/local/lib/python3.5/dist-packages/rq/job.py\", line 588, in perform\n     self._result = self._execute()\n   File \"/usr/local/lib/python3.5/dist-packages/rq/job.py\", line 594, in _execute\n     return self.func(*self.args, **self.kwargs)\n   File \"/home/django/cvat/apps/dataset_manager/views.py\", line 87, in export_task_annotations\n     return export_task(task_id, dst_format, server_url=server_url, save_images=False)\n   File \"/home/django/cvat/apps/dataset_manager/views.py\", line 62, in export_task\n     server_url=server_url, save_images=save_images)\n   File \"/home/django/cvat/apps/dataset_manager/task.py\", line 723, in export_task\n     save_images=save_images)\n   File \"/home/django/cvat/apps/dataset_manager/task.py\", line 619, in export\n     exporter(dst_file, task_data, **options)\n   File \"/home/django/cvat/apps/dataset_manager/formats/registry.py\", line 36, in __call__\n     f_or_cls(*args, **kwargs)\n   File \"/home/django/cvat/apps/dataset_manager/formats/coco.py\", line 23, in _export\n     converter(extractor, save_dir=temp_dir)\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 609, in __call__\n     converter.convert()\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 552, in convert\n     task_conv.save_annotations(item)\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 265, in save_annotations\n     instances = [self.find_instance_parts(i, w, h) for i in instances]\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 265, in <listcomp>\n     instances = [self.find_instance_parts(i, w, h) for i in instances]\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 208, in find_instance_parts\n     leader = anno_tools.find_group_leader(anns)\n   File \"/home/django/datumaro/datumaro/util/annotation_tools.py\", line 23, in find_group_leader\n     return max(group, key=lambda x: x.get_area())\n   File \"/home/django/datumaro/datumaro/util/annotation_tools.py\", line 23, in <lambda>\n     return max(group, key=lambda x: x.get_area())\n   File \"/home/django/datumaro/datumaro/components/extractor.py\", line 434, in get_area\n     _, _, w, h = self.get_bbox()\n   File \"/home/django/datumaro/datumaro/components/extractor.py\", line 384, in get_bbox\n     if not points:\n ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n Traceback (most recent call last):\n   File \"/usr/local/lib/python3.5/dist-packages/rq/worker.py\", line 812, in perform_job\n     rv = job.perform()\n   File \"/usr/local/lib/python3.5/dist-packages/rq/job.py\", line 588, in perform\n     self._result = self._execute()\n   File \"/usr/local/lib/python3.5/dist-packages/rq/job.py\", line 594, in _execute\n     return self.func(*self.args, **self.kwargs)\n   File \"/home/django/cvat/apps/dataset_manager/views.py\", line 87, in export_task_annotations\n     return export_task(task_id, dst_format, server_url=server_url, save_images=False)\n   File \"/home/django/cvat/apps/dataset_manager/views.py\", line 62, in export_task\n     server_url=server_url, save_images=save_images)\n   File \"/home/django/cvat/apps/dataset_manager/task.py\", line 723, in export_task\n     save_images=save_images)\n   File \"/home/django/cvat/apps/dataset_manager/task.py\", line 619, in export\n     exporter(dst_file, task_data, **options)\n   File \"/home/django/cvat/apps/dataset_manager/formats/registry.py\", line 36, in __call__\n     f_or_cls(*args, **kwargs)\n   File \"/home/django/cvat/apps/dataset_manager/formats/coco.py\", line 23, in _export\n     converter(extractor, save_dir=temp_dir)\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 609, in __call__\n     converter.convert()\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 552, in convert\n     task_conv.save_annotations(item)\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 265, in save_annotations\n     instances = [self.find_instance_parts(i, w, h) for i in instances]\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 265, in <listcomp>\n     instances = [self.find_instance_parts(i, w, h) for i in instances]\n   File \"/home/django/datumaro/datumaro/plugins/coco_format/converter.py\", line 208, in find_instance_parts\n     leader = anno_tools.find_group_leader(anns)\n   File \"/home/django/datumaro/datumaro/util/annotation_tools.py\", line 23, in find_group_leader\n     return max(group, key=lambda x: x.get_area())\n   File \"/home/django/datumaro/datumaro/util/annotation_tools.py\", line 23, in <lambda>\n     return max(group, key=lambda x: x.get_area())\n   File \"/home/django/datumaro/datumaro/components/extractor.py\", line 434, in get_area\n     _, _, w, h = self.get_bbox()\n   File \"/home/django/datumaro/datumaro/components/extractor.py\", line 384, in get_bbox\n     if not points:\n ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "RotemEmergi", "commentT": "2020-07-21T08:45:26Z", "comment_text": "\n \t\tTogether with <denchmark-link:https://github.com/RotemEmergi>@RotemEmergi</denchmark-link>\n , we found a fix:\n change:  \"if not points:\" to \"if points is None:\"\n def get_bbox(self):\n points = self.points\n if points is None:\n return None\n \t\t"}}}, "commit": {"commit_id": "fa4eea70d10fe23985605c3a93f1f537b54385f7", "commit_author": "zhiltsov-max", "commitT": "2020-07-23 21:49:57+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "datumaro\\datumaro\\components\\extractor.py", "file_new_name": "datumaro\\datumaro\\components\\extractor.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "381,382,383", "deleted_lines": "381"}}}}}}