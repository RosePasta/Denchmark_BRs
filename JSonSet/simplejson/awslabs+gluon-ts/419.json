{"BR": {"BR_id": "419", "BR_author": "gjmulder", "BRopenT": "2019-11-01T07:09:23Z", "BRcloseT": "2020-01-30T15:27:22Z", "BR_text": {"BRsummary": "DeepStateEstimator with add_trend=True throws \"module 'mxnet.symbol' has no attribute 'array'\"", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n DeepStateEstimator with add_trend=True throws the exception below. Setting add_trend=False (the default) does not throw the exception.\n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n See attached modified benchmark_m4.py.txt\n <denchmark-link:https://github.com/awslabs/gluon-ts/files/3796950/benchmark_m4.py.txt>benchmark_m4.py.txt</denchmark-link>\n \n <denchmark-h:h2>Error Message</denchmark-h>\n \n <denchmark-code>Traceback (most recent call last):\n   File \"./benchmark_m4.py\", line 84, in <module>\n     results.append(evaluate(dataset_name, estimator))\n   File \"./benchmark_m4.py\", line 60, in evaluate\n     predictor = estimator.train(dataset.train)\n   File \"/home/repro/.local/lib/python3.6/site-packages/gluonts-0.3.4.dev78+g8642509-py3.6.egg/gluonts/model/estimator.py\", line 201, in train\n     return self.train_model(training_data).predictor\n   File \"/home/repro/.local/lib/python3.6/site-packages/gluonts-0.3.4.dev78+g8642509-py3.6.egg/gluonts/model/estimator.py\", line 187, in train_model\n     train_iter=training_data_loader,\n   File \"/home/repro/.local/lib/python3.6/site-packages/gluonts-0.3.4.dev78+g8642509-py3.6.egg/gluonts/trainer/_base.py\", line 246, in __call__\n     output = net(*inputs)\n   File \"/home/repro/.local/lib/python3.6/site-packages/mxnet/gluon/block.py\", line 540, in __call__\n     out = self.forward(*args)\n   File \"/home/repro/.local/lib/python3.6/site-packages/mxnet/gluon/block.py\", line 907, in forward\n     return self._call_cached_op(x, *args)\n   File \"/home/repro/.local/lib/python3.6/site-packages/mxnet/gluon/block.py\", line 797, in _call_cached_op\n     self._build_cache(*args)\n   File \"/home/repro/.local/lib/python3.6/site-packages/mxnet/gluon/block.py\", line 749, in _build_cache\n     data, out = self._get_graph(*args)\n   File \"/home/repro/.local/lib/python3.6/site-packages/mxnet/gluon/block.py\", line 741, in _get_graph\n     out = self.hybrid_forward(symbol, *grouped_inputs, **params)  # pylint: disable=no-value-for-parameter\n   File \"/home/repro/.local/lib/python3.6/site-packages/gluonts-0.3.4.dev78+g8642509-py3.6.egg/gluonts/model/deepstate/_network.py\", line 171, in hybrid_forward\n     length=self.past_length,\n   File \"/home/repro/.local/lib/python3.6/site-packages/gluonts-0.3.4.dev78+g8642509-py3.6.egg/gluonts/model/deepstate/_network.py\", line 129, in compute_lds\n     seasonal_indicators\n   File \"/home/repro/.local/lib/python3.6/site-packages/gluonts-0.3.4.dev78+g8642509-py3.6.egg/gluonts/model/deepstate/issm.py\", line 341, in get_issm_coeff\n     self.nonseasonal_issm.get_issm_coeff(seasonal_indicators),\n   File \"/home/repro/.local/lib/python3.6/site-packages/gluonts-0.3.4.dev78+g8642509-py3.6.egg/gluonts/model/deepstate/issm.py\", line 131, in get_issm_coeff\n     self.transition_coeff(seasonal_indicators),\n   File \"/home/repro/.local/lib/python3.6/site-packages/gluonts-0.3.4.dev78+g8642509-py3.6.egg/gluonts/model/deepstate/issm.py\", line 205, in transition_coeff\n     F.array([[1, 1], [0, 1]])\n AttributeError: module 'mxnet.symbol' has no attribute 'array'\n </denchmark-code>\n \n <denchmark-h:h2>Environment</denchmark-h>\n \n \n \n Operating system:\n 4.15.0-65-generic #74-Ubuntu SMP Tue Sep 17 17:06:04 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\n \n \n Python version:\n \n \n Python 3.6.8\n \n GluonTS version:\n \n Name: gluonts\n Version: 0.3.4.dev78+g8642509\n Summary: GluonTS is a Python toolkit for probabilistic time series modeling, built around MXNet.\n Home-page: <denchmark-link:https://github.com/awslabs/gluon-ts>https://github.com/awslabs/gluon-ts</denchmark-link>\n \n Author: Amazon\n Author-email: <denchmark-link:mailto:gluon-ts-dev@amazon.com>gluon-ts-dev@amazon.com</denchmark-link>\n \n License: Apache License 2.0\n Location: /home/repro/.local/lib/python3.6/site-packages/gluonts-0.3.4.dev78+g8642509-py3.6.egg\n Requires: boto3, holidays, matplotlib, mxnet-cu92mkl, numpy, pandas, pydantic, tqdm, ujson\n Name: pandas\n Version: 0.25.2\n Summary: Powerful data structures for data analysis, time series, and statistics\n Home-page: <denchmark-link:http://pandas.pydata.org>http://pandas.pydata.org</denchmark-link>\n \n Author: None\n Author-email: None\n License: BSD\n Location: /home/repro/.local/lib/python3.6/site-packages/pandas-0.25.2-py3.6-linux-x86_64.egg\n Requires: numpy, python-dateutil, pytz\n Name: numpy\n Version: 1.14.6\n Summary: NumPy: array processing for numbers, strings, records, and objects.\n Home-page: <denchmark-link:http://www.numpy.org>http://www.numpy.org</denchmark-link>\n \n Author: Travis E. Oliphant et al.\n Author-email: None\n License: BSD\n Location: /home/repro/.local/lib/python3.6/site-packages\n Requires:\n Name: mxnet\n Version: 1.4.1\n Summary: MXNet is an ultra-scalable deep learning framework. This version uses openblas.\n Home-page: <denchmark-link:https://github.com/apache/incubator-mxnet>https://github.com/apache/incubator-mxnet</denchmark-link>\n \n Author: UNKNOWN\n Author-email: UNKNOWN\n License: Apache 2.0\n Location: /home/repro/.local/lib/python3.6/site-packages\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "gjmulder", "commentT": "2019-11-12T15:15:28Z", "comment_text": "\n \t\tCurrently trend model does not work in symbolic mode. This needs a fix <denchmark-link:https://github.com/awslabs/gluon-ts/blob/85ea2185c123dddf19db46ce48c354f10d66d68f/src/gluonts/model/deepstate/issm.py#L204>here</denchmark-link>\n .\n Meanwhile, can you try disabling hybridize mode like this:\n <denchmark-code>estimators = [\n     partial(\n         DeepStateEstimator,\n         add_trend=True,\n         trainer=Trainer(\n             epochs=epochs, num_batches_per_epoch=num_batches_per_epoch, hybridize=False\n         ),\n     ),\n ]\n \n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "gjmulder", "commentT": "2019-11-14T10:32:40Z", "comment_text": "\n \t\tCheers! Will try when I have an opportunity.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "gjmulder", "commentT": "2019-11-26T17:26:31Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/gjmulder>@gjmulder</denchmark-link>\n  Have you found any substantial difference in accuracy for specific types of time series when running with ?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "gjmulder", "commentT": "2019-11-26T19:36:18Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/andmib>@andmib</denchmark-link>\n  I've been focusing on DeepAR due to the reported GPU issue with DeepState. Now that someone has confirmed the GPU fix works I'll switch back to DeepState - when I have time. Prof wants to publish a paper on my results to date with DeepAR, so I'm busily confirming them.\n \t\t"}}}, "commit": {"commit_id": "42f512ad5f78f9be5c925516c2433bd8e3321fdf", "commit_author": "Lorenzo Stella", "commitT": "2020-01-30 16:27:21+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\gluonts\\model\\deepstate\\issm.py", "file_new_name": "src\\gluonts\\model\\deepstate\\issm.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "204", "deleted_lines": "204,205"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "test\\model\\test_deepstate_smoke.py", "file_new_name": "test\\model\\test_deepstate_smoke.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "29,30,31,33", "deleted_lines": "29"}}}}}}