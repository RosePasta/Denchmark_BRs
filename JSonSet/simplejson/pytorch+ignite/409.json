{"BR": {"BR_id": "409", "BR_author": "anmolsjoshi", "BRopenT": "2019-01-23T02:40:44Z", "BRcloseT": "2019-01-24T17:44:38Z", "BR_text": {"BRsummary": "Bug in recursive attach of MetricsLambda", "BRdescription": "\n As a result of <denchmark-link:https://github.com/pytorch/ignite/pull/385>#385</denchmark-link>\n , the recursive attach of MetricsLambda is not working as intended.\n The code below throws this error: NotComputableError: Accuracy must have at least one example before it can be computed.\n import torch\n \n from ignite.metrics import Accuracy, Precision, Recall, MetricsLambda\n from ignite.engine import Engine\n \n accuracy_1 = Accuracy()\n accuracy_2 = Accuracy()\n mean_accuracy = (accuracy_1 + accuracy_2) / 2\n \n \n metrics = {\n #     \"a1\": accuracy_1,\n #     \"a2\": accuracy_2,    \n     \"mean accuracy\": mean_accuracy,\n }\n \n \n y_pred = torch.randint(0, 2, size=(15, 10, 4)).float()\n y = torch.randint(0, 2, size=(15, 10, 4)).long()\n \n def update_fn(engine, batch):\n     y_pred, y = batch\n     return y_pred, y\n \n validator = Engine(update_fn)\n \n for name, metric in metrics.items():\n     metric.attach(validator, name)\n \n def data(y_pred, y):\n     for i in range(y_pred.shape[0]):\n         yield (y_pred[i], y[i])\n \n d = data(y_pred, y)\n state = validator.run(d, max_epochs=1)\n \n print(state.metrics)\n cc <denchmark-link:https://github.com/vfdev-5>@vfdev-5</denchmark-link>\n  <denchmark-link:https://github.com/amitibo>@amitibo</denchmark-link>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "62da92c271e1ce7e9d9a66ce24007bdb2d1200af", "commit_author": "vfdev", "commitT": "2019-01-24 09:44:37-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "ignite\\metrics\\metrics_lambda.py", "file_new_name": "ignite\\metrics\\metrics_lambda.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "66,67,68,69,70", "deleted_lines": null, "method_info": {"method_name": "attach", "method_params": "self,engine,name", "method_startline": "66", "method_endline": "70"}}, "hunk_1": {"Ismethod": 1, "added_lines": "56,58,59,60", "deleted_lines": "56,57,59,64", "method_info": {"method_name": "_internal_attach", "method_params": "self,engine", "method_startline": "56", "method_endline": "64"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 13, "file_old_name": "tests\\ignite\\metrics\\test_metrics_lambda.py", "file_new_name": "tests\\ignite\\metrics\\test_metrics_lambda.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "214,215,216", "deleted_lines": null, "method_info": {"method_name": "test_state_metrics_ingredients_not_attached.data", "method_params": "y_pred,y", "method_startline": "214", "method_endline": "216"}}, "hunk_1": {"Ismethod": 1, "added_lines": "244,245,246", "deleted_lines": null, "method_info": {"method_name": "test_recursive_attachment.test_recursive_attachment._test.data", "method_params": "y_pred,y", "method_startline": "244", "method_endline": "246"}}, "hunk_2": {"Ismethod": 1, "added_lines": "125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163", "deleted_lines": null, "method_info": {"method_name": "test_integration_ingredients_not_attached", "method_params": "", "method_startline": "125", "method_endline": "163"}}, "hunk_3": {"Ismethod": 1, "added_lines": "282,283,284,285", "deleted_lines": null, "method_info": {"method_name": "test_recursive_attachment.compute_true_somemetric", "method_params": "y_pred,y", "method_startline": "282", "method_endline": "285"}}, "hunk_4": {"Ismethod": 1, "added_lines": "226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254", "deleted_lines": null, "method_info": {"method_name": "test_recursive_attachment._test", "method_params": "composed_metric,metric_name,compute_true_value_fn", "method_startline": "226", "method_endline": "254"}}, "hunk_5": {"Ismethod": 1, "added_lines": "154,155", "deleted_lines": null, "method_info": {"method_name": "test_integration_ingredients_not_attached.Fbeta", "method_params": "r,p,beta", "method_startline": "154", "method_endline": "155"}}, "hunk_6": {"Ismethod": 1, "added_lines": "144,145,146,147", "deleted_lines": null, "method_info": {"method_name": "test_integration_ingredients_not_attached.update_fn", "method_params": "engine,batch", "method_startline": "144", "method_endline": "147"}}, "hunk_7": {"Ismethod": 1, "added_lines": "260,261,262,263", "deleted_lines": null, "method_info": {"method_name": "test_recursive_attachment.compute_true_summed_precision", "method_params": "y_pred,y", "method_startline": "260", "method_endline": "263"}}, "hunk_8": {"Ismethod": 1, "added_lines": "271,272,273,274", "deleted_lines": null, "method_info": {"method_name": "test_recursive_attachment.compute_true_mean_precision", "method_params": "y_pred,y", "method_startline": "271", "method_endline": "274"}}, "hunk_9": {"Ismethod": 1, "added_lines": "196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221", "deleted_lines": null, "method_info": {"method_name": "test_state_metrics_ingredients_not_attached", "method_params": "", "method_startline": "196", "method_endline": "221"}}, "hunk_10": {"Ismethod": 1, "added_lines": "201,202,203", "deleted_lines": null, "method_info": {"method_name": "test_state_metrics_ingredients_not_attached.update_fn", "method_params": "engine,batch", "method_startline": "201", "method_endline": "203"}}, "hunk_11": {"Ismethod": 1, "added_lines": "235,236,237", "deleted_lines": null, "method_info": {"method_name": "test_recursive_attachment.test_recursive_attachment._test.update_fn", "method_params": "engine,batch", "method_startline": "235", "method_endline": "237"}}, "hunk_12": {"Ismethod": 1, "added_lines": "224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287", "deleted_lines": null, "method_info": {"method_name": "test_recursive_attachment", "method_params": "", "method_startline": "224", "method_endline": "287"}}}}}}}