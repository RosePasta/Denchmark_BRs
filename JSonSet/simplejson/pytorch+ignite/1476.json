{"BR": {"BR_id": "1476", "BR_author": "vfdev-5", "BRopenT": "2020-11-24T15:52:41Z", "BRcloseT": "2020-11-26T15:01:28Z", "BR_text": {"BRsummary": "Breaking change in metrics behaviour", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug description</denchmark-h>\n \n Following <denchmark-link:https://github.com/pytorch/ignite/pull/968>#968</denchmark-link>\n  (and associated issue ) metric's output is flatten if it returns a mapping/dict. In details, with ignite v0.4.2, for a\n custom metric's we have the following:\n class PerformanceIndicators(Metric):\n \n     def compute(self):\n         # ...\n         return {\n             'a': 12,\n             'b': 23\n         }\n \n PerformanceIndicators().attach(evaluator, name=\"indicators\")\n \n assert \"a\" in evaluator.state.metrics\n assert \"b\" in evaluator.state.metrics\n \n # This is a breaking change introduced by the PR\n assert not \"indicators\" in evaluator.state.metrics\n \n print(evaluator.state.metrics)\n > {'a': 12, 'b': 23}\n The questions we would like to address in this issue:\n \n Should we fix the breaking change by readding the dict into evaluator.state.metrics such that we'll have:\n \n <denchmark-code>print(evaluator.state.metrics)\n > {'a': 12, 'b': 23, 'indicators': {'a': 12, 'b': 23}}\n </denchmark-code>\n \n \n name parameter (e.g. \"indicators\") is never used. Should we append it to the flatten names (e.g. indicators/a, indicators/b) or we can accept that it is never used ?\n \n Thanks <denchmark-link:https://github.com/lidq92>@lidq92</denchmark-link>\n  for reporting this.\n <denchmark-h:h2>Environment</denchmark-h>\n \n \n PyTorch Version (e.g., 1.4): 1.6.0\n Ignite Version (e.g., 0.3.0): 0.4.2\n OS (e.g., Linux):\n How you installed Ignite (conda, pip, source):\n Python version:\n Any other relevant information:\n \n cc <denchmark-link:https://github.com/sdesrozis>@sdesrozis</denchmark-link>\n  <denchmark-link:https://github.com/liebkne>@liebkne</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "vfdev-5", "commentT": "2020-11-25T06:42:07Z", "comment_text": "\n \t\tI really appreciate this idea to have flat values and dict in metrics data\n <denchmark-code>print(evaluator.state.metrics)\n > {'a': 12, 'b': 23, 'indicators': {'a': 12, 'b': 23}}\n </denchmark-code>\n \n It does fix the use of name parameter too.\n A point is that doubles stored values but atm these values in dict are numbers.\n \t\t"}}}, "commit": {"commit_id": "92ba4df3082c7b4971260bad68dc5122d66c876b", "commit_author": "Sylvain Desroziers", "commitT": "2020-11-26 16:01:27+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "ignite\\metrics\\metric.py", "file_new_name": "ignite\\metrics\\metric.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "303,307,308,309,310,311,314", "deleted_lines": null, "method_info": {"method_name": "completed", "method_params": "self,Engine,str", "method_startline": "297", "method_endline": "319"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\ignite\\metrics\\test_metric.py", "file_new_name": "tests\\ignite\\metrics\\test_metric.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "675,676,678", "deleted_lines": null, "method_info": {"method_name": "test_completed", "method_params": "", "method_startline": "651", "method_endline": "685"}}}}}}}