{"BR": {"BR_id": "114", "BR_author": "vfdev-5", "BRopenT": "2018-03-16T18:22:25Z", "BRcloseT": "2018-03-19T16:39:22Z", "BR_text": {"BRsummary": "Invalid cross-device link with ModelCheckpoint, atomic=True", "BRdescription": "\n I have an issue with ModelCheckpoint when atomic=True\n <denchmark-code>Traceback (most recent call last):\n   File \"/usr/local/lib/python3.5/dist-packages/ignite-0.1.0a1-py3.5.egg/ignite/engines/trainer.py\", line 53, in run\n     self._handle_exception(state, e)\n   File \"/usr/local/lib/python3.5/dist-packages/ignite-0.1.0a1-py3.5.egg/ignite/engines/engine.py\", line 138, in _handle_exception\n     raise e\n   File \"/usr/local/lib/python3.5/dist-packages/ignite-0.1.0a1-py3.5.egg/ignite/engines/trainer.py\", line 40, in run\n     hours, mins, secs = self._run_once_on_dataset(state)\n   File \"/usr/local/lib/python3.5/dist-packages/ignite-0.1.0a1-py3.5.egg/ignite/engines/engine.py\", line 132, in _run_once_on_dataset\n     self._handle_exception(state, e)\n   File \"/usr/local/lib/python3.5/dist-packages/ignite-0.1.0a1-py3.5.egg/ignite/engines/engine.py\", line 138, in _handle_exception\n     raise e\n   File \"/usr/local/lib/python3.5/dist-packages/ignite-0.1.0a1-py3.5.egg/ignite/engines/engine.py\", line 123, in _run_once_on_dataset\n     self._fire_event(Events.ITERATION_COMPLETED, state)\n   File \"/usr/local/lib/python3.5/dist-packages/ignite-0.1.0a1-py3.5.egg/ignite/engines/engine.py\", line 106, in _fire_event\n     func(self, state, *(event_args + args), **kwargs)\n   File \"/usr/local/lib/python3.5/dist-packages/ignite-0.1.0a1-py3.5.egg/ignite/handlers/checkpoint.py\", line 147, in __call__\n     self._save(obj=obj, path=path)\n   File \"/usr/local/lib/python3.5/dist-packages/ignite-0.1.0a1-py3.5.egg/ignite/handlers/checkpoint.py\", line 124, in _save\n     os.rename(tmp.name, path)\n OSError: [Errno 18] Invalid cross-device link: '/tmp/tmpe7shyxri' -> '/home/user/output/weights/_SSD300_1.pth'\n </denchmark-code>\n \n Maybe we need to use  as suggested <denchmark-link:https://stackoverflow.com/questions/42392600/oserror-errno-18-invalid-cross-device-link>here</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "vfdev-5", "commentT": "2018-03-18T04:37:03Z", "comment_text": "\n \t\tCurrently, ModelCheckpoint uses the default destination in tempfile when saving a temporary file for an atomic checkpoint write. This is potentially problematic: it assumes that the default tempfile.tempdir is on the same volume as the user-specified destination directory (dirname); it also causes the issue described above. It should create the temporary file in the user-specified destination directory prior to renaming it (NamedTemporaryFile should take dir=dirname).\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "vfdev-5", "commentT": "2018-03-19T16:38:37Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/veugene>@veugene</denchmark-link>\n 's suggestion makes sense. Often in a cluster environment  will be on a small mount and not the drive that your process has access to\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "vfdev-5", "commentT": "2018-03-19T16:39:22Z", "comment_text": "\n \t\tFixed in <denchmark-link:https://github.com/pytorch/ignite/pull/115>#115</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "907e20908be7784c376f0a83712f66720fdc69d4", "commit_author": "Eugene Vorontsov", "commitT": "2018-03-19 09:39:00-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "ignite\\handlers\\checkpoint.py", "file_new_name": "ignite\\handlers\\checkpoint.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "112", "deleted_lines": "112", "method_info": {"method_name": "_save", "method_params": "self,obj,path", "method_startline": "107", "method_endline": "124"}}}}}}}