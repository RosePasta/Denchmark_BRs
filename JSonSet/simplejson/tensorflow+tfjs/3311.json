{"BR": {"BR_id": "3311", "BR_author": "bangonkali", "BRopenT": "2020-05-23T14:39:06Z", "BRcloseT": "2020-06-12T12:13:11Z", "BR_text": {"BRsummary": "Unknown padding parameter: explicit", "BRdescription": "\n <denchmark-h:h4>TensorFlow.js version</denchmark-h>\n \n Tested with both: 1.7.4 & 2.0.0-rc.4\n <denchmark-h:h4>Browser version</denchmark-h>\n \n Any.\n <denchmark-h:h4>Describe the problem or feature request</denchmark-h>\n \n The model.json converted using tensorflowjs_converter 1.7.4r1 contained explicit_paddings in the following lines:\n ...\n       {\n         \"name\": \"StatefulPartitionedCall/sequential/conv2d/Relu\",\n         \"op\": \"_FusedConv2D\",\n         \"input\": [\n           \"conv2d_input\",\n           \"Func/StatefulPartitionedCall/input/_2\",\n           \"Func/StatefulPartitionedCall/input/_3\"\n         ],\n         \"device\": \"/device:CPU:0\",\n         \"attr\": {\n           \"dilations\": { \"list\": { \"i\": [\"1\", \"1\", \"1\", \"1\"] } },\n           \"T\": { \"type\": \"DT_FLOAT\" },\n           \"strides\": { \"list\": { \"i\": [\"1\", \"1\", \"1\", \"1\"] } },\n           \"data_format\": { \"s\": \"TkhXQw==\" },\n           \"use_cudnn_on_gpu\": { \"b\": true },\n           \"explicit_paddings\": {\n             \"list\": { \"i\": [\"0\", \"0\", \"0\", \"0\", \"0\", \"0\", \"0\", \"0\"] }\n           },\n           \"num_args\": { \"i\": \"1\" },\n           \"epsilon\": { \"f\": 0.0 },\n           \"padding\": { \"s\": \"RVhQTElDSVQ=\" },\n           \"fused_ops\": { \"list\": { \"s\": [\"Qmlhc0FkZA==\", \"UmVsdQ==\"] } }\n         }\n       },\n ...\n I get this when trying to use the model. (2.0.0-rc.4)\n <denchmark-code>    Unknown padding parameter: explicit\n \n       at getPadAndOutInfo (node_modules/@tensorflow/tfjs-core/src/ops/conv_util.ts:434:11)\n       at conv_util.computeConv2DInfo (node_modules/@tensorflow/tfjs-core/src/ops/conv_util.ts:149:9)\n       at fusedConv2d_ (node_modules/@tensorflow/tfjs-core/src/ops/fused_ops.ts:387:20)\n       at fusedConv2d (node_modules/@tensorflow/tfjs-core/src/ops/operation.ts:45:24)\n       at convolution.executeOp (node_modules/@tensorflow/tfjs-converter/src/operations/executors/convolution_executor.ts:102:15)\n       at node_modules/@tensorflow/tfjs-converter/src/operations/operation_executor.ts:64:23\n       at node_modules/@tensorflow/tfjs/node_modules/@tensorflow/tfjs-core/src/engine.ts:425:20\n       at Engine.scopedRun (node_modules/@tensorflow/tfjs/node_modules/@tensorflow/tfjs-core/src/engine.ts:436:19)\n       at Engine.tidy (node_modules/@tensorflow/tfjs/node_modules/@tensorflow/tfjs-core/src/engine.ts:423:17)\n       at Object.tidy (node_modules/@tensorflow/tfjs-core/src/globals.ts:182:17)\n </denchmark-code>\n \n Pseudo-code of what I did. The other models without explicit_paddings on the converted json did work without issues.\n   const model = await loadGraphModel(\n     'http://localhost:5000/model2a/model.json'\n   );\n   const dTensor = tensor([...d, ...d]);\n   const reshape = dTensor.reshape([2, 18, 4, 1]);\n   console.log(reshape.shape);\n   const prediction = model.predict(reshape);\n <denchmark-h:h4>Code to reproduce the bug / link to feature request</denchmark-h>\n \n Unfortunately, I can't share the code at the moment. But Also I have other models that work without problems using the same pattern of approach. What common for those that worked is that they do not have explicit_paddings in their generated model.json.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "bangonkali", "commentT": "2020-05-23T14:53:08Z", "comment_text": "\n \t\tAdditional note: By manually editing the padding from base64 encoded EXPLICIT to SAME, the predict() does work. But I'm not sure about the values it outputs anymore. \ud83d\ude02\n <denchmark-link:https://user-images.githubusercontent.com/539946/82733690-214b2380-9d48-11ea-9b2e-f0eb98875551.png></denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "bangonkali", "commentT": "2020-06-03T03:48:52Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/bangonkali>@bangonkali</denchmark-link>\n  Thank you, we will add explicit padding support for all conv2d ops.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "bangonkali", "commentT": "2020-06-03T04:09:34Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/annxingyuan>@annxingyuan</denchmark-link>\n  I don't think our conv2d ops support explicit padding, they do allow a single number as pad, can it be expanded to support the TF spec? Thanks\n <denchmark-link:https://www.tensorflow.org/api_docs/python/tf/nn/conv2d>https://www.tensorflow.org/api_docs/python/tf/nn/conv2d</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "bangonkali", "commentT": "2020-06-03T11:33:22Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/pyu10055>@pyu10055</denchmark-link>\n  Sure I can work on that.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "bangonkali", "commentT": "2020-06-03T14:39:16Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/pyu10055>@pyu10055</denchmark-link>\n  Hey Ping, wanted to confirm, we just need to modify our tfjs-core conv API to accept  right?\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "bangonkali", "commentT": "2020-06-03T16:43:39Z", "comment_text": "\n \t\tI think so, the batch and channel padding are zeros anyway.\n \t\t"}}}, "commit": {"commit_id": "9b50644999ad343c0d3fafbd0b564c20310289d5", "commit_author": "Ann Yuan", "commitT": "2020-06-12 08:13:10-04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\kernel_names.ts", "file_new_name": "tfjs-core\\src\\kernel_names.ts", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "21,22,109,119,128", "deleted_lines": "107,117,126"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-core\\src\\ops\\conv1d.ts", "file_new_name": "tfjs-core\\src\\ops\\conv1d.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "57,58", "deleted_lines": "57", "method_info": {"method_name": ">", "method_params": "TensorLike,TensorLike,number,number,dilation", "method_startline": "55", "method_endline": "113"}}, "hunk_1": {"Ismethod": 1, "added_lines": "57,58", "deleted_lines": "57", "method_info": {"method_name": ">", "method_params": "TensorLike,TensorLike,number,ExplicitPadding,dilation", "method_startline": "55", "method_endline": "114"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\conv1d_test.ts", "file_new_name": "tfjs-core\\src\\ops\\conv1d_test.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "24", "method_endline": "42"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-core\\src\\ops\\conv2d.ts", "file_new_name": "tfjs-core\\src\\ops\\conv2d.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "64,65", "deleted_lines": "64", "method_info": {"method_name": ">", "method_params": "TensorLike,TensorLike,number,number,number,number,number", "method_startline": "62", "method_endline": "127"}}, "hunk_1": {"Ismethod": 1, "added_lines": "64,65", "deleted_lines": "64", "method_info": {"method_name": ">", "method_params": "TensorLike,TensorLike,number,number,ExplicitPadding,number,number", "method_startline": "62", "method_endline": "128"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-core\\src\\ops\\conv2d_backprop_filter.ts", "file_new_name": "tfjs-core\\src\\ops\\conv2d_backprop_filter.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "52,53", "deleted_lines": "52", "method_info": {"method_name": ">", "method_params": "T,T,number,number,number,number,number,number", "method_startline": "50", "method_endline": "109"}}, "hunk_1": {"Ismethod": 1, "added_lines": "52,53", "deleted_lines": "52", "method_info": {"method_name": ">", "method_params": "T,T,number,number,number,number,number,ExplicitPadding", "method_startline": "50", "method_endline": "110"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-core\\src\\ops\\conv2d_backprop_input.ts", "file_new_name": "tfjs-core\\src\\ops\\conv2d_backprop_input.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "56,57", "deleted_lines": "56", "method_info": {"method_name": ">", "method_params": "number,number,number,number,number,T,Tensor4D,number,number,ExplicitPadding", "method_startline": "53", "method_endline": "131"}}, "hunk_1": {"Ismethod": 1, "added_lines": "56,57", "deleted_lines": "56", "method_info": {"method_name": ">", "method_params": "number,number,number,number,number,T,Tensor4D,number,number,number", "method_startline": "53", "method_endline": "130"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\conv2d_test.ts", "file_new_name": "tfjs-core\\src\\ops\\conv2d_test.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "169", "method_endline": "187"}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "tfjs-core\\src\\ops\\conv_util.ts", "file_new_name": "tfjs-core\\src\\ops\\conv_util.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "137,138,159", "deleted_lines": "129,130,151", "method_info": {"method_name": "computeConv2DInfo", "method_params": "number,number,number,number,number,number,number,number,number,depthwise", "method_startline": "125", "method_endline": "184"}}, "hunk_1": {"Ismethod": 1, "added_lines": "410,411,412,413,414,415", "deleted_lines": "402,403,404,405", "method_info": {"method_name": "getPadAndOutInfo", "method_params": "number,number,number,number,number,number,number", "method_startline": "401", "method_endline": "437"}}, "hunk_2": {"Ismethod": 1, "added_lines": "410,411,412,413,414,415,443,444,445,446,447,448,449,450,451,452,453,454,455,456", "deleted_lines": null, "method_info": {"method_name": "getPadAndOutInfo", "method_params": "ExplicitPadding,number,number,number,number,number,number", "method_startline": "409", "method_endline": "461"}}, "hunk_3": {"Ismethod": 1, "added_lines": "137,138,159", "deleted_lines": "151", "method_info": {"method_name": "computeConv2DInfo", "method_params": "number,number,number,number,number,number,number,number,ExplicitPadding,depthwise", "method_startline": "133", "method_endline": "192"}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\fused_ops.ts", "file_new_name": "tfjs-core\\src\\ops\\fused_ops.ts", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "333", "deleted_lines": "333"}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\fused_test.ts", "file_new_name": "tfjs-core\\src\\ops\\fused_test.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "923,924,925,926,927,928,929,930,931,932,933,934,935,936,937,938,939,940,941,942", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "923", "method_endline": "942"}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-core\\src\\public\\chained_ops\\conv1d.ts", "file_new_name": "tfjs-core\\src\\public\\chained_ops\\conv1d.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "32,33,34", "deleted_lines": "31,32,33", "method_info": {"method_name": ">", "method_params": "TensorLike3D,number,ExplicitPadding,number", "method_startline": "31", "method_endline": "39"}}, "hunk_1": {"Ismethod": 1, "added_lines": "32,33,34", "deleted_lines": "31,32,33", "method_info": {"method_name": ">", "method_params": "TensorLike3D,number,number,number", "method_startline": "30", "method_endline": "38"}}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-node\\src\\nodejs_kernel_backend.ts", "file_new_name": "tfjs-node\\src\\nodejs_kernel_backend.ts", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "849,850,871,872,873,874,875,876,877,878,879,880,881,882", "deleted_lines": "849"}}}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-node\\src\\run_tests.ts", "file_new_name": "tfjs-node\\src\\run_tests.ts", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "76", "deleted_lines": null}}}}}}