{"BR": {"BR_id": "4125", "BR_author": "vladmandic", "BRopenT": "2020-10-24T18:03:42Z", "BRcloseT": "2020-10-27T16:43:46Z", "BR_text": {"BRsummary": "`tensorflowjs_convert` fails to convert `saved_models` when there are no explict `tags` set in model", "BRdescription": "\n tensorflowjs_convert fails to convert saved_models when there are no explicit tags set in model\n such models are working fine when loaded with loadSavedModel(), so it's not a model issue, but a converter issue\n and unfortunately, this is a common behavior for many models\n below is the output of tf.node.getMetaGraphsFromSavedModel() for one such model\n {\n   tags: [ [length]: 0 ],\n   signatureDefs: {\n     default: {\n       inputs: { images: { dtype: 'float32', tfDtype: 'DT_FLOAT', name: 'hub_input/image_tensor:0', shape: [ [Object], [Object], [Object], [Object], [length]: 4 ] } },\n       outputs: {\n         detection_boxes: { dtype: 'float32', tfDtype: 'DT_FLOAT', name: 'hub_input/strided_slice:0', shape: [ [Object], [Object], [length]: 2 ] },\n         detection_class_entities: { dtype: 'string', tfDtype: 'DT_STRING', name: 'hub_input/index_to_string_Lookup:0', shape: [ [Object], [Object], [length]: 2 ] },\n         detection_class_labels: { dtype: 'int32', tfDtype: 'DT_INT64', name: 'hub_input/strided_slice_2:0', shape: [ [Object], [Object], [length]: 2 ] },\n         detection_class_names: { dtype: 'string', tfDtype: 'DT_STRING', name: 'hub_input/index_to_string_1_Lookup:0', shape: [ [Object], [Object], [length]: 2 ] },\n         detection_scores: { dtype: 'float32', tfDtype: 'DT_FLOAT', name: 'hub_input/strided_slice_1:0', shape: [ [Object], [Object], [length]: 2 ] }\n       }\n     }\n   }\n }\n there are more than few affected models are on tfhub:\n \n https://tfhub.dev/google/openimages_v4/ssd/mobilenet_v2/1\n https://tfhub.dev/google/on_device_vision/classifier/popular_wine_V1/1\n https://tfhub.dev/google/on_device_vision/classifier/popular_us_products_V1/1\n https://tfhub.dev/metmuseum/vision/classifier/imet_attributes_V1/1\n \n Edit: converting model directly from tfhub.dev using tensorflowjs_converter --input_format tf_hub ... works!\n but when same model is downloaded locally, it cannot be converted due to missing tags\n environment: tfjs 2.6.0 on ubuntu 20.10\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "vladmandic", "commentT": "2020-10-26T21:20:45Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/vladmandic>@vladmandic</denchmark-link>\n  unfortunately TensorFlow python <denchmark-link:https://www.tensorflow.org/api_docs/python/tf/saved_model/load?hl=pl>tf.saved_model.load</denchmark-link>\n  does not support loading models without tags.\n It will throw errors for these TFHub models. What is the tags/signatures you are seeing with node.js?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "vladmandic", "commentT": "2020-10-26T21:25:35Z", "comment_text": "\n \t\tyou can see the tags/signature in the example i've posted above - tags are empty and signature is default\n but what's strange is that:\n \n tensorflowjs_convert --input_format tf_hub ... works\n tensorflowjs_convert --input_format tf_saved_model ... fails for the same model downloaded from tfhub\n \n and quite a few models on tfhub are like that (efficientdet, centernet, imet, us products, etc.)\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "vladmandic", "commentT": "2020-10-27T16:38:46Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/vladmandic>@vladmandic</denchmark-link>\n  I have a fix for this now, please set the saved_model_tags to empty string  when the saved model contains no tags, thanks.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "vladmandic", "commentT": "2020-10-27T16:43:46Z", "comment_text": "\n \t\tperfect!\n i see the fix is currently blocked from merge, but it should be resolved soon so i'm closing this issue.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "vladmandic", "commentT": "2020-10-27T16:43:48Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4125>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4125>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "282ac8185ef4558380050561b6339551d896dbac", "commit_author": "Ping Yu", "commitT": "2020-10-27 12:28:54-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-converter\\README.md", "file_new_name": "tfjs-converter\\README.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "155", "deleted_lines": "155"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-converter\\python\\tensorflowjs\\converters\\tf_saved_model_conversion_v2.py", "file_new_name": "tfjs-converter\\python\\tensorflowjs\\converters\\tf_saved_model_conversion_v2.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "495,496,497,498,499,500,501,502,503", "deleted_lines": null, "method_info": {"method_name": "_load_model", "method_params": "saved_model_dir,saved_model_tags", "method_startline": "495", "method_endline": "503"}}}}}}}