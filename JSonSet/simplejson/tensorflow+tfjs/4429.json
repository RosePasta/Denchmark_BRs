{"BR": {"BR_id": "4429", "BR_author": "vladmandic", "BRopenT": "2020-12-18T01:54:11Z", "BRcloseT": "2020-12-22T21:33:33Z", "BR_text": {"BRsummary": "tfjs 2.8.1 change in behavior in tf.reshape causes errors", "BRdescription": "\n upon upgrade from 2.7.0 to 2.8.1, my existing app fails with:\n <denchmark-code>Uncaught (in promise) Error: The implicit shape can't be a fractional number. Got 266 / 3\n     at Object.inferFromImplicitShape (util_base.ts:328)\n     at Object.reshape76 [as kernelFunc] (Reshape.ts:35)\n     at kernelFunc3 (engine.ts:590)\n     at engine.ts:660\n     at Engine.scopedRun (engine.ts:453)\n     at Engine.runKernelFunc (engine.ts:657)\n     at Engine.runKernel (engine.ts:522)\n     at reshape_ (reshape.ts:60)\n     at reshape__op (operation.ts:51)\n </denchmark-code>\n \n this may be desired behavior, but it breaks several existing models published on tfhub!\n e.g, i'm using blazeface where reshape is failing on results of model inference, so not like that can be changed easily:\n const [contours, confidence, contourCoords] = this.meshDetector.predict(face);\n const coordsReshaped = tf.reshape(contourCoords, [-1, 3]);\n let rawCoords = coordsReshaped.arraySync();\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "vladmandic", "commentT": "2020-12-18T02:05:06Z", "comment_text": "\n \t\tWhich backend has this behavior?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "vladmandic", "commentT": "2020-12-18T02:06:06Z", "comment_text": "\n \t\twebgl backend\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "vladmandic", "commentT": "2020-12-18T18:51:03Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/lina128>@lina128</denchmark-link>\n  I am also receiving this error after upgrading to 2.8.1 with webgl.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "vladmandic", "commentT": "2020-12-19T12:26:41Z", "comment_text": "\n \t\tSame thing here!\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "vladmandic", "commentT": "2020-12-19T20:38:06Z", "comment_text": "\n \t\tSame here! When trying to fetch face landmarks :\n const predictions = await model.estimateFaces({ input: video })\n Browser returns\n util_base.ts:328 Uncaught (in promise) Error: The implicit shape can't be a fractional number. Got 266 / 3\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "vladmandic", "commentT": "2020-12-20T01:23:02Z", "comment_text": "\n \t\tcc <denchmark-link:https://github.com/pyu10055>@pyu10055</denchmark-link>\n  <denchmark-link:https://github.com/annxingyuan>@annxingyuan</denchmark-link>\n  <denchmark-link:https://github.com/tafsiri>@tafsiri</denchmark-link>\n \n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "vladmandic", "commentT": "2020-12-20T01:35:38Z", "comment_text": "\n \t\tYup, I'm getting the same error as well! I still don't understand why demos like these <denchmark-link:https://mediapipe-facemesh-3js-tf2.glitch.me/>https://mediapipe-facemesh-3js-tf2.glitch.me/</denchmark-link>\n  work. I tried changing the version of my facemesh model but that doesn't do anything\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "vladmandic", "commentT": "2020-12-20T17:32:15Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/dewball345>@dewball345</denchmark-link>\n  because it's hard coded to load tfjs 2.4.0. anything up to 2.7.0 works fine, 2.8.0 and 2.8.1 don't.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "vladmandic", "commentT": "2020-12-20T17:56:08Z", "comment_text": "\n \t\tyeah i realized that now. A temporary fix would be to just use the older version of tensorflow?\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "vladmandic", "commentT": "2020-12-20T17:57:15Z", "comment_text": "\n \t\tI'm staying on 2.7.0 until this is resolved.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "vladmandic", "commentT": "2020-12-21T14:31:59Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/lina128>@lina128</denchmark-link>\n  - I ran a git bisect and it seems to be traceable to this PR: <denchmark-link:https://github.com/tensorflow/tfjs/pull/4187>#4187</denchmark-link>\n \n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "vladmandic", "commentT": "2020-12-21T21:47:15Z", "comment_text": "\n \t\tThanks for the bug report, we will release the fix in 2.8.2 next week.\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "vladmandic", "commentT": "2020-12-22T21:33:34Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4429>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4429>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "7693f4d487d534945cc5cec90c6e759de71e2797", "commit_author": "Na Li", "commitT": "2020-12-22 13:33:32-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-converter\\src\\executor\\graph_model.ts", "file_new_name": "tfjs-converter\\src\\executor\\graph_model.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "148,149,150,151,152,156,162", "deleted_lines": "144,145,146,147,148,149,158,180,181,182", "method_info": {"method_name": "loadSync", "method_params": "ModelArtifacts", "method_startline": "143", "method_endline": "182"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200", "method_info": {"method_name": "isOldVersion", "method_params": "string", "method_startline": "180", "method_endline": "200"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-converter\\src\\executor\\graph_model_test.ts", "file_new_name": "tfjs-converter\\src\\executor\\graph_model_test.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "324", "method_endline": "368"}}, "hunk_1": {"Ismethod": 1, "added_lines": "331,332,333", "deleted_lines": null, "method_info": {"method_name": "Int32Array", "method_params": "", "method_startline": "331", "method_endline": "333"}}}}}}}