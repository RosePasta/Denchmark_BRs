{"BR": {"BR_id": "881", "BR_author": "abhishekpratapa", "BRopenT": "2018-07-23T22:51:50Z", "BRcloseT": "2018-07-27T22:28:00Z", "BR_text": {"BRsummary": "Export to CoreML fails when using an arbitrary column name.", "BRdescription": "\n steps to repro\n >>  import turicreate as tc\n >>  style = tc.SFrame(\"style.sframe\")\n >>  style.show\n +------------------------+\n |                   x1                    |\n +------------------------+\n | Height: 375 Width: 500 |\n | Height: 375 Width: 500 | \n | Height: 334 Width: 500 | \n | Height: 500 Width: 345 | \n | Height: 480 Width: 500 |\n | Height: 375 Width: 500 |\n | Height: 335 Width: 500 |\n | Height: 335 Width: 500 |\n | Height: 500 Width: 333 |\n | Height: 333 Width: 500 |\n +------------------------+\n >>  content = tc.SFrame(\"content.sframe\")\n >>  content.show\n +------------------------+\n |                   x1                    |\n +------------------------+\n | Height: 375 Width: 500 |\n | Height: 375 Width: 500 | \n | Height: 334 Width: 500 | \n | Height: 500 Width: 345 | \n | Height: 480 Width: 500 |\n | Height: 375 Width: 500 |\n | Height: 335 Width: 500 |\n | Height: 335 Width: 500 |\n | Height: 500 Width: 333 |\n | Height: 333 Width: 500 |\n +------------------------+\n >>  model = tc.style_transfer.create(style, content)\n >>  model.export_coreml(\"ml_model.mlmodel\")\n Expected: Should work\n Actual:\n <denchmark-code>---------------------------------------------------------------------------\n MXNetError                                Traceback (most recent call last)\n <ipython-input-21-4315a9407892> in <module>()\n ----> 1 model.export_coreml(\"ml_model.mlmodel\")\n \n /Users/abhishekpratapa/turicreate/debug/src/unity/python/turicreate/toolkits/style_transfer/style_transfer.pyc in export_coreml(self, path, image_shape)\n     817         index_dim = (1, self.num_styles)\n     818         coreml_model = _mxnet_converter.convert(mod, input_shape=[(self.content_feature, image_shape), ('index', index_dim)],\n --> 819                         mode=None, preprocessor_args=None, builder=None, verbose=False)\n     820 \n     821         transformer.scale255 = False\n \n /Users/abhishekpratapa/turicreate/debug/src/unity/python/turicreate/toolkits/_mxnet_to_coreml/_mxnet_converter.py in convert(model, input_shape, class_labels, mode, preprocessor_args, builder, verbose)\n     179 \n     180     # Infer shapes and store in a dictionary\n --> 181     shapes = net.infer_shape(**dict(input_shape))\n     182     arg_names = net.list_arguments()\n     183     output_names = net.list_outputs()\n \n /Users/abhishekpratapa/turicreate/deps/env/lib/python2.7/site-packages/mxnet/symbol/symbol.pyc in infer_shape(self, *args, **kwargs)\n     987         \"\"\"\n     988         try:\n --> 989             res = self._infer_shape_impl(False, *args, **kwargs)\n     990             if res[1] is None:\n     991                 arg_shapes, _, _ = self._infer_shape_impl(True, *args, **kwargs)\n \n /Users/abhishekpratapa/turicreate/deps/env/lib/python2.7/site-packages/mxnet/symbol/symbol.pyc in _infer_shape_impl(self, partial, *args, **kwargs)\n    1117             ctypes.byref(aux_shape_ndim),\n    1118             ctypes.byref(aux_shape_data),\n -> 1119             ctypes.byref(complete)))\n    1120         if complete.value != 0:\n    1121             arg_shapes = [\n \n /Users/abhishekpratapa/turicreate/deps/env/lib/python2.7/site-packages/mxnet/base.pyc in check_call(ret)\n     144     \"\"\"\n     145     if ret != 0:\n --> 146         raise MXNetError(py_str(_LIB.MXGetLastError()))\n     147 \n     148 \n \n MXNetError: [15:41:01] src/c_api/c_api_symbolic.cc:422: InferShapeKeyword argument name X1 not found.\n Candidate arguments:\n \t[0]image\n \t[1]transformer_conv0_weight\n \t[2]index\n \t[3]transformer_instancenorm0_embedding0_weight\n \t[4]transformer_instancenorm0_embedding1_weight\n \t[5]transformer_conv1_weight\n \t[6]transformer_instancenorm1_embedding0_weight\n \t[7]transformer_instancenorm1_embedding1_weight\n \t[8]transformer_conv2_weight\n \t[9]transformer_instancenorm2_embedding0_weight\n \t[10]transformer_instancenorm2_embedding1_weight\n \t[11]transformer_residualblock0_conv0_weight\n \t[12]transformer_residualblock0_instancenorm0_embedding0_weight\n \t[13]transformer_residualblock0_instancenorm0_embedding1_weight\n \t[14]transformer_residualblock0_conv1_weight\n \t[15]transformer_residualblock0_instancenorm1_embedding0_weight\n \t[16]transformer_residualblock0_instancenorm1_embedding1_weight\n \t[17]transformer_residualblock1_conv0_weight\n \t[18]transformer_residualblock1_instancenorm0_embedding0_weight\n \t[19]transformer_residualblock1_instancenorm0_embedding1_weight\n \t[20]transformer_residualblock1_conv1_weight\n \t[21]transformer_residualblock1_instancenorm1_embedding0_weight\n \t[22]transformer_residualblock1_instancenorm1_embedding1_weight\n \t[23]transformer_residualblock2_conv0_weight\n \t[24]transformer_residualblock2_instancenorm0_embedding0_weight\n \t[25]transformer_residualblock2_instancenorm0_embedding1_weight\n \t[26]transformer_residualblock2_conv1_weight\n \t[27]transformer_residualblock2_instancenorm1_embedding0_weight\n \t[28]transformer_residualblock2_instancenorm1_embedding1_weight\n \t[29]transformer_residualblock3_conv0_weight\n \t[30]transformer_residualblock3_instancenorm0_embedding0_weight\n \t[31]transformer_residualblock3_instancenorm0_embedding1_weight\n \t[32]transformer_residualblock3_conv1_weight\n \t[33]transformer_residualblock3_instancenorm1_embedding0_weight\n \t[34]transformer_residualblock3_instancenorm1_embedding1_weight\n \t[35]transformer_residualblock4_conv0_weight\n \t[36]transformer_residualblock4_instancenorm0_embedding0_weight\n \t[37]transformer_residualblock4_instancenorm0_embedding1_weight\n \t[38]transformer_residualblock4_conv1_weight\n \t[39]transformer_residualblock4_instancenorm1_embedding0_weight\n \t[40]transformer_residualblock4_instancenorm1_embedding1_weight\n \t[41]transformer_conv3_weight\n \t[42]transformer_instancenorm3_embedding0_weight\n \t[43]transformer_instancenorm3_embedding1_weight\n \t[44]transformer_conv4_weight\n \t[45]transformer_instancenorm4_embedding0_weight\n \t[46]transformer_instancenorm4_embedding1_weight\n \t[47]transformer_conv5_weight\n \t[48]transformer_instancenorm5_embedding0_weight\n \t[49]transformer_instancenorm5_embedding1_weight\n \n \n Stack trace returned 5 entries:\n [bt] (0) 0   libmxnet.so                         0x0000000118bb22cf libmxnet.so + 58063\n [bt] (1) 1   libmxnet.so                         0x0000000118bb206f libmxnet.so + 57455\n [bt] (2) 2   libmxnet.so                         0x0000000119b46362 MXSymbolInferShape + 9154\n [bt] (3) 3   libmxnet.so                         0x0000000119b447d5 MXSymbolInferShape + 2101\n [bt] (4) 4   libffi.dylib                        0x00007fff6459cf64 ffi_call_unix64 + 76\n \n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "abhishekpratapa", "commentT": "2018-07-25T01:03:31Z", "comment_text": "\n \t\tThank you for reporting <denchmark-link:https://github.com/abhishekpratapa>@abhishekpratapa</denchmark-link>\n ,\n Should be fixed by <denchmark-link:https://github.com/apple/turicreate/pull/892>#892</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "0c925cd10a49bd9ae60bbdee19c29a5481aebb09", "commit_author": "Shreyas Joshi", "commitT": "2018-07-27 15:27:59-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\unity\\python\\turicreate\\test\\test_style_transfer.py", "file_new_name": "src\\unity\\python\\turicreate\\test\\test_style_transfer.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "70,71", "deleted_lines": "70", "method_info": {"method_name": "setUpClass", "method_params": "self", "method_startline": "66", "method_endline": "83"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\unity\\python\\turicreate\\toolkits\\style_transfer\\style_transfer.py", "file_new_name": "src\\unity\\python\\turicreate\\toolkits\\style_transfer\\style_transfer.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "673", "deleted_lines": "673", "method_info": {"method_name": "stylize", "method_params": "self,images,style,verbose,max_size,batch_size", "method_startline": "553", "method_endline": "746"}}, "hunk_1": {"Ismethod": 1, "added_lines": "793,802,804", "deleted_lines": "793,802,804", "method_info": {"method_name": "export_coreml", "method_params": "self,path,image_shape,256", "method_startline": "762", "method_endline": "850"}}}}}}}