{"BR": {"BR_id": "279", "BR_author": "chrockey", "BRopenT": "2020-12-17T09:02:08Z", "BRcloseT": "2020-12-25T03:58:04Z", "BR_text": {"BRsummary": "\"Union function\" returns wrong outputs when it is used with \"MinkowskiGenerativeConvolutionTranspose\"", "BRdescription": "\n Hi,\n I found that MinkowskiUnion returns a little bit wrong output when it merges coordinate_map_key generated by MinkowskiGenerativeConvolutionTranspose.\n Here is my test code.\n <denchmark-code>  5 def test_kernel_map():                                                                                                                                                                                                                                                                \n   6     ME.set_sparse_tensor_operation_mode(ME.SparseTensorOperationMode.SHARE_COORDINATE_MANAGER)                                                                                                                                                                                        \n   7     device = torch.device('cuda')                                                                                                                                                                                                                                                     \n   8                                                                                                                                                                                                                                                                                       \n   9     A = ME.SparseTensor(                                                                                                                                                                                                                                                              \n  10             features=torch.FloatTensor([[1]]),                                                                                                                                                                                                                                        \n  11             coordinates=torch.IntTensor([[0, 0, 0, 0]]),                                                                                                                                                                                                                              \n  12             tensor_stride=2,                                                                                                                                                                                                                                                          \n  13             device=device                                                                                                                                                                                                                                                             \n  14         )                                                                                                                                                                                                                                                                             \n  15     B = ME.SparseTensor(                                                                                                                                                                                                                                                              \n  16             features=torch.FloatTensor([[2], [2]]),                                                                                                                                                                                                                                   \n  17             coordinates=torch.IntTensor([[0, 1, 1, 1], [0, 100, 0, 0]]),                                                                                                                                                                                                              \n  18             device=device                                                                                                                                                                                                                                                             \n  19         )                                                                                                                                                                                                                                                                             \n  20     gconvtr = ME.MinkowskiGenerativeConvolutionTranspose(in_channels=1,                                                                                                                                                                                                               \n  21                                                          out_channels=1,                                                                                                                                                                                                              \n  22                                                          kernel_size=3,                                                                                                                                                                                                               \n  23                                                          stride=2,                                                                                                                                                                                                                    \n  24                                                          dimension=3).to(device)                                                                                                                                                                                                      \n  25     union = ME.MinkowskiUnion()                                                                                                                                                                                                                                                       \n  26     cm = A.coordinate_manager                                                                                                                                                                                                                                                         \n  27     A_tr = gconvtr(A)                                                                                                                                                                                                                                                                 \n  28     A_tr = union(A_tr, B)                                                                                                                                                                                                                                                              \n  29     print(A_tr.C)\n </denchmark-code>\n \n [0, 100, 0, 0] is not included in the output coordinate.\n However the size of output coordinate map is 28, which is correct.\n The reason why the size is correct although [0, 100, 0, 0] is not included is that there is a duplicated coordinate [0, 0, -1 ,-1].\n I searched for why this happened but failed :( ...\n \t"}, "comments": {}}, "commit": {"commit_id": "5cea6df2b896bf4ee51a35630d946407e59ee1e4", "commit_author": "chrischoy", "commitT": "2020-12-25 12:59:50+09:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "README.md", "file_new_name": "README.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "12,16", "deleted_lines": "15"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\coordinate_map_gpu.cu", "file_new_name": "src\\coordinate_map_gpu.cu", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "937,938,939,940,941,942,943,944,945,946,947,948,949,950,951,952,953,954,955,956,957,958,959,960,961,962,963,964,965,966,967,968,969,996,1013,1014,1015,1016,1017,1018,1019,1020,1021,1022,1024,1028,1037,1053", "deleted_lines": "89,90,98,99,100,101,102,103,104,989,1016"}}}}}}