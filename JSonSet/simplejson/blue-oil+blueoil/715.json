{"BR": {"BR_id": "715", "BR_author": "kalpitthakkar-lm", "BRopenT": "2020-01-09T07:40:52Z", "BRcloseT": "2020-01-10T02:36:32Z", "BR_text": {"BRsummary": "TF1.15.0 has AddV2, TF1.14.0 had Add - compiler throws error", "BRdescription": "\n Hello!\n So I have set up blueoil from a recent commit - the tensorflow version in the requirements file has been updated to 1.15.0 from 1.14.0, which was there in the past.\n Blueoil build completed and I started setting up CIFAR10 classification to be run using Blueoil. I chose to run the Quantized Resnet model from the choices offered by the Blueoil config prompts. I was able to run the training successfully and the trained model was ready to be compiled so that I can run it on DE-10 Nano.\n However, when compiling the model for FPGA, I got the following error:\n <denchmark-code>Traceback (most recent call last):\n   File \"/home/blueoil/dlk/python/dlk/plugins/tf.py\", line 576, in create_new_node\n     class_def = getattr(module, op_type)\n AttributeError: module 'core.operators' has no attribute 'AddV2'\n </denchmark-code>\n \n Turns out, TF1.15.0 uses 'AddV2' to label the add operation while TF1.14.0 used 'Add'.\n To confirm this I ran a bunch of python commands (Egashira-san helped me with this):\n <denchmark-code>import tensorflow as tf\n x = tf.constant([0.])\n y = tf.constant([1.])\n z = x + y\n graph = tf.get_default_graph()\n for op in graph.get_operators():\n     print(op.name, op.type, op.op_def)\n </denchmark-code>\n \n The outputs for different versions of tensorflow are shown below:\n <denchmark-code># TF 1.15.0\n Const Const name: \"Const\"\n output_arg {\n   name: \"output\"\n   type_attr: \"dtype\"\n }\n attr {\n   name: \"value\"\n   type: \"tensor\"\n }\n attr {\n   name: \"dtype\"\n   type: \"type\"\n }\n \n Const_1 Const name: \"Const\"\n output_arg {\n   name: \"output\"\n   type_attr: \"dtype\"\n }\n attr {\n   name: \"value\"\n   type: \"tensor\"\n }\n attr {\n   name: \"dtype\"\n   type: \"type\"\n }\n \n add AddV2 name: \"AddV2\"\n input_arg {\n   name: \"x\"\n   type_attr: \"T\"\n }\n input_arg {\n   name: \"y\"\n   type_attr: \"T\"\n }\n output_arg {\n   name: \"z\"\n   type_attr: \"T\"\n }\n attr {\n   name: \"T\"\n   type: \"type\"\n   allowed_values {\n     list {\n       type: DT_BFLOAT16\n       type: DT_HALF\n       type: DT_FLOAT\n       type: DT_DOUBLE\n       type: DT_UINT8\n       type: DT_INT8\n       type: DT_INT16\n       type: DT_INT32\n       type: DT_INT64\n       type: DT_COMPLEX64\n       type: DT_COMPLEX128\n     }\n   }\n }\n </denchmark-code>\n \n <denchmark-code># TF 1.14.0\n Const Const name: \"Const\"\n output_arg {\n   name: \"output\"\n   type_attr: \"dtype\"\n }\n attr {\n   name: \"value\"\n   type: \"tensor\"\n }\n attr {\n   name: \"dtype\"\n   type: \"type\"\n }\n \n Const_1 Const name: \"Const\"\n output_arg {\n   name: \"output\"\n   type_attr: \"dtype\"\n }\n attr {\n   name: \"value\"\n   type: \"tensor\"\n }\n attr {\n   name: \"dtype\"\n   type: \"type\"\n }\n \n add Add name: \"Add\"\n input_arg {\n   name: \"x\"\n   type_attr: \"T\"\n }\n input_arg {\n   name: \"y\"\n   type_attr: \"T\"\n }\n output_arg {\n   name: \"z\"\n   type_attr: \"T\"\n }\n attr {\n   name: \"T\"\n   type: \"type\"\n   allowed_values {\n     list {\n       type: DT_BFLOAT16\n       type: DT_HALF\n       type: DT_FLOAT\n       type: DT_DOUBLE\n       type: DT_UINT8\n       type: DT_INT8\n       type: DT_INT16\n       type: DT_INT32\n       type: DT_INT64\n       type: DT_COMPLEX64\n       type: DT_COMPLEX128\n       type: DT_STRING\n     }\n   }\n }\n </denchmark-code>\n \n Please let me know what should be done to proceed.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "kalpitthakkar-lm", "commentT": "2020-01-09T07:45:44Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/kalpitthakkar-lm>@kalpitthakkar-lm</denchmark-link>\n \n Thanks.\n This is the bug.\n I think it's can be fixed like <denchmark-link:https://github.com/blue-oil/blueoil/pull/695>#695</denchmark-link>\n  .\n Do you have a time to fix?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "kalpitthakkar-lm", "commentT": "2020-01-09T07:49:14Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/iizukak>@iizukak</denchmark-link>\n  Yes I can fix it. I will follow PR <denchmark-link:https://github.com/blue-oil/blueoil/pull/695>#695</denchmark-link>\n  and submit a new PR for the bug fix, along with the updated status on compilation for FPGA of my TF1.15.0 QuantizedResnet model.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "kalpitthakkar-lm", "commentT": "2020-01-10T02:36:31Z", "comment_text": "\n \t\tThe mapping has been added by PR <denchmark-link:https://github.com/blue-oil/blueoil/pull/717>#717</denchmark-link>\n . Closing this issue.\n \t\t"}}}, "commit": {"commit_id": "808385e01591345de0b086bc9ea99a8bfdec5b32", "commit_author": "Kalpit Thakkar - LeapMind", "commitT": "2020-01-10 02:11:05+00:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "dlk\\python\\dlk\\plugins\\tf.py", "file_new_name": "dlk\\python\\dlk\\plugins\\tf.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "86", "deleted_lines": null}}}}}}