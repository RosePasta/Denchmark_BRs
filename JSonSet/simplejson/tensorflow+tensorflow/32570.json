{"BR": {"BR_id": "32570", "BR_author": "neonrights", "BRopenT": "2019-09-17T01:59:08Z", "BRcloseT": "2019-09-27T16:34:11Z", "BR_text": {"BRsummary": "Assertion error when using mask with unrolled stacked LSTM", "BRdescription": "\n Please make sure that this is a bug. As per our GitHub Policy, we only address code/doc bugs, performance issues, feature requests and build/installation issues on GitHub. tag:bug_template\n System information\n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow):\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10\n Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: n/a\n TensorFlow installed from (source or binary): source\n TensorFlow version (use command below): 1.14\n Python version: 3.6\n Bazel version (if compiling from source): n/a\n GCC/Compiler version (if compiling from source): n/a\n CUDA/cuDNN version: n/a\n GPU model and memory: no GPU, 32 GB ram\n \n You can collect some of this information using our environment capture\n <denchmark-link:https://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh>script</denchmark-link>\n \n You can also obtain the TensorFlow version with: 1. TF 1.0:  2. TF 2.0: \n Describe the current behavior\n I receive an assertion error when creating a forward pass for an unrolled multi-layer LSTM while using a mask.\n Describe the expected behavior\n No assertion error, or at least a better explanation as to the cause.\n Code to reproduce the issue\n import tensorflow as tf\n \n inputs = tf.placeholder(tf.float32, (3,4,5))\n mask = tf.placeholder(tf.bool, (3,4))\n \n single_cells = [tf.keras.layer.LSTMCell(10) for _ in range(3)]\n multi_cell = tf.keras.layers.StackedRNNCell(cells=single_cells)\n lstm = tf.keras.layers.RNN(cell=multi_cell, unroll=True)\n output, state = lstm(inputs=inputs, mask=mask)  # <- assertion error occurs here\n Other info / logs\n Include any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "neonrights", "commentT": "2019-09-17T10:03:33Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/neonrights>@neonrights</denchmark-link>\n \n I tried in colab with TF version 1.14 and 1.15.0-rc0 and i am getting the below error . I am attaching the <denchmark-link:https://colab.sandbox.google.com/gist/ravikyram/9603c7f3d9814aa73513ef4db56f94b0/untitled193.ipynb>gist </denchmark-link>\n for your reference. Thanks!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "neonrights", "commentT": "2019-09-17T19:06:52Z", "comment_text": "\n \t\tSorry I have a typo in my code, try this instead\n import tensorflow as tf\n \n inputs = tf.placeholder(tf.float32, (3,4,5))\n mask = tf.placeholder(tf.bool, (3,4))\n \n single_cells = [tf.keras.layers.LSTMCell(10) for _ in range(3)]\n multi_cell = tf.keras.layers.StackedRNNCells(cells=single_cells)\n lstm = tf.keras.layers.RNN(cell=multi_cell, unroll=True)\n output, state = lstm(inputs=inputs, mask=mask)  # <- assertion error occurs here\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "neonrights", "commentT": "2019-09-18T08:57:53Z", "comment_text": "\n \t\tI have tried on colab with TF version 1.14 ,1.15.0-rc0 and was able to reproduce the issue.Please, find the gist <denchmark-link:https://colab.sandbox.google.com/gist/ravikyram/e202ba52a64cfd2a3fb1f51bd50f9b67/untitled200.ipynb>here</denchmark-link>\n .Thanks!\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "neonrights", "commentT": "2019-09-27T16:34:12Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=32570>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=32570>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "4d011793076f6c62a560085b8fe03fbf732d67e6", "commit_author": "Scott Zhu", "commitT": "2019-09-25 14:16:57-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\python\\keras\\backend.py", "file_new_name": "tensorflow\\python\\keras\\backend.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "3909,3910,3911,3912", "deleted_lines": "3909,3910", "method_info": {"method_name": "_expand_mask", "method_params": "mask_t,input_t,fixed_dim", "method_startline": "3908", "method_endline": "3917"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "tensorflow\\python\\keras\\layers\\lstm_test.py", "file_new_name": "tensorflow\\python\\keras\\layers\\lstm_test.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "152,153,160,161", "deleted_lines": "151,158", "method_info": {"method_name": "test_masking_with_stacking_LSTM", "method_params": "self", "method_startline": "151", "method_endline": "164"}}, "hunk_1": {"Ismethod": 1, "added_lines": "137,144", "deleted_lines": "143", "method_info": {"method_name": "test_with_masking_layer_LSTM", "method_params": "self,unroll", "method_startline": "137", "method_endline": "150"}}, "hunk_2": {"Ismethod": 1, "added_lines": "136,137,144", "deleted_lines": "136,143", "method_info": {"method_name": "test_with_masking_layer_LSTM", "method_params": "self", "method_startline": "136", "method_endline": "149"}}, "hunk_3": {"Ismethod": 1, "added_lines": "153,160,161", "deleted_lines": "158", "method_info": {"method_name": "test_masking_with_stacking_LSTM", "method_params": "self,unroll", "method_startline": "153", "method_endline": "167"}}}}}}}