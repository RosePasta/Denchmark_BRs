{"BR": {"BR_id": "13558", "BR_author": "yaroslavvb", "BRopenT": "2017-10-07T23:40:22Z", "BRcloseT": "2018-01-03T19:31:07Z", "BR_text": {"BRsummary": "segfaults in GPU tf.matrix_inverse", "BRdescription": "\n I'm running into segfaults in tf.matrix_inverse\n I'm adding identity*0.001 so matrices should be invertible, and same procedure works fine in numpy and in TensorFlow CPU version.\n <denchmark-link:https://github.com/yaroslavvb/stuff/blob/master/inverse_segfault.py>https://github.com/yaroslavvb/stuff/blob/master/inverse_segfault.py</denchmark-link>\n \n \n This non-deterministically crashes after 1-2 seconds with various backtraces.\n IE\n <denchmark-code>#0  0x0000000000000001 in ?? ()\n #1  0x00007fe90ed9c652 in tensorflow::Tensor::TotalBytes() const ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/../libtensorflow_framework.so\n #2  0x00007fe90ed9c7d6 in tensorflow::Tensor::tensor_data() const ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/../libtensorflow_framework.so\n #3  0x00007fe9137adda3 in bool tensorflow::internal::TransposeUsingTile<unsigned int>(Eigen::GpuDevice const&, tensorflow::Tensor const&, tensorflow::gtl::ArraySlice<int>, tensorflow::Tensor*) ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/_pywrap_tensorflow_internal.so\n #4  0x00007fe9137a696c in tensorflow::Status tensorflow::DoTranspose<Eigen::GpuDevice>(Eigen::GpuDevice const&, tensorflow::Tensor const&, tensorflow::gtl::ArraySlice<int>, tensorflow::Tensor*) ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/_pywrap_tensorflow_internal.so\n #5  0x00007fe911ada0fd in tensorflow::SvdOpGpu<float>::PerformSVD_MgeqN(tensorflow::OpKernelContext*, std::function<void ()>, long long, long long, long long, tensorflow::gtl::ArraySlice<int> const&, tensorflow::Tensor const&, tensorflow::Tensor*, tensorflow::Tensor*, tensorflow::Tensor*) ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/_pywrap_tensorflow_internal.so\n #6  0x00007fe911ade897 in tensorflow::SvdOpGpu<float>::ComputeAsync(tensorflow::OpKernelContext*, std::function<void ()>) ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/_pywrap_tensorflow_internal.so\n #7  0x00007fe90f20790b in tensorflow::BaseGPUDevice::ComputeAsync(tensorflow::AsyncOpKernel*, tensorflow::OpKernelContext*, std::function<void ()>) ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/../libtensorflow_framework.so\n #8  0x00007fe90f23cf37 in tensorflow::(anonymous namespace)::ExecutorState::Process(tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long)\n     ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/../libtensorflow_framework.so\n </denchmark-code>\n \n or this\n <denchmark-code>#0  0x00007fa89090686a in ?? () from /usr/lib/x86_64-linux-gnu/libcuda.so.1\n #1  0x00007fa89091b074 in ?? () from /usr/lib/x86_64-linux-gnu/libcuda.so.1\n #2  0x00007fa890826e2c in ?? () from /usr/lib/x86_64-linux-gnu/libcuda.so.1\n #3  0x00007fa890978880 in cuLaunchKernel ()\n    from /usr/lib/x86_64-linux-gnu/libcuda.so.1\n #4  0x00007fa891bf1dc1 in ?? () from /usr/local/cuda/lib64/libcusolver.so.8.0\n #5  0x00007fa891c0f9cd in ?? () from /usr/local/cuda/lib64/libcusolver.so.8.0\n #6  0x00007fa891aa1132 in ?? () from /usr/local/cuda/lib64/libcusolver.so.8.0\n #7  0x00007fa891aa2b72 in ?? () from /usr/local/cuda/lib64/libcusolver.so.8.0\n #8  0x00007fa891aa32e3 in ?? () from /usr/local/cuda/lib64/libcusolver.so.8.0\n #9  0x00007fa891aa36fa in ?? () from /usr/local/cuda/lib64/libcusolver.so.8.0\n #10 0x00007fa89190f5f3 in ?? () from /usr/local/cuda/lib64/libcusolver.so.8.0\n #11 0x00007fa891912375 in ?? () from /usr/local/cuda/lib64/libcusolver.so.8.0\n #12 0x00007fa89aa82c50 in tensorflow::Status tensorflow::CudaSolver::Getrf<float>(int, int, float*, int, int*, int*) ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/_pywrap_tensorflow_internal.so\n #13 0x00007fa89a55f5d6 in tensorflow::MatrixInverseOpGpu<float>::ComputeAsync(tensorflow::OpKernelContext*, std::function<void ()>) ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/_pywrap_tensorflow_internal.so\n #14 0x00007fa897dce90b in tensorflow::BaseGPUDevice::ComputeAsync(tensorflow::AsyncOpKernel*, tensorflow::OpKernelContext*, std::function<void ()>) ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/../libtensorflow_framework.so\n #15 0x00007fa897e03f37 in tensorflow::(anonymous namespace)::ExecutorState::Process(tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long)\n     ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/../libtensorflow_framework.so\n #16 0x00007fa897df1ec5 in std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (tensorflow::(anonymous namespace)::ExecutorState::*)(tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long)> (tensorflow::(anonymous namespace)::ExecutorState*, tensorflow::(anonymous namespace)::ExecutorState::TaggedNode, long long)> >::_M_invoke(std::_Any_data const&) ()\n    from /home/yaroslav/anaconda3/envs/oct10/lib/python3.5/site-packages/tensorflow/python/../libtensorflow_framework.so\n \n </denchmark-code>\n \n TensorFlow commit: <denchmark-link:https://github.com/tensorflow/tensorflow/commit/22a886b>22a886b</denchmark-link>\n \n NVIDIA-SMI 381.09\n libcudart.so.8.0.44\n libcudnn.so.6.0.21\n Nvidia GTX 1080\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "yaroslavvb", "commentT": "2017-10-09T07:09:42Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/rmlarsen>@rmlarsen</denchmark-link>\n  : Would you have some cycles to look into this?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "yaroslavvb", "commentT": "2017-12-20T01:11:21Z", "comment_text": "\n \t\tIt has been 14 days with no activity and the awaiting tensorflower label was assigned. Please update the label and/or status accordingly.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "yaroslavvb", "commentT": "2018-01-03T19:04:31Z", "comment_text": "\n \t\tIt has been 14 days with no activity and the awaiting tensorflower label was assigned. Please update the label and/or status accordingly.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "yaroslavvb", "commentT": "2018-01-03T19:31:07Z", "comment_text": "\n \t\tFrom the comment on the PR, it looks like the mutex was added.\n \t\t"}}}, "commit": {"commit_id": "3629fc4e98254c37e614ac3f77fa250b75c70f8d", "commit_author": "codrut3", "commitT": "2017-12-28 17:38:27-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\core\\kernels\\matrix_inverse_op.cc", "file_new_name": "tensorflow\\core\\kernels\\matrix_inverse_op.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "213", "deleted_lines": "213", "method_info": {"method_name": "tensorflow::MatrixInverseOpGpu::ComputeAsync", "method_params": "context,done", "method_startline": "98", "method_endline": "263"}}}}}}}