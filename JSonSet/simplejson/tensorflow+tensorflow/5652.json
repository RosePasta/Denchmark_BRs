{"BR": {"BR_id": "5652", "BR_author": "ptrendx", "BRopenT": "2016-11-16T23:32:51Z", "BRcloseT": "2017-02-27T22:44:53Z", "BR_text": {"BRsummary": "cifar10_multi_gpu_train.py breaks with more than 1 GPU", "BRdescription": "\n <denchmark-h:h3>Environment info</denchmark-h>\n \n Operating System: Ubuntu\n Installed version of CUDA and cuDNN: 8.0 and 5\n \n The commit hash (git rev-parse HEAD): 3d41cf7\n The output of bazel version:\n Build label: 0.3.2\n Build target: bazel-out/local-fastbuild/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar\n Build time: Fri Oct 7 17:25:10 2016 (1475861110)\n Build timestamp: 1475861110\n Build timestamp as int: 1475861110\n \n <denchmark-h:h3>If possible, provide a minimal reproducible example (We usually don't have time to read hundreds of lines of your code)</denchmark-h>\n \n python cifar10_multi_gpu_train.py --num_gpus=2\n Both cifar10_train.py and cifar10_multi_gpu_train.py (without specifying num_gpus, so running on a single GPU) work.\n <denchmark-h:h3>Logs or other output that would be helpful</denchmark-h>\n \n I tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcublas.so locally\n I tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcudnn.so locally\n I tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcufft.so locally\n I tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcuda.so.1 locally\n I tensorflow/stream_executor/dso_loader.cc:128] successfully opened CUDA library libcurand.so locally\n Filling queue with 20000 CIFAR images before starting to train. This will take a few minutes.\n Filling queue with 20000 CIFAR images before starting to train. This will take a few minutes.\n Traceback (most recent call last):\n File \"cifar10_multi_gpu_train.py\", line 280, in \n tf.app.run()\n File \"/data/github/tensorflow/_python_build/tensorflow/python/platform/app.py\", line 43, in run\n sys.exit(main(sys.argv[:1] + flags_passthrough))\n File \"cifar10_multi_gpu_train.py\", line 276, in main\n train()\n File \"cifar10_multi_gpu_train.py\", line 180, in train\n loss = tower_loss(scope)\n File \"cifar10_multi_gpu_train.py\", line 92, in tower_loss\n loss_averages_op = loss_averages.apply(losses + [total_loss])\n File \"/data/github/tensorflow/_python_build/tensorflow/python/training/moving_averages.py\", line 391, in apply\n self._averages[var], var, decay, zero_debias=zero_debias))\n File \"/data/github/tensorflow/_python_build/tensorflow/python/training/moving_averages.py\", line 70, in assign_moving_average\n update_delta = _zero_debias(variable, value, decay)\n File \"/data/github/tensorflow/_python_build/tensorflow/python/training/moving_averages.py\", line 177, in _zero_debias\n trainable=False)\n File \"/data/github/tensorflow/_python_build/tensorflow/python/ops/variable_scope.py\", line 1024, in get_variable\n custom_getter=custom_getter)\n File \"/data/github/tensorflow/_python_build/tensorflow/python/ops/variable_scope.py\", line 850, in get_variable\n custom_getter=custom_getter)\n File \"/data/github/tensorflow/_python_build/tensorflow/python/ops/variable_scope.py\", line 346, in get_variable\n validate_shape=validate_shape)\n File \"/data/github/tensorflow/_python_build/tensorflow/python/ops/variable_scope.py\", line 331, in _true_getter\n caching_device=caching_device, validate_shape=validate_shape)\n File \"/data/github/tensorflow/_python_build/tensorflow/python/ops/variable_scope.py\", line 650, in _get_single_variable\n \"VarScope?\" % name)\n ValueError: Variable tower_1/tower_1/conv1/weight_loss/avg/biased does not exist, or was not created with tf.get_variable(). Did you mean to set reuse=None in VarScope?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ptrendx", "commentT": "2016-11-17T19:01:09Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/shlens>@shlens</denchmark-link>\n  Could you take a look?  Scopes have been fiddled with recently, and maybe this file didn't get updated?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ptrendx", "commentT": "2017-02-27T22:44:52Z", "comment_text": "\n \t\tThis was fixed in November.\n \t\t"}}}, "commit": {"commit_id": "1b531b9d88361a3b8506399d5edae155125c5371", "commit_author": "A. Unique TensorFlower", "commitT": "2016-11-18 13:07:30-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\models\\image\\cifar10\\cifar10_multi_gpu_train.py", "file_new_name": "tensorflow\\models\\image\\cifar10\\cifar10_multi_gpu_train.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "96", "deleted_lines": "90,91,92,93", "method_info": {"method_name": "tower_loss", "method_params": "scope", "method_startline": "65", "method_endline": "98"}}}}}}}