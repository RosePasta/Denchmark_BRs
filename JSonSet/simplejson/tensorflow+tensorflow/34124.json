{"BR": {"BR_id": "34124", "BR_author": "VoVAllen", "BRopenT": "2019-11-09T16:07:33Z", "BRcloseT": "2019-11-14T13:07:11Z", "BR_text": {"BRsummary": "[Docs] Doc example of DeviceSpec doesn't work with tf 2.0", "BRdescription": "\n Doc link: <denchmark-link:https://www.tensorflow.org/api_docs/python/tf/DeviceSpec>https://www.tensorflow.org/api_docs/python/tf/DeviceSpec</denchmark-link>\n \n import tensorflow as tf\n device_spec = tf.DeviceSpec(job=\"ps\", device_type=\"CPU\", device_index=0)\n with tf.device(device_spec):\n   pass\n Got error:\n <denchmark-code>---------------------------------------------------------------------------\n KeyError                                  Traceback (most recent call last)\n /usr/local/lib/python3.6/dist-packages/tensorflow_core/python/eager/context.py in __enter__(self)\n    1508     try:\n -> 1509       new_device_name, new_device_spec = _device_parsing_cache[cache_key]\n    1510     except TypeError:\n \n KeyError: ('', <tensorflow.python.framework.device_spec.DeviceSpecV2 object at 0x7f34c74de528>)\n \n During handling of the above exception, another exception occurred:\n \n ValueError                                Traceback (most recent call last)\n 1 frames\n /usr/local/lib/python3.6/dist-packages/tensorflow_core/python/eager/context.py in __enter__(self)\n    1517         if not isinstance(new_device_name, six.string_types):\n    1518           raise ValueError(\"Expecting a string device name. Got %s(%s)\" %\n -> 1519                            (type(new_device_name), new_device_name))\n    1520         device_spec = pydev.DeviceSpec.from_string(new_device_name)\n    1521         if old_device_name:\n \n ValueError: Expecting a string device name. Got <class 'tensorflow.python.framework.device_spec.DeviceSpecV2'>(<tensorflow.python.framework.device_spec.DeviceSpecV2 object at 0x7f34c74de528>)\n </denchmark-code>\n \n System information\n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow):\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): 16.04\n Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\n TensorFlow installed from (source or binary): 2.0.0\n TensorFlow version (use command below):\n Python version:\n Bazel version (if compiling from source):\n GCC/Compiler version (if compiling from source):\n CUDA/cuDNN version:\n GPU model and memory:\n \n You can collect some of this information using our environment capture\n <denchmark-link:https://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh>script</denchmark-link>\n \n You can also obtain the TensorFlow version with: 1. TF 1.0:  2. TF 2.0: \n Describe the current behavior\n Describe the expected behavior\n Code to reproduce the issue\n Provide a reproducible test case that is the bare minimum necessary to generate the problem.\n Other info / logs\n Include any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "VoVAllen", "commentT": "2019-11-09T18:50:55Z", "comment_text": "\n \t\tSyntax works fine on TensorFlow 1.15.0 (all 1.x): <denchmark-link:https://colab.research.google.com/gist/nikochiko/7cefa862d487ff9d6d31c9c2034a3cb8/34124.ipynb#scrollTo=6jMLFtVeeJpX>gist</denchmark-link>\n \n Throws error in TensorFlow 2.x: <denchmark-link:https://colab.research.google.com/drive/1nkoSsW4hINcp03EPwLC0NFQhpuJURUbW#scrollTo=tB54LogAgL1D>gist</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "VoVAllen", "commentT": "2019-11-10T11:34:08Z", "comment_text": "\n \t\tUpdate: found out the problem lies in using this command with eager execution.\n Find <denchmark-link:https://colab.research.google.com/gist/nikochiko/0de00bb23b936f1ce714bf969aae5f1b/34124_fix.ipynb>gist</denchmark-link>\n  here. Must be called with  function in eager execution.\n Will update the docs. Issue can be assigned to me. Will put a PR soon.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "VoVAllen", "commentT": "2019-11-10T11:47:35Z", "comment_text": "\n \t\tThank you <denchmark-link:https://github.com/VoVAllen>@VoVAllen</denchmark-link>\n  for bringing this issue to attention.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "VoVAllen", "commentT": "2019-11-11T18:52:28Z", "comment_text": "\n \t\tThis issue is fixed with latest version TF nightly build '2.1.0-dev20191111'. Thanks!\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "VoVAllen", "commentT": "2019-11-14T13:07:08Z", "comment_text": "\n \t\tHowever I would consider it as an implementation bug instead of a documentation error. Thanks for your help!\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "VoVAllen", "commentT": "2019-11-14T13:07:13Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/34124>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/34124>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "5006295cf7a20de9ef9087127569e9d58b28022d", "commit_author": "Kaustubh Maske Patil", "commitT": "2019-11-11 23:16:14+05:18", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\python\\framework\\device_spec.py", "file_new_name": "tensorflow\\python\\framework\\device_spec.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "57,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,83,84,86", "deleted_lines": "50,54,56,60,65,70,72,73,75,78,81"}}}}}}