{"BR": {"BR_id": "997", "BR_author": "bkkaggle", "BRopenT": "2020-03-02T02:05:28Z", "BRcloseT": "2020-03-03T02:51:06Z", "BR_text": {"BRsummary": "Precision=16 with TPUs bug", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n Setting precision=16 when training with a TPU throws an error\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n see colab: <denchmark-link:https://colab.research.google.com/drive/1s-ZDIqzgKQ1Byf-Lw58RZ8LGgmdB6qjB>https://colab.research.google.com/drive/1s-ZDIqzgKQ1Byf-Lw58RZ8LGgmdB6qjB</denchmark-link>\n \n Relavent stack trace:\n <denchmark-code>Exception in device=TPU:0: str expected, not int\n Traceback (most recent call last):\n   File \"/usr/local/lib/python3.6/dist-packages/torch_xla/distributed/xla_multiprocessing.py\", line 119, in _start_fn\n     fn(gindex, *args)\n   File \"/usr/local/lib/python3.6/dist-packages/pytorch_lightning/trainer/distrib_parts.py\", line 492, in tpu_train\n     os.environ['XLA_USE_BF16'] = 1\n   File \"/usr/lib/python3.6/os.py\", line 674, in __setitem__\n     value = self.encodevalue(value)\n   File \"/usr/lib/python3.6/os.py\", line 744, in encode\n     raise TypeError(\"str expected, not %s\" % type(value).__name__)\n TypeError: str expected, not int\n </denchmark-code>\n \n To fix this all that should be needed should be casting 1 to a string\n <denchmark-code>    os.environ['XLA_USE_BF16'] = str(1)\n </denchmark-code>\n \n <denchmark-h:h3>Environment</denchmark-h>\n \n <denchmark-code>Collecting environment information...\n PyTorch version: 1.4.0\n Is debug build: No\n CUDA used to build PyTorch: 10.1\n \n OS: Ubuntu 18.04.3 LTS\n GCC version: (Ubuntu 7.4.0-1ubuntu1~18.04.1) 7.4.0\n CMake version: version 3.12.0\n \n Python version: 3.6\n Is CUDA available: No\n CUDA runtime version: 10.1.243\n GPU models and configuration: Could not collect\n Nvidia driver version: Could not collect\n cuDNN version: /usr/lib/x86_64-linux-gnu/libcudnn.so.7.6.5\n \n Versions of relevant libraries:\n [pip3] numpy==1.17.5\n [pip3] torch==1.4.0\n [pip3] torchsummary==1.5.1\n [pip3] torchtext==0.3.1\n [pip3] torchvision==0.5.0\n [conda] Could not collect\n </denchmark-code>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "29cbc9e7230dd4c5e5e8e8ff789b838ed4a79e20", "commit_author": "Bilal Khan", "commitT": "2020-03-02 21:51:05-05:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\distrib_parts.py", "file_new_name": "pytorch_lightning\\trainer\\distrib_parts.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "492", "deleted_lines": "492", "method_info": {"method_name": "tpu_train", "method_params": "self,tpu_core_idx,model", "method_startline": "471", "method_endline": "499"}}}}}}}