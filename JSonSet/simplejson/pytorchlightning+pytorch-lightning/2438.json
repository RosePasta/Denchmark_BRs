{"BR": {"BR_id": "2438", "BR_author": "Llannelongue", "BRopenT": "2020-07-01T00:46:26Z", "BRcloseT": "2020-07-01T11:38:01Z", "BR_text": {"BRsummary": "`validation_epoch_end` and `test_epoch_end` can't return nothing", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n If validation_epoch_end or test_epoch_end returns nothing (as presented as an option in the documentation), an error occurs.\n (Happy to work on a PR to fix this)\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n Steps to reproduce the behavior:\n Overwrite test_epoch_end and remove return (same for validation_epoch_end\n <denchmark-code>File \"/.conda/envs/PPI-env/lib/python3.7/site-packages/pytorch_lightning/trainer/logging.py\", line 106, in process_output\n     for k, v in output.items():\n AttributeError: 'NoneType' object has no attribute 'items'\n </denchmark-code>\n \n <denchmark-h:h4>Code sample</denchmark-h>\n \n import os\n \n import torch\n from torch.nn import functional as F\n from torch.utils.data import DataLoader\n from torchvision.datasets import MNIST\n from torchvision import transforms\n from pytorch_lightning.core.lightning import LightningModule\n from pytorch_lightning import Trainer, seed_everything\n \n class LitModel(LightningModule):\n \n     def __init__(self):\n         super().__init__()\n         self.l1 = torch.nn.Linear(28 * 28, 10)\n \n     def forward(self, x):\n         return torch.relu(self.l1(x.view(x.size(0), -1)))\n \n     def training_step(self, batch, batch_idx):\n         x, y = batch\n         y_hat = self(x)\n         loss = F.cross_entropy(y_hat, y)\n         tensorboard_logs = {'train_loss': loss}\n         return {'loss': loss, 'log': tensorboard_logs}\n \n     def configure_optimizers(self):\n         return torch.optim.Adam(self.parameters(), lr=0.001)\n \n     def train_dataloader(self):\n         dataset = MNIST(os.getcwd(), train=True, download=True, transform=transforms.ToTensor())\n         loader = DataLoader(dataset, batch_size=32, num_workers=4, shuffle=True)\n         return loader\n \n     def validation_step(self, batch, batch_idx):\n         x, y = batch\n         y_hat = self(x)\n         return {'val_loss': F.cross_entropy(y_hat, y)}\n \n     def validation_epoch_end(self, outputs):\n         avg_loss = torch.stack([x['val_loss'] for x in outputs]).mean()\n         tensorboard_logs = {'val_loss': avg_loss}\n         # return {'val_loss': avg_loss, 'log': tensorboard_logs}\n \n     def val_dataloader(self):\n         # TODO: do a real train/val split\n         dataset = MNIST(os.getcwd(), train=False, download=True, transform=transforms.ToTensor())\n         loader = DataLoader(dataset, batch_size=32, num_workers=4)\n         return loader\n \n \n def main():\n     seed_everything(42)\n \n     model = LitModel()\n     # most basic trainer, uses good defaults\n     trainer = Trainer(fast_dev_run=True)\n     trainer.fit(model)\n \n if __name__ == '__main__':\n     main()\n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n It should check if there is nothing returned and carry on.\n <denchmark-h:h3>Environment</denchmark-h>\n \n \n CUDA:\n \n GPU:\n available:         False\n version:           None\n \n \n Packages:\n \n numpy:             1.17.4\n pyTorch_debug:     False\n pyTorch_version:   1.5.1\n pytorch-lightning: 0.8.3\n tensorboard:       2.2.2\n tqdm:              4.41.1\n \n \n System:\n \n OS:                Darwin\n architecture:\n \n 64bit\n \n \n \n processor:         i386\n python:            3.7.6\n version:           Darwin Kernel Version 19.4.0: Wed Mar  4 22:28:40 PST 2020; root:xnu-6153.101.6~15/RELEASE_X86_64\n \n \n \n <denchmark-h:h3>Additional context</denchmark-h>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Llannelongue", "commentT": "2020-07-01T03:05:55Z", "comment_text": "\n \t\tyes, please submit a PR? you should be allowed to return nothing\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Llannelongue", "commentT": "2020-07-01T07:15:11Z", "comment_text": "\n \t\tYes, working on it \ud83d\udc4d\n \t\t"}}}, "commit": {"commit_id": "325852c6df93f749bb843bff1a3cdba41698722c", "commit_author": "William Falcon", "commitT": "2020-07-01 07:38:00-04:00", "changed_files": {"file_0": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "docs\\source\\bolts.rst"}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\source\\callbacks.rst", "file_new_name": "docs\\source\\callbacks.rst", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "52,53,54,55,56,57,58,59", "deleted_lines": "52,53,54,55,56,57,58,59"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\source\\conf.py", "file_new_name": "docs\\source\\conf.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "142", "deleted_lines": null}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\source\\hooks.rst", "file_new_name": "docs\\source\\hooks.rst", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "23,24,35,36", "deleted_lines": null}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\source\\index.rst", "file_new_name": "docs\\source\\index.rst", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "30,31,32,33,34,35,36", "deleted_lines": "38,103"}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pytorch_lightning\\core\\lightning.py", "file_new_name": "pytorch_lightning\\core\\lightning.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1394,1395,1396,1397,1398,1399,1400,1401,1402,1407", "deleted_lines": null, "method_info": {"method_name": "test_dataloader", "method_params": "self", "method_startline": "1387", "method_endline": "1439"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1340,1341,1342,1343,1344,1345,1346,1347,1352", "deleted_lines": "1340", "method_info": {"method_name": "train_dataloader", "method_params": "self", "method_startline": "1330", "method_endline": "1375"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\evaluation_loop.py", "file_new_name": "pytorch_lightning\\trainer\\evaluation_loop.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "411,412,413,415,416,418,419,420,421,422,423,425,426,427,428,429", "deleted_lines": "409,411,412,414,415,416,417,418,419,421,422,424,425", "method_info": {"method_name": "run_evaluation", "method_params": "self,bool", "method_startline": "370", "method_endline": "447"}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\trainer.py", "file_new_name": "pytorch_lightning\\trainer\\trainer.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1140,1141,1142,1143,1144", "deleted_lines": "1145,1146", "method_info": {"method_name": "run_pretrain_routine", "method_params": "self,LightningModule", "method_startline": "1056", "method_endline": "1156"}}}}}}}