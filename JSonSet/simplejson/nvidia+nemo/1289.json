{"BR": {"BR_id": "1289", "BR_author": "PeganovAnton", "BRopenT": "2020-10-14T16:02:35Z", "BRcloseT": "2020-11-11T07:56:38Z", "BR_text": {"BRsummary": "Perplexity is computed incorrectly", "BRdescription": "\n Describe the bug\n Perplexity is computed incorrectly <denchmark-link:https://github.com/NVIDIA/NeMo/blob/main/nemo/collections/nlp/metrics/perplexity.py>here</denchmark-link>\n  and in <denchmark-link:https://github.com/NVIDIA/NeMo/blob/main/nemo/collections/nlp/models/language_modeling/transformer_lm_model.py>TransformerLMModel</denchmark-link>\n . Perplexity is an exponent of entropy whereas in these scripts it is computed as an exponent of cross-entropy.\n \t"}, "comments": {}}, "commit": {"commit_id": "ffb4e36be574eda9fa35a14a65a3bfd372615ff0", "commit_author": "PeganovAnton", "commitT": "2020-11-10 23:56:37-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\source\\common\\intro.rst", "file_new_name": "docs\\source\\common\\intro.rst", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "32,33,34,35,36,37,38,39", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\source\\conf.py", "file_new_name": "docs\\source\\conf.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "98,101,102,103,104,105", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "nemo\\collections\\common\\metrics\\__init__.py", "file_new_name": "nemo\\collections\\common\\metrics\\__init__.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "16", "deleted_lines": null}}}, "file_3": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "nemo\\collections\\common\\metrics\\perplexity.py"}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "nemo\\collections\\nlp\\metrics\\__init__.py", "file_new_name": "nemo\\collections\\nlp\\metrics\\__init__.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": null, "deleted_lines": "16"}}}, "file_5": {"file_change_type": "DELETE", "file_Nmethod": 0, "file_old_name": "nemo\\collections\\nlp\\metrics\\perplexity.py", "file_new_name": "None"}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 7, "file_old_name": "nemo\\collections\\nlp\\models\\language_modeling\\bert_lm_model.py", "file_new_name": "nemo\\collections\\nlp\\models\\language_modeling\\bert_lm_model.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "129,130,131,132,133,134,135,136", "deleted_lines": null, "method_info": {"method_name": "_compute_losses", "method_params": "self,mlm_log_probs,nsp_logits,output_ids,output_mask,labels", "method_startline": "129", "method_endline": "136"}}, "hunk_1": {"Ismethod": 1, "added_lines": "151,152,153", "deleted_lines": "144,145,146", "method_info": {"method_name": "training_step", "method_params": "self,batch,batch_idx", "method_startline": "144", "method_endline": "155"}}, "hunk_2": {"Ismethod": 1, "added_lines": "180,181,182,183,184", "deleted_lines": "180,181,182,183,184", "method_info": {"method_name": "validation_epoch_end", "method_params": "self,outputs", "method_startline": "170", "method_endline": "184"}}, "hunk_3": {"Ismethod": 1, "added_lines": "110", "deleted_lines": "110", "method_info": {"method_name": "__init__", "method_params": "self,DictConfig,Trainer", "method_startline": "56", "method_endline": "112"}}, "hunk_4": {"Ismethod": 1, "added_lines": "138,139,140,141,142", "deleted_lines": "138,139,140,141,142", "method_info": {"method_name": "_parse_forward_outputs", "method_params": "self,forward_outputs", "method_startline": "138", "method_endline": "142"}}, "hunk_5": {"Ismethod": 1, "added_lines": null, "deleted_lines": "126", "method_info": {"method_name": "forward", "method_params": "self,input_ids,token_type_ids,attention_mask", "method_startline": "115", "method_endline": "128"}}, "hunk_6": {"Ismethod": 1, "added_lines": "163,164,165,166,167,168", "deleted_lines": "157,158,159,160,161,162,163,164,165,166,167,168", "method_info": {"method_name": "validation_step", "method_params": "self,batch,batch_idx", "method_startline": "157", "method_endline": "168"}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "nemo\\collections\\nlp\\models\\language_modeling\\transformer_lm_model.py", "file_new_name": "nemo\\collections\\nlp\\models\\language_modeling\\transformer_lm_model.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "135,137", "deleted_lines": "130,131,132", "method_info": {"method_name": "validation_step", "method_params": "self,batch,batch_idx", "method_startline": "126", "method_endline": "139"}}, "hunk_1": {"Ismethod": 1, "added_lines": "117,122", "deleted_lines": null, "method_info": {"method_name": "training_step", "method_params": "self,batch,batch_idx", "method_startline": "107", "method_endline": "124"}}, "hunk_2": {"Ismethod": 1, "added_lines": "89,90,91", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,DictConfig,Trainer", "method_startline": "40", "method_endline": "93"}}, "hunk_3": {"Ismethod": 1, "added_lines": "148,149", "deleted_lines": "143", "method_info": {"method_name": "validation_epoch_end", "method_params": "self,outputs", "method_startline": "141", "method_endline": "150"}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "nemo\\collections\\nlp\\models\\neural_machine_translation\\neural_machine_translation_model.py", "file_new_name": "nemo\\collections\\nlp\\models\\neural_machine_translation\\neural_machine_translation_model.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "181", "deleted_lines": "181", "method_info": {"method_name": "validation_epoch_end", "method_params": "self", "method_startline": "175", "method_endline": "184"}}, "hunk_1": {"Ismethod": 1, "added_lines": "111", "deleted_lines": "111", "method_info": {"method_name": "__init__", "method_params": "self,DictConfig,Trainer", "method_startline": "55", "method_endline": "113"}}, "hunk_2": {"Ismethod": 1, "added_lines": "165,167,169,171", "deleted_lines": "165,167,169,171", "method_info": {"method_name": "validation_step", "method_params": "self,Tuple,int", "method_startline": "159", "method_endline": "173"}}}}, "file_9": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\collections\\common\\__init__.py"}, "file_10": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\collections\\common\\perplexity_inputs.py"}, "file_11": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\collections\\common\\pl_utils.py"}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\collections\\common\\test_metrics.py", "file_new_name": "tests\\collections\\common\\test_metrics.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "128,129,130,131", "deleted_lines": null, "method_info": {"method_name": "test_perplexity", "method_params": "self,ddp,dist_sync_on_step,probs,logits", "method_startline": "128", "method_endline": "131"}}}}}}}