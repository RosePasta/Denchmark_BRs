{"BR": {"BR_id": "2309", "BR_author": "patykov", "BRopenT": "2017-09-06T20:36:23Z", "BRcloseT": "2018-01-06T07:05:38Z", "BR_text": {"BRsummary": "Transforms with a composite MinibatchSource", "BRdescription": "\n Hi, I am attempting to use a composite MinibatchSource with some ImageDeserializers and need to do some transforms like random crop and random flip. But in my case I need the transforms to be the same for all images with the same sequenceID.\n For example, if the first image (sequenceID = 0) of the first ImageDeserializer is flipped, then the first image (sequenceID = 0) of the second ImageDeserializer also needs to be flipped.\n Is that possible? Will the transforms be the same for all ImageDeserializers in a composite reader?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "patykov", "commentT": "2017-09-07T04:32:33Z", "comment_text": "\n \t\tTo verify this,you can do the following: take the example code from <denchmark-link:https://stackoverflow.com/questions/43151213/cntk-create-minibatchsource-from-numpy-array-for-multi-gpu-training>this SO thread</denchmark-link>\n , provide identical files to both readers, add some random transforms, to both sides, and create a \"network\" that just takes the two inputs and computes the squared error of their difference. If the output of the network is zero (or very close to zero) then it means that the same transforms are applied. If not, then let us know so we can fix it.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "patykov", "commentT": "2017-09-12T07:44:09Z", "comment_text": "\n \t\tThe transforms (random cropping and flipping) will applied to both readers only when minibatch size is 1. For minibatch size > 1, the two readers does not get the same transforms.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "patykov", "commentT": "2017-09-12T17:12:10Z", "comment_text": "\n \t\tI got to the same result: the random transform does not work for minibatch size > 1.  Will this be fixed?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "patykov", "commentT": "2017-09-14T05:21:02Z", "comment_text": "\n \t\tWe will try to address it in version 2.3 (version 2.2 will be released very soon)\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "patykov", "commentT": "2017-12-11T18:15:58Z", "comment_text": "\n \t\tAre there any updates on this bug? It wasn't fixed in the latest versions.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "patykov", "commentT": "2017-12-13T22:39:03Z", "comment_text": "\n \t\tSorry, I was on leave and nobody was able to pick this up. I will look into it next.\n \t\t"}}}, "commit": {"commit_id": "6ee82ccabd691ab7ad7305994f27b83539aeee1b", "commit_author": "Nikos Karampatziakis", "commitT": "2018-01-03 15:29:01-08:00", "changed_files": {"file_0": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "Source\\Common\\Include\\ConcVector.h"}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "Source\\Readers\\CompositeDataReader\\CompositeDataReader.cpp", "file_new_name": "Source\\Readers\\CompositeDataReader\\CompositeDataReader.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "177", "deleted_lines": "177", "method_info": {"method_name": "CNTK::CompositeDataReader::CompositeDataReader", "method_params": "config", "method_startline": "37", "method_endline": "224"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 22, "file_old_name": "Source\\Readers\\ImageReader\\ImageTransformers.cpp", "file_new_name": "Source\\Readers\\ImageReader\\ImageTransformers.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "646,649,658", "deleted_lines": "646,649,658", "method_info": {"method_name": "CNTK::IntensityTransformer::Apply", "method_params": "mat,indexInBatch", "method_startline": "646", "method_endline": "676"}}, "hunk_1": {"Ismethod": 1, "added_lines": "25,32", "deleted_lines": "25,32", "method_info": {"method_name": "CNTK::ImageTransformerBase::Transform", "method_params": "sequence", "method_startline": "25", "method_endline": "44"}}, "hunk_2": {"Ismethod": 1, "added_lines": "451", "deleted_lines": "451", "method_info": {"method_name": "CNTK::MeanTransformer::Apply", "method_params": "uint8_t,mat,int", "method_startline": "451", "method_endline": "471"}}, "hunk_3": {"Ismethod": 1, "added_lines": "128,131,160", "deleted_lines": "128,131,160", "method_info": {"method_name": "CNTK::CropTransformer::Apply", "method_params": "copyId,mat", "method_startline": "128", "method_endline": "161"}}, "hunk_4": {"Ismethod": 1, "added_lines": "25,32", "deleted_lines": "25,32", "method_info": {"method_name": "CNTK::ImageTransformerBase::Transform", "method_params": "sequence,indexInBatch", "method_startline": "25", "method_endline": "44"}}, "hunk_5": {"Ismethod": 1, "added_lines": "700,709,711", "deleted_lines": "700,709,711", "method_info": {"method_name": "CNTK::ColorTransformer::Apply", "method_params": "uint8_t,mat", "method_startline": "700", "method_endline": "714"}}, "hunk_6": {"Ismethod": 1, "added_lines": "700,709,711", "deleted_lines": "700,709,711", "method_info": {"method_name": "CNTK::ColorTransformer::Apply", "method_params": "uint8_t,mat,indexInBatch", "method_startline": "700", "method_endline": "714"}}, "hunk_7": {"Ismethod": 1, "added_lines": "717,720,778", "deleted_lines": "717,720,778", "method_info": {"method_name": "CNTK::ColorTransformer::Apply", "method_params": "mat", "method_startline": "717", "method_endline": "779"}}, "hunk_8": {"Ismethod": 1, "added_lines": "451", "deleted_lines": "451", "method_info": {"method_name": "CNTK::MeanTransformer::Apply", "method_params": "uint8_t,mat", "method_startline": "451", "method_endline": "471"}}, "hunk_9": {"Ismethod": 1, "added_lines": "128,131,160", "deleted_lines": "128,131,160", "method_info": {"method_name": "CNTK::CropTransformer::Apply", "method_params": "copyId,mat,indexInBatch", "method_startline": "128", "method_endline": "161"}}, "hunk_10": {"Ismethod": 1, "added_lines": "627,638,640", "deleted_lines": "627,638,640", "method_info": {"method_name": "CNTK::IntensityTransformer::Apply", "method_params": "uint8_t,mat", "method_startline": "627", "method_endline": "643"}}, "hunk_11": {"Ismethod": 1, "added_lines": "792", "deleted_lines": "792", "method_info": {"method_name": "CNTK::CastTransformer::Transform", "method_params": "sequence", "method_startline": "792", "method_endline": "828"}}, "hunk_12": {"Ismethod": 1, "added_lines": "371", "deleted_lines": "371", "method_info": {"method_name": "CNTK::ScaleTransformer::Apply", "method_params": "uint8_t,mat,int", "method_startline": "371", "method_endline": "421"}}, "hunk_13": {"Ismethod": 1, "added_lines": "371", "deleted_lines": "371", "method_info": {"method_name": "CNTK::ScaleTransformer::Apply", "method_params": "uint8_t,mat", "method_startline": "371", "method_endline": "421"}}, "hunk_14": {"Ismethod": 1, "added_lines": "496,510,512,515,517,520,522", "deleted_lines": "496,510,512,515,517,520,522", "method_info": {"method_name": "CNTK::TransposeTransformer::Transform", "method_params": "sequence", "method_startline": "496", "method_endline": "527"}}, "hunk_15": {"Ismethod": 1, "added_lines": "792", "deleted_lines": "792", "method_info": {"method_name": "CNTK::CastTransformer::Transform", "method_params": "sequence,int", "method_startline": "792", "method_endline": "828"}}, "hunk_16": {"Ismethod": 1, "added_lines": "531", "deleted_lines": "531", "method_info": {"method_name": "CNTK::TransposeTransformer::TypedTranspose<TElementTo>::Apply", "method_params": "inputSequence", "method_startline": "531", "method_endline": "593"}}, "hunk_17": {"Ismethod": 1, "added_lines": "646,649,658", "deleted_lines": "646,649,658", "method_info": {"method_name": "CNTK::IntensityTransformer::Apply", "method_params": "mat", "method_startline": "646", "method_endline": "676"}}, "hunk_18": {"Ismethod": 1, "added_lines": "496,510,512,515,517,520,522", "deleted_lines": "496,510,512,515,517,520,522", "method_info": {"method_name": "CNTK::TransposeTransformer::Transform", "method_params": "sequence,indexInBatch", "method_startline": "496", "method_endline": "527"}}, "hunk_19": {"Ismethod": 1, "added_lines": "627,638,640", "deleted_lines": "627,638,640", "method_info": {"method_name": "CNTK::IntensityTransformer::Apply", "method_params": "uint8_t,mat,indexInBatch", "method_startline": "627", "method_endline": "643"}}, "hunk_20": {"Ismethod": 1, "added_lines": "531", "deleted_lines": "531", "method_info": {"method_name": "CNTK::TransposeTransformer::TypedTranspose<TElementTo>::Apply", "method_params": "inputSequence,int", "method_startline": "531", "method_endline": "593"}}, "hunk_21": {"Ismethod": 1, "added_lines": "717,720,778", "deleted_lines": "717,720,778", "method_info": {"method_name": "CNTK::ColorTransformer::Apply", "method_params": "mat,indexInBatch", "method_startline": "717", "method_endline": "779"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "Source\\Readers\\ImageReader\\ImageTransformers.h", "file_new_name": "Source\\Readers\\ImageReader\\ImageTransformers.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "16,61,82,84,97,118,152,171,186,198,222,224,231,244,246,252,270", "deleted_lines": "60,81,83,96,117,151,170,185,197,221,223,230,243,245,251,269"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "Source\\Readers\\ReaderLib\\TransformController.h", "file_new_name": "Source\\Readers\\ReaderLib\\TransformController.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "29,30", "deleted_lines": "29,30", "method_info": {"method_name": "CNTK::TransformController::TransformController", "method_params": "transformations,sequenceProvider", "method_startline": "29", "method_endline": "42"}}, "hunk_1": {"Ismethod": 1, "added_lines": "85,87,88,89,91,93,94,95,96,97,98,99,100,101,102,103,104,105", "deleted_lines": "85,86,87,89,91,93,94,95,97,98", "method_info": {"method_name": "CNTK::TransformController::GetNextSequences", "method_params": "globalSampleCount,localSampleCount", "method_startline": "76", "method_endline": "108"}}, "hunk_2": {"Ismethod": 1, "added_lines": "29,30", "deleted_lines": "29,30", "method_info": {"method_name": "CNTK::TransformController::TransformController", "method_params": "transformations,sequenceProvider,multiThreadedDeserialization", "method_startline": "29", "method_endline": "42"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "Source\\Readers\\ReaderLib\\Transformer.h", "file_new_name": "Source\\Readers\\ReaderLib\\Transformer.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "28", "deleted_lines": "28"}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "bindings\\python\\cntk\\io\\tests\\io_tests.py", "file_new_name": "bindings\\python\\cntk\\io\\tests\\io_tests.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1441,1442,1443,1444,1445,1446,1447", "deleted_lines": null, "method_info": {"method_name": "test_composite_source_synced_transforms.create_reader", "method_params": "map_file1,map_file2", "method_startline": "1441", "method_endline": "1447"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1428,1429,1430,1431,1432,1433,1434,1435,1436,1437,1438,1439,1440,1441,1442,1443,1444,1445,1446,1447,1448,1449,1450,1451,1452,1453,1454,1455,1456,1457,1458,1459,1460,1461", "deleted_lines": null, "method_info": {"method_name": "test_composite_source_synced_transforms", "method_params": "tmpdir", "method_startline": "1428", "method_endline": "1461"}}}}}}}