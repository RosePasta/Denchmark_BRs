{"BR": {"BR_id": "2508", "BR_author": "anupbera", "BRopenT": "2017-10-18T05:19:03Z", "BRcloseT": "2017-11-03T20:14:16Z", "BR_text": {"BRsummary": "cntk.edit_distance_error not running on multi-GPU", "BRdescription": "\n Hi,\n I tried to run cntk.edit_distance_error CTC implementation on 2 GPUs (nvidia Tesla M60 )  in Ubuntu 16.04 machine , but got following error :\n Traceback (most recent call last):\n File \"HTK_LSTM_CTC_Truncated_Distributed.py\", line 200, in \n cv_freq=args['cvfreq'])\n File \"HTK_LSTM_CTC_Truncated_Distributed.py\", line 149, in htk_lstm_truncated\n train_and_test(network, trainer, train_source, test_source, minibatch_size, epoch_size, restore, model_path, cv_freq)\n File \"HTK_LSTM_CTC_Truncated_Distributed.py\", line 116, in train_and_test\n model_inputs_to_streams = cv_input_map, frequency=cv_freq)\n File \"/home/ubuntu/.local/lib/python3.5/site-packages/cntk/internal/swig_helper.py\", line 69, in wrapper\n result = f(*args, **kwds)\n File \"/home/ubuntu/.local/lib/python3.5/site-packages/cntk/train/training_session.py\", line 276, in train\n super(TrainingSession, self).train(device)\n File \"/home/ubuntu/.local/lib/python3.5/site-packages/cntk/cntk_py.py\", line 3312, in train\n return _cntk_py.TrainingSession_train(self, computeDevice)\n RuntimeError: SetDataLocation [CPUMatrix]: Cannot migrate the matrix between devices because it is a view.\n ======================================\n Steps to Reproduce:\n I have made some changes of the example <denchmark-link:https://github.com/Microsoft/CNTK/blob/master/Examples/Speech/AN4/Python/HTK_LSTM_Truncated_Distributed.py>https://github.com/Microsoft/CNTK/blob/master/Examples/Speech/AN4/Python/HTK_LSTM_Truncated_Distributed.py</denchmark-link>\n  to working on CTC imlementation. Please find the attached python implementation. Please note that I have used the dataset at <denchmark-link:https://github.com/Microsoft/CNTK/tree/master/Examples/Speech/AN4/Data>https://github.com/Microsoft/CNTK/tree/master/Examples/Speech/AN4/Data</denchmark-link>\n \n run following commands from console:\n $ download the zip file and data from the stated location.\n $ unzip the HTK_LSTM_CTC_Truncated_Distributed.zip\n $ mpiexec --npernode 2 python HTK_LSTM_CTC_Truncated_Distributed.py\n <denchmark-link:https://github.com/Microsoft/CNTK/files/1393498/HTK_LSTM_CTC_Truncated_Distributed.zip>HTK_LSTM_CTC_Truncated_Distributed.zip</denchmark-link>\n \n Note: This code is running fine if we run it on single GPU\n $ mpiexec --npernode 1 python HTK_LSTM_CTC_Truncated_Distributed.py\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "anupbera", "commentT": "2017-10-24T05:03:56Z", "comment_text": "\n \t\tHi Cha,\n Could you please let me know the expected timeline to resolve this issue.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "anupbera", "commentT": "2017-10-26T22:41:12Z", "comment_text": "\n \t\tThanks for reporting! We have found the issue and will push a fix in sometime next week. Will update when the fix is in.\n \t\t"}}}, "commit": {"commit_id": "c40fb5af77995fc44788da03b0f53d3498281506", "commit_author": "Junjie Qian", "commitT": "2017-11-02 20:48:35-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "Source\\CNTKv2LibraryDll\\API\\CNTKLibrary.h", "file_new_name": "Source\\CNTKv2LibraryDll\\API\\CNTKLibrary.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "787,788,789,790,791", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "Source\\CNTKv2LibraryDll\\DistributedCommunicator.cpp", "file_new_name": "Source\\CNTKv2LibraryDll\\DistributedCommunicator.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "315,320", "deleted_lines": "315,320", "method_info": {"method_name": "CNTK::MPICommunicatorImpl::AggregateImpl", "method_params": "inputValues,outputValues,sendToWorkers", "method_startline": "290", "method_endline": "447"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "Source\\CNTKv2LibraryDll\\NDArrayView.cpp", "file_new_name": "Source\\CNTKv2LibraryDll\\NDArrayView.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172", "deleted_lines": null, "method_info": {"method_name": "CNTK::NDArrayView::IsSliceView", "method_params": "", "method_startline": "156", "method_endline": "172"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "Source\\Math\\Matrix.cpp", "file_new_name": "Source\\Math\\Matrix.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1972,1973,1974,1975", "deleted_lines": null, "method_info": {"method_name": "Microsoft::MSR::CNTK::Matrix<ElemType>::IsView", "method_params": "", "method_startline": "1972", "method_endline": "1975"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "Source\\Math\\Matrix.h", "file_new_name": "Source\\Math\\Matrix.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "184", "deleted_lines": null}}}}}}