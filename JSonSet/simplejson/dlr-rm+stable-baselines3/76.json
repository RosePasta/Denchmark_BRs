{"BR": {"BR_id": "76", "BR_author": "araffin", "BRopenT": "2020-06-29T15:21:30Z", "BRcloseT": "2020-06-29T15:58:56Z", "BR_text": {"BRsummary": "[Bug] Wrong target q in SAC", "BRdescription": "\n In SAC, when updating the Q-values:\n \n \n \n stable-baselines3/stable_baselines3/sac/sac.py\n \n \n         Lines 205 to 208\n       in\n       96b771f\n \n \n \n \n \n \n  target_q = th.min(target_q1, target_q2) \n \n \n \n  target_q = replay_data.rewards + (1 - replay_data.dones) * self.gamma * target_q \n \n \n \n  # td error + entropy term \n \n \n \n  q_backup = target_q - ent_coef * next_log_prob.reshape(-1, 1) \n \n \n \n \n \n should be (entropy term also conditioned by termination):\n target_q = th.min(target_q1, target_q2) - ent_coef * next_log_prob.reshape(-1, 1)\n q_backup = replay_data.rewards + (1 - replay_data.dones) * self.gamma * target_q\n See original implementation: <denchmark-link:https://github.com/rail-berkeley/softlearning/blob/master/softlearning/algorithms/sac.py#L26>https://github.com/rail-berkeley/softlearning/blob/master/softlearning/algorithms/sac.py#L26</denchmark-link>\n \n The bug is not present in SB2 (need to double) as it is using the SAC variant with a value function whereas we are using 2 Q-values.\n I will push a fix soon.\n \t"}, "comments": {}}, "commit": {"commit_id": "08e7519381e800edc6bbd09577f14381b7341873", "commit_author": "Antonin RAFFIN", "commitT": "2020-06-29 17:58:55+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\misc\\changelog.rst", "file_new_name": "docs\\misc\\changelog.rst", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "6,24", "deleted_lines": "6"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "stable_baselines3\\sac\\sac.py", "file_new_name": "stable_baselines3\\sac\\sac.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "205,207", "deleted_lines": "205,206,208", "method_info": {"method_name": "train", "method_params": "self,int,int", "method_startline": "156", "method_endline": "246"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "stable_baselines3\\version.txt", "file_new_name": "stable_baselines3\\version.txt", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1", "deleted_lines": "1"}}}}}}