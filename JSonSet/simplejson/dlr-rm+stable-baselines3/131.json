{"BR": {"BR_id": "131", "BR_author": "araffin", "BRopenT": "2020-07-30T16:00:08Z", "BRcloseT": "2020-07-30T18:48:31Z", "BR_text": {"BRsummary": "[Bug] Optimized Polyak update not equivalent for CnnPolicy", "BRdescription": "\n The following code works for MlpPolicy but fail with CNN.\n import torch as th\n \n from stable_baselines3 import DQN\n from stable_baselines3.common.cmd_util import make_atari_env\n from stable_baselines3.common.utils import polyak_update\n \n tau = 0.1\n \n model = DQN('CnnPolicy', make_atari_env('BreakoutNoFrameskip-v4', 1), learning_starts=0,\n       target_update_interval=250, verbose=1, seed=0,\n       train_freq=100, buffer_size=1000)\n \n model_2 = DQN('CnnPolicy', make_atari_env('BreakoutNoFrameskip-v4', 1), learning_starts=0,\n       target_update_interval=250, verbose=1, seed=0,\n       train_freq=100, buffer_size=1000)\n \n polyak_update(model.q_net.parameters(), model.q_net_target.parameters(), tau)\n with th.no_grad():\n     for param, target_param in zip(model_2.q_net.parameters(), model_2.q_net_target.parameters()):\n         target_param.data.copy_(tau * param.data + (1 - tau) * target_param.data)\n \n for param, target_param in zip(model.q_net_target.parameters(), model_2.q_net_target.parameters()):\n     assert th.allclose(param, target_param)\n Introduced in <denchmark-link:https://github.com/DLR-RM/stable-baselines3/pull/106>#106</denchmark-link>\n \n Pinging <denchmark-link:https://github.com/PartiallyTyped>@PartiallyTyped</denchmark-link>\n \n EDIT: this optimization is maybe not needed anymore, see <denchmark-link:https://github.com/DLR-RM/stable-baselines3/issues/122#issuecomment-666521802>#122 (comment)</denchmark-link>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "77cb3dd0abe04aab17f115465abad8658362166d", "commit_author": "Anssi", "commitT": "2020-07-30 20:48:30+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\misc\\changelog.rst", "file_new_name": "docs\\misc\\changelog.rst", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "6,36", "deleted_lines": "6"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "stable_baselines3\\dqn\\policies.py", "file_new_name": "stable_baselines3\\dqn\\policies.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "168,169,170,171", "deleted_lines": null, "method_info": {"method_name": "make_q_net", "method_params": "self", "method_startline": "167", "method_endline": "171"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "stable_baselines3\\version.txt", "file_new_name": "stable_baselines3\\version.txt", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1", "deleted_lines": "1"}}}}}}