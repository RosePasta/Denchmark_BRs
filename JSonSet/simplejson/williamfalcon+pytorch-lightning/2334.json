{"BR": {"BR_id": "2334", "BR_author": "dscarmo", "BRopenT": "2020-06-23T21:05:29Z", "BRcloseT": "2020-06-28T21:20:34Z", "BR_text": {"BRsummary": "LightningModule.load_from_checkpoint not working with .ckpt from 0.7.6", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n Trying to use an old experiment .ckpt (generated with ModelCheckpoint(monitor=\"val_loss\", mode=\"min') in 0.7.6) results in an error when trying to load.\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n Steps to reproduce the behavior:\n \n Train something with 0.7.6 and save checkpoint with the checkpoint callback\n Try to load checkpoint with 0.8.1\n \n <denchmark-code>Trying to load: ckpts/MNIST_0.7.6epoch=4.ckpt with PL version: 0.8.1\n ---------------------------------------------------------------------------\n TypeError                                 Traceback (most recent call last)\n <ipython-input-3-36a7290b43c6> in <module>()\n      35 selected_ckpt = glob(os.path.join(\"ckpts\", \"*.ckpt\"))[0]\n      36 print(f\"Trying to load: {selected_ckpt} with PL version: {pl.__version__}\")\n ---> 37 LitClassifier.load_from_checkpoint(selected_ckpt)\n \n 1 frames\n /usr/local/lib/python3.6/dist-packages/pytorch_lightning/core/saving.py in load_from_checkpoint(cls, checkpoint_path, map_location, hparams_file, tags_csv, *args, **kwargs)\n     169         checkpoint[cls.CHECKPOINT_HYPER_PARAMS_KEY].update(kwargs)\n     170 \n --> 171         model = cls._load_model_state(checkpoint, *args, **kwargs)\n     172         return model\n     173 \n \n /usr/local/lib/python3.6/dist-packages/pytorch_lightning/core/saving.py in _load_model_state(cls, checkpoint, *args, **kwargs)\n     184 \n     185             if cls.CHECKPOINT_HYPER_PARAMS_TYPE in checkpoint:\n --> 186                 model_args = checkpoint[cls.CHECKPOINT_HYPER_PARAMS_TYPE](model_args)\n     187 \n     188             args_name = checkpoint.get(cls.CHECKPOINT_HYPER_PARAMS_NAME)\n \n TypeError: 'str' object is not callable\n </denchmark-code>\n \n Here is a Colab notebook reproducing the issue: <denchmark-link:https://colab.research.google.com/drive/1s7SzG3EkLJZOmUOkb0mJ85zDcOxBcDLG?usp=sharing>https://colab.research.google.com/drive/1s7SzG3EkLJZOmUOkb0mJ85zDcOxBcDLG?usp=sharing</denchmark-link>\n \n Maybe this is related to the changes in hparams recently?\n It happened in my local enviroment and in Google Colab's enviroment.\n I was able to load the checkpoint after downgrading to 0.7.6 without problems.\n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n Being able to use old .ckpts.\n <denchmark-h:h3>Environment</denchmark-h>\n \n \n PyTorch Version (e.g., 1.0): 1.5\n OS (e.g., Linux): Ubuntu 18.04\n How you installed PyTorch (conda, pip, source): pip\n Build command you used (if compiling from source):\n Python version: 3.6.9\n CUDA/cuDNN version: 10.2\n GPU models and configuration: 1060\n Any other relevant information:\n \n Also happened in the Colab enviroment.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "dscarmo", "commentT": "2020-06-25T12:51:43Z", "comment_text": "\n \t\tAdded a Google Colab notebook reproducing the issue.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "dscarmo", "commentT": "2020-06-29T01:55:26Z", "comment_text": "\n \t\t<denchmark-link:https://user-images.githubusercontent.com/3640001/85965231-09d80980-b98a-11ea-9291-0510ebebf40e.png></denchmark-link>\n \n <denchmark-link:https://github.com/dscarmo>@dscarmo</denchmark-link>\n  no more bug :) <denchmark-link:https://github.com/Borda>@Borda</denchmark-link>\n  fixed it!\n \t\t"}}}, "commit": {"commit_id": "861a73be12ef17214bb0ed49aabc9f48a80fde16", "commit_author": "Jirka Borovec", "commitT": "2020-06-28 17:20:33-04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "45,46", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pytorch_lightning\\core\\saving.py", "file_new_name": "pytorch_lightning\\core\\saving.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "183", "deleted_lines": "183,184", "method_info": {"method_name": "_load_model_state", "method_params": "cls,str,cls_args,cls_kwargs", "method_startline": "173", "method_endline": "208"}}, "hunk_1": {"Ismethod": 1, "added_lines": "250,251,252,253,254,255,256,257,258,259", "deleted_lines": null, "method_info": {"method_name": "_convert_loaded_hparams", "method_params": "dict,Callable,None", "method_startline": "250", "method_endline": "259"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\models\\test_hparams.py", "file_new_name": "tests\\models\\test_hparams.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "395", "deleted_lines": null, "method_info": {"method_name": "test_load_past_checkpoint", "method_params": "tmpdir,past_key", "method_startline": "384", "method_endline": "403"}}, "hunk_1": {"Ismethod": 1, "added_lines": "271", "deleted_lines": null, "method_info": {"method_name": "test_collect_init_arguments", "method_params": "tmpdir,cls", "method_startline": "249", "method_endline": "291"}}}}}}}