{"BR": {"BR_id": "3652", "BR_author": "yoshum", "BRopenT": "2020-09-25T01:21:50Z", "BRcloseT": "2020-09-25T11:09:51Z", "BR_text": {"BRsummary": "Creation of many data module instances incurs RecursionError", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n Thank you for a nice framework!\n When I repeated hundreds of experiments, each time with a new instance of a single LightningDataModule class, RecursionError was raised. I also found that creating data modules and calling setup() were enough to reproduce the issue.\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n Please look at the following code sample and error messages:\n <denchmark-h:h4>Code sample</denchmark-h>\n \n <denchmark-code>import pytorch_lightning as pl\n \n class DummyDM(pl.LightningDataModule):\n     def setup(self, stage=None):\n         pass\n \n if __name__ == \"__main__\":\n     MAX_ITERS = 1000\n     for i in range(MAX_ITERS):\n         try:\n             dm = DummyDM()\n             dm.setup()\n         except RecursionError:\n             print(f\"RecursionError occured in the {i}-th iteration!\")\n             raise\n </denchmark-code>\n \n <denchmark-h:h4>Error messages</denchmark-h>\n \n <denchmark-code>RecursionError occured in the 998-th iteration!\n Traceback (most recent call last):\n   File \"test_dm.py\", line 18, in <module>\n     dm.setup()\n   File \"/workspace/src/.venv/lib/python3.8/site-packages/pytorch_lightning/core/datamodule.py\", line 85, in wrapped_fn\n     return fn(*args, **kwargs)\n   File \"/workspace/src/.venv/lib/python3.8/site-packages/pytorch_lightning/core/datamodule.py\", line 85, in wrapped_fn\n     return fn(*args, **kwargs)\n   File \"/workspace/src/.venv/lib/python3.8/site-packages/pytorch_lightning/core/datamodule.py\", line 85, in wrapped_fn\n     return fn(*args, **kwargs)\n   [Previous line repeated 995 more times]\n   File \"/workspace/src/.venv/lib/python3.8/site-packages/pytorch_lightning/core/datamodule.py\", line 69, in wrapped_fn\n     if fn.__name__ == 'setup':\n RecursionError: maximum recursion depth exceeded in comparison\n </denchmark-code>\n \n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n The above code sample is expected to exit without any outputs.\n <denchmark-h:h3>Environment</denchmark-h>\n \n \n PyTorch Version (e.g., 1.0): 1.6.0\n PytorchLightning Version: 0.9.0\n OS (e.g., Linux): Linux\n How you installed PyTorch (conda, pip, source): pip\n Build command you used (if compiling from source): n/a\n Python version: 3.8.2\n CUDA/cuDNN version: 10.2\n GPU models and configuration: 1080Ti\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "yoshum", "commentT": "2020-09-25T01:22:29Z", "comment_text": "\n \t\tHi! thanks for your contribution!, great first issue!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "yoshum", "commentT": "2020-09-25T10:54:35Z", "comment_text": "\n \t\tI faced the same issue. I opened a PR with a fix <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/pull/3654>#3654</denchmark-link>\n .\n \t\t"}}}, "commit": {"commit_id": "17c8c95fbc7b31f73671761430e86d881f6d6c6d", "commit_author": "Antoine Broyelle", "commitT": "2020-09-25 07:09:50-04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pytorch_lightning\\core\\datamodule.py", "file_new_name": "pytorch_lightning\\core\\datamodule.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "39,40,41,42,43,44", "deleted_lines": "35,36,37,38,39", "method_info": {"method_name": "__call__", "method_params": "cls,args,kwargs", "method_startline": "32", "method_endline": "49"}}, "hunk_1": {"Ismethod": 1, "added_lines": "28,29,30", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,args,kwargs", "method_startline": "28", "method_endline": "30"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tests\\core\\test_datamodules.py", "file_new_name": "tests\\core\\test_datamodules.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "78,79", "deleted_lines": null, "method_info": {"method_name": "test_hooks_no_recursion_error.prepare_data", "method_params": "self,args,kwargs", "method_startline": "78", "method_endline": "79"}}, "hunk_1": {"Ismethod": 1, "added_lines": "75,76", "deleted_lines": null, "method_info": {"method_name": "test_hooks_no_recursion_error.setup", "method_params": "self,args,kwargs", "method_startline": "75", "method_endline": "76"}}, "hunk_2": {"Ismethod": 1, "added_lines": "71,72,73,74,75,76,77,78,79,80,81,82,83,84", "deleted_lines": null, "method_info": {"method_name": "test_hooks_no_recursion_error", "method_params": "tmpdir", "method_startline": "71", "method_endline": "84"}}}}}}}