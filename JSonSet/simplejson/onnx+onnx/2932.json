{"BR": {"BR_id": "2932", "BR_author": "matteosal", "BRopenT": "2020-07-29T16:47:20Z", "BRcloseT": "2020-08-11T20:39:29Z", "BR_text": {"BRsummary": "The checker fails for missing shape, but IR allows it", "BRdescription": "\n <denchmark-link:https://github.com/onnx/onnx/blob/master/docs/IR.md>IR.md</denchmark-link>\n  states that the \"shape\" property can be missing from input and output specs:\n \n When the shape property is absent for an input, a tensor value of any shape may be passed from the caller. When the shape property is absent for an output, the caller should expect that the output value may be of any shape.\n \n But running the checker on the attached file fails saying that \"shape\" is required:\n <denchmark-code>>>> model = onnx.load(\"file.onnx\")\n >>> onnx.checker.check_model(model)\n Traceback (most recent call last):\n   File \"<stdin>\", line 1, in <module>\n   File \"/usr/local/lib/python3.6/dist-packages/onnx-1.7.0-py3.6-linux-x86_64.egg/onnx/checker.py\", line 102, in check_model\n     C.check_model(protobuf_string)\n onnx.onnx_cpp2py_export.checker.ValidationError: Field 'shape' of type is required but missing.\n </denchmark-code>\n \n Am I missing something here? Is the model invalid for some other reason?\n <denchmark-link:https://github.com/onnx/onnx/files/4996240/file.zip>file.zip</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "matteosal", "commentT": "2020-07-29T18:03:27Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/matteosal>@matteosal</denchmark-link>\n ,\n Similar to <denchmark-link:https://github.com/onnx/onnx/issues/2492>#2492</denchmark-link>\n ?\n I agree this behavior of checker does not match the description in IR...\n <denchmark-link:https://github.com/linkerzhang>@linkerzhang</denchmark-link>\n  what do you think about this difference between the new IR and the current checker?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "matteosal", "commentT": "2020-07-30T05:26:54Z", "comment_text": "\n \t\tI believe graph inputs and outputs require a shape as well. Node inputs do not.\n The shape may have symbolic (dim_param is set) or unknown (neither dim_param or dim_value is set) dimensions in it so that only the rank is specified.\n This section of the spec could be clarified by adding the bolded text in the table:\n \n Each main (top-level) graph MUST define the names and types of its inputs and outputs, which are specified as \u2018value info\u2019 structures, having the following properties:\n \n \n \n \n Name\n Type\n Description\n \n \n \n \n name\n string\n The name of the value/parameter.\n \n \n type\n Type\n The type of the value including shape information.\n \n \n doc_string\n string\n A human-readable documentation for this value. Markdown is allowed.\n \n \n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "matteosal", "commentT": "2020-07-31T03:07:48Z", "comment_text": "\n \t\tyes, Main graph's inputs and outputs must have type and shape information. Do you <denchmark-link:https://github.com/skottmckay>@skottmckay</denchmark-link>\n  or <denchmark-link:https://github.com/jcwchen>@jcwchen</denchmark-link>\n  want to create a PR to update the IR.md please?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "matteosal", "commentT": "2020-07-31T03:08:33Z", "comment_text": "\n \t\tIt's not a BUG in checker but an issue of the documentation, btw. <denchmark-link:https://github.com/matteosal>@matteosal</denchmark-link>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "matteosal", "commentT": "2020-07-31T04:47:01Z", "comment_text": "\n \t\t\n yes, Main graph's inputs and outputs must have type and shape information. Do you @skottmckay or @jcwchen want to create a PR to update the IR.md please?\n \n Happy to help. Thank you for the explanation <denchmark-link:https://github.com/skottmckay>@skottmckay</denchmark-link>\n  <denchmark-link:https://github.com/linkerzhang>@linkerzhang</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "matteosal", "commentT": "2020-07-31T09:34:05Z", "comment_text": "\n \t\t\n I believe graph inputs and outputs require a shape as well. Node inputs do not.\n \n Well, for that matter, node inputs are not even required to exist at all. If this is the point, then I think that this section I mentioned should also be made clearer:\n \n When the shape property is absent for an input, a tensor value of any shape may be passed from the caller. When the shape property is absent for an output, the caller should expect that the output value may be of any shape.\n \n I think this should specify that:\n \n The sentence applies to node I/O only\n Graph I/O must always specify a shape\n Node I/O can also be completely absent from the graph (and can be filled by shape inference)\n \n The main reason why I was mislead by the sentence is that node I/O is generally missing from all real-life models (or at least this was my expericence). So when reading about I/O, I imemdiately thought about graph I/O.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "matteosal", "commentT": "2020-08-11T20:39:29Z", "comment_text": "\n \t\tClosing this issue as the PR to address this is not merged.\n \t\t"}}}, "commit": {"commit_id": "182909b8f0db341aafe95849fea3118ce9a9491a", "commit_author": "Chun-Wei Chen", "commitT": "2020-08-11 13:36:56-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\IR.md", "file_new_name": "docs\\IR.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "188,193,196,197,375,376,377,378", "deleted_lines": "188,193,373"}}}}}}