{"BR": {"BR_id": "2290", "BR_author": "chicm-ms", "BRopenT": "2020-04-09T04:59:59Z", "BRcloseT": "2020-04-17T08:55:40Z", "BR_text": {"BRsummary": "No experiment log showed in integration test when nnictl create failed", "BRdescription": "\n When nnictl create or rest api query failed, experiment log is not displayed, this is not friendly for trouble shooting.\n <denchmark-code>2020-04-09T04:08:53.0470472Z ##[section]Starting: Integration test\n 2020-04-09T04:08:53.0478551Z ==============================================================================\n 2020-04-09T04:08:53.0479151Z Task         : Command line\n 2020-04-09T04:08:53.0480387Z Description  : Run a command line script using Bash on Linux and macOS and cmd.exe on Windows\n 2020-04-09T04:08:53.0480928Z Version      : 2.164.0\n 2020-04-09T04:08:53.0481282Z Author       : Microsoft Corporation\n 2020-04-09T04:08:53.0481755Z Help         : https://docs.microsoft.com/azure/devops/pipelines/tasks/utility/command-line\n 2020-04-09T04:08:53.0482270Z ==============================================================================\n 2020-04-09T04:08:53.1775643Z Generating script.\n 2020-04-09T04:08:53.1792419Z ========================== Starting Command Output ===========================\n 2020-04-09T04:08:53.1818577Z [command]/bin/bash --noprofile --norc /mnt/home/nni/myagent/_work/_temp/780fb57c-de78-4774-8382-5d39489cc41d.sh\n 2020-04-09T04:08:53.4061942Z {\n 2020-04-09T04:08:53.4063064Z     \"stopCommand\": \"nnictl stop\",\n 2020-04-09T04:08:53.4063591Z     \"platform\": \"linux darwin win32\",\n 2020-04-09T04:08:53.4063980Z     \"config\": null,\n 2020-04-09T04:08:53.4065079Z     \"configFile\": \"test/config/examples/sklearn-classification.yml\",\n 2020-04-09T04:08:53.4065621Z     \"validator\": null,\n 2020-04-09T04:08:53.4066231Z     \"name\": \"sklearn-classification\",\n 2020-04-09T04:08:53.4066708Z     \"setExperimentIdtoVar\": \"$expId\",\n 2020-04-09T04:08:53.4067370Z     \"launchCommand\": \"nnictl create --config $configFile\",\n 2020-04-09T04:08:53.4067877Z     \"experimentStatusCheck\": true\n 2020-04-09T04:08:53.4068171Z }\n 2020-04-09T04:08:53.4068692Z \ufffd[32mTesting: sklearn-classification\ufffd[0m\n 2020-04-09T04:08:53.4069035Z assessor:\n 2020-04-09T04:08:53.4069318Z   builtinAssessorName: Medianstop\n 2020-04-09T04:08:53.4069552Z   classArgs:\n 2020-04-09T04:08:53.4069802Z     optimize_mode: maximize\n 2020-04-09T04:08:53.4070094Z authorName: nni\n 2020-04-09T04:08:53.4070377Z experimentName: default_test\n 2020-04-09T04:08:53.4070682Z logCollection: http\n 2020-04-09T04:08:53.4070982Z maxExecDuration: 5m\n 2020-04-09T04:08:53.4071254Z maxTrialNum: 4\n 2020-04-09T04:08:53.4071536Z multiPhase: false\n 2020-04-09T04:08:53.4071779Z multiThread: false\n 2020-04-09T04:08:53.4072160Z searchSpacePath: ../../../examples/trials/sklearn/classification/search_space.json\n 2020-04-09T04:08:53.4072504Z trainingServicePlatform: local\n 2020-04-09T04:08:53.4072733Z trial:\n 2020-04-09T04:08:53.4072983Z   codeDir: ../../../examples/trials/sklearn/classification\n 2020-04-09T04:08:53.4073283Z   command: python3 main.py\n 2020-04-09T04:08:53.4073499Z   gpuNum: 0\n 2020-04-09T04:08:53.4073978Z trialConcurrency: 2\n 2020-04-09T04:08:53.4074307Z tuner:\n 2020-04-09T04:08:53.4074613Z   builtinTunerName: Random\n 2020-04-09T04:08:53.4074969Z useAnnotation: false\n 2020-04-09T04:08:53.4075238Z \n 2020-04-09T04:08:53.4075936Z launch command:  nnictl create --config ../test/config/examples/sklearn-classification.yml.tmp\n 2020-04-09T04:08:54.0667548Z INFO: expand searchSpacePath: ../../../examples/trials/sklearn/classification/search_space.json to /mnt/home/nni/myagent/_work/1/s/test/config/examples/../../../examples/trials/sklearn/classification/search_space.json \n 2020-04-09T04:08:54.0669996Z INFO: expand codeDir: ../../../examples/trials/sklearn/classification to /mnt/home/nni/myagent/_work/1/s/test/config/examples/../../../examples/trials/sklearn/classification \n 2020-04-09T04:08:54.8552753Z INFO: Starting restful server...\n 2020-04-09T04:08:57.8839873Z INFO: Successfully started Restful server!\n 2020-04-09T04:08:57.8840658Z INFO: Setting local config...\n 2020-04-09T04:08:57.9003903Z INFO: Successfully set local config!\n 2020-04-09T04:08:57.9004481Z INFO: Starting experiment...\n 2020-04-09T04:08:57.9471790Z INFO: Successfully started experiment!\n 2020-04-09T04:08:57.9473357Z ------------------------------------------------------------------------------------\n 2020-04-09T04:08:57.9473887Z The experiment id is lwl3dQrb\n 2020-04-09T04:08:57.9474408Z The Web UI urls are: http://127.0.0.1:8080   http://192.168.10.8:8080   http://172.17.0.1:8080\n 2020-04-09T04:08:57.9476086Z ------------------------------------------------------------------------------------\n 2020-04-09T04:08:57.9476507Z \n 2020-04-09T04:08:57.9476809Z You can use these commands to get more information about the experiment\n 2020-04-09T04:08:57.9477441Z ------------------------------------------------------------------------------------\n 2020-04-09T04:08:57.9477927Z          commands                       description\n 2020-04-09T04:08:57.9478340Z 1. nnictl experiment show        show the information of experiments\n 2020-04-09T04:08:57.9478765Z 2. nnictl trial ls               list all of trial jobs\n 2020-04-09T04:08:57.9479180Z 3. nnictl top                    monitor the status of running experiments\n 2020-04-09T04:08:57.9479884Z 4. nnictl log stderr             show stderr log content\n 2020-04-09T04:08:57.9480323Z 5. nnictl log stdout             show stdout log content\n 2020-04-09T04:08:57.9480728Z 6. nnictl stop                   stop an experiment\n 2020-04-09T04:08:57.9481335Z 7. nnictl trial kill             kill a trial job by id\n 2020-04-09T04:08:57.9482410Z 8. nnictl --help                 get help information about nnictl\n 2020-04-09T04:08:57.9483986Z ------------------------------------------------------------------------------------\n 2020-04-09T04:08:57.9484562Z Command reference document https://nni.readthedocs.io/en/latest/Tutorial/Nnictl.html\n 2020-04-09T04:08:57.9485288Z ------------------------------------------------------------------------------------\n 2020-04-09T04:08:57.9485686Z \n 2020-04-09T04:08:58.0746369Z variables: {'$expId': 'lwl3dQrb', '$configFile': '../test/config/examples/sklearn-classification.yml.tmp'}\n 2020-04-09T04:08:58.0748402Z max_duration: 300  max_trial_num: 4\n 2020-04-09T04:08:58.0749506Z 2020-04-09 04:08:58.074120  waiting ...\n 2020-04-09T04:09:10.1223636Z Stop command: nnictl stop\n 2020-04-09T04:09:10.7905747Z ERROR: There is no experiment running...\n 2020-04-09T04:09:10.9207344Z Traceback (most recent call last):\n 2020-04-09T04:09:10.9209189Z   File \"/home/nni/.local/lib/python3.5/site-packages/urllib3/connection.py\", line 157, in _new_conn\n 2020-04-09T04:09:10.9209731Z     (self._dns_host, self.port), self.timeout, **extra_kw\n 2020-04-09T04:09:10.9210433Z   File \"/home/nni/.local/lib/python3.5/site-packages/urllib3/util/connection.py\", line 84, in create_connection\n 2020-04-09T04:09:10.9210826Z     raise err\n 2020-04-09T04:09:10.9211419Z   File \"/home/nni/.local/lib/python3.5/site-packages/urllib3/util/connection.py\", line 74, in create_connection\n 2020-04-09T04:09:10.9211824Z     sock.connect(sa)\n 2020-04-09T04:09:10.9212125Z ConnectionRefusedError: [Errno 111] Connection refused\n 2020-04-09T04:09:10.9212355Z \n 2020-04-09T04:09:10.9212624Z During handling of the above exception, another exception occurred:\n 2020-04-09T04:09:10.9212878Z \n 2020-04-09T04:09:10.9213091Z Traceback (most recent call last):\n 2020-04-09T04:09:10.9213676Z   File \"/home/nni/.local/lib/python3.5/site-packages/urllib3/connectionpool.py\", line 672, in urlopen\n 2020-04-09T04:09:10.9214084Z     chunked=chunked,\n 2020-04-09T04:09:10.9214654Z   File \"/home/nni/.local/lib/python3.5/site-packages/urllib3/connectionpool.py\", line 387, in _make_request\n 2020-04-09T04:09:10.9215099Z     conn.request(method, url, **httplib_request_kw)\n 2020-04-09T04:09:10.9215437Z   File \"/usr/lib/python3.5/http/client.py\", line 1122, in request\n 2020-04-09T04:09:10.9215789Z     self._send_request(method, url, body, headers)\n 2020-04-09T04:09:10.9216132Z   File \"/usr/lib/python3.5/http/client.py\", line 1167, in _send_request\n 2020-04-09T04:09:10.9216449Z     self.endheaders(body)\n 2020-04-09T04:09:10.9216746Z   File \"/usr/lib/python3.5/http/client.py\", line 1118, in endheaders\n 2020-04-09T04:09:10.9220101Z     self._send_output(message_body)\n 2020-04-09T04:09:10.9221065Z   File \"/usr/lib/python3.5/http/client.py\", line 944, in _send_output\n 2020-04-09T04:09:10.9221541Z     self.send(msg)\n 2020-04-09T04:09:10.9221911Z   File \"/usr/lib/python3.5/http/client.py\", line 887, in send\n 2020-04-09T04:09:10.9222531Z     self.connect()\n 2020-04-09T04:09:10.9223789Z   File \"/home/nni/.local/lib/python3.5/site-packages/urllib3/connection.py\", line 184, in connect\n 2020-04-09T04:09:10.9224293Z     conn = self._new_conn()\n 2020-04-09T04:09:10.9225160Z   File \"/home/nni/.local/lib/python3.5/site-packages/urllib3/connection.py\", line 169, in _new_conn\n 2020-04-09T04:09:10.9225715Z     self, \"Failed to establish a new connection: %s\" % e\n 2020-04-09T04:09:10.9226385Z urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7fb8dcd230f0>: Failed to establish a new connection: [Errno 111] Connection refused\n 2020-04-09T04:09:10.9226965Z \n 2020-04-09T04:09:10.9227292Z During handling of the above exception, another exception occurred:\n 2020-04-09T04:09:10.9227593Z \n 2020-04-09T04:09:10.9227867Z Traceback (most recent call last):\n 2020-04-09T04:09:10.9228525Z   File \"/home/nni/.local/lib/python3.5/site-packages/requests/adapters.py\", line 449, in send\n 2020-04-09T04:09:10.9228983Z     timeout=timeout\n 2020-04-09T04:09:10.9229620Z   File \"/home/nni/.local/lib/python3.5/site-packages/urllib3/connectionpool.py\", line 720, in urlopen\n 2020-04-09T04:09:10.9230158Z     method, url, error=e, _pool=self, _stacktrace=sys.exc_info()[2]\n 2020-04-09T04:09:10.9230859Z   File \"/home/nni/.local/lib/python3.5/site-packages/urllib3/util/retry.py\", line 436, in increment\n 2020-04-09T04:09:10.9231386Z     raise MaxRetryError(_pool, url, error or ResponseError(cause))\n 2020-04-09T04:09:10.9232692Z urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=8080): Max retries exceeded with url: /api/v1/nni/check-status (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fb8dcd230f0>: Failed to establish a new connection: [Errno 111] Connection refused',))\n 2020-04-09T04:09:10.9233526Z \n 2020-04-09T04:09:10.9233867Z During handling of the above exception, another exception occurred:\n 2020-04-09T04:09:10.9234162Z \n 2020-04-09T04:09:10.9234433Z Traceback (most recent call last):\n 2020-04-09T04:09:10.9234798Z   File \"nni_test/nnitest/run_tests.py\", line 230, in <module>\n 2020-04-09T04:09:10.9235149Z     run(args)\n 2020-04-09T04:09:10.9235469Z   File \"nni_test/nnitest/run_tests.py\", line 217, in run\n 2020-04-09T04:09:10.9235864Z     run_test_case(test_case_config, it_config, args)\n 2020-04-09T04:09:10.9236255Z   File \"nni_test/nnitest/run_tests.py\", line 72, in run_test_case\n 2020-04-09T04:09:10.9236671Z     launch_test(new_config_file, args.ts, test_case_config)\n 2020-04-09T04:09:10.9237070Z   File \"nni_test/nnitest/run_tests.py\", line 143, in launch_test\n 2020-04-09T04:09:10.9237469Z     status = get_experiment_status(STATUS_URL)\n 2020-04-09T04:09:10.9237914Z   File \"/mnt/home/nni/myagent/_work/1/s/test/nni_test/nnitest/utils.py\", line 91, in get_experiment_status\n 2020-04-09T04:09:10.9238384Z     nni_status = requests.get(status_url).json()\n 2020-04-09T04:09:10.9239055Z   File \"/home/nni/.local/lib/python3.5/site-packages/requests/api.py\", line 76, in get\n 2020-04-09T04:09:10.9239859Z     return request('get', url, params=params, **kwargs)\n 2020-04-09T04:09:10.9240602Z   File \"/home/nni/.local/lib/python3.5/site-packages/requests/api.py\", line 61, in request\n 2020-04-09T04:09:10.9241088Z     return session.request(method=method, url=url, **kwargs)\n 2020-04-09T04:09:10.9241785Z   File \"/home/nni/.local/lib/python3.5/site-packages/requests/sessions.py\", line 530, in request\n 2020-04-09T04:09:10.9242245Z     resp = self.send(prep, **send_kwargs)\n 2020-04-09T04:09:10.9242906Z   File \"/home/nni/.local/lib/python3.5/site-packages/requests/sessions.py\", line 643, in send\n 2020-04-09T04:09:10.9243368Z     r = adapter.send(request, **kwargs)\n 2020-04-09T04:09:10.9244029Z   File \"/home/nni/.local/lib/python3.5/site-packages/requests/adapters.py\", line 516, in send\n 2020-04-09T04:09:10.9244486Z     raise ConnectionError(e, request=request)\n 2020-04-09T04:09:10.9245770Z requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=8080): Max retries exceeded with url: /api/v1/nni/check-status (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fb8dcd230f0>: Failed to establish a new connection: [Errno 111] Connection refused',))\n 2020-04-09T04:09:10.9515480Z \n 2020-04-09T04:09:10.9577378Z ##[error]Bash exited with code '1'.\n 2020-04-09T04:09:10.9593225Z ##[section]Finishing: Integration test\n </denchmark-code>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "ae72aec87dbce3a3f328c9a70a82132f825634d6", "commit_author": "chicm-ms", "commitT": "2020-04-17 11:42:51+08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "test\\nni_test\\nnitest\\run_tests.py", "file_new_name": "test\\nni_test\\nnitest\\run_tests.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "73", "deleted_lines": "73", "method_info": {"method_name": "run_test_case", "method_params": "test_case_config,it_config,args", "method_startline": "66", "method_endline": "81"}}, "hunk_1": {"Ismethod": 1, "added_lines": "83,91,92,93,94,95,96,97", "deleted_lines": "83,91", "method_info": {"method_name": "invoke_validator", "method_params": "test_case_config,nni_source_dir,training_service", "method_startline": "83", "method_endline": "97"}}, "hunk_2": {"Ismethod": 1, "added_lines": "126,143,144,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,166", "deleted_lines": "120,137,139,140,141,142,143,144,145,146,147,148,149,150,151,154", "method_info": {"method_name": "launch_test", "method_params": "config_file,training_service,test_case_config", "method_startline": "120", "method_endline": "172"}}, "hunk_3": {"Ismethod": 1, "added_lines": "83,91", "deleted_lines": "83,91", "method_info": {"method_name": "invoke_validator", "method_params": "test_case_config,nni_source_dir", "method_startline": "83", "method_endline": "91"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "test\\nni_test\\nnitest\\utils.py", "file_new_name": "test\\nni_test\\nnitest\\utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "76,78", "deleted_lines": null, "method_info": {"method_name": "get_nni_log_dir", "method_params": "experiment_url,experiment_id", "method_startline": "76", "method_endline": "78"}}, "hunk_1": {"Ismethod": 1, "added_lines": "69,71,72,73", "deleted_lines": "70,73", "method_info": {"method_name": "get_experiment_dir", "method_params": "experiment_url,experiment_id", "method_startline": "69", "method_endline": "74"}}, "hunk_2": {"Ismethod": 1, "added_lines": "69,71", "deleted_lines": "68,70", "method_info": {"method_name": "get_experiment_dir", "method_params": "experiment_url", "method_startline": "68", "method_endline": "71"}}, "hunk_3": {"Ismethod": 1, "added_lines": "131,132,137,138,139,140", "deleted_lines": null, "method_info": {"method_name": "print_experiment_log", "method_params": "experiment_id", "method_startline": "131", "method_endline": "140"}}, "hunk_4": {"Ismethod": 1, "added_lines": "131,132", "deleted_lines": "128,129", "method_info": {"method_name": "print_experiment_log", "method_params": "experiment_url", "method_startline": "128", "method_endline": "132"}}, "hunk_5": {"Ismethod": 1, "added_lines": "73", "deleted_lines": "73,75", "method_info": {"method_name": "get_nni_log_dir", "method_params": "experiment_url", "method_startline": "73", "method_endline": "75"}}}}}}}