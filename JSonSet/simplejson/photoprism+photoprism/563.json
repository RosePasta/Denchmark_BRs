{"BR": {"BR_id": "563", "BR_author": "psyciknz", "BRopenT": "2020-10-22T19:32:30Z", "BRcloseT": "2020-12-10T22:29:05Z", "BR_text": {"BRsummary": "Indexer: Updating Exif metadata in files doesn't update the index", "BRdescription": "\n I have a largish photo collection I've just added to photoprisim.  From earlier cameras a lot of these photos did not have geo tagging in them, so i had been adding it (with xnview).\n Then I've been trying to call photoprism index --all <path to folder> and been getting hit and miss results as to whether it adds the tagging to the photo or not.  I want to say it was workign 50% of the time....but there's certain directories I just can't get it to pick up anything, short of physically renaming the folder, letting it remove the old folder and reindex.\n I've also found that photoprism purge --hard  will only remove 1 or 2 images each time it's run out of the 100 that are there.\n Is there something else I can do to help the re-indexing?  I know xnview is keeping the original file date and time (so unsure if this is causing photoprism to miss a change), I do see it saying it's\n <denchmark-code>INFO[2020-10-22T19:27:02Z] index: updated main jpg file \u201c2004/2004-06-Fiji/FijiTrip 099.jpg\u201d\n </denchmark-code>\n \n But unless I rename the folder, that's the only time I see the places added log message.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "psyciknz", "commentT": "2020-10-22T19:57:37Z", "comment_text": "\n \t\tI found exitfool in the  docker image, so here's the exif information to one of the geotagged photos that has not updated after reindexing:\n <denchmark-code>ExifTool Version Number         : 11.88\n File Name                       : IMG_8219.jpg\n Directory                       : originals/2008/2008-10-16-Fiji\n File Size                       : 895 kB\n File Modification Date/Time     : 2008:10:11 21:28:12+00:00\n File Access Date/Time           : 2020:10:22 19:51:04+00:00\n File Inode Change Date/Time     : 2008:10:11 21:28:12+00:00\n File Permissions                : rwxr-xr-x\n File Type                       : JPEG\n File Type Extension             : jpg\n MIME Type                       : image/jpeg\n Exif Byte Order                 : Little-endian (Intel, II)\n Make                            : Canon\n Camera Model Name               : Canon PowerShot A85\n Orientation                     : Horizontal (normal)\n X Resolution                    : 180\n Y Resolution                    : 180\n Resolution Unit                 : inches\n Modify Date                     : 2008:10:12 10:28:12\n Y Cb Cr Positioning             : Centered\n Exposure Time                   : 1/1000\n F Number                        : 4.8\n Exif Version                    : 0220\n Date/Time Original              : 2008:10:12 10:28:12\n Create Date                     : 2008:10:12 10:28:12\n Components Configuration        : Y, Cb, Cr, -\n Compressed Bits Per Pixel       : 3\n Shutter Speed Value             : 1/1002\n Aperture Value                  : 4.8\n Max Aperture Value              : 4.8\n Flash                           : Auto, Did not fire\n Focal Length                    : 16.2 mm\n Macro Mode                      : Normal\n Self Timer                      : Off\n Quality                         : Fine\n Canon Flash Mode                : Red-eye reduction (Auto)\n Continuous Drive                : Single\n Focus Mode                      : Single\n Record Mode                     : JPEG\n Canon Image Size                : Large\n Easy Mode                       : Full auto\n Digital Zoom                    : None\n Contrast                        : Normal\n Saturation                      : Normal\n Sharpness                       : 0\n Camera ISO                      : Auto\n Metering Mode                   : Evaluative\n Focus Range                     : Auto\n AF Point                        : Auto AF point selection\n Canon Exposure Mode             : Easy\n Lens Type                       : n/a\n Max Focal Length                : 16.21875 mm\n Min Focal Length                : 5.40625 mm\n Focal Units                     : 32/mm\n Max Aperture                    : 4.8\n Min Aperture                    : 8\n Flash Bits                      : (none)\n Focus Continuous                : Single\n AE Setting                      : Normal AE\n Display Aperture                : 4.8\n Zoom Source Width               : 2272\n Zoom Target Width               : 2272\n Spot Metering Mode              : Center\n Photo Effect                    : Off\n Manual Flash Output             : n/a\n Focal Type                      : Zoom\n Focal Plane X Size              : 5.46 mm\n Focal Plane Y Size              : 4.09 mm\n Auto ISO                        : 100\n Base ISO                        : 50\n Measured EV                     : 15.81\n Target Aperture                 : 4.8\n Target Exposure Time            : 1/1002\n Exposure Compensation           : 0\n White Balance                   : Auto\n Slow Shutter                    : Off\n Shot Number In Continuous Burst : 0\n Optical Zoom Code               : 6\n Flash Guide Number              : 0\n Flash Exposure Compensation     : 0\n Auto Exposure Bracketing        : Off\n AEB Bracket Value               : 0\n Control Mode                    : Camera Local Control\n Focus Distance Upper            : 65.53 m\n Focus Distance Lower            : 0 m\n Bulb Duration                   : 0\n Camera Type                     : Compact\n Auto Rotate                     : None\n ND Filter                       : Off\n Self Timer 2                    : 0\n Flash Output                    : 0\n Num AF Points                   : 9\n Valid AF Points                 : 9\n Canon Image Width               : 2272\n Canon Image Height              : 1704\n AF Image Width                  : 2272\n AF Image Height                 : 284\n AF Area Width                   : 409\n AF Area Height                  : 51\n AF Area X Positions             : -410 0 410 -410 0 410 -410 0 410\n AF Area Y Positions             : -54 -54 -54 0 0 0 54 54 54\n AF Points In Focus              : 1,4\n Primary AF Point                : 4\n Thumbnail Image Valid Area      : 0 0 0 0\n Canon Image Type                : IMG:PowerShot A85 JPEG\n Canon Firmware Version          : Firmware Version 1.00\n File Number                     : 882-8219\n Owner Name                      :\n Canon Model ID                  : PowerShot A85\n Date Stamp Mode                 : Off\n User Comment                    :\n Flashpix Version                : 0100\n Color Space                     : sRGB\n Exif Image Width                : 2272\n Exif Image Height               : 1704\n Interoperability Index          : R98 - DCF basic file (sRGB)\n Interoperability Version        : 0100\n Related Image Width             : 2272\n Related Image Height            : 1704\n Focal Plane X Resolution        : 10819.04762\n Focal Plane Y Resolution        : 10784.81013\n Focal Plane Resolution Unit     : inches\n Sensing Method                  : One-chip color area\n File Source                     : Digital Camera\n Custom Rendered                 : Normal\n Exposure Mode                   : Auto\n Digital Zoom Ratio              : 1\n Scene Capture Type              : Standard\n GPS Version ID                  : 2.3.0.0\n GPS Latitude Ref                : South\n GPS Longitude Ref               : East\n GPS Altitude                    : 5 m\n Compression                     : JPEG (old-style)\n Thumbnail Offset                : 2166\n Thumbnail Length                : 3015\n Image Width                     : 2272\n Image Height                    : 1704\n Encoding Process                : Baseline DCT, Huffman coding\n Bits Per Sample                 : 8\n Color Components                : 3\n Y Cb Cr Sub Sampling            : YCbCr4:2:2 (2 1)\n Drive Mode                      : Single-frame Shooting\n ISO                             : 50\n Lens                            : 5.4 - 16.2 mm\n Shooting Mode                   : Full auto\n Aperture                        : 4.8\n Image Size                      : 2272x1704\n Lens ID                         : Unknown 5-16mm\n Megapixels                      : 3.9\n Scale Factor To 35 mm Equivalent: 6.5\n Shutter Speed                   : 1/1000\n Thumbnail Image                 : (Binary data 3015 bytes, use -b option to extract)\n GPS Latitude                    : 17 deg 46' 6.06\" S\n GPS Longitude                   : 177 deg 22' 31.34\" E\n Lens                            : 5.4 - 16.2 mm (35 mm equivalent: 35.0 - 105.1 mm)\n Circle Of Confusion             : 0.005 mm\n Depth Of Field                  : inf (8.69 m - inf)\n Field Of View                   : 19.4 deg\n Focal Length                    : 16.2 mm (35 mm equivalent: 105.1 mm)\n GPS Position                    : 17 deg 46' 6.06\" S, 177 deg 22' 31.34\" E\n Hyperfocal Distance             : 11.82 m\n Light Value                     : 15.5\n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "psyciknz", "commentT": "2020-10-25T12:40:41Z", "comment_text": "\n \t\tIs it possible that there are duplicates or multiple file types / image sizes for each photo?\n \n PhotoPrism should always use the primary file for metadata indexing, but edge cases do exist, like when there are RAW & JPEG versions of the same photo\n Another issue could be that metadata is merged from embedded Exif headers and JSON sidecar files (automatically genterated by exiftool); so when you update the headers but the JSON is not updated, new data might not show up\n \n To fix this, we might have to regenerate JSON sidecar files when the main file changed. That's not implemented yet.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "psyciknz", "commentT": "2020-10-25T12:41:37Z", "comment_text": "\n \t\tAs a workaround, it might help to manually delete all JSON sidecar files in the storage / sidecar folder.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "psyciknz", "commentT": "2020-10-25T12:55:04Z", "comment_text": "\n \t\tFor further debugging, please dump the metadata as JSON grouped by type:\n <denchmark-code>exiftool -g -j FILENAME\n </denchmark-code>\n \n You're welcome to send example files for testing to <denchmark-link:mailto:hello@photoprism.org>hello@photoprism.org</denchmark-link>\n . Make sure they don't contain sensitive content so that we can add them to our test suite.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "psyciknz", "commentT": "2020-10-25T18:08:03Z", "comment_text": "\n \t\tI think I\u2019ve tried deleting the relevant sidecar directory after updating the exif data and it didn\u2019t have any effect.    But I\u2019ll try that again on your suggestion.\n I also tried updating the Yml file to add the GPS co-ords.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "psyciknz", "commentT": "2020-10-25T18:31:22Z", "comment_text": "\n \t\tYAML files are only backups, so changing them doesn't have any effect unless you remove the index (delete the database) first.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "psyciknz", "commentT": "2020-10-25T23:53:15Z", "comment_text": "\n \t\tDoes purge \u2014hard remove all traces of an image from the db, and sidecar?   So I can reindex it?\n Also I found giving it the path it would only delete 1 or 2 images at a time.   Not the entire directory\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "psyciknz", "commentT": "2020-10-26T04:47:16Z", "comment_text": "\n \t\tOk, so here is the resulto of the exiftool -g -j\n <denchmark-code>root@b7339846fc7f:/photoprism# exiftool -g -j originals/2004/2004-06-Fiji/FijiTrip\\ 002.jpg\n [{\n   \"SourceFile\": \"originals/2004/2004-06-Fiji/FijiTrip 002.jpg\",\n   \"ExifTool\": {\n     \"ExifToolVersion\": 11.88\n   },\n   \"File\": {\n     \"FileName\": \"FijiTrip 002.jpg\",\n     \"Directory\": \"originals/2004/2004-06-Fiji\",\n     \"FileSize\": \"921 kB\",\n     \"FileModifyDate\": \"2004:06:23 01:27:05+00:00\",\n     \"FileAccessDate\": \"2020:10:26 04:40:03+00:00\",\n     \"FileInodeChangeDate\": \"2004:06:23 01:27:05+00:00\",\n     \"FilePermissions\": \"rwxr-xr-x\",\n     \"FileType\": \"JPEG\",\n     \"FileTypeExtension\": \"jpg\",\n     \"MIMEType\": \"image/jpeg\",\n     \"ExifByteOrder\": \"Little-endian (Intel, II)\",\n     \"ImageWidth\": 2048,\n     \"ImageHeight\": 1536,\n     \"EncodingProcess\": \"Baseline DCT, Huffman coding\",\n     \"BitsPerSample\": 8,\n     \"ColorComponents\": 3,\n     \"YCbCrSubSampling\": \"YCbCr4:2:2 (2 1)\"\n   },\n   \"EXIF\": {\n     \"ImageDescription\": \"June 2004\",\n     \"Make\": \"Canon\",\n     \"Model\": \"Canon PowerShot A70\",\n     \"Orientation\": \"Horizontal (normal)\",\n     \"XResolution\": 180,\n     \"YResolution\": 180,\n     \"ResolutionUnit\": \"inches\",\n     \"Software\": \"Adobe Photoshop Album 2.0\",\n     \"ModifyDate\": \"2005:03:24 17:15:01\",\n     \"YCbCrPositioning\": \"Centered\",\n     \"ExposureTime\": \"1/1000\",\n     \"FNumber\": 5.0,\n     \"ExifVersion\": \"0220\",\n     \"DateTimeOriginal\": \"2004:06:17 09:04:12\",\n     \"CreateDate\": \"2004:06:17 09:04:12\",\n     \"ComponentsConfiguration\": \"Y, Cb, Cr, -\",\n     \"CompressedBitsPerPixel\": 3,\n     \"ShutterSpeedValue\": \"1/1002\",\n     \"ApertureValue\": 5.0,\n     \"ExposureCompensation\": 0,\n     \"MaxApertureValue\": 3.5,\n     \"MeteringMode\": \"Multi-segment\",\n     \"Flash\": \"Auto, Did not fire\",\n     \"FocalLength\": \"9.4 mm\",\n     \"FlashpixVersion\": \"0100\",\n     \"ColorSpace\": \"sRGB\",\n     \"ExifImageWidth\": 2048,\n     \"ExifImageHeight\": 1536,\n     \"InteropIndex\": \"R98 - DCF basic file (sRGB)\",\n     \"InteropVersion\": \"0100\",\n     \"RelatedImageWidth\": 2048,\n     \"RelatedImageHeight\": 1536,\n     \"FocalPlaneXResolution\": 9846.153846,\n     \"FocalPlaneYResolution\": 9846.153846,\n     \"FocalPlaneResolutionUnit\": \"inches\",\n     \"SensingMethod\": \"One-chip color area\",\n     \"FileSource\": \"Digital Camera\",\n     \"CustomRendered\": \"Normal\",\n     \"ExposureMode\": \"Auto\",\n     \"WhiteBalance\": \"Auto\",\n     \"DigitalZoomRatio\": 1,\n     \"SceneCaptureType\": \"Standard\",\n     \"GPSVersionID\": \"2.3.0.0\",\n     \"GPSLatitudeRef\": \"South\",\n     \"GPSLatitude\": \"17 deg 46' 23.80\\\"\",\n     \"GPSLongitudeRef\": \"East\",\n     \"GPSLongitude\": \"177 deg 21' 56.70\\\"\",\n     \"GPSAltitude\": \"1 m\",\n     \"Compression\": \"JPEG (old-style)\",\n     \"ThumbnailOffset\": 1626,\n     \"ThumbnailLength\": 4355,\n     \"ThumbnailImage\": \"(Binary data 4355 bytes, use -b option to extract)\"\n   },\n   \"MakerNotes\": {\n     \"MacroMode\": \"Normal\",\n     \"SelfTimer\": \"Off\",\n     \"Quality\": \"Fine\",\n     \"CanonFlashMode\": \"Red-eye reduction (Auto)\",\n     \"ContinuousDrive\": \"Single\",\n     \"FocusMode\": \"Single\",\n     \"RecordMode\": \"JPEG\",\n     \"CanonImageSize\": \"Large\",\n     \"EasyMode\": \"Full auto\",\n     \"DigitalZoom\": \"None\",\n     \"Contrast\": \"Normal\",\n     \"Saturation\": \"Normal\",\n     \"Sharpness\": 0,\n     \"CameraISO\": \"Auto\",\n     \"MeteringMode\": \"Evaluative\",\n     \"FocusRange\": \"Auto\",\n     \"AFPoint\": \"Auto AF point selection\",\n     \"CanonExposureMode\": \"Easy\",\n     \"LensType\": \"n/a\",\n     \"MaxFocalLength\": \"16.21875 mm\",\n     \"MinFocalLength\": \"5.40625 mm\",\n     \"FocalUnits\": \"32/mm\",\n     \"MaxAperture\": 3.7,\n     \"MinAperture\": 8,\n     \"FlashActivity\": 0,\n     \"FlashBits\": \"(none)\",\n     \"FocusContinuous\": \"Single\",\n     \"AESetting\": \"Normal AE\",\n     \"ZoomSourceWidth\": 2048,\n     \"ZoomTargetWidth\": 2048,\n     \"SpotMeteringMode\": \"AF Point\",\n     \"PhotoEffect\": \"Off\",\n     \"ManualFlashOutput\": \"n/a\",\n     \"FocalType\": \"Zoom\",\n     \"FocalLength\": \"9.40625 mm\",\n     \"FocalPlaneXSize\": \"5.41 mm\",\n     \"FocalPlaneYSize\": \"4.04 mm\",\n     \"AutoISO\": 100,\n     \"BaseISO\": 50,\n     \"MeasuredEV\": 16.00,\n     \"TargetAperture\": 5,\n     \"TargetExposureTime\": \"1/1002\",\n     \"ExposureCompensation\": 0,\n     \"WhiteBalance\": \"Auto\",\n     \"SlowShutter\": \"Off\",\n     \"SequenceNumber\": 0,\n     \"OpticalZoomCode\": 3,\n     \"FlashGuideNumber\": 0,\n     \"FlashExposureComp\": 0,\n     \"AutoExposureBracketing\": \"Off\",\n     \"AEBBracketValue\": 0,\n     \"ControlMode\": \"Camera Local Control\",\n     \"FocusDistanceUpper\": \"5.73 m\",\n     \"FocusDistanceLower\": \"0 m\",\n     \"FNumber\": 5.2,\n     \"ExposureTime\": \"1/1024\",\n     \"BulbDuration\": 0,\n     \"CameraType\": \"Compact\",\n     \"AutoRotate\": \"None\",\n     \"NDFilter\": \"Off\",\n     \"SelfTimer2\": 0,\n     \"FlashOutput\": 0,\n     \"CanonImageType\": \"IMG:PowerShot A70 JPEG\",\n     \"CanonFirmwareVersion\": \"Firmware Version 2.00\",\n     \"FileNumber\": \"104-0430\",\n     \"OwnerName\": \"Amalia & David Cole\",\n     \"CanonModelID\": \"PowerShot A70\",\n     \"NumAFPoints\": 5,\n     \"ValidAFPoints\": 5,\n     \"CanonImageWidth\": 2048,\n     \"CanonImageHeight\": 1536,\n     \"AFImageWidth\": 2048,\n     \"AFImageHeight\": 256,\n     \"AFAreaWidth\": 369,\n     \"AFAreaHeight\": 42,\n     \"AFAreaXPositions\": \"0 -370 0 370 0\",\n     \"AFAreaYPositions\": \"-48 0 0 0 48\",\n     \"AFPointsInFocus\": 2,\n     \"PrimaryAFPoint\": 2,\n     \"ThumbnailImageValidArea\": \"0 0 0 0\"\n   },\n   \"Composite\": {\n     \"DriveMode\": \"Single-frame Shooting\",\n     \"ISO\": 50,\n     \"Lens\": \"5.4 - 16.2 mm\",\n     \"ShootingMode\": \"Full auto\",\n     \"Aperture\": 5.0,\n     \"ImageSize\": \"2048x1536\",\n     \"LensID\": \"Unknown 5-16mm\",\n     \"Megapixels\": 3.1,\n     \"ScaleFactor35efl\": 6.6,\n     \"ShutterSpeed\": \"1/1000\",\n     \"GPSLatitude\": \"17 deg 46' 23.80\\\" S\",\n     \"GPSLongitude\": \"177 deg 21' 56.70\\\" E\",\n     \"Lens35efl\": \"5.4 - 16.2 mm (35 mm equivalent: 35.4 - 106.3 mm)\",\n     \"CircleOfConfusion\": \"0.005 mm\",\n     \"DOF\": \"9.38 m (1.65 - 11.02 m)\",\n     \"FOV\": \"32.6 deg\",\n     \"FocalLength35efl\": \"9.4 mm (35 mm equivalent: 61.6 mm)\",\n     \"GPSPosition\": \"17 deg 46' 23.80\\\" S, 177 deg 21' 56.70\\\" E\",\n     \"HyperfocalDistance\": \"3.86 m\",\n     \"LightValue\": 15.6\n   }\n }]\n </denchmark-code>\n \n And i'll send this photo to the email address as well.  I deleted the json and yml and saw it re-create them.  I didn't try a purge first.\n Here is the json that's been created in corresponding sidecar dir\n <denchmark-code>root@b7339846fc7f:/photoprism# cat storage/sidecar/2004/2004-06-Fiji/FijiTrip\\ 002.json\n [{\n   \"SourceFile\": \"/photoprism/originals/2004/2004-06-Fiji/FijiTrip 002.jpg\",\n   \"ExifToolVersion\": 11.88,\n   \"FileName\": \"FijiTrip 002.jpg\",\n   \"Directory\": \"/photoprism/originals/2004/2004-06-Fiji\",\n   \"FileSize\": \"921 kB\",\n   \"FileModifyDate\": \"2004:06:23 01:27:05+00:00\",\n   \"FileAccessDate\": \"2020:10:26 04:40:03+00:00\",\n   \"FileInodeChangeDate\": \"2004:06:23 01:27:05+00:00\",\n   \"FilePermissions\": \"rwxr-xr-x\",\n   \"FileType\": \"JPEG\",\n   \"FileTypeExtension\": \"jpg\",\n   \"MIMEType\": \"image/jpeg\",\n   \"ExifByteOrder\": \"Little-endian (Intel, II)\",\n   \"ImageDescription\": \"June 2004\",\n   \"Make\": \"Canon\",\n   \"Model\": \"Canon PowerShot A70\",\n   \"Orientation\": \"Horizontal (normal)\",\n   \"XResolution\": 180,\n   \"YResolution\": 180,\n   \"ResolutionUnit\": \"inches\",\n   \"Software\": \"Adobe Photoshop Album 2.0\",\n   \"ModifyDate\": \"2005:03:24 17:15:01\",\n   \"YCbCrPositioning\": \"Centered\",\n   \"ExposureTime\": \"1/1000\",\n   \"FNumber\": 5.0,\n   \"ExifVersion\": \"0220\",\n   \"DateTimeOriginal\": \"2004:06:17 09:04:12\",\n   \"CreateDate\": \"2004:06:17 09:04:12\",\n   \"ComponentsConfiguration\": \"Y, Cb, Cr, -\",\n   \"CompressedBitsPerPixel\": 3,\n   \"ShutterSpeedValue\": \"1/1002\",\n   \"ApertureValue\": 5.0,\n   \"MaxApertureValue\": 3.5,\n   \"Flash\": \"Auto, Did not fire\",\n   \"FocalLength\": \"9.4 mm\",\n   \"MacroMode\": \"Normal\",\n   \"SelfTimer\": \"Off\",\n   \"Quality\": \"Fine\",\n   \"CanonFlashMode\": \"Red-eye reduction (Auto)\",\n   \"ContinuousDrive\": \"Single\",\n   \"FocusMode\": \"Single\",\n   \"RecordMode\": \"JPEG\",\n   \"CanonImageSize\": \"Large\",\n   \"EasyMode\": \"Full auto\",\n   \"DigitalZoom\": \"None\",\n   \"Contrast\": \"Normal\",\n   \"Saturation\": \"Normal\",\n   \"Sharpness\": 0,\n   \"CameraISO\": \"Auto\",\n   \"MeteringMode\": \"Evaluative\",\n   \"FocusRange\": \"Auto\",\n   \"AFPoint\": \"Auto AF point selection\",\n   \"CanonExposureMode\": \"Easy\",\n   \"LensType\": \"n/a\",\n   \"MaxFocalLength\": \"16.21875 mm\",\n   \"MinFocalLength\": \"5.40625 mm\",\n   \"FocalUnits\": \"32/mm\",\n   \"MaxAperture\": 3.7,\n   \"MinAperture\": 8,\n   \"FlashActivity\": 0,\n   \"FlashBits\": \"(none)\",\n   \"FocusContinuous\": \"Single\",\n   \"AESetting\": \"Normal AE\",\n   \"ZoomSourceWidth\": 2048,\n   \"ZoomTargetWidth\": 2048,\n   \"SpotMeteringMode\": \"AF Point\",\n   \"PhotoEffect\": \"Off\",\n   \"ManualFlashOutput\": \"n/a\",\n   \"FocalType\": \"Zoom\",\n   \"FocalPlaneXSize\": \"5.41 mm\",\n   \"FocalPlaneYSize\": \"4.04 mm\",\n   \"AutoISO\": 100,\n   \"BaseISO\": 50,\n   \"MeasuredEV\": 16.00,\n   \"TargetAperture\": 5,\n   \"TargetExposureTime\": \"1/1002\",\n   \"ExposureCompensation\": 0,\n   \"WhiteBalance\": \"Auto\",\n   \"SlowShutter\": \"Off\",\n   \"SequenceNumber\": 0,\n   \"OpticalZoomCode\": 3,\n   \"FlashGuideNumber\": 0,\n   \"FlashExposureComp\": 0,\n   \"AutoExposureBracketing\": \"Off\",\n   \"AEBBracketValue\": 0,\n   \"ControlMode\": \"Camera Local Control\",\n   \"FocusDistanceUpper\": \"5.73 m\",\n   \"FocusDistanceLower\": \"0 m\",\n   \"BulbDuration\": 0,\n   \"CameraType\": \"Compact\",\n   \"AutoRotate\": \"None\",\n   \"NDFilter\": \"Off\",\n   \"SelfTimer2\": 0,\n   \"FlashOutput\": 0,\n   \"CanonImageType\": \"IMG:PowerShot A70 JPEG\",\n   \"CanonFirmwareVersion\": \"Firmware Version 2.00\",\n   \"FileNumber\": \"104-0430\",\n   \"OwnerName\": \"Amalia & David Cole\",\n   \"CanonModelID\": \"PowerShot A70\",\n   \"NumAFPoints\": 5,\n   \"ValidAFPoints\": 5,\n   \"CanonImageWidth\": 2048,\n   \"CanonImageHeight\": 1536,\n   \"AFImageWidth\": 2048,\n   \"AFImageHeight\": 256,\n   \"AFAreaWidth\": 369,\n   \"AFAreaHeight\": 42,\n   \"AFAreaXPositions\": \"0 -370 0 370 0\",\n   \"AFAreaYPositions\": \"-48 0 0 0 48\",\n   \"AFPointsInFocus\": 2,\n   \"PrimaryAFPoint\": 2,\n   \"ThumbnailImageValidArea\": \"0 0 0 0\",\n   \"FlashpixVersion\": \"0100\",\n   \"ColorSpace\": \"sRGB\",\n   \"ExifImageWidth\": 2048,\n   \"ExifImageHeight\": 1536,\n   \"InteropIndex\": \"R98 - DCF basic file (sRGB)\",\n   \"InteropVersion\": \"0100\",\n   \"RelatedImageWidth\": 2048,\n   \"RelatedImageHeight\": 1536,\n   \"FocalPlaneXResolution\": 9846.153846,\n   \"FocalPlaneYResolution\": 9846.153846,\n   \"FocalPlaneResolutionUnit\": \"inches\",\n   \"SensingMethod\": \"One-chip color area\",\n   \"FileSource\": \"Digital Camera\",\n   \"CustomRendered\": \"Normal\",\n   \"ExposureMode\": \"Auto\",\n   \"DigitalZoomRatio\": 1,\n   \"SceneCaptureType\": \"Standard\",\n   \"GPSVersionID\": \"2.3.0.0\",\n   \"GPSLatitudeRef\": \"South\",\n   \"GPSLongitudeRef\": \"East\",\n   \"GPSAltitude\": \"1 m\",\n   \"Compression\": \"JPEG (old-style)\",\n   \"ThumbnailOffset\": 1626,\n   \"ThumbnailLength\": 4355,\n   \"ImageWidth\": 2048,\n   \"ImageHeight\": 1536,\n   \"EncodingProcess\": \"Baseline DCT, Huffman coding\",\n   \"BitsPerSample\": 8,\n   \"ColorComponents\": 3,\n   \"YCbCrSubSampling\": \"YCbCr4:2:2 (2 1)\",\n   \"DriveMode\": \"Single-frame Shooting\",\n   \"ISO\": 50,\n   \"Lens\": \"5.4 - 16.2 mm\",\n   \"ShootingMode\": \"Full auto\",\n   \"Aperture\": 5.0,\n   \"ImageSize\": \"2048x1536\",\n   \"LensID\": \"Unknown 5-16mm\",\n   \"Megapixels\": 3.1,\n   \"ScaleFactor35efl\": 6.6,\n   \"ShutterSpeed\": \"1/1000\",\n   \"ThumbnailImage\": \"(Binary data 4355 bytes, use -b option to extract)\",\n   \"GPSLatitude\": \"17 deg 46' 23.80\\\" S\",\n   \"GPSLongitude\": \"177 deg 21' 56.70\\\" E\",\n   \"Lens35efl\": \"5.4 - 16.2 mm (35 mm equivalent: 35.4 - 106.3 mm)\",\n   \"CircleOfConfusion\": \"0.005 mm\",\n   \"DOF\": \"9.38 m (1.65 - 11.02 m)\",\n   \"FOV\": \"32.6 deg\",\n   \"FocalLength35efl\": \"9.4 mm (35 mm equivalent: 61.6 mm)\",\n   \"GPSPosition\": \"17 deg 46' 23.80\\\" S, 177 deg 21' 56.70\\\" E\",\n   \"HyperfocalDistance\": \"3.86 m\",\n   \"LightValue\": 15.6\n }]\n \n </denchmark-code>\n \n It has GPS co-ords in it.   But yml doesn't\n <denchmark-code>root@b7339846fc7f:/photoprism# cat storage/sidecar/2004/2004-06-Fiji/FijiTrip\\ 002.yml\n TakenAt: 2004-06-16T21:04:12Z\n TakenSrc: meta\n UID: pqiklcs7ukyeemgu\n Type: image\n Title: Dock / Nadi / 2004\n Description: June 2004\n DescriptionSrc: meta\n PlaceSrc: estimate\n Year: 2004\n Month: 6\n Day: 17\n ISO: 50\n Exposure: 1/1000\n FNumber: 5\n FocalLength: 9\n Details:\n   Keywords: blue, dock, fiji, fijitrip\n CreatedAt: 2020-10-21T21:07:40.077478311Z\n UpdatedAt: 2020-10-26T04:40:13.195790567Z\n </denchmark-code>\n \n Nor looking at the image details.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "psyciknz", "commentT": "2020-10-26T05:12:37Z", "comment_text": "\n \t\tThanks! Might take a couple of days until I get to this...\n There might be an issue with our duplicates table: Files that have been deleted from the index should also be removed there, otherwise they will continue to be skipped even though the original file doesn't exist anymore.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "psyciknz", "commentT": "2020-11-02T17:17:06Z", "comment_text": "\n \t\tI am also running in this issue. My scenario is the same, I have many unlocated images and want to add gps-data with DigiKam and reindex the files.\n When reindexing the process notices that the correct file has changed and updates it accordingly:\n <denchmark-code>2020-11-02 18:11:37 INFO Indizierung in 6 s abgeschlossen\n 2020-11-02 18:11:37 INFO purge: searching index for hidden media files\n 2020-11-02 18:11:37 INFO index: updated main jpg file Urlaub/Hamburg/2020-08-29/IMG_20200829_221843.jpg\n 2020-11-02 18:11:37 INFO mediafile: 7 thumbnails created for IMG_20200829_221843 [2.035743082s]\n 2020-11-02 18:11:31 INFO index: no .ppignore file found\n 2020-11-02 18:11:31 INFO Indiziere Dateien in Urlaub/Hamburg/2020-08-29\n </denchmark-code>\n \n But when looking at the details of the file in PhotoPrism it only changed the time zone and not the longitude and latitude of the file. The time zone is correctly set though.\n I rechecked if the EXIF informations are correctly set by DigiKam but they are and EXIFtools reads them correctly (I set it to Tokyo on purpose so I see if it changed and appears on the map):\n <denchmark-code>[{\n   \"SourceFile\": \"IMG_20200829_221843.jpg\",\n   \"ExifTool\": {\n     \"ExifToolVersion\": 11.88\n   },\n   \"File\": {\n     \"FileName\": \"IMG_20200829_221843.jpg\",\n     \"Directory\": \".\",\n     \"FileSize\": \"4.8 MB\",\n     \"FileModifyDate\": \"2020:11:02 17:10:38+00:00\",\n     \"FileAccessDate\": \"2020:11:01 21:26:08+00:00\",\n     \"FileInodeChangeDate\": \"2020:11:02 17:10:38+00:00\",\n     \"FilePermissions\": \"rwxrwxrwx\",\n     \"FileType\": \"JPEG\",\n     \"FileTypeExtension\": \"jpg\",\n     \"MIMEType\": \"image/jpeg\",\n     \"ExifByteOrder\": \"Big-endian (Motorola, MM)\",\n     \"CurrentIPTCDigest\": \"3037d18e90261f9c8ffbd1840ad86ac1\",\n     \"ImageWidth\": 4608,\n     \"ImageHeight\": 3456,\n     \"EncodingProcess\": \"Baseline DCT, Huffman coding\",\n     \"BitsPerSample\": 8,\n     \"ColorComponents\": 3,\n     \"YCbCrSubSampling\": \"YCbCr4:2:0 (2 2)\"\n   },\n   \"EXIF\": {\n     \"ImageWidth\": 4608,\n     \"ImageHeight\": 3456,\n     \"Make\": \"OnePlus\",\n     \"Model\": \"ONEPLUS A6000\",\n     \"Orientation\": \"Rotate 90 CW\",\n     \"XResolution\": 72,\n     \"YResolution\": 72,\n     \"ResolutionUnit\": \"inches\",\n     \"ModifyDate\": \"2020:08:29 22:18:44\",\n     \"YCbCrPositioning\": \"Centered\",\n     \"ExposureTime\": \"1/25\",\n     \"FNumber\": 1.7,\n     \"ExposureProgram\": \"Program AE\",\n     \"ISO\": 250,\n     \"ExifVersion\": \"0220\",\n     \"DateTimeOriginal\": \"2020:08:29 22:18:44\",\n     \"CreateDate\": \"2020:08:29 22:18:44\",\n     \"ComponentsConfiguration\": \"Y, Cb, Cr, -\",\n     \"ShutterSpeedValue\": \"1/25\",\n     \"ApertureValue\": 1.7,\n     \"BrightnessValue\": -3.58,\n     \"ExposureCompensation\": 0,\n     \"MaxApertureValue\": 1.7,\n     \"MeteringMode\": \"Center-weighted average\",\n     \"LightSource\": \"Unknown\",\n     \"Flash\": \"Off, Did not fire\",\n     \"FocalLength\": \"4.2 mm\",\n     \"SubSecTime\": 176822,\n     \"SubSecTimeOriginal\": 176822,\n     \"SubSecTimeDigitized\": 176822,\n     \"FlashpixVersion\": \"0100\",\n     \"ColorSpace\": \"sRGB\",\n     \"ExifImageWidth\": 4608,\n     \"ExifImageHeight\": 3456,\n     \"InteropIndex\": \"R98 - DCF basic file (sRGB)\",\n     \"InteropVersion\": \"0100\",\n     \"SensingMethod\": \"Not defined\",\n     \"SceneType\": \"Directly photographed\",\n     \"ExposureMode\": \"Auto\",\n     \"WhiteBalance\": \"Auto\",\n     \"FocalLengthIn35mmFormat\": \"25 mm\",\n     \"SceneCaptureType\": \"Standard\",\n     \"GPSVersionID\": \"2.0.0.0\",\n     \"GPSLatitudeRef\": \"North\",\n     \"GPSLatitude\": \"35 deg 40' 58.22\\\"\",\n     \"GPSLongitudeRef\": \"East\",\n     \"GPSLongitude\": \"139 deg 45' 34.04\\\"\",\n     \"GPSMapDatum\": \"WGS-84\"\n   },\n   \"XMP\": {\n     \"XMPToolkit\": \"XMP Core 4.4.0-Exiv2\",\n     \"CaptureMode\": \"Photo\",\n     \"Scene\": \"AutoHDR\",\n     \"IsHDRActive\": false,\n     \"IsNightModeActive\": false,\n     \"SceneDetectResultIds\": \"[44, 60]\",\n     \"SceneDetectResultConfidences\": \"[0.9999963, 0.94408643]\",\n     \"LensFacing\": \"Back\",\n     \"DateTimeOriginal\": \"2020:08:29 22:18:44\",\n     \"GPSVersionID\": \"2.0.0.0\",\n     \"GPSMapDatum\": \"WGS-84\",\n     \"GPSLatitudeRef\": \"N\",\n     \"GPSLatitude\": \"35 deg 40' 58.22\\\" N\",\n     \"GPSLongitudeRef\": \"E\",\n     \"GPSLongitude\": \"139 deg 45' 34.04\\\" E\",\n     \"DateCreated\": \"2020:08:29 22:18:44\",\n     \"Urgency\": \"0 (reserved)\",\n     \"DateTime\": \"2020:08:29 22:18:44\",\n     \"CreateDate\": \"2020:08:29 22:18:44\",\n     \"MetadataDate\": \"2020:08:29 22:18:44\",\n     \"ModifyDate\": \"2020:08:29 22:18:44\",\n     \"DateUTC\": \"2020:08:29 22:18:44\",\n     \"ModificationDate\": \"2020:08:29 22:18:44\",\n     \"PickLabel\": 0,\n     \"ColorLabel\": 0\n   },\n   \"IPTC\": {\n     \"CodedCharacterSet\": \"UTF8\",\n     \"DateCreated\": \"2020:08:29\",\n     \"TimeCreated\": \"22:18:44+00:00\"\n   },\n   \"Composite\": {\n     \"Aperture\": 1.7,\n     \"ImageSize\": \"4608x3456\",\n     \"Megapixels\": 15.9,\n     \"ScaleFactor35efl\": 5.9,\n     \"ShutterSpeed\": \"1/25\",\n     \"SubSecCreateDate\": \"2020:08:29 22:18:44.176822\",\n     \"SubSecDateTimeOriginal\": \"2020:08:29 22:18:44.176822\",\n     \"SubSecModifyDate\": \"2020:08:29 22:18:44.176822\",\n     \"GPSLatitude\": \"35 deg 40' 58.22\\\" N\",\n     \"GPSLongitude\": \"139 deg 45' 34.04\\\" E\",\n     \"DateTimeCreated\": \"2020:08:29 22:18:44+00:00\",\n     \"GPSLatitudeRef\": \"North\",\n     \"GPSLongitudeRef\": \"East\",\n     \"CircleOfConfusion\": \"0.005 mm\",\n     \"FOV\": \"71.5 deg\",\n     \"FocalLength35efl\": \"4.2 mm (35 mm equivalent: 25.0 mm)\",\n     \"GPSPosition\": \"35 deg 40' 58.22\\\" N, 139 deg 45' 34.04\\\" E\",\n     \"HyperfocalDistance\": \"2.08 m\",\n     \"LightValue\": 4.9\n   }\n }]\n </denchmark-code>\n \n I believe the process to reindex files is missing the function to adjust the longitude and latitude accordingly.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "psyciknz", "commentT": "2020-11-22T02:36:46Z", "comment_text": "\n \t\tGoing to look at this next...\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "psyciknz", "commentT": "2020-12-04T21:07:09Z", "comment_text": "\n \t\tHope this solves your issue \ud83d\ude03\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "psyciknz", "commentT": "2020-12-05T19:41:04Z", "comment_text": "\n \t\tI'll give it a go, by exit, does that include data in an xmp file?\n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "psyciknz", "commentT": "2020-12-05T19:47:00Z", "comment_text": "\n \t\tYou don't use Exif? Getting a bit more complex otherwise as we need to add config options for what data has priority under what conditions....\n \t\t"}, "comments_14": {"comment_id": 15, "comment_author": "psyciknz", "commentT": "2020-12-05T20:30:21Z", "comment_text": "\n \t\tI think xmp is an extension of exif?  More for categorisation I\u2019m hoping.  Exif for location camera etc taken at shoot time.   V ahh but yea I was updating the exit information on these photos I think.  I don\u2019t think lat/long goes into an xmp file.\n Xmp for post camera categorisation.  That\u2019s how I\u2019m hoping to use it.   The advantage with xmp is that it doesn\u2019t alter the image file.\n I think exiftool must do the reading of xmp automatically?  Not sure how that works.\n \t\t"}, "comments_15": {"comment_id": 16, "comment_author": "psyciknz", "commentT": "2020-12-05T20:38:43Z", "comment_text": "\n \t\tIt's a meta data container. Exif is old and relatively simple in comparison. XMP may contain Exif fields in addition to everything else.\n \t\t"}}}, "commit": {"commit_id": "c4a94f8135613c5b5baec4d9395d6e3dd29ecc2a", "commit_author": "Michael Mayer", "commitT": "2020-12-04 22:06:23+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "internal\\meta\\exif_test.go", "file_new_name": "internal\\meta\\exif_test.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "256,257", "deleted_lines": "256,257", "method_info": {"method_name": "", "method_params": "", "method_startline": "239", "method_endline": "265"}}, "hunk_1": {"Ismethod": 1, "added_lines": "256,257", "deleted_lines": "256,257", "method_info": {"method_name": "TestExif", "method_params": "T", "method_startline": "10", "method_endline": "420"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\meta\\json_exiftool.go", "file_new_name": "internal\\meta\\json_exiftool.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "66,67,98,99,100,101,102,103,104,105", "deleted_lines": "66,97,98,99,100,101,102", "method_info": {"method_name": "Exiftool", "method_params": "byte,string", "method_startline": "18", "method_endline": "192"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\meta\\json_gphotos.go", "file_new_name": "internal\\meta\\json_gphotos.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "105,109,113,118,119,120,121,122,123,124,128,129,130,131,132,133,134,135", "deleted_lines": "105,109,113,118,119,123,124,125", "method_info": {"method_name": "GPhoto", "method_params": "byte", "method_startline": "92", "method_endline": "161"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "internal\\photoprism\\metadata_test.go", "file_new_name": "internal\\photoprism\\metadata_test.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "160,161,163", "deleted_lines": "160,161,163", "method_info": {"method_name": "", "method_params": "", "method_startline": "138", "method_endline": "174"}}, "hunk_1": {"Ismethod": 1, "added_lines": "160,161,163", "deleted_lines": "160,161,163", "method_info": {"method_name": "TestMediaFile_Exif_JPEG", "method_params": "T", "method_startline": "12", "method_endline": "175"}}}}}}}