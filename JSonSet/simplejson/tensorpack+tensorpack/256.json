{"BR": {"BR_id": "256", "BR_author": "msbauer", "BRopenT": "2017-05-08T09:19:44Z", "BRcloseT": "2017-05-08T16:24:44Z", "BR_text": {"BRsummary": "OfflinePredictor broken on the current master", "BRdescription": "\n Hi,\n I don't fully understand what the problem is exactly, so I hope I can describe it in an understandable way.\n Basically, I have a trained network on which I want to run an OfflinePredictor several times (b/c I have several batches of data that I want to predict on). So far, this all worked nicely.\n On the current master the OfflinePredictor runs once without problems and on the second attempt I get the following error message:\n <denchmark-code>[0508 11:02:52 @cifar_dataset.py:36] Found cifar100 data in /..../tensorpack_data/cifar100_data.\n before calling \n [0508 11:02:52 @common.py:128] conv1_1 input: [None, 32, 32, 3]\n [0508 11:02:52 @common.py:136] conv1_1 output: [None, 32, 32, 64]\n [0508 11:02:52 @common.py:128] conv1_2 input: [None, 32, 32, 64]\n [0508 11:02:52 @common.py:136] conv1_2 output: [None, 32, 32, 64]\n [0508 11:02:52 @common.py:128] pool1 input: [None, 32, 32, 64]\n [0508 11:02:52 @common.py:136] pool1 output: [None, 16, 16, 64]\n [0508 11:02:52 @common.py:128] conv2_1 input: [None, 16, 16, 64]\n [0508 11:02:52 @common.py:136] conv2_1 output: [None, 16, 16, 128]\n [0508 11:02:52 @common.py:128] conv2_2 input: [None, 16, 16, 128]\n [0508 11:02:52 @common.py:136] conv2_2 output: [None, 16, 16, 128]\n [0508 11:02:52 @common.py:128] pool2 input: [None, 16, 16, 128]\n [0508 11:02:52 @common.py:136] pool2 output: [None, 8, 8, 128]\n [0508 11:02:52 @common.py:128] conv3_1 input: [None, 8, 8, 128]\n [0508 11:02:52 @common.py:136] conv3_1 output: [None, 8, 8, 256]\n [0508 11:02:52 @common.py:128] conv3_2 input: [None, 8, 8, 256]\n [0508 11:02:52 @common.py:136] conv3_2 output: [None, 8, 8, 256]\n [0508 11:02:52 @common.py:128] pool3 input: [None, 8, 8, 256]\n [0508 11:02:52 @common.py:136] pool3 output: [None, 4, 4, 256]\n [0508 11:02:52 @common.py:128] conv4_1 input: [None, 4, 4, 256]\n [0508 11:02:52 @common.py:136] conv4_1 output: [None, 4, 4, 512]\n [0508 11:02:52 @common.py:128] conv4_2 input: [None, 4, 4, 512]\n [0508 11:02:53 @common.py:136] conv4_2 output: [None, 4, 4, 512]\n [0508 11:02:53 @common.py:128] pool4 input: [None, 4, 4, 512]\n [0508 11:02:53 @common.py:136] pool4 output: [None, 2, 2, 512]\n [0508 11:02:53 @common.py:128] fc6 input: [None, 2, 2, 512]\n [0508 11:02:53 @common.py:136] fc6 output: [None, 1024]\n [0508 11:02:53 @common.py:128] fc7 input: [None, 1024]\n [0508 11:02:53 @common.py:136] fc7 output: [None, 512]\n [0508 11:02:53 @common.py:128] fc8 input: [None, 512]\n [0508 11:02:53 @common.py:136] fc8 output: [None, 90]\n [0508 11:02:53 @regularize.py:18] Apply regularizer for fc6/W:0\n [0508 11:02:53 @regularize.py:18] Apply regularizer for fc7/W:0\n [0508 11:02:53 @regularize.py:18] Apply regularizer for fc8/W:0\n 2017-05-08 11:02:53.069260: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.\n 2017-05-08 11:02:53.069280: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.\n 2017-05-08 11:02:53.069288: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.\n 2017-05-08 11:02:53.069294: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.\n 2017-05-08 11:02:53.069300: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.\n [0508 11:02:53 @sessinit.py:128] WRN Variable beta1_power:0 in checkpoint not found in the graph!\n [0508 11:02:53 @sessinit.py:128] WRN Variable beta2_power:0 in checkpoint not found in the graph!\n [0508 11:02:53 @sessinit.py:128] WRN Variable input_queue_size/EMA:0 in checkpoint not found in the graph!\n [0508 11:02:53 @sessinit.py:128] WRN Variable learning_rate:0 in checkpoint not found in the graph!\n [0508 11:02:53 @sessinit.py:100] Restoring checkpoint from /XXXX/model-39000 ...\n INFO:tensorflow:Restoring parameters from /XXXX/model-39000\n INFO:tensorflow:Restoring parameters from /XXXX/model-39000\n after calling\n (256,)\n [0 6 7 7 0 8 2 5 9 3]\n before calling \n Traceback (most recent call last):\n   File \"cifar_laplace.py\", line 243, in <module>\n     run_experiment(cifar_set_parameters.get_set_parameters(set_id=int(args.set)))\n   File \"cifar_laplace.py\", line 108, in run_experiment\n     x_train, y_train = utils.get_batch_cifar(checkpoint_file, 100, classes_kshot, 'train', set_id=set_id)\n   File \"..../oneshot_code/utils.py\", line 111, in get_batch_cifar\n     acts = cifar_convnet.network_activation(dp[0], file_name, n_split=n_split)\n   File \"..../cifar_convnet.py\", line 186, in network_activation\n     output_names=['fc_activation']\n   File \"..../tensorpack/predict/base.py\", line 141, in __init__\n     config.model.build_graph(input_placehdrs)\n   File \"..../tensorpack/models/model_desc.py\", line 116, in build_graph\n     self._build_graph(model_inputs)\n   File \"..../cifar_convnet.py\", line 92, in _build_graph\n     add_moving_summary(tf.reduce_mean(wrong, name='train_error'))\n   File \"..../tensorpack/tfutils/summary.py\", line 162, in add_moving_summary\n     avg_maintain_op = averager.apply(v)\n   File \"..../tensorflow/python/training/moving_averages.py\", line 387, in apply\n     (1.0 + num_updates) / (10.0 + num_updates))\n   File \"..../tensorflow/python/ops/gen_math_ops.py\", line 1392, in minimum\n     result = _op_def_lib.apply_op(\"Minimum\", x=x, y=y, name=name)\n   File \"..../tensorflow/python/framework/op_def_library.py\", line 331, in apply_op\n     g = ops._get_graph_from_inputs(_Flatten(keywords.values()))\n   File \"..../tensorflow/python/framework/ops.py\", line 3912, in _get_graph_from_inputs\n     _assert_same_graph(original_graph_element, graph_element)\n   File \"..../tensorflow/python/framework/ops.py\", line 3851, in _assert_same_graph\n     \"%s must be from the same graph as %s.\" % (item, original_item))\n ValueError: Tensor(\"EMA/decay:0\", shape=(), dtype=float32) must be from the same graph as Tensor(\"truediv:0\", shape=(), dtype=float32).\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "msbauer", "commentT": "2017-05-08T13:34:39Z", "comment_text": "\n \t\talso seeing this.\n in image2image.py after\n GANTrainer(config).train()\n i added:\n model_file = os.path.join(logger.LOG_DIR, 'checkpoint')\n sample(args.data, model_file)\n this used to work. but after recent changes to master i am getting:\n Traceback (most recent call last):\n File \"Image2Image.py\", line 230, in \n sample(args.data, model_file)\n File \"Image2Image.py\", line 199, in sample\n pred = SimpleDatasetPredictor(pred, ds)\n File \"C:\\Anaconda3\\lib\\site-packages\\tensorpack\\predict\\dataset.py\", line 65, in init\n self.predictor = OfflinePredictor(config)\n File \"C:\\Anaconda3\\lib\\site-packages\\tensorpack\\predict\\base.py\", line 141, in init\n config.model.build_graph(input_placehdrs)\n File \"C:\\Anaconda3\\lib\\site-packages\\tensorpack\\models\\model_desc.py\", line 116, in build_graph\n self._build_graph(model_inputs)\n File \"Image2Image.py\", line 118, in _build_graph\n self.build_losses(real_pred, fake_pred)\n File \"C:\\Users\\eyaler\\Dropbox\\python\\tensorpack\\examples\\GAN\\GAN.py\", line 54, in build_losses\n add_moving_summary(self.g_loss, self.d_loss, d_accuracy, g_accuracy)\n File \"C:\\Anaconda3\\lib\\site-packages\\tensorpack\\tfutils\\summary.py\", line 162, in add_moving_summary\n avg_maintain_op = averager.apply(v)\n File \"C:\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\training\\moving_averages.py\", line 387, in apply\n (1.0 + num_updates) / (10.0 + num_updates))\n File \"C:\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\ops\\gen_math_ops.py\", line 1392, in minimum\n result = _op_def_lib.apply_op(\"Minimum\", x=x, y=y, name=name)\n File \"C:\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 331, in apply_op\n g = ops._get_graph_from_inputs(_Flatten(keywords.values()))\n File \"C:\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3912, in _get_graph_from_inputs\n _assert_same_graph(original_graph_element, graph_element)\n File \"C:\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 3851, in _assert_same_graph\n \"%s must be from the same graph as %s.\" % (item, original_item))\n ValueError: Tensor(\"truediv_2:0\", shape=(), dtype=float32) must be from the same graph as Tensor(\"EMA/decay:0\", shape=(), dtype=float32).\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "msbauer", "commentT": "2017-05-08T16:25:12Z", "comment_text": "\n \t\tThanks for reporting. Should be fixed now.\n \t\t"}}}, "commit": {"commit_id": "f9fc329b7b12064c5d59c4781cef265e36810f24", "commit_author": "Yuxin Wu", "commitT": "2017-05-08 09:24:39-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorpack\\predict\\base.py", "file_new_name": "tensorpack\\predict\\base.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "140", "deleted_lines": "140", "method_info": {"method_name": "__init__", "method_params": "self,config", "method_startline": "132", "method_endline": "149"}}}}}}}