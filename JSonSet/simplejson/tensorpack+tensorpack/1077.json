{"BR": {"BR_id": "1077", "BR_author": "JamesBrightman", "BRopenT": "2019-02-11T13:13:30Z", "BRcloseT": "2019-02-11T17:16:49Z", "BR_text": {"BRsummary": "'TrainConfig' object has no attribute 'nr_tower' (A3C)", "BRdescription": "\n <denchmark-h:h3>1. What I did:</denchmark-h>\n \n I'm trying to train Breakout on google colab using the A3C implementation. Whenever I run\n !python train-atari.py --env Breakout-v0 --gpu 0\n It causes an error;\n Traceback (most recent call last):\n File \"train-atari.py\", line 301, in \n train()\n File \"train-atari.py\", line 262, in train\n trainer = SimpleTrainer() if config.nr_tower == 1 else AsyncMultiGPUTrainer(train_tower)\n AttributeError: 'TrainConfig' object has no attribute 'nr_tower'\n It doesn't matter what Colab settings I use - normal, GPU enhanced or TPU enhanced, it happens on all.\n Any ideas of a fix/ workaround? Previously I commented out from '# == 1 else AsyncMultiGPUTrainer(train_tower)' but as my epochs are taking hours to run and should apparently take ~20 mins, I feel this may be a problem.\n Thanks.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "JamesBrightman", "commentT": "2019-02-11T17:16:23Z", "comment_text": "\n \t\tconfig.nr_tower should be num_gpu instead. Thanks for the report!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "JamesBrightman", "commentT": "2019-02-11T17:45:49Z", "comment_text": "\n \t\tFixes that issue, thanks. Doesn't fix the fact that it's forecast to train 1 epoch in over 10 hours with an it/s speed of ~10. Any thoughts on why this might be?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "JamesBrightman", "commentT": "2019-02-11T18:01:58Z", "comment_text": "\n \t\tIf it/s is really 10, and STEPS_PER_EPOCH is defined 6000 (\n \n \n tensorpack/examples/A3C-Gym/train-atari.py\n \n \n          Line 40\n       in\n       4967559\n \n \n \n \n \n \n  STEPS_PER_EPOCH = 6000 \n \n \n \n \n  )\n Then you should finish 1 epoch in 10 minutes, right?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "JamesBrightman", "commentT": "2019-02-11T18:05:10Z", "comment_text": "\n \t\tYeah. that's exactly why i'm confused!\n I just lowered it to 1000 STEPS_PER_EPOCH (to see if anything would change) and as you can see for them attached pic, I have 10 it/s but apparently, it will still take nearly 3 hours.\n <denchmark-link:https://user-images.githubusercontent.com/35103224/52583366-51a6d100-2e27-11e9-88b3-24d40035561e.png></denchmark-link>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "JamesBrightman", "commentT": "2019-02-11T18:08:10Z", "comment_text": "\n \t\tYou have 10s/it, not 10it/s.\n From your log it does not appear that you're using GPU. Normally tensorflow should print something GPU-related when creating the session.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "JamesBrightman", "commentT": "2019-02-11T18:13:22Z", "comment_text": "\n \t\twelp, my bad. As for the GPU training it seems you're right if it's as long as 10s/it. Looking though the messages I do get this;\n [0211 18:01:46 @gpu.py:43] WRN Found non-empty CUDA_VISIBLE_DEVICES. But TensorFlow was not built with CUDA support!\n when I run it with;\n !python train-atari.py --env Breakout-v0 --gpu 1 or\n !python train-atari.py --env Breakout-v0 --gpu 0\n Is there a different set up that is needed for training in tensorflow to allow GPU training?\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "JamesBrightman", "commentT": "2019-02-11T18:15:51Z", "comment_text": "\n \t\tApparently it's telling you that your tensorflow does not support CUDA. You need a different version of tensorflow and I'm not familiar with how it work in colab\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "JamesBrightman", "commentT": "2019-02-11T18:20:51Z", "comment_text": "\n \t\tOk thanks, I'll look to change tensorflow version. If anyone runs into this problem my current Colab library versions are;\n <denchmark-code>tensor2tensor            1.11.0               \n tensorboard              1.12.2               \n tensorboardcolab         0.0.22               \n tensorflow               1.13.0rc0            \n tensorflow-estimator     1.10.12              \n tensorflow-hub           0.2.0                \n tensorflow-metadata      0.9.0                \n tensorflow-probability   0.5.0                \n tensorflow-tensorboard   1.5.1                \n tensorpack               0.9.1   \n tf-estimator-nightly     1.14.0.dev2019021101 \n tf-nightly               1.13.0.dev20190208   \n tfds-nightly             0.0.2.dev201902070013\n </denchmark-code>\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "JamesBrightman", "commentT": "2019-02-11T18:23:46Z", "comment_text": "\n \t\tYou need either tensorflow-gpu or tf-nightly-gpu (and only one of them but not two).\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "JamesBrightman", "commentT": "2019-02-11T18:28:21Z", "comment_text": "\n \t\tAh ok, and I assume this means removing traces of non-gpu tensorflow libraries? eg/ removing\n <denchmark-code>tensorflow-estimator     1.10.12              \n tensorflow-hub           0.2.0                \n tensorflow-metadata      0.9.0                \n tensorflow-probability   0.5.0                \n tensorflow-tensorboard   1.5.1\n tf-estimator-nightly     1.14.0.dev2019021101 \n tf-nightly               1.13.0.dev20190208\n </denchmark-code>\n \n ?\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "JamesBrightman", "commentT": "2019-02-11T18:36:48Z", "comment_text": "\n \t\tI don't know whether the other packages affect this but you can remove them all, and they will be automatically installed if tensorflow actually depends on them.\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "JamesBrightman", "commentT": "2019-02-11T19:08:42Z", "comment_text": "\n \t\tThis was a LOT harder than I expected, I feel like i've been install and uninstalling packages for hours. I'll paste a list of all colab library versions so that if anyone else has this problem hopefully this will solve it.\n Currently running at ~3s/it (not 3it/s! haha).\n Appreciate all the help, this stuff is hard to learn as a beginner!\n <denchmark-code>Package                  Version              \n ------------------------ ---------------------\n absl-py                  0.7.0                \n alabaster                0.7.12               \n albumentations           0.1.12               \n altair                   2.3.0                \n astor                    0.7.1                \n astropy                  3.0.5                \n atari-py                 0.1.7                \n atomicwrites             1.3.0                \n attrs                    18.2.0               \n audioread                2.1.6                \n autograd                 1.2                  \n Babel                    2.6.0                \n backports.tempfile       1.0                  \n backports.weakref        1.0.post1            \n batchglm                 0.4.1                \n beautifulsoup4           4.6.3                \n bleach                   1.5.0                \n bokeh                    1.0.4                \n boto                     2.49.0               \n boto3                    1.9.89               \n botocore                 1.12.89              \n Bottleneck               1.2.1                \n bs4                      0.0.1                \n bz2file                  0.98                 \n cachetools               3.1.0                \n certifi                  2018.11.29           \n cffi                     1.11.5               \n cftime                   1.0.3.4              \n chainer                  5.0.0                \n chardet                  3.0.4                \n Click                    7.0                  \n cloudpickle              0.6.1                \n cmake                    3.12.0               \n colorlover               0.3.0                \n community                1.0.0b1              \n contextlib2              0.5.5                \n convertdate              2.1.3                \n coverage                 3.7.1                \n coveralls                0.5                  \n crcmod                   1.7                  \n cufflinks                0.14.6               \n cupy-cuda100             5.2.0                \n cvxopt                   1.2.3                \n cvxpy                    1.0.14               \n cycler                   0.10.0               \n cymem                    2.0.2                \n Cython                   0.29.4               \n cytoolz                  0.9.0.1              \n daft                     0.0.4                \n dask                     0.20.2               \n dataclasses              0.6                  \n datascience              0.10.6               \n decorator                4.3.2                \n defusedxml               0.5.0                \n diffxpy                  0.4.2                \n dill                     0.2.9                \n distributed              1.25.3               \n Django                   2.1.5                \n dlib                     19.16.0              \n dm-sonnet                1.23                 \n docopt                   0.6.2                \n docutils                 0.14                 \n dopamine-rl              1.0.5                \n easydict                 1.9                  \n ecos                     2.0.7.post1          \n editdistance             0.5.2                \n en-core-web-sm           2.0.0                \n entrypoints              0.3                  \n enum34                   1.1.6                \n ephem                    3.7.6.0              \n et-xmlfile               1.0.1                \n fa2                      0.3.5                \n fancyimpute              0.4.2                \n fastai                   1.0.42               \n fastcache                1.0.2                \n fastdtw                  0.3.2                \n fastprogress             0.1.18               \n fastrlock                0.4                  \n fbprophet                0.4.post2            \n featuretools             0.4.1                \n filelock                 3.0.10               \n fix-yahoo-finance        0.0.22               \n Flask                    1.0.2                \n folium                   0.2.1                \n future                   0.16.0               \n gast                     0.2.2                \n GDAL                     2.2.2                \n gdown                    3.6.4                \n gensim                   3.6.0                \n geographiclib            1.49                 \n geopy                    1.17.0               \n gevent                   1.4.0                \n gin-config               0.1.2                \n glob2                    0.6                  \n google                   2.0.1                \n google-api-core          1.7.0                \n google-api-python-client 1.6.7                \n google-auth              1.4.2                \n google-auth-httplib2     0.0.3                \n google-auth-oauthlib     0.2.0                \n google-cloud-bigquery    1.8.1                \n google-cloud-core        0.29.1               \n google-cloud-language    1.0.2                \n google-cloud-storage     1.8.0                \n google-cloud-translate   1.3.3                \n google-colab             0.0.1a1              \n google-pasta             0.1.1                \n google-resumable-media   0.3.2                \n googleapis-common-protos 1.5.6                \n googledrivedownloader    0.3                  \n graph-nets               1.0.2                \n graphviz                 0.10.1               \n greenlet                 0.4.15               \n grpcio                   1.15.0               \n gspread                  3.0.1                \n gspread-dataframe        3.0.2                \n gunicorn                 19.9.0               \n gym                      0.10.11              \n h5netcdf                 0.6.2                \n h5py                     2.8.0                \n HeapDict                 1.0.0                \n holidays                 0.9.9                \n html5lib                 0.9999999            \n httpimport               0.5.16               \n httplib2                 0.11.3               \n humanize                 0.5.1                \n hyperopt                 0.1.1                \n ideep4py                 2.0.0.post3          \n idna                     2.6                  \n image                    1.5.27               \n imageio                  2.4.1                \n imagesize                1.1.0                \n imbalanced-learn         0.4.3                \n imblearn                 0.0                  \n imgaug                   0.2.6                \n imutils                  0.5.2                \n inflect                  2.1.0                \n intel-openmp             2019.0               \n intervaltree             2.1.0                \n ipykernel                4.6.1                \n ipython                  5.5.0                \n ipython-genutils         0.2.0                \n ipython-sql              0.3.9                \n ipywidgets               7.4.2                \n itsdangerous             1.1.0                \n jdcal                    1.4                  \n jieba                    0.39                 \n Jinja2                   2.10                 \n jmespath                 0.9.3                \n joblib                   0.13.1               \n jpeg4py                  0.1.4                \n jsonschema               2.6.0                \n jupyter                  1.0.0                \n jupyter-client           5.2.4                \n jupyter-console          6.0.0                \n jupyter-core             4.4.0                \n kaggle                   1.5.2                \n kapre                    0.1.3.1              \n Keras                    2.2.4                \n Keras-Applications       1.0.7                \n Keras-Preprocessing      1.0.9                \n keras-vis                0.4.1                \n kiwisolver               1.0.1                \n knnimpute                0.1.0                \n librosa                  0.6.2                \n lightgbm                 2.2.3                \n llvmlite                 0.27.0               \n lmdb                     0.94                 \n lucid                    0.3.8                \n lunardate                0.2.0                \n lxml                     4.2.6                \n magenta                  0.3.19               \n Markdown                 3.0.1                \n MarkupSafe               1.1.0                \n matplotlib               3.0.2                \n matplotlib-venn          0.11.5               \n mesh-tensorflow          0.0.5                \n mido                     1.2.6                \n mir-eval                 0.5                  \n missingno                0.4.1                \n mistune                  0.8.4                \n mkl                      2019.0               \n mlxtend                  0.14.0               \n mock                     2.0.0                \n more-itertools           5.0.0                \n moviepy                  0.2.3.5              \n mpi4py                   3.0.0                \n mpmath                   1.1.0                \n msgpack                  0.5.6                \n msgpack-numpy            0.4.4.2              \n multiprocess             0.70.7               \n multitasking             0.0.7                \n murmurhash               1.0.1                \n music21                  5.5.0                \n natsort                  5.5.0                \n nbconvert                5.4.0                \n nbformat                 4.4.0                \n netCDF4                  1.4.2                \n networkx                 2.2                  \n nibabel                  2.3.3                \n nltk                     3.2.5                \n nose                     1.3.7                \n notebook                 5.2.2                \n np-utils                 0.5.9.0              \n numba                    0.40.1               \n numexpr                  2.6.9                \n numpy                    1.14.6               \n nvidia-ml-py3            7.352.0              \n oauth2client             4.1.3                \n oauthlib                 3.0.1                \n okgrade                  0.4.3                \n olefile                  0.46                 \n opencv-contrib-python    3.4.3.18             \n opencv-python            3.4.5.20             \n openpyxl                 2.5.9                \n osqp                     0.5.0                \n packaging                19.0                 \n pandas                   0.22.0               \n pandas-datareader        0.7.0                \n pandas-gbq               0.4.1                \n pandas-profiling         1.4.1                \n pandocfilters            1.4.2                \n pathlib                  1.0.1                \n patsy                    0.5.1                \n pbr                      5.1.2                \n pexpect                  4.6.0                \n pickleshare              0.7.5                \n Pillow                   4.0.0                \n pip                      19.0.1               \n plac                     0.9.6                \n plotly                   1.12.12              \n pluggy                   0.8.1                \n portpicker               1.2.0                \n prefetch-generator       1.0.1                \n preshed                  2.0.1                \n pretty-midi              0.2.8                \n prettytable              0.7.2                \n progressbar2             3.38.0               \n promise                  2.2.1                \n prompt-toolkit           1.0.15               \n protobuf                 3.6.1                \n psutil                   5.4.8                \n psycopg2                 2.7.6.1              \n ptyprocess               0.6.0                \n py                       1.7.0                \n pyasn1                   0.4.5                \n pyasn1-modules           0.2.4                \n pycocotools              2.0.0                \n pycparser                2.19                 \n pydot                    1.3.0                \n pydot-ng                 2.0.0                \n pydotplus                2.0.2                \n pyemd                    0.5.1                \n pyglet                   1.3.2                \n Pygments                 2.1.3                \n pygobject                3.26.1               \n pymc3                    3.6                  \n pymongo                  3.7.2                \n pymystem3                0.2.0                \n PyOpenGL                 3.1.0                \n pyparsing                2.3.1                \n pysndfile                1.3.2                \n PySocks                  1.6.8                \n pystache                 0.5.4                \n pystan                   2.18.1.0             \n pytest                   3.10.1               \n python-apt               1.6.3+ubuntu1        \n python-chess             0.23.11              \n python-dateutil          2.5.3                \n python-louvain           0.13                 \n python-rtmidi            1.2.1                \n python-slugify           2.0.1                \n python-utils             2.3.0                \n pytz                     2018.9               \n PyWavelets               1.0.1                \n PyYAML                   3.13                 \n pyzmq                    17.0.0               \n qtconsole                4.4.3                \n regex                    2018.1.10            \n requests                 2.18.4               \n requests-oauthlib        1.2.0                \n resampy                  0.2.1                \n rpy2                     2.9.5                \n rsa                      4.0                  \n s3fs                     0.2.0                \n s3transfer               0.2.0                \n scikit-image             0.13.1               \n scikit-learn             0.20.2               \n scipy                    1.1.0                \n screen-resolution-extra  0.0.0                \n scs                      2.0.2                \n seaborn                  0.7.1                \n setuptools               40.8.0               \n setuptools-git           1.2                  \n simplegeneric            0.8.1                \n six                      1.11.0               \n sklearn                  0.0                  \n smart-open               1.8.0                \n snowballstemmer          1.2.1                \n sortedcontainers         2.1.0                \n spacy                    2.0.18               \n Sphinx                   1.8.4                \n sphinxcontrib-websupport 1.1.0                \n SQLAlchemy               1.2.17               \n sqlparse                 0.2.4                \n stable-baselines         2.2.1                \n statsmodels              0.8.0                \n sympy                    1.1.1                \n tables                   3.4.4                \n tabulate                 0.8.3                \n tb-nightly               1.13.0a20190211      \n tblib                    1.3.2                \n tensor2tensor            1.11.0               \n tensorboard              1.12.2               \n tensorboardcolab         0.0.22               \n tensorflow               1.12.0               \n tensorflow-estimator     1.10.12              \n tensorflow-hub           0.2.0                \n tensorflow-metadata      0.9.0                \n tensorflow-probability   0.5.0                \n tensorpack               0.9.1                \n termcolor                1.1.0                \n terminado                0.8.1                \n testpath                 0.4.2                \n textblob                 0.15.2               \n textgenrnn               1.4.1                \n tf-estimator-nightly     1.14.0.dev2019021101 \n tf-nightly-gpu           1.13.0.dev20190208   \n tfds-nightly             0.0.2.dev201902070013\n tflearn                  0.3.2                \n Theano                   1.0.4                \n thinc                    6.12.1               \n toolz                    0.9.0                \n torch                    1.0.0                \n torchsummary             1.5.1                \n torchtext                0.3.1                \n torchvision              0.2.1                \n tornado                  4.5.3                \n tqdm                     4.28.1               \n traitlets                4.3.2                \n tweepy                   3.6.0                \n typing                   3.6.6                \n tzlocal                  1.5.1                \n ujson                    1.35                 \n umap-learn               0.3.7                \n Unidecode                1.0.23               \n uritemplate              3.0.0                \n urllib3                  1.22                 \n vega-datasets            0.7.0                \n wcwidth                  0.1.7                \n webencodings             0.5.1                \n Werkzeug                 0.14.1               \n wheel                    0.32.3               \n widgetsnbextension       3.4.2                \n wordcloud                1.5.0                \n wrapt                    1.11.1               \n xarray                   0.11.3               \n xgboost                  0.7.post4            \n xkit                     0.0.0                \n xlrd                     1.1.0                \n xlwt                     1.3.0                \n yellowbrick              0.9.1                \n zict                     0.1.3                \n zmq                      0.0.0 \n </denchmark-code>\n \n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "JamesBrightman", "commentT": "2019-02-11T19:22:14Z", "comment_text": "\n \t\t3it/s is actually better than 3s/it\n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "JamesBrightman", "commentT": "2019-02-11T19:23:46Z", "comment_text": "\n \t\tYeah, I'm pleased with how it's all looking, holding 3it/s and targeting a ~20min epoch.\n \t\t"}}}, "commit": {"commit_id": "49675590da8a39c649b5f0f5ba522a22b90e2d69", "commit_author": "Yuxin Wu", "commitT": "2019-02-11 09:15:33-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "examples\\A3C-Gym\\train-atari.py", "file_new_name": "examples\\A3C-Gym\\train-atari.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "209,263", "deleted_lines": "262", "method_info": {"method_name": "train", "method_params": "", "method_startline": "208", "method_endline": "264"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "examples\\boilerplate.py", "file_new_name": "examples\\boilerplate.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": null, "deleted_lines": "74,75"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorpack\\train\\base.py", "file_new_name": "tensorpack\\train\\base.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "107,108,112", "deleted_lines": "107,108,112"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorpack\\train\\trainers.py", "file_new_name": "tensorpack\\train\\trainers.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "140", "deleted_lines": "140", "method_info": {"method_name": "_setup_graph", "method_params": "self,input,get_cost_fn,get_opt_fn", "method_startline": "137", "method_endline": "143"}}}}}}}