{"BR": {"BR_id": "578", "BR_author": "Herklos", "BRopenT": "2019-01-19T18:07:23Z", "BRcloseT": "2019-01-27T15:59:42Z", "BR_text": {"BRsummary": "[Bug][Async] Can't stop OctoBot properly", "BRdescription": "\n <denchmark-code>Traceback (most recent call last):\n   File \"/home/herklos/dev/Drakkars/OctoBot/evaluator/Updaters/global_price_updater.py\", line 163, in _refresh_time_frame_data\n     await self._refresh_data(time_frame, symbol, notify=notify)\n   File \"/home/herklos/dev/Drakkars/OctoBot/evaluator/Updaters/global_price_updater.py\", line 177, in _refresh_data\n     return_list=False))\n   File \"/home/herklos/dev/Drakkars/OctoBot/trading/exchanges/exchange_dispatcher.py\", line 89, in get_symbol_prices\n     await self.exchange.get_symbol_prices(symbol=symbol, time_frame=time_frame, limit=limit)\n   File \"/home/herklos/dev/Drakkars/OctoBot/trading/exchanges/rest_exchanges/rest_exchange.py\", line 126, in get_symbol_prices\n     candles = await self.client.fetch_ohlcv(symbol, time_frame.value)\n   File \"/home/herklos/.local/lib/python3.7/site-packages/ccxt/async_support/binance.py\", line 503, in fetch_ohlcv\n     response = await self.publicGetKlines(self.extend(request, params))\n   File \"/home/herklos/.local/lib/python3.7/site-packages/ccxt/async_support/binance.py\", line 1114, in request\n     response = await self.fetch2(path, api, method, params, headers, body)\n   File \"/home/herklos/.local/lib/python3.7/site-packages/ccxt/async_support/base/exchange.py\", line 113, in fetch2\n     await self.throttle()\n concurrent.futures._base.CancelledError\n  2019-01-19 19:05:51,432 ERROR    GlobalPriceUpdater    when refreshing data for time frame TimeFrames.FOUR_HOURS: \n  2019-01-19 19:05:51,432 ERROR    GlobalPriceUpdater   \n Traceback (most recent call last):\n   File \"/usr/lib/python3.7/asyncio/runners.py\", line 43, in run\n     return loop.run_until_complete(main)\n   File \"/usr/lib/python3.7/asyncio/base_events.py\", line 584, in run_until_complete\n     return future.result()\n concurrent.futures._base.CancelledError\n \n During handling of the above exception, another exception occurred:\n \n Traceback (most recent call last):\n   File \"/home/herklos/dev/Drakkars/OctoBot/evaluator/Updaters/global_price_updater.py\", line 163, in _refresh_time_frame_data\n     await self._refresh_data(time_frame, symbol, notify=notify)\n   File \"/home/herklos/dev/Drakkars/OctoBot/evaluator/Updaters/global_price_updater.py\", line 177, in _refresh_data\n     return_list=False))\n   File \"/home/herklos/dev/Drakkars/OctoBot/trading/exchanges/exchange_dispatcher.py\", line 89, in get_symbol_prices\n     await self.exchange.get_symbol_prices(symbol=symbol, time_frame=time_frame, limit=limit)\n   File \"/home/herklos/dev/Drakkars/OctoBot/trading/exchanges/rest_exchanges/rest_exchange.py\", line 126, in get_symbol_prices\n     candles = await self.client.fetch_ohlcv(symbol, time_frame.value)\n   File \"/home/herklos/.local/lib/python3.7/site-packages/ccxt/async_support/binance.py\", line 503, in fetch_ohlcv\n     response = await self.publicGetKlines(self.extend(request, params))\n   File \"/home/herklos/.local/lib/python3.7/site-packages/ccxt/async_support/binance.py\", line 1114, in request\n     response = await self.fetch2(path, api, method, params, headers, body)\n   File \"/home/herklos/.local/lib/python3.7/site-packages/ccxt/async_support/base/exchange.py\", line 113, in fetch2\n     await self.throttle()\n concurrent.futures._base.CancelledError\n </denchmark-code>\n \n <denchmark-code>Traceback (most recent call last):\n   File \"/usr/lib/python3.7/asyncio/runners.py\", line 43, in run\n     return loop.run_until_complete(main)\n   File \"/usr/lib/python3.7/asyncio/base_events.py\", line 584, in run_until_complete\n     return future.result()\n concurrent.futures._base.CancelledError\n \n During handling of the above exception, another exception occurred:\n \n Traceback (most recent call last):\n   File \"/home/herklos/dev/Drakkars/OctoBot/evaluator/Updaters/global_price_updater.py\", line 80, in start_update_loop\n     await self._trigger_update(time_frames)\n   File \"/home/herklos/dev/Drakkars/OctoBot/evaluator/Updaters/global_price_updater.py\", line 117, in _trigger_update\n     await asyncio.gather(*update_tasks)\n concurrent.futures._base.CancelledError\n \n \n </denchmark-code>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "cec3d09ebe1eb72f10d29c89279291b27a2585c9", "commit_author": "Guillaume De Saint Martin", "commitT": "2019-01-27 15:07:25+01:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "evaluator\\Updaters\\global_price_updater.py", "file_new_name": "evaluator\\Updaters\\global_price_updater.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "82,83", "deleted_lines": null, "method_info": {"method_name": "start_update_loop", "method_params": "self", "method_startline": "60", "method_endline": "103"}}, "hunk_1": {"Ismethod": 1, "added_lines": "120", "deleted_lines": null, "method_info": {"method_name": "_trigger_update", "method_params": "self,time_frames", "method_startline": "105", "method_endline": "130"}}, "hunk_2": {"Ismethod": 1, "added_lines": "169,170", "deleted_lines": null, "method_info": {"method_name": "_refresh_time_frame_data", "method_params": "self,time_frame,symbol,notify", "method_startline": "165", "method_endline": "173"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "octobot.py", "file_new_name": "octobot.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "293,299,300,319,320,321,322,323", "deleted_lines": "298,317", "method_info": {"method_name": "stop_threads", "method_params": "self", "method_startline": "292", "method_endline": "325"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "services\\service_creator.py", "file_new_name": "services\\service_creator.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "81,82,83,84,85,86", "deleted_lines": "81", "method_info": {"method_name": "get_service_instances", "method_params": "config", "method_startline": "77", "method_endline": "87"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\endurance_tests\\start_bot_test.py", "file_new_name": "tests\\endurance_tests\\start_bot_test.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "49,50", "deleted_lines": "49,50", "method_info": {"method_name": "test_run_bot", "method_params": "event_loop", "method_startline": "36", "method_endline": "50"}}, "hunk_1": {"Ismethod": 1, "added_lines": "33", "deleted_lines": "33", "method_info": {"method_name": "test_create_bot", "method_params": "", "method_startline": "29", "method_endline": "33"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\functional_tests\\launch_test\\launch_test.py", "file_new_name": "tests\\functional_tests\\launch_test\\launch_test.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "42,43", "deleted_lines": "42,43", "method_info": {"method_name": "test_run_bot", "method_params": "event_loop", "method_startline": "29", "method_endline": "43"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tools\\asyncio_tools.py", "file_new_name": "tools\\asyncio_tools.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "34,35", "deleted_lines": null, "method_info": {"method_name": "get_gather_wrapper", "method_params": "tasks", "method_startline": "34", "method_endline": "35"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tools\\commands.py", "file_new_name": "tools\\commands.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "89,90,91,92,93,94", "deleted_lines": "91,92", "method_info": {"method_name": "_signal_handler", "method_params": "_,__", "method_startline": "89", "method_endline": "94"}}, "hunk_1": {"Ismethod": 1, "added_lines": "99,101,102,103,104,105,110,111,112,113,114", "deleted_lines": null, "method_info": {"method_name": "start_bot", "method_params": "bot,logger,catch", "method_startline": "97", "method_endline": "124"}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "trading\\exchanges\\abstract_exchange.py", "file_new_name": "trading\\exchanges\\abstract_exchange.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "99,100", "deleted_lines": null, "method_info": {"method_name": "stop", "method_params": "self", "method_startline": "99", "method_endline": "100"}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "trading\\exchanges\\exchange_dispatcher.py", "file_new_name": "trading\\exchanges\\exchange_dispatcher.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "248,251", "deleted_lines": "248", "method_info": {"method_name": "stop", "method_params": "self", "method_startline": "248", "method_endline": "251"}}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "trading\\exchanges\\exchange_simulator\\exchange_simulator.py", "file_new_name": "trading\\exchanges\\exchange_simulator\\exchange_simulator.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "438,439", "deleted_lines": null, "method_info": {"method_name": "stop", "method_params": "self", "method_startline": "438", "method_endline": "439"}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "trading\\exchanges\\rest_exchanges\\rest_exchange.py", "file_new_name": "trading\\exchanges\\rest_exchanges\\rest_exchange.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "259,260,261,262", "deleted_lines": null, "method_info": {"method_name": "stop", "method_params": "self", "method_startline": "259", "method_endline": "262"}}}}}}}