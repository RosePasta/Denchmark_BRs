{"BR": {"BR_id": "1203", "BR_author": "yuzisun", "BRopenT": "2020-11-12T21:19:33Z", "BRcloseT": "2020-11-13T18:05:06Z", "BR_text": {"BRsummary": "MMS model agent gets panic when downloading models", "BRdescription": "\n /kind bug\n What steps did you take and what happened:\n [A clear and concise description of what the bug is.]\n <denchmark-code>{\"level\":\"info\",\"ts\":1605215785.7493982,\"logger\":\"Downloader\",\"msg\":\"Downloading to model dir\",\"modelUri\":\"s3://torchscript\",\"modelDir\":\"/mnt/models\"}\n {\"level\":\"info\",\"ts\":1605215785.7495825,\"logger\":\"modelAgent\",\"msg\":\"Download model \",\"modelName\":\"cifar10\",\"storagUri\":\"s3://torchscript\",\"modelDir\":\"/mnt/models\"}\n panic: runtime error: index out of range [1] with length 1\n \n goroutine 22 [running]:\n github.com/kubeflow/kfserving/pkg/agent/storage.(*S3Provider).DownloadModel(0xc00048d9a0, 0x7ffed6e0f493, 0xb, 0xc000580480, 0x7, 0xc0005804a0, 0x10, 0x1b, 0x0)\n \tgithub.com/kubeflow/kfserving/pkg/agent/storage/s3.go:59 +0x49c\n github.com/kubeflow/kfserving/pkg/agent.(*Downloader).download(0xc000286198, 0xc000580480, 0x7, 0xc0005804a0, 0x10, 0x2, 0x3a)\n \tgithub.com/kubeflow/kfserving/pkg/agent/downloader.go:75 +0xff\n github.com/kubeflow/kfserving/pkg/agent.(*Downloader).DownloadModel(0xc000286198, 0xc000580480, 0x7, 0xc00045c540, 0x0, 0x0)\n \tgithub.com/kubeflow/kfserving/pkg/agent/downloader.go:51 +0x76a\n github.com/kubeflow/kfserving/pkg/agent.(*Puller).modelProcessor(0xc000286180, 0xc000580480, 0x7, 0xc00045c5a0)\n \tgithub.com/kubeflow/kfserving/pkg/agent/puller.go:131 +0x2b9\n created by github.com/kubeflow/kfserving/pkg/agent.(*Puller).enqueueModelOp\n </denchmark-code>\n \n What did you expect to happen:\n Anything else you would like to add:\n [Miscellaneous information that will assist in solving the issue.]\n Environment:\n \n Istio Version:\n Knative Version:\n KFServing Version:\n Kubeflow version:\n Kfdef:[k8s_istio/istio_dex/gcp_basic_auth/gcp_iap/aws/aws_cognito/ibm]\n Minikube version:\n Kubernetes version: (use kubectl version):\n OS (e.g. from /etc/os-release):\n \n \t"}, "comments": {}}, "commit": {"commit_id": "046b12800dbfc893fc0c02da855a0ea0a02a1324", "commit_author": "Dan Sun", "commitT": "2020-11-13 10:05:05-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "hack\\image_patch_dev.sh", "file_new_name": "hack\\image_patch_dev.sh", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "43,45,51,53,59,61", "deleted_lines": "43,45,51,53,59,61"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pkg\\agent\\storage\\s3.go", "file_new_name": "pkg\\agent\\storage\\s3.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "51,53,54,55,56,57,62,63", "deleted_lines": "51,53,58,59", "method_info": {"method_name": "DownloadModel", "method_params": "string,string,string", "method_startline": "50", "method_endline": "74"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pkg\\agent\\syncer.go", "file_new_name": "pkg\\agent\\syncer.go", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "27,36,37", "deleted_lines": "30,31,32,33"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "pkg\\agent\\watcher.go", "file_new_name": "pkg\\agent\\watcher.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "108,109,111", "deleted_lines": "94,95", "method_info": {"method_name": "", "method_params": "", "method_startline": "94", "method_endline": "123"}}, "hunk_1": {"Ismethod": 1, "added_lines": "65,66,67,68,69,70,71,72,73,74,75,76,77,78,79", "deleted_lines": null, "method_info": {"method_name": "syncModelConfig", "method_params": "string", "method_startline": "65", "method_endline": "79"}}, "hunk_2": {"Ismethod": 1, "added_lines": "47,50,52,53,54,55,56,57", "deleted_lines": "46,49", "method_info": {"method_name": "NewWatcher", "method_params": "string,string", "method_startline": "42", "method_endline": "58"}}, "hunk_3": {"Ismethod": 1, "added_lines": "108,109,111", "deleted_lines": "85,87,88,89,90,91,92,93,94,95", "method_info": {"method_name": "Start", "method_params": "", "method_startline": "81", "method_endline": "132"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "pkg\\agent\\watcher_test.go", "file_new_name": "pkg\\agent\\watcher_test.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "124", "deleted_lines": null, "method_info": {"method_name": "int", "method_params": "", "method_startline": "124", "method_endline": "124"}}, "hunk_1": {"Ismethod": 1, "added_lines": "131", "deleted_lines": null, "method_info": {"method_name": "", "method_params": "", "method_startline": "131", "method_endline": "131"}}, "hunk_2": {"Ismethod": 1, "added_lines": "88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127", "deleted_lines": null, "method_info": {"method_name": "", "method_params": "", "method_startline": "88", "method_endline": "127"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pkg\\apis\\serving\\v1beta1\\predictor_triton.go", "file_new_name": "pkg\\apis\\serving\\v1beta1\\predictor_triton.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "71,72,73,74", "deleted_lines": null, "method_info": {"method_name": "GetContainer", "method_params": "ObjectMeta,ComponentExtensionSpec,InferenceServicesConfig", "method_startline": "59", "method_endline": "82"}}}}}}}