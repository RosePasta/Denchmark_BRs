{"BR": {"BR_id": "884", "BR_author": "apeforest", "BRopenT": "2019-03-05T22:03:36Z", "BRcloseT": "2019-04-19T05:09:07Z", "BR_text": {"BRsummary": "Segmentation fault: running MXNet with Horovod on Ubuntu Linux 16.04", "BRdescription": "\n Environment:\n \n Framework: MXNet\n Framework version: 1.4.0\n Horovod version: 0.16.0\n MPI version: 3.1.1\n CUDA version: 9.2\n NCCL version: 2.2.13\n Python version: 3.5\n OS and version: Linux Ubuntu 16.04\n \n Checklist:\n \n Did you search issues to find if somebody asked this question before?\n Yes\n If your question is about hang, did you read this doc?\n If your question is about docker, did you read this doc?\n \n Bug report:\n When running Horovod with MXNet on Linux Ubuntu 16.04, there will be a segmentation fault.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "apeforest", "commentT": "2019-03-05T22:08:33Z", "comment_text": "\n \t\tThe rootcause of this issue is because the pip release of MXNet is built using GCC 4.8.4 and Horovod pip release is built using GCC 5.x. There is a function call from Horovod to MXNet using  which has different function signature between <denchmark-link:https://github.com/gcc-mirror/gcc/blob/gcc-4_8_4-release/libstdc++-v3/include/std/functional#L2069>GCC 4.x</denchmark-link>\n  and <denchmark-link:https://github.com/gcc-mirror/gcc/blob/gcc-5_4_0-release/libstdc++-v3/include/std/functional#L1854>GCC 5.x</denchmark-link>\n .\n A similar issue was disovered in Tensorflow: <denchmark-link:https://github.com/tensorflow/tensorflow/issues/13308#issuecomment-450202176>tensorflow/tensorflow#13308 (comment)</denchmark-link>\n \n We are working to resolve this incompatibility. In the meanwhile, please build MXNet from source following this <denchmark-link:https://mxnet.incubator.apache.org/versions/master/install/build_from_source.html>guide</denchmark-link>\n  to workaround the segmentation fault. Sorry for the inconvenience!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "apeforest", "commentT": "2019-04-19T15:31:48Z", "comment_text": "\n \t\tThe fixes have been merged into MXNet and Horovod. Users can now use MXNet nightly build and Horovod master branch to avoid the GCC incompatibility issue.\n \t\t"}}}, "commit": {"commit_id": "98d44899a7e98dd449fdafb9ea53c4cec45e7f68", "commit_author": "Yuxi Hu", "commitT": "2019-04-18 19:09:06-10:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": ".buildkite\\gen-pipeline.sh", "file_new_name": ".buildkite\\gen-pipeline.sh", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30", "deleted_lines": "11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "Dockerfile.test.cpu", "file_new_name": "Dockerfile.test.cpu", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "12", "deleted_lines": "12"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "Dockerfile.test.gpu", "file_new_name": "Dockerfile.test.gpu", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "14", "deleted_lines": "14"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docker-compose.test.yml", "file_new_name": "docker-compose.test.yml", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "8,18,28,38,48,58,68,78,88,98,108,109,119,120,141,152,163,173,183,195,197,209,211,221", "deleted_lines": "8,18,28,38,48,58,68,78,88,98,108,118,139,150,161,171,181,193,195,207,209,219"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "horovod\\mxnet\\adapter.cc", "file_new_name": "horovod\\mxnet\\adapter.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "88,89,90,91", "deleted_lines": null, "method_info": {"method_name": "horovod::mxnet::MXTemporaryBuffer<T>::MXTemporaryBuffer", "method_params": "tensor", "method_startline": "88", "method_endline": "91"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "horovod\\mxnet\\adapter.h", "file_new_name": "horovod\\mxnet\\adapter.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "54", "deleted_lines": null}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 13, "file_old_name": "horovod\\mxnet\\mpi_ops.cc", "file_new_name": "horovod\\mxnet\\mpi_ops.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "54,55,56,57,58,59,60,61,62,63,64,67", "deleted_lines": "52,53,54,55,56,57,58,59,60,61,62,63,64,65,66", "method_info": {"method_name": "horovod::mxnet::DoAllreduce", "method_params": "tensor,output,name,on_complete", "method_startline": "52", "method_endline": "67"}}, "hunk_1": {"Ismethod": 1, "added_lines": "29,31,35", "deleted_lines": "31,33", "method_info": {"method_name": "horovod::mxnet::GetOpName", "method_params": "prefix,name", "method_startline": "29", "method_endline": "36"}}, "hunk_2": {"Ismethod": 1, "added_lines": "121,122,123,124,125,126,127,129,130,131,132,133,134,137,138,139", "deleted_lines": "121,122,125,126,127,128,129,130,133,134,135,136,137,138,141", "method_info": {"method_name": "horovod::mxnet::PushHorovodOperation", "method_params": "op_type,input,output,name,priority,root_rank", "method_startline": "121", "method_endline": "141"}}, "hunk_3": {"Ismethod": 1, "added_lines": "70,71,72,73,74,81,82", "deleted_lines": "69,70,73,74,75,76,77,78,79,80,81,82,83", "method_info": {"method_name": "horovod::mxnet::DoAllgather", "method_params": "tensor,output,name,on_complete", "method_startline": "69", "method_endline": "83"}}, "hunk_4": {"Ismethod": 1, "added_lines": "85,86,87,88,89,92,93,94,95,96,99,100,101,102,103,104,105,106,107", "deleted_lines": "85,86,87,93,94,95,96,97,98,99,101,102,103,104,105,106,107", "method_info": {"method_name": "horovod::mxnet::DoBroadcast", "method_params": "tensor,output,name,root_rank,on_complete", "method_startline": "85", "method_endline": "107"}}, "hunk_5": {"Ismethod": 1, "added_lines": "175,176,178,179,180,181,182", "deleted_lines": "175,176,177,178,179,180,181,182,183,184,185,187,188", "method_info": {"method_name": "horovod::mxnet::DoAllgatherCudaOnCPU", "method_params": "hvd_cpu_buffer,name,on_complete", "method_startline": "175", "method_endline": "188"}}, "hunk_6": {"Ismethod": 1, "added_lines": "160,161,163,164,165,166,167,168,170,171,172,173", "deleted_lines": "160,161,167,168,169,170,172,173", "method_info": {"method_name": "horovod::mxnet::DoAllreduceCudaOnCPU", "method_params": "hvd_cpu_buffer,name,on_complete", "method_startline": "160", "method_endline": "173"}}, "hunk_7": {"Ismethod": 1, "added_lines": "189,190,191,192,198,199,200,201", "deleted_lines": "187,188,189,190,191,192,193,194,195,196,197,198,199,200,201", "method_info": {"method_name": "horovod::mxnet::PushHorovodOperationCudaOnCPU", "method_params": "op_type,input,output,name,priority,root_rank", "method_startline": "186", "method_endline": "205"}}, "hunk_8": {"Ismethod": 1, "added_lines": "67,70,71,72,73,74,81,82,84,85,86,87,88,89,92,93,94,95,96,99,100,101,102,103,104,105,106,107,108,109,110,111,112,115,118,119", "deleted_lines": "69,70,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,93,94,95,96,97,98,99,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,117,118,119", "method_info": {"method_name": "horovod::mxnet::DoHorovodOperation", "method_params": "on_complete_ptr,param", "method_startline": "67", "method_endline": "119"}}, "hunk_9": {"Ismethod": 1, "added_lines": "54,55,56,57,58,59,60,61,62,63,64", "deleted_lines": "54,55,56,57,58,59,60,61,62,63,64,65", "method_info": {"method_name": "horovod::mxnet::GetOpTypeName", "method_params": "op_type", "method_startline": "54", "method_endline": "65"}}, "hunk_10": {"Ismethod": 1, "added_lines": "190,191,192,198,199,200,201", "deleted_lines": "190,191,192,193,194,195,196,197,198,199,200,201", "method_info": {"method_name": "horovod::mxnet::DoBroadcastCudaOnCPU", "method_params": "hvd_cpu_buffer,name,root_rank,on_complete", "method_startline": "190", "method_endline": "204"}}, "hunk_11": {"Ismethod": 1, "added_lines": "144,147,148,149,150,151,155,156,157,158,159,160,161,163,164,165,166,167,168,170,171,172,173,174,175,176,178,179,180,181,182", "deleted_lines": "145,146,147,148,149,152,153,154,155,160,161,167,168,169,170,172,173,174,175,176,177,178,179,180,181,182,183,184", "method_info": {"method_name": "horovod::mxnet::DoHorovodOperationCudaOnCPU", "method_params": "on_complete_ptr,param", "method_startline": "144", "method_endline": "184"}}, "hunk_12": {"Ismethod": 1, "added_lines": "31,35", "deleted_lines": "31,33,37", "method_info": {"method_name": "horovod::mxnet::GetOpName", "method_params": "prefix,name", "method_startline": "31", "method_endline": "38"}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "horovod\\mxnet\\mpi_ops.h", "file_new_name": "horovod\\mxnet\\mpi_ops.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "45,46,47,48,49,50,51,52,53,54", "deleted_lines": null, "method_info": {"method_name": "horovod::mxnet::MpiOpsParam::MpiOpsParam", "method_params": "input,output,cpu_tensor,op_type,op_name,root_rank", "method_startline": "45", "method_endline": "54"}}, "hunk_1": {"Ismethod": 1, "added_lines": "69,70,71,72", "deleted_lines": null, "method_info": {"method_name": "horovod::mxnet::DeleteMpiOpsParam", "method_params": "param", "method_startline": "69", "method_endline": "72"}}, "hunk_2": {"Ismethod": 1, "added_lines": "57,58,59,60,61,62,63,64,65,66,67", "deleted_lines": null, "method_info": {"method_name": "horovod::mxnet::CreateMpiOpsParam", "method_params": "input,output,op_type,op_name,root_rank,cuda_on_cpu", "method_startline": "57", "method_endline": "67"}}}}}}}