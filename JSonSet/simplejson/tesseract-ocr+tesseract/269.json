{"BR": {"BR_id": "269", "BR_author": "nam-leduc", "BRopenT": "2016-03-14T04:52:21Z", "BRcloseT": "2020-09-07T07:55:33Z", "BR_text": {"BRsummary": "Confuse about dump \"tessnoimages.png\" when segmenting page and detect orientation.", "BRdescription": "\n I see in file \"ccmain/pagesegmain.cpp: line 322 - 333\".\n   // Leptonica is used to find the rule/separator lines in the input.\n   LineFinder::FindAndRemoveLines(source_resolution_,\n                                  textord_tabfind_show_vlines, pix_binary_,\n                                  &vertical_x, &vertical_y, music_mask_pix,\n                                  &v_lines, &h_lines);\n   if (tessedit_dump_pageseg_images)\n     pixWrite(\"tessnolines.png\", pix_binary_, IFF_PNG);\n   // Leptonica is used to find a mask of the photo regions in the input.\n   *photo_mask_pix = ImageFind::FindImages(pix_binary_);\n   if (tessedit_dump_pageseg_images)\n     pixWrite(\"tessnoimages.png\", pix_binary_, IFF_PNG);\n Please notice to line:\n   if (tessedit_dump_pageseg_images)\n     pixWrite(\"tessnoimages.png\", pix_binary_, IFF_PNG);\n I try with configuration:\n <denchmark-code>tessedit_dump_pageseg_images    1\n </denchmark-code>\n \n And images:\n <denchmark-link:https://cloud.githubusercontent.com/assets/8704662/13735304/7b94f300-e9da-11e5-94f0-c4eeac8ca254.png></denchmark-link>\n \n But result in file \"tessnoimages.png\" is:\n <denchmark-link:https://cloud.githubusercontent.com/assets/8704662/13735340/bf23a256-e9da-11e5-97d1-ee3d6e1e9128.png></denchmark-link>\n \n I think before pixWrite(\"tessnoimages.png\", pix_binary_, IFF_PNG);, we need something like:\n if (*photo_mask_pix != NULL) {\n     pixSubtract(pix_binary_, pix_binary_, *photo_mask_pix);    \n }\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "nam-leduc", "commentT": "2016-03-17T10:29:21Z", "comment_text": "\n \t\tAt least in <denchmark-link:https://github.com/tesseract-ocr/tesseract/blob/master/ccmain/osdetect.cpp#L177>osdetect</denchmark-link>\n  it is done that way. Anyway I found out that   pixSubtract(pix_binary_, pix_binary_, *photo_mask_pix) does not removed all images.\n <denchmark-link:https://github.com/theraysmith>@theraysmith</denchmark-link>\n : can you have a look at this?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "nam-leduc", "commentT": "2018-09-17T17:46:52Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/nam-leduc>@nam-leduc</denchmark-link>\n , is this still an issue with latest Tesseract? We'd like to know that before releasing Tesseract 4.0.0.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "nam-leduc", "commentT": "2018-09-26T08:00:31Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/stweil>@stweil</denchmark-link>\n : I testing it with:\n tesseract i269.png i269 -c tessedit_dump_pageseg_images=1\n Interesting it that it produce pdf (<denchmark-link:https://github.com/tesseract-ocr/tesseract/files/2418680/i269_debug.pdf>i269_debug.pdf</denchmark-link>\n ) for debugging steps and it seems it is not fixed...\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "nam-leduc", "commentT": "2018-09-26T10:58:33Z", "comment_text": "\n \t\t\n \n \n tesseract/src/ccmain/pagesegmain.cpp\n \n \n          Line 294\n       in\n       6412374\n \n \n \n \n \n \n  *photo_mask_pix = ImageFind::FindImages(pix_binary_, &pixa_debug_); \n \n \n \n \n \n \n \n \n tesseract/src/textord/imagefind.cpp\n \n \n          Line 63\n       in\n       a9e2574\n \n \n \n \n \n \n  Pix* ImageFind::FindImages(Pix* pix, DebugPixa* pixa_debug) { \n \n \n \n \n \n \n \n \n tesseract/src/ccstruct/debugpixa.h\n \n \n          Line 26\n       in\n       5fdaa47\n \n \n \n \n \n \n  void AddPix(const Pix* pix, const char* caption) { \n \n \n \n \n \n <denchmark-link:https://github.com/DanBloomberg/leptonica/blob/master/prog/livre_pageseg.c>https://github.com/DanBloomberg/leptonica/blob/master/prog/livre_pageseg.c</denchmark-link>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "nam-leduc", "commentT": "2020-09-05T08:09:41Z", "comment_text": "\n \t\tDear <denchmark-link:https://github.com/amitdo>@amitdo</denchmark-link>\n  ,\n Recently, I tested and it still meet the problems.\n <denchmark-h:h3>Environment</denchmark-h>\n \n \n \n Tesseract Version:\n tesseract --version\n tesseract 5.0.0-alpha-777-g162f3\n  leptonica-1.75.3\n   libgif 5.1.4 : libjpeg 8d (libjpeg-turbo 1.5.2) : libpng 1.6.34 : libtiff 4.0.9 : zlib 1.2.11 : libwebp 0.6.1 : libopenjp2 2.3.0\n \n  Found AVX2\n  Found AVX\n  Found SSE\n \n \n \n Commit: 162f370 (Merge pull request #3082 from bertsky/fix-line-detector)\n \n \n Platform: Ubuntu 18.04.4 LTS\n \n \n Tessdata: https://raw.githubusercontent.com/tesseract-ocr/tessdata/master/eng.traineddata\n \n \n <denchmark-h:h3>Tesseract input/output</denchmark-h>\n \n \n \n Following are input image:\n https://user-images.githubusercontent.com/8704662/92300832-517da180-ef88-11ea-8ce3-149bd3e79bc3.PNG\n \n \n My command:\n $ ./bin/tesseract ~/vmshare/have-image.PNG have-image-original -c tessedit_dump_pageseg_images=1\n Tesseract Open Source OCR Engine v5.0.0-alpha-777-g162f3 with Leptonica\n \n \n \n Following are PDF debug file when run with original source code:\n have-image-original_debug.pdf\n \n \n And this is image after I add following source code:\n have-image_debug.pdf\n *photo_mask_pix = ImageFind::FindImages(pix_binary_, &pixa_debug_);\n if (tessedit_dump_pageseg_images) {\n   Pix* pix_no_image_ = nullptr;\n   if (*photo_mask_pix != nullptr) {\n     pix_no_image_ = pixSubtract(nullptr, pix_binary_, *photo_mask_pix);\n   } else {\n     pix_no_image_ = pixClone(pix_binary_);\n   }\n   pixa_debug_.AddPix(pix_no_image_, \"NoImages\");\n   pixDestroy(&pix_no_image_);\n }\n \n \n Best regards,\n Le Duc. Nam\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "nam-leduc", "commentT": "2020-09-05T21:59:23Z", "comment_text": "\n \t\tLGTM.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "nam-leduc", "commentT": "2020-09-05T22:08:05Z", "comment_text": "\n \t\t\n Anyway I found out that pixSubtract(pix_binary_, pix_binary_, *photo_mask_pix) does not removed all images.\n \n <denchmark-link:https://github.com/zdenop>@zdenop</denchmark-link>\n ,\n Can you give an example?\n Probably Leptonica itself fails to identify these images. For example, Leptonica does not recognize line drawings as images.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "nam-leduc", "commentT": "2020-09-06T15:04:36Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/amitdo>@amitdo</denchmark-link>\n : as you can see in <denchmark-link:https://github.com/tesseract-ocr/tesseract/files/5177735/have-image_debug.pdf>have-image_debug.pdf</denchmark-link>\n  from <denchmark-link:https://github.com/nam-leduc>@nam-leduc</denchmark-link>\n  example (or you can use original image from  this issue) - there are still image artefacts.\n <denchmark-link:https://github.com/tesseract-ocr/tesseract/issues/269#issuecomment-687569986>Leduct patch</denchmark-link>\n  improves debug output without effect on OCR (so it could/should be applied). <denchmark-link:https://github.com/nam-leduc>@nam-leduc</denchmark-link>\n : can you send PR?\n My original suggestion has effect on OCR and I did not test it  (so it is dangerous to apply it). IMHO <denchmark-link:https://github.com/tesseract-ocr/tesseract/blob/162f3707e28102451338ced235c80ffa6f09ae40/src/textord/colfind.cpp#L146>SetupAndFilterNoise </denchmark-link>\n should be investigated if  produces expected results.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "nam-leduc", "commentT": "2020-09-06T16:18:24Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/zdenop>@zdenop</denchmark-link>\n  ,\n \n @nam-leduc: can you send PR?\n \n Yes, I will send PR.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "nam-leduc", "commentT": "2020-09-06T16:32:57Z", "comment_text": "\n \t\tI suggest to simplify the patch a little bit. It is not necessary to write a 2nd image for pix_binary_, so the else part can be omitted..\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "nam-leduc", "commentT": "2020-09-06T16:40:28Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/stweil>@stweil</denchmark-link>\n  , my thinking is that if we can't find any photo from binary image, so, binary image are 'NoImages', it maybe confuse developer if we don't add 'NoImages' pdf page. <denchmark-link:https://github.com/stweil>@stweil</denchmark-link>\n  , what do you think?\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "nam-leduc", "commentT": "2020-09-07T07:55:32Z", "comment_text": "\n \t\tFixed by pull request <denchmark-link:https://github.com/tesseract-ocr/tesseract/pull/3090>#3090</denchmark-link>\n , so closing this issue.\n \t\t"}}}, "commit": {"commit_id": "63965bd7506bfe793432c878fee587848345bc3c", "commit_author": "Stefan Weil", "commitT": "2018-08-23 18:18:15+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\training\\validate_javanese.cpp", "file_new_name": "src\\training\\validate_javanese.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "78", "deleted_lines": "78", "method_info": {"method_name": "tesseract::ValidateJavanese::UnicodeToCharClass", "method_params": "ch", "method_startline": "66", "method_endline": "83"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\training\\validate_javanese.h", "file_new_name": "src\\training\\validate_javanese.h", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "18,27,63", "deleted_lines": "18,27,63"}}}}}}