{"BR": {"BR_id": "2909", "BR_author": "thuyen", "BRopenT": "2017-06-25T23:39:29Z", "BRcloseT": "2017-09-20T18:10:51Z", "BR_text": {"BRsummary": "MultiprocessingIterator Deadlock", "BRdescription": "\n I am new to chainer and trying to do a custom loop with MultiprocessingIterator.\n Reproduce on Ubuntu 16.04 and Chainer version 2.0\n <denchmark-code>import chainer\n import numpy as np\n \n dataset = np.ones((10000, 1000))\n loader = chainer.iterators.MultiprocessIterator(\n                 dataset, 32, n_processes=6,\n                 shuffle=True, repeat=True)\n \n while loader.epoch < 1:\n     x = loader.next()\n print('test')\n loader.finalize() # hang at worker.join() (randomly, very frequently)\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "thuyen", "commentT": "2017-06-27T11:23:46Z", "comment_text": "\n \t\tThank you for reporting!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "thuyen", "commentT": "2017-08-03T00:22:49Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/niboshi>@niboshi</denchmark-link>\n  Could you try CuPy 1.0.1 as well to see if this problem is related to <denchmark-link:https://github.com/chainer/chainer/issues/3075>#3075</denchmark-link>\n ?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "thuyen", "commentT": "2017-08-03T01:34:47Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/delta2323>@delta2323</denchmark-link>\n  I tested in these combinations. This problem is reproduced in both conditions.\n \n Chainer v2.0.2 (v2) - CuPy v1.0.2 (v1)\n Chainer v3.0.0b1 (master) - CuPy v2.0.0b1 (master)\n \n (Python 3.6.1, Ubuntu 16.04, CUDA 8.0)\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "thuyen", "commentT": "2017-08-03T03:50:35Z", "comment_text": "\n \t\tThank you. I will ask them to try master branches for both modules and check the deadlock occur again.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "thuyen", "commentT": "2017-09-20T17:44:26Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/thuyen>@thuyen</denchmark-link>\n  I tested your code with Chainer v3.0.0rc1. The deadlock does not occur.\n Maybe, This bug was fixed by <denchmark-link:https://github.com/chainer/chainer/pull/3076>#3076</denchmark-link>\n .\n Cloud you check on your environment?\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "thuyen", "commentT": "2017-09-20T17:48:31Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/okuta>@okuta</denchmark-link>\n \n Ah yes, this must have been solved, because <denchmark-link:https://github.com/chainer/chainer/pull/3076>#3076</denchmark-link>\n  includes a test case to check for this issue.\n (<denchmark-link:https://github.com/chainer/chainer/pull/3076/files#diff-f4b0901816a48909da3e084290dbb1fcR394>https://github.com/chainer/chainer/pull/3076/files#diff-f4b0901816a48909da3e084290dbb1fcR394</denchmark-link>\n )\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "thuyen", "commentT": "2017-09-20T18:10:51Z", "comment_text": "\n \t\tOK, I close this Issue.\n \t\t"}}}, "commit": {"commit_id": "81b524365eb76412e83aab895d7897cbf3f63c53", "commit_author": "Shunsuke Shimizu", "commitT": "2017-08-05 11:06:58+00:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\chainer_tests\\iterators_tests\\test_multiprocess_iterator.py", "file_new_name": "tests\\chainer_tests\\iterators_tests\\test_multiprocess_iterator.py", "file_complexity": {"file_NLOC": "344", "file_CCN": "67", "file_NToken": "3241"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "389,390,391,392,393,394,395,396,397,398,399,400,401,402", "deleted_lines": null, "method_info": {"method_name": "test_finalize_not_deadlock", "method_params": "self", "method_startline": "389", "method_endline": "402", "method_complexity": {"method_NLOC": "12", "method_CCN": "2", "method_NToken": "93", "method_nesting_level": "1"}}}}}}}}