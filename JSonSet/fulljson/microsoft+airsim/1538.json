{"BR": {"BR_id": "1538", "BR_author": "yashkaushal", "BRopenT": "2018-11-14T11:55:38Z", "BRcloseT": "2018-11-29T08:27:54Z", "BR_text": {"BRsummary": "Multiple quadrotors using API acts as a group of 4 instead of all together", "BRdescription": "\n Hi,\n I tried to make a swarm of drones take off and land together.\n I configured settings.json to have 12 drones in Unreal and used python API to make them takeoff together, but instead of all taking off together random 4 take off first, then next 4 and so forth.\n See screenshot for reference:\n <denchmark-link:https://user-images.githubusercontent.com/16793719/48480815-983d5d00-e831-11e8-9dd7-449b25779a17.png></denchmark-link>\n \n All were expected to take off together but only the first 4 took off, after a few seconds the next 4 took off.\n My OS is windows 10 pro version 1803, AirSim version 1.2(today's build), python 2.7.15, unreal version 4.20\n Below is the settings.json I used:\n {\n     \"SimMode\": \"Multirotor\",\n     \"SeeDocsAt\": \"https://github.com/Microsoft/AirSim/blob/master/docs/settings.md\",\n     \"SettingsVersion\": 1.2,\n     \"Vehicles\": {\n         \"SimpleFlight1\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": 4,\n             \"Y\": -15,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight2\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": -4,\n             \"Y\": -15,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight3\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": 0,\n             \"Y\": -15,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight4\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": 4,\n             \"Y\": -10,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight5\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": -4,\n             \"Y\": -10,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight6\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": 0,\n             \"Y\": -10,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight7\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": 4,\n             \"Y\": -5,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight8\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": -4,\n             \"Y\": -5,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight9\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": 0,\n             \"Y\": -5,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight10\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": 4,\n             \"Y\": 0,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight11\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": -4,\n             \"Y\": 0,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         },\n         \"SimpleFlight12\": {\n             \"VehicleType\": \"SimpleFlight\",\n             \"X\": 0,\n             \"Y\": 0,\n             \"Z\": -2,\n             \"DefaultVehicleState\": \"Disarmed\",\n             \"EnableCollisionPassthrogh\": false,\n             \"EnableCollisions\": true,\n             \"AllowAPIAlways\": true,\n             \"RC\": {\n                 \"RemoteControlID\": 0,\n                 \"AllowAPIWhenDisconnected\": false\n             }\n         }\n     }\n }\n Below is the python code i used to call API commands, It is modified from multi_agent_drone.py demo.\n import setup_path \n import airsim\n \n import numpy as np\n import os\n import tempfile\n import pprint\n \n # connect to the AirSim simulator\n client = airsim.MultirotorClient()\n client.confirmConnection()\n client.enableApiControl(True, \"SimpleFlight1\")\n client.enableApiControl(True, \"SimpleFlight2\")\n client.enableApiControl(True, \"SimpleFlight3\")\n \n client.enableApiControl(True, \"SimpleFlight4\")\n client.enableApiControl(True, \"SimpleFlight5\")\n client.enableApiControl(True, \"SimpleFlight6\")\n \n client.enableApiControl(True, \"SimpleFlight7\")\n client.enableApiControl(True, \"SimpleFlight8\")\n client.enableApiControl(True, \"SimpleFlight9\")\n \n client.enableApiControl(True, \"SimpleFlight10\")\n client.enableApiControl(True, \"SimpleFlight11\")\n client.enableApiControl(True, \"SimpleFlight12\")\n \n client.armDisarm(True, \"SimpleFlight1\")\n client.armDisarm(True, \"SimpleFlight2\")\n client.armDisarm(True, \"SimpleFlight3\")\n \n client.armDisarm(True, \"SimpleFlight4\")\n client.armDisarm(True, \"SimpleFlight5\")\n client.armDisarm(True, \"SimpleFlight6\")\n \n client.armDisarm(True, \"SimpleFlight7\")\n client.armDisarm(True, \"SimpleFlight8\")\n client.armDisarm(True, \"SimpleFlight9\")\n \n client.armDisarm(True, \"SimpleFlight10\")\n client.armDisarm(True, \"SimpleFlight11\")\n client.armDisarm(True, \"SimpleFlight10\")\n \n airsim.wait_key('Press any key to takeoff')\n f1 = client.takeoffAsync(vehicle_name=\"SimpleFlight1\")\n f2 = client.takeoffAsync(vehicle_name=\"SimpleFlight2\")\n f3 = client.takeoffAsync(vehicle_name=\"SimpleFlight3\")\n \n f4 = client.takeoffAsync(vehicle_name=\"SimpleFlight4\")\n f5 = client.takeoffAsync(vehicle_name=\"SimpleFlight5\")\n f6 = client.takeoffAsync(vehicle_name=\"SimpleFlight6\")\n \n f7 = client.takeoffAsync(vehicle_name=\"SimpleFlight7\")\n f8 = client.takeoffAsync(vehicle_name=\"SimpleFlight8\")\n f9 = client.takeoffAsync(vehicle_name=\"SimpleFlight9\")\n \n f10 = client.takeoffAsync(vehicle_name=\"SimpleFlight10\")\n f11 = client.takeoffAsync(vehicle_name=\"SimpleFlight11\")\n f12 = client.takeoffAsync(vehicle_name=\"SimpleFlight12\")\n \n f1.join()\n f2.join()\n f3.join()\n \n f4.join()\n f5.join()\n f6.join()\n \n f7.join()\n f8.join()\n f9.join()\n \n f10.join()\n f11.join()\n f12.join()\n \n airsim.wait_key('Press any key to hover vehicles')\n \n f1 = client.hoverAsync(vehicle_name=\"SimpleFlight1\")\n f2 = client.hoverAsync(vehicle_name=\"SimpleFlight2\")\n f3 = client.hoverAsync(vehicle_name=\"SimpleFlight3\")\n \n f4 = client.hoverAsync(vehicle_name=\"SimpleFlight4\")\n f5 = client.hoverAsync(vehicle_name=\"SimpleFlight5\")\n f6 = client.hoverAsync(vehicle_name=\"SimpleFlight6\")\n \n f7 = client.hoverAsync(vehicle_name=\"SimpleFlight7\")\n f8 = client.hoverAsync(vehicle_name=\"SimpleFlight8\")\n f9 = client.hoverAsync(vehicle_name=\"SimpleFlight9\")\n \n f10 = client.hoverAsync(vehicle_name=\"SimpleFlight10\")\n f11 = client.hoverAsync(vehicle_name=\"SimpleFlight11\")\n f12 = client.hoverAsync(vehicle_name=\"SimpleFlight12\")\n \n f1.join()\n f2.join()\n f3.join()\n \n f4.join()\n f5.join()\n f6.join()\n \n f7.join()\n f8.join()\n f9.join()\n \n f10.join()\n f11.join()\n f12.join()\n \n airsim.wait_key('Press any key to land vehicles')\n \n f1 = client.landAsync(vehicle_name=\"SimpleFlight1\")\n f2 = client.landAsync(vehicle_name=\"SimpleFlight2\")\n f3 = client.landAsync(vehicle_name=\"SimpleFlight3\")\n \n f4 = client.landAsync(vehicle_name=\"SimpleFlight4\")\n f5 = client.landAsync(vehicle_name=\"SimpleFlight5\")\n f6 = client.landAsync(vehicle_name=\"SimpleFlight6\")\n \n f7 = client.landAsync(vehicle_name=\"SimpleFlight7\")\n f8 = client.landAsync(vehicle_name=\"SimpleFlight8\")\n f9 = client.landAsync(vehicle_name=\"SimpleFlight9\")\n \n f10 = client.landAsync(vehicle_name=\"SimpleFlight10\")\n f11 = client.landAsync(vehicle_name=\"SimpleFlight11\")\n f12 = client.landAsync(vehicle_name=\"SimpleFlight12\")\n \n f1.join()\n f2.join()\n f3.join()\n \n f4.join()\n f5.join()\n f6.join()\n \n f7.join()\n f8.join()\n f9.join()\n \n f10.join()\n f11.join()\n f12.join()\n \n client.armDisarm(False, \"SimpleFlight1\")\n client.armDisarm(False, \"SimpleFlight2\")\n client.armDisarm(False, \"SimpleFlight3\")\n \n client.armDisarm(False, \"SimpleFlight4\")\n client.armDisarm(False, \"SimpleFlight5\")\n client.armDisarm(False, \"SimpleFlight6\")\n \n client.armDisarm(False, \"SimpleFlight7\")\n client.armDisarm(False, \"SimpleFlight8\")\n client.armDisarm(False, \"SimpleFlight9\")\n \n client.armDisarm(False, \"SimpleFlight10\")\n client.armDisarm(False, \"SimpleFlight11\")\n client.armDisarm(False, \"SimpleFlight12\")\n \n # that's enough fun for now. let's quit cleanly\n client.enableApiControl(False, \"SimpleFlight1\")\n client.enableApiControl(False, \"SimpleFlight2\")\n client.enableApiControl(False, \"SimpleFlight3\")\n \n client.enableApiControl(False, \"SimpleFlight4\")\n client.enableApiControl(False, \"SimpleFlight5\")\n client.enableApiControl(False, \"SimpleFlight6\")\n \n client.enableApiControl(False, \"SimpleFlight7\")\n client.enableApiControl(False, \"SimpleFlight8\")\n client.enableApiControl(False, \"SimpleFlight9\")\n \n client.enableApiControl(False, \"SimpleFlight10\")\n client.enableApiControl(False, \"SimpleFlight11\")\n client.enableApiControl(False, \"SimpleFlight12\")\n I tried using single client for each quad instead of a single client being shared among them but that also yielded the same result.\n Please suggest me what steps to take to make them take off together.\n Thanks,\n Yash Kaushal\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "yashkaushal", "commentT": "2018-11-15T14:47:24Z", "comment_text": "\n \t\tNot that this is the actual cause, but did you catch that you do a typo in the first set of client.disarm:\n client.armDisarm(True, \"SimpleFlight10\")\n client.armDisarm(True, \"SimpleFlight11\")\n client.armDisarm(True, \"SimpleFlight10\")\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "yashkaushal", "commentT": "2018-11-18T11:10:45Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/RVBldr>@RVBldr</denchmark-link>\n \n Thanks for pointing the typo,\n I did some searching around and found that it has been reported earlier as well in the last comment of <denchmark-link:https://github.com/microsoft/AirSim/issues/1137>#1137</denchmark-link>\n  by KavehFathian.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "yashkaushal", "commentT": "2018-11-18T19:13:40Z", "comment_text": "\n \t\tin the video referenced in <denchmark-link:https://github.com/microsoft/AirSim/issues/1137>#1137</denchmark-link>\n , it's interesting that they are able to work 9 apparently without the 4 ship bug. Internally we're taking at look at that and initial thoughts are that it's a threading issue.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "yashkaushal", "commentT": "2018-11-21T03:51:20Z", "comment_text": "\n \t\tI think the issue is in <denchmark-link:https://github.com/Microsoft/AirSim/blob/master/AirLib/src/api/RpcLibServerBase.cpp#L260>this line</denchmark-link>\n .\n pimpl_->server.async_run(4);   //4 threads\n Try changing it to number of vehicles and see if it works.\n We need to set the number of threads from AirSimSettings. Ideal would to do max of count of vehicles in AirSimSettings or user specified value.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "yashkaushal", "commentT": "2018-11-29T08:28:15Z", "comment_text": "\n \t\tFixed: <denchmark-link:https://github.com/microsoft/AirSim/commit/262cb28e0845c9879078ce453169acbea7630c8b>262cb28</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "262cb28e0845c9879078ce453169acbea7630c8b", "commit_author": "Shital Shah", "commitT": "2018-11-29 00:27:42-08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "AirLib\\include\\api\\ApiServerBase.hpp", "file_new_name": "AirLib\\include\\api\\ApiServerBase.hpp", "file_complexity": {"file_NLOC": "10", "file_CCN": "0", "file_NToken": "49"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "14", "deleted_lines": "14"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "AirLib\\include\\api\\RpcLibServerBase.hpp", "file_new_name": "AirLib\\include\\api\\RpcLibServerBase.hpp", "file_complexity": {"file_NLOC": "51", "file_CCN": "7", "file_NToken": "245"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "20", "deleted_lines": "20"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "AirLib\\src\\api\\RpcLibServerBase.cpp", "file_new_name": "AirLib\\src\\api\\RpcLibServerBase.cpp", "file_complexity": {"file_NLOC": "221", "file_CCN": "14", "file_NToken": "2390"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "268,273", "deleted_lines": "268,273", "method_info": {"method_name": "msr::airlib::RpcLibServerBase::start", "method_params": "block,thread_count", "method_startline": "268", "method_endline": "274", "method_complexity": {"method_NLOC": "7", "method_CCN": "2", "method_NToken": "36", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "268,273", "deleted_lines": "268,273", "method_info": {"method_name": "msr::airlib::RpcLibServerBase::start", "method_params": "block", "method_startline": "268", "method_endline": "274", "method_complexity": {"method_NLOC": "7", "method_CCN": "2", "method_NToken": "31", "method_nesting_level": "2"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "Unreal\\Plugins\\AirSim\\Source\\SimMode\\SimModeBase.cpp", "file_new_name": "Unreal\\Plugins\\AirSim\\Source\\SimMode\\SimModeBase.cpp", "file_complexity": {"file_NLOC": "507", "file_CCN": "107", "file_NToken": "3517"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "410", "deleted_lines": "410", "method_info": {"method_name": "ASimModeBase::startApiServer", "method_params": "", "method_startline": "399", "method_endline": "419", "method_complexity": {"method_NLOC": "15", "method_CCN": "4", "method_NToken": "88", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\faq.md", "file_new_name": "docs\\faq.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "20,21,22,23,24,25,26,27,28,29,30,31,32,33", "deleted_lines": null}}}}}}