{"BR": {"BR_id": "4369", "BR_author": "amirebrahimi", "BRopenT": "2020-06-29T22:34:47Z", "BRcloseT": "2020-08-25T18:00:34Z", "BR_text": {"BRsummary": "ArgumentException: Dimensions must contain elements", "BRdescription": "\n Describe the bug\n While debugging a network and splitting it into separate parts I reduced one part down to simply returning the first dimension of the shape. This exception occurs while running the model using the C# InferenceSample project. Exception occurs in Tensor.cs:309.\n Urgency\n None\n System information\n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10 Build 18363\n ONNX Runtime installed from (source or binary): source\n ONNX Runtime version: b41fcf1\n Python version: N/A\n Visual Studio version (if applicable): 2019\n GCC/Compiler version (if compiling from source): cl.exe 19.26.28806 for x64\n CUDA/cuDNN version: N/A\n GPU model and memory: N/A\n \n To Reproduce\n \n Use the Microsoft.ML.OnnxRuntime.InferenceSample project\n Modify the sample to use the attached .onnx file (see below) and skip using the inputData from \"bench.in\" (i.e. initialize the input tensors without inputData)\n Run and notice the exception that occurs.\n \n Expected behavior\n Since the output is a scalar I'd still expect the dimensions to correctly show as 1.\n \n <denchmark-link:https://user-images.githubusercontent.com/904110/86062617-feceb900-ba1d-11ea-967b-079f3e2db665.png></denchmark-link>\n \n \n <denchmark-link:https://github.com/microsoft/onnxruntime/files/4848364/siamese_test_opt.zip>siamese_test_opt.zip</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "amirebrahimi", "commentT": "2020-06-29T23:58:39Z", "comment_text": "\n \t\tThanks for reporting. Yes, the C# API's Tensor class doesn't like scalars (tensors with zero dimensions) . Will fix it. If you have a fix, contributions are welcome. :)\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "amirebrahimi", "commentT": "2020-06-30T19:04:48Z", "comment_text": "\n \t\tI tried some things at the C level like using Size() instead of size(), but that broke tests, so I reverted them. Do you foresee this being a change that is needed only on the C# side?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "amirebrahimi", "commentT": "2020-06-30T19:11:55Z", "comment_text": "\n \t\tYes, the native layer should handle scalars correctly. The change will be only in c#. Most likely, will be along the lines of modifying the if check that is throwing (and a few other places perhaps) and adding a test. I can make the change if it is too time consuming for you.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "amirebrahimi", "commentT": "2020-07-01T02:23:18Z", "comment_text": "\n \t\tI added support as you suggested and added a single test for the use-case I encountered. You're welcome to add additional tests if it needs more coverage.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "amirebrahimi", "commentT": "2020-07-01T07:45:40Z", "comment_text": "\n \t\tThanks for the contribution., but are you rebased with current master ? It seems like there are changes in 75 files in the PR.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "amirebrahimi", "commentT": "2020-07-01T15:43:34Z", "comment_text": "\n \t\tLooks like I started off of the last tagged release version. I'll merge latest master.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "amirebrahimi", "commentT": "2020-07-01T16:08:32Z", "comment_text": "\n \t\tNot sure what happened with branches on that one, so I just started fresh off of master.\n \t\t"}}}, "commit": {"commit_id": "26bd8c20854aafbc36d843892eb2eac2440b6065", "commit_author": "Hariharan Seshadri", "commitT": "2020-08-25 11:00:33-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "0.7346938775510204"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "csharp\\src\\Microsoft.ML.OnnxRuntime\\Tensors\\ArrayUtilities.cs", "file_new_name": "csharp\\src\\Microsoft.ML.OnnxRuntime\\Tensors\\ArrayUtilities.cs", "file_complexity": {"file_NLOC": "175", "file_CCN": "38", "file_NToken": "1030"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "39,40,41,42,43", "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors::ArrayUtilities::GetProduct", "method_params": "dimensions,startIndex", "method_startline": "37", "method_endline": "61", "method_complexity": {"method_NLOC": "20", "method_CCN": "4", "method_NToken": "84", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "177,178,179,180,181,182", "deleted_lines": null, "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors::ArrayUtilities::GetIndices", "method_params": "strides,reverseStride,index,indices,startFromDimension", "method_startline": "172", "method_endline": "193", "method_complexity": {"method_NLOC": "17", "method_CCN": "5", "method_NToken": "130", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "208,209,210,211,212,213", "deleted_lines": null, "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors::ArrayUtilities::GetIndices", "method_params": "strides,reverseStride,index,indices,startFromDimension", "method_startline": "203", "method_endline": "224", "method_complexity": {"method_NLOC": "17", "method_CCN": "5", "method_NToken": "131", "method_nesting_level": "2"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "94,95,96,97,98", "deleted_lines": null, "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors::ArrayUtilities::GetStrides", "method_params": "dimensions,reverseStride", "method_startline": "90", "method_endline": "118", "method_complexity": {"method_NLOC": "26", "method_CCN": "5", "method_NToken": "126", "method_nesting_level": "2"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "235,236,237,238,239,240,241", "deleted_lines": null, "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors::ArrayUtilities::TransformIndexByStrides", "method_params": "index,sourceStrides,sourceReverseStride,transformStrides", "method_startline": "229", "method_endline": "258", "method_complexity": {"method_NLOC": "22", "method_CCN": "5", "method_NToken": "162", "method_nesting_level": "2"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "csharp\\src\\Microsoft.ML.OnnxRuntime\\Tensors\\DenseTensor.cs", "file_new_name": "csharp\\src\\Microsoft.ML.OnnxRuntime\\Tensors\\DenseTensor.cs", "file_complexity": {"file_NLOC": "102", "file_CCN": "18", "file_NToken": "582"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "175", "deleted_lines": "173,174,175,176,177", "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors::DenseTensor<T>::Reshape", "method_params": "dimensions", "method_startline": "173", "method_endline": "184", "method_complexity": {"method_NLOC": "9", "method_CCN": "2", "method_NToken": "55", "method_nesting_level": "2"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "csharp\\src\\Microsoft.ML.OnnxRuntime\\Tensors\\Tensor.cs", "file_new_name": "csharp\\src\\Microsoft.ML.OnnxRuntime\\Tensors\\Tensor.cs", "file_complexity": {"file_NLOC": "949", "file_CCN": "200", "file_NToken": "5634"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "441,442,443,444,445", "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors::Tensor<T>::Tensor", "method_params": "fromArray,reverseStride", "method_startline": "434", "method_endline": "458", "method_complexity": {"method_NLOC": "21", "method_CCN": "4", "method_NToken": "130", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "406,408", "deleted_lines": "406,408", "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors::Tensor<T>::Tensor", "method_params": "dimensions,reverseStride", "method_startline": "404", "method_endline": "427", "method_complexity": {"method_NLOC": "21", "method_CCN": "4", "method_NToken": "136", "method_nesting_level": "2"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "csharp\\test\\Microsoft.ML.OnnxRuntime.Tests\\Tensors\\TensorTests.cs", "file_new_name": "csharp\\test\\Microsoft.ML.OnnxRuntime.Tests\\Tensors\\TensorTests.cs", "file_complexity": {"file_NLOC": "2035", "file_CCN": "77", "file_NToken": "16410"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "162", "deleted_lines": "162,163,164", "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors.Tests::TensorTests::ConstructFromDimensions", "method_params": "tensorConstructor", "method_startline": "151", "method_endline": "172", "method_complexity": {"method_NLOC": "19", "method_CCN": "1", "method_NToken": "264", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "225,227,228,229,230,231,232,233,234,235,236,238,239,240,241", "deleted_lines": "227,229,231,232", "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors.Tests::TensorTests::ConstructEmptyTensors", "method_params": "tensorConstructor", "method_startline": "176", "method_endline": "241", "method_complexity": {"method_NLOC": "44", "method_CCN": "1", "method_NToken": "650", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306", "deleted_lines": null, "method_info": {"method_name": "Microsoft.ML.OnnxRuntime.Tensors.Tests::TensorTests::ConstructScalarTensors", "method_params": "tensorConstructor", "method_startline": "245", "method_endline": "307", "method_complexity": {"method_NLOC": "38", "method_CCN": "1", "method_NToken": "541", "method_nesting_level": "2"}}}}}}}}