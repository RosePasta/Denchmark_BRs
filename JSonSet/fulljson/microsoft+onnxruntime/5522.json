{"BR": {"BR_id": "5522", "BR_author": "MarlNox", "BRopenT": "2020-10-17T00:52:02Z", "BRcloseT": "2020-10-22T02:03:28Z", "BR_text": {"BRsummary": "Convert to mobile Error: Onnxruntime_test_all (Failed) - Tests Fail", "BRdescription": "\n Describe the bug\n While building the compressed mobile version of my model only 67% of the tests succeed. Skipping tests seems to produce no result.\n To Reproduce\n \"onnxruntime/build.sh\" --config=MinSizeRel --build_shared_lib --minimal_build --disable_ml_ops --disable_exceptions --include_ops_by_config \"model/required_operators.config\"\n Expected behavior\n Create the compressed mobile model.\n required_operators.config\n Assuming this may have something to do with the operators, I'm posting the contents of the required_operators.config.\n # Generated from --model_path /tmp/tmp0_jsx1i4  com.microsoft;1;FusedConv ai.onnx;9;Add,BatchNormalization,Concat,Conv,ConvTranspose,Relu\n Error Code\n 1: [----------] 2 tests from OrtModelOnlyTests 1: [ RUN      ] OrtModelOnlyTests.LoadOrtFormatModel 1: /home/me/Documents/onnxruntime/onnxruntime/test/framework/ort_model_only_test.cc:60: Failure 1: Value of: _tmp_status.IsOK() 1:   Actual: false 1: Expected: true 1: [ONNXRuntimeError] : 9 : NOT_IMPLEMENTED : Failed to find kernel for Loop(11) (node Loop1). Op with name (Loop1) and type (Loop) kernel not found in CPUExecutionProvider. No matching hash for 15949596726138182496 1: [  FAILED  ] OrtModelOnlyTests.LoadOrtFormatModel (11 ms) 1: [ RUN      ] OrtModelOnlyTests.LoadOrtFormatModelFromBuffer 1: /home/me/Documents/onnxruntime/onnxruntime/test/framework/ort_model_only_test.cc:60: Failure 1: Value of: _tmp_status.IsOK() 1:   Actual: false 1: Expected: true 1: [ONNXRuntimeError] : 9 : NOT_IMPLEMENTED : Failed to find kernel for Loop(11) (node Loop1). Op with name (Loop1) and type (Loop) kernel not found in CPUExecutionProvider. No matching hash for 15949596726138182496 1: [  FAILED  ] OrtModelOnlyTests.LoadOrtFormatModelFromBuffer (12 ms) 1: [----------] 2 tests from OrtModelOnlyTests (23 ms total)\n `\n 67% tests passed, 1 tests failed out of 3\n Total Test time (real) =   2.97 sec\n The following tests FAILED:\n 1 - onnxruntime_test_all (Failed)\n Errors while running CTest\n Traceback (most recent call last):\n File \"/home/me/Documents/onnxruntime/tools/ci_build/build.py\", line 1949, in \n sys.exit(main())\n File \"/home/me/Documents/onnxruntime/tools/ci_build/build.py\", line 1886, in main\n run_onnxruntime_tests(args, source_dir, ctest_path, build_dir, configs)\n File \"/home/me/Documents/onnxruntime/tools/ci_build/build.py\", line 1344, in run_onnxruntime_tests\n run_subprocess(ctest_cmd, cwd=cwd, dll_path=dll_path)\n File \"/home/me/Documents/onnxruntime/tools/ci_build/build.py\", line 449, in run_subprocess\n env=my_env, shell=shell)\n File \"/home/me/anaconda3/envs/wav2lip/lib/python3.7/subprocess.py\", line 512, in run\n output=stdout, stderr=stderr)\n subprocess.CalledProcessError: Command '['/usr/bin/ctest', '--build-config', 'MinSizeRel', '--verbose', '--timeout', '3600']' returned non-zero exit status 8.\n `\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "MarlNox", "commentT": "2020-10-20T21:03:23Z", "comment_text": "\n \t\tThe documentation should also specify . It's called out in the info on the reduced build <denchmark-link:https://github.com/microsoft/onnxruntime/blob/master/docs/Reduced_Operator_Kernel_build.md#build-time-reduction>here</denchmark-link>\n .\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "MarlNox", "commentT": "2020-10-21T19:03:05Z", "comment_text": "\n \t\t\n The documentation should also specify --skip_tests. It's called out in the info on the reduced build here.\n \n I just did and the script ran without errors, but there's no new files being created by the operation.\n Run command:\n \"onnxruntime/build.sh\" --config=MinSizeRel --build_shared_lib --minimal_build --disable_ml_ops --disable_exceptions --include_ops_by_config \"model/required_operators.config\" --skip_tests\n <denchmark-code>[ 98%] Linking CXX executable onnxruntime_perf_test\n [100%] Built target onnxruntime_perf_test\n [100%] Built target custom_op_library\n 2020-10-21 20:59:39,845 Build [DEBUG] - Subprocess completed. Return code=0\n 2020-10-21 20:59:39,846 Build [INFO] - Build complete\n </denchmark-code>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "MarlNox", "commentT": "2020-10-21T21:53:39Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/microsoft/onnxruntime/blob/master/docs/ONNX_Runtime_for_Mobile_Platforms.md#1-create-ort-format-model-and-configuration-file-with-required-operators>https://github.com/microsoft/onnxruntime/blob/master/docs/ONNX_Runtime_for_Mobile_Platforms.md#1-create-ort-format-model-and-configuration-file-with-required-operators</denchmark-link>\n  has details of the step to create the ORT format models.\n build.sh is from the second step which creates the ONNX Runtime shared library (under something like the build/Linux/MinSizeRel directory).\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "MarlNox", "commentT": "2020-10-21T23:01:20Z", "comment_text": "\n \t\t\n \n The documentation should also specify --skip_tests. It's called out in the info on the reduced build here.\n \n I just did and the script ran without errors, but there's no new files being created by the operation.\n Run command:\n \"onnxruntime/build.sh\" --config=MinSizeRel --build_shared_lib --minimal_build --disable_ml_ops --disable_exceptions --include_ops_by_config \"model/required_operators.config\" --skip_tests\n [ 98%] Linking CXX executable onnxruntime_perf_test\n [100%] Built target onnxruntime_perf_test\n [100%] Built target custom_op_library\n 2020-10-21 20:59:39,845 Build [DEBUG] - Subprocess completed. Return code=0\n 2020-10-21 20:59:39,846 Build [INFO] - Build complete\n \n \n Of course I have already performed step one and have the .ort file, and the .config file already.\n The folder Linux/build/MinSizeRel has been created along with all its subfiles/subfolders, however there's no generated model. Are there any further steps to get to the mobile optimized ORT file?\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "MarlNox", "commentT": "2020-10-22T00:05:55Z", "comment_text": "\n \t\tThe .ort file contains the model that was converted from ONNX format to the mobile optimized ORT format. This .ort file is what you create the inference session with instead of a .onnx file.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "MarlNox", "commentT": "2020-10-22T02:03:28Z", "comment_text": "\n \t\tThanks a lot for the clarification!\n Everything works smoothly now.\n \t\t"}}}, "commit": {"commit_id": "6d35be215fe9e43363d267cf995c747fbeef4d96", "commit_author": "Scott McKay", "commitT": "2020-10-22 08:55:42+10:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\ONNX_Runtime_for_Mobile_Platforms.md", "file_new_name": "docs\\ONNX_Runtime_for_Mobile_Platforms.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "51,82,86", "deleted_lines": "51,82,86"}}}}}}