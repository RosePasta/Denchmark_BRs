{"BR": {"BR_id": "1813", "BR_author": "yuslepukhin", "BRopenT": "2019-09-11T21:24:44Z", "BRcloseT": "2019-09-19T16:04:13Z", "BR_text": {"BRsummary": "ONNXRuntimerServer PredictionServiceImplTests.HappyPath unittest SegFaults", "BRdescription": "\n Describe the bug\n As an unrelated PR kicked off CI builds HappyPath unit tests started segfauilting.\n Urgency\n This CI build is not mandatory but we want it to pass we can detect other issues.\n System information\n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04):\n ONNX Runtime installed from - part of CI build\n ONNX Runtime version: tip of the master\n \n \n This PR prompts the issue <denchmark-link:https://github.com/microsoft/onnxruntime/pull/1714>#1714</denchmark-link>\n \n \n Pass\n Additional context\n Turns out InferenceSession object is not properly initialized. The test is written in a way that some shared state presence depends on the order of test execution. While what needs to be done to fix it is clear, it is not not clear how it's been working until now.\n See attached file\n <denchmark-link:https://github.com/microsoft/onnxruntime/files/3602789/ONNXServerSegFault.txt>ONNXServerSegFault.txt</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "yuslepukhin", "commentT": "2019-09-13T17:53:31Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/csteegz>@csteegz</denchmark-link>\n  Just a friendly reminder. One of our CI builds fails on it now.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "yuslepukhin", "commentT": "2019-09-13T17:59:34Z", "comment_text": "\n \t\tYup. I have a sketch for a first PR on my fork, but I haven't tested it. Hope to open something today or the weekend.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "yuslepukhin", "commentT": "2019-09-16T17:31:00Z", "comment_text": "\n \t\teek - this slipped, but I do really, really intend to get to it this week.\n \t\t"}}}, "commit": {"commit_id": "60e5eee52afe0865c2e476f7263ac885f47b2fa3", "commit_author": "Colin Versteeg", "commitT": "2019-09-19 09:04:12-07:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "0.575"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 8, "file_old_name": "onnxruntime\\server\\environment.cc", "file_new_name": "onnxruntime\\server\\environment.cc", "file_complexity": {"file_NLOC": "87", "file_CCN": "20", "file_NToken": "764"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "46,48,49,50,51,52,53,57", "deleted_lines": "46,47,49,53,54", "method_info": {"method_name": "onnxruntime::server::ServerEnvironment::InitializeModel", "method_params": "model_path", "method_startline": "46", "method_endline": "57", "method_complexity": {"method_NLOC": "10", "method_CCN": "2", "method_NToken": "90", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "67,68,69", "deleted_lines": "67,68", "method_info": {"method_name": "onnxruntime::server::ServerEnvironment::GetSession", "method_params": "", "method_startline": "67", "method_endline": "69", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "11", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "77,78,79,80,81,82,83,84", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::server::ServerEnvironment::GetSession", "method_params": "model_name,model_version", "method_startline": "77", "method_endline": "85", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "72", "method_nesting_level": "2"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "63,64,65,66,67,68,69,70", "deleted_lines": "67,68", "method_info": {"method_name": "onnxruntime::server::ServerEnvironment::GetModelOutputNames", "method_params": "model_name,model_version", "method_startline": "63", "method_endline": "71", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "72", "method_nesting_level": "2"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "45,46,48,49,50,51,52,53,57,58", "deleted_lines": "46,47,49,53,54,59,60", "method_info": {"method_name": "onnxruntime::server::ServerEnvironment::InitializeModel", "method_params": "model_path,model_name,model_version", "method_startline": "45", "method_endline": "61", "method_complexity": {"method_NLOC": "14", "method_CCN": "3", "method_NToken": "167", "method_nesting_level": "2"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "97,98,99,100,101,102,103,104,105", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::server::ServerEnvironment::UnloadModel", "method_params": "model_name,model_version", "method_startline": "97", "method_endline": "105", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "71", "method_nesting_level": "2"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "39", "deleted_lines": "39,40", "method_info": {"method_name": "onnxruntime::server::ServerEnvironment::ServerEnvironment", "method_params": "severity,sink", "method_startline": "35", "method_endline": "43", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "89", "method_nesting_level": "2"}}}, "hunk_7": {"Ismethod": 1, "added_lines": null, "deleted_lines": "59,60", "method_info": {"method_name": "onnxruntime::server::ServerEnvironment::GetModelOutputNames", "method_params": "", "method_startline": "59", "method_endline": "61", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "11", "method_nesting_level": "2"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "onnxruntime\\server\\environment.h", "file_new_name": "onnxruntime\\server\\environment.h", "file_complexity": {"file_NLOC": "42", "file_CCN": "1", "file_NToken": "373"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "44,45,46", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::server::ServerEnvironment::SessionHolder::SessionHolder", "method_params": "env,path,options", "method_startline": "44", "method_endline": "46", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "44", "method_nesting_level": "4"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "onnxruntime\\server\\executor.cc", "file_new_name": "onnxruntime\\server\\executor.cc", "file_complexity": {"file_NLOC": "130", "file_CCN": "20", "file_NToken": "1105"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "134,139", "deleted_lines": "134,139", "method_info": {"method_name": "onnxruntime::server::Executor::Predict", "method_params": "model_name,model_version,request,response", "method_startline": "106", "method_endline": "164", "method_complexity": {"method_NLOC": "47", "method_CCN": "8", "method_NToken": "435", "method_nesting_level": "2"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "onnxruntime\\server\\main.cc", "file_new_name": "onnxruntime\\server\\main.cc", "file_complexity": {"file_NLOC": "77", "file_CCN": "7", "file_NToken": "656"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "66", "deleted_lines": "66", "method_info": {"method_name": "main", "method_params": "argc", "method_startline": "35", "method_endline": "119", "method_complexity": {"method_NLOC": "64", "method_CCN": "7", "method_NToken": "614", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "onnxruntime\\test\\server\\unit_tests\\executor_test.cc", "file_new_name": "onnxruntime\\test\\server\\unit_tests\\executor_test.cc", "file_complexity": {"file_NLOC": "41", "file_CCN": "3", "file_NToken": "269"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34", "deleted_lines": "19,20,25", "method_info": {"method_name": "onnxruntime::server::test::TEST", "method_params": "ExecutorTests,TestMul_1", "method_startline": "19", "method_endline": "40", "method_complexity": {"method_NLOC": "17", "method_CCN": "1", "method_NToken": "177", "method_nesting_level": "3"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "21,22,23,24,25,26", "deleted_lines": "25", "method_info": {"method_name": "onnxruntime::server::test::ExecutorTest::SetUp", "method_params": "", "method_startline": "21", "method_endline": "26", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "36", "method_nesting_level": "4"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "28,29,30,31", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::server::test::ExecutorTest::TearDown", "method_params": "", "method_startline": "28", "method_endline": "31", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "27", "method_nesting_level": "4"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "34", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::server::test::TEST_F", "method_params": "ExecutorTest,TestMul_1", "method_startline": "34", "method_endline": "53", "method_complexity": {"method_NLOC": "15", "method_CCN": "1", "method_NToken": "163", "method_nesting_level": "3"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 16, "file_old_name": "onnxruntime\\test\\server\\unit_tests\\prediction_service_impl_test.cc", "file_new_name": "onnxruntime\\test\\server\\unit_tests\\prediction_service_impl_test.cc", "file_complexity": {"file_NLOC": "118", "file_CCN": "10", "file_NToken": "936"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "43,44,45,46", "deleted_lines": "45", "method_info": {"method_name": "onnxruntime::server::grpc::test::PredictionServiceImplTest::TearDown", "method_params": "", "method_startline": "43", "method_endline": "46", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "33", "method_nesting_level": "5"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "73", "deleted_lines": "69", "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST", "method_params": "PredictionServiceImplTests,InvalidInputRequestID", "method_startline": "69", "method_endline": "82", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "108", "method_nesting_level": "4"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "86", "deleted_lines": "84", "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST", "method_params": "PredictionServiceImplTests,SuccessClientID", "method_startline": "84", "method_endline": "97", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "125", "method_nesting_level": "4"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "116", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST_F", "method_params": "PredictionServiceImplTest,InvalidInputClientID", "method_startline": "116", "method_endline": "131", "method_complexity": {"method_NLOC": "15", "method_CCN": "1", "method_NToken": "131", "method_nesting_level": "4"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "52", "deleted_lines": "56", "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST_F", "method_params": "PredictionServiceImplTest,HappyPath", "method_startline": "52", "method_endline": "60", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "65", "method_nesting_level": "4"}}}, "hunk_5": {"Ismethod": 1, "added_lines": null, "deleted_lines": "31,32,33", "method_info": {"method_name": "onnxruntime::server::grpc::test::GetEnvironment", "method_params": "", "method_startline": "31", "method_endline": "33", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "41", "method_nesting_level": "4"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "62", "deleted_lines": "56", "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST", "method_params": "PredictionServiceImplTests,SuccessRequestID", "method_startline": "56", "method_endline": "67", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "102", "method_nesting_level": "4"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "45,46,47,48,49,50,52", "deleted_lines": "45", "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST", "method_params": "PredictionServiceImplTests,InvalidInput", "method_startline": "45", "method_endline": "54", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "89", "method_nesting_level": "4"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "86", "deleted_lines": "99", "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST_F", "method_params": "PredictionServiceImplTest,InvalidInputRequestID", "method_startline": "86", "method_endline": "99", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "108", "method_nesting_level": "4"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "101", "deleted_lines": "99", "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST", "method_params": "PredictionServiceImplTests,InvalidInputClientID", "method_startline": "99", "method_endline": "114", "method_complexity": {"method_NLOC": "15", "method_CCN": "1", "method_NToken": "131", "method_nesting_level": "4"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "101", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST_F", "method_params": "PredictionServiceImplTest,SuccessClientID", "method_startline": "101", "method_endline": "114", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "125", "method_nesting_level": "4"}}}, "hunk_11": {"Ismethod": 1, "added_lines": "35,36,37,38,39,40,41,42,43", "deleted_lines": "35", "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST", "method_params": "PredictionServiceImplTests,HappyPath", "method_startline": "35", "method_endline": "43", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "65", "method_nesting_level": "4"}}}, "hunk_12": {"Ismethod": 1, "added_lines": "36,37,38,39,40,41,42", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::server::grpc::test::PredictionServiceImplTest::SetUp", "method_params": "", "method_startline": "36", "method_endline": "42", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "42", "method_nesting_level": "5"}}}, "hunk_13": {"Ismethod": 1, "added_lines": "73", "deleted_lines": "84", "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST_F", "method_params": "PredictionServiceImplTest,SuccessRequestID", "method_startline": "73", "method_endline": "84", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "102", "method_nesting_level": "4"}}}, "hunk_14": {"Ismethod": 1, "added_lines": "62", "deleted_lines": "69", "method_info": {"method_name": "onnxruntime::server::grpc::test::TEST_F", "method_params": "PredictionServiceImplTest,InvalidInput", "method_startline": "62", "method_endline": "71", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "89", "method_nesting_level": "4"}}}, "hunk_15": {"Ismethod": 1, "added_lines": "47,48,49", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::server::grpc::test::PredictionServiceImplTest::GetEnvironment", "method_params": "", "method_startline": "47", "method_endline": "49", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "41", "method_nesting_level": "5"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "onnxruntime\\test\\server\\unit_tests\\test_main.cc", "file_new_name": "onnxruntime\\test\\server\\unit_tests\\test_main.cc", "file_complexity": {"file_NLOC": "15", "file_CCN": "2", "file_NToken": "88"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "13", "deleted_lines": "13", "method_info": {"method_name": "main", "method_params": "argc,argv", "method_startline": "8", "method_endline": "21", "method_complexity": {"method_NLOC": "12", "method_CCN": "2", "method_NToken": "80", "method_nesting_level": "0"}}}}}}}}