{"BR": {"BR_id": "1334", "BR_author": "minus-one", "BRopenT": "2019-07-02T21:56:28Z", "BRcloseT": "2019-07-19T20:54:10Z", "BR_text": {"BRsummary": "ssd-mobilenet model load fails with GPU backend", "BRdescription": "\n \n Source of ssd-mobilenet: <denchmark-link:https://zenodo.org/record/3163026/files/ssd_mobilenet_v1_coco_2018_01_28.onnx>https://zenodo.org/record/3163026/files/ssd_mobilenet_v1_coco_2018_01_28.onnx</denchmark-link>\n  (taken via MLPerf/inference <denchmark-link:https://github.com/mlperf/inference/tree/master/v0.5/classification_and_detection>https://github.com/mlperf/inference/tree/master/v0.5/classification_and_detection</denchmark-link>\n )\n So this model correctly loads with CPU backend. It fails with the GPU backend. I tested it with the pypi build and a more recent master build with cuda 10.0\n I try to load the model and the following error throws up:\n <denchmark-code>  self._sess.load_model(path_or_bytes)\n RuntimeError: [ONNXRuntimeError] : 9 : NOT_IMPLEMENTED : Using an input in multiple nodes on different devices is not supported currently. Input:Postprocessor/BatchMultiClassNonMaxSuppression/map/while/Slice/begin:0 is used by node Add__2519 (CUDAExecutionProvider) and node Postprocessor/BatchMultiClassNonMaxSuppression/map/while/Slice (CPUExecutionProvider).\n \n </denchmark-code>\n \n Note that the model loads correctly with an onnxruntime build with backend of CPU.\n Not sure if the issue is with the onnx file or the runtime or in the conversion. Any pointers / clarifications would help.\n Also a bunch of these warnings popped up.\n \n See attached file for whole log.<denchmark-link:https://github.com/microsoft/onnxruntime/files/3352451/dump.log>dump.log</denchmark-link>\n \n System information\n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04):\n Ubuntu 18.04\n ONNX Runtime installed from (source or binary):\n Source - master / binary pypi\n ONNX Runtime version:\n 0.4.0\n Python version:\n 3.6.8\n Visual Studio version (if applicable):\n GCC/Compiler version (if compiling from source):\n 7.4.0\n CUDA/cuDNN version:\n 10.0\n GPU model and memory:\n \n To Reproduce\n Describe steps/code to reproduce the behavior:\n Download the model from the above mentioned link.\n open python,\n import onnxruntime as rt\n rt.InferenceSession('ssd_mobilenet_v1_coco_2018_01_28.onnx')\n Expected behavior\n A clear and concise description of what you expected to happen.\n Model loads correctly\n Screenshots\n If applicable, add screenshots to help explain your problem.\n \n Add any other context about the problem here. If the issue is about a particular model, please share the model details as well to facilitate debugging.\n So, in reference to <denchmark-link:https://github.com/microsoft/onnxruntime/issues/1229>#1229</denchmark-link>\n \n I downloaded the mentioned converted model from ssd_mobilenet_v2 as well and that fails similarly, although with CPU backend it did load correctly.\n \t"}, "comments": {}}, "commit": {"commit_id": "751ee7bb23e63b54ab5a311053fedb0dca43331a", "commit_author": "Hariharan Seshadri", "commitT": "2019-07-19 13:54:08-07:00", "commit_complexity": {"commit_NLOC": "0.09782608695652174", "commit_CCN": "0.9239130434782609", "commit_Nprams": "0.3695652173913043"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 7, "file_old_name": "onnxruntime\\core\\optimizer\\transformer_memcpy.cc", "file_new_name": "onnxruntime\\core\\optimizer\\transformer_memcpy.cc", "file_complexity": {"file_NLOC": "239", "file_CCN": "83", "file_NToken": "2175"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "169,176,177,178,179,180,181,182,183,184,185,186,187,188,189", "deleted_lines": "153,160,161,162,163,164,165,166,167", "method_info": {"method_name": "onnxruntime::TransformerMemcpyImpl::ProcessDefs", "method_params": "node,kernel_registries", "method_startline": "153", "method_endline": "207", "method_complexity": {"method_NLOC": "43", "method_CCN": "18", "method_NToken": "369", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "126,129,130,134,135", "deleted_lines": "153,160,161,162,163,164,165,166,167", "method_info": {"method_name": "onnxruntime::TransformerMemcpyImpl::ModifyGraph", "method_params": "kernel_registries", "method_startline": "124", "method_endline": "167", "method_complexity": {"method_NLOC": "31", "method_CCN": "13", "method_NToken": "211", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "58,59,60,61,62,63,64,65,66", "deleted_lines": "66", "method_info": {"method_name": "onnxruntime::GetInitializer", "method_params": "graph,name,check_outer_scope", "method_startline": "58", "method_endline": "66", "method_complexity": {"method_NLOC": "9", "method_CCN": "4", "method_NToken": "75", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "299,301,309,310,311,312,313,314,315,316,317", "deleted_lines": "277,279,287,288,289,290", "method_info": {"method_name": "onnxruntime::TransformerMemcpyImpl::ProcessInitializers", "method_params": "kernel_registries", "method_startline": "277", "method_endline": "325", "method_complexity": {"method_NLOC": "40", "method_CCN": "9", "method_NToken": "392", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "299,301,309,310,311,312,313,314,315,316,317,352,353,354", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::TransformerMemcpyImpl::ProcessInitializers", "method_params": "kernel_registries,initializers_consumed", "method_startline": "299", "method_endline": "355", "method_complexity": {"method_NLOC": "39", "method_CCN": "9", "method_NToken": "382", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "169,176,177,178,179,180,181,182,183,184,185,186,187,188,189", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::TransformerMemcpyImpl::ProcessDefs", "method_params": "node,kernel_registries,initializers_consumed", "method_startline": "169", "method_endline": "229", "method_complexity": {"method_NLOC": "48", "method_CCN": "19", "method_NToken": "411", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "79,80", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::MemcpyTransformer::ApplyImpl", "method_params": "graph,modified,graph_level", "method_startline": "70", "method_endline": "97", "method_complexity": {"method_NLOC": "18", "method_CCN": "10", "method_NToken": "125", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "onnxruntime\\test\\framework\\memcpy_transformer_test.cc", "file_new_name": "onnxruntime\\test\\framework\\memcpy_transformer_test.cc", "file_complexity": {"file_NLOC": "219", "file_CCN": "16", "file_NToken": "2017"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::test::TEST", "method_params": "TransformerTest,TestCopyNodeInsertionInitializerInSubgraph", "method_startline": "180", "method_endline": "284", "method_complexity": {"method_NLOC": "76", "method_CCN": "4", "method_NToken": "650", "method_nesting_level": "2"}}}}}}}}