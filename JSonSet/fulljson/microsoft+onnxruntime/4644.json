{"BR": {"BR_id": "4644", "BR_author": "PatriceVignola", "BRopenT": "2020-07-28T20:05:12Z", "BRcloseT": "2020-07-30T06:32:02Z", "BR_text": {"BRsummary": "Multinomial float16 is broken since a recent change to the Cast transformer", "BRdescription": "\n \n Multinomial float16 throws an exception since a <denchmark-link:https://github.com/microsoft/onnxruntime/pull/4523>recent change to the Cast transformer</denchmark-link>\n \n \n Run inference the following model: <denchmark-link:https://github.com/microsoft/onnxruntime/files/4990832/multinomial_float16.zip>multinomial_float16.zip</denchmark-link>\n \n Expected behavior\n The model completes inference without throwing an exception\n Additional context\n The change to the Cast transformer sets the output types of nodes who have a \"dtype\" attribute to float, but Multinomial is a special case that outputs only int32 or int64 tensors. Therefore, an exception is thrown during inference.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "PatriceVignola", "commentT": "2020-07-28T20:41:20Z", "comment_text": "\n \t\tThanks, I ll take a look at this.\n \t\t"}}}, "commit": {"commit_id": "382f94c95cd7c991cc4385d9de313633a027c5ff", "commit_author": "Hariharan Seshadri", "commitT": "2020-07-29 23:32:01-07:00", "commit_complexity": {"commit_NLOC": "0.875", "commit_CCN": "0.875", "commit_Nprams": "0.875"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "onnxruntime\\core\\optimizer\\insert_cast_transformer.cc", "file_new_name": "onnxruntime\\core\\optimizer\\insert_cast_transformer.cc", "file_complexity": {"file_NLOC": "223", "file_CCN": "60", "file_NToken": "1715"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "257,258,259,260", "deleted_lines": "257", "method_info": {"method_name": "onnxruntime::InsertCastTransformer::ApplyImpl", "method_params": "graph,modified,graph_level,logger", "method_startline": "198", "method_endline": "309", "method_complexity": {"method_NLOC": "79", "method_CCN": "17", "method_NToken": "517", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "onnxruntime\\test\\framework\\insert_cast_transformer_test.cc", "file_new_name": "onnxruntime\\test\\framework\\insert_cast_transformer_test.cc", "file_complexity": {"file_NLOC": "140", "file_CCN": "16", "file_NToken": "1514"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175", "deleted_lines": null, "method_info": {"method_name": "onnxruntime::test::TEST", "method_params": "TransformerTest,MultinomialWithFloat16Input", "method_startline": "160", "method_endline": "175", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "139", "method_nesting_level": "2"}}}}}, "file_2": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "onnxruntime\\test\\testdata\\transform\\multinomial_float16.onnx", "file_new_name": "onnxruntime\\test\\testdata\\transform\\multinomial_float16.onnx", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}}}}