{"BR": {"BR_id": "3188", "BR_author": "jeandebleau", "BRopenT": "2020-03-12T07:56:21Z", "BRcloseT": "2020-03-13T16:32:37Z", "BR_text": {"BRsummary": "quantize.py error(s) static quantization", "BRdescription": "\n Hi,\n I am currently debugging the quantization tool. There is a least one error in the function def _get_quantize_input_nodes(self, node, input_index, qType), line 623.\n lines 623-624: return [qlinear_node] should be added ; this specific conditional branch does not return a value.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jeandebleau", "commentT": "2020-03-13T16:32:37Z", "comment_text": "\n \t\tThanks for reporting the bug. Let's know if you found more issues.\n \t\t"}}}, "commit": {"commit_id": "c69194ec4c8c9674368113aa6044d0db708cd813", "commit_author": "Yufeng Li", "commitT": "2020-03-13 09:28:41-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.21818181818181817", "commit_Nprams": "0.7909090909090909"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "onnxruntime\\python\\tools\\quantization\\calibrate.py", "file_new_name": "onnxruntime\\python\\tools\\quantization\\calibrate.py", "file_complexity": {"file_NLOC": "189", "file_CCN": "34", "file_NToken": "1242"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "42,43,44,45,47,48,49,53,54,55,56,58,59,60", "deleted_lines": "41,42,44,48,49,51", "method_info": {"method_name": "augment_graph", "method_params": "model", "method_startline": "25", "method_endline": "63", "method_complexity": {"method_NLOC": "28", "method_CCN": "3", "method_NToken": "191", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "180,182,183,184,191,192,193", "deleted_lines": "188,190,191", "method_info": {"method_name": "calculate_quantization_params", "method_params": "model,quantization_thresholds", "method_startline": "160", "method_endline": "196", "method_complexity": {"method_NLOC": "15", "method_CCN": "4", "method_NToken": "90", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "236,237,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,275,276,278,279,281,282,283,284,285,286,287,288", "deleted_lines": "234", "method_info": {"method_name": "main", "method_params": "", "method_startline": "234", "method_endline": "291", "method_complexity": {"method_NLOC": "50", "method_CCN": "2", "method_NToken": "283", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "151", "deleted_lines": "148,150,157", "method_info": {"method_name": "calculate_scale_zeropoint", "method_params": "node,next_node,rmin,rmax", "method_startline": "130", "method_endline": "157", "method_complexity": {"method_NLOC": "20", "method_CCN": "7", "method_NToken": "153", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "224,225,227,228,229", "deleted_lines": "200,201,202,222,224,226,227,228", "method_info": {"method_name": "load_pb_file", "method_params": "data_file_name,size_limit,samples,channels,height,width", "method_startline": "199", "method_endline": "231", "method_complexity": {"method_NLOC": "21", "method_CCN": "7", "method_NToken": "163", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "84,85,88,89,90,93,94,95,96,97,98,99,100,106,107,108,109,112,113,115,116,117,118,119,120,122,123,124", "deleted_lines": "72,75,78,79,85,88,90,91,92,94,120", "method_info": {"method_name": "get_intermediate_outputs", "method_params": "model_path,session,inputs,calib_mode", "method_startline": "69", "method_endline": "127", "method_complexity": {"method_NLOC": "40", "method_CCN": "11", "method_NToken": "306", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "onnxruntime\\python\\tools\\quantization\\data_preprocess.py", "file_new_name": "onnxruntime\\python\\tools\\quantization\\data_preprocess.py", "file_complexity": {"file_NLOC": "44", "file_CCN": "4", "file_NToken": "323"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "37,38,40", "deleted_lines": "33,34,36", "method_info": {"method_name": "preprocess_method1", "method_params": "image_filepath,height,width", "method_startline": "27", "method_endline": "41", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "79", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "61,62,63,64,65", "deleted_lines": null, "method_info": {"method_name": "load_batch", "method_params": "images_folder,height,width,preprocess_func_name,size_limit", "method_startline": "61", "method_endline": "65", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "15", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "54,55,57", "deleted_lines": "49,51,55", "method_info": {"method_name": "preprocess_method2", "method_params": "image_filepath,height,width", "method_startline": "44", "method_endline": "58", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "89", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "20,21,22,23", "deleted_lines": "19,20", "method_info": {"method_name": "set_preprocess", "method_params": "preprocess_func_name", "method_startline": "14", "method_endline": "24", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "22", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 32, "file_old_name": "onnxruntime\\python\\tools\\quantization\\quantize.py", "file_new_name": "onnxruntime\\python\\tools\\quantization\\quantize.py", "file_complexity": {"file_NLOC": "935", "file_CCN": "146", "file_NToken": "6309"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "421,422,423,424,425,426,427,428,429,430,433,434,435,436,437,438,439", "deleted_lines": "415,416,417,419,420,425,434,436,438", "method_info": {"method_name": "_get_quantized_weight", "method_params": "self,initializer,qType", "method_startline": "414", "method_endline": "442", "method_complexity": {"method_NLOC": "21", "method_CCN": "1", "method_NToken": "142", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "1046,1047,1048,1050,1051,1052,1053,1054,1055,1056,1060", "deleted_lines": "1028,1030,1040,1041,1055,1060,1064", "method_info": {"method_name": "_handle_other_ops", "method_params": "self,node,new_nodes_list", "method_startline": "1028", "method_endline": "1064", "method_complexity": {"method_NLOC": "24", "method_CCN": "4", "method_NToken": "136", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "1198,1199,1205,1206,1207,1208,1218,1219,1221,1222,1232,1233,1234", "deleted_lines": "1193,1194,1200,1201,1209,1210,1211", "method_info": {"method_name": "_quantize_matmul_integer_ops", "method_params": "self,node,new_nodes_list", "method_startline": "1182", "method_endline": "1235", "method_complexity": {"method_NLOC": "37", "method_CCN": "5", "method_NToken": "255", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "585,586", "deleted_lines": "586", "method_info": {"method_name": "_get_dynamic_input_quantization_params_uint8", "method_params": "self,input_name,nodes_list", "method_startline": "585", "method_endline": "586", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "9", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "383,389,390,391,392,393,394,398,401,402,403,404,405,406,407,409,410", "deleted_lines": "398,399,406,410,412", "method_info": {"method_name": "_update_graph", "method_params": "self,weight", "method_startline": "375", "method_endline": "412", "method_complexity": {"method_NLOC": "27", "method_CCN": "2", "method_NToken": "183", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "1071,1076", "deleted_lines": null, "method_info": {"method_name": "_handle_activation_ops", "method_params": "self,node,new_node_list", "method_startline": "1066", "method_endline": "1089", "method_complexity": {"method_NLOC": "9", "method_CCN": "4", "method_NToken": "84", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "132,134,135,138,139,140,142,143,144", "deleted_lines": "111,112,114,126", "method_info": {"method_name": "quantize_data", "method_params": "data,quantize_range,qType", "method_startline": "109", "method_endline": "146", "method_complexity": {"method_NLOC": "18", "method_CCN": "4", "method_NToken": "172", "method_nesting_level": "0"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "961,962,976,977,978,979,987,988,991,992,994,995,998,999,1000,1008,1009,1010,1012,1013", "deleted_lines": "958,964,968,969,979,981,991,1011,1017,1018", "method_info": {"method_name": "_quantize_inputs", "method_params": "self,node,indices,new_nodes_list", "method_startline": "945", "method_endline": "1026", "method_complexity": {"method_NLOC": "54", "method_CCN": "11", "method_NToken": "367", "method_nesting_level": "1"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "1370", "deleted_lines": null, "method_info": {"method_name": "_quantize_matmul", "method_params": "self,node,new_nodes_list", "method_startline": "1363", "method_endline": "1378", "method_complexity": {"method_NLOC": "7", "method_CCN": "3", "method_NToken": "58", "method_nesting_level": "1"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "465,466,467,474,478,479,481,482,483,484,485,486,487,488,489,490,493,494,495,496,497,498,499", "deleted_lines": "452,457,463,464,468,469,473,477,478,480,485,486,490", "method_info": {"method_name": "_get_quantized_weight_convolution", "method_params": "self,initializer,qType", "method_startline": "444", "method_endline": "502", "method_complexity": {"method_NLOC": "45", "method_CCN": "4", "method_NToken": "325", "method_nesting_level": "1"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "1311,1312,1332,1333,1334,1335,1339,1340,1341,1343", "deleted_lines": null, "method_info": {"method_name": "_quantize_matmul_qlinear_ops", "method_params": "self,node,new_nodes_list", "method_startline": "1297", "method_endline": "1344", "method_complexity": {"method_NLOC": "30", "method_CCN": "2", "method_NToken": "226", "method_nesting_level": "1"}}}, "hunk_11": {"Ismethod": 1, "added_lines": "1248,1253,1257,1283,1284,1285,1286,1290,1291,1292,1294", "deleted_lines": "1268,1269,1275", "method_info": {"method_name": "_quantize_convolution_qlinear_ops", "method_params": "self,node,new_nodes_list", "method_startline": "1237", "method_endline": "1295", "method_complexity": {"method_NLOC": "40", "method_CCN": "5", "method_NToken": "287", "method_nesting_level": "1"}}}, "hunk_12": {"Ismethod": 1, "added_lines": "713,714,725,729,730,731,732,734,735,738,741,742,744,750,751,752,753,755,759,760,761,762,765", "deleted_lines": "712,714,717,721,724,725,726,728,729,737,739,740,744,746,750,751,754,755,756,762,764", "method_info": {"method_name": "_get_quantize_input_nodes", "method_params": "self,node,input_index,qType", "method_startline": "710", "method_endline": "765", "method_complexity": {"method_NLOC": "39", "method_CCN": "6", "method_NToken": "242", "method_nesting_level": "1"}}}, "hunk_13": {"Ismethod": 1, "added_lines": "1395,1396,1397,1398,1404,1405,1406,1407", "deleted_lines": null, "method_info": {"method_name": "check_opset_version", "method_params": "org_model,force_fusions", "method_startline": "1381", "method_endline": "1413", "method_complexity": {"method_NLOC": "23", "method_CCN": "5", "method_NToken": "81", "method_nesting_level": "0"}}}, "hunk_14": {"Ismethod": 1, "added_lines": "269,270,271", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,model,per_channel,mode,static,fuse_dynamic_quant,weight_qType,input_qType,quantization_params,nodes_to_quantize", "method_startline": "269", "method_endline": "271", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "23", "method_nesting_level": "1"}}}, "hunk_15": {"Ismethod": 1, "added_lines": "219", "deleted_lines": null, "method_info": {"method_name": "_find_node_by_name", "method_params": "node_name,graph,new_nodes_list", "method_startline": "210", "method_endline": "222", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "34", "method_nesting_level": "0"}}}, "hunk_16": {"Ismethod": 1, "added_lines": "767,768", "deleted_lines": "767,768", "method_info": {"method_name": "_get_bias_add_nodes", "method_params": "self,nodes,node,last_output,quantized_bias_name", "method_startline": "767", "method_endline": "768", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "13", "method_nesting_level": "1"}}}, "hunk_17": {"Ismethod": 1, "added_lines": "306,309,318,320,330,331,332,333,336,337", "deleted_lines": "305,306,321,325,326,336", "method_info": {"method_name": "quantize_model", "method_params": "self", "method_startline": "300", "method_endline": "339", "method_complexity": {"method_NLOC": "29", "method_CCN": "15", "method_NToken": "256", "method_nesting_level": "1"}}}, "hunk_18": {"Ismethod": 1, "added_lines": "520,521", "deleted_lines": "521", "method_info": {"method_name": "_get_dynamic_input_quantization_params_int8", "method_params": "self,input_name,nodes_list", "method_startline": "520", "method_endline": "521", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "9", "method_nesting_level": "1"}}}, "hunk_19": {"Ismethod": 1, "added_lines": "1416,1417,1418,1419,1420,1421,1422,1423,1424,1425", "deleted_lines": null, "method_info": {"method_name": "quantize", "method_params": "model,per_channel,nbits,quantization_mode,static,force_fusions,symmetric_activation,symmetric_weight,quantization_params,nodes_to_quantize", "method_startline": "1416", "method_endline": "1425", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "43", "method_nesting_level": "0"}}}, "hunk_20": {"Ismethod": 1, "added_lines": "880,882,883,884,888,889,891,895,896,897,898,899,900,903,904,905,906,907,913,915,916,919,920,921,922,923,927,928,929,930,931,932,934,935,936,937,938,939,940", "deleted_lines": "876,878,879,883,894,899,918,922", "method_info": {"method_name": "_quantize_bias", "method_params": "self,node,new_node_list", "method_startline": "875", "method_endline": "943", "method_complexity": {"method_NLOC": "48", "method_CCN": "4", "method_NToken": "351", "method_nesting_level": "1"}}}, "hunk_21": {"Ismethod": 1, "added_lines": "504,505", "deleted_lines": "504", "method_info": {"method_name": "_get_dynamic_input_quantization_params", "method_params": "self,input_name,nodes_list,qType", "method_startline": "504", "method_endline": "505", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "11", "method_nesting_level": "1"}}}, "hunk_22": {"Ismethod": 1, "added_lines": "839,840", "deleted_lines": "840", "method_info": {"method_name": "_dynamic_quantize_bias", "method_params": "self,input_name,weight_scale_name,bias_name,quantized_bias_name,new_node_list", "method_startline": "839", "method_endline": "840", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "15", "method_nesting_level": "1"}}}, "hunk_23": {"Ismethod": 1, "added_lines": "801,809,810,811,812,813,814,822,823,824,825,826,827,828", "deleted_lines": "814,815,816,824,827,829,832", "method_info": {"method_name": "_update_unsupported_nodes_using_weight", "method_params": "self,weight,new_nodes_list", "method_startline": "801", "method_endline": "837", "method_complexity": {"method_NLOC": "24", "method_CCN": "8", "method_NToken": "167", "method_nesting_level": "1"}}}, "hunk_24": {"Ismethod": 1, "added_lines": "156,157,182,183", "deleted_lines": "151,184", "method_info": {"method_name": "_attribute_to_kwarg", "method_params": "attribute", "method_startline": "149", "method_endline": "185", "method_complexity": {"method_NLOC": "28", "method_CCN": "12", "method_NToken": "193", "method_nesting_level": "0"}}}, "hunk_25": {"Ismethod": 1, "added_lines": "57,58,59,60,61,62,63,64,65,66", "deleted_lines": "57,61,62,63", "method_info": {"method_name": "__init__", "method_params": "self,name,initializer,rmins,rmaxs,zero_points,scales,data,quantized_data,axis,qType", "method_startline": "57", "method_endline": "67", "method_complexity": {"method_NLOC": "11", "method_CCN": "1", "method_NToken": "39", "method_nesting_level": "1"}}}, "hunk_26": {"Ismethod": 1, "added_lines": "349,350,351", "deleted_lines": "342,343,344,348,351,352", "method_info": {"method_name": "find_weight_data", "method_params": "self,initializer", "method_startline": "341", "method_endline": "352", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "48", "method_nesting_level": "1"}}}, "hunk_27": {"Ismethod": 1, "added_lines": "92,93,94,95,96,97,98", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,name,new_quantized_name,scale_name,zero_point_name,quantized_value_type,axis,qType", "method_startline": "92", "method_endline": "99", "method_complexity": {"method_NLOC": "8", "method_CCN": "1", "method_NToken": "27", "method_nesting_level": "1"}}}, "hunk_28": {"Ismethod": 1, "added_lines": "366,367,371,372,373", "deleted_lines": "354,365,366,367,368,371,372", "method_info": {"method_name": "_remove_quantized_weights", "method_params": "self", "method_startline": "354", "method_endline": "373", "method_complexity": {"method_NLOC": "12", "method_CCN": "6", "method_NToken": "89", "method_nesting_level": "1"}}}, "hunk_29": {"Ismethod": 1, "added_lines": "1137,1138,1144,1145,1149,1150,1151,1152,1162,1163,1165,1166,1176,1177,1178", "deleted_lines": "1114,1115,1135,1136,1140,1142,1169", "method_info": {"method_name": "_quantize_convolution_integer_ops", "method_params": "self,node,new_nodes_list", "method_startline": "1111", "method_endline": "1180", "method_complexity": {"method_NLOC": "48", "method_CCN": "8", "method_NToken": "324", "method_nesting_level": "1"}}}, "hunk_30": {"Ismethod": 1, "added_lines": "1095,1099,1100,1101", "deleted_lines": "1091,1095,1097", "method_info": {"method_name": "_quantize_gather_ops", "method_params": "self,node,new_nodes_list", "method_startline": "1091", "method_endline": "1109", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "125", "method_nesting_level": "1"}}}, "hunk_31": {"Ismethod": 1, "added_lines": "670,672,677,678,679,680,683,684,685,687,688,689,701,702,703,704,705,706", "deleted_lines": "667,668,672,680,681,689,690,691,692,703", "method_info": {"method_name": "_get_quantization_params", "method_params": "self,param_name", "method_startline": "665", "method_endline": "708", "method_complexity": {"method_NLOC": "31", "method_CCN": "7", "method_NToken": "222", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "onnxruntime\\python\\tools\\quantization\\test_calibrate.py", "file_new_name": "onnxruntime\\python\\tools\\quantization\\test_calibrate.py", "file_complexity": {"file_NLOC": "117", "file_CCN": "9", "file_NToken": "1180"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "121,129,131,152,153", "deleted_lines": "123,124,128", "method_info": {"method_name": "test_load_pb", "method_params": "self", "method_startline": "115", "method_endline": "153", "method_complexity": {"method_NLOC": "29", "method_CCN": "2", "method_NToken": "329", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "100,101,102,103,104,105,106,108,109,110,111,112,113", "deleted_lines": "100,102", "method_info": {"method_name": "test_load_batch", "method_params": "self", "method_startline": "96", "method_endline": "113", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "125", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "29,30,31,32,34,35,36,37,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,74,75,76,77,78,79,87,88,89", "deleted_lines": "29,31,32,41,42,43,44,45,46,58,59,60,68,79,80,82,83,84,85,92", "method_info": {"method_name": "test_augment_graph", "method_params": "self", "method_startline": "21", "method_endline": "94", "method_complexity": {"method_NLOC": "62", "method_CCN": "6", "method_NToken": "673", "method_nesting_level": "1"}}}}}}}}