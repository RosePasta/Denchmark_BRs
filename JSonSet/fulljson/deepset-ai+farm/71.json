{"BR": {"BR_id": "71", "BR_author": "tholor", "BRopenT": "2019-08-28T13:26:58Z", "BRcloseT": "2019-08-30T06:56:30Z", "BR_text": {"BRsummary": "Test for document regression broken: TypeError in featurize_samples()", "BRdescription": "\n The test for the recently added RegressionProcessor is broken.\n <denchmark-link:https://github.com/busyxin>@busyxin</denchmark-link>\n  Can you please have a look at what caused this?\n <denchmark-code>../farm/data_handler/data_silo.py:39: in __init__\n     self._load_data()\n ../farm/data_handler/data_silo.py:47: in _load_data\n     self.data[\"train\"], self.tensor_names = self.processor.dataset_from_file(train_file)\n ../farm/data_handler/processor.py:369: in dataset_from_file\n     self._featurize_samples()\n _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n \n self = <farm.data_handler.processor.RegressionProcessor object at 0x7f2a0406e320>\n \n     def _featurize_samples(self):\n         chunks_to_process = int(len(self.baskets) / self.multiprocessing_chunk_size)\n         num_cpus = min(mp.cpu_count(), self.max_processes, chunks_to_process) or 1\n         logger.info(\n             f\"Got ya {num_cpus} parallel workers to featurize samples in baskets (chunksize = {self.multiprocessing_chunk_size}) ...\"\n         )\n     \n         try:\n             if \"train\" in self.baskets[0].id:\n                 train_labels = []\n                 for basket in self.baskets:\n                     for sample in basket.samples:\n                         train_labels.append(sample.clear_text[\"label\"])\n                 scaler = StandardScaler()\n                 scaler.fit(np.reshape(train_labels, (-1, 1)))\n                 self.label_list = [scaler.mean_.item(), scaler.scale_.item()]\n                 # Create label_maps because featurize is called after Processor instantiation\n                 self.label_maps = [{0:scaler.mean_.item(), 1:scaler.scale_.item()}]\n     \n         except Exception as e:\n             logger.warning(f\"Baskets not found: {e}\")\n     \n         with mp.Pool(processes=num_cpus) as p:\n             all_features_gen = p.imap(\n                 self._multiproc_featurize,\n                 self.baskets,\n                 chunksize=self.multiprocessing_chunk_size,\n             )\n     \n             for basket_features, basket in tqdm(\n                 zip(all_features_gen, self.baskets), total=len(self.baskets)\n             ):\n                 for f, s in zip(basket_features, basket.samples):\n                     # Samples don't have labels during Inference mode\n                     if \"label\" in s.clear_text:\n                         label = s.clear_text[\"label\"]\n >                       scaled_label = (label - self.label_list[0]) / self.label_list[1]\n E                       TypeError: unsupported operand type(s) for -: 'str' and 'float'\n \n ../farm/data_handler/processor.py:908: TypeError\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "tholor", "commentT": "2019-08-29T11:54:32Z", "comment_text": "\n \t\tThe bug should be solved by <denchmark-link:https://github.com/deepset-ai/FARM/pull/74>#74</denchmark-link>\n \n Somehow the tests were passing when farm was still at 0.1.2, I should have tested again after rebasing.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "tholor", "commentT": "2019-08-30T06:56:30Z", "comment_text": "\n \t\tMerged & Fixed by <denchmark-link:https://github.com/deepset-ai/FARM/pull/74>#74</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "a5bfc315556151186d7fdb41a9ed7e14e0038a14", "commit_author": "Xin", "commitT": "2019-08-30 08:55:47+02:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "examples\\doc_regression.py", "file_new_name": "examples\\doc_regression.py", "file_complexity": {"file_NLOC": "69", "file_CCN": "0", "file_NToken": "386"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "88", "deleted_lines": "88"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "farm\\data_handler\\processor.py", "file_new_name": "farm\\data_handler\\processor.py", "file_complexity": {"file_NLOC": "720", "file_CCN": "85", "file_NToken": "4096"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "941,942,943", "deleted_lines": null, "method_info": {"method_name": "_dict_to_samples", "method_params": "cls,dict,kwargs", "method_startline": "938", "method_endline": "944", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "67", "method_nesting_level": "1"}}}}}}}}