{"BR": {"BR_id": "148", "BR_author": "johann-petrak", "BRopenT": "2019-11-14T14:27:39Z", "BRcloseT": "2019-11-14T18:23:24Z", "BR_text": {"BRsummary": "example doc_classification_multilable throws exception \"TypeError: cannot perform reduce with flexible type\"", "BRdescription": "\n Just run the example file doc_classification_multilable.py unchanged and after a while during training (at about 10% of epoch 1) when evaluating the following exception is thrown:\n <denchmark-code>TypeError: cannot perform reduce with flexible type\n </denchmark-code>\n \n FARM (almost latest) master commit <denchmark-link:https://github.com/deepset-ai/FARM/commit/41644de7a0b8331b6d1ba1aeca9c77431509b4dc>41644de</denchmark-link>\n \n transformers version: 2.1.1\n numpy version: 1.17.2\n Here is the complete stack trace:\n <denchmark-code>${PYTHONENVHOME}/lib/python3.6/site-packages/numpy/lib/arraysetops.py:564: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n   mask &= (ar1 != a)\n Traceback (most recent call last):\n   File \"doc_classification_multilabel.py\", line 97, in <module>\n     model = trainer.train(model)\n   File \"${PYTHONENVHOME}/lib/python3.6/site-packages/farm-0.3.1-py3.6.egg/farm/train.py\", line 163, in train\n   File \"${PYTHONENVHOME}/lib/python3.6/site-packages/farm-0.3.1-py3.6.egg/farm/eval.py\", line 138, in eval\n   File \"${PYTHONENVHOME}/lib/python3.6/site-packages/sklearn/metrics/classification.py\", line 1886, in classification_report\n     sample_weight=sample_weight)\n   File \"${PYTHONENVHOME}/lib/python3.6/site-packages/sklearn/metrics/classification.py\", line 1421, in precision_recall_fscore_support\n     labels=labels, samplewise=samplewise)\n   File \"${PYTHONENVHOME}/lib/python3.6/site-packages/sklearn/metrics/classification.py\", line 457, in multilabel_confusion_matrix\n     if np.max(labels) > np.max(present_labels):\n   File \"<__array_function__ internals>\", line 6, in amax\n   File \"${PYTHONENVHOME}/lib/python3.6/site-packages/numpy/core/fromnumeric.py\", line 2621, in amax\n     keepdims=keepdims, initial=initial, where=where)\n   File \"${PYTHONENVHOME}/lib/python3.6/site-packages/numpy/core/fromnumeric.py\", line 90, in _wrapreduction\n     return ufunc.reduce(obj, axis, dtype, out, **passkwargs)\n TypeError: cannot perform reduce with flexible type\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "johann-petrak", "commentT": "2019-11-14T16:22:14Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/johann-petrak>@johann-petrak</denchmark-link>\n ,\n I was able to reproduce the issue. It seems to be a new issue with the classification_report that is called during evaluation after the first 500 steps. Might be related to the changes introduced by <denchmark-link:https://github.com/deepset-ai/FARM/commit/432ffb136a7c260b883e55c6c134a7e49ddaf53c>432ffb1</denchmark-link>\n  or <denchmark-link:https://github.com/deepset-ai/FARM/commit/f6734cb88cb29a872cbe6dcc2ba7cbf81855cd50>f6734cb</denchmark-link>\n . I will investigate this.\n \t\t"}}}, "commit": {"commit_id": "b7b87e194318a06e14a3631aecdf9bb5d663d134", "commit_author": "Malte Pietsch", "commitT": "2019-11-14 19:23:23+01:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "farm\\eval.py", "file_new_name": "farm\\eval.py", "file_complexity": {"file_NLOC": "119", "file_CCN": "28", "file_NToken": "833"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "133,134,135,136,137,138,139,144", "deleted_lines": "137", "method_info": {"method_name": "eval", "method_params": "self,model", "method_startline": "46", "method_endline": "149", "method_complexity": {"method_NLOC": "68", "method_CCN": "18", "method_NToken": "519", "method_nesting_level": "1"}}}}}}}}