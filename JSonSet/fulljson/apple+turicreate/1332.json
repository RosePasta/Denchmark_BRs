{"BR": {"BR_id": "1332", "BR_author": "nickjong", "BRopenT": "2019-01-17T18:19:12Z", "BRcloseT": "2019-08-09T17:22:42Z", "BR_text": {"BRsummary": "Failures in CoreMLExportTest due to undefined behavior (observed on 10.13)", "BRdescription": "\n For example:\n <denchmark-code>___________________ CoreMLExportTest.test_linear_regression ____________________\n \n self = <turicreate.test.test_coreml_export.CoreMLExportTest testMethod=test_linear_regression>\n \n     def test_linear_regression(self):\n         for code_string in [\"b\"*40, \"nnnn\", \"v\", \"d\", \"A\", \"bnsCvAd\"]:\n             train, test = self.generate_data(\"regression\", 100, code_string)\n             model = tc.linear_regression.create(train, \"target\", validation_set = None)\n             model.evaluate(test)  # Previous regression -- this caused errors.\n >           self._test_coreml_export(model, test, True)\n \n test_coreml_export.py:121: \n _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n test_coreml_export.py:103: in _test_coreml_export\n     self.assertAlmostEqual(coreml_prediction[\"target\"], tc_prediction, delta = 1e-5)\n E   AssertionError: 0.3692980279794391 != 0.5474222893547473 within 1e-05 delta\n </denchmark-code>\n \n Due to discussion offline, this could be due to how we export dictionary features?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "nickjong", "commentT": "2019-02-22T00:08:09Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/hoytak>@hoytak</denchmark-link>\n  As discussed in triage today, please put up a PR ASAP to skip these tests in master (but keep this bug open and resolve it when the fixes are actually in). It's more important to keep test results in master green in the meantime. (I would do this initial PR to skip the tests, but I'm not sure which tests are affected and on which OSes they need to skip.)\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "nickjong", "commentT": "2019-06-26T21:37:16Z", "comment_text": "\n \t\tWe should reenable these tests and reinvestigate -- it's quite possible these have been fixed.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "nickjong", "commentT": "2019-07-29T22:32:29Z", "comment_text": "\n \t\tThis can't be a P1, since we've had this bug for half a year, and we're no longer failing our own tests....\n I did re-enable these tests, and they still fail. Which makes sense, since no fix on the CoreML side recently would affect test results on 10.13.\n Ultimately, if we cannot safely export these models in a way that will work deterministically in CoreML in macOS 10.13 / iOS 11, we should document the dependency on a newer CoreML.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "nickjong", "commentT": "2019-07-29T22:33:31Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/hoytak>@hoytak</denchmark-link>\n  Not sure anyone else has the necessary context; what precisely is the dependency on CoreML? In what cases should users expect these exported Core ML models to actually work?\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "nickjong", "commentT": "2019-07-30T00:16:06Z", "comment_text": "\n \t\tIf we can't get the exported models to work on 10.13, we should update their model spec version so they are limited to newer macOS releases (this will give a better user experience than just a documentation fix, as the exported model will complain in Xcode when targeting earlier macOS/iOS versions).\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "nickjong", "commentT": "2019-08-06T20:09:20Z", "comment_text": "\n \t\tI've been working with Guihao on this one; the issue is with columns that have dictionary features and those with categorical lists.  The way these are unpacked in old versions of CoreML means they are unpacked into uninitialized memory.  He's verified all the tests pass now; is checking today I believe on 10.13.\n @Jarvi-Izana -- is that a correct summary of the status?\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "nickjong", "commentT": "2019-08-07T18:25:39Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/hoytak>@hoytak</denchmark-link>\n  sorry for the late reply. I just finished running the pipeline with relevant  removed and it failed on mac_10_13 environment with python27.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "nickjong", "commentT": "2019-08-07T22:24:34Z", "comment_text": "\n \t\tOk, I tried internal pipeline with a macOS10.13 instance and it failed on python3 as well.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "nickjong", "commentT": "2019-08-08T16:23:36Z", "comment_text": "\n \t\tno code change is needed. We should keep triaging it.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "nickjong", "commentT": "2019-08-09T17:31:19Z", "comment_text": "\n \t\tWe are not going to fix it due to the undefined behavior of CoreML prior to macOS version 10.14. These tests will be still marked as failure for versions prior to version 10.14.\n \t\t"}}}, "commit": {"commit_id": "fedaace1c696528a6cbb0afb50059b6757db8380", "commit_author": "Zach Nation", "commitT": "2019-03-01 14:59:56-08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "src\\unity\\python\\turicreate\\test\\test_coreml_export.py", "file_new_name": "src\\unity\\python\\turicreate\\test\\test_coreml_export.py", "file_complexity": {"file_NLOC": "269", "file_CCN": "80", "file_NToken": "2796"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "117,118", "deleted_lines": null, "method_info": {"method_name": "test_linear_regression", "method_params": "self", "method_startline": "116", "method_endline": "123", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "87", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "320,321", "deleted_lines": null, "method_info": {"method_name": "test_logistic_multiclass_tiny", "method_params": "self", "method_startline": "319", "method_endline": "326", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "87", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "181,182", "deleted_lines": null, "method_info": {"method_name": "test_logistic_classifier", "method_params": "self", "method_startline": "180", "method_endline": "187", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "87", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "253,254", "deleted_lines": null, "method_info": {"method_name": "test_logistic_multiclass", "method_params": "self", "method_startline": "252", "method_endline": "259", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "91", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "190,191", "deleted_lines": null, "method_info": {"method_name": "test_svm_classifier", "method_params": "self", "method_startline": "189", "method_endline": "196", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "91", "method_nesting_level": "1"}}}}}}}}