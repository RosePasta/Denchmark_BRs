{"BR": {"BR_id": "969", "BR_author": "igiloh", "BRopenT": "2018-08-14T15:17:03Z", "BRcloseT": "2018-08-21T22:06:10Z", "BR_text": {"BRsummary": "Activity classifier should support test dataset with fewer unique labels than the training set", "BRdescription": "\n As described in <denchmark-link:https://github.com/apple/turicreate/issues/964>#964</denchmark-link>\n  - the user has introduced larger number of labels in the test set than the number of labels the model have been trained on.\n Instead of giving him an explicit error right during the  portion of  - he got a less intuitive error:\n <denchmark-code>ToolkitError: Size of prediction probability vector(3) != number of classes(1)\n </denchmark-code>\n \n We should probably detect these cases explicitly, right in the beginning of predict(), and give an informative error.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "igiloh", "commentT": "2018-08-17T16:12:41Z", "comment_text": "\n \t\tActually, it looks like the opposite: the model was trained with three possible labels (hence the model outputting a prediction vector of size 3), but the dataset being evaluated only has 1 class. This should not generate an error at all and should just work.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "igiloh", "commentT": "2018-08-17T16:14:20Z", "comment_text": "\n \t\tUltimately this is due to these Python-based toolkits not inheriting all of the better-tested code paths from the C++ supervised-learning base classes.... It's possible that just printing a better error message is the correct fix in the short term, with the long-term fix to replace all of the Python code and move to C++.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "igiloh", "commentT": "2018-08-18T00:00:21Z", "comment_text": "\n \t\tIt turns out that this problem is not specific to the activity classifier: it's arguably an API bug in the evaluation toolkit. I filed <denchmark-link:https://github.com/apple/turicreate/issues/1007>#1007</denchmark-link>\n . For the purposes of the evaluate() method here, we can work around this issue by providing the class index map explicitly, instead of allowing the evaluation toolkit to infer it from the test-set labels.\n \t\t"}}}, "commit": {"commit_id": "563aa72b4edbb65420ae6736f335904e7af10b77", "commit_author": "Nick Jong", "commitT": "2018-08-21 15:06:09-07:00", "commit_complexity": {"commit_NLOC": "0.2184873949579832", "commit_CCN": "0.9915966386554622", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\unity\\python\\turicreate\\test\\test_activity_classifier.py", "file_new_name": "src\\unity\\python\\turicreate\\test\\test_activity_classifier.py", "file_complexity": {"file_NLOC": "307", "file_CCN": "51", "file_NToken": "2726"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358", "deleted_lines": null, "method_info": {"method_name": "test_evaluate_with_incomplete_targets", "method_params": "self", "method_startline": "343", "method_endline": "358", "method_complexity": {"method_NLOC": "7", "method_CCN": "2", "method_NToken": "75", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "src\\unity\\python\\turicreate\\test\\test_evaluation.py", "file_new_name": "src\\unity\\python\\turicreate\\test\\test_evaluation.py", "file_complexity": {"file_NLOC": "872", "file_CCN": "49", "file_NToken": "9939"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "173,174,175,176,177,178,179,180,181,182,183,184,185,186,187", "deleted_lines": null, "method_info": {"method_name": "test_probabilities_with_index_map", "method_params": "self", "method_startline": "173", "method_endline": "187", "method_complexity": {"method_NLOC": "10", "method_CCN": "2", "method_NToken": "169", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "1174,1175,1176,1177,1178,1179,1180,1181,1182,1183,1184,1185,1186,1187,1188,1189,1190,1191,1192,1193,1194,1195,1196,1197,1198,1199,1200,1201,1202,1203,1204,1205,1206,1207,1208,1209,1210,1211,1212,1213,1214,1215,1216,1217,1218,1219,1220,1221,1222,1223,1224", "deleted_lines": null, "method_info": {"method_name": "test_bogus_input_prob_evaluators", "method_params": "self", "method_startline": "1116", "method_endline": "1224", "method_complexity": {"method_NLOC": "91", "method_CCN": "3", "method_NToken": "883", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "130,131,132,133,134,135,136,137,138,139,140,141,142", "deleted_lines": null, "method_info": {"method_name": "test_log_loss", "method_params": "self", "method_startline": "55", "method_endline": "142", "method_complexity": {"method_NLOC": "59", "method_CCN": "4", "method_NToken": "956", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\unity\\python\\turicreate\\toolkits\\activity_classifier\\_activity_classifier.py", "file_new_name": "src\\unity\\python\\turicreate\\toolkits\\activity_classifier\\_activity_classifier.py", "file_complexity": {"file_NLOC": "449", "file_CCN": "46", "file_NToken": "3738"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "726,734,738", "deleted_lines": "726,734,738", "method_info": {"method_name": "evaluate", "method_params": "self,dataset,metric", "method_startline": "663", "method_endline": "740", "method_complexity": {"method_NLOC": "29", "method_CCN": "10", "method_NToken": "292", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 7, "file_old_name": "src\\unity\\python\\turicreate\\toolkits\\evaluation.py", "file_new_name": "src\\unity\\python\\turicreate\\toolkits\\evaluation.py", "file_complexity": {"file_NLOC": "1221", "file_CCN": "31", "file_NToken": "934"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1137,1138,1141,1142,1143,1147,1171,1172,1173,1174,1175,1176", "deleted_lines": "1095", "method_info": {"method_name": "auc", "method_params": "targets,predictions,average", "method_startline": "1095", "method_endline": "1203", "method_complexity": {"method_NLOC": "109", "method_CCN": "1", "method_NToken": "73", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "72,73,74,75,76,77,78,79,80,81,82", "deleted_lines": "72", "method_info": {"method_name": "_check_index_map", "method_params": "index_map", "method_startline": "72", "method_endline": "82", "method_complexity": {"method_NLOC": "9", "method_CCN": "5", "method_NToken": "64", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "1147,1171,1172,1173,1174,1175,1176,1258,1259,1262,1263,1264", "deleted_lines": null, "method_info": {"method_name": "auc", "method_params": "targets,predictions,average,index_map", "method_startline": "1147", "method_endline": "1266", "method_complexity": {"method_NLOC": "118", "method_CCN": "2", "method_NToken": "93", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "84,123,124,125,126,127,128,144,145,151,152,210,211,212,213,214,215,216,217,218,219,220,221,222,228,229,232,233,234,235,238,241", "deleted_lines": "126,132,199,202", "method_info": {"method_name": "log_loss", "method_params": "targets,predictions,index_map", "method_startline": "84", "method_endline": "242", "method_complexity": {"method_NLOC": "155", "method_CCN": "3", "method_NToken": "98", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "72,73,74,75,76,77,78,79,80,81,82,83,84,123,124,125,126,127,128,144,145,151,152", "deleted_lines": "72,126,132,199,202", "method_info": {"method_name": "log_loss", "method_params": "targets,predictions", "method_startline": "72", "method_endline": "203", "method_complexity": {"method_NLOC": "130", "method_CCN": "2", "method_NToken": "76", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "954,979,980,981,982,983,984,1014,1015,1021,1022", "deleted_lines": "915,969,975", "method_info": {"method_name": "roc_curve", "method_params": "targets,predictions,average", "method_startline": "915", "method_endline": "1093", "method_complexity": {"method_NLOC": "179", "method_CCN": "1", "method_NToken": "71", "method_nesting_level": "0"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "954,979,980,981,982,983,984,1014,1015,1021,1022,1137,1138,1141,1142,1143", "deleted_lines": "969,975,1095", "method_info": {"method_name": "roc_curve", "method_params": "targets,predictions,average,index_map", "method_startline": "954", "method_endline": "1145", "method_complexity": {"method_NLOC": "190", "method_CCN": "2", "method_NToken": "91", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\unity\\toolkits\\evaluation\\metrics.cpp", "file_new_name": "src\\unity\\toolkits\\evaluation\\metrics.cpp", "file_complexity": {"file_NLOC": "207", "file_CCN": "30", "file_NToken": "1678"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "88,89,90", "deleted_lines": "88,89", "method_info": {"method_name": "turi::evaluation::_supervised_streaming_evaluator", "method_params": "unity_targets,unity_predictions,metric,kwargs", "method_startline": "69", "method_endline": "121", "method_complexity": {"method_NLOC": "43", "method_CCN": "9", "method_NToken": "344", "method_nesting_level": "2"}}}}}}}}