{"BR": {"BR_id": "1253", "BR_author": "MarkusShepherd", "BRopenT": "2018-12-12T09:57:22Z", "BRcloseT": "2019-01-10T00:22:01Z", "BR_text": {"BRsummary": "SFrame.read_json() treats boolean values as strings", "BRdescription": "\n It appears that SFrame.read_json() really just is a thin wrapper around SFrame.read_csv() with some parsing logic which cannot handle all cases. In particular, it does not parse boolean values in JSON correctly and instead treats them as strings. E.g.,\n <denchmark-code>In [1]: cat test.jl\n {\"a\": true}\n {\"a\": false}\n {\"a\": null}\n {\"a\": false}\n In [2]: import turicreate\n In [3]: turicreate.SFrame.read_json('test.jl', orient='lines')\n Out[3]: \n Columns:\n \ta\tstr\n Rows: 4\n Data:\n +-------+\n |   a   |\n +-------+\n |  true |\n | false |\n |  null |\n | false |\n +-------+\n [4 rows x 1 columns]\n </denchmark-code>\n \n It's the same for records orientation:\n <denchmark-code>In [4]: cat test.json\n [{\"a\": true},\n {\"a\": false},\n {\"a\": null},\n {\"a\": false}]\n In [5]: turicreate.SFrame.read_json('test.json', orient='records')\n Out[5]: \n Columns:\n \ta\tstr\n Rows: 4\n Data:\n +-------+\n |   a   |\n +-------+\n |  true |\n | false |\n |  null |\n | false |\n +-------+\n [4 rows x 1 columns]\n </denchmark-code>\n \n Expected result is this:\n <denchmark-code>In [6]: turicreate.SFrame({'a': [True, False, None, False]})\n Out[6]: \n Columns:\n \ta\tint\n Rows: 4\n Data:\n +------+\n |  a   |\n +------+\n |  1   |\n |  0   |\n | None |\n |  0   |\n +------+\n [4 rows x 1 columns]\n </denchmark-code>\n \n Tested on Turicreate v5.1, Python v3.6.6, macOS v10.14.2\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "MarkusShepherd", "commentT": "2018-12-12T10:10:47Z", "comment_text": "\n \t\tI think one easy way to treat JSON Lines files correctly is this:\n import json, turicreate\n turicreate.SFrame.read_csv('test.jl', header=False, column_type_hints=str)['X1'] \\\n     .apply(json.loads) \\\n     .unpack(column_name_prefix=None)\n I'll use this workaround for the time being.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "MarkusShepherd", "commentT": "2018-12-12T21:58:20Z", "comment_text": "\n \t\tThanks for the issue <denchmark-link:https://github.com/MarkusShepherd>@MarkusShepherd</denchmark-link>\n .\n Turi Create doesn't even have a boolean column type. So that's probably the more fundamental issue here. Boolean column types is a feature I've wanted for a very long time.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "MarkusShepherd", "commentT": "2018-12-13T01:28:31Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/TobyRoseman>@TobyRoseman</denchmark-link>\n  Should true/false be parsed as 0/1 (ints) rather than \"true\"/\"false\" (strings)? If so, then I'd call this a bug rather than a feature request (with Boolean values in SFrame as a separate feature request).\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "MarkusShepherd", "commentT": "2018-12-13T01:42:19Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/znation>@znation</denchmark-link>\n  - I agree, in the absence of having a boolean type, \"true\"/\"false\" JSON values should be parsed as 0/1. Looks like we're already tracking the boolean feature request in <denchmark-link:https://github.com/apple/turicreate/issues/1069>#1069</denchmark-link>\n . So let's limit this issue to correctly parsing \"true\"/\"false\" JSON values.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "MarkusShepherd", "commentT": "2018-12-13T07:10:16Z", "comment_text": "\n \t\tSince bool is a subclass of int in Python, I'd say the lack of explicit boolean columns in TC might not be so bad, unless there is some performance to be gained.\n Also, I've realised SArray reads in files line by line, so my above workaround can be shortened:\n import json, turicreate\n turicreate.SArray('test.jl') \\\n     .apply(json.loads) \\\n     .unpack(column_name_prefix=None)\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "MarkusShepherd", "commentT": "2018-12-20T01:05:38Z", "comment_text": "\n \t\tI have added some parser features in <denchmark-link:https://github.com/apple/turicreate/pull/1266>#1266</denchmark-link>\n  that should help fix this.\n \t\t"}}}, "commit": {"commit_id": "2e1e61c698c35a8b260f1e4916f308d8f16333e9", "commit_author": "Yucheng Low", "commitT": "2019-01-09 16:21:58-08:00", "commit_complexity": {"commit_NLOC": "0.17801047120418848", "commit_CCN": "0.42408376963350786", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "src\\flexible_type\\flexible_type_spirit_parser.cpp", "file_new_name": "src\\flexible_type\\flexible_type_spirit_parser.cpp", "file_complexity": {"file_NLOC": "246", "file_CCN": "23", "file_NToken": "2061"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "204,205,206,207,208,209,211,213", "deleted_lines": null, "method_info": {"method_name": "turi::flexible_type_parser::flexible_type_parser", "method_params": "separator,use_escape_char,escape_char,na_val,true_val,false_val", "method_startline": "204", "method_endline": "215", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "117", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "187,189,191", "method_info": {"method_name": "turi::flexible_type_parser::flexible_type_parser", "method_params": "separator,escape_char", "method_startline": "187", "method_endline": "193", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "68", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "37,38,39,40,41,42,62,65,66,67,75,78,79,80,87,90,91,92", "deleted_lines": "37", "method_info": {"method_name": "turi::flexible_type_parser_impl", "method_params": "delimiter,escape_char", "method_startline": "37", "method_endline": "159", "method_complexity": {"method_NLOC": "72", "method_CCN": "2", "method_NToken": "667", "method_nesting_level": "2"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "37,38,39,40,41,42,62,65,66,67,75,78,79,80,87,90,91,92", "deleted_lines": "37", "method_info": {"method_name": "turi::flexible_type_parser_impl", "method_params": "delimiter,use_escape_char,escape_char,na_val,true_val,false_val", "method_startline": "37", "method_endline": "176", "method_complexity": {"method_NLOC": "89", "method_CCN": "2", "method_NToken": "789", "method_nesting_level": "2"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\flexible_type\\flexible_type_spirit_parser.hpp", "file_new_name": "src\\flexible_type\\flexible_type_spirit_parser.hpp", "file_complexity": {"file_NLOC": "44", "file_CCN": "0", "file_NToken": "329"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "37,38,39,40,41,42", "deleted_lines": "37"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "src\\flexible_type\\string_escape.cpp", "file_new_name": "src\\flexible_type\\string_escape.cpp", "file_complexity": {"file_NLOC": "240", "file_CCN": "77", "file_NToken": "1529"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "286,289,290", "deleted_lines": "286,289", "method_info": {"method_name": "turi::unescape_string", "method_params": "cal,escape_char,quote_char,double_quote", "method_startline": "286", "method_endline": "291", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "52", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "174,175,183", "deleted_lines": "174,175,183", "method_info": {"method_name": "turi::unescape_string", "method_params": "cal,length,use_escape_char,escape_char,quote_char,double_quote", "method_startline": "174", "method_endline": "283", "method_complexity": {"method_NLOC": "93", "method_CCN": "30", "method_NToken": "478", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "174,175,183", "deleted_lines": "174,175,183", "method_info": {"method_name": "turi::unescape_string", "method_params": "cal,length,escape_char,quote_char,double_quote", "method_startline": "174", "method_endline": "283", "method_complexity": {"method_NLOC": "93", "method_CCN": "29", "method_NToken": "471", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "286,289,290", "deleted_lines": "286,289", "method_info": {"method_name": "turi::unescape_string", "method_params": "cal,use_escape_char,escape_char,quote_char,double_quote", "method_startline": "286", "method_endline": "292", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "57", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\flexible_type\\string_escape.hpp", "file_new_name": "src\\flexible_type\\string_escape.hpp", "file_complexity": {"file_NLOC": "16", "file_CCN": "0", "file_NToken": "87"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "14,21", "deleted_lines": "14,21"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\flexible_type\\string_parser.hpp", "file_new_name": "src\\flexible_type\\string_parser.hpp", "file_complexity": {"file_NLOC": "179", "file_CCN": "43", "file_NToken": "1077"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "248,249,250,251,252,253,254,255,256", "deleted_lines": "232,233,235", "method_info": {"method_name": "parser_impl::string_parser::parse", "method_params": "first,last,skipper,attr", "method_startline": "161", "method_endline": "261", "method_complexity": {"method_NLOC": "74", "method_CCN": "26", "method_NToken": "439", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "129,130,131,132,133,134,135,136,137", "deleted_lines": null, "method_info": {"method_name": "parser_impl::string_parser::string_parser", "method_params": "config", "method_startline": "125", "method_endline": "138", "method_complexity": {"method_NLOC": "14", "method_CCN": "5", "method_NToken": "112", "method_nesting_level": "2"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "src\\logger\\logger.cpp", "file_new_name": "src\\logger\\logger.cpp", "file_complexity": {"file_NLOC": "220", "file_CCN": "52", "file_NToken": "1471"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "221,224,227,230,233", "deleted_lines": "222,225,228,231,234", "method_info": {"method_name": "file_logger::_lograw", "method_params": "lineloglevel,buf,len", "method_startline": "208", "method_endline": "251", "method_complexity": {"method_NLOC": "37", "method_CCN": "19", "method_NToken": "245", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "106,107,108,109,110,111,112", "deleted_lines": null, "method_info": {"method_name": "reset_color", "method_params": "", "method_startline": "106", "method_endline": "112", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "23", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "89,90,91,92,93,94,95", "deleted_lines": "89,90,91,92,93,94,95", "method_info": {"method_name": "textcolor", "method_params": "attr,fg", "method_startline": "89", "method_endline": "95", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "34", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\logger\\logger.hpp", "file_new_name": "src\\logger\\logger.hpp", "file_complexity": {"file_NLOC": "195", "file_CCN": "33", "file_NToken": "1239"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "692,693,694,695,696,697,698,699,700,701,702,703,704,705,706,707,708,709,711,713", "deleted_lines": null}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "src\\sframe\\csv_line_tokenizer.cpp", "file_new_name": "src\\sframe\\csv_line_tokenizer.cpp", "file_complexity": {"file_NLOC": "495", "file_CCN": "149", "file_NToken": "3461"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "107,108,121,122,123,124,125,129,130,165,167,168,169,170,171,172,173,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252", "deleted_lines": "117,156,235", "method_info": {"method_name": "turi::csv_line_tokenizer::tokenize_line", "method_params": "str,len,output,permit_undefined,output_order", "method_startline": "100", "method_endline": "255", "method_complexity": {"method_NLOC": "128", "method_CCN": "35", "method_NToken": "943", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "462,601,602,603,604,608,614", "deleted_lines": "529,546", "method_info": {"method_name": "turi::csv_line_tokenizer::tokenize_line_impl", "method_params": "str,len,add_token,lookahead,canceltoken", "method_startline": "445", "method_endline": "620", "method_complexity": {"method_NLOC": "129", "method_CCN": "37", "method_NToken": "670", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,306,342", "deleted_lines": "271,340", "method_info": {"method_name": "turi::csv_line_tokenizer::parse_as", "method_params": "buf,len,out,recursive_parse", "method_startline": "258", "method_endline": "401", "method_complexity": {"method_NLOC": "118", "method_CCN": "51", "method_NToken": "1027", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "75", "deleted_lines": "73", "method_info": {"method_name": "turi::csv_line_tokenizer::tokenize_line", "method_params": "str,len,output", "method_startline": "57", "method_endline": "98", "method_complexity": {"method_NLOC": "39", "method_CCN": "9", "method_NToken": "287", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "622,623,624", "deleted_lines": null, "method_info": {"method_name": "turi::csv_line_tokenizer::get_last_parse_error_diagnosis", "method_params": "", "method_startline": "622", "method_endline": "624", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "11", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "627,628,629", "deleted_lines": null, "method_info": {"method_name": "turi::csv_line_tokenizer::init", "method_params": "", "method_startline": "626", "method_endline": "653", "method_complexity": {"method_NLOC": "26", "method_CCN": "6", "method_NToken": "171", "method_nesting_level": "1"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\sframe\\csv_line_tokenizer.hpp", "file_new_name": "src\\sframe\\csv_line_tokenizer.hpp", "file_complexity": {"file_NLOC": "85", "file_CCN": "3", "file_NToken": "552"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "359", "deleted_lines": null, "method_info": {"method_name": "std::operator < <", "method_params": "os,t", "method_startline": "356", "method_endline": "379", "method_complexity": {"method_NLOC": "22", "method_CCN": "3", "method_NToken": "196", "method_nesting_level": "1"}}}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\sframe\\parallel_csv_parser.cpp", "file_new_name": "src\\sframe\\parallel_csv_parser.cpp", "file_complexity": {"file_NLOC": "860", "file_CCN": "216", "file_NToken": "5978"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "549,550,551,552,553,554,555,556,557,561,562,563,564,565,566,568", "deleted_lines": "543,544,545,546,551,552", "method_info": {"method_name": "turi::parallel_csv_parser::parse_line", "method_params": "pstart,pnext,threadid", "method_startline": "513", "method_endline": "572", "method_complexity": {"method_NLOC": "52", "method_CCN": "15", "method_NToken": "460", "method_nesting_level": "3"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "500,501,502,503,504,505,506,507", "deleted_lines": "500,501", "method_info": {"method_name": "turi::parallel_csv_parser::advance_past_newline_with_quote_parity", "method_params": "bufstart,c,cend,newline_was_matched", "method_startline": "494", "method_endline": "510", "method_complexity": {"method_NLOC": "15", "method_CCN": "4", "method_NToken": "80", "method_nesting_level": "3"}}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\unity\\lib\\unity_sarray.cpp", "file_new_name": "src\\unity\\lib\\unity_sarray.cpp", "file_complexity": {"file_NLOC": "2308", "file_CCN": "552", "file_NToken": "17273"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "223", "deleted_lines": "223", "method_info": {"method_name": "turi::unity_sarray::construct_from_json_record_files", "method_params": "url", "method_startline": "216", "method_endline": "308", "method_complexity": {"method_NLOC": "75", "method_CCN": "15", "method_NToken": "564", "method_nesting_level": "1"}}}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\unity\\lib\\unity_sframe.cpp", "file_new_name": "src\\unity\\lib\\unity_sframe.cpp", "file_complexity": {"file_NLOC": "1659", "file_CCN": "323", "file_NToken": "12763"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "167,201,202,203,242,243,244,245,246,247,248,249,250,251,253,254,255,256,257,258,259,260,261,262", "deleted_lines": null, "method_info": {"method_name": "turi::unity_sframe::construct_from_csvs", "method_params": "url,csv_parsing_config,column_type_hints", "method_startline": "142", "method_endline": "287", "method_complexity": {"method_NLOC": "137", "method_CCN": "33", "method_NToken": "1148", "method_nesting_level": "1"}}}}}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\unity\\python\\turicreate\\cython\\cy_test_utils.pyx", "file_new_name": "src\\unity\\python\\turicreate\\cython\\cy_test_utils.pyx", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "19,20,21,22,23,24,25", "deleted_lines": null}}}, "file_13": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "src\\unity\\python\\turicreate\\data_structures\\sframe.py", "file_new_name": "src\\unity\\python\\turicreate\\data_structures\\sframe.py", "file_complexity": {"file_NLOC": "2262", "file_CCN": "481", "file_NToken": "12851"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "885,886", "deleted_lines": null, "method_info": {"method_name": "_read_csv_impl", "method_params": "cls,url,delimiter,header,error_bad_lines,comment_char,escape_char,double_quote,quote_char,skip_initial_space,column_type_hints,na_values,line_terminator,usecols,nrows,skiprows,verbose,store_errors,nrows_to_infer,true_values,false_values,kwargs", "method_startline": "866", "method_endline": "887", "method_complexity": {"method_NLOC": "22", "method_CCN": "1", "method_NToken": "91", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "1242,1243", "deleted_lines": null, "method_info": {"method_name": "read_csv", "method_params": "cls,url,delimiter,header,error_bad_lines,comment_char,escape_char,double_quote,quote_char,skip_initial_space,column_type_hints,na_values,line_terminator,usecols,nrows,skiprows,verbose,nrows_to_infer,true_values,false_values,kwargs", "method_startline": "1224", "method_endline": "1244", "method_complexity": {"method_NLOC": "21", "method_CCN": "1", "method_NToken": "87", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "1079,1080", "deleted_lines": null, "method_info": {"method_name": "read_csv_with_errors", "method_params": "cls,url,delimiter,header,comment_char,escape_char,double_quote,quote_char,skip_initial_space,column_type_hints,na_values,line_terminator,usecols,nrows,skiprows,verbose,nrows_to_infer,true_values,false_values,kwargs", "method_startline": "1062", "method_endline": "1081", "method_complexity": {"method_NLOC": "20", "method_CCN": "1", "method_NToken": "83", "method_nesting_level": "1"}}}}}, "file_14": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "test\\capi\\capi_sframe_csv.cxx", "file_new_name": "test\\capi\\capi_sframe_csv.cxx", "file_complexity": {"file_NLOC": "840", "file_CCN": "96", "file_NToken": "8635"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "890,894,898,902,906,910,912", "deleted_lines": "890,894,898,902,906,910", "method_info": {"method_name": "sframe_test::test_string_escaping", "method_params": "", "method_startline": "888", "method_endline": "912", "method_complexity": {"method_NLOC": "20", "method_CCN": "1", "method_NToken": "152", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "915,916,917,918,919,920,921,922,923,924,925,926,927,928,929,930,932,933,934,935,936,937,938", "deleted_lines": null, "method_info": {"method_name": "sframe_test::test_string_escaping2", "method_params": "", "method_startline": "915", "method_endline": "939", "method_complexity": {"method_NLOC": "20", "method_CCN": "1", "method_NToken": "152", "method_nesting_level": "1"}}}}}, "file_15": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "test\\sframe\\sframe_csv_test.cxx", "file_new_name": "test\\sframe\\sframe_csv_test.cxx", "file_complexity": {"file_NLOC": "782", "file_CCN": "86", "file_NToken": "7878"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "798,802,806,810,814,818,821,822,823", "deleted_lines": "798,802,806,810,814,818", "method_info": {"method_name": "sframe_test::test_string_escaping", "method_params": "", "method_startline": "796", "method_endline": "824", "method_complexity": {"method_NLOC": "23", "method_CCN": "1", "method_NToken": "176", "method_nesting_level": "1"}}}}}}}}