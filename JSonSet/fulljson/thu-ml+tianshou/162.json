{"BR": {"BR_id": "162", "BR_author": "HOLMEScdk", "BRopenT": "2020-07-24T00:57:58Z", "BRcloseT": "2020-07-24T09:38:36Z", "BR_text": {"BRsummary": "Potential Bug", "BRdescription": "\n \n  I have marked all applicable categories:\n \n [\u221a ] exception-raising bug\n  RL algorithm bug\n  documentation request (i.e. \"X is missing from the documentation.\")\n  new feature request\n \n \n [ \u221a] I have visited the source website\n [ \u221a] I have searched through the issue tracker for duplicates\n [ \u221a] I have mentioned version numbers, operating system and environment, where applicable:\n import tianshou, torch, sys\n print(tianshou.__version__, torch.__version__, sys.version, sys.platform)\n # 0.2.4 1.4.0 3.7.6 | packaged by conda-forge | (default, Jun  1 2020, 18:57:50) [GCC 7.5.0] linux\n \n \n Hi, first thanks for the excellent work!\n One thing I found may has potential bug.\n When I was using a2c policy, I found that you calculate <denchmark-link:https://github.com/thu-ml/tianshou/blob/dev/tianshou/policy/modelfree/a2c.py#L111>a_loss</denchmark-link>\n  in this way, which may not work if the action has multiple dimension, say if the shape of output of dist.log_prob(a) is [bsz, n] while the shape of (r-v) is [bsz, 1] or [bsz] and neither of them can do dot product with the dis.log_prob(a). In my opinion, it would be better to use dist.log_prob(a).transpose(0,1) so that it will do multiplication among the same dimension.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "HOLMEScdk", "commentT": "2020-07-24T01:07:24Z", "comment_text": "\n \t\tOkay, I'll fix it. Thanks!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "HOLMEScdk", "commentT": "2020-07-24T02:38:48Z", "comment_text": "\n \t\tI add here:\n <denchmark-link:https://github.com/thu-ml/tianshou/pull/160/files#diff-364c9ccfa05c83a52833a4b819e57dd3R111-R113>https://github.com/thu-ml/tianshou/pull/160/files#diff-364c9ccfa05c83a52833a4b819e57dd3R111-R113</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "HOLMEScdk", "commentT": "2020-07-24T09:38:36Z", "comment_text": "\n \t\tfixed in <denchmark-link:https://github.com/thu-ml/tianshou/pull/160>#160</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "38a95c19daed219fc53e577b9a1b3ac9b0df968e", "commit_author": "n+e", "commitT": "2020-07-24 17:38:12+08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.5", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\tutorials\\cheatsheet.rst", "file_new_name": "docs\\tutorials\\cheatsheet.rst", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "51,52,53,54,55,56,57,58,59,60,61", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\tutorials\\dqn.rst", "file_new_name": "docs\\tutorials\\dqn.rst", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "43,44,45,46,47,48,49,50,51,52,53", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "test\\base\\env.py", "file_new_name": "test\\base\\env.py", "file_complexity": {"file_NLOC": "53", "file_CCN": "15", "file_NToken": "417"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "11,12", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,size,sleep,dict_state,ma_rew,multidiscrete_action", "method_startline": "11", "method_endline": "12", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "23", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "46,47", "deleted_lines": null, "method_info": {"method_name": "step", "method_params": "self,action", "method_startline": "45", "method_endline": "63", "method_complexity": {"method_NLOC": "19", "method_CCN": "8", "method_NToken": "177", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "42,43", "deleted_lines": null, "method_info": {"method_name": "_get_dict_state", "method_params": "self", "method_startline": "40", "method_endline": "43", "method_complexity": {"method_NLOC": "3", "method_CCN": "2", "method_NToken": "33", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "11,12", "deleted_lines": "10,15", "method_info": {"method_name": "__init__", "method_params": "self,size,sleep,dict_state,ma_rew", "method_startline": "10", "method_endline": "16", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "52", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "25,26", "deleted_lines": null, "method_info": {"method_name": "seed", "method_params": "self,seed", "method_startline": "25", "method_endline": "26", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "17", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "test\\base\\test_batch.py", "file_new_name": "test\\base\\test_batch.py", "file_complexity": {"file_NLOC": "434", "file_CCN": "22", "file_NToken": "6104"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "2", "deleted_lines": "1"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "test\\base\\test_collector.py", "file_new_name": "test\\base\\test_collector.py", "file_complexity": {"file_NLOC": "158", "file_CCN": "24", "file_NToken": "2120"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "116,117,118,121", "deleted_lines": null, "method_info": {"method_name": "test_collector_with_dict_state", "method_params": "", "method_startline": "106", "method_endline": "135", "method_complexity": {"method_NLOC": "30", "method_CCN": "2", "method_NToken": "432", "method_nesting_level": "0"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "test\\discrete\\test_pg.py", "file_new_name": "test\\discrete\\test_pg.py", "file_complexity": {"file_NLOC": "143", "file_CCN": "17", "file_NToken": "1519"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "89", "deleted_lines": "89", "method_info": {"method_name": "get_args", "method_params": "", "method_startline": "84", "method_endline": "106", "method_complexity": {"method_NLOC": "23", "method_CCN": "2", "method_NToken": "276", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tianshou\\env\\basevecenv.py", "file_new_name": "tianshou\\env\\basevecenv.py", "file_complexity": {"file_NLOC": "107", "file_CCN": "10", "file_NToken": "275"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "30,31,32,33,34,35,36,37,38,39,40", "deleted_lines": null}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tianshou\\policy\\modelfree\\a2c.py", "file_new_name": "tianshou\\policy\\modelfree\\a2c.py", "file_complexity": {"file_NLOC": "126", "file_CCN": "4", "file_NToken": "813"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "111,112,113", "deleted_lines": "111,112"}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tianshou\\policy\\modelfree\\dqn.py", "file_new_name": "tianshou\\policy\\modelfree\\dqn.py", "file_complexity": {"file_NLOC": "159", "file_CCN": "11", "file_NToken": "910"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "160", "deleted_lines": "160", "method_info": {"method_name": "learn", "method_params": "self,Batch,kwargs", "method_startline": "156", "method_endline": "173", "method_complexity": {"method_NLOC": "18", "method_CCN": "4", "method_NToken": "182", "method_nesting_level": "1"}}}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tianshou\\policy\\modelfree\\pg.py", "file_new_name": "tianshou\\policy\\modelfree\\pg.py", "file_complexity": {"file_NLOC": "89", "file_CCN": "4", "file_NToken": "490"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "93,94,95", "deleted_lines": "93"}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tianshou\\policy\\modelfree\\ppo.py", "file_new_name": "tianshou\\policy\\modelfree\\ppo.py", "file_complexity": {"file_NLOC": "178", "file_CCN": "4", "file_NToken": "1287"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "135,150,151", "deleted_lines": "135,150,151"}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tianshou\\utils\\net\\common.py", "file_new_name": "tianshou\\utils\\net\\common.py", "file_complexity": {"file_NLOC": "64", "file_CCN": "6", "file_NToken": "556"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "39", "deleted_lines": "39", "method_info": {"method_name": "forward", "method_params": "self,s,state,info", "method_startline": "36", "method_endline": "41", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "63", "method_nesting_level": "1"}}}}}}}}