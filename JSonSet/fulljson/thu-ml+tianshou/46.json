{"BR": {"BR_id": "46", "BR_author": "zleonhe", "BRopenT": "2020-05-04T02:56:00Z", "BRcloseT": "2020-05-04T04:33:34Z", "BR_text": {"BRsummary": "Error with max_grad_norm in A2C Policy", "BRdescription": "\n \n  I have marked all applicable categories:\n \n  exception-raising bug\n  RL algorithm bug\n  documentation request (i.e. \"X is missing from the documentation.\")\n  new feature request\n \n \n  I have visited the source website, and in particular read the known issues\n  I have searched through the issue categories for duplicates\n  I have mentioned version numbers, operating system and environment, where applicable:\n import tianshou, torch, sys\n print(tianshou.__version__, torch.__version__, sys.version, sys.platform)\n \n \n Versions:\n 0.2.2 1.5.0 3.7.4 (default, Aug 13 2019, 20:35:49)\n [GCC 7.3.0] linux\n A2C policy cannot deal with max_grad_norm correctly. For example:\n <denchmark-code>python test/discrete/test_a2c_with_il.py --max-grad-norm 1\n Epoch #1:   0%|                                                                                                                                                                                                      | 0/1000 [00:00<?, ?it/s]\n Traceback (most recent call last):\n   File \"test/discrete/test_a2c_with_il.py\", line 137, in <module>\n     test_a2c()\n   File \"test/discrete/test_a2c_with_il.py\", line 98, in test_a2c\n     writer=writer)\n   File \"/research/dept6/zlhe/miniconda3/envs/fp/lib/python3.7/site-packages/tianshou/trainer/onpolicy.py\", line 89, in onpolicy_trainer\n     train_collector.sample(0), batch_size, repeat_per_collect)\n   File \"/research/dept6/zlhe/miniconda3/envs/fp/lib/python3.7/site-packages/tianshou/policy/modelfree/a2c.py\", line 101, in learn\n     self.model.parameters(), max_norm=self._grad_norm)\n AttributeError: 'NoneType' object has no attribute 'parameters'\n </denchmark-code>\n \n This is due to the messed up variable names, as the following:\n \n \n \n tianshou/tianshou/policy/modelfree/a2c.py\n \n \n         Lines 104 to 106\n       in\n       134f787\n \n \n \n \n \n \n  if self._grad_norm: \n \n \n \n  nn.utils.clip_grad_norm_( \n \n \n \n  self.model.parameters(), max_norm=self._grad_norm) \n \n \n \n \n \n However there should be self.actor and self.critic instead of self.model, which causes the error.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "zleonhe", "commentT": "2020-05-04T04:33:34Z", "comment_text": "\n \t\tThanks for pointing out! I fixed it.\n \t\t"}}}, "commit": {"commit_id": "04b091d9756b1798e5b783b52c806b51110231bb", "commit_author": "Trinkle23897", "commitT": "2020-05-04 12:33:04+08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tianshou\\policy\\modelfree\\a2c.py", "file_new_name": "tianshou\\policy\\modelfree\\a2c.py", "file_complexity": {"file_NLOC": "98", "file_CCN": "12", "file_NToken": "726"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "106,107,108", "deleted_lines": "106", "method_info": {"method_name": "learn", "method_params": "self,batch,batch_size,repeat,kwargs", "method_startline": "86", "method_endline": "119", "method_complexity": {"method_NLOC": "34", "method_CCN": "6", "method_NToken": "332", "method_nesting_level": "1"}}}}}}}}