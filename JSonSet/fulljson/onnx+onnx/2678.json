{"BR": {"BR_id": "2678", "BR_author": "radikalliberal", "BRopenT": "2020-03-23T19:04:15Z", "BRcloseT": "2020-11-17T06:06:18Z", "BR_text": {"BRsummary": "::google::protobuf::io::CodedInputStream::SetTotalBytesLimit does not take 2 arguments", "BRdescription": "\n Hi,\n I compiled onnxruntime today together with protobuf 3.11.2. and had to change a snippet to make it work.\n When using older versions of protobuf (3.10.0 and less) I got the following error on several lines:\n <denchmark-code> onnx/onnx-ml.pb.h:3700:111: error: only virtual member functions can be marked 'final'\n        ::PROTOBUF_NAMESPACE_ID::uint8* target, ::PROTOBUF_NAMESPACE_ID::io::EpsCopyOutputStream* stream) const final;\n </denchmark-code>\n \n <denchmark-h:h2>Edit: the error was due to mixing different versions of protoc and protobuf sources</denchmark-h>\n \n When using protobuf 3.11.2 the interface of SetTotalBytesLimit is different and only one parmeter can be given:\n <denchmark-code> diff --git a/onnx/proto_utils.h b/onnx/proto_utils.h\n  \n  index ec125fde..3de807ac 100644\n  --- a/onnx/proto_utils.h\n  +++ b/onnx/proto_utils.h\n  @@ -31,7 +31,7 @@ bool ParseProtoFromBytes(Proto* proto, const char* buffer, size_t length) {\n     // respectively.\n     ::google::protobuf::io::ArrayInputStream input_stream(buffer, static_cast<int>(length));\n     ::google::protobuf::io::CodedInputStream coded_stream(&input_stream);\n  -  coded_stream.SetTotalBytesLimit((2048LL << 20) - 1, 512LL << 20);\n  +  coded_stream.SetTotalBytesLimit((2048LL << 20) - 1);\n     return proto->ParseFromCodedStream(&coded_stream);\n   }\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "radikalliberal", "commentT": "2020-03-24T07:33:42Z", "comment_text": "\n \t\tIt's better to move the issue to onnx runtime community - <denchmark-link:https://github.com/microsoft/onnxruntime>http://github.com/microsoft/onnxruntime</denchmark-link>\n .\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "radikalliberal", "commentT": "2020-03-24T15:36:16Z", "comment_text": "\n \t\tThis method uses, at least since protobuf 3.6.1, only the first argument the second one is ignored.\n This code was added in 12/2017\n <denchmark-code>  PROTOBUF_RUNTIME_DEPRECATED(\n       \"Please use the single parameter version of SetTotalBytesLimit(). The \"\n       \"second parameter is ignored.\")\n   void SetTotalBytesLimit(int total_bytes_limit, int) {\n     SetTotalBytesLimit(total_bytes_limit);\n   }\n </denchmark-code>\n \n For protobuf >3.11.x it wont compile.\n it's either compatiblity for pb >=3.6 or <=3.10\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "radikalliberal", "commentT": "2020-03-24T22:20:20Z", "comment_text": "\n \t\tThe problem is: ONNX doesn't work perfectly with protobuf version > 3.11.x.\n ONNX should have a \"#ifdef\" there. If the protobuf version larger than a specific value, then call the function with only one argument.\n Like\n #if GOOGLE_PROTOBUF_VERSION >= 3002000\n     SetTotalBytesLimit(total_bytes_limit);\n #else\n     SetTotalBytesLimit(total_bytes_limit, 102400);\n #endif\n The fix need be happened in ONNX, not onnxruntime.\n \t\t"}}}, "commit": {"commit_id": "d3bc82770474761571f950347560d62a35d519d7", "commit_author": "Chun-Wei Chen", "commitT": "2020-11-16 22:06:17-08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "onnx\\proto_utils.h", "file_new_name": "onnx\\proto_utils.h", "file_complexity": {"file_NLOC": "34", "file_CCN": "7", "file_NToken": "315"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "32,33,34,35,36,37,38,39,40", "deleted_lines": "30,31,34", "method_info": {"method_name": "ONNX_NAMESPACE::ParseProtoFromBytes", "method_params": "proto,buffer,length", "method_startline": "29", "method_endline": "42", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "91", "method_nesting_level": "1"}}}}}}}}