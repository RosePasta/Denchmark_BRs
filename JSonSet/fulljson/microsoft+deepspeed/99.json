{"BR": {"BR_id": "99", "BR_author": "ShadenSmith", "BRopenT": "2020-02-21T23:58:28Z", "BRcloseT": "2020-06-04T22:07:14Z", "BR_text": {"BRsummary": "DeepSpeed using DistributedSampler with model parallelism", "BRdescription": "\n DeepSpeed's data loader will use DistributedSampler by default unless another is provided:\n \n \n \n DeepSpeed/deepspeed/pt/deepspeed_dataloader.py\n \n \n          Line 43\n       in\n       001abe2\n \n \n \n \n \n \n  data_sampler = DistributedSampler(dataset) \n \n \n \n \n \n If DeepSpeed is configured with model parallelism, or called from a library with a sub-group of the world processes, the default behavior of DistributedSampler is incorrect because it queries the global world size and rank information. We should specify num_replicas and rank when creating the sampler.\n If mpu is provided to deepspeed.initialize(), we should query mpu.get_data_parallel_world_size() and mpu.get_data_parallel_rank() and forward that information to the sampler.\n \t"}, "comments": {}}, "commit": {"commit_id": "0f72988d86b69aac928a6d4a5006fba1d99b3c8d", "commit_author": "Vidush Vishwanath", "commitT": "2020-06-04 15:07:13-07:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "deepspeed\\pt\\deepspeed_dataloader.py", "file_new_name": "deepspeed\\pt\\deepspeed_dataloader.py", "file_complexity": {"file_NLOC": "67", "file_CCN": "8", "file_NToken": "344"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "19,20,21", "deleted_lines": "19", "method_info": {"method_name": "__init__", "method_params": "self,dataset,batch_size,pin_memory,local_rank,tput_timer,collate_fn,num_local_io_workers,data_sampler,data_parallel_world_size,data_parallel_rank", "method_startline": "11", "method_endline": "21", "method_complexity": {"method_NLOC": "11", "method_CCN": "1", "method_NToken": "35", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "19", "deleted_lines": "19", "method_info": {"method_name": "__init__", "method_params": "self,dataset,batch_size,pin_memory,local_rank,tput_timer,collate_fn,num_local_io_workers,data_sampler", "method_startline": "11", "method_endline": "19", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "27", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "deepspeed\\pt\\deepspeed_light.py", "file_new_name": "deepspeed\\pt\\deepspeed_light.py", "file_complexity": {"file_NLOC": "968", "file_CCN": "227", "file_NToken": "6442"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "623,624,625,626,627,628,629,637,638,639", "deleted_lines": "630"}}}}}}