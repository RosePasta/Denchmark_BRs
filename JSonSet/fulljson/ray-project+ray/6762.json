{"BR": {"BR_id": "6762", "BR_author": "Nintorac", "BRopenT": "2020-01-10T05:26:43Z", "BRcloseT": "2020-01-17T18:42:31Z", "BR_text": {"BRsummary": "[projects] ray session stop does not kill pods", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Using ray 0.9.0dev0\n Ray projects does not delete pods associated with the project when running ray session stop\n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n When launching the cluster with ray session start <command> the name of the cluster supplied in the cluster.yml is overwritten with the name of the project. However the same replacment is not made when running ray session stop.\n A temporary workaround is possible by running ray session stop --name project_name\n refer to the stop code here\n <denchmark-link:https://github.com/ray-project/ray/blob/master/python/ray/projects/scripts.py#L327>https://github.com/ray-project/ray/blob/master/python/ray/projects/scripts.py#L327</denchmark-link>\n \n refer to the start code here\n <denchmark-link:https://github.com/ray-project/ray/blob/master/python/ray/projects/scripts.py#L352>https://github.com/ray-project/ray/blob/master/python/ray/projects/scripts.py#L352</denchmark-link>\n \n <denchmark-h:h3>Potential fix</denchmark-h>\n \n Alter the stop function to the following\n <denchmark-code>def stop(name):\n \n    if not name:\n         name = project_definition.config[\"name\"]\n \n     project_definition = load_project_or_throw()\n     teardown_cluster(\n         project_definition.cluster_yaml(),\n         yes=True,\n         workers_only=False,\n         override_cluster_name=name)\n </denchmark-code>\n \n I think however it would be neater if the config loader did the replacement i.e here <denchmark-link:https://github.com/ray-project/ray/blob/master/python/ray/projects/projects.py#L49>https://github.com/ray-project/ray/blob/master/python/ray/projects/projects.py#L49</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Nintorac", "commentT": "2020-01-10T08:52:16Z", "comment_text": "\n \t\tThanks for attention, I will reproduce and fix it if it's a bug.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Nintorac", "commentT": "2020-01-11T22:20:53Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Nintorac>@Nintorac</denchmark-link>\n  <denchmark-link:https://github.com/Qstar>@Qstar</denchmark-link>\n  Thanks for pointing this out and offering to fix it, let me know if you need help! The proposed fix looks great to me :)\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "Nintorac", "commentT": "2020-01-14T05:30:31Z", "comment_text": "\n \t\t\n @Nintorac @Qstar Thanks for pointing this out and offering to fix it, let me know if you need help! The proposed fix looks great to me :)\n \n Please review the PR related, thanks~\n \t\t"}}}, "commit": {"commit_id": "0f3205af0b4d66444faba012a96a2b49af2433c9", "commit_author": "Qstar", "commitT": "2020-01-17 10:42:30-08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\projects\\scripts.py", "file_new_name": "python\\ray\\projects\\scripts.py", "file_complexity": {"file_NLOC": "294", "file_CCN": "45", "file_NToken": "1820"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "329,330,331,332", "deleted_lines": null, "method_info": {"method_name": "stop", "method_params": "name", "method_startline": "327", "method_endline": "337", "method_complexity": {"method_NLOC": "9", "method_CCN": "2", "method_NToken": "42", "method_nesting_level": "0"}}}}}}}}