{"BR": {"BR_id": "13200", "BR_author": "simon-mo", "BRopenT": "2021-01-05T17:44:27Z", "BRcloseT": "2021-01-18T19:52:47Z", "BR_text": {"BRsummary": "test_queue::test_custom_resource failed in Windows CI", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Ray version and other system information (Python version, TensorFlow version, OS):\n <denchmark-code>2021-01-05T07:27:22.1095558Z ==================== Test output for //python/ray/tests:test_queue:\n 2021-01-05T07:27:22.1096241Z ============================= test session starts =============================\n 2021-01-05T07:27:22.1097215Z platform win32 -- Python 3.7.9, pytest-5.4.3, py-1.10.0, pluggy-0.13.1 -- C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\python.exe\n 2021-01-05T07:27:22.1098140Z cachedir: .pytest_cache\n 2021-01-05T07:27:22.1098998Z rootdir: C:\\Users\\runneradmin\\AppData\\Local\\Temp\\Bazel.runfiles_l81w_ga9\\runfiles\\com_github_ray_project_ray\n 2021-01-05T07:27:22.1100125Z plugins: asyncio-0.14.0, rerunfailures-9.1.1, sugar-0.9.4, timeout-1.4.2\n 2021-01-05T07:27:22.1101276Z collecting ... collected 11 items\n 2021-01-05T07:27:22.1101683Z \n 2021-01-05T07:27:22.1102275Z ::test_simple_usage PASSED                                               [  9%]\n 2021-01-05T07:27:22.1102912Z ::test_get PASSED                                                        [ 18%]\n 2021-01-05T07:27:22.1103477Z ::test_get_async PASSED                                                  [ 27%]\n 2021-01-05T07:27:22.1104091Z ::test_put PASSED                                                        [ 36%]\n 2021-01-05T07:27:22.1104706Z ::test_put_async PASSED                                                  [ 45%]\n 2021-01-05T07:27:22.1105518Z ::test_concurrent_get PASSED                                             [ 54%]\n 2021-01-05T07:27:22.1106206Z ::test_concurrent_put PASSED                                             [ 63%]\n 2021-01-05T07:27:22.1106861Z ::test_batch PASSED                                                      [ 72%]\n 2021-01-05T07:27:22.1107424Z ::test_qsize PASSED                                                      [ 81%]\n 2021-01-05T07:27:22.1108058Z ::test_shutdown PASSED                                                   [ 90%]\n 2021-01-05T07:27:22.1108714Z ::test_custom_resources FAILED                                           [100%]\n 2021-01-05T07:27:22.1109107Z \n 2021-01-05T07:27:22.1109583Z ================================== FAILURES ===================================\n 2021-01-05T07:27:22.1110176Z ____________________________ test_custom_resources ____________________________\n 2021-01-05T07:27:22.1110543Z \n 2021-01-05T07:27:22.1111825Z ray_start_regular_shared = {'metrics_export_port': 65153, 'node_id': 'e959177a9e2d08a67b71d87a737211a3e6ba410aa97fb5d50f6c24de', 'node_ip_address': '10.1.0.4', 'object_store_address': 'tcp://127.0.0.1:65232', ...}\n 2021-01-05T07:27:22.1112929Z \n 2021-01-05T07:27:22.1113456Z     def test_custom_resources(ray_start_regular_shared):\n 2021-01-05T07:27:22.1114224Z         current_resources = ray.available_resources()\n 2021-01-05T07:27:22.1114934Z         assert current_resources[\"CPU\"] == 1.0\n 2021-01-05T07:27:22.1115446Z     \n 2021-01-05T07:27:22.1116031Z         # By default an actor should not reserve any resources.\n 2021-01-05T07:27:22.1116581Z         Queue()\n 2021-01-05T07:27:22.1117188Z         current_resources = ray.available_resources()\n 2021-01-05T07:27:22.1117890Z         assert current_resources[\"CPU\"] == 1.0\n 2021-01-05T07:27:22.1118389Z     \n 2021-01-05T07:27:22.1119040Z         # Specify resource requirement. The queue should now reserve 1 CPU.\n 2021-01-05T07:27:22.1119758Z         Queue(actor_options={\"num_cpus\": 1})\n 2021-01-05T07:27:22.1120315Z         time.sleep(1)\n 2021-01-05T07:27:22.1120950Z         current_resources = ray.available_resources()\n 2021-01-05T07:27:22.1121749Z >       assert \"CPU\" not in current_resources, current_resources\n 2021-01-05T07:27:22.1122649Z E       AssertionError: {'CPU': 1.0, 'memory': 90.0, 'node:10.1.0.4': 1.0, 'object_store_memory': 2.0}\n 2021-01-05T07:27:22.1123504Z E       assert 'CPU' not in {'CPU': 1.0, 'memory': 90.0, 'node:10.1.0.4': 1.0, 'object_store_memory': 2.0}\n 2021-01-05T07:27:22.1123975Z \n 2021-01-05T07:27:22.1124934Z \\\\?\\C:\\Users\\RUNNER~1\\AppData\\Local\\Temp\\Bazel.runfiles_l81w_ga9\\runfiles\\com_github_ray_project_ray\\python\\ray\\tests\\test_queue.py:211: AssertionError\n </denchmark-code>\n \n <denchmark-link:https://github.com/ray-project/ray/runs/1647962851>https://github.com/ray-project/ray/runs/1647962851</denchmark-link>\n \n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Please provide a short code snippet (less than 50 lines if possible) that can be copy-pasted to reproduce the issue. The snippet should have no external library dependencies (i.e., use fake or mock data / environments):\n If the code snippet cannot be run by itself, the issue will be closed with \"needs-repro-script\".\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "simon-mo", "commentT": "2021-01-15T17:38:27Z", "comment_text": "\n \t\tThis is now failing with a \n <denchmark-link:https://github.com/ray-project/ray/runs/1708299328?check_suite_focus=true>https://github.com/ray-project/ray/runs/1708299328?check_suite_focus=true</denchmark-link>\n \n <denchmark-code>::test_custom_resources FAILED                                           [100%]Windows fatal exception: access violation\n \n Thread 0x000006e4 (most recent call first):\n   File \"d:\\a\\ray\\ray\\python\\ray\\worker.py\", line 811 in shutdown\n   File \"d:\\a\\ray\\ray\\python\\ray\\_private\\client_mode_hook.py\", line 47 in wrapper\n   File \"\\\\?\\C:\\Users\\RUNNER~1\\AppData\\Local\\Temp\\Bazel.runfiles_3fzod71h\\runfiles\\com_github_ray_project_ray\\python\\ray\\tests\\conftest.py\", line 50 in _ray_start\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\contextlib.py\", line 119 in __exit__\n   File \"\\\\?\\C:\\Users\\RUNNER~1\\AppData\\Local\\Temp\\Bazel.runfiles_3fzod71h\\runfiles\\com_github_ray_project_ray\\python\\ray\\tests\\conftest.py\", line 81 in ray_start_regular_shared\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\fixtures.py\", line 800 in _teardown_yield_fixture\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\fixtures.py\", line 871 in finish\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 318 in _callfinalizers\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 328 in _teardown_with_finalization\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 310 in _pop_and_teardown\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 350 in _teardown_towards\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 342 in teardown_exact\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 148 in pytest_runtest_teardown\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\callers.py\", line 187 in _multicall\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\manager.py\", line 87 in <lambda>\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\manager.py\", line 93 in _hookexec\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\hooks.py\", line 286 in __call__\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 217 in <lambda>\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 244 in from_call\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 217 in call_runtest_hook\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 186 in call_and_report\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 101 in runtestprotocol\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\runner.py\", line 85 in pytest_runtest_protocol\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\callers.py\", line 187 in _multicall\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\manager.py\", line 87 in <lambda>\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\manager.py\", line 93 in _hookexec\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\hooks.py\", line 286 in __call__\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\main.py\", line 272 in pytest_runtestloop\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\callers.py\", line 187 in _multicall\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\manager.py\", line 87 in <lambda>\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\manager.py\", line 93 in _hookexec\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\hooks.py\", line 286 in __call__\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\main.py\", line 247 in _main\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\main.py\", line 191 in wrap_session\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\main.py\", line 240 in pytest_cmdline_main\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\callers.py\", line 187 in _multicall\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\manager.py\", line 87 in <lambda>\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\manager.py\", line 93 in _hookexec\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\pluggy\\hooks.py\", line 286 in __call__\n   File \"C:\\hostedtoolcache\\windows\\Python\\3.7.9\\x64\\lib\\site-packages\\_pytest\\config\\__init__.py\", line 125 in main\n   File \"\\\\?\\C:\\Users\\RUNNER~1\\AppData\\Local\\Temp\\Bazel.runfiles_3fzod71h\\runfiles\\com_github_ray_project_ray\\python\\ray\\tests\\test_queue.py\", line 217 in <module>\n </denchmark-code>\n \n \t\t"}}}, "commit": {"commit_id": "93006c2ba52e059e6fda52694762ad3cbcdef461", "commit_author": "Edward Oakes", "commitT": "2021-01-10 19:32:59-06:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\tests\\test_queue.py", "file_new_name": "python\\ray\\tests\\test_queue.py", "file_complexity": {"file_NLOC": "139", "file_CCN": "18", "file_NToken": "1021"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "208,209,210,211,212", "deleted_lines": "209,210,211", "method_info": {"method_name": "test_custom_resources", "method_params": "ray_start_regular_shared", "method_startline": "197", "method_endline": "212", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "56", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "209,210", "deleted_lines": "209,210", "method_info": {"method_name": "test_custom_resources.no_cpu_in_resources", "method_params": "", "method_startline": "209", "method_endline": "210", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "13", "method_nesting_level": "1"}}}}}}}}