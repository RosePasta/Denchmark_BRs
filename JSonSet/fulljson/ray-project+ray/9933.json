{"BR": {"BR_id": "9933", "BR_author": "jyotishp", "BRopenT": "2020-08-05T17:31:44Z", "BRcloseT": "2020-10-12T20:49:49Z", "BR_text": {"BRsummary": "[rllib] ARS trainer doesn't work with evaluation workers", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n ARS trainer fails when evaluation workers are used. Throws the following error:\n <denchmark-code>AttributeError: 'ARSTrainer' object has no attribute '_policy'\n </denchmark-code>\n \n Ray version and other system information (Python version, TensorFlow version, OS):\n \n Ray version: 0.8.6\n Tensorflow: 2.3.0\n Python 3.7\n OS: Linux\n \n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n import ray\n from ray.tune.tune import run_experiments\n \n experiments = {\n     \"cartpole-ars\": {\n         \"env\": \"CartPole-v0\",\n         \"run\": \"ARS\",\n         \"stop\": {\"timesteps_total\": 10000},\n         \"config\": {\n             \"num_workers\": 1,\n             \"num_envs_per_worker\": 5,\n             \"evaluation_interval\": 1,\n             \"evaluation_num_workers\": 1,\n             \"evaluation_num_episodes\": 1\n         }\n     }\n }\n \n ray.init(num_cpus=3)\n run_experiments(\n     experiments,\n     verbose=True,\n )\n If we cannot run your script, we cannot fix your issue.\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jyotishp", "commentT": "2020-08-05T17:36:26Z", "comment_text": "\n \t\tWhat I tried?\n from ray.rllib.agents.ars import ARSTrainer\n from ray.rllib.agents.ars.ars import get_policy_class\n \n class ARSTrainerFixed(ARSTrainer):\n     def _init(self, config, env_creator):\n         super()._init(config, env_creator)\n         self._policy = get_policy_class(config)\n Then I get\n <denchmark-code>ValueError: policy must be a rllib.Policy class\n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jyotishp", "commentT": "2020-10-09T09:55:04Z", "comment_text": "\n \t\tTaking a look ...\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "jyotishp", "commentT": "2020-10-09T12:25:47Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/jyotishp>@jyotishp</denchmark-link>\n  Thanks for filing this issue!\n This PR fixes it:\n <denchmark-link:https://github.com/ray-project/ray/pull/11308>#11308</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "0c0f67c14d515727abcacc74b749cf61cca91b63", "commit_author": "Sven Mika", "commitT": "2020-10-12 13:49:48-07:00", "commit_complexity": {"commit_NLOC": "0.42105263157894735", "commit_CCN": "1.0", "commit_Nprams": "0.3157894736842105"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "rllib\\agents\\ars\\ars.py", "file_new_name": "rllib\\agents\\ars\\ars.py", "file_complexity": {"file_NLOC": "278", "file_CCN": "43", "file_NToken": "2064"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "193,194,195", "deleted_lines": "188", "method_info": {"method_name": "_init", "method_params": "self,config,env_creator", "method_startline": "188", "method_endline": "216", "method_complexity": {"method_NLOC": "22", "method_CCN": "3", "method_NToken": "188", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "336,337,338,339,340,341,342", "deleted_lines": null, "method_info": {"method_name": "_sync_weights_to_workers", "method_params": "self,worker_set,workers", "method_startline": "336", "method_endline": "342", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "61", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "330,332,333", "deleted_lines": null, "method_info": {"method_name": "compute_action", "method_params": "self,observation,args,kwargs", "method_startline": "329", "method_endline": "333", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "55", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\agents\\ars\\ars_tf_policy.py", "file_new_name": "rllib\\agents\\ars\\ars_tf_policy.py", "file_complexity": {"file_NLOC": "88", "file_CCN": "11", "file_NToken": "763"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "23,24,27,30,31,42,48", "deleted_lines": "22,23,24,27,30,31,42,48", "method_info": {"method_name": "__init__", "method_params": "self,obs_space,action_space,config", "method_startline": "22", "method_endline": "64", "method_complexity": {"method_NLOC": "37", "method_CCN": "5", "method_NToken": "348", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\agents\\ars\\tests\\test_ars.py", "file_new_name": "rllib\\agents\\ars\\tests\\test_ars.py", "file_complexity": {"file_NLOC": "28", "file_CCN": "3", "file_NToken": "186"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "12,17,18,19,20", "deleted_lines": "12", "method_info": {"method_name": "test_ars_compilation", "method_params": "self", "method_startline": "10", "method_endline": "33", "method_complexity": {"method_NLOC": "18", "method_CCN": "3", "method_NToken": "126", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "rllib\\agents\\es\\es.py", "file_new_name": "rllib\\agents\\es\\es.py", "file_complexity": {"file_NLOC": "284", "file_CCN": "48", "file_NToken": "2019"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "205,206", "deleted_lines": null, "method_info": {"method_name": "_init", "method_params": "self,config,env_creator", "method_startline": "201", "method_endline": "227", "method_complexity": {"method_NLOC": "22", "method_CCN": "3", "method_NToken": "181", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "333,334,335,336,337,338,339", "deleted_lines": null, "method_info": {"method_name": "_sync_weights_to_workers", "method_params": "self,worker_set,workers", "method_startline": "333", "method_endline": "339", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "61", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "327,329,330", "deleted_lines": null, "method_info": {"method_name": "compute_action", "method_params": "self,observation,args,kwargs", "method_startline": "326", "method_endline": "330", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "55", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "183,184,185,186,187,188,189,190,191", "deleted_lines": "188,189", "method_info": {"method_name": "validate_config", "method_params": "config", "method_startline": "180", "method_endline": "191", "method_complexity": {"method_NLOC": "12", "method_CCN": "4", "method_NToken": "53", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "rllib\\agents\\es\\es_tf_policy.py", "file_new_name": "rllib\\agents\\es\\es_tf_policy.py", "file_complexity": {"file_NLOC": "125", "file_CCN": "23", "file_NToken": "1017"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "49,50,51", "deleted_lines": "47,48", "method_info": {"method_name": "rollout", "method_params": "policy,env,timestep_limit,add_noise,offset", "method_startline": "22", "method_endline": "60", "method_complexity": {"method_NLOC": "23", "method_CCN": "8", "method_NToken": "179", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "73,75,77,79,80,91,97", "deleted_lines": "73,75,77,78,89,95", "method_info": {"method_name": "__init__", "method_params": "self,obs_space,action_space,config", "method_startline": "72", "method_endline": "113", "method_complexity": {"method_NLOC": "37", "method_CCN": "5", "method_NToken": "352", "method_nesting_level": "1"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "rllib\\agents\\es\\es_torch_policy.py", "file_new_name": "rllib\\agents\\es\\es_torch_policy.py", "file_complexity": {"file_NLOC": "107", "file_CCN": "16", "file_NToken": "802"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "51", "deleted_lines": "51", "method_info": {"method_name": "before_init._get_flat_weights", "method_params": "policy", "method_startline": "43", "method_endline": "51", "method_complexity": {"method_NLOC": "7", "method_CCN": "2", "method_NToken": "72", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "87,88,89,90,91", "deleted_lines": null, "method_info": {"method_name": "before_init._compute_single_action", "method_params": "policy,observation,add_noise,update,kwargs", "method_startline": "87", "method_endline": "91", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "18", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "76", "deleted_lines": "76", "method_info": {"method_name": "before_init._add_noise", "method_params": "single_action,single_action_space", "method_startline": "75", "method_endline": "80", "method_complexity": {"method_NLOC": "6", "method_CCN": "3", "method_NToken": "56", "method_nesting_level": "2"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "51,76,85,86,87,88,89,90,91,92,93,94,97", "deleted_lines": "51,76,85", "method_info": {"method_name": "before_init", "method_params": "policy,observation_space,action_space,config", "method_startline": "21", "method_endline": "97", "method_complexity": {"method_NLOC": "35", "method_CCN": "3", "method_NToken": "266", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\agents\\es\\tests\\test_es.py", "file_new_name": "rllib\\agents\\es\\tests\\test_es.py", "file_complexity": {"file_NLOC": "31", "file_CCN": "3", "file_NToken": "204"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "12,21,22,23", "deleted_lines": "12", "method_info": {"method_name": "test_es_compilation", "method_params": "self", "method_startline": "10", "method_endline": "36", "method_complexity": {"method_NLOC": "21", "method_CCN": "3", "method_NToken": "144", "method_nesting_level": "1"}}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\agents\\pg\\tests\\test_pg.py", "file_new_name": "rllib\\agents\\pg\\tests\\test_pg.py", "file_complexity": {"file_NLOC": "97", "file_CCN": "15", "file_NToken": "776"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "24", "deleted_lines": "24", "method_info": {"method_name": "test_pg_compilation", "method_params": "self", "method_startline": "21", "method_endline": "32", "method_complexity": {"method_NLOC": "10", "method_CCN": "3", "method_NToken": "70", "method_nesting_level": "1"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "rllib\\agents\\trainer.py", "file_new_name": "rllib\\agents\\trainer.py", "file_complexity": {"file_NLOC": "724", "file_CCN": "103", "file_NToken": "3969"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "761,762,763,764,765", "deleted_lines": null, "method_info": {"method_name": "_sync_weights_to_workers", "method_params": "self,None,None", "method_startline": "761", "method_endline": "765", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "27", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "716,718,719", "deleted_lines": "716,717,718,719,720,721", "method_info": {"method_name": "_evaluate", "method_params": "self", "method_startline": "710", "method_endline": "753", "method_complexity": {"method_NLOC": "40", "method_CCN": "8", "method_NToken": "267", "method_nesting_level": "1"}}}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\models\\preprocessors.py", "file_new_name": "rllib\\models\\preprocessors.py", "file_complexity": {"file_NLOC": "269", "file_CCN": "62", "file_NToken": "1808"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "61", "deleted_lines": null, "method_info": {"method_name": "check_shape", "method_params": "self,Any", "method_startline": "53", "method_endline": "69", "method_complexity": {"method_NLOC": "17", "method_CCN": "6", "method_NToken": "93", "method_nesting_level": "1"}}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "rllib\\policy\\torch_policy_template.py", "file_new_name": "rllib\\policy\\torch_policy_template.py", "file_complexity": {"file_NLOC": "287", "file_CCN": "23", "file_NToken": "1359"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "25,27", "deleted_lines": "25,27", "method_info": {"method_name": "build_torch_policy", "method_params": "str,Policy,ModelV2,TensorType,None,Policy,str,None,Policy,SampleBatch,Any,None,Policy,str,ModelV2,str,None,Policy,str,None,str,None,Policy,None,Policy,Space,Space,None,Policy,Space,Space,None,Policy,Space,Space,None,TensorType,TensorType,None,Policy,ModelV2,TensorType,TensorType,TensorType,type,None,Policy,Space,Space,None,Policy,Space,Space,ModelV2,None,Policy,None,None,str,None,None", "method_startline": "22", "method_endline": "69", "method_complexity": {"method_NLOC": "47", "method_CCN": "1", "method_NToken": "482", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "25,27", "deleted_lines": "25,27", "method_info": {"method_name": "build_torch_policy", "method_params": "str,Policy,ModelV2,TensorType,None,Policy,str,None,Policy,SampleBatch,Any,None,Policy,str,ModelV2,str,None,Policy,str,None,str,None,Policy,None,Policy,Space,Space,None,Policy,Space,Space,None,Policy,Space,Space,None,TensorType,TensorType,None,Policy,ModelV2,TensorType,TensorType,TensorType,type,None,Policy,Space,Space,None,Policy,Space,Space,ModelV2,None,Policy,None,None,str,None,None", "method_startline": "22", "method_endline": "69", "method_complexity": {"method_NLOC": "47", "method_CCN": "1", "method_NToken": "479", "method_nesting_level": "0"}}}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\tests\\test_evaluators.py", "file_new_name": "rllib\\tests\\test_evaluators.py", "file_complexity": {"file_NLOC": "58", "file_CCN": "5", "file_NToken": "531"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "51", "deleted_lines": "51", "method_info": {"method_name": "test_evaluation_option", "method_params": "self", "method_startline": "27", "method_endline": "63", "method_complexity": {"method_NLOC": "31", "method_CCN": "3", "method_NToken": "184", "method_nesting_level": "1"}}}}}}}}