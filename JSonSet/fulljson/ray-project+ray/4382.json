{"BR": {"BR_id": "4382", "BR_author": "markgoodhead", "BRopenT": "2019-03-15T15:54:06Z", "BRcloseT": "2019-08-27T19:47:01Z", "BR_text": {"BRsummary": "Log monitor issue", "BRdescription": "\n <denchmark-h:h3>System information</denchmark-h>\n \n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 18\n Ray installed from (source or binary): source\n Ray version: 0.6.4\n Python version: 3.7\n \n <denchmark-h:h3>Describe the problem</denchmark-h>\n \n When running a Tune experiment from the autoscaler from time to time I get the following error:\n <denchmark-code>2019-03-15 15:48:49,381\tERROR worker.py:1752 -- The log monitor on node ip-10-2-247-245 failed with the following error:\n Traceback (most recent call last):\n   File \"/home/ubuntu/longshotsyndicate/ray/python/ray/log_monitor.py\", line 268, in <module>\n     log_monitor.run()\n   File \"/home/ubuntu/longshotsyndicate/ray/python/ray/log_monitor.py\", line 219, in run\n     anything_published = self.check_log_files_and_publish_updates()\n   File \"/home/ubuntu/longshotsyndicate/ray/python/ray/log_monitor.py\", line 175, in check_log_files_and_publish_updates\n     next_line = file_info.file_handle.readline()\n   File \"/home/ubuntu/conda/envs/venv/lib/python3.7/codecs.py\", line 322, in decode\n     (result, consumed) = self._buffer_decode(data, self.errors, final)\n UnicodeDecodeError: 'utf-8' codec can't decode byte 0xc2 in position 0: unexpected end of data\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "markgoodhead", "commentT": "2019-03-20T19:58:05Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/markgoodhead>@markgoodhead</denchmark-link>\n  thanks for reporting this. I'm currently unable to reproduce this. I tried\n import ray\n \n ray.init()\n \n @ray.remote\n def f():\n     print(\"\\xc2\")\n \n f.remote()\n in Python 3.7.\n This prints\n <denchmark-code>(pid=60142) \u00c2\n </denchmark-code>\n \n Any ideas for how to reproduce this?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "markgoodhead", "commentT": "2019-03-20T23:50:27Z", "comment_text": "\n \t\tIt might be quite hard to reproduce - it happened when running a very large cluster (84 boxes, ~6k cores) and was sporadic and infrequent over many jobs so quite possibly some load edge case. I also don't observe it when running locally for small jobs. I was hoping the error trace alone might be enough\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "markgoodhead", "commentT": "2019-03-21T03:03:46Z", "comment_text": "\n \t\tRelated to <denchmark-link:https://stackoverflow.com/questions/35028683/python3-unicodedecodeerror-with-readlines-method>https://stackoverflow.com/questions/35028683/python3-unicodedecodeerror-with-readlines-method</denchmark-link>\n .\n Ok, I'm not 100% sure how the issue arises, but I can artificially reproduce it by doing something like\n # Open some worker file.\n f = open('/tmp/ray/session_2019-03-20_19-.../logs/worker-f46537658....out', 'wb')\n \n f.write(b'\\xe5abc\\nline2\\nline3\\n')\n f.write(b'\\xe5abc\\nline2\\nline3\\n')\n f.write(b'\\xe5abc\\nline2\\nline3\\n')\n f.flush()\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "markgoodhead", "commentT": "2019-06-04T12:44:24Z", "comment_text": "\n \t\tHi, having the same issue here. Also sporadic and infrequent over many jobs.\n Kind regards,\n Marlon\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "markgoodhead", "commentT": "2019-08-15T10:04:07Z", "comment_text": "\n \t\tSame here. Just locally setup 1 ps 2 workers. It failed\n 2019-08-15 17:59:46,342\tERROR worker.py:1678 -- The log monitor on node XXX.local failed with the following error:\n Traceback (most recent call last):\n   File \"/Users/XXX/tools/ray-ps-env/ray-ps-env/lib/python3.6/site-packages/ray/log_monitor.py\", line 268, in <module>\n     log_monitor.run()\n   File \"/Users/XXX/tools/ray-ps-env/ray-ps-env/lib/python3.6/site-packages/ray/log_monitor.py\", line 219, in run\n     anything_published = self.check_log_files_and_publish_updates()\n   File \"/Users/XXX/tools/ray-ps-env/ray-ps-env/lib/python3.6/site-packages/ray/log_monitor.py\", line 175, in check_log_files_and_publish_updates\n     next_line = file_info.file_handle.readline()\n   File \"/Users/XXX/tools/ray-ps-env/ray-ps-env/bin/../lib/python3.6/codecs.py\", line 321, in decode\n     (result, consumed) = self._buffer_decode(data, self.errors, final)\n UnicodeDecodeError: 'utf-8' codec can't decode byte 0xed in position 22: invalid continuation byte\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "markgoodhead", "commentT": "2019-08-16T22:00:03Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/marlonjan>@marlonjan</denchmark-link>\n  and <denchmark-link:https://github.com/chunyang-wen>@chunyang-wen</denchmark-link>\n  thanks for reporting this. I'd like to get this fixed soon. Does anyone have a consistent way of reproducing the issue? That will make it substantially easier to debug.\n \t\t"}}}, "commit": {"commit_id": "ddfababb8286430b75a5c0edaeaece9db8319f88", "commit_author": "Philipp Moritz", "commitT": "2019-08-27 12:47:00-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.9411764705882353", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\log_monitor.py", "file_new_name": "python\\ray\\log_monitor.py", "file_complexity": {"file_NLOC": "226", "file_CCN": "31", "file_NToken": "1133"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "182,183,184,185", "deleted_lines": null, "method_info": {"method_name": "check_log_files_and_publish_updates", "method_params": "self", "method_startline": "167", "method_endline": "220", "method_complexity": {"method_NLOC": "40", "method_CCN": "11", "method_NToken": "241", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "147", "deleted_lines": "147", "method_info": {"method_name": "open_closed_files", "method_params": "self", "method_startline": "111", "method_endline": "165", "method_complexity": {"method_NLOC": "38", "method_CCN": "9", "method_NToken": "231", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\tests\\test_basic.py", "file_new_name": "python\\ray\\tests\\test_basic.py", "file_complexity": {"file_NLOC": "2226", "file_CCN": "513", "file_NToken": "18058"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "3119,3120,3121,3122,3123,3124,3125,3126,3127,3128,3129,3130,3131,3132,3133,3134,3135,3136,3137,3138,3139,3140,3141,3142", "deleted_lines": null, "method_info": {"method_name": "test_invalid_unicode_in_worker_log", "method_params": "shutdown_only", "method_startline": "3119", "method_endline": "3142", "method_complexity": {"method_NLOC": "16", "method_CCN": "3", "method_NToken": "120", "method_nesting_level": "0"}}}}}}}}