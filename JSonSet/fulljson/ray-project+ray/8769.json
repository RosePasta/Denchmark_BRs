{"BR": {"BR_id": "8769", "BR_author": "ericl", "BRopenT": "2020-06-03T19:43:51Z", "BRcloseT": "2020-06-05T06:34:22Z", "BR_text": {"BRsummary": "[rllib] test_supported_spaces consistent OOM in travis", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n The second-to-last rllib travis build has been consistently failing since: <denchmark-link:https://github.com/ray-project/ray/pull/8520/files>https://github.com/ray-project/ray/pull/8520/files</denchmark-link>\n \n was merged.\n <denchmark-code>E                       ray.memory_monitor.RayOutOfMemoryError: More than 95% of the memory on node travis-job-04150411-53df-4c8c-9bc4-2c378e131a11 is used (7.4 / 7.79 GB). The top 10 memory consumers are:\n E                       \n E                       PID\tMEM\tCOMMAND\n E                       30884\t3.23GiB\tray::RolloutWorker\n E                       26855\t0.91GiB\tbazel(ray) -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/travis/.cache/bazel/_bazel_travis/\n E                       29471\t0.46GiB\t/home/travis/build/ray-project/ray/python/ray/core/src/ray/thirdparty/redis/src/redis-server *:10263\n E                       29501\t0.33GiB\tray::ARSTrainer.train()\n </denchmark-code>\n \n See the build history here: <denchmark-link:https://travis-ci.com/github/ray-project/ray/builds>https://travis-ci.com/github/ray-project/ray/builds</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ericl", "commentT": "2020-06-03T19:46:33Z", "comment_text": "\n \t\tThis is particularly odd since ARS shouldn't be creating any RolloutWorker actors at all. Maybe it's something that got leaked from another test or ARS is a red herring.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ericl", "commentT": "2020-06-03T20:40:17Z", "comment_text": "\n \t\tAre we sure it's not a core bug? It's not just this one test. All tests at the end of the alphabet fail due to this memory problem: test_rollout, test_rollout_worker, test_supported_multi_agent, test_supported_spaces. These are the last 4 in the test dir. They all run fine locally.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "ericl", "commentT": "2020-06-03T20:43:06Z", "comment_text": "\n \t\tAll I know is it's consistently failing after that particular PR, and never had an issue before. Maybe try reverting it and see if that fixes it?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "ericl", "commentT": "2020-06-03T20:44:39Z", "comment_text": "\n \t\tyeah. This PR in question added many tests for pytorch that were previously only run for tf. Maybe this just made stuff go OOM (+ spillage between tests?). Will check.\n \t\t"}}}, "commit": {"commit_id": "97d524c07578672472c87ac8c85bfb275912548b", "commit_author": "Sven Mika", "commitT": "2020-06-05 08:34:21+02:00", "commit_complexity": {"commit_NLOC": "0.6363636363636364", "commit_CCN": "0.18181818181818182", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": ".travis.yml", "file_new_name": ".travis.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "306", "deleted_lines": "306"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "rllib\\BUILD", "file_new_name": "rllib\\BUILD", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1177,1178,1179,1180,1181,1182,1183,1184,1185,1186,1187,1188,1189,1190,1258,1280,1296,1310", "deleted_lines": "1219,1220,1221,1222,1223,1224,1225,1251,1270,1271,1272,1273,1274,1275,1276,1280,1296,1310"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\agents\\a3c\\a3c.py", "file_new_name": "rllib\\agents\\a3c\\a3c.py", "file_complexity": {"file_NLOC": "46", "file_CCN": "7", "file_NToken": "277"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "57,58,59,60", "deleted_lines": null, "method_info": {"method_name": "validate_config", "method_params": "config", "method_startline": "54", "method_endline": "60", "method_complexity": {"method_NLOC": "7", "method_CCN": "4", "method_NToken": "44", "method_nesting_level": "0"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\agents\\ars\\ars.py", "file_new_name": "rllib\\agents\\ars\\ars.py", "file_complexity": {"file_NLOC": "267", "file_CCN": "42", "file_NToken": "1974"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "182", "deleted_lines": null, "method_info": {"method_name": "_init", "method_params": "self,config,env_creator", "method_startline": "181", "method_endline": "209", "method_complexity": {"method_NLOC": "22", "method_CCN": "3", "method_NToken": "184", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "rllib\\agents\\es\\es.py", "file_new_name": "rllib\\agents\\es\\es.py", "file_complexity": {"file_NLOC": "264", "file_CCN": "45", "file_NToken": "1894"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "185", "deleted_lines": null, "method_info": {"method_name": "_init", "method_params": "self,config,env_creator", "method_startline": "184", "method_endline": "210", "method_complexity": {"method_NLOC": "22", "method_CCN": "3", "method_NToken": "177", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "172,173,174", "deleted_lines": null, "method_info": {"method_name": "validate_config", "method_params": "config", "method_startline": "172", "method_endline": "174", "method_complexity": {"method_NLOC": "3", "method_CCN": "2", "method_NToken": "18", "method_nesting_level": "0"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "rllib\\tests\\test_rollout.py", "file_new_name": "rllib\\tests\\test_rollout.py", "file_complexity": {"file_NLOC": "66", "file_CCN": "16", "file_NToken": "483"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "9,10,11,12,13,15,29,30,51,52,53,54,55", "deleted_lines": "9,11,25,26,47,48,49,50,51,52", "method_info": {"method_name": "rollout_test", "method_params": "algo,env", "method_startline": "9", "method_endline": "55", "method_complexity": {"method_NLOC": "36", "method_CCN": "6", "method_NToken": "310", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "80", "deleted_lines": null, "method_info": {"method_name": "test_impala", "method_params": "self", "method_startline": "79", "method_endline": "80", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "13", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "83", "deleted_lines": null, "method_info": {"method_name": "test_ppo", "method_params": "self", "method_startline": "82", "method_endline": "83", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "17", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "9,10,11,12,13,15,29,30,51,52,53,54,55,56,57", "deleted_lines": "9,11,25,26,47,48,49,50,51,52", "method_info": {"method_name": "rollout_test", "method_params": "algo,env,test_episode_rollout", "method_startline": "9", "method_endline": "60", "method_complexity": {"method_NLOC": "41", "method_CCN": "8", "method_NToken": "332", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": null, "deleted_lines": "77,78", "method_info": {"method_name": "test_pg", "method_params": "self", "method_startline": "77", "method_endline": "78", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "9", "method_nesting_level": "1"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 10, "file_old_name": "rllib\\tests\\test_supported_multi_agent.py", "file_new_name": "rllib\\tests\\test_supported_multi_agent.py", "file_complexity": {"file_NLOC": "96", "file_CCN": "15", "file_NToken": "487"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "81,82,83,84", "deleted_lines": null, "method_info": {"method_name": "test_dqn_multiagent", "method_params": "self", "method_startline": "80", "method_endline": "84", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "20", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "17,24", "deleted_lines": "17,24", "method_info": {"method_name": "check_support_multiagent", "method_params": "alg,config", "method_startline": "11", "method_endline": "26", "method_complexity": {"method_NLOC": "16", "method_CCN": "4", "method_NToken": "121", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "35", "deleted_lines": null, "method_info": {"method_name": "tearDownClass", "method_params": "cls", "method_startline": "35", "method_endline": "36", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "12", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "50,52,54", "deleted_lines": "48,51", "method_info": {"method_name": "test_apex_multiagent", "method_params": "self", "method_startline": "46", "method_endline": "56", "method_complexity": {"method_NLOC": "11", "method_CCN": "1", "method_NToken": "40", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "31,32", "deleted_lines": "31", "method_info": {"method_name": "setUpClass", "method_params": "cls", "method_startline": "31", "method_endline": "32", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "15", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "62,63,66", "deleted_lines": "59,62", "method_info": {"method_name": "test_apex_ddpg_multiagent", "method_params": "self", "method_startline": "58", "method_endline": "69", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "44", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "105", "deleted_lines": null, "method_info": {"method_name": "test_sac_multiagent", "method_params": "self", "method_startline": "102", "method_endline": "107", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "24", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "34", "deleted_lines": "33", "method_info": {"method_name": "tearDown", "method_params": "self", "method_startline": "33", "method_endline": "34", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "10", "method_nesting_level": "1"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "75", "deleted_lines": "76", "method_info": {"method_name": "test_ddpg_multiagent", "method_params": "self", "method_startline": "71", "method_endline": "78", "method_complexity": {"method_NLOC": "8", "method_CCN": "1", "method_NToken": "28", "method_nesting_level": "1"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "30,31", "deleted_lines": "30,31", "method_info": {"method_name": "setUp", "method_params": "self", "method_startline": "30", "method_endline": "31", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "17", "method_nesting_level": "1"}}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 12, "file_old_name": "rllib\\tests\\test_supported_spaces.py", "file_new_name": "rllib\\tests\\test_supported_spaces.py", "file_complexity": {"file_NLOC": "171", "file_CCN": "30", "file_NToken": "1340"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "151", "deleted_lines": null, "method_info": {"method_name": "test_dqn", "method_params": "self", "method_startline": "150", "method_endline": "152", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "26", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "86,87", "deleted_lines": "86", "method_info": {"method_name": "check_support._do_check", "method_params": "alg,config,a_name,o_name", "method_startline": "54", "method_endline": "97", "method_complexity": {"method_NLOC": "44", "method_CCN": "12", "method_NToken": "278", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "114,115", "deleted_lines": "114", "method_info": {"method_name": "tearDown", "method_params": "self", "method_startline": "114", "method_endline": "115", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "10", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "126", "deleted_lines": null, "method_info": {"method_name": "test_appo", "method_params": "self", "method_startline": "125", "method_endline": "127", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "37", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "51,86,87,103,106,108,109", "deleted_lines": "51,86,102,105,107", "method_info": {"method_name": "check_support", "method_params": "alg,config,train,check_bounds,tfe", "method_startline": "51", "method_endline": "109", "method_complexity": {"method_NLOC": "12", "method_CCN": "6", "method_NToken": "111", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "112", "deleted_lines": "111,112", "method_info": {"method_name": "setUp", "method_params": "self", "method_startline": "111", "method_endline": "112", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "21", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "178", "deleted_lines": "176", "method_info": {"method_name": "test_pg", "method_params": "self", "method_startline": "176", "method_endline": "178", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "35", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "51,86,87,103,106", "deleted_lines": "51,86,102,105,107", "method_info": {"method_name": "check_support", "method_params": "alg,config,check_bounds,tfe", "method_startline": "51", "method_endline": "107", "method_complexity": {"method_NLOC": "11", "method_CCN": "5", "method_NToken": "93", "method_nesting_level": "0"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "118", "deleted_lines": null, "method_info": {"method_name": "tearDownClass", "method_params": "cls", "method_startline": "118", "method_endline": "119", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "12", "method_nesting_level": "1"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "114,115", "deleted_lines": "114", "method_info": {"method_name": "setUpClass", "method_params": "cls", "method_startline": "114", "method_endline": "115", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "15", "method_nesting_level": "1"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "145", "deleted_lines": "146", "method_info": {"method_name": "test_ddpg", "method_params": "self", "method_startline": "138", "method_endline": "148", "method_complexity": {"method_NLOC": "11", "method_CCN": "1", "method_NToken": "38", "method_nesting_level": "1"}}}, "hunk_11": {"Ismethod": 1, "added_lines": "181", "deleted_lines": null, "method_info": {"method_name": "test_sac", "method_params": "self", "method_startline": "180", "method_endline": "181", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "19", "method_nesting_level": "1"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "rllib\\tuned_examples\\ppo\\pendulum-ppo.yaml", "file_new_name": "rllib\\tuned_examples\\ppo\\pendulum-ppo.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "11,14,19,21", "deleted_lines": "11,14,19,21,22"}}}}}}