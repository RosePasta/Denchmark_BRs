{"BR": {"BR_id": "1446", "BR_author": "robertnishihara", "BRopenT": "2018-01-19T01:42:58Z", "BRcloseT": "2018-10-23T22:23:25Z", "BR_text": {"BRsummary": "Occasional KeyError when running evolution strategies on two machines.", "BRdescription": "\n <denchmark-h:h3>System information</denchmark-h>\n \n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\n Ray installed from (source or binary): source\n Ray version: 215d526\n Python version: 3.6.2 Anaconda\n Exact command to reproduce:\n \n \n \n On machine 1\n ray start --head --redis-port=6379 --num-workers=0\n \n \n \n On machine 2\n ray start --redis-address <head-node-ip>:6379 --num-workers=0\n \n \n \n On machine 1\n cd ray/python/ray/rllib\n python train.py --run=ES --env=CartPole-v0 --redis-address=<head-node-ip>:6379\n \n \n \n About half of the time, this fails with\n <denchmark-code>$ python train.py --run=ES --env=CartPole-v0 --redis-address=172.31.5.255:6379\n /home/ubuntu/anaconda3/lib/python3.6/importlib/_bootstrap.py:205: RuntimeWarning: compiletime version 3.5 of module 'tensorflow.python.framework.fast_tensor_util' does not match runtime version 3.6\n   return f(*args, **kwds)\n == Status ==\n Using FIFO scheduling algorithm.\n Result logdir: /home/ubuntu/ray_results/default\n  - ES_CartPole-v0_0:\tPENDING\n \n Unified logger created with logdir '/home/ubuntu/ray_results/default/ES_CartPole-v0_0_2018-01-19_01-37-30wdhanz66'\n == Status ==\n Using FIFO scheduling algorithm.\n Resources used: 1/8 CPUs, 0/0 GPUs\n Result logdir: /home/ubuntu/ray_results/default\n  - ES_CartPole-v0_0:\tRUNNING\n \n Remote function __init__ failed with:\n \n Traceback (most recent call last):\n   File \"/home/ubuntu/ray3/python/ray/worker.py\", line 771, in _process_task\n     *arguments)\n   File \"/home/ubuntu/ray3/python/ray/actor.py\", line 196, in actor_method_executor\n     return method(actor, *args)\n   File \"/home/ubuntu/ray3/python/ray/rllib/agent.py\", line 127, in __init__\n     self._init()\n   File \"/home/ubuntu/ray3/python/ray/rllib/es/es.py\", line 157, in _init\n     noise_id = create_shared_noise.remote()\n   File \"/home/ubuntu/ray3/python/ray/worker.py\", line 2509, in func_call\n     objectids = _submit_task(function_id, args)\n   File \"/home/ubuntu/ray3/python/ray/worker.py\", line 2364, in _submit_task\n     return worker.submit_task(function_id, args)\n   File \"/home/ubuntu/ray3/python/ray/worker.py\", line 543, in submit_task\n     self.task_driver_id.id()][function_id.id()]\n KeyError: b'Z`\\xd9\\xd5?/\\x88\\x04>\\xa4Xph\\xb9\\xe3\\xca\\xf4\\xa1\\x1b\\x13'\n \n \n   You can inspect errors by running\n \n       ray.error_info()\n \n   If this driver is hanging, start a new one with\n \n       ray.init(redis_address=\"172.31.5.255:6379\")\n   \n Remote function train failed with:\n \n Traceback (most recent call last):\n   File \"/home/ubuntu/ray3/python/ray/worker.py\", line 771, in _process_task\n     *arguments)\n   File \"/home/ubuntu/ray3/python/ray/actor.py\", line 196, in actor_method_executor\n     return method(actor, *args)\n   File \"/home/ubuntu/ray3/python/ray/rllib/agent.py\", line 145, in train\n     \"Agent initialization failed, see previous errors\")\n ValueError: Agent initialization failed, see previous errors\n \n \n   You can inspect errors by running\n \n       ray.error_info()\n \n   If this driver is hanging, start a new one with\n \n       ray.init(redis_address=\"172.31.5.255:6379\")\n   \n Error processing event: Traceback (most recent call last):\n   File \"/home/ubuntu/ray3/python/ray/tune/trial_runner.py\", line 162, in _process_events\n     result = ray.get(result_id)\n   File \"/home/ubuntu/ray3/python/ray/worker.py\", line 2240, in get\n     raise RayGetError(object_ids, value)\n ray.worker.RayGetError: Could not get objectid ObjectID(a87f1adc2ec2e19f0199e246b9f733c6ea16750c). It was created by remote function train which failed with:\n \n Remote function train failed with:\n \n Traceback (most recent call last):\n   File \"/home/ubuntu/ray3/python/ray/worker.py\", line 771, in _process_task\n     *arguments)\n   File \"/home/ubuntu/ray3/python/ray/actor.py\", line 196, in actor_method_executor\n     return method(actor, *args)\n   File \"/home/ubuntu/ray3/python/ray/rllib/agent.py\", line 145, in train\n     \"Agent initialization failed, see previous errors\")\n ValueError: Agent initialization failed, see previous errors\n \n \n Stopping ES_CartPole-v0_0 Actor timed out, but moving on...\n == Status ==\n Using FIFO scheduling algorithm.\n Resources used: 0/8 CPUs, 0/0 GPUs\n Result logdir: /home/ubuntu/ray_results/default\n  - ES_CartPole-v0_0:\tERROR\n \n Traceback (most recent call last):\n   File \"train.py\", line 82, in <module>\n     num_cpus=args.num_cpus, num_gpus=args.num_gpus)\n   File \"/home/ubuntu/ray3/python/ray/tune/tune.py\", line 82, in run_experiments\n     raise TuneError(\"Trial did not complete\", trial)\n ray.tune.error.TuneError: ('Trial did not complete', <ray.tune.trial.Trial object at 0x7f30baab6c18>)\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "robertnishihara", "commentT": "2018-01-23T00:37:19Z", "comment_text": "\n \t\tOne possibility is that a remote function is being defined/invoked by a worker and not exported (I think we suppress the export of remote functions defined on workers).\n \t\t"}}}, "commit": {"commit_id": "57419f9132c9c904754c517bbff93e93f132309f", "commit_author": "Adam Gleave", "commitT": "2018-05-18 09:05:33-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\remote_function.py", "file_new_name": "python\\ray\\remote_function.py", "file_complexity": {"file_NLOC": "108", "file_CCN": "7", "file_NToken": "600"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "17,18,19,20,21,22,23", "method_info": {"method_name": "in_ipython", "method_params": "", "method_startline": "17", "method_endline": "23", "method_complexity": {"method_NLOC": "6", "method_CCN": "2", "method_NToken": "15", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "30,31,32,33,34,35,36,37", "deleted_lines": "17,18,19,20,21,22,23,24,25,39,40,41,42,43", "method_info": {"method_name": "compute_function_id", "method_params": "function", "method_startline": "17", "method_endline": "43", "method_complexity": {"method_NLOC": "13", "method_CCN": "2", "method_NToken": "94", "method_nesting_level": "0"}}}}}}}}