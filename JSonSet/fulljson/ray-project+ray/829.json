{"BR": {"BR_id": "829", "BR_author": "robertnishihara", "BRopenT": "2017-08-10T06:14:33Z", "BRcloseT": "2017-09-03T06:59:26Z", "BR_text": {"BRsummary": "Test failure in runtest.py SerializationTest.testPassingArgumentsByValue.", "BRdescription": "\n I just saw this test failure, which caused runtest.py to hang.\n Cloudpickle just pushed a new release 0.4.0, so it's probably related to that.\n <denchmark-code>testPassingArgumentsByValue (__main__.SerializationTest) ... 15979:M 10 Aug 04:33:05.891 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n 15979:M 10 Aug 04:33:05.891 # Server started, Redis version 3.9.102\n 15979:M 10 Aug 04:33:05.891 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n 15979:M 10 Aug 04:33:05.891 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.\n Waiting for redis server at 127.0.0.1:17525 to respond...\n 15983:M 10 Aug 04:33:05.999 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n 15983:M 10 Aug 04:33:05.999 # Server started, Redis version 3.9.102\n 15983:M 10 Aug 04:33:05.999 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n 15983:M 10 Aug 04:33:05.999 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.\n Waiting for redis server at 127.0.0.1:55522 to respond...\n Allowing the Plasma store to use up to 3.13729GB of memory.\n Starting local scheduler with 2 CPUs, 0 GPUs\n [INFO] (/home/travis/build/ray-project/ray/src/local_scheduler/local_scheduler.cc:226) Started worker with pid 15997\n Failed to start the UI, you may need to run 'pip install jupyter'.\n [INFO] (/home/travis/build/ray-project/ray/src/local_scheduler/local_scheduler.cc:226) Started worker with pid 16004\n WARNING: Serializing objects of type <type 'exceptions.Exception'> by expanding them as dictionaries of their fields. This behavior may be incorrect in some cases.\n WARNING: Serializing objects of type <class '__main__.CustomError'> by expanding them as dictionaries of their fields. This behavior may be incorrect in some cases.\n WARNING: Serializing objects of type <class '__main__.Point'> by expanding them as dictionaries of their fields. This behavior may be incorrect in some cases.\n Traceback (most recent call last):\n   File \"/home/travis/.local/lib/python2.7/site-packages/ray-0.1.2-py2.7-linux-x86_64.egg/ray/worker.py\", line 1504, in fetch_and_execute_function_to_run\n     function = pickle.loads(serialized_function)\n   File \"/home/travis/miniconda/lib/python2.7/pickle.py\", line 1388, in loads\n     return Unpickler(file).load()\n   File \"/home/travis/miniconda/lib/python2.7/pickle.py\", line 864, in load\n     dispatch[key](self)\n   File \"/home/travis/miniconda/lib/python2.7/pickle.py\", line 1139, in load_reduce\n     value = func(*args)\n   File \"/home/travis/miniconda/lib/python2.7/site-packages/cloudpickle/cloudpickle.py\", line 1053, in _rehydrate_skeleton_class\n     setattr(skeleton_class, attrname, attr)\n AttributeError: attribute '__dict__' of 'type' objects is not writable\n \n \n   You can inspect errors by running\n \n       ray.error_info()\n \n   If this driver is hanging, start a new one with\n \n       ray.init(redis_address=\"127.0.0.1:17525\")\n   \n Traceback (most recent call last):\n   File \"/home/travis/.local/lib/python2.7/site-packages/ray-0.1.2-py2.7-linux-x86_64.egg/ray/worker.py\", line 1504, in fetch_and_execute_function_to_run\n     function = pickle.loads(serialized_function)\n   File \"/home/travis/miniconda/lib/python2.7/pickle.py\", line 1388, in loads\n     return Unpickler(file).load()\n   File \"/home/travis/miniconda/lib/python2.7/pickle.py\", line 864, in load\n     dispatch[key](self)\n   File \"/home/travis/miniconda/lib/python2.7/pickle.py\", line 1139, in load_reduce\n     value = func(*args)\n   File \"/home/travis/miniconda/lib/python2.7/site-packages/cloudpickle/cloudpickle.py\", line 1053, in _rehydrate_skeleton_class\n     setattr(skeleton_class, attrname, attr)\n AttributeError: attribute '__dict__' of 'type' objects is not writable\n \n \n   You can inspect errors by running\n \n       ray.error_info()\n \n   If this driver is hanging, start a new one with\n \n       ray.init(redis_address=\"127.0.0.1:17525\")\n   \n Traceback (most recent call last):\n   File \"/home/travis/.local/lib/python2.7/site-packages/ray-0.1.2-py2.7-linux-x86_64.egg/ray/worker.py\", line 1504, in fetch_and_execute_function_to_run\n     function = pickle.loads(serialized_function)\n   File \"/home/travis/miniconda/lib/python2.7/pickle.py\", line 1388, in loads\n     return Unpickler(file).load()\n   File \"/home/travis/miniconda/lib/python2.7/pickle.py\", line 864, in load\n     dispatch[key](self)\n   File \"/home/travis/miniconda/lib/python2.7/pickle.py\", line 1139, in load_reduce\n     value = func(*args)\n   File \"/home/travis/miniconda/lib/python2.7/site-packages/cloudpickle/cloudpickle.py\", line 1053, in _rehydrate_skeleton_class\n     setattr(skeleton_class, attrname, attr)\n AttributeError: attribute '__dict__' of 'type' objects is not writable\n \n \n   You can inspect errors by running\n \n       ray.error_info()\n \n   If this driver is hanging, start a new one with\n \n       ray.init(redis_address=\"127.0.0.1:17525\")\n   \n This worker or driver is waiting to receive a class definition so that it can deserialize an object from the object store. This may be fine, or it may be a bug.\n \n   You can inspect errors by running\n \n       ray.error_info()\n \n   If this driver is hanging, start a new one with\n \n       ray.init(redis_address=\"127.0.0.1:17525\")\n   \n \n \n No output has been received in the last 10m0s, this potentially indicates a stalled build or something wrong with the build itself.\n Check the details on how to adjust your build configuration on: https://docs.travis-ci.com/user/common-build-problems/#Build-times-out-because-no-output-was-received\n \n The build has been terminated\n </denchmark-code>\n \n The full log is at <denchmark-link:https://s3.amazonaws.com/archive.travis-ci.org/jobs/262938813/log.txt?X-Amz-Expires=30&X-Amz-Date=20170810T055744Z&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAJRYRXRSVGNKPKO5A/20170810/us-east-1/s3/aws4_request&X-Amz-SignedHeaders=host&X-Amz-Signature=d8d5b253085265e40f0f253ad2a74cb5642433975100730fad6001e523f77181>https://s3.amazonaws.com/archive.travis-ci.org/jobs/262938813/log.txt?X-Amz-Expires=30&X-Amz-Date=20170810T055744Z&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAJRYRXRSVGNKPKO5A/20170810/us-east-1/s3/aws4_request&X-Amz-SignedHeaders=host&X-Amz-Signature=d8d5b253085265e40f0f253ad2a74cb5642433975100730fad6001e523f77181</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "robertnishihara", "commentT": "2017-08-12T19:20:30Z", "comment_text": "\n \t\tI can reproduce this on Ubuntu 16 with Anaconda Python 2.7 by running the following.\n <denchmark-code>python test/runtest.py SerializationTest.testPassingArgumentsByValue\n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "robertnishihara", "commentT": "2017-08-12T19:54:41Z", "comment_text": "\n \t\tThe problem can be reproduced more easily (without Ray) as follows.\n from collections import namedtuple\n import cloudpickle\n \n Point = namedtuple(\"Point\", [\"x\", \"y\"])\n \n s = cloudpickle.dumps(Point)\n cloudpickle.loads(s)\n This gives the error\n <denchmark-code>---------------------------------------------------------------------------\n AttributeError                            Traceback (most recent call last)\n <ipython-input-1-c865fee50a64> in <module>()\n       5 \n       6 s = cloudpickle.dumps(Point)\n ----> 7 cloudpickle.loads(s)\n \n /home/ubuntu/anaconda2/lib/python2.7/pickle.pyc in loads(str)\n    1386 def loads(str):\n    1387     file = StringIO(str)\n -> 1388     return Unpickler(file).load()\n    1389 \n    1390 # Doctest\n \n /home/ubuntu/anaconda2/lib/python2.7/pickle.pyc in load(self)\n     862             while 1:\n     863                 key = read(1)\n --> 864                 dispatch[key](self)\n     865         except _Stop, stopinst:\n     866             return stopinst.value\n \n /home/ubuntu/anaconda2/lib/python2.7/pickle.pyc in load_reduce(self)\n    1137         args = stack.pop()\n    1138         func = stack[-1]\n -> 1139         value = func(*args)\n    1140         stack[-1] = value\n    1141     dispatch[REDUCE] = load_reduce\n \n /home/ubuntu/anaconda2/lib/python2.7/site-packages/cloudpickle/cloudpickle.pyc in _rehydrate_skeleton_class(skeleton_class, class_dict)\n    1051     \"\"\"\n    1052     for attrname, attr in class_dict.items():\n -> 1053         setattr(skeleton_class, attrname, attr)\n    1054     return skeleton_class\n    1055 \n \n AttributeError: attribute '__dict__' of 'type' objects is not writable\n </denchmark-code>\n \n This is a cloudpickle regression being tracked in <denchmark-link:https://github.com/cloudpipe/cloudpickle/issues/111>cloudpipe/cloudpickle#111</denchmark-link>\n .\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "robertnishihara", "commentT": "2017-08-13T17:20:09Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ray-project/ray/pull/834>#834</denchmark-link>\n  pins cloudpickle to 0.3.0 in the Travis tests, which should fix the test failures.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "robertnishihara", "commentT": "2017-09-03T06:59:26Z", "comment_text": "\n \t\tClosing for now, since the test failure was fixed by <denchmark-link:https://github.com/ray-project/ray/pull/834>#834</denchmark-link>\n , though people with the latest cloudpickle will still run into this problem.\n \t\t"}}}, "commit": {"commit_id": "508eec58f541974327296f7823809d60808f6677", "commit_author": "Robert Nishihara", "commitT": "2017-08-13 01:16:42-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": ".travis\\install-dependencies.sh", "file_new_name": ".travis\\install-dependencies.sh", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "27,35,51,67", "deleted_lines": "27,35,51,67"}}}}}}