{"BR": {"BR_id": "6587", "BR_author": "flying-mojo", "BRopenT": "2019-12-23T10:24:29Z", "BRcloseT": "2019-12-28T17:51:10Z", "BR_text": {"BRsummary": "Eager execution with Tuple actions space failing", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n When executing in eager mode with Tuple action space the execution fails (tried on IMPALA, APPO):\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/agents/trainer.py\", line 568, in _make_workers                                          \u2502\n logdir=self.logdir)                                                                                                                                        \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/evaluation/worker_set.py\", line 64, in init                                         \u2502\n RolloutWorker, env_creator, policy, 0, self._local_config)                                                                                                 \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/evaluation/worker_set.py\", line 220, in _make_worker                                    \u2502\n _fake_sampler=config.get(\"_fake_sampler\", False))                                                                                                          \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/evaluation/rollout_worker.py\", line 353, in init                                    \u2502\n policy_dict, policy_config)                                                                                                                                \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/evaluation/rollout_worker.py\", line 766, in _build_policy_map                           \u2502\n policy_map[name] = cls(obs_space, act_space, merged_conf)                                                                                                  \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/policy/eager_tf_policy.py\", line 95, in init                                        \u2502\n super(TracedEagerPolicy, self).init(*args, **kwargs)                                                                                                   \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/policy/eager_tf_policy.py\", line 247, in init                                       \u2502\n self._initialize_loss_with_dummy_batch()                                                                                                                   \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/policy/eager_tf_policy.py\", line 522, in _initialize_loss_with_dummy_batch              \u2502\n loss_fn(self, self.model, self.dist_class, postprocessed_batch)                                                                                            \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/agents/ppo/appo_policy.py\", line 337, in build_appo_surrogate_loss                      \u2502\n mean_kl = make_time_major(prev_action_dist.multi_kl(action_dist))                                                                                          \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/agents/ppo/appo_policy.py\", line 250, in make_time_major                                \u2502\n **kw)                                                                                                                                                      \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/ray/rllib/agents/impala/vtrace_policy.py\", line 144, in _make_time_major                          \u2502\n B = tf.shape(tensor)[0] // T                                                                                                                               \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/tensorflow_core/python/ops/array_ops.py\", line 813, in _slice_helper                              \u2502\n name=name)                                                                                                                                                 \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/tensorflow_core/python/ops/array_ops.py\", line 979, in strided_slice                              \u2502\n shrink_axis_mask=shrink_axis_mask)                                                                                                                         \u2502\n File \"/data/anaconda/envs/py36/lib/python3.6/site-packages/tensorflow_core/python/ops/gen_array_ops.py\", line 10372, in strided_slice                        \u2502\n _six.raise_from(_core._status_to_exception(e.code, message), None)                                                                                         \u2502\n File \"\", line 3, in raise_from                                                                                                                       \u2502\n tensorflow.python.framework.errors_impl.InvalidArgumentError: slice index 0 of dimension 0 out of bounds. [Op:StridedSlice] name: default_policy/strided_slice/\n Ray version and other system information (Python version, TensorFlow version, OS):\n ray 0.8.0\n Does the problem occur on the latest wheels?\n <denchmark-h:h3>Reproduction</denchmark-h>\n \n Please provide a script that can be run to reproduce the issue. The script should have no external library dependencies (i.e., use fake or mock data / environments):\n run ReversedAddition-v0 in eager mode:\n rllib train --run APPO --env ReversedAddition-v0\u2502--eager --trace\n If we cannot run your script, we cannot fix your issue.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "flying-mojo", "commentT": "2019-12-26T21:42:16Z", "comment_text": "\n \t\tThanks for reporting. Could you try out <denchmark-link:https://github.com/ray-project/ray/pull/6615>#6615</denchmark-link>\n  ?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "flying-mojo", "commentT": "2019-12-28T13:04:15Z", "comment_text": "\n \t\tThanks Eric! I will test it when i run in eager mode again. Looking at the <denchmark-link:https://github.com/ray-project/ray/pull/6615>#6615</denchmark-link>\n  changelist it should fix it.\n \t\t"}}}, "commit": {"commit_id": "022954ac094d8af1ca54204a8f61585fe749095f", "commit_author": "Eric Liang", "commitT": "2019-12-28 09:51:09-08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "rllib\\models\\tf\\tf_action_dist.py", "file_new_name": "rllib\\models\\tf\\tf_action_dist.py", "file_complexity": {"file_NLOC": "237", "file_CCN": "54", "file_NToken": "1879"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "243,247,248", "deleted_lines": "242,246,247", "method_info": {"method_name": "kl", "method_params": "self,other", "method_startline": "242", "method_endline": "248", "method_complexity": {"method_NLOC": "7", "method_CCN": "2", "method_NToken": "48", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "235,238,239", "deleted_lines": "234,237,238", "method_info": {"method_name": "logp", "method_params": "self,x", "method_startline": "222", "method_endline": "239", "method_complexity": {"method_NLOC": "17", "method_CCN": "6", "method_NToken": "153", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "252,253", "deleted_lines": "251,252,253", "method_info": {"method_name": "entropy", "method_params": "self", "method_startline": "251", "method_endline": "253", "method_complexity": {"method_NLOC": "3", "method_CCN": "2", "method_NToken": "36", "method_nesting_level": "1"}}}}}}}}