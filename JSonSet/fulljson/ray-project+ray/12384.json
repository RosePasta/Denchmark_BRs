{"BR": {"BR_id": "12384", "BR_author": "simon-mo", "BRopenT": "2020-11-25T03:44:58Z", "BRcloseT": "2020-12-01T21:07:44Z", "BR_text": {"BRsummary": "[Asyncio] await RayActorError throw the wrong error", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Ray version and other system information (Python version, TensorFlow version, OS):\n import ray\n import asyncio\n \n ray.init()\n @ray.remote\n class A:\n     def hi(self): return \"hi\"\n \n a = A.remote()\n async def main():\n     await a.hi.remote()\n     ray.kill(a)\n     await a.hi.remote()\n \n asyncio.get_event_loop().run_until_complete(main())\n You will see\n <denchmark-code>Exception in callback async_set_result.<locals>.set_future()\n handle: <Handle async_set_result.<locals>.set_future()>\n Traceback (most recent call last):\n   File \"/Users/simonmo/miniconda3/lib/python3.6/asyncio/events.py\", line 145, in _run\n     self._callback(*self._args)\n   File \"python/ray/_raylet.pyx\", line 1530, in ray._raylet.async_set_result.set_future\n AttributeError: 'RayActorError' object has no attribute 'as_instanceof_cause'\n \n </denchmark-code>\n \n <denchmark-h:h3>Reproduction (REQUIRED)</denchmark-h>\n \n Please provide a script that can be run to reproduce the issue. The script should have no external library dependencies (i.e., use fake or mock data / environments):\n If we cannot run your script, we cannot fix your issue.\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "simon-mo", "commentT": "2020-11-25T03:46:16Z", "comment_text": "\n \t\tThe fix should be return as_instanceof_cause when it's RayTaskError and just the error otherwise.\n \t\t"}}}, "commit": {"commit_id": "ef1b0c13c35391434fdc0ccaa750bd9d30ce24dc", "commit_author": "Simon Mo", "commitT": "2020-12-01 13:07:43-08:00", "commit_complexity": {"commit_NLOC": "0.625", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "python\\ray\\_raylet.pyx", "file_new_name": "python\\ray\\_raylet.pyx", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1508,1509,1510", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\serve\\long_poll.py", "file_new_name": "python\\ray\\serve\\long_poll.py", "file_complexity": {"file_NLOC": "120", "file_CCN": "13", "file_NToken": "661"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83", "deleted_lines": "66,67,68,69,70,71,72,73,74", "method_info": {"method_name": "_do_long_poll", "method_params": "self", "method_startline": "64", "method_endline": "83", "method_complexity": {"method_NLOC": "13", "method_CCN": "4", "method_NToken": "79", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\tests\\test_asyncio.py", "file_new_name": "python\\ray\\tests\\test_asyncio.py", "file_complexity": {"file_NLOC": "141", "file_CCN": "30", "file_NToken": "1004"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "157,158,159", "deleted_lines": null, "method_info": {"method_name": "test_asyncio_get", "method_params": "ray_start_regular_shared,event_loop", "method_startline": "112", "method_endline": "159", "method_complexity": {"method_NLOC": "27", "method_CCN": "1", "method_NToken": "184", "method_nesting_level": "0"}}}}}}}}