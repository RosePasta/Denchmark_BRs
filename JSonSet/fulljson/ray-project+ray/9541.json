{"BR": {"BR_id": "9541", "BR_author": "clarkzinzow", "BRopenT": "2020-07-17T16:52:55Z", "BRcloseT": "2020-07-23T16:26:25Z", "BR_text": {"BRsummary": "[Core] Turning off log redirection to files breaks all Ray service startups.", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Turning off log redirection to files breaks all Ray process startups (redis, GCS server, log monitor, reporter, plasma store, raylet, etc.)\n <denchmark-code>  File \"/app/descarteslabs/services/workbench/deploy/head-image-dev.binary.runfiles/requirements_py3_pypi__ray_0_9_0_dev0/ray-0.9.0.dev0.data/purelib/ray/scripts/scripts.py\", line 470, in start\n     ray_params, head=True, shutdown_at_exit=block, spawn_reaper=block)\n   File \"/app/descarteslabs/services/workbench/deploy/head-image-dev.binary.runfiles/requirements_py3_pypi__ray_0_9_0_dev0/ray-0.9.0.dev0.data/purelib/ray/node.py\", line 194, in __init__\n     self.start_head_processes()\n   File \"/app/descarteslabs/services/workbench/deploy/head-image-dev.binary.runfiles/requirements_py3_pypi__ray_0_9_0_dev0/ray-0.9.0.dev0.data/purelib/ray/node.py\", line 746, in start_head_processes\n     self.start_redis()\n   File \"/app/descarteslabs/services/workbench/deploy/head-image-dev.binary.runfiles/requirements_py3_pypi__ray_0_9_0_dev0/ray-0.9.0.dev0.data/purelib/ray/node.py\", line 506, in start_redis\n     redis_log_files = [(open_log(redis_out_name),\n   File \"/app/descarteslabs/services/workbench/deploy/head-image-dev.binary.runfiles/requirements_py3_pypi__ray_0_9_0_dev0/ray-0.9.0.dev0.data/purelib/ray/utils.py\", line 397, in open_log\n     return open(path, **kwargs)\n TypeError: expected str, bytes or os.PathLike object, not NoneType\n </denchmark-code>\n \n Ray version and other system information (Python version, TensorFlow version, OS):\n This bug was introduced in <denchmark-link:https://github.com/ray-project/ray/pull/8885>this PR</denchmark-link>\n , so it shouldn't be affecting any releases.\n The issue is that  will return <denchmark-link:https://github.com/ray-project/ray/blob/f080aa6ce33ed34f686e868d97b85632c8a8f894/python/ray/node.py#L414-L415>None, None if output redirection is turned off</denchmark-link>\n , while all callers of that function now pass the returned log file names directly to , e.g. <denchmark-link:https://github.com/ray-project/ray/blob/f080aa6ce33ed34f686e868d97b85632c8a8f894/python/ray/node.py#L506-L507>here</denchmark-link>\n .\n <denchmark-h:h3>Reproduction:</denchmark-h>\n \n Start Ray with the environment variable GLOG_logtostderr set to 1, or with redirect_output or redirect_worker_output set to False. I've confirmed that this bug exists on the latest build off master.\n If we cannot run your script, we cannot fix your issue.\n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "clarkzinzow", "commentT": "2020-07-17T16:54:00Z", "comment_text": "\n \t\tI'll probably be submitting a fix soon.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "clarkzinzow", "commentT": "2020-07-17T16:54:58Z", "comment_text": "\n \t\tAwesome! Thanks <denchmark-link:https://github.com/clarkzinzow>@clarkzinzow</denchmark-link>\n  !!\n \t\t"}}}, "commit": {"commit_id": "9f969260e834ad7073226965f9190b58b3ee8800", "commit_author": "Clark Zinzow", "commitT": "2020-07-23 11:26:24-05:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "0.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 11, "file_old_name": "python\\ray\\node.py", "file_new_name": "python\\ray\\node.py", "file_complexity": {"file_NLOC": "639", "file_CCN": "97", "file_NToken": "3979"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "587", "deleted_lines": "579,580,601,603,604", "method_info": {"method_name": "start_dashboard", "method_params": "self,require_dashboard", "method_startline": "579", "method_endline": "605", "method_complexity": {"method_NLOC": "20", "method_CCN": "2", "method_NToken": "129", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "564", "deleted_lines": "577", "method_info": {"method_name": "start_reporter", "method_params": "self", "method_startline": "562", "method_endline": "577", "method_complexity": {"method_NLOC": "15", "method_CCN": "2", "method_NToken": "88", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "728", "deleted_lines": "726,728,729", "method_info": {"method_name": "start_monitor", "method_params": "self", "method_startline": "726", "method_endline": "738", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "83", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "423,424,425,426,427,428,429,430,431,432,433,434", "deleted_lines": null, "method_info": {"method_name": "_get_log_file_names", "method_params": "self,name,unique", "method_startline": "423", "method_endline": "443", "method_complexity": {"method_NLOC": "10", "method_CCN": "2", "method_NToken": "99", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "609", "deleted_lines": "623", "method_info": {"method_name": "start_plasma_store", "method_params": "self", "method_startline": "607", "method_endline": "624", "method_complexity": {"method_NLOC": "17", "method_CCN": "1", "method_NToken": "106", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "522,524,525,526", "deleted_lines": "534,536,537", "method_info": {"method_name": "start_redis", "method_params": "self", "method_startline": "519", "method_endline": "544", "method_complexity": {"method_NLOC": "24", "method_CCN": "2", "method_NToken": "167", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "629", "deleted_lines": "626", "method_info": {"method_name": "start_gcs_server", "method_params": "self", "method_startline": "626", "method_endline": "643", "method_complexity": {"method_NLOC": "16", "method_CCN": "1", "method_NToken": "92", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "397,398,399,400,408,409,420,421,422,423,424,425", "deleted_lines": "397,398,406", "method_info": {"method_name": "get_log_file_names", "method_params": "self,name,unique", "method_startline": "397", "method_endline": "425", "method_complexity": {"method_NLOC": "15", "method_CCN": "4", "method_NToken": "129", "method_nesting_level": "1"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "397,398,399,400,408,409,420,421", "deleted_lines": "397,398,406", "method_info": {"method_name": "get_log_file_handles", "method_params": "self,name,unique", "method_startline": "397", "method_endline": "421", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "66", "method_nesting_level": "1"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "654", "deleted_lines": "650,652,653", "method_info": {"method_name": "start_raylet", "method_params": "self,use_valgrind,use_profiler", "method_startline": "645", "method_endline": "685", "method_complexity": {"method_NLOC": "33", "method_CCN": "1", "method_NToken": "209", "method_nesting_level": "1"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "548", "deleted_lines": "552,554,555", "method_info": {"method_name": "start_log_monitor", "method_params": "self", "method_startline": "546", "method_endline": "560", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "80", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\utils.py", "file_new_name": "python\\ray\\utils.py", "file_complexity": {"file_NLOC": "376", "file_CCN": "102", "file_NToken": "2405"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "394,395,396,397", "deleted_lines": null, "method_info": {"method_name": "open_log", "method_params": "path,kwargs", "method_startline": "393", "method_endline": "401", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "41", "method_nesting_level": "0"}}}}}}}}