{"BR": {"BR_id": "2941", "BR_author": "stephanie-wang", "BRopenT": "2018-09-25T03:55:30Z", "BRcloseT": "2018-11-14T02:32:25Z", "BR_text": {"BRsummary": "[xray] Object manager does not limit number of outgoing connections for Pull requests", "BRdescription": "\n <denchmark-h:h3>Describe the problem</denchmark-h>\n \n  requests are sent by the object manager on the main thread using a synchronous WriteMessage. This artificially limited the number of connections to each remote object manager to 1. Once this is switched to using an asynchronous WriteMessage (<denchmark-link:https://github.com/ray-project/ray/issues/2939>#2939</denchmark-link>\n ), there is no longer any limit to the number of connections per remote object manager.\n We should fix this by limiting the total number of connections allowed in the object manager ConnectionPool.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "stephanie-wang", "commentT": "2018-09-25T05:36:33Z", "comment_text": "\n \t\tFYI:\n <denchmark-link:https://github.com/ray-project/ray/pull/2259>#2259</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "stephanie-wang", "commentT": "2018-09-25T18:57:06Z", "comment_text": "\n \t\tThanks, <denchmark-link:https://github.com/guoyuhong>@guoyuhong</denchmark-link>\n . The plan is to send  requests asynchronously in the future, so even though there will still only be one thread accessing the connection pool, we will have to make sure that it doesn't accidentally create multiple connections.\n Are you interested in implementing this (once the asynchronous WriteMessage change is implemented and merged)?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "stephanie-wang", "commentT": "2018-09-26T07:05:02Z", "comment_text": "\n \t\tYes, of course. Please cc me when you have the WriteMessage change ready.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "stephanie-wang", "commentT": "2018-10-19T04:58:13Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/guoyuhong>@guoyuhong</denchmark-link>\n , <denchmark-link:https://github.com/ray-project/ray/issues/2939>#2939</denchmark-link>\n  has been fixed now :)\n \t\t"}}}, "commit": {"commit_id": "577c1dda748f53adfe927e7448313b4b739fb3e4", "commit_author": "Stephanie Wang", "commitT": "2018-11-13 21:32:24-05:00", "commit_complexity": {"commit_NLOC": "0.7407407407407407", "commit_CCN": "1.0", "commit_Nprams": "0.4074074074074074"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\ray\\object_manager\\connection_pool.cc", "file_new_name": "src\\ray\\object_manager\\connection_pool.cc", "file_complexity": {"file_NLOC": "119", "file_CCN": "29", "file_NToken": "970"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "41,42,43,44,45,46,47,48,49,50", "deleted_lines": null, "method_info": {"method_name": "ray::ConnectionPool::RemoveSender", "method_params": "conn", "method_startline": "41", "method_endline": "50", "method_complexity": {"method_NLOC": "10", "method_CCN": "3", "method_NToken": "82", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "99,100,101,102,103,104,105,106,107,108,109,110,111,112", "deleted_lines": null, "method_info": {"method_name": "ray::ConnectionPool::Remove", "method_params": "conn_map,client_id,conn", "method_startline": "99", "method_endline": "112", "method_complexity": {"method_NLOC": "14", "method_CCN": "3", "method_NToken": "118", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\ray\\object_manager\\connection_pool.h", "file_new_name": "src\\ray\\object_manager\\connection_pool.h", "file_complexity": {"file_NLOC": "62", "file_CCN": "0", "file_NToken": "434"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "60,61,62,63,64,116,117,118,119", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "src\\ray\\object_manager\\object_manager.cc", "file_new_name": "src\\ray\\object_manager\\object_manager.cc", "file_complexity": {"file_NLOC": "699", "file_CCN": "121", "file_NToken": "5459"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "11,12,13,14", "method_info": {"method_name": "CheckIOError", "method_params": "status,operation", "method_startline": "11", "method_endline": "14", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "37", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "272", "deleted_lines": null, "method_info": {"method_name": "ray::ObjectManager::PullEstablishConnection", "method_params": "object_id,client_id", "method_startline": "249", "method_endline": "274", "method_complexity": {"method_NLOC": "20", "method_CCN": "4", "method_NToken": "128", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "686,687", "method_info": {"method_name": "ray::ObjectManager::CreateSenderConnection", "method_params": "type,info", "method_startline": "678", "method_endline": "702", "method_complexity": {"method_NLOC": "19", "method_CCN": "2", "method_NToken": "153", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "875,877,878,879,880,881,882,883,884", "deleted_lines": "883,884,886,887", "method_info": {"method_name": "ray::ObjectManager::SpreadFreeObjectRequest", "method_params": "object_ids", "method_startline": "857", "method_endline": "887", "method_complexity": {"method_NLOC": "28", "method_CCN": "5", "method_NToken": "214", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "287,288,289,290,291", "deleted_lines": null, "method_info": {"method_name": "ray::ObjectManager::PullSendRequest", "method_params": "object_id,conn", "method_startline": "276", "method_endline": "294", "method_complexity": {"method_NLOC": "16", "method_CCN": "2", "method_NToken": "137", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "434,435,436", "deleted_lines": null, "method_info": {"method_name": "ray::ObjectManager::ExecuteSendObject", "method_params": "client_id,object_id,data_size,metadata_size,chunk_index,connection_info", "method_startline": "417", "method_endline": "440", "method_complexity": {"method_NLOC": "23", "method_CCN": "4", "method_NToken": "159", "method_nesting_level": "1"}}}}}}}}