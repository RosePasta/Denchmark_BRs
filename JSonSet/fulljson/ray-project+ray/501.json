{"BR": {"BR_id": "501", "BR_author": "robertnishihara", "BRopenT": "2017-05-02T05:21:28Z", "BRcloseT": "2017-05-10T04:20:11Z", "BR_text": {"BRsummary": "Actor classes are pickled and exported every time an actor is created.", "BRdescription": "\n Consider the following.\n @ray.actor\n class Foo(object):\n   pass\n \n actors = [Foo() for _ in range(1000)]  \n Every time a Foo object is created, the Foo class will be pickled and exported to all of the workers. Since every newly created actor also processes every export, this is an N^2 algorithm.\n This is likely responsible for some Redis congestion that we've been seeing.\n <denchmark-link:https://github.com/pcmoritz>@pcmoritz</denchmark-link>\n  is currently working on this.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "robertnishihara", "commentT": "2017-05-02T05:33:09Z", "comment_text": "\n \t\tI'm marking this as a bug because in some cases the congestion is so bad that it causes enough local scheduler heartbeats to be missed that the global scheduler marks the local schedulers as dead.\n Note that the problem could still occur even after this problem is fixed if we have a ton of exports and then create a ton of actors in quick succession.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "robertnishihara", "commentT": "2017-05-02T05:37:28Z", "comment_text": "\n \t\tOn thing we should do here for sure is having a more reliable heartbeat system. Maybe a separate redis server, maybe even a system like etcd. Also we should investigate if there is ever the possibility that heartbeats are missed because the event loop of the component that gives the heartbeat is overloaded.\n \t\t"}}}, "commit": {"commit_id": "b4788ae51819915adb2a4e6085785860760ac40a", "commit_author": "Robert Nishihara", "commitT": "2017-05-09 19:49:23-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 10, "file_old_name": "python\\ray\\actor.py", "file_new_name": "python\\ray\\actor.py", "file_complexity": {"file_NLOC": "217", "file_CCN": "52", "file_NToken": "1574"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "203,204,205,206,207,208,209,210,211,212,213", "deleted_lines": "211", "method_info": {"method_name": "export_actor_class", "method_params": "class_id,Class,actor_method_names,worker", "method_startline": "203", "method_endline": "213", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "95", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "318,319,320,321,322,323,324", "deleted_lines": "299", "method_info": {"method_name": "actor.actor.make_actor_decorator.actor.actor.make_actor_decorator.make_actor.__init__", "method_params": "self,args,kwargs", "method_startline": "299", "method_endline": "333", "method_complexity": {"method_NLOC": "24", "method_CCN": "6", "method_NToken": "208", "method_nesting_level": "4"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "274,275,276,277,278,279,280,318,319,320,321,322,323,324", "deleted_lines": "299,353", "method_info": {"method_name": "actor.actor.make_actor_decorator.make_actor", "method_params": "Class", "method_startline": "273", "method_endline": "355", "method_complexity": {"method_NLOC": "21", "method_CCN": "3", "method_NToken": "107", "method_nesting_level": "2"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "274,275,276,277,278,279,280,318,319,320,321,322,323,324", "deleted_lines": "299,353", "method_info": {"method_name": "actor", "method_params": "args,kwargs", "method_startline": "271", "method_endline": "375", "method_complexity": {"method_NLOC": "15", "method_CCN": "10", "method_NToken": "141", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "43,44,45,46,47,48,49,50,51,52,53,54,55,82", "deleted_lines": "43,44,45,46,47,74", "method_info": {"method_name": "fetch_and_register_actor", "method_params": "actor_class_key,worker", "method_startline": "43", "method_endline": "91", "method_complexity": {"method_NLOC": "31", "method_CCN": "5", "method_NToken": "254", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": null, "deleted_lines": "195", "method_info": {"method_name": "export_actor", "method_params": "actor_id,Class,actor_method_names,num_cpus,num_gpus,worker", "method_startline": "195", "method_endline": "196", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "15", "method_nesting_level": "0"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "43,44,45,46,47,48,49,50,51,52,53,54,55,82", "deleted_lines": "39,40,41,42,43,44,45,46,47,74", "method_info": {"method_name": "fetch_and_register_actor", "method_params": "key,worker", "method_startline": "39", "method_endline": "83", "method_complexity": {"method_NLOC": "32", "method_CCN": "5", "method_NToken": "267", "method_nesting_level": "0"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "23,24", "deleted_lines": null, "method_info": {"method_name": "random_actor_class_id", "method_params": "", "method_startline": "23", "method_endline": "24", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "8", "method_nesting_level": "0"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "274,275,276,277,278,279,280,318,319,320,321,322,323,324", "deleted_lines": "299,353", "method_info": {"method_name": "actor.make_actor_decorator", "method_params": "num_cpus,num_gpus", "method_startline": "272", "method_endline": "356", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "15", "method_nesting_level": "1"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "216", "deleted_lines": null, "method_info": {"method_name": "export_actor", "method_params": "actor_id,class_id,actor_method_names,num_cpus,num_gpus,worker", "method_startline": "216", "method_endline": "217", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "15", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\worker.py", "file_new_name": "python\\ray\\worker.py", "file_complexity": {"file_NLOC": "1271", "file_CCN": "225", "file_NToken": "7912"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "450", "deleted_lines": "450", "method_info": {"method_name": "__init__", "method_params": "self", "method_startline": "431", "method_endline": "455", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "77", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "1300,1301,1302,1303,1304,1305", "deleted_lines": "1300,1301,1302,1303,1304,1305", "method_info": {"method_name": "import_thread", "method_params": "worker", "method_startline": "1281", "method_endline": "1341", "method_complexity": {"method_NLOC": "48", "method_CCN": "17", "method_NToken": "365", "method_nesting_level": "0"}}}}}}}}