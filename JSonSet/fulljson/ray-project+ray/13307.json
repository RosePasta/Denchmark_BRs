{"BR": {"BR_id": "13307", "BR_author": "saeid93", "BRopenT": "2021-01-09T00:17:09Z", "BRcloseT": "2021-01-21T15:36:11Z", "BR_text": {"BRsummary": "[rllib] Problem in preprocessing nested MultiDiscrete", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n Ray version: latest\n Python version: 3.8.5\n OS: Ubuntu 20.04.1 LTS\n <denchmark-h:h3>Reproduction</denchmark-h>\n \n The preprocessor OneHotPreprocessorin the ray/rllib/models/preprocessors.py returns the wrong result when the MultiDiscrete space is nested in a Tuple or Dict spaces. Here is a failing test.\n <denchmark-code>def test_nested_multidiscrete_one_hot_preprocessor(self):\n     space = Tuple((MultiDiscrete([2, 3, 4]), ))\n     pp = get_preprocessor(space)(space)\n     self.assertTrue(pp.shape == (9, ))\n     check(\n         pp.transform((np.array([1, 2, 0]), )),\n         [0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0])\n     check(\n         pp.transform((np.array([0, 1, 3]), )),\n         [1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0])\n </denchmark-code>\n \n I'm going to submit a pull request to resolve this issue.\n \t"}, "comments": {}}, "commit": {"commit_id": "d11e62f9e61a2eb2c5ce9c8d437b3d0d9cae6511", "commit_author": "Saeid", "commitT": "2021-01-21 16:36:11+01:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "rllib\\models\\preprocessors.py", "file_new_name": "rllib\\models\\preprocessors.py", "file_complexity": {"file_NLOC": "291", "file_CCN": "57", "file_NToken": "2094"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "177", "deleted_lines": "177"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\models\\tests\\test_preprocessors.py", "file_new_name": "rllib\\models\\tests\\test_preprocessors.py", "file_complexity": {"file_NLOC": "75", "file_CCN": "7", "file_NToken": "938"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "74,75,76,77,78,79,80,81,82,83", "deleted_lines": null, "method_info": {"method_name": "test_nested_multidiscrete_one_hot_preprocessor", "method_params": "self", "method_startline": "74", "method_endline": "83", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "167", "method_nesting_level": "1"}}}}}}}}