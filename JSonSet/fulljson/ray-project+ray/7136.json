{"BR": {"BR_id": "7136", "BR_author": "drozzy", "BRopenT": "2020-02-12T10:44:47Z", "BRcloseT": "2020-03-04T10:31:24Z", "BR_text": {"BRsummary": "[RLlib] Cannot rollout ES after training.", "BRdescription": "\n Using ray 0.8.1.\n Having trained an agent with ES:\n <denchmark-code>rllib train --run=ES --env=LunarLander-v2 --checkpoint-freq=10\n </denchmark-code>\n \n I can't play it. (It works with PPO).\n Executing this:\n <denchmark-code>rllib rollout checkpoint_50/checkpoint-50 --run ES --env LunarLander-v2 --steps 600\n </denchmark-code>\n \n results in:\n <denchmark-code>2020-02-12 05:41:30,922 INFO trainable.py:423 -- Current state after restoring: {'_iteration': 50, '_timesteps_total': 16979666, '_time_total': 2578.4048051834106, '_episodes_total': None}\n Traceback (most recent call last):\n   File \"/home/andriy/miniconda3/envs/myproj/bin/rllib\", line 8, in <module>\n     sys.exit(cli())\n   File \"/home/andriy/miniconda3/envs/myproj/lib/python3.7/site-packages/ray/rllib/scripts.py\", line 36, in cli\n     rollout.run(options, rollout_parser)\n   File \"/home/andriy/miniconda3/envs/myproj/lib/python3.7/site-packages/ray/rllib/rollout.py\", line 265, in run\n     args.no_render, args.monitor)\n   File \"/home/andriy/miniconda3/envs/myproj/lib/python3.7/site-packages/ray/rllib/rollout.py\", line 364, in rollout\n     prev_action=prev_actions[agent_id],\n   File \"/home/andriy/miniconda3/envs/myproj/lib/python3.7/site-packages/ray/rllib/rollout.py\", line 272, in __missing__\n     self[key] = value = self.default_factory(key)\n   File \"/home/andriy/miniconda3/envs/myproj/lib/python3.7/site-packages/ray/rllib/rollout.py\", line 340, in <lambda>\n     lambda agent_id: action_init[mapping_cache[agent_id]])\n NameError: free variable 'action_init' referenced before assignment in enclosing scope\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "drozzy", "commentT": "2020-02-12T12:12:18Z", "comment_text": "\n \t\tI'll take a look.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "drozzy", "commentT": "2020-03-04T10:31:24Z", "comment_text": "\n \t\tThanks for filing this issue <denchmark-link:https://github.com/drozzy>@drozzy</denchmark-link>\n !\n This PR fixes the problem. It was a bug in our rollout.py script affecting all agents (ARS as well) that do not have a  property.\n <denchmark-link:https://github.com/ray-project/ray/pull/7444>#7444</denchmark-link>\n \n Closing this issue.\n \t\t"}}}, "commit": {"commit_id": "1989eed3bf0e5297e277bae3ea4cdd411c080663", "commit_author": "Eric Liang", "commitT": "2020-03-04 23:57:44-08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "0.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "rllib\\agents\\ars\\ars.py", "file_new_name": "rllib\\agents\\ars\\ars.py", "file_complexity": {"file_NLOC": "246", "file_CCN": "37", "file_NToken": "1889"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "304", "method_info": {"method_name": "compute_action", "method_params": "self,observation", "method_startline": "304", "method_endline": "305", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "23", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "168", "deleted_lines": "168,169", "method_info": {"method_name": "_init", "method_params": "self,config,env_creator", "method_startline": "164", "method_endline": "198", "method_complexity": {"method_NLOC": "26", "method_CCN": "3", "method_NToken": "212", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "303", "deleted_lines": "304", "method_info": {"method_name": "compute_action", "method_params": "self,observation,args,kwargs", "method_startline": "303", "method_endline": "304", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "29", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "rllib\\agents\\es\\es.py", "file_new_name": "rllib\\agents\\es\\es.py", "file_complexity": {"file_NLOC": "246", "file_CCN": "38", "file_NToken": "1817"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "295", "method_info": {"method_name": "compute_action", "method_params": "self,observation", "method_startline": "295", "method_endline": "296", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "23", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "174", "deleted_lines": "174,175", "method_info": {"method_name": "_init", "method_params": "self,config,env_creator", "method_startline": "170", "method_endline": "203", "method_complexity": {"method_NLOC": "25", "method_CCN": "3", "method_NToken": "210", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "294", "deleted_lines": "295", "method_info": {"method_name": "compute_action", "method_params": "self,observation,args,kwargs", "method_startline": "294", "method_endline": "295", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "29", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "rllib\\rollout.py", "file_new_name": "rllib\\rollout.py", "file_complexity": {"file_NLOC": "377", "file_CCN": "43", "file_NToken": "2027"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "18,343,356,357,358,359,360,361,364,365,366,367,368", "deleted_lines": "342,352,353,354,355"}}}}}}