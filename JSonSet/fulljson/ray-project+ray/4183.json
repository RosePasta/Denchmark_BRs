{"BR": {"BR_id": "4183", "BR_author": "vakker", "BRopenT": "2019-02-27T11:31:01Z", "BRcloseT": "2020-06-06T00:29:28Z", "BR_text": {"BRsummary": "[autoscaler] Ray submit with docker doesn't rsync the script to the container", "BRdescription": "\n <denchmark-h:h3>System information</denchmark-h>\n \n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Debian GNU/Linux 9.8 (stretch) on GCP\n Ray installed from (source or binary): source (5bfcfa8)\n Ray version: master - 5bfcfa8 (0.7.0.dev0)\n Python version: 3.7\n Exact command to reproduce:\n \n <denchmark-code>ray up -y minimal.yaml  # with a docker image of the master build of Ray\n ray submit --docker minimal.yaml hello_ray.py\n </denchmark-code>\n \n <denchmark-h:h3>Describe the problem</denchmark-h>\n \n If I run submit without --docker then the worker can execute the specified script from ~, but when --docker is set, it throws:\n <denchmark-code>python: can't open file '/root/hello_ray.py': [Errno 2] No such file or directory\n </denchmark-code>\n \n When the docker run is called in the initialization phase, there doesn't seem to be any attached volumes, so I guess a shared location between the host and the container should resolve this, but there could be better ways as well.\n <denchmark-h:h3>Source code / logs</denchmark-h>\n \n I can include full logs if necessary.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "vakker", "commentT": "2019-03-05T02:06:37Z", "comment_text": "\n \t\tSorry for the late reply.\n A good fix here would be to use  if using  (and implicitly ): <denchmark-link:https://docs.docker.com/engine/reference/commandline/cp/>https://docs.docker.com/engine/reference/commandline/cp/</denchmark-link>\n \n I can probably get to this in a couple days, but if you're interested in a contributing a fix, I'd be more than glad to help fix up the PR and get it merged.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "vakker", "commentT": "2019-03-05T21:19:00Z", "comment_text": "\n \t\tThanks for looking into this. Sorry, I could do it probably next week, but definitely not in the next few days...\n \t\t"}, "comments_2": {"comment_id": 4, "comment_author": "vakker", "commentT": "2019-08-06T07:31:02Z", "comment_text": "\n \t\tOops, this should be addressed in <denchmark-link:https://github.com/ray-project/ray/issues/4403>#4403</denchmark-link>\n .\n \t\t"}, "comments_3": {"comment_id": 5, "comment_author": "vakker", "commentT": "2019-10-22T23:54:48Z", "comment_text": "\n \t\tSo what ended up being the fix for this?\n \t\t"}, "comments_4": {"comment_id": 6, "comment_author": "vakker", "commentT": "2020-03-04T16:51:28Z", "comment_text": "\n \t\tI am also looking for the fix to this.\n \t\t"}}}, "commit": {"commit_id": "54189bca5a7bbfdcb031e692b740b1f141816690", "commit_author": "Ian Rodney", "commitT": "2020-06-05 17:29:27-07:00", "commit_complexity": {"commit_NLOC": "0.9361702127659575", "commit_CCN": "1.0", "commit_Nprams": "0.2553191489361702"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\autoscaler\\autoscaler.py", "file_new_name": "python\\ray\\autoscaler\\autoscaler.py", "file_complexity": {"file_NLOC": "362", "file_CCN": "75", "file_NToken": "2324"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "364,365", "deleted_lines": "363", "method_info": {"method_name": "spawn_updater", "method_params": "self,node_id,init_commands,ray_start_commands", "method_startline": "350", "method_endline": "367", "method_complexity": {"method_NLOC": "18", "method_CCN": "1", "method_NToken": "125", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "324,325", "deleted_lines": "324", "method_info": {"method_name": "recover_if_needed", "method_params": "self,node_id,now", "method_startline": "298", "method_endline": "327", "method_complexity": {"method_NLOC": "30", "method_CCN": "4", "method_NToken": "191", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\ray\\autoscaler\\commands.py", "file_new_name": "python\\ray\\autoscaler\\commands.py", "file_complexity": {"file_NLOC": "486", "file_CCN": "44", "file_NToken": "2820"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "150,151", "deleted_lines": "150", "method_info": {"method_name": "kill_node", "method_params": "config_file,yes,hard,override_cluster_name", "method_startline": "120", "method_endline": "164", "method_complexity": {"method_NLOC": "37", "method_CCN": "5", "method_NToken": "238", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\autoscaler\\kubernetes\\node_provider.py", "file_new_name": "python\\ray\\autoscaler\\kubernetes\\node_provider.py", "file_complexity": {"file_NLOC": "77", "file_CCN": "19", "file_NToken": "557"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "90,91", "deleted_lines": "90,91", "method_info": {"method_name": "get_command_runner", "method_params": "self,log_prefix,node_id,auth_config,cluster_name,process_runner,use_internal_ip", "method_startline": "90", "method_endline": "91", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "17", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "90,91,92,93,94,95,96,97", "deleted_lines": "90,91", "method_info": {"method_name": "get_command_runner", "method_params": "self,log_prefix,node_id,auth_config,cluster_name,process_runner,use_internal_ip,docker_config", "method_startline": "90", "method_endline": "97", "method_complexity": {"method_NLOC": "8", "method_CCN": "1", "method_NToken": "21", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\ray\\autoscaler\\node_provider.py", "file_new_name": "python\\ray\\autoscaler\\node_provider.py", "file_complexity": {"file_NLOC": "154", "file_CCN": "34", "file_NToken": "871"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "214,215", "deleted_lines": "214,215", "method_info": {"method_name": "get_command_runner", "method_params": "self,log_prefix,node_id,auth_config,cluster_name,process_runner,use_internal_ip", "method_startline": "214", "method_endline": "215", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "17", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "214,215,216,217,218,219,220,221", "deleted_lines": "214,215", "method_info": {"method_name": "get_command_runner", "method_params": "self,log_prefix,node_id,auth_config,cluster_name,process_runner,use_internal_ip,docker_config", "method_startline": "214", "method_endline": "221", "method_complexity": {"method_NLOC": "8", "method_CCN": "1", "method_NToken": "21", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 8, "file_old_name": "python\\ray\\autoscaler\\updater.py", "file_new_name": "python\\ray\\autoscaler\\updater.py", "file_complexity": {"file_NLOC": "411", "file_CCN": "58", "file_NToken": "2691"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "319,320,321,322", "deleted_lines": "319", "method_info": {"method_name": "run_rsync_down", "method_params": "self,source,target", "method_startline": "319", "method_endline": "322", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "43", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "330,331,332,333,334,335,336", "deleted_lines": null, "method_info": {"method_name": "docker_expand_user", "method_params": "self,string", "method_startline": "330", "method_endline": "336", "method_complexity": {"method_NLOC": "7", "method_CCN": "2", "method_NToken": "32", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "354,355", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,node_id,provider_config,provider,auth_config,cluster_name,file_mounts,initialization_commands,setup_commands,ray_start_commands,runtime_hash,process_runner,use_internal_ip,docker_config", "method_startline": "342", "method_endline": "355", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "37", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "314,315,316,317", "deleted_lines": null, "method_info": {"method_name": "run_rsync_up", "method_params": "self,source,target", "method_startline": "314", "method_endline": "317", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "43", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "303,304,305,306,307,308,309", "deleted_lines": null, "method_info": {"method_name": "run", "method_params": "self,cmd,timeout,allocate_tty,exit_on_fail,port_forward,with_output", "method_startline": "303", "method_endline": "309", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "27", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "300,301,302,303,304,305,306,307,308,309,310,311,312", "deleted_lines": "312", "method_info": {"method_name": "__init__", "method_params": "self,node_id,provider_config,provider,auth_config,cluster_name,file_mounts,initialization_commands,setup_commands,ray_start_commands,runtime_hash,process_runner,use_internal_ip", "method_startline": "300", "method_endline": "312", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "33", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "324,325,326,327,328", "deleted_lines": null, "method_info": {"method_name": "remote_shell_command_str", "method_params": "self", "method_startline": "324", "method_endline": "328", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "39", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "298,299,300,301", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,docker_config,common_args", "method_startline": "298", "method_endline": "301", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "32", "method_nesting_level": "1"}}}}}}}}