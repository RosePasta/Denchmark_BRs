{"BR": {"BR_id": "7757", "BR_author": "carlbalmer", "BRopenT": "2020-03-26T15:40:51Z", "BRcloseT": "2020-03-27T19:17:17Z", "BR_text": {"BRsummary": "[rllib] ray/rllib/rollout.py does not find registered trainables", "BRdescription": "\n <denchmark-h:h3>What is the problem?</denchmark-h>\n \n When using rollout.py with custom trainable (registered via tune.register_trainable) the script does not find the trainable.\n This seems to be caused because rollout.py uses ray.rllib.agents.registry.get_agent_class instead of ray.tune.registry.get_trainable_cls.\n Ray version and other system information (Python version, TensorFlow version, OS):\n python=3.7.3, ray[rllib,debug]==ray-0.9.0.dev0, tensorflow==1.15.0, Ubuntu 18.04 LTS\n <denchmark-h:h3>Reproduction</denchmark-h>\n \n <denchmark-code>#generate checkpoint\n rllib train --run DQN --env CartPole-v0 --stop '{\"timesteps_total\": 5000}' --checkpoint-freq 1\n python rollout.py PATH_TO_CHECKPOINT --run OtherDQN --episodes 10 --out rollout.pkl\n \n 2020-03-26 16:28:25,858\tINFO resource_spec.py:212 -- Starting Ray with 11.62 GiB memory available for workers and up to 5.83 GiB for objects. You can adjust these settings with ray.init(memory=<bytes>, object_store_memory=<bytes>).\n 2020-03-26 16:28:26,332\tINFO services.py:1123 -- View the Ray dashboard at localhost:8265\n Traceback (most recent call last):\n   File \"rollout.py\", line 475, in <module>\n     run(args, parser)\n   File \"rollout.py\", line 285, in run\n     cls = get_agent_class(args.run)\n   File \"/home/carl/miniconda3/envs/rollout_test/lib/python3.7/site-packages/ray/rllib/agents/registry.py\", line 130, in get_agent_class\n     return _get_agent_class(alg)\n   File \"/home/carl/miniconda3/envs/rollout_test/lib/python3.7/site-packages/ray/rllib/agents/registry.py\", line 154, in _get_agent_class\n     raise Exception((\"Unknown algorithm {}.\").format(alg))\n Exception: Unknown algorithm OtherDQN.\n </denchmark-code>\n \n The provided rollout.py adds the following lines at the start:\n <denchmark-code>from ray.rllib.agents.dqn import DQNTrainer\n OtherDQNTrainer = DQNTrainer.with_updates(\n     name=\"OtherDQN\")\n ray.tune.register_trainable(\"OtherDQN\", OtherDQNTrainer)\n </denchmark-code>\n \n If ray.rllib.agents.registry.get_agent_class is replaces with ray.tune.registry.get_trainable_cls it works (with both \"OtherDQN\" and \"DQN\")\n <denchmark-link:https://github.com/ray-project/ray/files/4388161/rollout.zip>rollout.zip</denchmark-link>\n \n \n  I have verified my script runs in a clean environment and reproduces the issue.\n  I have verified the issue also occurs with the latest wheels.\n \n \t"}, "comments": {}}, "commit": {"commit_id": "0cfb6488a74011f6aa909cead1bd770d5020a52b", "commit_author": "Carl Balmer", "commitT": "2020-03-27 12:17:16-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "rllib\\rollout.py", "file_new_name": "rllib\\rollout.py", "file_complexity": {"file_NLOC": "377", "file_CCN": "43", "file_NToken": "2025"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "277", "deleted_lines": "277", "method_info": {"method_name": "run", "method_params": "args,parser", "method_startline": "239", "method_endline": "304", "method_complexity": {"method_NLOC": "45", "method_CCN": "11", "method_NToken": "347", "method_nesting_level": "0"}}}}}}}}