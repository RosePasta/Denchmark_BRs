{"BR": {"BR_id": "8082", "BR_author": "ch1010", "BRopenT": "2019-08-09T01:30:49Z", "BRcloseT": "2019-08-21T13:47:26Z", "BR_text": {"BRsummary": "Wrong searchSize in GridSearchCandidateGenerator", "BRdescription": "\n <denchmark-h:h4>Issue Description</denchmark-h>\n \n The searchSize calculated in GridSearchCandidateGenerator.initialize() is wrong\n I have four ParameterSpaces:\n <denchmark-code>ParameterSpace<Double> learningRateHyperparam = new DiscreteParameterSpace<>(0.003, 0.005, 0.01, 0.05);\n ParameterSpace<Integer> layerSizeHyperparam1 = new DiscreteParameterSpace<>(32, 64, 96, 128);\n ParameterSpace<Integer> layerSizeHyperparam2 = new DiscreteParameterSpace<>(32, 64, 96, 128);\n ParameterSpace<Double> dropoutHyperparam = new DiscreteParameterSpace<Double>(0.8, 0.9);\n </denchmark-code>\n \n But the searchSize is 16, which is 4 (from layerSizeHyperparam1) x 4 (from layerSizeHyperparam2).\n AdamSpace(learningRateHyperparam) and DropoutSpace are not considered.\n <denchmark-h:h4>Version Information</denchmark-h>\n \n Deeplearning4j version: 1.0.0-beta4\n <denchmark-h:h4>Additional Information</denchmark-h>\n \n The full structure of MultiLayerSpace:\n <denchmark-code>protected MultiLayerSpace getNetworkSpace() {\n         ParameterSpace<Double> learningRateHyperparam = new DiscreteParameterSpace<>(0.003, 0.005, 0.01, 0.05);\n         ParameterSpace<Integer> layerSizeHyperparam1 = new DiscreteParameterSpace<>(32, 64, 96, 128);\n         ParameterSpace<Integer> layerSizeHyperparam2 = new DiscreteParameterSpace<>(32, 64, 96, 128);\n         ParameterSpace<Double> dropoutHyperparam = new DiscreteParameterSpace<Double>(0.8, 0.9);\n \n         return new MultiLayerSpace.Builder()\n                 .seed(SEED)\n                 .optimizationAlgo(OptimizationAlgorithm.STOCHASTIC_GRADIENT_DESCENT)\n                 .updater(new AdamSpace(learningRateHyperparam))\n                 .weightInit(WeightInit.XAVIER)\n                 .l2(0.0001)\n                 .addLayer(new DenseLayerSpace.Builder()\n                         .nIn(mInputNum)\n                         .nOut(layerSizeHyperparam1)\n                         .build())\n                 .addLayer(new BatchNormalizationSpace.Builder()\n                         .nOut(layerSizeHyperparam1)\n                         .activation(Activation.RELU)\n                         .build())\n                 .addLayer(new DropoutLayerSpace.Builder()\n                         .dropOut(dropoutHyperparam)\n                         .build())\n                 .addLayer(new DenseLayerSpace.Builder()\n                         .nOut(layerSizeHyperparam2)\n                         .build())\n                 .addLayer(new BatchNormalizationSpace.Builder()\n                         .nOut(layerSizeHyperparam2)\n                         .activation(Activation.RELU)\n                         .build())\n                 .addLayer(new DropoutLayerSpace.Builder()\n                         .dropOut(dropoutHyperparam)\n                         .build())\n                 .addLayer(new OutputLayerSpace.Builder()\n                         .nOut(mOutputNum)\n                         .activation(Activation.SOFTMAX)\n                         .lossFunction(LossFunctions.LossFunction.RECONSTRUCTION_CROSSENTROPY)\n                         .build())\n                 .numEpochs(mHyperEpochCount)\n                 .build();\n }\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ch1010", "commentT": "2019-08-21T13:47:55Z", "comment_text": "\n \t\tThanks for reporting - fixed here, will be merged to eclipse/deeplearning4j master soon.\n <denchmark-link:https://github.com/SkymindIO/deeplearning4j/pull/141>SkymindIO#141</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "348d9c59f7ead214202ace7c813dfef99f2d73b4", "commit_author": "Alex Black", "commitT": "2019-08-21 23:47:24+10:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.9618320610687023", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "arbiter\\arbiter-core\\src\\main\\java\\org\\deeplearning4j\\arbiter\\optimize\\api\\adapter\\ParameterSpaceAdapter.java", "file_new_name": "arbiter\\arbiter-core\\src\\main\\java\\org\\deeplearning4j\\arbiter\\optimize\\api\\adapter\\ParameterSpaceAdapter.java", "file_complexity": {"file_NLOC": "44", "file_CCN": "8", "file_NToken": "268"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "65", "deleted_lines": null, "method_info": {"method_name": "ParameterSpaceAdapter<F,T>::getNestedSpaces", "method_params": "", "method_startline": "64", "method_endline": "66", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "22", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "56,57,58,59", "deleted_lines": "58", "method_info": {"method_name": "ParameterSpaceAdapter<F,T>::collectLeaves", "method_params": "", "method_startline": "55", "method_endline": "61", "method_complexity": {"method_NLOC": "7", "method_CCN": "2", "method_NToken": "39", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "70", "deleted_lines": null, "method_info": {"method_name": "ParameterSpaceAdapter<F,T>::isLeaf", "method_params": "", "method_startline": "69", "method_endline": "71", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "8", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "arbiter\\arbiter-core\\src\\main\\java\\org\\deeplearning4j\\arbiter\\optimize\\generator\\GridSearchCandidateGenerator.java", "file_new_name": "arbiter\\arbiter-core\\src\\main\\java\\org\\deeplearning4j\\arbiter\\optimize\\generator\\GridSearchCandidateGenerator.java", "file_complexity": {"file_NLOC": "134", "file_CCN": "21", "file_NToken": "989"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "129,130", "deleted_lines": null, "method_info": {"method_name": "GridSearchCandidateGenerator::initialize", "method_params": "", "method_startline": "106", "method_endline": "163", "method_complexity": {"method_NLOC": "46", "method_CCN": "10", "method_NToken": "329", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "arbiter\\arbiter-deeplearning4j\\src\\main\\java\\org\\deeplearning4j\\arbiter\\BaseNetworkSpace.java", "file_new_name": "arbiter\\arbiter-deeplearning4j\\src\\main\\java\\org\\deeplearning4j\\arbiter\\BaseNetworkSpace.java", "file_complexity": {"file_NLOC": "472", "file_CCN": "102", "file_NToken": "3477"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "214,215,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,235", "deleted_lines": "215,216,217,223,225,226", "method_info": {"method_name": "BaseNetworkSpace<T>::collectLeaves", "method_params": "", "method_startline": "210", "method_endline": "236", "method_complexity": {"method_NLOC": "23", "method_CCN": "5", "method_NToken": "190", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "arbiter\\arbiter-deeplearning4j\\src\\main\\java\\org\\deeplearning4j\\arbiter\\MultiLayerSpace.java", "file_new_name": "arbiter\\arbiter-deeplearning4j\\src\\main\\java\\org\\deeplearning4j\\arbiter\\MultiLayerSpace.java", "file_complexity": {"file_NLOC": "220", "file_CCN": "45", "file_NToken": "1678"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "87,88,90", "deleted_lines": "87", "method_info": {"method_name": "MultiLayerSpace::MultiLayerSpace", "method_params": "builder", "method_startline": "71", "method_endline": "95", "method_complexity": {"method_NLOC": "16", "method_CCN": "2", "method_NToken": "117", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "arbiter\\arbiter-deeplearning4j\\src\\main\\java\\org\\deeplearning4j\\arbiter\\adapter\\ActivationParameterSpaceAdapter.java", "file_new_name": "arbiter\\arbiter-deeplearning4j\\src\\main\\java\\org\\deeplearning4j\\arbiter\\adapter\\ActivationParameterSpaceAdapter.java", "file_complexity": {"file_NLOC": "30", "file_CCN": "4", "file_NToken": "184"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "55,56,57", "deleted_lines": null, "method_info": {"method_name": "ActivationParameterSpaceAdapter::underlyingName", "method_params": "", "method_startline": "55", "method_endline": "57", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "8", "method_nesting_level": "1"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "arbiter\\arbiter-deeplearning4j\\src\\main\\java\\org\\deeplearning4j\\arbiter\\adapter\\LossFunctionParameterSpaceAdapter.java", "file_new_name": "arbiter\\arbiter-deeplearning4j\\src\\main\\java\\org\\deeplearning4j\\arbiter\\adapter\\LossFunctionParameterSpaceAdapter.java", "file_complexity": {"file_NLOC": "32", "file_CCN": "4", "file_NToken": "194"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "57,58,59", "deleted_lines": null, "method_info": {"method_name": "LossFunctionParameterSpaceAdapter::underlyingName", "method_params": "", "method_startline": "57", "method_endline": "59", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "8", "method_nesting_level": "1"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "arbiter\\arbiter-deeplearning4j\\src\\main\\java\\org\\deeplearning4j\\arbiter\\layers\\DropoutLayerSpace.java", "file_new_name": "arbiter\\arbiter-deeplearning4j\\src\\main\\java\\org\\deeplearning4j\\arbiter\\layers\\DropoutLayerSpace.java", "file_complexity": {"file_NLOC": "56", "file_CCN": "11", "file_NToken": "360"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "55", "deleted_lines": "55", "method_info": {"method_name": "DropoutLayerSpace::collectLeaves", "method_params": "", "method_startline": "54", "method_endline": "56", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "12", "method_nesting_level": "1"}}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "arbiter\\arbiter-deeplearning4j\\src\\test\\java\\org\\deeplearning4j\\arbiter\\multilayernetwork\\TestMultiLayerSpace.java", "file_new_name": "arbiter\\arbiter-deeplearning4j\\src\\test\\java\\org\\deeplearning4j\\arbiter\\multilayernetwork\\TestMultiLayerSpace.java", "file_complexity": {"file_NLOC": "596", "file_CCN": "52", "file_NToken": "6571"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "713,714,715,716,717,718,719,720,721,722,723,724,725,726,727,728,729,730,731,732,733,734,735,736,737,738,739,740,741,742,743,744,745,746,747,748,749,750,751,752,753,754,755,756,757,758,759,760,761,762,763,764,765,766,767,768", "deleted_lines": null, "method_info": {"method_name": "TestMultiLayerSpace::testIssue8082", "method_params": "", "method_startline": "713", "method_endline": "768", "method_complexity": {"method_NLOC": "49", "method_CCN": "3", "method_NToken": "396", "method_nesting_level": "1"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "deeplearning4j\\deeplearning4j-nlp-parent\\deeplearning4j-nlp\\src\\main\\java\\org\\deeplearning4j\\iterator\\CnnSentenceDataSetIterator.java", "file_new_name": "deeplearning4j\\deeplearning4j-nlp-parent\\deeplearning4j-nlp\\src\\main\\java\\org\\deeplearning4j\\iterator\\CnnSentenceDataSetIterator.java", "file_complexity": {"file_NLOC": "429", "file_CCN": "93", "file_NToken": "3155"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "120,121,127,129,132,133,134,135", "deleted_lines": "125,127,129,131", "method_info": {"method_name": "CnnSentenceDataSetIterator::CnnSentenceDataSetIterator", "method_params": "builder", "method_startline": "100", "method_endline": "136", "method_complexity": {"method_NLOC": "31", "method_CCN": "5", "method_NToken": "260", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "143,144,145", "deleted_lines": null, "method_info": {"method_name": "CnnSentenceDataSetIterator::loadSingleSentence", "method_params": "sentence", "method_startline": "141", "method_endline": "189", "method_complexity": {"method_NLOC": "45", "method_CCN": "10", "method_NToken": "432", "method_nesting_level": "1"}}}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "deeplearning4j\\deeplearning4j-nlp-parent\\deeplearning4j-nlp\\src\\main\\java\\org\\deeplearning4j\\text\\sentenceiterator\\AggregatingSentenceIterator.java", "file_new_name": "deeplearning4j\\deeplearning4j-nlp-parent\\deeplearning4j-nlp\\src\\main\\java\\org\\deeplearning4j\\text\\sentenceiterator\\AggregatingSentenceIterator.java", "file_complexity": {"file_NLOC": "81", "file_CCN": "21", "file_NToken": "462"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "108,109", "deleted_lines": null, "method_info": {"method_name": "AggregatingSentenceIterator::Builder::addSentencePreProcessor", "method_params": "preProcessor", "method_startline": "107", "method_endline": "109", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "15", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "111", "deleted_lines": null, "method_info": {"method_name": "AggregatingSentenceIterator::Builder::sentencePreProcessor", "method_params": "preProcessor", "method_startline": "111", "method_endline": "114", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "18", "method_nesting_level": "2"}}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "deeplearning4j\\deeplearning4j-nlp-parent\\deeplearning4j-nlp\\src\\test\\java\\org\\deeplearning4j\\iterator\\TestCnnSentenceDataSetIterator.java", "file_new_name": "deeplearning4j\\deeplearning4j-nlp-parent\\deeplearning4j-nlp\\src\\test\\java\\org\\deeplearning4j\\iterator\\TestCnnSentenceDataSetIterator.java", "file_complexity": {"file_NLOC": "271", "file_CCN": "30", "file_NToken": "3353"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "267,268,269,270,271,272,273,274,275,276,277,278,279,280,281", "deleted_lines": null, "method_info": {"method_name": "TestCnnSentenceDataSetIterator::testCnnSentenceDataSetIteratorNoTokensEdgeCase", "method_params": "", "method_startline": "218", "method_endline": "282", "method_complexity": {"method_NLOC": "46", "method_CCN": "5", "method_NToken": "574", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393", "deleted_lines": null, "method_info": {"method_name": "TestCnnSentenceDataSetIterator::testCnnSentenceDataSetIteratorUseUnknownVector", "method_params": "", "method_startline": "345", "method_endline": "393", "method_complexity": {"method_NLOC": "35", "method_CCN": "2", "method_NToken": "445", "method_nesting_level": "1"}}}}}}}}