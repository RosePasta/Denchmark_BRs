{"BR": {"BR_id": "5966", "BR_author": "alrutten", "BRopenT": "2018-07-25T11:22:28Z", "BRcloseT": "2018-07-26T00:58:06Z", "BR_text": {"BRsummary": "SequenceRecordReaderDataSetIterator handles negative labelIndex incorrectly", "BRdescription": "\n in this if statement (line 197-216 in SequenceRecordReaderDataSetIterator.java) the if (labelIndex < 0)  will never be evaluated:\n <denchmark-code> if (labelIndex == 0 || labelIndex == totalSizeF - 1) {\n                 //Labels are first or last -> one input in underlying\n                 int inputFrom;\n                 int inputTo;\n                 **if (labelIndex < 0) {**\n                     //No label\n                     inputFrom = 0;\n                     inputTo = totalSizeF - 1;\n                 } else if (labelIndex == 0) {\n                     inputFrom = 1;\n                     inputTo = totalSizeF - 1;\n                 } else {\n                     inputFrom = 0;\n                     inputTo = labelIndex - 1;\n                 }\n \n                 builder.addInput(READER_KEY, inputFrom, inputTo);\n \n                 underlyingIsDisjoint = false;\n             }\n </denchmark-code>\n \n which i think means that the builder will .addInput(readername,0,-2), which seems to lead to a shape error (reader is the same CSVSequenceRecordReader in both code snippets):\n <denchmark-code>val iterator = new SequenceRecordReaderDataSetIterator(reader,1,13,-1)\n iterator.next(1)\n </denchmark-code>\n \n <denchmark-code>Exception in thread \"main\" org.nd4j.linalg.exception.ND4JIllegalStateException: Invalid shape: Requested INDArray shape [1, 0, 50] contains dimension size values < 1 (all dimensions must be 1 or more)\n \tat org.nd4j.linalg.factory.Nd4j.checkShapeValues(Nd4j.java:5593)\n \tat org.nd4j.linalg.factory.Nd4j.create(Nd4j.java:5563)\n \tat org.deeplearning4j.datasets.datavec.RecordReaderMultiDataSetIterator.convertWritablesSequence(RecordReaderMultiDataSetIterator.java:598)\n \tat org.deeplearning4j.datasets.datavec.RecordReaderMultiDataSetIterator.convertFeaturesOrLabels(RecordReaderMultiDataSetIterator.java:368)\n \tat org.deeplearning4j.datasets.datavec.RecordReaderMultiDataSetIterator.nextMultiDataSet(RecordReaderMultiDataSetIterator.java:326)\n \tat org.deeplearning4j.datasets.datavec.RecordReaderMultiDataSetIterator.next(RecordReaderMultiDataSetIterator.java:212)\n \tat org.deeplearning4j.datasets.datavec.SequenceRecordReaderDataSetIterator.next(SequenceRecordReaderDataSetIterator.java:361)\n \n </denchmark-code>\n \n <denchmark-code>val iterator = new RecordReaderMultiDataSetIterator.Builder(1)\n \t\t                    .addSequenceReader(\"features\",reader)\n \t\t                    .addInput(\"features\",0,-2)\n \t    \t                   .build()\n iterator.next(1)\n </denchmark-code>\n \n <denchmark-code>Exception in thread \"main\" org.nd4j.linalg.exception.ND4JIllegalStateException: Invalid shape: Requested INDArray shape [1, 0, 50] contains dimension size values < 1 (all dimensions must be 1 or more)\n \tat org.nd4j.linalg.factory.Nd4j.checkShapeValues(Nd4j.java:5593)\n \tat org.nd4j.linalg.factory.Nd4j.create(Nd4j.java:5563)\n \tat org.deeplearning4j.datasets.datavec.RecordReaderMultiDataSetIterator.convertWritablesSequence(RecordReaderMultiDataSetIterator.java:598)\n \tat org.deeplearning4j.datasets.datavec.RecordReaderMultiDataSetIterator.convertFeaturesOrLabels(RecordReaderMultiDataSetIterator.java:368)\n \tat org.deeplearning4j.datasets.datavec.RecordReaderMultiDataSetIterator.nextMultiDataSet(RecordReaderMultiDataSetIterator.java:326)\n \tat org.deeplearning4j.datasets.datavec.RecordReaderMultiDataSetIterator.next(RecordReaderMultiDataSetIterator.java:212)\n \n </denchmark-code>\n \n expected behaviour:\n <denchmark-code>val iterator = new RecordReaderMultiDataSetIterator.Builder(1)\n \t\t                    .addSequenceReader(\"features\",reader)\n \t\t                    .addInput(\"features\",0,0)\n \t    \t                   .build()\n iterator.next(1)\n </denchmark-code>\n \n <denchmark-code>MultiDataSet: 1 input arrays, 0 label arrays, 0 input masks, 0 label masks\n === INPUT 0 ===\n [[[    1.0000,   82.0000,   48.0000,   10.0000,   10.0000,    3.0000,   82.0000,    1.0000,   10.0000,   82.0000,    1.0000,   48.0000,   48.0000,   82.0000,    1.0000,   10.0000,    1.0000,   82.0000,   48.0000,    1.0000,   82.0000,   10.0000, 2872.0000,   82.0000,    3.0000,   10.0000,    1.0000,   48.0000,    1.0000,   82.0000,    3.0000,   10.0000,    3.0000,   82.0000,   10.0000,   48.0000,    1.0000,   10.0000,    3.0000,   48.0000,    1.0000,   82.0000,   10.0000,   48.0000,   82.0000,    1.0000,   82.0000,    3.0000,   48.0000,    1.0000]]]\n \n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "alrutten", "commentT": "2018-07-26T00:58:25Z", "comment_text": "\n \t\tFixed here: <denchmark-link:https://github.com/deeplearning4j/deeplearning4j/pull/5970>https://github.com/deeplearning4j/deeplearning4j/pull/5970</denchmark-link>\n \n Thanks for reporting.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "alrutten", "commentT": "2018-09-21T12:59:17Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "5527bc306b76c1609c8b9da7079fc6686fd0bc94", "commit_author": "Alex Black", "commitT": "2018-07-26 10:58:05+10:00", "commit_complexity": {"commit_NLOC": "0.7777777777777778", "commit_CCN": "0.7777777777777778", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "deeplearning4j\\deeplearning4j-core\\src\\test\\java\\org\\deeplearning4j\\datasets\\datavec\\RecordReaderDataSetiteratorTest.java", "file_new_name": "deeplearning4j\\deeplearning4j-core\\src\\test\\java\\org\\deeplearning4j\\datasets\\datavec\\RecordReaderDataSetiteratorTest.java", "file_complexity": {"file_NLOC": "990", "file_CCN": "82", "file_NToken": "13366"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1354,1355,1356,1357,1358,1359,1360,1361,1362,1363,1364,1365,1366,1367,1368,1369", "deleted_lines": null, "method_info": {"method_name": "RecordReaderDataSetiteratorTest::testSeqRRDSINoLabels", "method_params": "", "method_startline": "1354", "method_endline": "1369", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "222", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "deeplearning4j\\deeplearning4j-data\\deeplearning4j-datavec-iterators\\src\\main\\java\\org\\deeplearning4j\\datasets\\datavec\\SequenceRecordReaderDataSetIterator.java", "file_new_name": "deeplearning4j\\deeplearning4j-data\\deeplearning4j-datavec-iterators\\src\\main\\java\\org\\deeplearning4j\\datasets\\datavec\\SequenceRecordReaderDataSetIterator.java", "file_complexity": {"file_NLOC": "317", "file_CCN": "70", "file_NToken": "2155"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "196,197,198,199,200,243,244,245,246,247,248,249", "deleted_lines": "196,197,240,241,242,243,244,245", "method_info": {"method_name": "SequenceRecordReaderDataSetIterator::initializeUnderlying", "method_params": "nextF", "method_startline": "171", "method_endline": "283", "method_complexity": {"method_NLOC": "85", "method_CCN": "29", "method_NToken": "536", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "371", "deleted_lines": "367", "method_info": {"method_name": "SequenceRecordReaderDataSetIterator::next", "method_params": "num", "method_startline": "349", "method_endline": "375", "method_complexity": {"method_NLOC": "22", "method_CCN": "7", "method_NToken": "140", "method_nesting_level": "1"}}}}}}}}