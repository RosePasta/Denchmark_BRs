{"BR": {"BR_id": "263", "BR_author": "markusressel", "BRopenT": "2020-03-07T15:46:49Z", "BRcloseT": "2020-03-24T12:51:02Z", "BR_text": {"BRsummary": "Specify UID and GID of photoprism user in Docker image", "BRdescription": "\n Hey there, thx for this awesome piece of software! \ud83d\udc4d\n I want to run photoprism using the Docker container, which has a volume mounted via NFS share. This folder has a special group that is allowed to access the data. The photoprism user inside of the Docker image always has UID & GID 1000 though, which makes it difficult to do a proper user/group/permission mapping.\n Is there already a way to specify the UID and GID? If not, would it be trivial to add such an option f.ex. using environment variables?\n Thx\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "markusressel", "commentT": "2020-03-07T22:01:35Z", "comment_text": "\n \t\tNot sure, maybe we can change it on startup... building a new image is not an option for most users as it takes a long time.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "markusressel", "commentT": "2020-03-10T02:11:11Z", "comment_text": "\n \t\tYes thats how most people do it (f.ex. <denchmark-link:https://github.com/plexinc/pms-docker>Plex</denchmark-link>\n , altough their approach seems unnecessarily complex to me).\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "markusressel", "commentT": "2020-03-10T10:57:34Z", "comment_text": "\n \t\tWould using <denchmark-link:https://github.com/boxboat/fixuid>https://github.com/boxboat/fixuid</denchmark-link>\n  be a good solution? Other suggestions?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "markusressel", "commentT": "2020-03-10T15:41:53Z", "comment_text": "\n \t\tWell...\n \n fixuid should only be used in development Docker containers. DO NOT INCLUDE in a production container image\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "markusressel", "commentT": "2020-03-10T16:18:23Z", "comment_text": "\n \t\tI think this could work:\n <denchmark-link:https://docs.docker.com/engine/reference/run/#user>https://docs.docker.com/engine/reference/run/#user</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "markusressel", "commentT": "2020-03-23T19:33:03Z", "comment_text": "\n \t\tI've just pushed new Dockerfiles that don't explicitly set a user, so it should be possible to use them with any uid. Note that paths and some environment variable names have changed as well to simplify installation. All files are now in /photoprism instead of /home/photoprism since there is no default user photoprism (uid 1000) anymore.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "markusressel", "commentT": "2020-03-24T12:02:11Z", "comment_text": "\n \t\tThx, but I get this now:\n <denchmark-code>ERRO[2020-03-24T12:01:16Z] can't create \"/photoprism/Pictures/Import\": please check configuration and permissions\n </denchmark-code>\n \n I have a volume mounted to /photoprism/Pictures/Originals, but no other directory, so photoprism tries to create the others but cant.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "markusressel", "commentT": "2020-03-24T12:06:26Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/markusressel>@markusressel</denchmark-link>\n  Did you update your configuration?\n Note that paths have been renamed for simplicity: /photoprism/Pictures/Import is /photoprism/import now!\n Example: <denchmark-link:https://dl.photoprism.org/docker/docker-compose.yml>https://dl.photoprism.org/docker/docker-compose.yml</denchmark-link>\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "markusressel", "commentT": "2020-03-24T12:14:14Z", "comment_text": "\n \t\tAh without the Pictures too, sorry, I did miss that.\n It does start now, but first I see this error in the Webinterface log:\n <denchmark-code>2020-03-24 12:09:32 ERRO settings file not found: \"/photoprism/~/.config/photoprism/settings.yml\"\n </denchmark-code>\n \n Seems like a mix of absolute and relative paths there. I have specified PHOTOPRISM_ORIGINALS_PATH, PHOTOPRISM_IMPORT_PATH and PHOTOPRISM_EXPORT_PATH to point to the /photoprism/<something> location, should I remove those?\n And secondly, the group of the user inside the container can still not be changed (or can it?), it is GID 0 - root now. I would need to allow more than just one user to access the NFS share and I need the group for that.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "markusressel", "commentT": "2020-03-24T12:27:23Z", "comment_text": "\n \t\tDoes this work for you? <denchmark-link:https://dev.to/acro5piano/specifying-user-and-group-in-docker-i2e>https://dev.to/acro5piano/specifying-user-and-group-in-docker-i2e</denchmark-link>\n \n You should be able to specify a user in docker-compose.yml:\n <denchmark-code>user: \"${UID}:${GID}\"\n </denchmark-code>\n \n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "markusressel", "commentT": "2020-03-24T12:29:37Z", "comment_text": "\n \t\tDid you pull our latest docker image?\n <denchmark-link:https://github.com/photoprism/photoprism/blob/develop/docker/photoprism/Dockerfile>https://github.com/photoprism/photoprism/blob/develop/docker/photoprism/Dockerfile</denchmark-link>\n \n As you can see, PHOTOPRISM_CONFIG_FILE points to /photoprism/config/photoprism.yml\n If you have everything configured using env variables, you don't need a config file and can ignore the warning.\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "markusressel", "commentT": "2020-03-24T12:47:06Z", "comment_text": "\n \t\tThe error message related to the PHOTOPRISM_CONFIG_FILE option seems to have disappeared, maybe I was too quick or the cluster didn't pull the newest image (although it always should, automatically).\n I am not using docker directly but a Kubernetes through Rancher, so the setup is a bit different.\n According to <denchmark-link:https://stackoverflow.com/a/51445080/1941623>this</denchmark-link>\n  I can use the  and  parameters to specify  and . Although the output of  when I run it inside the container is a bit wonky:\n <denchmark-code>groups: cannot find name for group ID 1103\n I have no name!@photoprism-89fd645c9-79kfb:/photoprism$ id\n uid=1103 gid=0(root) groups=0(root),1103\n </denchmark-code>\n \n Photoprism now does have access to the files in the NFS share.\n So it seems like it is working now, not sure if you want more input from other users using Docker directly, but imo this issue is resolved.\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "markusressel", "commentT": "2020-03-24T12:51:02Z", "comment_text": "\n \t\tOn Linux, Docker shares the kernel with the host. So user and group ids should work, you just can't look up their names.\n I'll close this. Thank you!\n \t\t"}}}, "commit": {"commit_id": "a1706a5922a22673f1aeeaadb4c06f3c6a8bdd13", "commit_author": "Michael Mayer", "commitT": "2020-03-23 20:29:31+01:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "Dockerfile", "file_new_name": "Dockerfile", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1", "deleted_lines": "1"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docker\\development\\Dockerfile", "file_new_name": "docker\\development\\Dockerfile", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "87,92", "deleted_lines": "87,92"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docker\\photoprism-arm64\\Dockerfile", "file_new_name": "docker\\photoprism-arm64\\Dockerfile", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "72,77,135,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,158,159,160,161,162,163,164", "deleted_lines": "72,77,135,136,137,139,140,142,144,145,146,147,150,151,152,153,154,155,156,157,158"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docker\\photoprism-arm64\\docker-compose.yml", "file_new_name": "docker\\photoprism-arm64\\docker-compose.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "29,30,32,33,34,35,36", "deleted_lines": "23,24,25,32,34,35,36,37,38"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docker\\photoprism\\Dockerfile", "file_new_name": "docker\\photoprism\\Dockerfile", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1,51,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,74,75,76,77,78,79,80", "deleted_lines": "1,51,52,53,55,56,58,60,61,62,63,66,67,68,69,70,71,72,73,74"}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docker\\photoprism\\docker-compose.yml", "file_new_name": "docker\\photoprism\\docker-compose.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "28,30,31,32,33,34", "deleted_lines": "21,22,23,32,33,34,35,36"}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "frontend\\package-lock.json", "file_new_name": "frontend\\package-lock.json", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1884,1885,10905,10906,11912,11913,12630,12631,12932,12933", "deleted_lines": "1884,10904,11910,12627,12928"}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "go.sum", "file_new_name": "go.sum", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": null, "deleted_lines": "378,379"}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\commands\\config.go", "file_new_name": "internal\\commands\\config.go", "file_complexity": {"file_NLOC": "71", "file_CCN": "1", "file_NToken": "716"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "59,60,61,62,63,64,65,66,67,68,69,70", "deleted_lines": "44,45,46,47,48,49,50,51,52,53,54,55", "method_info": {"method_name": "configAction", "method_params": "Context", "method_startline": "18", "method_endline": "85", "method_complexity": {"method_NLOC": "60", "method_CCN": "1", "method_NToken": "688", "method_nesting_level": "0"}}}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\commands\\start.go", "file_new_name": "internal\\commands\\start.go", "file_complexity": {"file_NLOC": "101", "file_CCN": "15", "file_NToken": "583"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "51", "deleted_lines": "55", "method_info": {"method_name": "startAction", "method_params": "Context", "method_startline": "41", "method_endline": "135", "method_complexity": {"method_NLOC": "68", "method_CCN": "15", "method_NToken": "491", "method_nesting_level": "0"}}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\config\\config_test.go", "file_new_name": "internal\\config\\config_test.go", "file_complexity": {"file_NLOC": "289", "file_CCN": "45", "file_NToken": "1990"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "126", "deleted_lines": "126", "method_info": {"method_name": "TestConfig_SqlServerPath", "method_params": "T", "method_startline": "122", "method_endline": "128", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "39", "method_nesting_level": "0"}}}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\config\\db.go", "file_new_name": "internal\\config\\db.go", "file_complexity": {"file_NLOC": "152", "file_CCN": "33", "file_NToken": "855"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "117", "deleted_lines": "117", "method_info": {"method_name": "connectToDatabase", "method_params": "Context", "method_startline": "89", "method_endline": "150", "method_complexity": {"method_NLOC": "47", "method_CCN": "15", "method_NToken": "288", "method_nesting_level": "0"}}}}}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\config\\filenames.go", "file_new_name": "internal\\config\\filenames.go", "file_complexity": {"file_NLOC": "133", "file_CCN": "40", "file_NToken": "993"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "64,65", "deleted_lines": "64,65", "method_info": {"method_name": "CreateDirectories", "method_params": "", "method_startline": "31", "method_endline": "85", "method_complexity": {"method_NLOC": "34", "method_CCN": "11", "method_NToken": "377", "method_nesting_level": "0"}}}}}, "file_13": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "internal\\config\\flags.go", "file_new_name": "internal\\config\\flags.go", "file_complexity": {"file_NLOC": "260", "file_CCN": "0", "file_NToken": "942"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "147,148,149,150,151", "deleted_lines": "208,209,210,211,212"}}}, "file_14": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\config\\params.go", "file_new_name": "internal\\config\\params.go", "file_complexity": {"file_NLOC": "150", "file_CCN": "25", "file_NToken": "1136"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "117", "deleted_lines": "117", "method_info": {"method_name": "expandFilenames", "method_params": "", "method_startline": "109", "method_endline": "120", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "131", "method_nesting_level": "0"}}}}}, "file_15": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "internal\\config\\server.go", "file_new_name": "internal\\config\\server.go", "file_complexity": {"file_NLOC": "62", "file_CCN": "20", "file_NToken": "339"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "6,7,8,9,10,11,12", "deleted_lines": null, "method_info": {"method_name": "DatabasePath", "method_params": "", "method_startline": "6", "method_endline": "12", "method_complexity": {"method_NLOC": "6", "method_CCN": "2", "method_NToken": "41", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "85,86,87,88,89,90,91", "method_info": {"method_name": "SqlServerPath", "method_params": "", "method_startline": "85", "method_endline": "91", "method_complexity": {"method_NLOC": "6", "method_CCN": "2", "method_NToken": "41", "method_nesting_level": "0"}}}}}}}}