{"BR": {"BR_id": "736", "BR_author": "nschermer", "BRopenT": "2020-12-23T15:41:55Z", "BRcloseT": "2020-12-23T18:51:12Z", "BR_text": {"BRsummary": "GPS coordinate errors during indexing", "BRdescription": "\n I get the following errors during indexing of some files:\n <denchmark-code>2020-12-23 16:17:10 ERRO Error 1264: Out of range value for column 'photo_lat' at row 1 / record not found\n 2020-12-23 16:17:10 INFO index: failed main jpg file \u201cP3200004.JPG\u201d\n 2020-12-23 16:17:10 ERRO index: Error 1264: Out of range value for column 'photo_lat' at row 1 / record not found in \u201cP3200004.JPG\u201d (find or create photo)\n 2020-12-23 16:17:10 ERRO Error 1264: Out of range value for column 'photo_lat' at row 1 / record not found\n 2020-12-23 16:17:10 INFO index: failed main jpg file \u201cP3200003.JPG\u201d\n 2020-12-23 16:17:10 ERRO index: Error 1264: Out of range value for column 'photo_lat' at row 1 / record not found in \u201cP3200003.JPG\u201d (find or create photo)\n </denchmark-code>\n \n The extracted EXIF from in the sidecar json looks like this (grep GPS):\n <denchmark-code>  \"GPSVersionID\": \"2.3.0.0\",\n   \"GPSLatitudeRef\": \"Unknown ()\",\n   \"GPSLongitudeRef\": \"Unknown ()\",\n   \"GPSStatus\": \"Measurement Void\",\n   \"GPSImgDirectionRef\": \"Magnetic North\",\n   \"GPSImgDirection\": 265.24,\n   \"GPSAreaInformation\": \"\",\n   \"GPSLatitude\": \"\",\n   \"GPSLongitude\": \"\",\n </denchmark-code>\n \n It is obvious the image does not contain any GPS data, but these situations should not result in errors imho, but I've looked through the code and GpsToDecimal() seems to handle this correctly... Although I wonder why it returns 0 and not NULL.\n I'm only seeing the errors when PhotoPrism is using MySql (Mariadb to be precise), hence the SQL error number. Using the lastest image from Docker Hub.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "nschermer", "commentT": "2020-12-23T16:00:07Z", "comment_text": "\n \t\tWe use multiple Exif parsers, needs to be tested if related to exiftool json. These fields should be empty or non-existent if no coordinates exist. Maybe they were stored in a broken way.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "nschermer", "commentT": "2020-12-23T16:02:32Z", "comment_text": "\n \t\tCan you provide us with a file for testing? You may send it privately to <denchmark-link:mailto:hello@photoprism.org>hello@photoprism.org</denchmark-link>\n  as well.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "nschermer", "commentT": "2020-12-23T16:34:21Z", "comment_text": "\n \t\t<denchmark-link:https://user-images.githubusercontent.com/5014119/103018158-0ee6d180-4545-11eb-9c2d-d0765b4e58ae.JPG></denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "nschermer", "commentT": "2020-12-23T16:45:10Z", "comment_text": "\n \t\t\n We use multiple Exif parsers, needs to be tested if related to exiftool json. These fields should be empty or non-existent if no coordinates exist. Maybe they were stored in a broken way.\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "nschermer", "commentT": "2020-12-23T16:46:13Z", "comment_text": "\n \t\t\n We use multiple Exif parsers, needs to be tested if related to exiftool json. These fields should be empty or non-existent if no coordinates exist. Maybe they were stored in a broken way.\n \n Sorry, wrong button. When I add the file in another location I get the same error message again.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "nschermer", "commentT": "2020-12-23T17:41:41Z", "comment_text": "\n \t\tClassic division by zero \ud83d\udc7b\n <denchmark-code>IFD-PATH=[IFD/GPSInfo] ID=(0x0001) NAME=[GPSLatitudeRef] COUNT=(2) TYPE=[ASCII] VALUE=[string with binary data (1 bytes)]\n IFD-PATH=[IFD/GPSInfo] ID=(0x0002) NAME=[GPSLatitude] COUNT=(3) TYPE=[RATIONAL] VALUE=[[0/0 0/0 0/0]]\n IFD-PATH=[IFD/GPSInfo] ID=(0x0003) NAME=[GPSLongitudeRef] COUNT=(2) TYPE=[ASCII] VALUE=[string with binary data (1 bytes)]\n IFD-PATH=[IFD/GPSInfo] ID=(0x0004) NAME=[GPSLongitude] COUNT=(3) TYPE=[RATIONAL] VALUE=[[0/0 0/0 0/0]]\n </denchmark-code>\n \n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "nschermer", "commentT": "2020-12-23T18:51:12Z", "comment_text": "\n \t\tJust saw the images was already available. Works fine.\n New output:\n <denchmark-code>2020-12-23 19:49:30 INFO Indexing completed in 11 s\n 2020-12-23 19:49:29 INFO purge: searching index for hidden media files\n 2020-12-23 19:49:24 INFO index: added main jpg file \u201cP3200003.JPG\u201d\n 2020-12-23 19:49:24 INFO index: added main jpg file \u201cP3200004.JPG\u201d\n 2020-12-23 19:49:21 WARN metadata: invalid gps coordinates in P3200003.JPG (exif)\n 2020-12-23 19:49:21 WARN metadata: invalid gps coordinates in P3200004.JPG (exif)\n </denchmark-code>\n \n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "nschermer", "commentT": "2020-12-23T19:16:14Z", "comment_text": "\n \t\tExcellent, thanks for reporting & testing! \ud83c\udf84\n \t\t"}}}, "commit": {"commit_id": "837fc495f9e90881f8ba7e5c733f5cdaf995f1ad", "commit_author": "Michael Mayer", "commitT": "2020-12-23 18:43:52+01:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.9512195121951219", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\meta\\exif.go", "file_new_name": "internal\\meta\\exif.go", "file_complexity": {"file_NLOC": "233", "file_CCN": "84", "file_NToken": "1895"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "89,90,91,92,93,94", "deleted_lines": "89,93,94,95", "method_info": {"method_name": "Exif", "method_params": "string,FileFormat", "method_startline": "48", "method_endline": "295", "method_complexity": {"method_NLOC": "195", "method_CCN": "77", "method_NToken": "1708", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "internal\\meta\\exif_test.go", "file_new_name": "internal\\meta\\exif_test.go", "file_complexity": {"file_NLOC": "362", "file_CCN": "40", "file_NToken": "3918"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461", "deleted_lines": null, "method_info": {"method_name": "", "method_params": "", "method_startline": "442", "method_endline": "461", "method_complexity": {"method_NLOC": "16", "method_CCN": "2", "method_NToken": "163", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461", "deleted_lines": null, "method_info": {"method_name": "TestExif", "method_params": "T", "method_startline": "10", "method_endline": "462", "method_complexity": {"method_NLOC": "21", "method_CCN": "1", "method_NToken": "163", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "internal\\meta\\json_test.go", "file_new_name": "internal\\meta\\json_test.go", "file_complexity": {"file_NLOC": "545", "file_CCN": "60", "file_NToken": "5960"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670", "deleted_lines": null, "method_info": {"method_name": "", "method_params": "", "method_startline": "648", "method_endline": "670", "method_complexity": {"method_NLOC": "21", "method_CCN": "2", "method_NToken": "239", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670", "deleted_lines": null, "method_info": {"method_name": "TestJSON", "method_params": "T", "method_startline": "10", "method_endline": "671", "method_complexity": {"method_NLOC": "31", "method_CCN": "1", "method_NToken": "243", "method_nesting_level": "0"}}}}}, "file_3": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "internal\\meta\\testdata\\snow.jpg", "file_new_name": "internal\\meta\\testdata\\snow.jpg", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_4": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "internal\\meta\\testdata\\snow.json", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}}}}