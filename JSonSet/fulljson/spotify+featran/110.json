{"BR": {"BR_id": "110", "BR_author": "richwhitjr", "BRopenT": "2018-04-24T18:54:41Z", "BRcloseT": "2018-04-30T20:51:54Z", "BR_text": {"BRsummary": "NPE on TensorFlowFeatureBuilder within Scio", "BRdescription": "\n If scio is upgraded to the current version of featran and the tf tests are run sbt \"project scio-tensorflow\" test you see the following error\n <denchmark-code>[info] FeatureSpecJob\n [info] - should work *** FAILED ***\n [info]   org.apache.beam.sdk.Pipeline$PipelineExecutionException: java.lang.NullPointerException\n [info]   at org.apache.beam.runners.direct.DirectRunner$DirectPipelineResult.waitUntilFinish(DirectRunner.java:342)\n [info]   at org.apache.beam.runners.direct.DirectRunner$DirectPipelineResult.waitUntilFinish(DirectRunner.java:312)\n [info]   at org.apache.beam.runners.direct.DirectRunner.run(DirectRunner.java:206)\n [info]   at org.apache.beam.runners.direct.DirectRunner.run(DirectRunner.java:62)\n [info]   at org.apache.beam.sdk.Pipeline.run(Pipeline.java:311)\n [info]   at org.apache.beam.sdk.testing.TestPipeline.run(TestPipeline.java:353)\n [info]   at org.apache.beam.sdk.testing.TestPipeline.run(TestPipeline.java:335)\n [info]   at com.spotify.scio.ScioContext$$anonfun$close$1.apply(ScioContext.scala:369)\n [info]   at com.spotify.scio.ScioContext$$anonfun$close$1.apply(ScioContext.scala:354)\n [info]   at com.spotify.scio.ScioContext.requireNotClosed(ScioContext.scala:419)\n [info]   ...\n [info]   Cause: java.lang.NullPointerException:\n [info]   at com.spotify.featran.tensorflow.package$TensorFlowFeatureBuilder.init(package.scala:28)\n [info]   at com.spotify.featran.CrossingFeatureBuilder.init(CrossingFeatureBuilder.scala:90)\n [info]   at com.spotify.featran.FeatureSet.featureValues(FeatureSpec.scala:300)\n [info]   at com.spotify.featran.FeatureExtractor.$anonfun$featureResults$1(FeatureExtractor.scala:96)\n [info]   at com.spotify.scio.util.Functions$$anon$7.processElement(Functions.scala:145)\n [info]   ...\n [info] MultiSpecJob\n [info] - should work *** FAILED ***\n [info]   org.apache.beam.sdk.Pipeline$PipelineExecutionException: java.lang.NullPointerException\n [info]   at org.apache.beam.runners.direct.DirectRunner$DirectPipelineResult.waitUntilFinish(DirectRunner.java:342)\n [info]   at org.apache.beam.runners.direct.DirectRunner$DirectPipelineResult.waitUntilFinish(DirectRunner.java:312)\n [info]   at org.apache.beam.runners.direct.DirectRunner.run(DirectRunner.java:206)\n [info]   at org.apache.beam.runners.direct.DirectRunner.run(DirectRunner.java:62)\n [info]   at org.apache.beam.sdk.Pipeline.run(Pipeline.java:311)\n [info]   at org.apache.beam.sdk.testing.TestPipeline.run(TestPipeline.java:353)\n [info]   at org.apache.beam.sdk.testing.TestPipeline.run(TestPipeline.java:335)\n [info]   at com.spotify.scio.ScioContext$$anonfun$close$1.apply(ScioContext.scala:369)\n [info]   at com.spotify.scio.ScioContext$$anonfun$close$1.apply(ScioContext.scala:354)\n [info]   at com.spotify.scio.ScioContext.requireNotClosed(ScioContext.scala:419)\n [info]   ...\n [info]   Cause: java.lang.NullPointerException:\n [info]   at com.spotify.featran.tensorflow.package$TensorFlowFeatureBuilder.init(package.scala:28)\n [info]   at com.spotify.featran.CrossingFeatureBuilder.init(CrossingFeatureBuilder.scala:90)\n [info]   at com.spotify.featran.MultiFeatureSet.multiFeatureValues(FeatureSpec.scala:417)\n [info]   at com.spotify.featran.MultiFeatureExtractor.$anonfun$featureResults$1(MultiFeatureExtractor.scala:73)\n [info]   at com.spotify.scio.util.Functions$$anon$7.processElement(Functions.scala:145)\n [info]   ...\n </denchmark-code>\n \n Best current guess is that something is causing the underlying Features.Builder to get created and then needs serialization which doesn't happen because of the transient annotation.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "richwhitjr", "commentT": "2018-04-24T20:23:53Z", "comment_text": "\n \t\tPossibly related to <denchmark-link:https://github.com/spotify/featran/pull/105>#105</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "richwhitjr", "commentT": "2018-04-24T21:13:38Z", "comment_text": "\n \t\tConfirmed that this fails on an internal job also, not just in the unit test.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "richwhitjr", "commentT": "2018-04-24T21:17:35Z", "comment_text": "\n \t\tLooks like tensorflow is a small blind spot in the unit tests.  Because we don't want to introduce the TF dependency to each data tool we don't explicitly test the serialization of tensorflow builders.\n \t\t"}}}, "commit": {"commit_id": "168b1ddaa40f489061e176bc62ffda560d819a9b", "commit_author": "Neville Li", "commitT": "2018-04-30 16:51:51-04:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "build.sbt", "file_new_name": "build.sbt", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "288,289,290,291,312,313,314,315", "deleted_lines": "288,309"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "core\\src\\test\\scala\\com\\spotify\\featran\\FeatureBuilderSpec.scala", "file_new_name": "core\\src\\test\\scala\\com\\spotify\\featran\\FeatureBuilderSpec.scala", "file_complexity": {"file_NLOC": "95", "file_CCN": "0", "file_NToken": "1229"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "30,32", "deleted_lines": "30"}}}, "file_2": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "core\\src\\test\\scala\\com\\spotify\\featran\\SerializableUtils.scala", "file_complexity": {"file_NLOC": "17", "file_CCN": "2", "file_NToken": "142"}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\src\\main\\scala\\com\\spotify\\featran\\tensorflow\\package.scala", "file_new_name": "tensorflow\\src\\main\\scala\\com\\spotify\\featran\\tensorflow\\package.scala", "file_complexity": {"file_NLOC": "28", "file_CCN": "5", "file_NToken": "227"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "28,29,30,31,32,33", "deleted_lines": "28", "method_info": {"method_name": "init", "method_params": "Int", "method_startline": "28", "method_endline": "34", "method_complexity": {"method_NLOC": "7", "method_CCN": "2", "method_NToken": "35", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\src\\test\\scala\\com\\spotify\\featran\\tensorflow\\TensorFlowFeatureBuilderSpec.scala", "file_new_name": "tensorflow\\src\\test\\scala\\com\\spotify\\featran\\tensorflow\\TensorFlowFeatureBuilderSpec.scala", "file_complexity": {"file_NLOC": "31", "file_CCN": "0", "file_NToken": "337"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "20,30", "deleted_lines": "20,30"}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "xgboost\\src\\test\\scala\\com\\spotify\\featran\\xgboost\\XGBoostFeatureBuilderSpec.scala", "file_new_name": "xgboost\\src\\test\\scala\\com\\spotify\\featran\\xgboost\\XGBoostFeatureBuilderSpec.scala", "file_complexity": {"file_NLOC": "45", "file_CCN": "0", "file_NToken": "622"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "20,31,34", "deleted_lines": "20,31"}}}}}}