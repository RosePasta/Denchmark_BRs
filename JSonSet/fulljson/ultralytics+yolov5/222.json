{"BR": {"BR_id": "222", "BR_author": "NacirB", "BRopenT": "2020-06-28T15:10:37Z", "BRcloseT": "2020-06-29T19:45:33Z", "BR_text": {"BRsummary": "KeyError: \"./weights/yolov5s.pt is not compatible with ./models/yolov5s.yaml. Specify --weights '' or specify a --cfg compatible with ./weights/yolov5s.pt.\"", "BRdescription": "\n I'm training yolov5x to predict one class.\n I created a custom yolo5x.yaml where nc == 1. And I want to train my model using pretrained coco weights.\n And When I load coco pretrained weights like this : --weight yolov5x.pt, I receive an error saying :  yolov5x.pt is not compatible with yolov5x.yaml.\n How can I load pretrained weights  ? and how to fix this issue ?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "NacirB", "commentT": "2020-06-28T15:11:19Z", "comment_text": "\n \t\tHello <denchmark-link:https://github.com/NacirB>@NacirB</denchmark-link>\n , thank you for your interest in our work! Please visit our <denchmark-link:https://github.com/ultralytics/yolov5/wiki/Train-Custom-Data>Custom Training Tutorial</denchmark-link>\n  to get started, and see our <denchmark-link:https://github.com/ultralytics/yolov5/blob/master/tutorial.ipynb>Jupyter Notebook</denchmark-link>\n  <denchmark-link:https://colab.research.google.com/github/ultralytics/yolov5/blob/master/tutorial.ipynb></denchmark-link>\n , <denchmark-link:https://hub.docker.com/r/ultralytics/yolov5>Docker Image</denchmark-link>\n , and <denchmark-link:https://github.com/ultralytics/yolov5/wiki/GCP-Quickstart>Google Cloud Quickstart Guide</denchmark-link>\n  for example environments.\n If this is a bug report, please provide screenshots and minimum viable code to reproduce your issue, otherwise we can not help you.\n If this is a custom model or data training question, please note that Ultralytics does not provide free personal support. As a leader in vision ML and AI, we do offer professional consulting, from simple expert advice up to delivery of fully customized, end-to-end production solutions for our clients, such as:\n \n Cloud-based AI systems operating on hundreds of HD video streams in realtime.\n Edge AI integrated into custom iOS and Android apps for realtime 30 FPS video inference.\n Custom data training, hyperparameter evolution, and model exportation to any destination.\n \n For more information please visit <denchmark-link:https://www.ultralytics.com>https://www.ultralytics.com</denchmark-link>\n .\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "NacirB", "commentT": "2020-06-28T23:00:45Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/NacirB>@NacirB</denchmark-link>\n  thanks for the bug report. Do you see this error with other models as well or only v5x?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "NacirB", "commentT": "2020-06-29T06:54:31Z", "comment_text": "\n \t\tI encounter this error with model yolov5s.pt when I'm load yolov5s.pt to train with only  one class.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "NacirB", "commentT": "2020-06-29T07:39:13Z", "comment_text": "\n \t\tTraceback (most recent call last):\n File \"train.py\", line 117, in train\n ckpt['model'] = {k: v for k, v in ckpt['model'].float().state_dict().items()\n File \"train.py\", line 118, in \n if model.state_dict()[k].shape == v.shape}  # to FP32, filter\n KeyError: 'model.2.cv2.conv.weight'\n The above exception was the direct cause of the following exception:\n Traceback (most recent call last):\n File \"train.py\", line 383, in \n train(hyp)\n File \"train.py\", line 123, in train\n raise KeyError(s) from e\n KeyError: \"./weights/yolov5s.pt is not compatible with ./models/yolov5s.yaml. Specify --weights '' or specify a --cfg compatible with ./weights/yolov5s.pt.\"\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "NacirB", "commentT": "2020-06-29T07:47:17Z", "comment_text": "\n \t\tIs it the same problem as here? <denchmark-link:https://github.com/ultralytics/yolov5/issues/203>#203</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "NacirB", "commentT": "2020-06-29T07:49:57Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/glenn-jocher>@glenn-jocher</denchmark-link>\n  I think it would be extremely helpful to enable transfer learning with any nc\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "NacirB", "commentT": "2020-06-29T08:01:18Z", "comment_text": "\n \t\tit works when i add code 'k in model.state_dict()'  in  train.py  about  line 118.\n ckpt['model'] = {k: v for k, v in ckpt['model'].float().state_dict().items()\n if k in model.state_dict() and model.state_dict()[k].shape == v.shape}\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "NacirB", "commentT": "2020-06-29T16:42:07Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/batrlatom>@batrlatom</denchmark-link>\n  <denchmark-link:https://github.com/wuyunxiangwyx>@wuyunxiangwyx</denchmark-link>\n  you should be able to load pretrained weights into a model.yaml configured for any class count. If this is not working there may be a bug, I'll check it out.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "NacirB", "commentT": "2020-06-29T16:53:17Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/batrlatom>@batrlatom</denchmark-link>\n  <denchmark-link:https://github.com/wuyunxiangwyx>@wuyunxiangwyx</denchmark-link>\n  I tested the code with yolov5s on a 1 class dataset and on a 4 class dataset, and everything works correctly. Ah, I think I know what the problem is:\n Model *.pt and *.yaml files are updated frequently in this repo, so if your repo downloaded an older model and you are trying to train with a recent version of the repo, it's possible your new *.yaml is incompatible with the older *.pt file you have.\n To fix this, delete all official pretrained models from your repo and try your command again. The newest version of the models will always be downloaded and the problem should be fixed.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "NacirB", "commentT": "2020-06-29T17:33:21Z", "comment_text": "\n \t\tIt works when we download the new files.\n Thanks.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "NacirB", "commentT": "2020-06-29T18:47:33Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/NacirB>@NacirB</denchmark-link>\n  ok got it. I may need to add some logic to detect out of date model.pt files, but this is quite complicated, as each model would require an internal version number which would need to be compared to a global deprecation list probably. I think I will simply update the error message to recommend that all current models be deleted.\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "NacirB", "commentT": "2020-06-29T19:19:30Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/glenn-jocher>@glenn-jocher</denchmark-link>\n   Yeah I think that an error message is enough to inform people about changes.\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "NacirB", "commentT": "2020-06-29T19:23:48Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/NacirB>@NacirB</denchmark-link>\n  can you help with me this?? Too much urgent. Thanks in advance.\n <denchmark-link:https://github.com/ultralytics/yolov5/issues/221>#221</denchmark-link>\n \n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "NacirB", "commentT": "2020-06-29T19:45:37Z", "comment_text": "\n \t\tAll done! Hope this helps in the future.\n \t\t"}, "comments_14": {"comment_id": 15, "comment_author": "NacirB", "commentT": "2020-06-30T00:24:44Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/AshutoshAJ>@AshutoshAJ</denchmark-link>\n   you only need to donwload the right yolov5x.yaml file which you can find it <denchmark-link:https://drive.google.com/file/d/1v0EQsEvH52tTI0oQNGnGIj4zUv9U1_ir/view>here</denchmark-link>\n \n \t\t"}, "comments_15": {"comment_id": 16, "comment_author": "NacirB", "commentT": "2020-07-06T14:34:29Z", "comment_text": "\n \t\ttrust me, if you copy your code to another machine, you will get same error.\n however, it runs normally on the original machine. That's werid!\n change nothing, just different machine. one runs ok, one not.\n \t\t"}, "comments_16": {"comment_id": 17, "comment_author": "NacirB", "commentT": "2020-07-06T17:22:36Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/hktxt>@hktxt</denchmark-link>\n  you should delete any incompatible weights as they may be out of date, it will download the latest only if it does not find any on your system.\n \t\t"}, "comments_17": {"comment_id": 18, "comment_author": "NacirB", "commentT": "2020-07-28T19:47:33Z", "comment_text": "\n \t\tjust ran the code today , using all the latest file .Still facing the same issue also the class has been modified to nc : 1, ? Please suggest the fix\n \t\t"}, "comments_18": {"comment_id": 19, "comment_author": "NacirB", "commentT": "2020-07-28T19:49:35Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/sumanttyagi>@sumanttyagi</denchmark-link>\n  training currently operates correctly. Suggest you use the latest code in a reproducible environment, and also delete any old weights you may have.\n <denchmark-h:h2>Environment</denchmark-h>\n \n YOLOv5 may be run in any of the following up-to-date verified environments (with all dependencies including <denchmark-link:https://developer.nvidia.com/cuda>CUDA</denchmark-link>\n /<denchmark-link:https://developer.nvidia.com/cudnn>CUDNN</denchmark-link>\n , <denchmark-link:https://www.python.org/>Python</denchmark-link>\n  and <denchmark-link:https://pytorch.org/>PyTorch</denchmark-link>\n  preinstalled):\n \n Google Colab Notebook with free GPU: \n Kaggle Notebook with free GPU: https://www.kaggle.com/ultralytics/yolov5\n Google Cloud Deep Learning VM. See GCP Quickstart Guide\n Docker Image https://hub.docker.com/r/ultralytics/yolov5. See Docker Quickstart Guide \n \n \t\t"}, "comments_19": {"comment_id": 20, "comment_author": "NacirB", "commentT": "2020-07-28T20:01:57Z", "comment_text": "\n \t\t\n @sumanttyagi training currently operates correctly. Suggest you use the latest code in a reproducible environment, and also delete any old weights you may have.\n Environment\n YOLOv5 may be run in any of the following up-to-date verified environments (with all dependencies including CUDA/CUDNN, Python and PyTorch preinstalled):\n \n Google Colab Notebook with free GPU: \n Kaggle Notebook with free GPU: https://www.kaggle.com/ultralytics/yolov5\n Google Cloud Deep Learning VM. See GCP Quickstart Guide\n Docker Image https://hub.docker.com/r/ultralytics/yolov5. See Docker Quickstart Guide \n \n \n I have used both the weights for model name yolo5s.yaml & yolo5x.yaml both is giving similar error eyError: \"yolov5/weights/yolov5s.pt is not compatible with yolov5/models/yolov5s.yaml. This may be due to model differences or yolov5/weights/yolov5s.pt may be out of date. Please delete or update yolov5/weights/yolov5s.pt and try again, or use --weights '' to train from scratch.\"\n CPU times: user 38.2 ms, sys: 10.3 ms, total: 48.5 ms\n Wall time: 10.2 s\n , files i am able to run from scratch but not with coco weight ?\n \n @sumanttyagi training currently operates correctly. Suggest you use the latest code in a reproducible environment, and also delete any old weights you may have.\n Environment\n YOLOv5 may be run in any of the following up-to-date verified environments (with all dependencies including CUDA/CUDNN, Python and PyTorch preinstalled):\n \n Google Colab Notebook with free GPU: \n Kaggle Notebook with free GPU: https://www.kaggle.com/ultralytics/yolov5\n Google Cloud Deep Learning VM. See GCP Quickstart Guide\n Docker Image https://hub.docker.com/r/ultralytics/yolov5. See Docker Quickstart Guide \n \n \n Just checked the information provide by you it is working ........Happy Learning\n \t\t"}}}, "commit": {"commit_id": "b203c9b7ffe89ae1b9182dc9516f627153fdeeac", "commit_author": "Glenn Jocher", "commitT": "2020-06-29 12:45:25-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "train.py", "file_new_name": "train.py", "file_complexity": {"file_NLOC": "311", "file_CCN": "64", "file_NToken": "3365"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "121,122,123", "deleted_lines": "121,122", "method_info": {"method_name": "train", "method_params": "hyp", "method_startline": "62", "method_endline": "349", "method_complexity": {"method_NLOC": "195", "method_CCN": "64", "method_NToken": "2140", "method_nesting_level": "0"}}}}}}}}