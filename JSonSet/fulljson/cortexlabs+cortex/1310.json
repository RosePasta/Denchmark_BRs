{"BR": {"BR_id": "1310", "BR_author": "RobertLucian", "BRopenT": "2020-08-27T18:17:23Z", "BRcloseT": "2020-09-01T19:52:41Z", "BR_text": {"BRsummary": "Fix scalar and no-rank/no-shape tensor validation when using the TensorFlow predictor", "BRdescription": "\n <denchmark-h:h4>Description</denchmark-h>\n \n 2 properties of a tensor (in TensorFlow) are the rank and shape. Right now, when using the TensorFlow predictor, only the 2 following kinds of tensors are supported:\n \n Tensors with known rank and shape. Such as (3, 224, 224).\n Tensors with known rank and unknown shape. Such as (3, -1, -1).\n \n <denchmark-h:h4>Reproduce</denchmark-h>\n \n When tensors have the following properties, the validation will fail, when in reality, it shouldn't:\n \n Tensors with no rank and empty shape - for scalars. Such as ().\n Tensors with unknown rank and shape. Such as (-1, -1, -1, ...).\n \n When an input tensor has the above properties, the following error pops up the logs cortex logs <api-name>.\n <denchmark-code>Traceback (most recent call last):\n File \"/src/cortex/serve/serve.py\", line 282, in start_fn\n tf_serving_host=tf_serving_host, tf_serving_port=tf_serving_port\n File \"/src/cortex/lib/type/predictor.py\", line 72, in initialize_client\n client = TensorFlowClient(tf_serving_address, self.models)\n File \"/src/cortex/lib/client/tensorflow.py\", line 48, in init\n self._signatures, get_model_signature_map(models)\n File \"/src/cortex/lib/client/tensorflow.py\", line 186, in extract_signatures\n signature_defs[model_name], signature_keys[model_name], model_name,\n File \"/src/cortex/lib/client/tensorflow.py\", line 246, in extract_signature\n \"shape\": [int(dim[\"size\"]) for dim in input_metadata[\"tensorShape\"][\"dim\"]],\n KeyError: 'dim'\n </denchmark-code>\n \n <denchmark-h:h4>Additional</denchmark-h>\n \n References that show that no-rank/no-shape and scalar tensors do indeed exist and are used:\n \n The first 2 paragraphs from https://pgaleone.eu/tensorflow/2018/07/28/understanding-tensorflow-tensors-shape-static-dynamic/.\n https://www.tensorflow.org/guide/tensor\n \n \t"}, "comments": {}}, "commit": {"commit_id": "7c2b5b07f9dbf9bf56def8a6e3a60763e271bd39", "commit_author": "Robert Lucian Chiriac", "commitT": "2020-09-01 22:52:40+03:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "0.21621621621621623"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cli\\cmd\\lib_realtime_apis.go", "file_new_name": "cli\\cmd\\lib_realtime_apis.go", "file_complexity": {"file_NLOC": "286", "file_CCN": "59", "file_NToken": "1887"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "259,260,261,262,263,264,265,266,267,272", "deleted_lines": "263", "method_info": {"method_name": "describeModelInput", "method_params": "Status,string", "method_startline": "235", "method_endline": "296", "method_complexity": {"method_NLOC": "56", "method_CCN": "13", "method_NToken": "330", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pkg\\workloads\\cortex\\lib\\client\\tensorflow.py", "file_new_name": "pkg\\workloads\\cortex\\lib\\client\\tensorflow.py", "file_complexity": {"file_NLOC": "244", "file_CCN": "43", "file_NToken": "1459"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "282,283,284,285,286,287,288,289,290,291,292,293,294,302,303,304,305,306,307,308,309,310,311,312,313", "deleted_lines": null, "method_info": {"method_name": "create_prediction_request", "method_params": "signature_def,signature_key,model_name,model_input", "method_startline": "276", "method_endline": "315", "method_complexity": {"method_NLOC": "33", "method_CCN": "8", "method_NToken": "255", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,270", "deleted_lines": "249,261,262,263,271,272,273", "method_info": {"method_name": "extract_signature", "method_params": "signature_def,signature_key,model_name", "method_startline": "196", "method_endline": "273", "method_complexity": {"method_NLOC": "64", "method_CCN": "14", "method_NToken": "350", "method_nesting_level": "0"}}}}}}}}