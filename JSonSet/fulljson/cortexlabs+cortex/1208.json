{"BR": {"BR_id": "1208", "BR_author": "MrRace", "BRopenT": "2020-07-07T11:36:43Z", "BRcloseT": "2020-07-17T12:26:27Z", "BR_text": {"BRsummary": "Bad request is returning 500 status code instead of 400", "BRdescription": "\n \n When post a bad request that should be a json, how can I define the response for the client\uff1f It seems just reply \"500 Internal Server Error\" now.  When the client post a request that is not  json format, how can I tell the client with the response?\n If I do not set the -H \"Content-Type: application/json\", but the request data is  standard json format, the payload in the server is empty.  I just print the payload in the predict :\n \n <denchmark-code>        print(\"payload type=\", type(payload))\n         print(\"payload=\", payload)\n </denchmark-code>\n \n the print result are below:\n <denchmark-code>payload type= starlette.datastructures.FormData\n payload= FormData([]) # it is empty, why?\n </denchmark-code>\n \n why the body get by the server is empty?\n Thanks a lot!\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "MrRace", "commentT": "2020-07-08T15:54:51Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/MrRace>@MrRace</denchmark-link>\n  thank you a lot for reporting this. Indeed, this doesn't appear to be the right behavior for the webserver:\n \n When a post request with a malformed JSON is made, a 400 error code should be returned. Instead, it gets a 500.\n When the content-type is not set (i.e.\"Content-Type: \"), your payload parameter should be a bytes object.\n \n Also, when the user doesn't set the content-type for a curl request, curl will automatically set it to . This can explain why you are getting a  object. I presume you were using the  utility for this. Check this out:\n <denchmark-link:https://stackoverflow.com/questions/37718308/what-is-default-header-content-type-for-http-post-method-in-curl-form>https://stackoverflow.com/questions/37718308/what-is-default-header-content-type-for-http-post-method-in-curl-form</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "MrRace", "commentT": "2020-07-08T17:07:47Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/MrRace>@MrRace</denchmark-link>\n  we've created PR <denchmark-link:https://github.com/cortexlabs/cortex/pull/1212>#1212</denchmark-link>\n  to address this problem.\n \t\t"}}}, "commit": {"commit_id": "0ac92c70ed678fd832c1ef50559d56e1d01d9188", "commit_author": "Robert Lucian Chiriac", "commitT": "2020-07-17 15:26:26+03:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\deployments\\predictors.md", "file_new_name": "docs\\deployments\\predictors.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "77,78,79,237,238,239,322,323,324,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426", "deleted_lines": "77,235,318"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pkg\\workloads\\cortex\\serve\\serve.py", "file_new_name": "pkg\\workloads\\cortex\\serve\\serve.py", "file_complexity": {"file_NLOC": "240", "file_CCN": "54", "file_NToken": "1542"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "163,164,165,166,168,169,170,171", "deleted_lines": "163,165", "method_info": {"method_name": "parse_payload", "method_params": "Request,call_next", "method_startline": "151", "method_endline": "175", "method_complexity": {"method_NLOC": "21", "method_CCN": "8", "method_NToken": "168", "method_nesting_level": "0"}}}}}}}}