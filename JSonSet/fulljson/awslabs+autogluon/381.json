{"BR": {"BR_id": "381", "BR_author": "austinmw", "BRopenT": "2020-03-25T20:04:32Z", "BRcloseT": "2020-03-30T21:33:08Z", "BR_text": {"BRsummary": "Issue with f1 eval_metric and net.evaluate_predictions", "BRdescription": "\n On a tabular binary classification problem (\"yes\"/\"no\" labels rather than 0/1). I'm able to run net.evaluate_predictions successfully with eval_metric='accuracy', but when I switch to eval_metric='f1', and rerun evaluate_predictions, I get an sklearn error:\n pos_label=1 is not a valid label: array(['no', 'yes'], dtype='<U3')\n Not sure if this needs to be fixed since I could probably just map no/yes to 0/1, but figured I'd mention it.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "austinmw", "commentT": "2020-03-25T20:10:36Z", "comment_text": "\n \t\tThis is likely because evaluate_predictions takes in the prediction values after they were converted to the external user representation, but does not convert them to the internal representation before doing evaluations. This should be fixed by converting the inputs to internal representation through self._learner.label_cleaner inside evaluate_predictions()\n <denchmark-link:https://github.com/jwmueller>@jwmueller</denchmark-link>\n  Can you take a look and see if you can fix?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "austinmw", "commentT": "2020-03-28T00:12:04Z", "comment_text": "\n \t\tThanks for pointing out this issue.  It should be fixed in this PR:  <denchmark-link:https://github.com/awslabs/autogluon/pull/387>#387</denchmark-link>\n \n Note that in the meantime before this PR is merged, you can just do the following as long as the label column is still present in your test_data Dataframe:\n <denchmark-code>predictor = task.fit(..., eval_metric = 'f1')\n f1 = predictor.evaluate(test_data)\n </denchmark-code>\n \n Please reopen this issue if you still have problems after the PR has been merged.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "austinmw", "commentT": "2020-03-30T21:33:08Z", "comment_text": "\n \t\tPR has been merged.\n \t\t"}}}, "commit": {"commit_id": "39f12264eed370d5165f12ecb4b1b686376fbdf5", "commit_author": "Jonas Mueller", "commitT": "2020-03-30 14:32:19-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CONTRIBUTING.md", "file_new_name": "CONTRIBUTING.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "59,61,64,65,66,67,68,69,70,71", "deleted_lines": "59,61,64"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "autogluon\\task\\tabular_prediction\\predictor.py", "file_new_name": "autogluon\\task\\tabular_prediction\\predictor.py", "file_complexity": {"file_NLOC": "202", "file_CCN": "45", "file_NToken": "1358"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "157,165", "deleted_lines": "164", "method_info": {"method_name": "evaluate_predictions", "method_params": "self,y_true,y_pred,silent,auxiliary_metrics,detailed_report", "method_startline": "155", "method_endline": "179", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "49", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "autogluon\\utils\\tabular\\ml\\learner\\abstract_learner.py", "file_new_name": "autogluon\\utils\\tabular\\ml\\learner\\abstract_learner.py", "file_complexity": {"file_NLOC": "492", "file_CCN": "135", "file_NToken": "4031"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "363,364,365,366,367,368,369,370,371,372,404,410,411,412,413,424,425,426,427,428", "deleted_lines": "363,395,401,412,413", "method_info": {"method_name": "evaluate", "method_params": "self,y_true,y_pred,silent,auxiliary_metrics,detailed_report,high_always_good", "method_startline": "348", "method_endline": "431", "method_complexity": {"method_NLOC": "59", "method_CCN": "19", "method_NToken": "453", "method_nesting_level": "1"}}}}}}}}