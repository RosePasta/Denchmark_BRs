{"BR": {"BR_id": "331", "BR_author": "sriniiyer", "BRopenT": "2017-10-11T01:26:44Z", "BRcloseT": "2017-10-11T15:26:12Z", "BR_text": {"BRsummary": "report_stats is being reset after every batch (ignoring report_every)", "BRdescription": "\n After every batch, report_stats = Statistics() is executed in Trainer.py, so its not aggregating the stats anymore. That line should be moved into report_func or something.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "sriniiyer", "commentT": "2017-10-11T03:27:18Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/JianyuZhan>@JianyuZhan</denchmark-link>\n  can you check this.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "sriniiyer", "commentT": "2017-10-11T05:16:50Z", "comment_text": "\n \t\tI checked the old code and it is the old behavior:\n <denchmark-code>          if i % opt.report_every == -1 % opt.report_every:\n                 report_stats.output(epoch, i+1, len(train),\n                                     total_stats.start_time)\n                 if opt.exp_host:\n                     report_stats.log(\"progress\", experiment, optim)\n                 report_stats = onmt.Loss.Statistics()\n </denchmark-code>\n \n It seems we did want to log a new stats data for every report, not aggregating them.\n Yes, it is weird, is this on purpose?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "sriniiyer", "commentT": "2017-10-11T05:18:40Z", "comment_text": "\n \t\tThe old code has report_stats = onmt.Loss.Statistics() inside the if condition. The new code has it outside.\n <denchmark-code>if report_func is not None:\n                 report_func(epoch, i, len(self.train_iter),\n                             total_stats.start_time, self.optim.lr,\n                             report_stats)\n                 report_stats = Statistics()\n </denchmark-code>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "sriniiyer", "commentT": "2017-10-11T05:22:05Z", "comment_text": "\n \t\tOh, right. I misunderstood what you mean by \"aggregate\" - it is aggregating every report, the new code doesn't.  I will fix it.\n \t\t"}}}, "commit": {"commit_id": "77a4792d757e067eae4c0fe67d8cebb94e481690", "commit_author": "Jianyu Zhan", "commitT": "2017-10-11 13:44:00+08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "onmt\\Trainer.py", "file_new_name": "onmt\\Trainer.py", "file_complexity": {"file_NLOC": "135", "file_CCN": "22", "file_NToken": "926"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "136,137,138", "deleted_lines": "136,137,138,139", "method_info": {"method_name": "train", "method_params": "self,epoch,report_func", "method_startline": "95", "method_endline": "140", "method_complexity": {"method_NLOC": "29", "method_CCN": "6", "method_NToken": "235", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "train.py", "file_new_name": "train.py", "file_complexity": {"file_NLOC": "183", "file_CCN": "32", "file_NToken": "1429"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "70,77,78,79,85,86,87", "deleted_lines": "76"}}}}}}