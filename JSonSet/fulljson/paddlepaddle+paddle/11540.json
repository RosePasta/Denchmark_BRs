{"BR": {"BR_id": "11540", "BR_author": "qingqing01", "BRopenT": "2018-06-18T11:13:38Z", "BRcloseT": "2018-06-19T13:42:41Z", "BR_text": {"BRsummary": "There is bug in concat CUDA kernel.", "BRdescription": "\n Add unit test in python/paddle/fluid/tests/unittests/test_concat_op.py to reproduce the bug:\n <denchmark-code>class TestConcatOp3(TestConcatOp):\n     def init_test_data(self):\n         self.x0 = np.random.random((1, 256, 170, 256)).astype('float32')\n         self.x1 = np.random.random((1, 128, 170, 256)).astype('float32')\n         self.x2 = np.random.random((1, 128, 170, 256)).astype('float32')\n         self.axis = 1\n     def test_check_grad(self):\n         pass\n </denchmark-code>\n \n The error is:\n <denchmark-code>220: terminate called after throwing an instance of 'paddle::platform::EnforceNotMet'\n 220:   what():  cudaFree{Host} failed in GPUAllocator::Free.: an illegal memory access was encountered at [/paddle/Paddle/paddle/fluid/memory/detail/system_allocator.cc:130]\n 220: PaddlePaddle Call Stacks:\n 220: 0       0x7fb228be5f9cp paddle::platform::EnforceNotMet::EnforceNotMet(std::__exception_ptr::exception_ptr, char const*, int) + 572\n 220: 1       0x7fb229d1aec8p paddle::memory::detail::GPUAllocator::Free(void*, unsigned long, unsigned long) + 328\n 220: 2       0x7fb229d178d7p paddle::memory::detail::BuddyAllocator::Free(void*) + 1191\n 220: 3       0x7fb229c3468bp paddle::framework::Tensor::PlaceholderImpl<paddle::platform::CUDAPlace>::~PlaceholderImpl() + 43\n 220: 4       0x7fb229aa3139p paddle::framework::Vector<int>::~Vector() + 217\n 220: 5       0x7fb229aa7f94p paddle::operators::math::ConcatFunctor<paddle::platform::CUDADeviceContext, float>::operator()(paddle::platform::CUDADeviceContext const&, std::vector<paddle::framework::Tensor, std::allocator<paddle::framework::Tensor> > const&, int, paddle::framework::Tensor*) + 2916\n 220: 6       0x7fb22987a2dep paddle::operators::ConcatKernel<paddle::platform::CUDADeviceContext, float>::Compute(paddle::framework::ExecutionContext const&) const + 958\n \n </denchmark-code>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "9c90dc9728813cbac15b9cf90d5bafb236056b3e", "commit_author": "qingqing01", "commitT": "2018-06-19 21:42:40+08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "paddle\\fluid\\operators\\math\\concat.cu", "file_new_name": "paddle\\fluid\\operators\\math\\concat.cu", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "30,31,33,34,37,42,73,74,76,77,80", "deleted_lines": "25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,49,50,51,52,54,55,92,93,94,96,97"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\paddle\\fluid\\tests\\unittests\\test_concat_op.py", "file_new_name": "python\\paddle\\fluid\\tests\\unittests\\test_concat_op.py", "file_complexity": {"file_NLOC": "40", "file_CCN": "7", "file_NToken": "442"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "55,56,57,58,59", "deleted_lines": null, "method_info": {"method_name": "init_test_data", "method_params": "self", "method_startline": "55", "method_endline": "59", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "85", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "61,62", "deleted_lines": null, "method_info": {"method_name": "test_check_grad", "method_params": "self", "method_startline": "61", "method_endline": "62", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "6", "method_nesting_level": "1"}}}}}}}}