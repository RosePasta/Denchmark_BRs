{"BR": {"BR_id": "302", "BR_author": "zuowang", "BRopenT": "2016-11-01T09:24:12Z", "BRcloseT": "2016-11-09T07:59:58Z", "BR_text": {"BRsummary": "Is it necessary to handle \"SIGFPE, Arithmetic exception\"", "BRdescription": "\n I got \"SIGFPE, Arithmetic exception.\" Is it necessary to handle such exception?\n <denchmark-code>Program received signal SIGFPE, Arithmetic exception.\n [Switching to Thread 0x7fffe9e38700 (LWP 1662)]\n __expf_finite () at ../sysdeps/x86_64/fpu/e_expf.S:132\n 132     ../sysdeps/x86_64/fpu/e_expf.S: No such file or directory.\n (gdb) bt\n #0  __expf_finite () at ../sysdeps/x86_64/fpu/e_expf.S:132\n #1  0x00007ffff6502a42 in __GI___expf (x=91.3864059)\n     at ../sysdeps/ieee754/flt-32/w_expf.c:26\n #2  0x00000000009c65de in std::exp (__x=91.3864059)\n     at /usr/include/c++/4.8/cmath:242\n #3  0x0000000000ca4b7b in paddle::binary::vTanh<float>::cpuOperator (\n     this=0x7fffe9e37920, a=@0x7fff804a0b48: -45.693203,\n     b=@0x7fff804a0b48: -45.693203)\n     at /root/paddle/paddle/math/MathFunctions.cpp:163\n #4  0x0000000000ca45d9 in hl_cpu_apply_binary_op<float, paddle::binary::vTanh<float>, false, false> (op=..., A_h=0x7fff80461040, B_h=0x7fff80461040, dimM=1,\n     dimN=102400, lda=102400, ldb=102400)\n     at /root/paddle/paddle/cuda/include/hl_cpu_matrix_kernel.cuh:49\n #5  0x0000000000ca3f18 in paddle::vTanh<float> (n=102400, a=0x7fff80461040,\n     r=0x7fff80461040) at /root/paddle/paddle/math/MathFunctions.cpp:166\n #6  0x0000000000c655d7 in paddle::CpuMatrix::tanh (this=0x7fff80460f68,\n     output=...) at /root/paddle/paddle/math/Matrix.cpp:3233\n #7  0x0000000000a52cc9 in paddle::tanhActivation::forward (this=0x3884170,\n     act=...)\n     at /root/paddle/paddle/gserver/activations/ActivationFunction.cpp:219\n #8  0x00000000009f82ce in paddle::Layer::forwardActivation (this=0x387d640)\n     at /root/paddle/paddle/gserver/layers/Layer.cpp:332\n #9  0x000000000098fd7a in paddle::FullyConnectedLayer::forward (\n     this=0x387d640, passType=paddle::enumeration_wrapper::PASS_TRAIN)\n     at /root/paddle/paddle/gserver/layers/FullyConnectedLayer.cpp:100\n #10 0x0000000000aaa70c in paddle::NeuralNetwork::forward (this=0x33bcdb0,\n     inArgs=std::vector of length 8, capacity 8 = {...}, outArgs=0x33b2a08,\n     passType=paddle::enumeration_wrapper::PASS_TRAIN)\n     at /root/paddle/paddle/gserver/gradientmachines/NeuralNetwork.cpp:242\n #11 0x0000000000ae75c0 in paddle::TrainerThread::forward (this=0x33b28e0)\n     at /root/paddle/paddle/gserver/gradientmachines/MultiGradientMachine.cpp:581\n #12 0x0000000000ae728e in paddle::TrainerThread::computeThread (this=0x33b28e0)\n     at /root/paddle/paddle/gserver/gradientmachines/MultiGradientMachine.cpp:519\n #13 0x0000000000ae6d79 in paddle::TrainerThread::__lambda46::operator() (\n     __closure=0x3885c60)\n     at /root/paddle/paddle/gserver/gradientmachines/MultiGradientMachine.cpp:465\n #14 0x0000000000aecf22 in std::_Bind_simple<paddle::TrainerThread::start()::__lambda46()>::_M_invoke<>(std::_Index_tuple<>) (this=0x3885c60)\n     at /usr/include/c++/4.8/functional:1732\n #15 0x0000000000aecc81 in std::_Bind_simple<paddle::TrainerThread::start()::__lambda46()>::operator()(void) (this=0x3885c60)\n     at /usr/include/c++/4.8/functional:1720\n #16 0x0000000000aecae2 in std::thread::_Impl<std::_Bind_simple<paddle::TrainerThread::start()::__lambda46()> >::_M_run(void) (this=0x3885c48)\n     at /usr/include/c++/4.8/thread:115\n #17 0x00007ffff6886a60 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n #18 0x00007ffff78c2184 in start_thread (arg=0x7fffe9e38700)\n     at pthread_create.c:312\n #19 0x00007ffff5fee37d in clone ()\n     at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "zuowang", "commentT": "2016-11-01T09:52:34Z", "comment_text": "\n \t\tThis exception is due to a floating point calculation overflow(exp(91.3864059)).\n The root cause may be data problems, or training algorithms, learning rate and other issues, resulting in a number of computing overflow scenarios.\n If you have mkl, maybe you can try to use mkl(and vTanh will call mkl's vsTanh).\n I'm not sure whether vsTanh will be an exception or return an inf result.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "zuowang", "commentT": "2016-11-01T22:54:07Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/hedaoyuan>@hedaoyuan</denchmark-link>\n  vTanh should be changed to handle large argument, similar to BaseMatrix::sigmoid. MKL implementation of tanh probably handles this kind of condition.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "zuowang", "commentT": "2016-11-04T10:23:56Z", "comment_text": "\n \t\tFollow <denchmark-link:https://github.com/emailweixu>@emailweixu</denchmark-link>\n 's comment fix this bug, and in this case, MKL does not generate an exception.\n <denchmark-link:https://github.com/zuowang>@zuowang</denchmark-link>\n  In the  file, there are some personal advice on how to handle this type of exception, hope to be useful to you.\n \t\t"}}}, "commit": {"commit_id": "a07da94939695986e2c15858f61199ca60c37fec", "commit_author": "hedaoyuan", "commitT": "2016-11-08 00:19:56-06:00", "commit_complexity": {"commit_NLOC": "0.7560975609756098", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "paddle\\cuda\\include\\hl_base.h", "file_new_name": "paddle\\cuda\\include\\hl_base.h", "file_complexity": {"file_NLOC": "86", "file_CCN": "0", "file_NToken": "300"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "212,213,214,215,216,217,218,219,220", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\cuda\\src\\hl_avx_functions.cc", "file_new_name": "paddle\\cuda\\src\\hl_avx_functions.cc", "file_complexity": {"file_NLOC": "48", "file_CCN": "8", "file_NToken": "364"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "41,43", "deleted_lines": null, "method_info": {"method_name": "hppl::tanh", "method_params": "a", "method_startline": "40", "method_endline": "48", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "81", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\cuda\\src\\hl_cpu_functions.cc", "file_new_name": "paddle\\cuda\\src\\hl_cpu_functions.cc", "file_complexity": {"file_NLOC": "33", "file_CCN": "13", "file_NToken": "254"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "33,34,35", "deleted_lines": "33", "method_info": {"method_name": "hppl::tanh", "method_params": "a", "method_startline": "32", "method_endline": "36", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "52", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\gserver\\tests\\test_LayerGrad.cpp", "file_new_name": "paddle\\gserver\\tests\\test_LayerGrad.cpp", "file_complexity": {"file_NLOC": "1092", "file_CCN": "141", "file_NToken": "8770"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "998", "deleted_lines": "998", "method_info": {"method_name": "TEST", "method_params": "Layer,LstmLayer", "method_startline": "994", "method_endline": "1019", "method_complexity": {"method_NLOC": "24", "method_CCN": "4", "method_NToken": "181", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\gserver\\tests\\test_RecurrentLayer.cpp", "file_new_name": "paddle\\gserver\\tests\\test_RecurrentLayer.cpp", "file_complexity": {"file_NLOC": "333", "file_CCN": "41", "file_NToken": "2662"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "372", "deleted_lines": "372", "method_info": {"method_name": "TEST", "method_params": "Layer,LstmLayer", "method_startline": "368", "method_endline": "398", "method_complexity": {"method_NLOC": "29", "method_CCN": "6", "method_NToken": "218", "method_nesting_level": "0"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "paddle\\math\\BaseMatrix.cu", "file_new_name": "paddle\\math\\BaseMatrix.cu", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "628,629,630,631", "deleted_lines": "628"}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "paddle\\math\\MathFunctions.cpp", "file_new_name": "paddle\\math\\MathFunctions.cpp", "file_complexity": {"file_NLOC": "178", "file_CCN": "35", "file_NToken": "2018"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "203,204,205,206", "deleted_lines": "203"}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "paddle\\math\\Matrix.cpp", "file_new_name": "paddle\\math\\Matrix.cpp", "file_complexity": {"file_NLOC": "3256", "file_CCN": "680", "file_NToken": "29812"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "3541,3542,3544", "method_info": {"method_name": "paddle::CpuMatrix::scaledTanh", "method_params": "output,p1,p2", "method_startline": "3525", "method_endline": "3550", "method_complexity": {"method_NLOC": "19", "method_CCN": "3", "method_NToken": "172", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "3474,3476", "method_info": {"method_name": "paddle::CpuMatrix::tanh", "method_params": "output", "method_startline": "3467", "method_endline": "3477", "method_complexity": {"method_NLOC": "11", "method_CCN": "1", "method_NToken": "93", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "3516,3518", "method_info": {"method_name": "paddle::CpuMatrix::softreluDerivative", "method_params": "output", "method_startline": "3504", "method_endline": "3523", "method_complexity": {"method_NLOC": "18", "method_CCN": "2", "method_NToken": "167", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": null, "deleted_lines": "3498,3501", "method_info": {"method_name": "paddle::CpuMatrix::softrelu", "method_params": "output", "method_startline": "3483", "method_endline": "3502", "method_complexity": {"method_NLOC": "20", "method_CCN": "4", "method_NToken": "149", "method_nesting_level": "1"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "paddle\\math\\tests\\CMakeLists.txt", "file_new_name": "paddle\\math\\tests\\CMakeLists.txt", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "16", "deleted_lines": null}}}, "file_9": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "paddle\\math\\tests\\test_FPException.cpp", "file_complexity": {"file_NLOC": "52", "file_CCN": "9", "file_NToken": "396"}}}}}