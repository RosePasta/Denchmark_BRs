{"BR": {"BR_id": "9388", "BR_author": "JiayiFeng", "BRopenT": "2018-03-26T16:50:40Z", "BRcloseT": "2018-03-29T16:44:59Z", "BR_text": {"BRsummary": "A bug in framework::Channel", "BRdescription": "\n \n Create a new channel whose capacity is 2.\n Send 2 data(0 and 1) into the new channel.\n Try to send the third data(3) to the channel. For the channel is full, the Send() function will be blocked.\n Receive() data from the channel with another thread. The first received data should be 0 in my understanding. However, in my test I found it's 3 in fact.\n \n In PR <denchmark-link:https://github.com/PaddlePaddle/Paddle/pull/9387>#9387</denchmark-link>\n  I did a few modifications in the  to help you replicate the bug:\n <denchmark-code>[ RUN      ] Channel.RecevingOrderEqualToSendingOrderWithBufferedChannel\n 97: /Users/baidu/Documents/git_workspace/Paddle/paddle/fluid/framework/channel_test.cc:52: Failure\n 97:       Expected: recv\n 97:       Which is: 2\n 97: To be equal to: i\n 97:       Which is: 0\n 97: /Users/baidu/Documents/git_workspace/Paddle/paddle/fluid/framework/channel_test.cc:52: Failure\n 97:       Expected: recv\n 97:       Which is: 3\n 97: To be equal to: i\n 97:       Which is: 1\n 97: /Users/baidu/Documents/git_workspace/Paddle/paddle/fluid/framework/channel_test.cc:52: Failure\n 97:       Expected: recv\n 97:       Which is: 4\n 97: To be equal to: i\n 97:       Which is: 2\n 97: /Users/baidu/Documents/git_workspace/Paddle/paddle/fluid/framework/channel_test.cc:52: Failure\n 97:       Expected: recv\n 97:       Which is: 0\n 97: To be equal to: i\n 97:       Which is: 3\n 97: /Users/baidu/Documents/git_workspace/Paddle/paddle/fluid/framework/channel_test.cc:52: Failure\n 97:       Expected: recv\n 97:       Which is: 1\n 97: To be equal to: i\n 97:       Which is: 4\n 97: [  FAILED  ] Channel.RecevingOrderEqualToSendingOrderWithBufferedChannel (408 ms)\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "JiayiFeng", "commentT": "2018-03-26T20:05:03Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/JiayiFeng>@JiayiFeng</denchmark-link>\n  . This is definitely a bug in the implementation. I am looking into it. Thank you for pointing this out\n \t\t"}}}, "commit": {"commit_id": "5f9da86ba562c543a623ff0d99f06bd2e935edb3", "commit_author": "Abhinav Arora", "commitT": "2018-03-29 09:44:58-07:00", "commit_complexity": {"commit_NLOC": "0.7391304347826086", "commit_CCN": "0.8260869565217391", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "paddle\\fluid\\framework\\channel_impl.h", "file_new_name": "paddle\\fluid\\framework\\channel_impl.h", "file_complexity": {"file_NLOC": "270", "file_CCN": "52", "file_NToken": "1935"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "204,205,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231", "deleted_lines": "204,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229", "method_info": {"method_name": "paddle::framework::ChannelImpl<T>::Receive", "method_params": "item", "method_startline": "192", "method_endline": "253", "method_complexity": {"method_NLOC": "38", "method_CCN": "8", "method_NToken": "278", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "90,91,92,93,94,95,96,97,98,99,100,101,102,103", "deleted_lines": null, "method_info": {"method_name": "paddle::framework::ChannelImpl::get_first_message", "method_params": "queue,action", "method_startline": "90", "method_endline": "103", "method_complexity": {"method_NLOC": "9", "method_CCN": "4", "method_NToken": "73", "method_nesting_level": "3"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "149,150,151,152,154,155,156,157,158", "deleted_lines": "135,136,137,138,139,140,141,142,143,145,146,147,148,149,150,151,152,158,159,160,161,162,163", "method_info": {"method_name": "paddle::framework::ChannelImpl<T>::Send", "method_params": "item", "method_startline": "135", "method_endline": "189", "method_complexity": {"method_NLOC": "40", "method_CCN": "6", "method_NToken": "230", "method_nesting_level": "2"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 7, "file_old_name": "paddle\\fluid\\framework\\channel_test.cc", "file_new_name": "paddle\\fluid\\framework\\channel_test.cc", "file_complexity": {"file_NLOC": "753", "file_CCN": "138", "file_NToken": "5246"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "190,191", "deleted_lines": "188,191", "method_info": {"method_name": "TEST", "method_params": "Channel,RecevingOrderEqualToSendingOrderWithUnBufferedChannel", "method_startline": "188", "method_endline": "191", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "26", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "39,42,47,48,49,56,57", "deleted_lines": "39,42,47,48,55", "method_info": {"method_name": "RecevingOrderEqualToSendingOrder", "method_params": "ch", "method_startline": "39", "method_endline": "57", "method_complexity": {"method_NLOC": "19", "method_CCN": "3", "method_NToken": "136", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "191,192,193,194", "deleted_lines": "191,193", "method_info": {"method_name": "TEST", "method_params": "Channel,RecevingOrderEqualToSendingOrderWithBufferedChannel", "method_startline": "191", "method_endline": "194", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "24", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "207,208,209,211", "deleted_lines": null, "method_info": {"method_name": "TEST", "method_params": "Channel,RecevingOrderEqualToSendingOrderWithBufferedChannel3", "method_startline": "207", "method_endline": "212", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "26", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "200,201,202,203,204", "deleted_lines": null, "method_info": {"method_name": "TEST", "method_params": "Channel,RecevingOrderEqualToSendingOrderWithBufferedChannel2", "method_startline": "200", "method_endline": "205", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "26", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "39,42,47,48,49,56,57", "deleted_lines": "39,42,47,48,55", "method_info": {"method_name": "RecevingOrderEqualToSendingOrder", "method_params": "ch,num_items", "method_startline": "39", "method_endline": "59", "method_complexity": {"method_NLOC": "21", "method_CCN": "3", "method_NToken": "171", "method_nesting_level": "0"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "193,194,195,196,197,198", "deleted_lines": "193", "method_info": {"method_name": "TEST", "method_params": "Channel,RecevingOrderEqualToSendingOrderWithBufferedChannel1", "method_startline": "193", "method_endline": "198", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "26", "method_nesting_level": "0"}}}}}}}}