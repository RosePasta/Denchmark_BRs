{"BR": {"BR_id": "8678", "BR_author": "Yancey1989", "BRopenT": "2018-03-01T08:48:43Z", "BRcloseT": "2018-03-09T08:41:12Z", "BR_text": {"BRsummary": "run dist demo word2vec failed", "BRdescription": "\n Start up 10 pservers + 10 trainers + turn on sparse update,  pserver would crash:\n server-1:\n I0301 08:39:03.283473 12305 executor.cc:134] CPUPlace Op(sgd), inputs:{Grad[fc_1.w_0@GRAD.block8[26, 2073]({})], LearningRate[tmp_9[1]({})], Param[fc_1.w_0.block8[26, 2073]({})]}, outputs:{ParamOut[fc_1.w_0.block8[26, 2073]({})]}.\n I0301 08:39:03.283483 12305 operator.cc:521] expected_kernel_key:data_type[float32]:data_layout[ANY_LAYOUT]:place[CPUPlace]:library_type[PLAIN]\n I0301 08:39:03.310343 12305 listen_and_serv_op.cc:117] received grad: shared_w@GRAD.block1.trainer_9\n *** Aborted at 1519893543 (unix time) try \"date -d @1519893543\" if you are using GNU date ***\n PC: @                0x0 (unknown)\n *** SIGSEGV (@0x0) received by PID 12305 (TID 0x7f4879419700) from PID 0; stack trace: ***\n     @     0x7f4878df3390 (unknown)\n     @     0x7f482da161e7 paddle::memory::detail::MetadataCache::load()\n     @     0x7f482da15c73 paddle::memory::detail::MemoryBlock::type()\n     @     0x7f482da150a1 paddle::memory::detail::BuddyAllocator::Free()\n     @     0x7f482da11060 paddle::memory::Free<>()\n     @     0x7f482d97321e paddle::framework::Tensor::PlaceholderImpl<>::~PlaceholderImpl()\n     @     0x7f482d979a26 std::_Sp_counted_base<>::_M_release()\n     @     0x7f482d97d27b paddle::framework::Tensor::mutable_data()\n     @     0x7f482e0e55ae paddle::framework::TensorFromStream()\n     @     0x7f482e0e0481 paddle::framework::DeserializeFromStream()\n     @     0x7f482e0c3b8b paddle::operators::detail::DeserializeFromMessage()\n     @     0x7f482e017ad1 paddle::operators::ListenAndServOp::RunImpl()\n     @     0x7f482e0772a8 paddle::framework::OperatorBase::Run()\n server-2:\n E0301 08:39:03.331059 12306 listen_and_serv_op.cc:139] run sub program error enforce numel() > 0 failed, 0 <= 0\n When calling this method, the Tensor's numel must be larger than zero. Please check Tensor::Resize has been called first. at [/paddle/paddle/fluid/framework/tensor_impl.h:123]\n PaddlePaddle Call Stacks:\n 0       0x7f98da6a876cp paddle::platform::EnforceNotMet::EnforceNotMet(std::__exception_ptr::exception_ptr, char const*, int) + 572\n 1       0x7f98da6ae521p paddle::framework::Tensor::mutable_data(boost::variant<paddle::platform::CUDAPlace, paddle::platform::CPUPlace, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_>, std::type_index) + 1233\n 2       0x7f98dad0fafbp paddle::operators::SumKernel<paddle::platform::CPUDeviceContext, float>::Compute(paddle::framework::ExecutionContext const&) const + 1323\n 3       0x7f98dadaa944p paddle::framework::OperatorWithKernel::RunImpl(paddle::framework::Scope const&, boost::variant<paddle::platform::CUDAPlace, paddle::platform::CPUPlace, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_> const&) const + 1556\n 4       0x7f98dada82a8p paddle::framework::OperatorBase::Run(paddle::framework::Scope const&, boost::variant<paddle::platform::CUDAPlace, paddle::platform::CPUPlace, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_> const&) + 72\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Yancey1989", "commentT": "2018-03-07T08:23:06Z", "comment_text": "\n \t\tUpdate progress:\n There are two bugs in this issue:\n \n \n As the logs server-2, if one of the pserver instances didn't receive any sparse vars, the GRAD var would not be initialized, we should deal with this situation.\n \n \n As the log server-1, looks like a memory bug, but I'm not sure, will follow it.\n \n \n \t\t"}}}, "commit": {"commit_id": "8468037918032f18229cd55f1521d5b7509ebf2a", "commit_author": "Yancey", "commitT": "2018-03-09 16:41:10+08:00", "commit_complexity": {"commit_NLOC": "0.4375", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "paddle\\fluid\\operators\\send_op.cc", "file_new_name": "paddle\\fluid\\operators\\send_op.cc", "file_complexity": {"file_NLOC": "115", "file_CCN": "13", "file_NToken": "837"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "27,28,35", "deleted_lines": "27,28,35", "method_info": {"method_name": "paddle::operators::IsVariableInitialized", "method_params": "scope,varname", "method_startline": "27", "method_endline": "42", "method_complexity": {"method_NLOC": "16", "method_CCN": "3", "method_NToken": "117", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "27,28,35", "deleted_lines": "27,28,35", "method_info": {"method_name": "paddle::operators::NeedSend", "method_params": "scope,varname", "method_startline": "27", "method_endline": "42", "method_complexity": {"method_NLOC": "16", "method_CCN": "3", "method_NToken": "119", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "70", "deleted_lines": "70", "method_info": {"method_name": "paddle::operators::SendOp::RunImpl", "method_params": "scope,place", "method_startline": "51", "method_endline": "92", "method_complexity": {"method_NLOC": "37", "method_CCN": "6", "method_NToken": "384", "method_nesting_level": "3"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\fluid\\operators\\sgd_op.cc", "file_new_name": "paddle\\fluid\\operators\\sgd_op.cc", "file_complexity": {"file_NLOC": "53", "file_CCN": "3", "file_NToken": "288"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "44,45,46,47,48,49", "deleted_lines": null, "method_info": {"method_name": "paddle::operators::SGDOp::GetExpectedKernelType", "method_params": "ctx", "method_startline": "44", "method_endline": "49", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "46", "method_nesting_level": "3"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\fluid\\operators\\sgd_op.h", "file_new_name": "paddle\\fluid\\operators\\sgd_op.h", "file_complexity": {"file_NLOC": "52", "file_CCN": "6", "file_NToken": "478"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "50,51,52,53,54,55,70,71,77", "deleted_lines": "63", "method_info": {"method_name": "paddle::operators::SGDOpKernel::Compute", "method_params": "ctx", "method_startline": "26", "method_endline": "81", "method_complexity": {"method_NLOC": "41", "method_CCN": "6", "method_NToken": "443", "method_nesting_level": "3"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "paddle\\fluid\\operators\\split_selected_rows_op.h", "file_new_name": "paddle\\fluid\\operators\\split_selected_rows_op.h", "file_complexity": {"file_NLOC": "75", "file_CCN": "13", "file_NToken": "711"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "52,53,56,57,59,64,66,67,68,80,85,86,87,92,93", "deleted_lines": "51,52,64,69,70,71,76", "method_info": {"method_name": "paddle::operators::SplitSelectedRowsOpKernel::Compute", "method_params": "ctx", "method_startline": "47", "method_endline": "102", "method_complexity": {"method_NLOC": "46", "method_CCN": "8", "method_NToken": "520", "method_nesting_level": "3"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "33,34,35,36,37,38,39,40,41", "deleted_lines": null, "method_info": {"method_name": "paddle::operators::ToAbsoluteSection", "method_params": "height_sections", "method_startline": "33", "method_endline": "42", "method_complexity": {"method_NLOC": "10", "method_CCN": "2", "method_NToken": "82", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "24,25,26,27,30,31,32,33", "deleted_lines": "24,25,26,27,28,30,32", "method_info": {"method_name": "paddle::operators::FindOutIdx", "method_params": "row,height_sections", "method_startline": "24", "method_endline": "33", "method_complexity": {"method_NLOC": "10", "method_CCN": "4", "method_NToken": "75", "method_nesting_level": "2"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "24,25,26,27,30,31", "deleted_lines": "24,25,26,27,28,30", "method_info": {"method_name": "paddle::operators::FindOutIdx", "method_params": "row,abs_sections", "method_startline": "24", "method_endline": "31", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "62", "method_nesting_level": "2"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\fluid\\operators\\sum_op.cc", "file_new_name": "paddle\\fluid\\operators\\sum_op.cc", "file_complexity": {"file_NLOC": "174", "file_CCN": "26", "file_NToken": "1313"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "79,80,81,82,83,84,85,86,87,88", "deleted_lines": "79,80,81,82", "method_info": {"method_name": "paddle::operators::SumOp::GetExpectedKernelType", "method_params": "ctx", "method_startline": "56", "method_endline": "103", "method_complexity": {"method_NLOC": "46", "method_CCN": "12", "method_NToken": "376", "method_nesting_level": "3"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddle\\fluid\\operators\\sum_op.h", "file_new_name": "paddle\\fluid\\operators\\sum_op.h", "file_complexity": {"file_NLOC": "132", "file_CCN": "26", "file_NToken": "1192"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "112,113,114,115,116,117,125", "deleted_lines": "119", "method_info": {"method_name": "paddle::operators::SumKernel::Compute", "method_params": "context", "method_startline": "32", "method_endline": "163", "method_complexity": {"method_NLOC": "113", "method_CCN": "26", "method_NToken": "1096", "method_nesting_level": "3"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "python\\paddle\\fluid\\tests\\unittests\\test_split_selected_rows_op.py", "file_new_name": "python\\paddle\\fluid\\tests\\unittests\\test_split_selected_rows_op.py", "file_complexity": {"file_NLOC": "86", "file_CCN": "10", "file_NToken": "791"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "104", "deleted_lines": "104", "method_info": {"method_name": "check_grad_with_place", "method_params": "self,place", "method_startline": "85", "method_endline": "126", "method_complexity": {"method_NLOC": "32", "method_CCN": "1", "method_NToken": "295", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "63,64", "deleted_lines": "63,64", "method_info": {"method_name": "check_with_place", "method_params": "self,place", "method_startline": "36", "method_endline": "83", "method_complexity": {"method_NLOC": "36", "method_CCN": "3", "method_NToken": "377", "method_nesting_level": "1"}}}}}}}}