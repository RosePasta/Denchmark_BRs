{"BR": {"BR_id": "282", "BR_author": "linrongyi", "BRopenT": "2016-10-28T03:40:15Z", "BRcloseT": "2016-11-08T07:35:57Z", "BR_text": {"BRsummary": "\u4e0d\u540c\u7f16\u8bd1\u73af\u5883\u7f16\u8bd1\u51fa\u6765\u7684paddle_trainer\u6027\u80fd\u5dee\u522b\u8f83\u5927", "BRdescription": "\n \u7528wangyanfei\u540c\u5b66\u7f16\u8bd1\u7684\u51fa\u6765\u7684paddle_trainer \u548c\u6211cmake\u51fa\u6765\u7684paddle_trainer\u8bad\u7ec3\u6027\u80fd\u5dee\u522b\u5f88\u5927\n \u76f8\u540c\u7684\u6570\u636e, \u4e00\u4e2apass:\n wangyanfei: 22s\n me: 35s\n \u53e6\u5916,  \u7f16\u8bd1\u51fa\u6765\u7684paddle_trainer\u7684\u5927\u5c0f\u4e5f\u5dee\u522b\u5f88\u5927\n me: 22M\n wangyanfei: 130MB\n trainer\u7684\u53c2\u6570\u4e3a\n ${TRAINER_BIN} --config=trainer_config.conf --save_dir=output --trainer_count=11 --parallel_thread_num=1 --use_old_updater=1 --use_gpu=0 --save_dir=./output --enable_grad_share=0 --dot_period=200 --log_period=2000 --num_passes=1\n \u6211\u7f16\u8bd1\u7684\u7248\u672c, \u5df2\u7ecf\u5f00\u542f\u4e86release\u9009\u9879, \u4f7f\u7528mkl lib\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "linrongyi", "commentT": "2016-10-28T03:51:04Z", "comment_text": "\n \t\tThat's probably the compiler option related issue. Later we will provide static bin and full auto-compile scripts to handle it.\n performance issues:\n \n -O3 enable.\n libraries linked\n specical instruction.\n etc.\n \n <denchmark-link:https://github.com/reyoung>@reyoung</denchmark-link>\n  be aware of this issues.\n related:\n <denchmark-link:https://github.com/PaddlePaddle/Paddle/issues/259>#259</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "linrongyi", "commentT": "2016-10-28T04:24:58Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/linrongyi>@linrongyi</denchmark-link>\n  see <denchmark-link:https://cmake.org/cmake/help/v3.0/variable/CMAKE_BUILD_TYPE.html>https://cmake.org/cmake/help/v3.0/variable/CMAKE_BUILD_TYPE.html</denchmark-link>\n \n Default, Paddle use -O2 -g, RelWithDebInfo.\n Set -D CMAKE_BUILD_TYPE=Release will set CFlags to -O3\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "linrongyi", "commentT": "2016-10-28T04:33:44Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/reyoung>@reyoung</denchmark-link>\n \n \"-D CMAKE_BUILD_TYPE\" was set to 'Release' when i was compiling.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "linrongyi", "commentT": "2016-10-28T04:34:07Z", "comment_text": "\n \t\tI remenber that  the performance gap comes from more than the -O3 option,  even with others that are not clear. <denchmark-link:https://github.com/reyoung>@reyoung</denchmark-link>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "linrongyi", "commentT": "2016-10-28T04:48:38Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/backyes>@backyes</denchmark-link>\n  \u6240\u4ee5\u7a76\u7adf\u662f\u4e3a\u5565\u6709\u8fd9\u4e48\u5927\u7684\u6027\u80fd\u5dee\u8ddd\u5462\uff1f\u5982\u679c\u4e24\u5468\u4e4b\u5185\u4f60\u6709\u65f6\u95f4\u641e\u5b9a\uff0c\u5c31\u5173\u8054\u5230 0.8.1\u4e0a\u5427\u3002\u6ca1\u6709\u7684\u8bdd\u5c31\u5173\u8054\u5230 0.8.2\u4e0a\u3002\u5982\u4f55\uff1f\n \u56e0\u4e3a\u5176\u5b9e\u73b0\u57280.8.1\u7684\u5f88\u591a\u4e8b\u60c5\u8fd8\u6ca1\u505a\u5b8c\u3002\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "linrongyi", "commentT": "2016-10-30T20:24:33Z", "comment_text": "\n \t\t\u89e3\u51b3\u95ee\u9898\u7684\u4e00\u4e2a\u57fa\u7840\u662f\u201c\u95ee\u9898\u53ef\u4ee5\u88ab\u590d\u73b0\u201d\u3002 <denchmark-link:https://github.com/linrongyi>@linrongyi</denchmark-link>\n  \u548c <denchmark-link:https://github.com/backyes>@backyes</denchmark-link>\n  \uff0c\u8bf7\u63cf\u8ff0\u4e00\u4e0b\u5982\u4f55\u590d\u73b0\u8fd9\u4e2a\u95ee\u9898\uff0c\u7136\u540e\u624d\u6709\u53ef\u80fd\u6709\u4eba\u5bf9\u89e3\u6cd5\u6709\u70b9\u611f\u89c9\uff0c\u6211\u4eec\u4e5f\u624d\u80fd\u6709\u9053\u7406\u5730\u628a\u8fd9\u4e2aissue\u53ef\u4ee5\u88ab\u5173\u8054\u5230\u67d0\u4e2amilestone\u3002\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "linrongyi", "commentT": "2016-10-31T04:12:01Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/wangkuiyi>@wangkuiyi</denchmark-link>\n  \u590d\u73b0\u65b9\u6cd5\u6d89\u53ca\u5185\u90e8\u7528\u6237\u73af\u5883\uff0c<denchmark-link:https://github.com/linrongyi>@linrongyi</denchmark-link>\n  \u65b9\u4fbf\u8bdd\uff0c\u8bf7\u5c06\u590d\u73b0\u65b9\u6cd5\u9002\u5f53\u516c\u5f00\u3002\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "linrongyi", "commentT": "2016-11-01T13:16:22Z", "comment_text": "\n \t\t\u5148\u8bf4\u4e00\u4e0b\u4eca\u5929\u7684\u53d1\u73b0.\n CPU\u8bad\u7ec3\u901f\u5ea6\u7684\u95ee\u9898, \u4eca\u5929\u53d1\u73b0\u5982\u679c\u7f16\u8bd1\u65f6\u5019\u628a-DWITH_GPU=OFF, \u4e5f\u5c31\u662f\u4e0d\u7f16\u8bd1GPU\u7248\u672c, CPU\u8bad\u7ec3\u5c31\u5f88\u5feb; \u5982\u679c-DWITH_GPU=ON, \u8bad\u7ec3CPU\u5c31\u4f1a\u6162\u5f88\u591a.\n \u5177\u4f53\u7684\u6307\u6807, 2827967\u6761protobuf\u683c\u5f0f\u7684\u4e8c\u8fdb\u5236\u8bad\u7ec3\u6570\u636e,\n \n -DWITH_GPU=ON, 27.s\n -DWITH_GPU=OFF, 16.9s\n \n \u901f\u5ea6\u5dee\u522b\u5f88\u5927.\n \u6211\u7528\u7684\u7248\u672c\u662fgithub\u6700\u65b0\u7684dev\u7248\u672c12945b2c9017c8, \u7f16\u8bd1\u547d\u4ee4\u662f\n <denchmark-code> cmake  \\\n           -DCMAKE_BUILD_TYPE=\"Release\" \\\n           -DWITH_RELEASE_G=ON \\\n           -DWITH_RDMA=$l_rdma \\\n           -DWITH_GPU=$l_gpu \\\n           -DWITH_DOC=OFF \\\n           -DWITH_SWIG_PY=OFF \\\n           -DWITH_PYTHON=OFF \\\n           -DMKL_ROOT=/home/aladdin/paddle_internal_release_tools/idl/paddle/thirdparties/mkl  \\\n           -DRDMA_ROOT=${DEP_HOME}/rdma \\\n           -DCUDNN_INCLUDE_DIR=/home/work/cudnn/cudnn_v5/cuda/include \\\n           -DCUDNN_LIBRARY=/home/work/cudnn/cudnn_v5/cuda/lib64 \\\n           -DWITH_GFLAGS=OFF \\\n           -DWITH_GLOG=ON \\\n           -DWITH_TESTING=OFF \\\n           -DCMAKE_INSTALL_PREFIX=$l_install_dir \\\n           ${SRC_ROOT}\n </denchmark-code>\n \n \u8bad\u7ec3\u7684\u547d\u4ee4\u662f\n <denchmark-code>${TRAINER_BIN} --config=trainer_config.conf --save_dir=output --trainer_count=11 --parallel_thread_num=1 --use_old_updater=1 --use_gpu=0 --save_dir=./output --enable_grad_share=0 --dot_period=200 --log_period=2000 --num_passes=1\n \n </denchmark-code>\n \n \u8fd9\u6837\u7684\u7ed3\u679c\u8868\u660e, \u5982\u679c\u8ffd\u6c42\u6027\u80fd\u7684\u8bdd, \u9700\u8981\u5355\u72ec\u7f16\u8bd1\u4e00\u4e2aCPU\u7684\u7248\u672c, \u603b\u89c9\u5f97\u6bd4\u8f83trick.\n \u7136\u800c, \u66fe\u7ecf\u53d1\u73b0\u8fc7WITH/WITHOUT CPU\u7684\u7f16\u8bd1\u7ed3\u679c\u5728CPU \u8bad\u7ec3\u4e0a\u5e76\u6ca1\u6709\u663e\u8457\u5dee\u5f02. <denchmark-link:https://github.com/backyes>@backyes</denchmark-link>\n  \u7b80\u5355\u8bf4\u4e00\u4e0b\u5f53\u65f6\u7684\u8fc7\u7a0b, \u6211\u662f\u572810.6\u65e5checkout\u6700\u65b0\u5185\u90e8\u7684icode\u4e0a\u9762\u7684paddle. \u4f7f\u7528comake2\u7f16\u8bd1, \u8bad\u7ec3\u901f\u5ea6\u5c31\u4f1a\u5f88\u5feb, \u4f7f\u7528cmake\u7f16\u8bd1, \u901f\u5ea6\u5c31\u5f88\u6162 . comake2\u7f16\u8bd1\u7684paddle_trainer\u548c\u4f60\u7ed9\u6211\u7684paddle_trainer\u901f\u5ea6\u662f\u4e00\u6837\u7684. \u540c\u65f6\u90fd\u662fwith gpu\u7684.\n \u4eca\u5929 <denchmark-link:https://github.com/backyes>@backyes</denchmark-link>\n  \u4e13\u95e8\u505a\u4e86\u4e00\u4e2a\u4e00\u952e\u7f16\u8bd1\u811a\u672c, \u7f16\u8bd1\u51fa\u6765paddle_trainer\u5927\u5c0f\u662f100MB\u4e86, \u53ef\u662f\u901f\u5ea6\u8fd8\u662f\u6162 (27s).\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "linrongyi", "commentT": "2016-11-01T14:36:45Z", "comment_text": "\n \t\t\u6211\u4e5f\u78b0\u5230\u81ea\u5df1\u7f16\u8bd1 CPU \u7248 paddle \u5f88\u6162\u7684\u95ee\u9898,\n \u57fa\u4e8e\u5b98\u65b9  docker \u955c\u50cf\n \u7528\u7684 develop \u5206\u652f\uff0c commit <denchmark-link:https://github.com/PaddlePaddle/Paddle/commit/12945b2c9017c88d2581253a6df83d9e35e2b804>12945b2</denchmark-link>\n \n \u7f16\u8bd1\u547d\u4ee4\u5982\u4e0b\uff1a\n <denchmark-code>cd ~/paddle\n git fetch\n git checkout develop\n mkdir -p build\n cd build\n cmake .. -DCMAKE_BUILD_TYPE=\"Release\" -DWITH_RELEASE_G=ON \\\n    -DWITH_DOC=OFF -DWITH_GPU=OFF -DWITH_SWIG_PY=ON \\\n    -DCUDNN_ROOT=/usr/ -DWITH_STYLE_CHECK=OFF -DWITH_AVX=ON\n make -j8\n make install\n </denchmark-code>\n \n \u7f16\u8bd1\u540e\u7684\u6587\u4ef6\u5927\u5c0f\u5982\u4e0b\uff1a\n <denchmark-code>root@6006d11b7879:/usr/local/opt/paddle/bin# ll\n total 16964\n drwxr-xr-x 2 root root      78 Nov  1 14:29 ./\n drwxr-xr-x 4 root root      28 Oct 26 14:23 ../\n -rwxr-xr-x 1 root root 5675189 Nov  1 14:29 paddle_merge_model*\n -rwxr-xr-x 1 root root 5641468 Nov  1 14:29 paddle_pserver_main*\n -rwxr-xr-x 1 root root 6049191 Nov  1 14:29 paddle_trainer*\n </denchmark-code>\n \n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "linrongyi", "commentT": "2016-11-01T14:55:48Z", "comment_text": "\n \t\t-DWITH_GPU=ON \u7f16\u8bd1\u51fa\u6765\u7684CPU\u7248\u672c\u6bd4\u8f83\u6162\u662f\u7531\u4e8eCMakeLists.txt\u91cc\u9762\u6709\u4e2abug. Fix\u7684\u65b9\u5f0f\u89c1<denchmark-link:https://github.com/PaddlePaddle/Paddle/pull/239>#239</denchmark-link>\n  \u4e2dCMakeLists.txt. GPU\u7f16\u8bd1\u7684\u65f6\u5019nvcc\u6ca1\u6709\u589e\u52a0-Xcompiler -mavx\u53c2\u6570\uff0c\u5bfc\u81f4\u7f16\u8bd1\u7684CPU\u4ee3\u7801\u6ca1\u6709AVX\u4f18\u5316\u3002\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "linrongyi", "commentT": "2016-11-04T11:11:52Z", "comment_text": "\n \t\t\u8d5e <denchmark-link:https://github.com/hedaoyuan>@hedaoyuan</denchmark-link>\n \n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "linrongyi", "commentT": "2016-11-05T02:43:40Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/hedaoyuan>@hedaoyuan</denchmark-link>\n  can you help to fix it ASAP?\n \t\t"}}}, "commit": {"commit_id": "125c19a3c31a6290d7feea3faf41dd20fb97e2f4", "commit_author": "hedaoyuan", "commitT": "2016-11-07 23:35:57-08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CMakeLists.txt", "file_new_name": "CMakeLists.txt", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "98,99,100,101,102,103,109,110,111,112,113,114,115,116,117", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "cmake\\util.cmake", "file_new_name": "cmake\\util.cmake", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": null, "deleted_lines": "191,192,193,194,195,196,197,198"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "paddle\\gserver\\CMakeLists.txt", "file_new_name": "paddle\\gserver\\CMakeLists.txt", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "53", "deleted_lines": "53"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "paddle\\math\\CMakeLists.txt", "file_new_name": "paddle\\math\\CMakeLists.txt", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "26", "deleted_lines": "26"}}}}}}