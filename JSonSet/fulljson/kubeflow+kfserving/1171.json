{"BR": {"BR_id": "1171", "BR_author": "yuzisun", "BRopenT": "2020-10-31T04:11:03Z", "BRcloseT": "2020-11-02T21:54:16Z", "BR_text": {"BRsummary": "Istio dep upgrade breaks the cluster with existing virtual services", "BRdescription": "\n /kind bug\n What steps did you take and what happened:\n the new istio dep upgrade seems to break the cluster with existing virtual services that still uses the deprecated websocketUpgrade field.\n <denchmark-code>E1031 03:51:10.251881       1 reflector.go:178] k8s.io/client-go@v11.0.1-0.20190805182717-6502b5e7b1b5+incompatible/tools/cache/reflector.go:125: Failed to list *v1alpha3.VirtualService: v1alpha3.VirtualServiceList.Items: []v1alpha3.VirtualService: v1alpha3.VirtualService.v1alpha3.VirtualService.Spec: unmarshalerDecoder: unknown field \"websocketUpgrade\" in v1alpha3.HTTPRoute, error found in #10 byte of ...|e\":true}]}},{\"apiVer|..., bigger context ...|:100}],\"timeout\":\"600s\",\"websocketUpgrade\":true}]}},{\"apiVersion\":\"networking.istio.io/v1alpha3\",\"ki|...\n E1031 03:52:01.021132       1 reflector.go:178] k8s.io/client-go@v11.0.1-0.20190805182717-6502b5e7b1b5+incompatible/tools/cache/reflector.go:125: Failed to list *v1alpha3.VirtualService: v1alpha3.VirtualServiceList.Items: []v1alpha3.VirtualService: v1alpha3.VirtualService.v1alpha3.VirtualService.Spec: unmarshalerDecoder: unknown field \"websocketUpgrade\" in v1alpha3.HTTPRoute, error found in #10 byte of ...|e\":true}]}},{\"apiVer|..., bigger context ...|:100}],\"timeout\":\"600s\",\"websocketUpgrade\":true}]}},{\"apiVersion\":\"networking.istio.io/v1alpha3\",\"ki|...\n E1031 03:52:40.075246       1 reflector.go:178] k8s.io/client-go@v11.0.1-0.20190805182717-6502b5e7b1b5+incompatible/tools/cache/reflector.go:125: Failed to list *v1alpha3.VirtualService: v1alpha3.VirtualServiceList.Items: []v1alpha3.VirtualService: v1alpha3.VirtualService.v1alpha3.VirtualService.Spec: unmarshalerDecoder: unknown field \"websocketUpgrade\" in v1alpha3.HTTPRoute, error found in #10 byte of ...|e\":true}]}},{\"apiVer|..., bigger context ...|:100}],\"timeout\":\"600s\",\"websocketUpgrade\":true}]}},{\"apiVersion\":\"networking.istio.io/v1alpha3\",\"ki|...\n E1031 03:53:26.316435       1 reflector.go:178] k8s.io/client-go@v11.0.1-0.20190805182717-6502b5e7b1b5+incompatible/tools/cache/reflector.go:125: Failed to list *v1alpha3.VirtualService: v1alpha3.VirtualServiceList.Items: []v1alpha3.VirtualService: v1alpha3.VirtualService.v1alpha3.VirtualService.Spec: unmarshalerDecoder: unknown field \"websocketUpgrade\" in v1alpha3.HTTPRoute, error found in #10 byte of ...|e\":true}]}},{\"apiVer|..., bigger context ...|:100}],\"timeout\":\"600s\",\"websocketUpgrade\":true}]}},{\"apiVersion\":\"networking.istio.io/v1alpha3\",\"ki|...\n </denchmark-code>\n \n What did you expect to happen:\n Upgrading to new release should not break the existing cluster\n Anything else you would like to add:\n Environment:\n \n Istio Version: 1.3\n Knative Version: 0.11.2\n KFServing Version: master\n Kubeflow version:\n Kfdef:[k8s_istio/istio_dex/gcp_basic_auth/gcp_iap/aws/aws_cognito/ibm]\n Minikube version:\n Kubernetes version: (use kubectl version):\n OS (e.g. from /etc/os-release):\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "yuzisun", "commentT": "2020-10-31T04:11:31Z", "comment_text": "\n \t\t/cc <denchmark-link:https://github.com/ryandawsonuk>@ryandawsonuk</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "yuzisun", "commentT": "2020-10-31T08:23:31Z", "comment_text": "\n \t\tGood spot. We hit the same problem on Seldon so I should have remembered really - <denchmark-link:https://github.com/SeldonIO/seldon-core/issues/1695>SeldonIO/seldon-core#1695</denchmark-link>\n \n I remember we found a way to get it to tolerate the field. I think there was a flag somewhere. Will have to find what we did.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "yuzisun", "commentT": "2020-10-31T08:34:27Z", "comment_text": "\n \t\tFix was this\n <denchmark-link:https://github.com/SeldonIO/seldon-core/commit/e7f4c7622f266be5a448b604e7b9adebfd752841>SeldonIO/seldon-core@e7f4c76</denchmark-link>\n \n Same as <denchmark-link:https://github.com/knative/serving/issues/7320#issuecomment-625148312>knative/serving#7320 (comment)</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "9d899e4a3504c9dab9f400b67a178ba4fe5abe26", "commit_author": "Dan Sun", "commitT": "2020-11-02 13:54:15-08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cmd\\manager\\main.go", "file_new_name": "cmd\\manager\\main.go", "file_complexity": {"file_NLOC": "131", "file_CCN": "15", "file_NToken": "896"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "51,52,53,54,55", "deleted_lines": null, "method_info": {"method_name": "init", "method_params": "", "method_startline": "51", "method_endline": "55", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "20", "method_nesting_level": "0"}}}}}}}}