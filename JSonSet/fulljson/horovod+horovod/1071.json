{"BR": {"BR_id": "1071", "BR_author": "ThrowMeForALoop", "BRopenT": "2019-05-13T22:16:00Z", "BRcloseT": "2019-05-17T18:04:01Z", "BR_text": {"BRsummary": "\"import horovod.tensorflow\" crash on latest version", "BRdescription": "\n Environment:\n \n Framework: (TensorFlow, Keras, PyTorch, MXNet)\n Framework version: tensorflow-gpu(1.12)\n Horovod version: 0.16.1\n MPI version: 4.0.0\n CUDA version: 9.0\n NCCL version: 2.1.2\n Python version: 3.6.8\n OS and version: CENTOS 7\n \n I just try to test version 0.16.1 and 0.16.0 with tensorflow-gpu by using \"python -c ''import horovod.tensorflow' but it crashes intermediately: \"Illegal instruction\". I reverted to horovod 0.14.1 and it works fine. However I need \"horovod.spark\" which has not existed in lower version than 0.16.0.\n Can anyone help me, please? Thank you so much\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-13T22:26:49Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/ThrowMeForALoop>@ThrowMeForALoop</denchmark-link>\n , can you give us some more info about the crash?  Do you have a complete stack trace?\n When installing Horovod, did everything seem to work correctly?  What command did you run to install Horovod?  Did you include --no-cache-dir?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-14T05:23:43Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/tgaddair>@tgaddair</denchmark-link>\n ,\n I test just write simple test.py  and run \n I guess the problem is that  is missing in horovod common folder.\n I tried:\n <denchmark-code>pip uninstall -y horovod\n HOROVOD_GPU_ALLREDUCE=NCCL pip install --no-cache-dir horovod\n </denchmark-code>\n \n However, nothing changed.\n <denchmark-link:https://user-images.githubusercontent.com/23578972/57672455-7d00ae00-7618-11e9-98d6-b45b57cb04b1.png></denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-14T14:10:51Z", "comment_text": "\n \t\tI met the same trouble!\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-14T15:29:06Z", "comment_text": "\n \t\tCan you try installing in a new virtual environment?  I'm wondering if somehow some parts of version 0.14.1 (which did not have parameter_manager.cc are still around and conflicting with the new code.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-14T16:01:13Z", "comment_text": "\n \t\t\n Can you try installing in a new virtual environment? I'm wondering if somehow some parts of version 0.14.1 (which did not have parameter_manager.cc are still around and conflicting with the new code.\n \n I created a new virtual environment but still in same trouble.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-14T19:13:20Z", "comment_text": "\n \t\tDo you happen to know if the file it's looking for exists in your installation (horovod/common/parameter_manager.cc)?\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-14T19:47:03Z", "comment_text": "\n \t\tIt's indeed not there. I tried to build tensorflow from orginal source code as well but same problem.\n Another try is to copy parameter_manager.cc from git repo to horovod common folder but no success\n <denchmark-link:https://user-images.githubusercontent.com/23578972/57727407-b9bcbb80-7691-11e9-92bc-9739a5ad3a0b.png></denchmark-link>\n \n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-14T23:04:14Z", "comment_text": "\n \t\tDo you have a file called horovod/tensorflow/mpi_lib.so?  That should be where the parameter_manager symbols live.  If so, can you try running nm -g on it and providing a gist of the output?\n Also, could you provide a full gist of the output when installing from pip?  Thanks, and apologies for all the back and forth.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-15T06:38:21Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/tgaddair>@tgaddair</denchmark-link>\n \n No problem. I changed to hovorovod + tensorflow 1.13.1 without GPU  in this try.\n Please refer to attached file for  result.\n <denchmark-link:https://github.com/horovod/horovod/files/3181173/nm.-g.pdf>nm -g .pdf</denchmark-link>\n \n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-15T15:11:10Z", "comment_text": "\n \t\tThanks, the symbols look correct.  Can I also take a look at the output from installing Horovod?\n Also, when you import Horovod, be careful that you're not in the Horovod root directory, as that can cause weird issues.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-15T21:14:23Z", "comment_text": "\n \t\t<denchmark-link:https://user-images.githubusercontent.com/23578972/57809781-8a2bb300-7766-11e9-9dfe-97366dd0bf14.png></denchmark-link>\n \n \n Installation looks normal. However I realized that the same version works fine in my macbook (using clang) but only have trouble with cluster deployment (gcc 5.4.0) as seen from the picture.\n \n I got stuck now as I tried any possible methods. If you have any ideas, please let me know\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-15T22:46:42Z", "comment_text": "\n \t\tSimilar to <denchmark-link:https://github.com/horovod/horovod/issues/761>#761</denchmark-link>\n , can you try installing a different gcc in a new conda environment (e.g, ) and installing Horovod again?\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-16T06:42:23Z", "comment_text": "\n \t\tnothing changed even with new installed gcc. Still the same problem with missing horovod/common/parameter_manager.cc. Maybe CENTOS 7.0 is the root cause ??\n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-16T08:15:57Z", "comment_text": "\n \t\tAnother thing worth mentioning is that horovod 0.14 works fine with the same setup (gcc, os ...). However I need to use horovod.spark which only exists on 0.16.0 and 0.16.1 version\n \t\t"}, "comments_14": {"comment_id": 15, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-16T21:25:06Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ThrowMeForALoop>@ThrowMeForALoop</denchmark-link>\n , what kind of CPU do you have on this server?  Do you build Horovod and run it on the same server?  SIGILL means that an instruction used was not supported by CPU architecture.\n \t\t"}, "comments_15": {"comment_id": 16, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-16T22:17:46Z", "comment_text": "\n \t\t<denchmark-link:https://user-images.githubusercontent.com/23578972/57890740-0f7f9800-7839-11e9-9fc2-a7bc5bd3acfc.png></denchmark-link>\n \n @alsrgv\n  : My CPU is quite old-fashioned. Can you confirm about Horovod support with this sort of CPU.\n Thanks\n       \n \t\t"}, "comments_16": {"comment_id": 17, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-16T22:57:37Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ThrowMeForALoop>@ThrowMeForALoop</denchmark-link>\n , looks like it's <denchmark-link:https://ark.intel.com/content/www/us/en/ark/products/52581/intel-xeon-processor-e5649-12m-cache-2-53-ghz-5-86-gt-s-intel-qpi.html>2011 model</denchmark-link>\n .\n I've pushed a tentative fix for you.  Can you try installing Horovod via HOROVOD_GPU_ALLREDUCE=NCCL pip install --no-cache-dir git+https://github.com/horovod/horovod@fix_avx?\n \t\t"}, "comments_17": {"comment_id": 18, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-17T15:01:00Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/alsrgv>@alsrgv</denchmark-link>\n  : your build works well.\n Still I get trouble in running 'keras_spark_rossmann' example. I guess the problem is that mpirun command can not run as root as I am a normal user. I don't wanna post a new issue as I need to trace your fix.\n Would you mind checking it, please? Thanks\n <denchmark-link:https://user-images.githubusercontent.com/23578972/57936986-55823d80-78c5-11e9-8fe8-a95c18eb2d9d.png></denchmark-link>\n \n <denchmark-link:https://user-images.githubusercontent.com/23578972/57936987-55823d80-78c5-11e9-8795-b2de00c2fef2.png></denchmark-link>\n \n \t\t"}, "comments_18": {"comment_id": 19, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-17T18:03:49Z", "comment_text": "\n \t\tGreat! Can you paste the full output? mpirun error should be above these messages.\n \t\t"}, "comments_19": {"comment_id": 20, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-18T07:39:49Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/alsrgv>@alsrgv</denchmark-link>\n  : Can you check whether your commit is in the latest build of horovod.\n You deleted the  horovod@fix_avx branch and I meet the same problem as install horovod from:\n \n \t\t"}, "comments_20": {"comment_id": 21, "comment_author": "ThrowMeForALoop", "commentT": "2019-05-18T08:07:49Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ThrowMeForALoop>@ThrowMeForALoop</denchmark-link>\n , can you install via ?  The fix is going to be available via  once we make a new release.\n \t\t"}}}, "commit": {"commit_id": "b91cda274a01c557cf17c3ab6d473570e24500db", "commit_author": "Alex Sergeev", "commitT": "2019-05-17 11:04:00-07:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "setup.py", "file_new_name": "setup.py", "file_complexity": {"file_NLOC": "818", "file_CCN": "178", "file_NToken": "4481"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "99", "deleted_lines": null, "method_info": {"method_name": "get_cpp_flags", "method_params": "build_ext", "method_startline": "96", "method_endline": "127", "method_complexity": {"method_NLOC": "29", "method_CCN": "6", "method_NToken": "145", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "84,85,86,87,88,89,90,91,92,93", "deleted_lines": "87", "method_info": {"method_name": "check_avx_supported", "method_params": "", "method_startline": "84", "method_endline": "93", "method_complexity": {"method_NLOC": "9", "method_CCN": "3", "method_NToken": "49", "method_nesting_level": "0"}}}}}}}}