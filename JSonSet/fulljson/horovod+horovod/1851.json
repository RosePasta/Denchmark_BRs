{"BR": {"BR_id": "1851", "BR_author": "ilmarkov", "BRopenT": "2020-04-08T12:02:30Z", "BRcloseT": "2020-04-23T23:25:58Z", "BR_text": {"BRsummary": "Docker example fails", "BRdescription": "\n Environment:\n \n Framework: Any of frameworks\n Framework version:\n Horovod version: 0.19.1\n MPI version: 3.0.0\n CUDA version: 10.0\n NCCL version: 2.4.7-1+cuda10.0\n Python version: 2.7\n OS and version: ubuntu16.04\n GCC version: g++-2.8\n \n Bug report:\n I build a docker image of the latest horovod sources from Dockerfile.test.gpu with a slight addition to support ssh (took a couple of lines installing OpenSSH-server from Dockerfile.gpu).\n Running training on a single node inside a docker container worked perfectly.\n Then started 2 containers on separate machines following instructions in <denchmark-link:https://github.com/horovod/horovod/blob/master/docs/docker.rst#running-on-multiple-machines>documentation</denchmark-link>\n . Passwordless ssh was established.\n The issues are two-fold.\n The first one looked like a typo <denchmark-link:https://github.com/horovod/horovod/blob/master/horovod/run/driver/driver_service.py#L148>here</denchmark-link>\n . \"Settings doesn't have attribute nic\". There must be \"nics\".\n When I fixed it, the second problem came out.\n I'm trying to on host1 with following line:\n \n It looks similar to issues <denchmark-link:https://github.com/horovod/horovod/issues/975>#975</denchmark-link>\n , <denchmark-link:https://github.com/horovod/horovod/issues/971>#971</denchmark-link>\n . Though, the error messages says it can't connect not to remote servers but to localhost:\n \n And following error traceback:\n <denchmark-code> self.RequestHandlerClass(request, client_address, self)\n   File \"/usr/lib/python2.7/SocketServer.py\", line 652, in __init__\n     self.handle()\n   File \"/usr/local/lib/python2.7/dist-packages/horovod/run/common/util/network.py\", line 107, in h$ndle\n     req = server._wire.read(self.rfile)\n   File \"/usr/local/lib/python2.7/dist-packages/horovod/run/common/util/network.py\", line 80, in re$d\n     message_len = struct.unpack('i', rfile.read(4))[0]\n error: unpack requires a string argument of length 4\n </denchmark-code>\n \n When I try to run the following way:\n  horovodrun -np 4 -H host1:2,host2:2 -p 1234 python pytorch_synthetic_benchmark.py\n It fails with following error:\n ssh: connect to host host1 port 1234: Connection refused. Though, documentation doesn't state\n to run ssh in container starting the training. When I start sshd on host1 the problem described above comes out.\n Building docker image not from sources, but using Dockerfile.gpu, everything works fine. So there must be a problem with a current version.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ilmarkov", "commentT": "2020-04-10T16:17:02Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/ilmarkov>@ilmarkov</denchmark-link>\n , thanks for raising the issue.  It does look like there is indeed a typo following a recent refactor on master.  <denchmark-link:https://github.com/abditag2>@abditag2</denchmark-link>\n , can you take a look, and add a unit test to ensure we are properly testing this code path?\n \t\t"}}}, "commit": {"commit_id": "d1b13ec131af22b31d0ba999dae15a29991cfeae", "commit_author": "Travis Addair", "commitT": "2020-04-23 16:25:57-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "horovod\\run\\driver\\driver_service.py", "file_new_name": "horovod\\run\\driver\\driver_service.py", "file_complexity": {"file_NLOC": "143", "file_CCN": "34", "file_NToken": "853"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "148", "deleted_lines": "148", "method_info": {"method_name": "_driver_fn", "method_params": "all_host_names,local_host_names,settings", "method_startline": "128", "method_endline": "194", "method_complexity": {"method_NLOC": "41", "method_CCN": "13", "method_NToken": "250", "method_nesting_level": "0"}}}}}}}}