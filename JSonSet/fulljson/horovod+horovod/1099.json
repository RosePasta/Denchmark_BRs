{"BR": {"BR_id": "1099", "BR_author": "ildoonet", "BRopenT": "2019-05-28T01:10:09Z", "BRcloseT": "2019-05-30T01:58:02Z", "BR_text": {"BRsummary": "Duplicated Synchronization with Gradient Clipping?", "BRdescription": "\n Environment:\n \n Framework: pytorch\n Framework version: 1.0\n Horovod version: latest\n MPI version: -\n CUDA version: -\n NCCL version: -\n Python version: 3.6\n OS and version: Ubuntu 16.04\n \n <denchmark-link:https://github.com/horovod/horovod/blob/master/horovod/torch/__init__.py#L174>https://github.com/horovod/horovod/blob/master/horovod/torch/__init__.py#L174</denchmark-link>\n \n If you see this documentation, when using gradient clipping, there is duplicated(twice) synchronization. Once is when 'synchronize' is called and second one is when 'step' is called.\n After I followed this documentation with gradient clipping, training speed is slower.\n Any solusions?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ildoonet", "commentT": "2019-05-29T03:34:08Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ildoonet>@ildoonet</denchmark-link>\n , thanks for raising this!  This regression has been introduced by <denchmark-link:https://github.com/horovod/horovod/pull/597>#597</denchmark-link>\n .\n While we're thinking about a proper solution, can you specify  after  wraps original optimizer, <denchmark-link:https://gist.github.com/alsrgv/0713add50fe49a409316832a31612dde>like this</denchmark-link>\n ?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ildoonet", "commentT": "2019-05-29T05:08:47Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/alsrgv>@alsrgv</denchmark-link>\n  Thanks for the tip. I will try with it and wait for the proper solutions.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "ildoonet", "commentT": "2019-05-30T01:58:55Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ildoonet>@ildoonet</denchmark-link>\n , the fix was merged into master.  You can reinstall Horovod from master (or wait a bit for 0.16.3), and use , as new documentation prescribes.\n \t\t"}}}, "commit": {"commit_id": "60506fb1571c89b5584280ba87522b047d6e9a0c", "commit_author": "Alex Sergeev", "commitT": "2019-05-29 18:58:01-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "0.8035714285714286"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "horovod\\torch\\__init__.py", "file_new_name": "horovod\\torch\\__init__.py", "file_complexity": {"file_NLOC": "208", "file_CCN": "58", "file_NToken": "1623"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "149,150", "method_info": {"method_name": "step", "method_params": "self,closure", "method_startline": "149", "method_endline": "151", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "28", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "154,155,156,157,158,159,160,161,162,163", "deleted_lines": null, "method_info": {"method_name": "step", "method_params": "self,closure,synchronize", "method_startline": "154", "method_endline": "164", "method_complexity": {"method_NLOC": "11", "method_CCN": "3", "method_NToken": "55", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "152", "deleted_lines": "149,150", "method_info": {"method_name": "synchronize", "method_params": "self", "method_startline": "135", "method_endline": "152", "method_complexity": {"method_NLOC": "16", "method_CCN": "5", "method_NToken": "155", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "test\\test_torch.py", "file_new_name": "test\\test_torch.py", "file_complexity": {"file_NLOC": "973", "file_CCN": "226", "file_NToken": "8233"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1227,1228,1229,1230,1231,1232,1233,1234,1235,1236,1237,1238,1239,1240,1241,1242,1243,1244,1245,1246,1247,1248,1249,1250,1251,1252,1253,1254,1255,1256", "deleted_lines": null, "method_info": {"method_name": "test_gradient_clipping", "method_params": "self", "method_startline": "1227", "method_endline": "1256", "method_complexity": {"method_NLOC": "24", "method_CCN": "2", "method_NToken": "243", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "1258,1259,1260,1261,1262,1263,1264,1265,1266,1267,1268,1269,1270,1271,1272,1273,1274,1275,1276,1277,1278,1279,1280,1281,1282,1283,1284,1285,1286", "deleted_lines": null, "method_info": {"method_name": "test_synchronize_step_warning", "method_params": "self", "method_startline": "1258", "method_endline": "1286", "method_complexity": {"method_NLOC": "23", "method_CCN": "2", "method_NToken": "203", "method_nesting_level": "1"}}}}}}}}