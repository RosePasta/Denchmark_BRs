{"BR": {"BR_id": "1688", "BR_author": "tgaddair", "BRopenT": "2020-01-24T20:55:03Z", "BRcloseT": "2020-03-10T16:30:18Z", "BR_text": {"BRsummary": "TensorFlow master branch (tf-nightly) compatibility", "BRdescription": "\n See: <denchmark-link:https://github.com/tensorflow/tensorflow/issues/35138>tensorflow/tensorflow#35138</denchmark-link>\n \n In TensorFlow 2.1, experimental_run_tf_function was removed from tf.keras.Model.compile at this commit: c73c99c#diff-de9b96ac2d81503324cbbbe21732031fR1159\n In Horovod, this flag / graph mode is necessary in order for Optimizer.get_gradients() to be called, which aggregates gradients across workers. Since this flag has been removed, distributed training in Horovod with tf.keras isn't working in the example scripts for TensorFlow 2.1.\n <denchmark-link:https://github.com/abditag2>@abditag2</denchmark-link>\n  is currently investigating a workaround.  Note that we cannot perform the allreduce aggregation in apply_gradients due to interactions with gradient clipping and loss scaling (see <denchmark-link:https://github.com/horovod/horovod/pull/1347>#1347</denchmark-link>\n ).\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "tgaddair", "commentT": "2020-01-27T16:03:35Z", "comment_text": "\n \t\tTo be clear, TF 2.1.0 release works fine because the <denchmark-link:https://github.com/tensorflow/tensorflow/commit/c73c99ca3e0bacf2bca313f270bb3eae28869530>tensorflow/tensorflow@c73c99c</denchmark-link>\n  commit is not included in it. It is currently in , so the next release of TF will have the issue.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "tgaddair", "commentT": "2020-01-27T18:39:06Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/nvcastet>@nvcastet</denchmark-link>\n , good catch.  I'll update the issue.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "tgaddair", "commentT": "2020-02-04T01:35:58Z", "comment_text": "\n \t\twe have a temporary fix for this in <denchmark-link:https://github.com/horovod/horovod/pull/1692>#1692</denchmark-link>\n \n However, we are working with TF team to come up with a better solution here: <denchmark-link:https://github.com/tensorflow/tensorflow/issues/36398>tensorflow/tensorflow#36398</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "tgaddair", "commentT": "2020-03-07T12:28:12Z", "comment_text": "\n \t\tI will meet the same error when use TF2.1 and horovod 0.19.0.\n I am not use the 2.1 release BTW.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "tgaddair", "commentT": "2020-03-10T00:52:13Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Leslie-Fang>@Leslie-Fang</denchmark-link>\n , are you setting  in your script?\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "tgaddair", "commentT": "2020-03-10T10:54:55Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/tgaddair>@tgaddair</denchmark-link>\n   Yes, I set .\n Downgrade the TF t0 2.0 fix this problem.\n \t\t"}}}, "commit": {"commit_id": "6e4683acb4aea339c447c438ed277d0c6dec0c29", "commit_author": "Travis Addair", "commitT": "2020-03-10 09:30:17-07:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docker-compose.test.yml", "file_new_name": "docker-compose.test.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "165,269", "deleted_lines": "165,269"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "horovod\\_keras\\__init__.py", "file_new_name": "horovod\\_keras\\__init__.py", "file_complexity": {"file_NLOC": "78", "file_CCN": "26", "file_NToken": "627"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "31", "deleted_lines": "29", "method_info": {"method_name": "__init__", "method_params": "self,kwargs", "method_startline": "25", "method_endline": "32", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "62", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "46,47,48", "deleted_lines": null, "method_info": {"method_name": "_aggregate_gradients", "method_params": "self,grads_and_vars", "method_startline": "46", "method_endline": "48", "method_complexity": {"method_NLOC": "3", "method_CCN": "2", "method_NToken": "25", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "72,74,75,76", "deleted_lines": null, "method_info": {"method_name": "apply_gradients", "method_params": "self,args,kwargs", "method_startline": "71", "method_endline": "77", "method_complexity": {"method_NLOC": "7", "method_CCN": "2", "method_NToken": "43", "method_nesting_level": "2"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "44", "deleted_lines": "41", "method_info": {"method_name": "get_gradients", "method_params": "self,loss,params", "method_startline": "34", "method_endline": "44", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "34", "method_nesting_level": "2"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "50,51", "deleted_lines": "63,65,66,67", "method_info": {"method_name": "_allreduce", "method_params": "self,gradients", "method_startline": "50", "method_endline": "69", "method_complexity": {"method_NLOC": "20", "method_CCN": "6", "method_NToken": "117", "method_nesting_level": "2"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "horovod\\spark\\keras\\util.py", "file_new_name": "horovod\\spark\\keras\\util.py", "file_complexity": {"file_NLOC": "313", "file_CCN": "88", "file_NToken": "2183"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "169,170", "deleted_lines": null, "method_info": {"method_name": "as_tuple", "method_params": "v", "method_startline": "169", "method_endline": "170", "method_complexity": {"method_NLOC": "2", "method_CCN": "2", "method_NToken": "22", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "180,183,192,195", "deleted_lines": "177,180,189,192", "method_info": {"method_name": "prep", "method_params": "row", "method_startline": "172", "method_endline": "196", "method_complexity": {"method_NLOC": "25", "method_CCN": "7", "method_NToken": "166", "method_nesting_level": "2"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "test\\test_spark_keras.py", "file_new_name": "test\\test_spark_keras.py", "file_complexity": {"file_NLOC": "426", "file_CCN": "33", "file_NToken": "3858"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "117", "deleted_lines": null, "method_info": {"method_name": "test_fit_model_multiclass", "method_params": "self", "method_startline": "102", "method_endline": "135", "method_complexity": {"method_NLOC": "28", "method_CCN": "1", "method_NToken": "225", "method_nesting_level": "1"}}}}}}}}