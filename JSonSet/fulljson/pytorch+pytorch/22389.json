{"BR": {"BR_id": "22389", "BR_author": "vadimkantorov", "BRopenT": "2019-07-01T07:26:40Z", "BRcloseT": "2019-07-19T20:33:36Z", "BR_text": {"BRsummary": "Dependency issues with torch.utils.tensorboard: \"No module named past\" and \"No module named 'PIL'\"", "BRdescription": "\n <denchmark-code>Python 3.7.3 (default, Mar 27 2019, 22:11:17)\n [GCC 7.3.0] :: Anaconda, Inc. on linux\n Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n >>> torch.__version__\n '1.2.0.dev20190607'\n </denchmark-code>\n \n <denchmark-code>Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n >>> import torch.utils.tensorboard\n Traceback (most recent call last):\n   File \"<stdin>\", line 1, in <module>\n   File \"/miniconda/lib/python3.7/site-packages/torch/utils/tensorboard/__init__.py\", line 6, in <module>\n     from .writer import FileWriter, SummaryWriter  # noqa F401\n   File \"/miniconda/lib/python3.7/site-packages/torch/utils/tensorboard/writer.py\", line 17, in <module>\n     from ._convert_np import make_np\n   File \"/miniconda/lib/python3.7/site-packages/torch/utils/tensorboard/_convert_np.py\", line 12, in <module>\n     from caffe2.python import workspace\n   File \"/miniconda/lib/python3.7/site-packages/caffe2/python/workspace.py\", line 15, in <module>\n     from past.builtins import basestring\n ModuleNotFoundError: No module named 'past'\n </denchmark-code>\n \n pip install future fixes this problem, but it should rather be added to the requirements.txt or mentioned explicitly in the docs.\n However then another issue happens:\n <denchmark-code>Traceback (most recent call last):\n   File \"train.py\", line 6, in <module>\n     import torch.utils.tensorboard\n   File \"/miniconda/lib/python3.7/site-packages/torch/utils/tensorboard/__init__.py\", line 6, in <module>\n     from .writer import FileWriter, SummaryWriter  # noqa F401\n   File \"/miniconda/lib/python3.7/site-packages/torch/utils/tensorboard/writer.py\", line 18, in <module>\n     from ._embedding import make_mat, make_sprite, make_tsv, append_pbtxt\n   File \"/miniconda/lib/python3.7/site-packages/torch/utils/tensorboard/_embedding.py\", line 6, in <module>\n     from PIL import Image\n ModuleNotFoundError: No module named 'PIL'\n </denchmark-code>\n \n Docs mention dependency on pillow, but only for add_image and add_images. I think it should not break during import.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "vadimkantorov", "commentT": "2019-07-01T07:55:56Z", "comment_text": "\n \t\tNote that the right fix for the past.stringbase is really to stop using the deprecated API (which is not that hard too...)\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "vadimkantorov", "commentT": "2019-07-01T08:32:41Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/apaszke>@apaszke</denchmark-link>\n  You mean the  usage within , right? The tensorboard package itself hopefully is not deprecated yet :) :)\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "vadimkantorov", "commentT": "2019-07-01T10:28:58Z", "comment_text": "\n \t\tWell the last frame that actually causes the error is /miniconda/lib/python3.7/site-packages/caffe2/python/workspace.py, so it originates from C2 not from TensorBoard bindings (they import C2 bits). stringbase is deprecated, so C2 is using those polyfills, but they should be relatively easy to replace.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "vadimkantorov", "commentT": "2019-07-01T23:09:50Z", "comment_text": "\n \t\tshould this not be more like ? (at least about PIL - it could be lazily imported at  call, no?) cc <denchmark-link:https://github.com/apaszke>@apaszke</denchmark-link>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "vadimkantorov", "commentT": "2019-07-18T15:45:35Z", "comment_text": "\n \t\tcc <denchmark-link:https://github.com/orionr>@orionr</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "vadimkantorov", "commentT": "2019-07-18T16:28:54Z", "comment_text": "\n \t\tcc <denchmark-link:https://github.com/lanpa>@lanpa</denchmark-link>\n  @natalialunova <denchmark-link:https://github.com/sanekmelnikov>@sanekmelnikov</denchmark-link>\n \n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "vadimkantorov", "commentT": "2019-07-18T16:43:33Z", "comment_text": "\n \t\tLooks like future is already in requirements.txt? The list I'm seeing is\n <denchmark-code>future\n numpy\n pyyaml\n setuptools\n six\n typing\n </denchmark-code>\n \n I agree that we should move from PIL import Image into make_sprite where it's required. Making the change.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "vadimkantorov", "commentT": "2019-07-18T19:19:40Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/orionr>@orionr</denchmark-link>\n  Hmm. You are right. I've used a nightly build (I think it was from conda), maybe somehow it's not used as dependency for the package there?\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "vadimkantorov", "commentT": "2019-07-19T20:59:29Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/pjh5>@pjh5</denchmark-link>\n  or <denchmark-link:https://github.com/kostmo>@kostmo</denchmark-link>\n , do you know whether conda uses the requirements.txt?\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "vadimkantorov", "commentT": "2019-07-19T21:31:37Z", "comment_text": "\n \t\tConda doesn't use requirements.txt ; they're built with conda-build so it uses this meta.yaml, specifically <denchmark-link:https://github.com/pytorch/builder/blob/master/conda/pytorch-nightly/meta.yaml#L31>https://github.com/pytorch/builder/blob/master/conda/pytorch-nightly/meta.yaml#L31</denchmark-link>\n  .\n But more generally, I don't think we'll add anything as a req for the nightlies unless they're needed by core functionality are necessary for decent performance (like numpy). i.e. Caffe2 doesn't work out of the box on the nightlies without installing additional python packages either.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "vadimkantorov", "commentT": "2019-08-05T13:52:30Z", "comment_text": "\n \t\tSomehow the future requirement in meta.yaml is ignored? I just installed the yesterday's nightly, and it seems to ignore the metal.yaml requireement.\n Why should nightlies be much different from the regular builds in this respect? (I think switching from nightlies and back should be seamless wrt dependencies required from the user) <denchmark-link:https://github.com/soumith>@soumith</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "818828e8a86a90c9f3fe23c7c1fba93ac81c87c8", "commit_author": "Orion Reblitz-Richardson", "commitT": "2019-07-19 13:30:43-07:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "torch\\utils\\tensorboard\\_embedding.py", "file_new_name": "torch\\utils\\tensorboard\\_embedding.py", "file_complexity": {"file_NLOC": "47", "file_CCN": "13", "file_NToken": "496"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "25,26", "deleted_lines": null, "method_info": {"method_name": "make_sprite", "method_params": "label_img,save_path", "method_startline": "24", "method_endline": "37", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "137", "method_nesting_level": "0"}}}}}}}}