{"BR": {"BR_id": "9050", "BR_author": "iblis17", "BRopenT": "2017-12-13T04:40:40Z", "BRcloseT": "2018-07-22T14:00:57Z", "BR_text": {"BRsummary": "got segfault from lenet with stn example", "BRdescription": "\n Hi,\n We encounter segfault with stn.\n Here is the original issue\n <denchmark-link:https://github.com/dmlc/MXNet.jl/issues/369>dmlc/MXNet.jl#369</denchmark-link>\n .\n TL;DR:\n Segfault happened in CPU-version mshadow::BilinearSamplingBackward\n gdb trace here:\n Thread 37 \"julia\" received signal SIGSEGV, Segmentation fault.\n [Switching to Thread 0x7fff35a15700 (LWP 13819)]\n 0x00007fff83e77ba0 in mshadow::BilinearSamplingBackward<float> (input_grad=..., grid_src_data=..., output_grad=..., \n     input_data=...) at src/operator/spatial_transformer.cc:120\n 120                   *(g_input + data_index + 1) += *(grad + grad_index) * top_left_y_w\n (gdb) bt\n #0  0x00007fff83e77ba0 in mshadow::BilinearSamplingBackward<float> (input_grad=..., grid_src_data=..., output_grad=..., \n     input_data=...) at src/operator/spatial_transformer.cc:120\n #1  0x00007fff83e5f18c in mxnet::op::SpatialTransformerOp<mshadow::cpu, float>::Backward (this=0x38bcd30, ctx=..., \n     out_grad=std::vector of length 1, capacity 1 = {...}, in_data=std::vector of length 2, capacity 2 = {...}, \n     out_data=std::vector of length 3, capacity 3 = {...}, req=std::vector of length 2, capacity 2 = {...}, \n     in_grad=std::vector of length 2, capacity 2 = {...}, aux_args=std::vector of length 0, capacity 0)\n     at src/operator/./spatial_transformer-inl.h:136\n (gdb) p grad\n $1 = (const float *) 0x7fff251e6f90\n (gdb) p top_left_y_w\n $2 = 0.376614928\n (gdb) p grad_index\n $3 = 0\n (gdb) p *(grad + grad_index)                                                                                              \n $4 = 0.00177509966\n (gdb) p g_input + data_index + 1\n $5 = (float *) 0x80032442cf50\n (gdb) p g_input\n $6 = (float *) 0x7fff2442cf50\n (gdb) p data_index\n $7 = 4294967295\n actually data_index become a negative number.\n Also, segfault can reproduce in Python's example (with 1.0 prebuilt binary) (<denchmark-link:https://github.com/dmlc/MXNet.jl/issues/369#issuecomment-350617043>dmlc/MXNet.jl#369 (comment)</denchmark-link>\n )\n <denchmark-code>./train_mnist.py --network lenet --add_stn --optimizer adam\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "iblis17", "commentT": "2018-01-11T00:44:36Z", "comment_text": "\n \t\tI get the this segfault:\n <denchmark-code>Segmentation fault: 11\n </denchmark-code>\n \n when running C++ version of\n cpp-package/example/lenet\n This is where the segfault is thrown:\n     Symbol conv1 =\n         Convolution(\"conv1\", data, conv1_w, conv1_b, Shape(5, 5), 20);\n I have built it on a OS X 10.13.2\n I disabled as many libraries as possible.\n I have been able to run Python version of lenet when I installed it with pip.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "iblis17", "commentT": "2018-07-20T22:14:50Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/iblis17>@iblis17</denchmark-link>\n  Can you still reproduce the error with the latest code? I've tried out the python reproduction and verified this should be fixed already. If you can confirm that this bug is no longer appearing on your side would you mind closing the issue? Thanks!\n \t\t"}}}, "commit": {"commit_id": "cfd62e03fcedabafed1691c74eec88e5d5d4adb8", "commit_author": "Martin Kiefel", "commitT": "2018-05-07 09:39:09-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\operator\\spatial_transformer.cc", "file_new_name": "src\\operator\\spatial_transformer.cc", "file_complexity": {"file_NLOC": "142", "file_CCN": "30", "file_NToken": "1617"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "108,109", "deleted_lines": "108,109", "method_info": {"method_name": "mshadow::BilinearSamplingBackward", "method_params": "input_grad,grid_src_data,output_grad,input_data", "method_startline": "83", "method_endline": "148", "method_complexity": {"method_NLOC": "63", "method_CCN": "13", "method_NToken": "800", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\operator\\spatial_transformer.cu", "file_new_name": "src\\operator\\spatial_transformer.cu", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "105", "deleted_lines": "105"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\python\\unittest\\test_operator.py", "file_new_name": "tests\\python\\unittest\\test_operator.py", "file_complexity": {"file_NLOC": "4784", "file_CCN": "797", "file_NToken": "60034"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "2139,2140,2141,2142,2143,2144,2145,2146,2147,2148,2149,2150,2151,2152,2153,2154,2155,2156,2157,2158,2159,2160,2161,2162,2163,2164,2165,2166,2167,2168,2169,2170,2171,2172,2173,2174,2175,2176,2177,2178,2179,2180,2181,2182,2183", "deleted_lines": null, "method_info": {"method_name": "test_stn_valid_sampling", "method_params": "", "method_startline": "2139", "method_endline": "2183", "method_complexity": {"method_NLOC": "40", "method_CCN": "2", "method_NToken": "248", "method_nesting_level": "0"}}}}}}}}