{"BR": {"BR_id": "18242", "BR_author": "xidulu", "BRopenT": "2020-05-05T14:12:08Z", "BRcloseT": "2020-05-06T16:38:10Z", "BR_text": {"BRsummary": "[Numpy] np.random.normal/gumbel/logistic broken after FFI update", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n <denchmark-code>>>> from mxnet import np, npx\n >>> npx.set_np()\n >>> np.random.normal(0, np.ones((2,2)))\n Traceback (most recent call last):\n   File \"<stdin>\", line 1, in <module>\n   File \"/home/ubuntu/mxnet_master_develop/python/mxnet/numpy/random.py\", line 203, in normal\n     return _mx_nd_np.random.normal(loc, scale, size, dtype, ctx, out)\n   File \"/home/ubuntu/mxnet_master_develop/python/mxnet/ndarray/numpy/random.py\", line 178, in normal\n     return _api_internal.normal(loc, scale, size, ctx, dtype, out)\n   File \"/home/ubuntu/mxnet_master_develop/python/mxnet/_ffi/_ctypes/function.py\", line 115, in __call__\n     raise get_last_ffi_error()\n mxnet.base.MXNetError: Traceback (most recent call last):\n   File \"../include/mxnet/runtime/packed_func.h\", line 521\n MXNetError: Check failed: type_code_ == kNDArrayHandle (0 vs. 11) : expected NDArray but get int\n >>> np.random.gumbel(np.ones((2,2)))\n Traceback (most recent call last):\n   File \"<stdin>\", line 1, in <module>\n   File \"/home/ubuntu/mxnet_master_develop/python/mxnet/numpy/random.py\", line 368, in gumbel\n     return _mx_nd_np.random.gumbel(loc, scale, size, ctx, out)\n   File \"/home/ubuntu/mxnet_master_develop/python/mxnet/ndarray/numpy/random.py\", line 288, in gumbel\n     return _api_internal.gumbel(loc, scale, size, ctx, out)\n   File \"/home/ubuntu/mxnet_master_develop/python/mxnet/_ffi/_ctypes/function.py\", line 115, in __call__\n     raise get_last_ffi_error()\n mxnet.base.MXNetError: Traceback (most recent call last):\n   File \"../include/mxnet/runtime/packed_func.h\", line 398\n MXNetError: Check failed: type_code_ == kDLFloat (11 vs. 2) : expected float but get NDArray\n >>> np.random.logistic(np.ones((2,2)))\n Traceback (most recent call last):\n   File \"<stdin>\", line 1, in <module>\n   File \"/home/ubuntu/mxnet_master_develop/python/mxnet/numpy/random.py\", line 309, in logistic\n     return _mx_nd_np.random.logistic(loc, scale, size, ctx, out)\n   File \"/home/ubuntu/mxnet_master_develop/python/mxnet/ndarray/numpy/random.py\", line 251, in logistic\n     return _api_internal.logistic(loc, scale, size, ctx, out)\n   File \"/home/ubuntu/mxnet_master_develop/python/mxnet/_ffi/_ctypes/function.py\", line 115, in __call__\n     raise get_last_ffi_error()\n mxnet.base.MXNetError: Traceback (most recent call last):\n   File \"../include/mxnet/runtime/packed_func.h\", line 398\n MXNetError: Check failed: type_code_ == kDLFloat (11 vs. 2) : expected float but get NDArray\n </denchmark-code>\n \n Also, the output shape of np.random.gumbel does not look right\n <denchmark-code>>>> np.random.gumbel(np.ones((2,2)), np.ones((2,2)))\n array([1.680763])\n </denchmark-code>\n \n <denchmark-h:h3>Error Message</denchmark-h>\n \n (Paste the complete error message. Please also include stack trace by setting environment variable DMLC_LOG_STACK_TRACE_DEPTH=10 before running your script.)\n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n (If you developed your own code, please provide a short script that reproduces the error. For existing examples, please provide link.)\n <denchmark-h:h3>Steps to reproduce</denchmark-h>\n \n (Paste the commands you ran that produced the error.)\n \n \n \n \n <denchmark-h:h2>What have you tried to solve it?</denchmark-h>\n \n \n \n \n \n <denchmark-h:h2>Environment</denchmark-h>\n \n We recommend using our script for collecting the diagnositc information. Run the following command and paste the outputs below:\n <denchmark-code>curl --retry 10 -s https://raw.githubusercontent.com/dmlc/gluon-nlp/master/tools/diagnose.py | python\n \n # paste outputs here\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "xidulu", "commentT": "2020-05-06T00:55:20Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Yiyan66>@Yiyan66</denchmark-link>\n  could you take a look?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "xidulu", "commentT": "2020-05-06T16:38:10Z", "comment_text": "\n \t\tfixed by <denchmark-link:https://github.com/apache/incubator-mxnet/pull/18247>#18247</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "c415ce60fcd9ee55226327f8fbb8513156852a8a", "commit_author": "Yiyan66", "commitT": "2020-05-06 08:51:40-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\api\\operator\\numpy\\random\\np_location_scale_op.cc", "file_new_name": "src\\api\\operator\\numpy\\random\\np_location_scale_op.cc", "file_complexity": {"file_NLOC": "123", "file_CCN": "5", "file_NToken": "1146"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "26,51,62,70,71,77,78,79,80,81,87,117,125,126,132,133,134,135,136,142", "deleted_lines": "50,61,69,70,74,75,76,77,80,86,116,124,125,129,130,131,132,135,141"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\api\\operator\\random\\np_normal_op.cc", "file_new_name": "src\\api\\operator\\random\\np_normal_op.cc", "file_complexity": {"file_NLOC": "68", "file_CCN": "0", "file_NToken": "635"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "51,59,63,64,89,90", "deleted_lines": "63,64,65,88"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\python\\unittest\\test_numpy_op.py", "file_new_name": "tests\\python\\unittest\\test_numpy_op.py", "file_complexity": {"file_NLOC": "8002", "file_CCN": "1836", "file_NToken": "90245"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "3942,3943,3944,3945,3946,3947,3948,3949", "deleted_lines": null, "method_info": {"method_name": "test_np_random_grad", "method_params": "", "method_startline": "3903", "method_endline": "3949", "method_complexity": {"method_NLOC": "39", "method_CCN": "8", "method_NToken": "370", "method_nesting_level": "0"}}}}}}}}