{"BR": {"BR_id": "14406", "BR_author": "anirudh2290", "BRopenT": "2019-03-13T01:47:51Z", "BRcloseT": "2019-04-12T22:10:00Z", "BR_text": {"BRsummary": "resnet cpp-package test is broken", "BRdescription": "\n <denchmark-link:http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/mxnet-validation%2Funix-gpu/detail/PR-14397/5/pipeline>http://jenkins.mxnet-ci.amazon-ml.com/blue/organizations/jenkins/mxnet-validation%2Funix-gpu/detail/PR-14397/5/pipeline</denchmark-link>\n \n after adding waitall support the resnet example is failing with cudamalloc out of memory error.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "anirudh2290", "commentT": "2019-03-13T01:47:55Z", "comment_text": "\n \t\tHey, this is the MXNet Label Bot.\n Thank you for submitting the issue! I will try and suggest some labels so that the appropriate MXNet community members can help resolve it.\n Here are my recommended labels: Example\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "anirudh2290", "commentT": "2019-03-13T02:12:22Z", "comment_text": "\n \t\tI wonder the memory of GPU in CI.\n The input shape is (50,3,224,224), which may triggers OOM.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "anirudh2290", "commentT": "2019-03-13T02:14:30Z", "comment_text": "\n \t\tIn addition, the model in cpp-package seems to be not convergent.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "anirudh2290", "commentT": "2019-03-13T02:38:55Z", "comment_text": "\n \t\tI think its running on a p3.8xlarge which should be sufficient to run this test. <denchmark-link:https://github.com/marcoabreu>@marcoabreu</denchmark-link>\n  can you confirm.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "anirudh2290", "commentT": "2019-03-13T02:40:19Z", "comment_text": "\n \t\t\n In addition, the model in cpp-package seems to be not convergent.\n \n yes i observed that too.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "anirudh2290", "commentT": "2019-03-13T03:03:50Z", "comment_text": "\n \t\tSince the input shape of ResNet is (3, 224, 224), so I resized the MNIST image (1, 28, 28) to (3, 224, 224).\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "anirudh2290", "commentT": "2019-03-13T12:16:56Z", "comment_text": "\n \t\tWe run on a g3.8xlarge\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "anirudh2290", "commentT": "2019-03-13T12:38:28Z", "comment_text": "\n \t\tChanging batch size to a smaller value will address the OOM issue.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "anirudh2290", "commentT": "2019-03-13T18:13:53Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/marcoabreu>@marcoabreu</denchmark-link>\n   There are no changes to the alexnet.cpp, resnet.cpp or cpp-package recently.\n Are there any changes to underlying cuda or mxnet implementation.\n These tests were part of CI tests and have been passing before. We can change the examples so that pass on lower capacity instances, in my opinion that won't be the right solution.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "anirudh2290", "commentT": "2019-03-13T18:14:19Z", "comment_text": "\n \t\tDid infra that these tests are run on have changed recently? It seems that the test would be running fine on p3.8xl but would fail on g3.8x (legacy hardware)... <denchmark-link:https://github.com/marcoabreu>@marcoabreu</denchmark-link>\n \n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "anirudh2290", "commentT": "2019-03-13T18:27:08Z", "comment_text": "\n \t\tas i said this happened in waitall change. waitall earlier used to hide exceptions, but with the PR: <denchmark-link:https://github.com/apache/incubator-mxnet/pull/14397>#14397</denchmark-link>\n  it is thrown. These problems would have been there from before but surfacing now.\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "anirudh2290", "commentT": "2019-03-13T22:45:28Z", "comment_text": "\n \t\tI tried these examples with the recent code change in \"WaitAll()\" on p2.16x instances and c5.18x instances. I did not see the crash.\n However,  we still need to add missing exception handling in the example so that we can prevent the crashes due to unhandled exceptions.\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "anirudh2290", "commentT": "2019-03-13T23:44:20Z", "comment_text": "\n \t\thi <denchmark-link:https://github.com/leleamol>@leleamol</denchmark-link>\n  . to reproduce you will have to use g3.8xlarge. I was able to reproduce on a g3.8xlarge.\n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "anirudh2290", "commentT": "2019-03-13T23:53:44Z", "comment_text": "\n \t\tCould someone please look the GPU memory used by the model?\n \t\t"}, "comments_14": {"comment_id": 15, "comment_author": "anirudh2290", "commentT": "2019-03-13T23:57:50Z", "comment_text": "\n \t\tthe last i observed it was around 11GB. For now I am going to use smaller batch_size for tests and later <denchmark-link:https://github.com/leleamol>@leleamol</denchmark-link>\n  will revisit and improve the cpp tests.\n \t\t"}, "comments_15": {"comment_id": 16, "comment_author": "anirudh2290", "commentT": "2019-03-14T23:26:17Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/anirudh2290>@anirudh2290</denchmark-link>\n \n I could reproduce this issue on p2.8 as well when I change the batch size to 100.\n The example uses only one GPU. With batch size = 50, the GPU memory reaches 11GB.\n \t\t"}, "comments_16": {"comment_id": 17, "comment_author": "anirudh2290", "commentT": "2019-04-12T22:08:48Z", "comment_text": "\n \t\tThis issue can be closed since the PR is merged. <denchmark-link:https://github.com/lanking520>@lanking520</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "9e4ee992f90e7da6cf52fb2664f7aaeffa8ccb62", "commit_author": "Amol Lele", "commitT": "2019-04-02 16:23:54-07:00", "commit_complexity": {"commit_NLOC": "0.16666666666666666", "commit_CCN": "0.16666666666666666", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\alexnet.cpp", "file_new_name": "cpp-package\\example\\alexnet.cpp", "file_complexity": {"file_NLOC": "290", "file_CCN": "15", "file_NToken": "2314"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "231,356", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc", "method_startline": "213", "method_endline": "358", "method_complexity": {"method_NLOC": "109", "method_CCN": "13", "method_NToken": "934", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\charRNN.cpp", "file_new_name": "cpp-package\\example\\charRNN.cpp", "file_complexity": {"file_NLOC": "597", "file_CCN": "102", "file_NToken": "5915"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "725,751", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc,argv", "method_startline": "709", "method_endline": "753", "method_complexity": {"method_NLOC": "38", "method_CCN": "8", "method_NToken": "354", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\googlenet.cpp", "file_new_name": "cpp-package\\example\\googlenet.cpp", "file_complexity": {"file_NLOC": "144", "file_CCN": "14", "file_NToken": "1649"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "127,196", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc", "method_startline": "116", "method_endline": "198", "method_complexity": {"method_NLOC": "69", "method_CCN": "11", "method_NToken": "573", "method_nesting_level": "0"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\inception_bn.cpp", "file_new_name": "cpp-package\\example\\inception_bn.cpp", "file_complexity": {"file_NLOC": "198", "file_CCN": "18", "file_NToken": "2176"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "175,259", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc", "method_startline": "159", "method_endline": "261", "method_complexity": {"method_NLOC": "84", "method_CCN": "13", "method_NToken": "695", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\lenet.cpp", "file_new_name": "cpp-package\\example\\lenet.cpp", "file_complexity": {"file_NLOC": "189", "file_CCN": "23", "file_NToken": "1539"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "261,265", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc", "method_startline": "260", "method_endline": "267", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "49", "method_nesting_level": "0"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\lenet_with_mxdataiter.cpp", "file_new_name": "cpp-package\\example\\lenet_with_mxdataiter.cpp", "file_complexity": {"file_NLOC": "134", "file_CCN": "14", "file_NToken": "1201"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "97,201", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc", "method_startline": "79", "method_endline": "203", "method_complexity": {"method_NLOC": "93", "method_CCN": "12", "method_NToken": "810", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\mlp.cpp", "file_new_name": "cpp-package\\example\\mlp.cpp", "file_complexity": {"file_NLOC": "124", "file_CCN": "15", "file_NToken": "1084"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "177,180", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc,argv", "method_startline": "175", "method_endline": "182", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "46", "method_nesting_level": "0"}}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\mlp_cpu.cpp", "file_new_name": "cpp-package\\example\\mlp_cpu.cpp", "file_complexity": {"file_NLOC": "95", "file_CCN": "14", "file_NToken": "848"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "75,145", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc,argv", "method_startline": "51", "method_endline": "147", "method_complexity": {"method_NLOC": "73", "method_CCN": "10", "method_NToken": "625", "method_nesting_level": "0"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\mlp_csv.cpp", "file_new_name": "cpp-package\\example\\mlp_csv.cpp", "file_complexity": {"file_NLOC": "172", "file_CCN": "28", "file_NToken": "1467"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "159,273", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc,argv", "method_startline": "82", "method_endline": "275", "method_complexity": {"method_NLOC": "130", "method_CCN": "21", "method_NToken": "1099", "method_nesting_level": "0"}}}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\mlp_gpu.cpp", "file_new_name": "cpp-package\\example\\mlp_gpu.cpp", "file_complexity": {"file_NLOC": "104", "file_CCN": "14", "file_NToken": "944"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "75,161", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc,argv", "method_startline": "51", "method_endline": "163", "method_complexity": {"method_NLOC": "82", "method_CCN": "10", "method_NToken": "721", "method_nesting_level": "0"}}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\resnet.cpp", "file_new_name": "cpp-package\\example\\resnet.cpp", "file_complexity": {"file_NLOC": "219", "file_CCN": "25", "file_NToken": "1787"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "175,281", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "argc", "method_startline": "170", "method_endline": "283", "method_complexity": {"method_NLOC": "96", "method_CCN": "13", "method_NToken": "805", "method_nesting_level": "0"}}}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cpp-package\\example\\test_score.cpp", "file_new_name": "cpp-package\\example\\test_score.cpp", "file_complexity": {"file_NLOC": "103", "file_CCN": "16", "file_NToken": "932"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "65,83,162", "deleted_lines": "114", "method_info": {"method_name": "main", "method_params": "argc,argv", "method_startline": "56", "method_endline": "164", "method_complexity": {"method_NLOC": "81", "method_CCN": "12", "method_NToken": "709", "method_nesting_level": "0"}}}}}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "cpp-package\\example\\utils.h", "file_new_name": "cpp-package\\example\\utils.h", "file_complexity": {"file_NLOC": "36", "file_CCN": "8", "file_NToken": "259"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "30,31,32,33,34,35,36,37,38", "deleted_lines": null}}}}}}