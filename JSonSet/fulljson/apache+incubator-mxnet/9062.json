{"BR": {"BR_id": "9062", "BR_author": "eric-haibin-lin", "BRopenT": "2017-12-14T02:40:01Z", "BRcloseT": "2018-04-10T17:12:35Z", "BR_text": {"BRsummary": "sample_multinomial crashes on vector input", "BRdescription": "\n Note: Providing complete information in the most concise form is the best way to get help. This issue template serves as the checklist for essential information to most of the technical issues and bug reports. For non-technical issues and feature requests, feel free to present the information in what you believe is the best form.\n For Q & A and discussion, please start a discussion thread at <denchmark-link:https://discuss.mxnet.io>https://discuss.mxnet.io</denchmark-link>\n \n <denchmark-h:h2>Description</denchmark-h>\n \n  /  crashes when input probability is a vector.  <denchmark-link:https://github.com/piiswrong>@piiswrong</denchmark-link>\n \n <denchmark-h:h2>Environment info (Required)</denchmark-h>\n \n Deep Learning AMI Ubunut\n Package used (Python/R/Scala/Julia): python\n (I'm using ...)\n <denchmark-h:h2>Build info (Required if built from source)</denchmark-h>\n \n Compiler (gcc/clang/mingw/visual studio):\n MXNet commit hash: <denchmark-link:https://github.com/apache/incubator-mxnet/commit/41394a448a92efbe7704fe21c48a8504fd8d3edc>41394a4</denchmark-link>\n \n (Paste the output of  here.)\n Build config:\n (Paste the content of config.mk, or the build command.)\n <denchmark-code>cp make/config.mk .\n echo \"USE_BLAS=openblas\" >>config.mk\n echo \"ADD_CFLAGS += -I/usr/include/openblas\" >>config.mk\n echo \"USE_CUDA=1\" >>config.mk\n echo \"USE_CUDA_PATH=/usr/local/cuda\" >>config.mk\n echo \"USE_CUDNN=1\" >>config.mk\n </denchmark-code>\n \n <denchmark-h:h2>Error Message:</denchmark-h>\n \n (Paste the complete error message, including stack trace.)\n <denchmark-h:h2>Minimum reproducible example</denchmark-h>\n \n (If you are using your own code, please provide a short script that reproduces the error. Otherwise, please provide link to the existing example.)\n <denchmark-code>>>> import mxnet as mx\n >>> prob = mx.nd.ones((3,)) / 3\n >>> prob\n \n [ 0.33333334  0.33333334  0.33333334]\n <NDArray 3 @cpu(0)>\n >>> mx.nd.sample_multinomial(prob, shape=(25), get_prob=True)\n [\n [1 1 2 2 1 2 1 2 1 1 1 1 1 0 2 0 2 0 1 1 2 2 1 1 1]\n <NDArray 25 @cpu(0)>,\n -1.0986123085\n <NDArray  @cpu(0)>]\n >>> mx.nd.sample_multinomial(prob, shape=(25), get_prob=True)\n *** Error in `python': free(): invalid next size (fast): 0x00007f8700004db0 ***\n Bus error (core dumped)\n \n </denchmark-code>\n \n <denchmark-h:h2>Steps to reproduce</denchmark-h>\n \n (Paste the commands you ran that produced the error.)\n \n \n \n \n <denchmark-h:h2>What have you tried to solve it?</denchmark-h>\n \n \n \n \n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "eric-haibin-lin", "commentT": "2017-12-14T21:09:52Z", "comment_text": "\n \t\tThese are deprecated. use mx.nd.random.multinomial now.\n We should fix the document\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "eric-haibin-lin", "commentT": "2017-12-14T21:11:50Z", "comment_text": "\n \t\tAlso core dump if mx.nd.random.multinomial is used\n \t\t"}}}, "commit": {"commit_id": "4342bd1f56833178a3ba613c43f739a4c5267144", "commit_author": "Hao Jin", "commitT": "2018-04-05 11:30:42-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\operator\\random\\sample_multinomial_op.h", "file_new_name": "src\\operator\\random\\sample_multinomial_op.h", "file_complexity": {"file_NLOC": "144", "file_CCN": "27", "file_NToken": "1341"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "73,76", "deleted_lines": "73,76", "method_info": {"method_name": "mxnet::op::SampleMultinomialOpShape", "method_params": "attrs,in_attrs,out_attrs", "method_startline": "60", "method_endline": "91", "method_complexity": {"method_NLOC": "29", "method_CCN": "10", "method_NToken": "314", "method_nesting_level": "2"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\python\\unittest\\test_random.py", "file_new_name": "tests\\python\\unittest\\test_random.py", "file_complexity": {"file_NLOC": "512", "file_CCN": "85", "file_NToken": "6365"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306", "deleted_lines": "279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301", "method_info": {"method_name": "test_sample_multinomial", "method_params": "", "method_startline": "278", "method_endline": "306", "method_complexity": {"method_NLOC": "26", "method_CCN": "5", "method_NToken": "417", "method_nesting_level": "0"}}}}}}}}