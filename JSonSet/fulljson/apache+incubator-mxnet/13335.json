{"BR": {"BR_id": "13335", "BR_author": "yajiedesign", "BRopenT": "2018-11-20T10:41:39Z", "BRcloseT": "2019-07-13T02:28:09Z", "BR_text": {"BRsummary": "MXPredCreate lost dtype", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n when use MXPredCreate with int8.it will  Type inconsistent error.\n I find <denchmark-link:https://github.com/apache/incubator-mxnet/blob/master/src/c_api/c_predict_api.cc#L213>https://github.com/apache/incubator-mxnet/blob/master/src/c_api/c_predict_api.cc#L213</denchmark-link>\n  cause data dtype to lose.And then cause Type inconsistent.\n <denchmark-h:h2>Environment info (Required)</denchmark-h>\n \n ----------Python Info----------\n Version      : 3.6.0\n Compiler     : MSC v.1900 64 bit (AMD64)\n Build        : ('default', 'Dec 23 2016 11:57:41')\n Arch         : ('64bit', 'WindowsPE')\n ------------Pip Info-----------\n Version      : 18.1\n Directory    : D:\\Anaconda3\\lib\\site-packages\\pip\n ----------MXNet Info-----------\n Version      : 1.3.1\n Directory    : G:\\deeplearn\\mxnet\\python\\mxnet\n Hashtag not found. Not installed from pre-built package.\n ----------System Info----------\n Platform     : Windows-10-10.0.17134-SP0\n system       : Windows\n node         : DEVEGA\n release      : 10\n version      : 10.0.17134\n Package used (Python/R/Scala/Julia):C api\n <denchmark-h:h2>Build info (Required if built from source)</denchmark-h>\n \n Compiler (gcc/clang/mingw/visual studio):visual studio\n MXNet commit hash:\n <denchmark-link:https://github.com/apache/incubator-mxnet/commit/017941e6ca177a15ec65d8bd35f7ccd20ef2b30d>017941e</denchmark-link>\n \n Build config:\n <denchmark-h:h2>Error Message:</denchmark-h>\n \n Type inconsistent, Provided = float32, inferred type = int8\n <denchmark-h:h2>Minimum reproducible example</denchmark-h>\n \n `  std::string json_file = \"int8-symbol.json\";\n std::string param_file = \"int8-0000.params\";\n BufferFile json_data(json_file);\n BufferFile param_data(param_file);\n mx_uint num_input_nodes = 1;\n const char* input_key[1] = { \"data\" };\n const char** input_keys = input_key;\n const mx_uint input_shape_indptr[2] = { 0,4 };\n const mx_uint input_shape_data[4] = { 1,static_cast<mx_uint>(3) ,static_cast<mx_uint>(1080),static_cast<mx_uint>(1920) };\n PredictorHandle pred_hnd = 0;\n int dev_type = 1;\n int dev_id = 1;\n MXPredCreate(\n static_cast<const char*>(json_data.GetBuffer()),\n static_cast<const char*>(param_data.GetBuffer()),\n static_cast(param_data.GetLength()),\n dev_type,\n dev_id,\n num_input_nodes,\n input_keys,\n input_shape_indptr,\n input_shape_data,\n &pred_hnd);\n `\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "yajiedesign", "commentT": "2018-11-20T17:23:36Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/mxnet-label-bot>@mxnet-label-bot</denchmark-link>\n  add [C Api, Bug]\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "yajiedesign", "commentT": "2019-04-12T23:20:33Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/kice>@kice</denchmark-link>\n  You seemed to have found a workaround to the problem. Can you add the fix back into apache/incubator-mxnet repo through a pull request ?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "yajiedesign", "commentT": "2019-06-12T21:30:33Z", "comment_text": "\n \t\tThis is related to <denchmark-link:https://github.com/apache/incubator-mxnet/issues/14159>#14159</denchmark-link>\n  . I am working on fixing this.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "yajiedesign", "commentT": "2019-07-13T02:28:09Z", "comment_text": "\n \t\tResolved by <denchmark-link:https://github.com/apache/incubator-mxnet/pull/15245>#15245</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "d677d1aefd30e58ff9265abd6f66617d10e2771b", "commit_author": "Anirudh Subramanian", "commitT": "2019-07-12 19:21:42-07:00", "commit_complexity": {"commit_NLOC": "0.12669683257918551", "commit_CCN": "0.7104072398190046", "commit_Nprams": "0.3167420814479638"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 10, "file_old_name": "amalgamation\\python\\mxnet_predict.py", "file_new_name": "amalgamation\\python\\mxnet_predict.py", "file_complexity": {"file_NLOC": "254", "file_CCN": "37", "file_NToken": "1770"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "158,159,160", "deleted_lines": null, "method_info": {"method_name": "_monitor_callback_wrapper.callback_handle", "method_params": "name,array,_", "method_startline": "158", "method_endline": "160", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "16", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "156,157,158,159,160,161", "deleted_lines": null, "method_info": {"method_name": "_monitor_callback_wrapper", "method_params": "callback", "method_startline": "156", "method_endline": "161", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "10", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "345,346,347,348,349,350,351", "deleted_lines": null, "method_info": {"method_name": "set_monitor_callback", "method_params": "self,callback,monitor_all", "method_startline": "345", "method_endline": "351", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "66", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "111,112,113", "deleted_lines": null, "method_info": {"method_name": "c_array_buf", "method_params": "ctype,buf", "method_startline": "111", "method_endline": "113", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "22", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76", "deleted_lines": null, "method_info": {"method_name": "c_str_array", "method_params": "strings", "method_startline": "61", "method_endline": "76", "method_complexity": {"method_NLOC": "4", "method_CCN": "2", "method_NToken": "39", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "329,334,335,336,338", "deleted_lines": null, "method_info": {"method_name": "get_output", "method_params": "self,index", "method_startline": "314", "method_endline": "343", "method_complexity": {"method_NLOC": "18", "method_CCN": "1", "method_NToken": "138", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": null, "deleted_lines": "122", "method_info": {"method_name": "__init__", "method_params": "self,symbol_file,param_raw_bytes,input_shapes,dev_type,dev_id", "method_startline": "120", "method_endline": "122", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "19", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "199", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,symbol_file,param_raw_bytes,input_shapes,dev_type,dev_id,type_dict", "method_startline": "197", "method_endline": "199", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "23", "method_nesting_level": "1"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "263,264,265,266,267,271,272,273,274", "deleted_lines": "276", "method_info": {"method_name": "forward", "method_params": "self,kwargs", "method_startline": "250", "method_endline": "279", "method_complexity": {"method_NLOC": "17", "method_CCN": "7", "method_NToken": "161", "method_nesting_level": "1"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "396", "deleted_lines": null, "method_info": {"method_name": "load_ndarray_file", "method_params": "nd_bytes", "method_startline": "354", "method_endline": "396", "method_complexity": {"method_NLOC": "29", "method_CCN": "5", "method_NToken": "292", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "include\\mxnet\\c_predict_api.h", "file_new_name": "include\\mxnet\\c_predict_api.h", "file_complexity": {"file_NLOC": "92", "file_CCN": "0", "file_NToken": "474"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "52,53,54,55,56,57,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,233,234,235,236,237,238,239,240,241,242,243,244,328,329,330,331,332,333,334,335,336", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 9, "file_old_name": "src\\c_api\\c_predict_api.cc", "file_new_name": "src\\c_api\\c_predict_api.cc", "file_complexity": {"file_NLOC": "590", "file_CCN": "61", "file_NToken": "4170"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "332,333,334", "deleted_lines": "333", "method_info": {"method_name": "MXPredCreatePartialOut", "method_params": "symbol_json_str,param_bytes,param_size,dev_type,dev_id,num_input_nodes,input_keys,input_shape_indptr,input_shape_data,num_output_nodes,output_keys,out", "method_startline": "308", "method_endline": "336", "method_complexity": {"method_NLOC": "29", "method_CCN": "1", "method_NToken": "91", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "660,661,662,663,664,665,666,667,668,669,670,671,672,673,674", "deleted_lines": null, "method_info": {"method_name": "MXPredSetMonitorCallback", "method_params": "handle,callback,callback_handle,monitor_all", "method_startline": "660", "method_endline": "674", "method_complexity": {"method_NLOC": "15", "method_CCN": "1", "method_NToken": "103", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,393,394,395", "deleted_lines": null, "method_info": {"method_name": "MXPredCreateEx", "method_params": "symbol_json_str,param_bytes,param_size,dev_type,dev_id,num_input_nodes,input_keys,input_shape_indptr,input_shape_data,num_provided_arg_dtypes,provided_arg_dtype_names,provided_arg_dtypes,out", "method_startline": "367", "method_endline": "397", "method_complexity": {"method_NLOC": "31", "method_CCN": "1", "method_NToken": "97", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "546,547,548,549,550,551,552,553,554,555,556,557,558,559", "deleted_lines": null, "method_info": {"method_name": "MXPredGetOutputType", "method_params": "handle,out_index,out_dtype", "method_startline": "546", "method_endline": "559", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "85", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "94,103,104,105,144,166,173,174,175,176,177,178,179,180,181,182,200,209,217,218,219,220,221,222,223,224,225,226,227,230,232,233,234,235,238,239,240,241,242,246,247,248", "deleted_lines": "91,213,220", "method_info": {"method_name": "_CreatePartialOut", "method_params": "symbol_json_str,param_bytes,param_size,dev_type,dev_id,num_input_nodes,input_keys,input_shape_indptr,input_shape_data,num_output_nodes,output_keys,num_threads,lazy,out", "method_startline": "87", "method_endline": "249", "method_complexity": {"method_NLOC": "149", "method_CCN": "23", "method_NToken": "1290", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "428,431,432,433", "deleted_lines": null, "method_info": {"method_name": "MXPredCreateMultiThread", "method_params": "symbol_json_str,param_bytes,param_size,dev_type,dev_id,num_input_nodes,input_keys,input_shape_indptr,input_shape_data,num_threads,out", "method_startline": "399", "method_endline": "435", "method_complexity": {"method_NLOC": "36", "method_CCN": "2", "method_NToken": "127", "method_nesting_level": "0"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "94,103,104,105,144,166,173,174,175,176,177,178,179,180,181,182,200,209,217,218,219,220,221,222,223,224,225,226,227,230,232,233,234,235,238,239,240,241,242,246,247,248,257,258,259,260,261,262,268,270,271,272,273,274,275,281,291", "deleted_lines": "91,213,220,298", "method_info": {"method_name": "_CreatePartialOut", "method_params": "symbol_json_str,param_bytes,param_size,dev_type,dev_id,num_input_nodes,input_keys,input_shape_indptr,input_shape_data,num_output_nodes,output_keys,num_threads,lazy,num_provided_arg_dtypes,provided_arg_dtype_names,provided_arg_dtypes,out", "method_startline": "90", "method_endline": "306", "method_complexity": {"method_NLOC": "195", "method_CCN": "32", "method_NToken": "1662", "method_nesting_level": "0"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "522", "deleted_lines": null, "method_info": {"method_name": "MXPredReshape", "method_params": "num_input_nodes,input_keys,input_shape_indptr,input_shape_data,handle,out", "method_startline": "437", "method_endline": "526", "method_complexity": {"method_NLOC": "82", "method_CCN": "8", "method_NToken": "745", "method_nesting_level": "0"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "358,359,360,361,362,363,364,365", "deleted_lines": null, "method_info": {"method_name": "MXPredCreate", "method_params": "symbol_json_str,param_bytes,param_size,dev_type,dev_id,num_input_nodes,input_keys,input_shape_indptr,input_shape_data,out", "method_startline": "338", "method_endline": "365", "method_complexity": {"method_NLOC": "28", "method_CCN": "1", "method_NToken": "83", "method_nesting_level": "0"}}}}}, "file_3": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\python\\gpu\\test_predictor.py", "file_complexity": {"file_NLOC": "93", "file_CCN": "7", "file_NToken": "912"}}}}}