{"BR": {"BR_id": "17514", "BR_author": "olk", "BRopenT": "2020-02-04T16:56:34Z", "BRcloseT": "2020-02-05T04:40:56Z", "BR_text": {"BRsummary": "C++-Package examples broken", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n Compiling clean checkout from github causes multiple undefined reference linker errors.\n This kind of errors usually happen if compilation units are linked together that have been compiled with different C++ standards.\n <denchmark-h:h3>Error Message</denchmark-h>\n \n /usr/bin/ld: libmxnet.a(c_api.cc.o): in function MXNDArrayReshape': c_api.cc:(.text+0x56a7): undefined reference to std::__cxx11::basic_ostringstream<\n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n git clone --recursive <denchmark-link:https://github.com/olk/incubator-mxnet/>https://github.com/olk/incubator-mxnet/</denchmark-link>\n \n cd incubator-mxnet/\n mkdir build && cd build\n cmake -DUSE_NCCL=1 -DUSE_CPP_PACKAGE=1 -DCMAKE_BUILD_TYPE=Release -GNinja ..\n ninja -v -j 32\n <denchmark-h:h2>What have you tried to solve it?</denchmark-h>\n \n The issue was introduced by commit:\n <denchmark-link:https://github.com/apache/incubator-mxnet/commit/230ceee5d9e0e02e58be69dad1c4ffdadbaa1bd9>230ceee</denchmark-link>\n   (<denchmark-link:https://github.com/apache/incubator-mxnet/pull/17031>#17031</denchmark-link>\n )\n The sources can be  compiled and  with <denchmark-link:https://github.com/apache/incubator-mxnet/commit/ffeebe46ab5efa8f713161ed466c47f9609fa8d6>ffeebe4</denchmark-link>\n  fix int8 add ut (<denchmark-link:https://github.com/apache/incubator-mxnet/pull/17166>#17166</denchmark-link>\n ) as HEAD (== the commit before <denchmark-link:https://github.com/apache/incubator-mxnet/commit/230ceee5d9e0e02e58be69dad1c4ffdadbaa1bd9>230ceee</denchmark-link>\n ).\n <denchmark-h:h2>Environment</denchmark-h>\n \n <denchmark-code>----------Python Info----------\n Version      : 3.8.1\n Compiler     : GCC 9.2.0\n Build        : ('default', 'Jan 22 2020 06:38:00')\n Arch         : ('64bit', 'ELF')\n ------------Pip Info-----------\n Version      : 19.3\n Directory    : /usr/lib/python3.8/site-packages/pip\n ----------MXNet Info-----------\n Version      : 1.5.1\n Directory    : /home/graemer/Projekte/MXNet/apache-mxnet-src-1.5.1-incubating/python/mxnet\n Num GPUs     : 2\n Hashtag not found. Not installed from pre-built package.\n ----------System Info----------\n Platform     : Linux-5.5.1-arch1-1-x86_64-with-glibc2.2.5\n system       : Linux\n node         : e5lx\n release      : 5.5.1-arch1-1\n version      : #1 SMP PREEMPT Sat, 01 Feb 2020 16:38:40 +0000\n ----------Hardware Info----------\n machine      : x86_64\n processor    : \n Architektur:                     x86_64\n CPU Operationsmodus:             32-bit, 64-bit\n Byte-Reihenfolge:                Little Endian\n Adressgr\u00f6\u00dfen:                    46 bits physical, 48 bits virtual\n CPU(s):                          32\n Liste der Online-CPU(s):         0-31\n Thread(s) pro Kern:              2\n Kern(e) pro Sockel:              8\n Sockel:                          2\n NUMA-Knoten:                     2\n Anbieterkennung:                 GenuineIntel\n Prozessorfamilie:                6\n Modell:                          79\n Modellname:                      Intel(R) Xeon(R) CPU E5-2620 v4 @ 2.10GHz\n Stepping:                        1\n CPU MHz:                         2260.712\n Maximale Taktfrequenz der CPU:   3000,0000\n Minimale Taktfrequenz der CPU:   1200,0000\n BogoMIPS:                        4192.56\n Virtualisierung:                 VT-x\n L1d Cache:                       512 KiB\n L1i Cache:                       512 KiB\n L2 Cache:                        4 MiB\n L3 Cache:                        40 MiB\n NUMA-Knoten0 CPU(s):             0-7,16-23\n NUMA-Knoten1 CPU(s):             8-15,24-31\n Vulnerability Itlb multihit:     KVM: Mitigation: Split huge pages\n Vulnerability L1tf:              Mitigation; PTE Inversion; VMX conditional cache flushes, SMT vulnerable\n Vulnerability Mds:               Mitigation; Clear CPU buffers; SMT vulnerable\n Vulnerability Meltdown:          Mitigation; PTI\n Vulnerability Spec store bypass: Mitigation; Speculative Store Bypass disabled via prctl and seccomp\n Vulnerability Spectre v1:        Mitigation; usercopy/swapgs barriers and __user pointer sanitization\n Vulnerability Spectre v2:        Mitigation; Full generic retpoline, IBPB conditional, IBRS_FW, STIBP conditional, RSB filling\n Vulnerability Tsx async abort:   Mitigation; Clear CPU buffers; SMT vulnerable\n Markierungen:                    fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe sysca\n                                  ll nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq\n                                   dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_\n                                  timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch cpuid_fault epb cat_l3 cdp_l3 invpcid_single pti intel_ppin ssbd ib\n                                  rs ibpb stibp tpr_shadow vnmi flexpriority ept vpid ept_ad fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm cqm r\n                                  dt_a rdseed adx smap intel_pt xsaveopt cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local dtherm ida arat pln pts md_clear flu\n                                  sh_l1d\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 2, "comment_author": "olk", "commentT": "2020-02-04T18:36:23Z", "comment_text": "\n \t\tI can't reproduce your error, but I do observe\n <denchmark-code>../tests/../cpp-package/include/mxnet-cpp/optimizer.hpp:37:10: fatal error: mxnet-cpp/op.h: No such file or directory\n  #include \"mxnet-cpp/op.h\"\n           ^~~~~~~~~~~~~~~~\n compilation terminated.\n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 4, "comment_author": "olk", "commentT": "2020-02-04T20:19:17Z", "comment_text": "\n \t\tI ran bisect, and actually <denchmark-link:https://github.com/apache/incubator-mxnet/commit/b1e491182fa9c15da89f1b701778de3a1421811b>b1e4911</denchmark-link>\n  is at fault here:\n <denchmark-link:https://github.com/anirudh2290>@anirudh2290</denchmark-link>\n  note that to reproduce this issue, you need a fresh checkout of the repository.\n To reproduce:\n git clone --recursive https://github.com/apache/incubator-mxnet/ mxnet; cd mxnet; git checkout b1e491182fa9c15da89f1b701778de3a1421811b; rm -rf *; git checkout .; git submodule update --init --recursive; mkdir build; cd build; cmake -DUSE_CPP_PACKAGE=1 -DCMAKE_BUILD_TYPE=Release -GNinja -DUSE_CUDA=OFF ..; ninja\n \t\t"}, "comments_2": {"comment_id": 5, "comment_author": "olk", "commentT": "2020-02-04T21:00:59Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/olk>@olk</denchmark-link>\n  please try again with a fresh checkout of <denchmark-link:https://github.com/apache/incubator-mxnet/commit/a726c406964b9cd17efa826738a662e09d973972>a726c40</denchmark-link>\n . This works on my machine.\n \t\t"}, "comments_3": {"comment_id": 6, "comment_author": "olk", "commentT": "2020-02-04T21:22:58Z", "comment_text": "\n \t\tAlso need to figure out why CI didn't detect this issue before closing this issue\n \t\t"}, "comments_4": {"comment_id": 7, "comment_author": "olk", "commentT": "2020-02-04T21:25:05Z", "comment_text": "\n \t\tThis also fails on my machine:\n <denchmark-code>../tests/../cpp-package/include/mxnet-cpp/optimizer.hpp:37:10: fatal error: mxnet-cpp/op.h: No such file or directory\n </denchmark-code>\n \n \t\t"}, "comments_5": {"comment_id": 8, "comment_author": "olk", "commentT": "2020-02-04T21:25:48Z", "comment_text": "\n \t\t<denchmark-code>[753/790] /usr/bin/ccache /usr/bin/c++  -DDMLC_LOG_STACK_TRACE_SIZE=0 -DDMLC_MODERN_THREAD_LOCAL=0 -DDMLC_USE_CXX11=1 -DMSHADOW_FORCE_STREAM -DMSHADOW_INT64_TENSOR_SIZE=0 -DMSHADOW_IN_CXX11 -DMSHADOW_USE_CBLAS=1 -DMSHADOW_USE_CUDA=1 -DMSHADOW_USE_CUDNN=1 -DMSHADOW_USE_MKL=0 -DMSHADOW_USE_SSE=1 -DMXNET_ENABLE_CUDA_RTC=1 -DMXNET_USE_BLAS_OPEN=1 -DMXNET_USE_CPP_PACKAGE=1 -DMXNET_USE_CUDA=1 -DMXNET_USE_LAPACK=1 -DMXNET_USE_MKLDNN=1 -DMXNET_USE_NCCL=0 -DMXNET_USE_NVTX=1 -DMXNET_USE_OPENCV=1 -DMXNET_USE_OPENMP=1 -DMXNET_USE_OPERATOR_TUNING=1 -DMXNET_USE_SIGNAL_HANDLER=1 -DNDEBUG=1 -DUSE_CUD\n NN -I../3rdparty/mkldnn/include -I3rdparty/mkldnn/include -I../include -I../src -I../3rdparty/mshadow -I../3rdparty/nvidia_cub -I../3rdparty/tvm/nnvm/include -I../3rdparty/tvm/include -I../3rdparty\n /dmlc-core/include -I../3rdparty/dlpack/include -I../tests/cpp/include -I../tests/../cpp-package/include -I../3rdparty/mkldnn/src/../include -I3rdparty/dmlc-core/include -isystem /usr/include/openc\n v -isystem /usr/local/cuda/include -isystem ../3rdparty/googletest/googletest/include -isystem ../3rdparty/googletest/googletest -mf16c -Wall -Wno-unknown-pragmas -Wno-sign-compare -O3 -msse3 -std=\n c++11 -fopenmp -O3 -DNDEBUG -fPIE -MD -MT tests/CMakeFiles/mxnet_unit_tests.dir/cpp/thread_safety/thread_safety_test.cc.o -MF tests/CMakeFiles/mxnet_unit_tests.dir/cpp/thread_safety/thread_safety_t\n est.cc.o.d -o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/thread_safety/thread_safety_test.cc.o -c ../tests/cpp/thread_safety/thread_safety_test.cc\n FAILED: tests/CMakeFiles/mxnet_unit_tests.dir/cpp/thread_safety/thread_safety_test.cc.o\n /usr/bin/ccache /usr/bin/c++  -DDMLC_LOG_STACK_TRACE_SIZE=0 -DDMLC_MODERN_THREAD_LOCAL=0 -DDMLC_USE_CXX11=1 -DMSHADOW_FORCE_STREAM -DMSHADOW_INT64_TENSOR_SIZE=0 -DMSHADOW_IN_CXX11 -DMSHADOW_USE_CBLAS=1 -DMSHADOW_USE_CUDA=1 -DMSHADOW_USE_CUDNN=1 -DMSHADOW_USE_MKL=0 -DMSHADOW_USE_SSE=1 -DMXNET_ENABLE_CUDA_RTC=1 -DMXNET_USE_BLAS_OPEN=1 -DMXNET_USE_CPP_PACKAGE=1 -DMXNET_USE_CUDA=1 -DMXNET_USE_LAPACK=1 -DMXNET_USE_MKLDNN=1 -DMXNET_USE_NCCL=0 -DMXNET_USE_NVTX=1 -DMXNET_USE_OPENCV=1 -DMXNET_USE_OPENMP=1 -DMXNET_USE_OPERATOR_TUNING=1 -DMXNET_USE_SIGNAL_HANDLER=1 -DNDEBUG=1 -DUSE_CUDNN -I../3rdparty/mkldnn/include -I3rdparty/mkldnn/include -I../include -I../src -I../3rdparty/mshadow -I../3rdparty/nvidia_cub -I../3rdparty/tvm/nnvm/include -I../3rdparty/tvm/include -I../3rdparty/dmlc-core/include -I../3rdparty/dlpack/include -I../tests/cpp/include -I../tests/../cpp-package/include -I../3rdparty/mkldnn/src/../include -I3rdparty/dmlc-core/include -isystem /usr/include/opencv -isystem /usr/local/cuda/include -isystem ../3rdparty/googletest/googletest/include -isystem ../3rdparty/googletest/googletest -mf16c -Wall -Wno-unknown-pragmas -Wno-sign-compare -O3 -msse3 -std=c++11 -fopenmp -O3 -DNDEBUG -fPIE -MD -MT tests/CMakeFiles/mxnet_unit_tests.dir/cpp/thread_safety/thread_safety_test.cc.o -MF tests/CMakeFiles/mxnet_unit_tests.dir/cpp/thread_safety/thread_safety_test.cc.o.d -o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/thread_safety/thread_safety_test.cc.o -c ../tests/cpp/thread_safety/thread_safety_test.cc\n In file included from ../tests/../cpp-package/include/mxnet-cpp/MxNetCpp.h:35:0,\n                  from ../tests/cpp/thread_safety/thread_safety_test.cc:36:\n ../tests/../cpp-package/include/mxnet-cpp/optimizer.hpp:37:10: fatal error: mxnet-cpp/op.h: No such file or directory\n </denchmark-code>\n \n \t\t"}, "comments_6": {"comment_id": 9, "comment_author": "olk", "commentT": "2020-02-04T21:59:35Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/leezu>@leezu</denchmark-link>\n  My HEAD points to <denchmark-link:https://github.com/apache/incubator-mxnet/commit/71a5c9e65dca8e783301fdef16480438a5b6a780>71a5c9e</denchmark-link>\n  (<denchmark-link:https://github.com/apache/incubator-mxnet/commit/a726c406964b9cd17efa826738a662e09d973972>a726c40</denchmark-link>\n  is already in the commit history)\n \t\t"}, "comments_7": {"comment_id": 10, "comment_author": "olk", "commentT": "2020-02-04T22:08:42Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/olk>@olk</denchmark-link>\n , my point is that it's broken after <denchmark-link:https://github.com/apache/incubator-mxnet/commit/a726c406964b9cd17efa826738a662e09d973972>a726c40</denchmark-link>\n . Try checking out <denchmark-link:https://github.com/apache/incubator-mxnet/commit/a726c406964b9cd17efa826738a662e09d973972>a726c40</denchmark-link>\n  in a clean checkout and please rerun the build\n \t\t"}, "comments_8": {"comment_id": 11, "comment_author": "olk", "commentT": "2020-02-04T22:09:22Z", "comment_text": "\n \t\tThe problem is that my dev machine runs Arch Linux(rolling releases).\n At the moment Arch Linux uses GCC-9.2 as default compiler + CUDA-10.2.\n But CUDA-10.2 supports only GCC-8.3 and the Arch Linux CUDA package is linked statically against GCC-8.\n After downgrading my system to the last version that uses the GCC-8.3 as the default (and CUDA-10.1 -> 2019/05/24) I could compile and link mxnet from github checkout.\n But I'm still wondering why compiling and linking with GCC-9.2/CUDA-10.2 + commit <denchmark-link:https://github.com/apache/incubator-mxnet/commit/ffeebe46ab5efa8f713161ed466c47f9609fa8d6>ffeebe4</denchmark-link>\n  as HEAD works but fails with <denchmark-link:https://github.com/apache/incubator-mxnet/commit/230ceee5d9e0e02e58be69dad1c4ffdadbaa1bd9>230ceee</denchmark-link>\n ?\n \t\t"}, "comments_9": {"comment_id": 12, "comment_author": "olk", "commentT": "2020-02-04T23:20:32Z", "comment_text": "\n \t\t\n But I'm still wondering why compiling and linking with GCC-9.2/CUDA-10.2 + commit ffeebe4 as HEAD works but fails with 230ceee?\n \n You can see that <denchmark-link:https://github.com/apache/incubator-mxnet/commit/230ceee5d9e0e02e58be69dad1c4ffdadbaa1bd9>230ceee</denchmark-link>\n  cleans up a lot of code, which probably affects the order in which libraries are linked. As you say, GCC 9.2 is unsupported by Cuda, so it's probably undefined behaviour and worked for some lucky reason with the old build script.\n Another reason could be that there is a bug in upstream GCC9.2 / linker.\n Feel free to investigate this further. If there's any bug in our build script, we're happy to update it.\n Also sorry to take over your issue to track the bug introduced by <denchmark-link:https://github.com/apache/incubator-mxnet/pull/16654>#16654</denchmark-link>\n \n \t\t"}, "comments_10": {"comment_id": 13, "comment_author": "olk", "commentT": "2020-02-06T18:33:36Z", "comment_text": "\n \t\tis this resolved?\n \t\t"}, "comments_11": {"comment_id": 14, "comment_author": "olk", "commentT": "2020-02-06T18:36:28Z", "comment_text": "\n \t\tC++ package problem is fixed by <denchmark-link:https://github.com/apache/incubator-mxnet/pull/17520>#17520</denchmark-link>\n .\n \t\t"}, "comments_12": {"comment_id": 15, "comment_author": "olk", "commentT": "2020-02-14T12:49:48Z", "comment_text": "\n \t\ttry with\n <denchmark-code>    -DCUDA_HOST_COMPILER=/usr/bin/cc-8 \\\n     -DCMAKE_C_COMPILER=/usr/bin/cc-8 \\\n     -DCMAKE_C_COMPILER_AR=/usr/bin/gcc-ar-8 \\\n     -DCMAKE_C_COMPILER_RANLIB=/usr/bin/gcc-ranlib-8 \\\n     -DCMAKE_CXX_COMPILER=/usr/bin/c++-8 \\\n     -DCMAKE_CXX_COMPILER_AR=/usr/bin/gcc-ar-8 \\\n     -DCMAKE_CXX_COMPILER_RANLIB=/usr/bin/gcc-ranlib-8\n </denchmark-code>\n \n \t\t"}}}, "commit": {"commit_id": "be89d2017441ec023ec868f4e733f04eb573f4bc", "commit_author": "Anirudh Subramanian", "commitT": "2020-02-04 19:20:21-08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tests\\CMakeLists.txt", "file_new_name": "tests\\CMakeLists.txt", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "40,41,42", "deleted_lines": null}}}}}}