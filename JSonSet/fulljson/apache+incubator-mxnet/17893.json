{"BR": {"BR_id": "17893", "BR_author": "sxjscience", "BRopenT": "2020-03-23T19:52:15Z", "BRcloseT": "2020-04-15T23:12:30Z", "BR_text": {"BRsummary": "[Bug][Numpy] Wrong gradient of np.where", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n Example 1: Using np.where(array, array, scalar)\n import mxnet as mx\n mx.npx.set_np()\n \n a = mx.np.array([1, 0, 1])\n b = mx.np.array([2, 3, 4])\n \n b.attach_grad()\n \n with mx.autograd.record():\n     c = mx.np.where(a, b, -1)\n     c.backward()\n print(b.grad)\n Output: [0. 1. 0.]\n Example 2: Using np.where(array, array, array)\n import mxnet as mx\n mx.npx.set_np()\n \n a = mx.np.array([1, 0, 1])\n b = mx.np.array([2, 3, 4])\n \n b.attach_grad()\n \n with mx.autograd.record():\n     c = mx.np.where(a, b, mx.np.array([-1, -1, -1]))\n     c.backward()\n print(b.grad)\n Output: [1. 0. 1.]\n The second one is correct.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "sxjscience", "commentT": "2020-03-24T06:16:39Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/hgt312>@hgt312</denchmark-link>\n  I think that there might be some issue in the backward + scalar case of where: \n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "sxjscience", "commentT": "2020-03-24T08:43:26Z", "comment_text": "\n \t\tFixed in <denchmark-link:https://github.com/apache/incubator-mxnet/pull/17899>#17899</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "57c785a0a92041cdd2f1d8888aa5b78f84cf4f73", "commit_author": "Huang, Guangtai", "commitT": "2020-04-10 00:00:34-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\operator\\numpy\\np_where_op-inl.h", "file_new_name": "src\\operator\\numpy\\np_where_op-inl.h", "file_complexity": {"file_NLOC": "363", "file_CCN": "48", "file_NToken": "4068"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "372,374,383", "deleted_lines": "372,374,383", "method_info": {"method_name": "mxnet::op::NumpyWhereScalarOpBackward", "method_params": "attrs,ctx,inputs,req,outputs", "method_startline": "327", "method_endline": "396", "method_complexity": {"method_NLOC": "64", "method_CCN": "8", "method_NToken": "789", "method_nesting_level": "2"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 15, "file_old_name": "tests\\python\\unittest\\test_numpy_op.py", "file_new_name": "tests\\python\\unittest\\test_numpy_op.py", "file_complexity": {"file_NLOC": "7446", "file_CCN": "1781", "file_NToken": "82642"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "3839", "deleted_lines": "3839", "method_info": {"method_name": "test_np_lognormal_grad", "method_params": "", "method_startline": "3809", "method_endline": "3854", "method_complexity": {"method_NLOC": "38", "method_CCN": "5", "method_NToken": "369", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "6516", "deleted_lines": "6516", "method_info": {"method_name": "test_np_flipud_fliplr", "method_params": "", "method_startline": "6509", "method_endline": "6558", "method_complexity": {"method_NLOC": "40", "method_CCN": "9", "method_NToken": "309", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "7675,7683", "deleted_lines": "7675,7683", "method_info": {"method_name": "test_np_quantile", "method_params": "", "method_startline": "7630", "method_endline": "7686", "method_complexity": {"method_NLOC": "41", "method_CCN": "11", "method_NToken": "496", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "2744,2747,2817,2838,2845", "deleted_lines": "2744,2747,2817,2838,2845", "method_info": {"method_name": "test_np_insert", "method_params": "", "method_startline": "2738", "method_endline": "2846", "method_complexity": {"method_NLOC": "85", "method_CCN": "15", "method_NToken": "1262", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "7293", "deleted_lines": "7293", "method_info": {"method_name": "test_np_pad", "method_params": "", "method_startline": "7285", "method_endline": "7338", "method_complexity": {"method_NLOC": "40", "method_CCN": "10", "method_NToken": "472", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "4100", "deleted_lines": "4100", "method_info": {"method_name": "test_np_random_rayleigh", "method_params": "", "method_startline": "4085", "method_endline": "4118", "method_complexity": {"method_NLOC": "25", "method_CCN": "5", "method_NToken": "244", "method_nesting_level": "0"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "472,534", "deleted_lines": "472,534", "method_info": {"method_name": "test_np_matmul", "method_params": "", "method_startline": "425", "method_endline": "555", "method_complexity": {"method_NLOC": "69", "method_CCN": "8", "method_NToken": "730", "method_nesting_level": "0"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "3590", "deleted_lines": "3590", "method_info": {"method_name": "test_np_clip", "method_params": "", "method_startline": "3566", "method_endline": "3633", "method_complexity": {"method_NLOC": "53", "method_CCN": "11", "method_NToken": "458", "method_nesting_level": "0"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "7904", "deleted_lines": "7904", "method_info": {"method_name": "test_np_ediff1d", "method_params": "", "method_startline": "7806", "method_endline": "7915", "method_complexity": {"method_NLOC": "70", "method_CCN": "9", "method_NToken": "613", "method_nesting_level": "0"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "4759", "deleted_lines": "4759", "method_info": {"method_name": "test_np_linalg_norm", "method_params": "", "method_startline": "4689", "method_endline": "4803", "method_complexity": {"method_NLOC": "90", "method_CCN": "27", "method_NToken": "1200", "method_nesting_level": "0"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "8604", "deleted_lines": null, "method_info": {"method_name": "test_np_diag_indices_from", "method_params": "", "method_startline": "8590", "method_endline": "8622", "method_complexity": {"method_NLOC": "26", "method_CCN": "7", "method_NToken": "320", "method_nesting_level": "0"}}}, "hunk_11": {"Ismethod": 1, "added_lines": "3678,3685,3695", "deleted_lines": "3678,3685,3695", "method_info": {"method_name": "test_npx_constraint_check", "method_params": "", "method_startline": "3673", "method_endline": "3709", "method_complexity": {"method_NLOC": "23", "method_CCN": "5", "method_NToken": "188", "method_nesting_level": "0"}}}, "hunk_12": {"Ismethod": 1, "added_lines": "472", "deleted_lines": "472", "method_info": {"method_name": "test_np_matmul.matmul_backward", "method_params": "a,b", "method_startline": "433", "method_endline": "484", "method_complexity": {"method_NLOC": "23", "method_CCN": "2", "method_NToken": "238", "method_nesting_level": "1"}}}, "hunk_13": {"Ismethod": 1, "added_lines": "7701,7738,7746", "deleted_lines": "7701,7738,7746", "method_info": {"method_name": "test_np_percentile", "method_params": "", "method_startline": "7691", "method_endline": "7749", "method_complexity": {"method_NLOC": "43", "method_CCN": "11", "method_NToken": "542", "method_nesting_level": "0"}}}, "hunk_14": {"Ismethod": 1, "added_lines": "8466,8467,8468,8469,8470,8471,8472,8473,8474,8475,8476,8477,8478,8479", "deleted_lines": null, "method_info": {"method_name": "test_np_where", "method_params": "", "method_startline": "8423", "method_endline": "8479", "method_complexity": {"method_NLOC": "47", "method_CCN": "5", "method_NToken": "743", "method_nesting_level": "0"}}}}}}}}