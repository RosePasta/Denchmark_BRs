{"BR": {"BR_id": "12787", "BR_author": "ssbusc1", "BRopenT": "2018-10-11T01:04:04Z", "BRcloseT": "2019-05-07T12:10:34Z", "BR_text": {"BRsummary": "nd.sparse.clip operation return type is different from the input", "BRdescription": "\n As per the documentation at <denchmark-link:https://mxnet.incubator.apache.org/api/python/ndarray/sparse.html#mxnet.ndarray.sparse.clip>https://mxnet.incubator.apache.org/api/python/ndarray/sparse.html#mxnet.ndarray.sparse.clip</denchmark-link>\n , the nd.sparse.clip operation should return a CSR for a CSR input. But it is returning a RowSparseNDArray. This seems like a bug, as clipping may only be one of multiple steps in processing the sparse input, and the change in type adds friction.\n Test case:\n <denchmark-code>a = nd.ones((2, 3)) * 2\n a.asnumpy()\n array([[ 2., 2., 2.],\n            [ 2., 2., 2.]], dtype=float32)\n b = a.tostype(\u2018csr\u2019)\n b\n <CSRNDArray 2x3 @cpu(0)>\n  \n b.asnumpy()\n array([[ 2., 2., 2.],\n             [ 2., 2., 2.]], dtype=float32)\n \n nd.sparse.clip(b, 0, 1)\n <RowSparseNDArray 2x3 @cpu(0)>\n </denchmark-code>\n \n Diagnostics:\n <denchmark-code>----------Python Info----------\n ('Version      :', '2.7.12')\n ('Compiler     :', 'GCC 4.2.1 Compatible Apple LLVM 7.3.0 (clang-703.0.31)')\n ('Build        :', ('default', 'Jun 29 2016 14:05:02'))\n ('Arch         :', ('64bit', ''))\n ------------Pip Info-----------\n ('Version      :', '18.1')\n ('Directory    :', '/usr/local/lib/python2.7/site-packages/pip')\n ----------MXNet Info-----------\n ('Version      :', '1.3.0')\n ('Directory    :', '/usr/local/lib/python2.7/site-packages/mxnet')\n ('Commit Hash   :', 'b3be92f4a48bce62a5a8424271871c2f81c8f7f1')\n ----------System Info----------\n ('Platform     :', 'Darwin-15.6.0-x86_64-i386-64bit')\n ('system       :', 'Darwin')\n ('node         :', '<redacted>')\n ('release      :', '15.6.0')\n ('version      :', 'Darwin Kernel Version 15.6.0: Thu Jun 21 20:07:40 PDT 2018; root:xnu-3248.73.11~1/RELEASE_X86_64')\n ----------Hardware Info----------\n ('machine      :', 'x86_64')\n ('processor    :', 'i386')\n machdep.cpu.brand_string: Intel(R) Core(TM) i5-4278U CPU @ 2.60GHz\n machdep.cpu.features: FPU VME DE PSE TSC MSR PAE MCE CX8 APIC SEP MTRR PGE MCA CMOV PAT PSE36 CLFSH DS ACPI MMX FXSR SSE SSE2 SS HTT TM PBE SSE3 PCLMULQDQ DTES64 MON DSCPL VMX EST TM2 SSSE3 FMA CX16 TPR PDCM SSE4.1 SSE4.2 x2APIC MOVBE POPCNT AES PCID XSAVE OSXSAVE SEGLIM64 TSCTMR AVX1.0 RDRAND F16C\n machdep.cpu.leaf7_features: SMEP ERMS RDWRFSGS TSC_THREAD_OFFSET BMI1 AVX2 BMI2 INVPCID FPU_CSDS\n machdep.cpu.extfeatures: SYSCALL XD 1GBPAGE EM64T LAHF LZCNT RDTSCP TSCI\n ----------Network Test----------\n Setting timeout: 10\n Timing for MXNet: https://github.com/apache/incubator-mxnet, DNS: 0.0122 sec, LOAD: 1.0105 sec.\n Timing for PYPI: https://pypi.python.org/pypi/pip, DNS: 0.0220 sec, LOAD: 0.7401 sec.\n Timing for FashionMNIST: https://apache-mxnet.s3-accelerate.dualstack.amazonaws.com/gluon/dataset/fashion-mnist/train-labels-idx1-ubyte.gz, DNS: 0.0586 sec, LOAD: 0.5175 sec.\n Timing for Conda: https://repo.continuum.io/pkgs/free/, DNS: 0.0217 sec, LOAD: 0.4796 sec.\n Timing for Gluon Tutorial(en): http://gluon.mxnet.io, DNS: 0.0927 sec, LOAD: 0.6083 sec.\n Timing for Gluon Tutorial(cn): https://zh.gluon.ai, DNS: 0.0297 sec, LOAD: 0.6817 sec.\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ssbusc1", "commentT": "2018-10-11T03:48:13Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ssbusc1>@ssbusc1</denchmark-link>\n  Thanks for filing this issue! We will look into this.\n <denchmark-link:https://github.com/mxnet-label-bot>@mxnet-label-bot</denchmark-link>\n  [Bug, Sparse]\n \t\t"}}}, "commit": {"commit_id": "08895b71111e11eaf60280fa59aca93fb4f62193", "commit_author": "Anirudh", "commitT": "2019-05-07 20:10:33+08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\operator\\tensor\\matrix_op.cc", "file_new_name": "src\\operator\\tensor\\matrix_op.cc", "file_complexity": {"file_NLOC": "1137", "file_CCN": "25", "file_NToken": "5863"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "772", "deleted_lines": "772"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\python\\unittest\\test_sparse_ndarray.py", "file_new_name": "tests\\python\\unittest\\test_sparse_ndarray.py", "file_complexity": {"file_NLOC": "863", "file_CCN": "156", "file_NToken": "8831"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "918", "deleted_lines": null, "method_info": {"method_name": "test_sparse_nd_fluent", "method_params": "", "method_startline": "892", "method_endline": "921", "method_complexity": {"method_NLOC": "17", "method_CCN": "4", "method_NToken": "211", "method_nesting_level": "0"}}}}}}}}