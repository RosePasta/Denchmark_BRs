{"BR": {"BR_id": "18695", "BR_author": "JeanKossaifi", "BRopenT": "2020-07-11T23:30:50Z", "BRcloseT": "2020-07-16T17:25:03Z", "BR_text": {"BRsummary": "Transpose only supports up to 6 dimensions", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n Transpose does not currently support tensors with more than 6 dimensions.\n <denchmark-h:h3>Error Message</denchmark-h>\n \n <denchmark-code>E           mxnet.base.MXNetError: Traceback (most recent call last):\n E             File \"src/operator/tensor/./matrix_op-inl.h\", line 459\n E           MXNetError: Check failed: shp.ndim() <= 6 (7 vs. 6) : Transpose support at most 6 dimensions\n </denchmark-code>\n \n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n Apply transpose to a higher-order tensor.\n <denchmark-h:h2>Environment</denchmark-h>\n \n Python 3.7.3\n MXNet 2.0.0\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "JeanKossaifi", "commentT": "2020-07-12T17:53:35Z", "comment_text": "\n \t\tThanks for reporting, Jean. I confirm that this affects numpy operators too.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "JeanKossaifi", "commentT": "2020-07-12T18:02:13Z", "comment_text": "\n \t\tTwo changes will help immediately:\n \n Collapse consecutive axes of the input array into a single axis here https://github.com/apache/incubator-mxnet/blob/master/src/operator/numpy/np_matrix_op-inl.h#L142-L149\n Extend the implementation to support more https://github.com/apache/incubator-mxnet/blob/master/src/operator/tensor/matrix_op-inl.h#L362-L419\n \n The root cause is really the limitation of template based programming in mshadow. Because of that choice, the axis is in template variable and thus needs to be expanded at compile time. We should move away from this approach and have a transpose implementation without mshadow instead.\n Let's focus on only the immediate changes, and I will open a separate issue for the larger change.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "JeanKossaifi", "commentT": "2020-07-13T22:29:59Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/szha>@szha</denchmark-link>\n  , I am trying to fix it and select 'Collapse consecutive axes of the input array into a single axis here when axes.ndim() > 2'.\n <denchmark-link:https://github.com/wkcn/incubator-mxnet/tree/support_transpose_dim_gt_6>https://github.com/wkcn/incubator-mxnet/tree/support_transpose_dim_gt_6</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "JeanKossaifi", "commentT": "2020-07-14T02:50:13Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/szha>@szha</denchmark-link>\n  , I create a <denchmark-link:https://github.com/wkcn/incubator-mxnet/blob/support_transpose_dim_gt_6/src/operator/tensor/matrix_op-inl.h#L324>TransposeKernel</denchmark-link>\n  and need to copy the argument (namely ) into the target context. Is there any good way to copy it?\n I try to call <denchmark-link:https://github.com/wkcn/incubator-mxnet/blob/support_transpose_dim_gt_6/src/operator/tensor/matrix_op-inl.h#L429>get_space_typed</denchmark-link>\n  to alloc a workspace, but it need to declare a temporary space in each operator which calls .\n <denchmark-h:h2>Solution</denchmark-h>\n \n I will create a new function TransposeExImpl to support up to 6 dimensions, which needs to alloc extra workspace. The original TransposeImpl will not be modified.\n \t\t"}}}, "commit": {"commit_id": "37bdf0bf981d11a89bd248b02f473211d57bc9c6", "commit_author": "JackieWu", "commitT": "2020-07-16 10:25:01-07:00", "commit_complexity": {"commit_NLOC": "0.19230769230769232", "commit_CCN": "0.10576923076923077", "commit_Nprams": "0.09615384615384616"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "src\\operator\\numpy\\np_matrix_op-inl.h", "file_new_name": "src\\operator\\numpy\\np_matrix_op-inl.h", "file_complexity": {"file_NLOC": "1619", "file_CCN": "222", "file_NToken": "13938"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "811,812,813,837,838,839,840,841,842,843,844,845,846,847", "deleted_lines": "822,823,824,825,826", "method_info": {"method_name": "mxnet::op::NumpyRollaxisBackward", "method_params": "attrs,ctx,inputs,req,outputs", "method_startline": "804", "method_endline": "848", "method_complexity": {"method_NLOC": "40", "method_CCN": "7", "method_NToken": "300", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "786,787,788,790,791,792,793,794,795,796,797,798,799,800", "deleted_lines": "782,783,785,786,787,788", "method_info": {"method_name": "mxnet::op::NumpyRollaxisCompute", "method_params": "attrs,ctx,inputs,req,outputs", "method_startline": "777", "method_endline": "801", "method_complexity": {"method_NLOC": "24", "method_CCN": "4", "method_NToken": "239", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "139,140,150,151,153,154,156,157", "deleted_lines": "137,140,151,153", "method_info": {"method_name": "mxnet::op::NumpyTranspose", "method_params": "attrs,ctx,inputs,req,outputs", "method_startline": "132", "method_endline": "159", "method_complexity": {"method_NLOC": "28", "method_CCN": "6", "method_NToken": "266", "method_nesting_level": "2"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "src\\operator\\numpy\\np_matrix_op.cc", "file_new_name": "src\\operator\\numpy\\np_matrix_op.cc", "file_complexity": {"file_NLOC": "1517", "file_CCN": "194", "file_NToken": "13611"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "54", "method_info": {"method_name": "mxnet::op::NumpyTransposeShape", "method_params": "attrs,in_attrs,out_attrs", "method_startline": "46", "method_endline": "106", "method_complexity": {"method_NLOC": "58", "method_CCN": "16", "method_NToken": "502", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "1264", "method_info": {"method_name": "mxnet::op::NumpyRollaxisShape", "method_params": "", "method_startline": "1254", "method_endline": "1291", "method_complexity": {"method_NLOC": "30", "method_CCN": "2", "method_NToken": "340", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "1371", "method_info": {"method_name": "mxnet::op::NumpyMoveaxisShape", "method_params": "", "method_startline": "1364", "method_endline": "1383", "method_complexity": {"method_NLOC": "20", "method_CCN": "2", "method_NToken": "214", "method_nesting_level": "2"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 7, "file_old_name": "src\\operator\\tensor\\matrix_op-inl.h", "file_new_name": "src\\operator\\tensor\\matrix_op-inl.h", "file_complexity": {"file_NLOC": "2723", "file_CCN": "457", "file_NToken": "25609"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523", "deleted_lines": null, "method_info": {"method_name": "mxnet::op::TransposeExImpl", "method_params": "ctx,src,ret,axes,strides_xpu", "method_startline": "468", "method_endline": "523", "method_complexity": {"method_NLOC": "46", "method_CCN": "6", "method_NToken": "455", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486", "deleted_lines": "461", "method_info": {"method_name": "mxnet::op::TransposeShape", "method_params": "attrs,in_attrs,out_attrs", "method_startline": "451", "method_endline": "486", "method_complexity": {"method_NLOC": "36", "method_CCN": "10", "method_NToken": "449", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "426,427,428,429,430,431,432,433", "deleted_lines": null, "method_info": {"method_name": "mxnet::op::TransposeImpl", "method_params": "ctx,src,ret,axes", "method_startline": "426", "method_endline": "433", "method_complexity": {"method_NLOC": "8", "method_CCN": "1", "method_NToken": "62", "method_nesting_level": "2"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464", "deleted_lines": "447,461", "method_info": {"method_name": "mxnet::op::TransposeExKernel::Map", "method_params": "tid,out_data,in_data,strides,ndim", "method_startline": "446", "method_endline": "464", "method_complexity": {"method_NLOC": "18", "method_CCN": "3", "method_NToken": "110", "method_nesting_level": "3"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "526,527,528,529,530,531,532,533,534,535,536,537", "deleted_lines": null, "method_info": {"method_name": "mxnet::op::GetTransposeExWorkspace", "method_params": "ctx,axes", "method_startline": "526", "method_endline": "538", "method_complexity": {"method_NLOC": "12", "method_CCN": "2", "method_NToken": "82", "method_nesting_level": "2"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "562,563,564,566,567,569,570", "deleted_lines": null, "method_info": {"method_name": "mxnet::op::Transpose", "method_params": "attrs,ctx,inputs,req,outputs", "method_startline": "542", "method_endline": "572", "method_complexity": {"method_NLOC": "30", "method_CCN": "6", "method_NToken": "271", "method_nesting_level": "2"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "324,328,333,343,359,417,418,422,423", "deleted_lines": "324,332,342,358,416", "method_info": {"method_name": "mxnet::op::TransposeCommonImpl", "method_params": "ctx,src,ret,axes", "method_startline": "324", "method_endline": "423", "method_complexity": {"method_NLOC": "89", "method_CCN": "16", "method_NToken": "802", "method_nesting_level": "2"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\operator\\tensor\\matrix_op.cc", "file_new_name": "src\\operator\\tensor\\matrix_op.cc", "file_complexity": {"file_NLOC": "1015", "file_CCN": "24", "file_NToken": "5966"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "354,355,356,357", "deleted_lines": null}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\python\\unittest\\test_numpy_op.py", "file_new_name": "tests\\python\\unittest\\test_numpy_op.py", "file_complexity": {"file_NLOC": "8643", "file_CCN": "1998", "file_NToken": "97628"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "10124", "deleted_lines": "10120", "method_info": {"method_name": "test_np_rollaxis", "method_params": "", "method_startline": "10111", "method_endline": "10146", "method_complexity": {"method_NLOC": "28", "method_CCN": "7", "method_NToken": "287", "method_nesting_level": "0"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\python\\unittest\\test_operator.py", "file_new_name": "tests\\python\\unittest\\test_operator.py", "file_complexity": {"file_NLOC": "7734", "file_CCN": "1268", "file_NToken": "94930"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "2576,2578", "deleted_lines": "2576,2578", "method_info": {"method_name": "test_transpose", "method_params": "", "method_startline": "2575", "method_endline": "2587", "method_complexity": {"method_NLOC": "12", "method_CCN": "3", "method_NToken": "147", "method_nesting_level": "0"}}}}}}}}