{"BR": {"BR_id": "17529", "BR_author": "D-Roberts", "BRopenT": "2020-02-05T19:44:43Z", "BRcloseT": "2020-02-12T18:25:40Z", "BR_text": {"BRsummary": "np.random.gamma(1,0) and np.random.gamma(0,0) hang", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n On my system, numpy.random.gamma(1,0) and numpy.random.gamma(0,0) do not produce a value or an error, but just hang.\n In original numpy, they generate 0.0.\n <denchmark-h:h3>Error Message</denchmark-h>\n \n No error message.\n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n <denchmark-h:h3>Steps to reproduce</denchmark-h>\n \n \n build mxnet from source\n import mxnet as mx\n run:\n mx.numpy.random.gamma(1,0)\n mx.numpy.random.gamma(0,0)\n \n <denchmark-h:h2>Environment</denchmark-h>\n \n <denchmark-code>----------Python Info----------\n Version      : 3.7.6\n Compiler     : Clang 4.0.1 (tags/RELEASE_401/final)\n Build        : ('default', 'Jan  8 2020 13:42:34')\n Arch         : ('64bit', '')\n ------------Pip Info-----------\n Version      : 20.0.2\n Directory    : /Users/denisaroberts/anaconda3/lib/python3.7/site-packages/pip\n ----------MXNet Info-----------\n Version      : 1.6.0\n Directory    : /Users/denisaroberts/workspace/incubator-mxnet/python/mxnet\n Num GPUs     : 0\n Hashtag not found. Not installed from pre-built package.\n ----------System Info----------\n Platform     : Darwin-19.2.0-x86_64-i386-64bit\n system       : Darwin\n node         : 172-30-48-157.dynapool.nyu.edu\n release      : 19.2.0\n version      : Darwin Kernel Version 19.2.0: Sat Nov  9 03:47:04 PST 2019; root:xnu-6153.61.1~20/RELEASE_X86_64\n ----------Hardware Info----------\n machine      : x86_64\n processor    : i386\n b'machdep.cpu.brand_string: Intel(R) Core(TM) i7-8559U CPU @ 2.70GHz'\n b'machdep.cpu.features: FPU VME DE PSE TSC MSR PAE MCE CX8 APIC SEP MTRR PGE MCA CMOV PAT PSE36 CLFSH DS ACPI MMX FXSR SSE SSE2 SS HTT TM PBE SSE3 PCLMULQDQ DTES64 MON DSCPL VMX EST TM2 SSSE3 FMA CX16 TPR PDCM SSE4.1 SSE4.2 x2APIC MOVBE POPCNT AES PCID XSAVE OSXSAVE SEGLIM64 TSCTMR AVX1.0 RDRAND F16C'\n b'machdep.cpu.leaf7_features: RDWRFSGS TSC_THREAD_OFFSET SGX BMI1 AVX2 SMEP BMI2 ERMS INVPCID FPU_CSDS MPX RDSEED ADX SMAP CLFSOPT IPT MDCLEAR TSXFA IBRS STIBP L1DF SSBD'\n b'machdep.cpu.extfeatures: SYSCALL XD 1GBPAGE EM64T LAHF LZCNT PREFETCHW RDTSCP TSCI'\n ----------Network Test----------\n Setting timeout: 10\n Timing for MXNet: https://github.com/apache/incubator-mxnet, DNS: 0.0387 sec, LOAD: 0.7436 sec.\n Timing for GluonNLP GitHub: https://github.com/dmlc/gluon-nlp, DNS: 0.0005 sec, LOAD: 0.6133 sec.\n Timing for GluonNLP: http://gluon-nlp.mxnet.io, DNS: 0.0684 sec, LOAD: 0.3190 sec.\n Timing for D2L: http://d2l.ai, DNS: 0.0491 sec, LOAD: 0.0512 sec.\n Timing for D2L (zh-cn): http://zh.d2l.ai, DNS: 0.0144 sec, LOAD: 0.3125 sec.\n Timing for FashionMNIST: https://repo.mxnet.io/gluon/dataset/fashion-mnist/train-labels-idx1-ubyte.gz, DNS: 0.0464 sec, LOAD: 0.4697 sec.\n Timing for PYPI: https://pypi.python.org/pypi/pip, DNS: 0.0107 sec, LOAD: 0.3108 sec.\n Timing for Conda: https://repo.continuum.io/pkgs/free/, DNS: 0.0078 sec, LOAD: 0.0652 sec.\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "D-Roberts", "commentT": "2020-02-06T13:32:30Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/D-Roberts>@D-Roberts</denchmark-link>\n , I am the author of . It seems that the rejection sampling got trapped in an infinity loop because of the invalid parameter (scale = 0), as no samples could be accepted according to the standard formula.\n I will create a fix soon.\n However,  <denchmark-link:https://docs.scipy.org/doc/numpy-1.15.0/reference/generated/numpy.random.gamma.html>https://docs.scipy.org/doc/numpy-1.15.0/reference/generated/numpy.random.gamma.html</denchmark-link>\n  the doc for official NumPy says \"The scale of the gamma distribution. Should be greater than zero.\",\n So IMO, returning zero is kind of like undefined behavior.\n Do you have any practical examples that involves setting scale to be zero? If not, I would consider raising an ValueError exception rather than returning zero.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "D-Roberts", "commentT": "2020-02-06T15:24:10Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/xidulu>@xidulu</denchmark-link>\n  .\n I actually agree with raising a ValueError. The only reason I tried these edge cases is because I found some of these inconsistencies in Numpy, where the documentation says that the parameter should be > 0 but then a value is outputed for 0 instead of an Error message.\n \t\t"}}}, "commit": {"commit_id": "f0d1d9dd8879920c68290b6f520f97a17444354c", "commit_author": "Xi Wang", "commitT": "2020-02-12 11:56:50-08:00", "commit_complexity": {"commit_NLOC": "0.03636363636363636", "commit_CCN": "0.0", "commit_Nprams": "0.4"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "src\\operator\\numpy\\random\\np_gamma_op.h", "file_new_name": "src\\operator\\numpy\\random\\np_gamma_op.h", "file_complexity": {"file_NLOC": "308", "file_CCN": "49", "file_NToken": "2613"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "131,136,142,143,144", "deleted_lines": "132,137,138,139,140", "method_info": {"method_name": "mxnet::op::mxnet_op::gamma_kernel::Map", "method_params": "i,lstride,hstride,oshape,shape,scale,uniforms,normals,out,flag", "method_startline": "128", "method_endline": "155", "method_complexity": {"method_NLOC": "22", "method_CCN": "4", "method_NToken": "207", "method_nesting_level": "4"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "254,255,256,257,258,259,288,289,290,294,295,296,309,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,357,358,363,364,365,366,367,368,369", "deleted_lines": "297,324,325,330", "method_info": {"method_name": "mxnet::op::NumpyGammaForward", "method_params": "attrs,ctx,inputs,req,outputs", "method_startline": "229", "method_endline": "381", "method_complexity": {"method_NLOC": "145", "method_CCN": "21", "method_NToken": "1412", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "163,164,165,167,168,169,177,178,179,180,184,185,186,187", "deleted_lines": "164,165,166,168,169,170,171,172", "method_info": {"method_name": "mxnet::op::mxnet_op::gamma_one_scalar_kernel::Map", "method_params": "i,scalar_pos,stride,oshape,array,scalar,uniforms,normals,out,flag,resample", "method_startline": "159", "method_endline": "198", "method_complexity": {"method_NLOC": "31", "method_CCN": "6", "method_NToken": "224", "method_nesting_level": "4"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "163,164,165,167,168,169,177,178,179,180,184,185,186,187", "deleted_lines": "164,165,166,168,169,170,171,172", "method_info": {"method_name": "mxnet::op::mxnet_op::gamma_one_scalar_kernel::Map", "method_params": "i,scalar_pos,stride,oshape,array,scalar,uniforms,normals,out,flag", "method_startline": "160", "method_endline": "193", "method_complexity": {"method_NLOC": "28", "method_CCN": "5", "method_NToken": "208", "method_nesting_level": "4"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "131,136,142,143,144", "deleted_lines": "132,137,138,139,140", "method_info": {"method_name": "mxnet::op::mxnet_op::gamma_kernel::Map", "method_params": "i,lstride,hstride,oshape,shape,scale,uniforms,normals,out,flag,resample", "method_startline": "127", "method_endline": "154", "method_complexity": {"method_NLOC": "22", "method_CCN": "5", "method_NToken": "215", "method_nesting_level": "4"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\python\\unittest\\test_numpy_op.py", "file_new_name": "tests\\python\\unittest\\test_numpy_op.py", "file_complexity": {"file_NLOC": "6352", "file_CCN": "1563", "file_NToken": "70584"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "3584,3585", "deleted_lines": null, "method_info": {"method_name": "test_gamma_exception._test_gamma_exception", "method_params": "shape,scale", "method_startline": "3584", "method_endline": "3585", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "22", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "3583,3584,3585,3586,3587,3588,3589,3590,3591,3592,3593,3594,3595,3596,3597,3598,3599,3600,3601,3602,3603,3604", "deleted_lines": null, "method_info": {"method_name": "test_gamma_exception", "method_params": "", "method_startline": "3583", "method_endline": "3604", "method_complexity": {"method_NLOC": "20", "method_CCN": "2", "method_NToken": "93", "method_nesting_level": "0"}}}}}}}}