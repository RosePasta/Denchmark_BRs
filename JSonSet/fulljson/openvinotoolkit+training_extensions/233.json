{"BR": {"BR_id": "233", "BR_author": "cansik", "BRopenT": "2020-02-29T12:26:34Z", "BRcloseT": "2020-03-06T14:27:45Z", "BR_text": {"BRsummary": "Single Human Pose: no stage_4_output_1_heatmaps layer in pre-trained COCO dataset", "BRdescription": "\n I have tried to run the <denchmark-link:https://github.com/opencv/openvino_training_extensions/blob/develop/pytorch_toolkit/human_pose_estimation/README_single.md#pretrained-model->pretrained COCO model</denchmark-link>\n  within OpenCV DNN. For that I have converted the  to the ONNX format by using following script (size parameter as mentioned for COCO trained models).\n python convert_to_onnx.py --checkpoint-path single-human-pose-estimation-0001.pth --single-person --input-size 384 288\n Interestingly, the output of this script tells me the valid output layers:\n <denchmark-code>...\n   %429 : Float(1, 128, 48, 36) = onnx::Conv[dilations=[1, 1], group=1, kernel_shape=[1, 1], pads=[0, 0, 0, 0], strides=[1, 1]](%428, %282, %283), scope: SinglePersonPoseEstimationWithMobileNet/RefinementStage/Sequential[heatmaps]/Sequential[0]/Conv2d[0]\n   %430 : Float(1, 128, 48, 36) = onnx::Relu(%429), scope: SinglePersonPoseEstimationWithMobileNet/RefinementStage/Sequential[heatmaps]/Sequential[0]/ReLU[1]\n   %stage_1_output_1_heatmaps : Float(1, 17, 48, 36) = onnx::Conv[dilations=[1, 1], group=1, kernel_shape=[1, 1], pads=[0, 0, 0, 0], strides=[1, 1]](%430, %284, %285), scope: SinglePersonPoseEstimationWithMobileNet/RefinementStage/Sequential[heatmaps]/Sequential[1]/Conv2d[0]\n   return (%stage_0_output_1_heatmaps, %stage_1_output_1_heatmaps);\n }\n </denchmark-code>\n \n So only stage_0_output_1_heatmaps and stage_1_output_1_heatmaps are output layers. Looking at the documentation, this tells me that I am working with a ** LIP** dataset, instead of a COCO dataset. There is of course an error too in OpenCV, when I try to forward with stage_4_output_1_heatmaps.\n Is it possible that you accidentally mis-labeled the pre-trained dataset?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "cansik", "commentT": "2020-03-06T10:54:11Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/cansik>@cansik</denchmark-link>\n \n Thank you for your interest in our project.\n convert_to_onnx.py created model with 1 refinement-stages and ignored other stages from pretrained snapshot.\n Update repository to latest commit and run <denchmark-link:https://github.com/opencv/openvino_training_extensions/blob/develop/pytorch_toolkit/human_pose_estimation/README_single.md#conversion-to-openvino-format-1>follow command</denchmark-link>\n :\n <denchmark-code>python scripts/convert_to_onnx.py --checkpoint-path <CHECKPOINT> \\\n     --single-person \\\n     --output-name single-human-pose-estimation.onnx \\\n     --input-size 384 288 \\\n     --mode-interpolation nearest \\\n     --num-refinement-stages 4\n </denchmark-code>\n \n In output you will have onnx model with output 'stage_4_output_1_heatmaps'\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "cansik", "commentT": "2020-03-06T14:27:44Z", "comment_text": "\n \t\tYes this works now. Thank you very much!\n \t\t"}}}, "commit": {"commit_id": "5a6acb36937614ff70507998bde082501e7fee52", "commit_author": "Alexander Dokuchaev", "commitT": "2020-03-06 13:47:19+03:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\README.md", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\README.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "32,40,46,50,54,58,62,65,66,68,69,70,71,72,73,74,77,78,80,81,82,83,84,85,86,89,90,92,93,94,95,96,97,98,99,101,136,137,138,139,140,141,142,143,150,153,158,160,162,163,164,165,166,167,187,191,192,193,205,207,208,209,210,211,213,217,219,220,221,222,223,224,225,226,227,228,229,231", "deleted_lines": "58,60,63,65,68,70,106,107,108,109,116,125,145,148,150,163,169"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\README_single.md", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\README_single.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "8,17,20,21,22,23,24,25,26,29,32,33,34,35,36,37,38,39,40,41,49,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,87,89,90,93,95,97,98,105,107,108,109,110,111,113,114,115,116,117,118,121,124,130,132,134,137,138,139,140,143,145,146,147,148,160", "deleted_lines": "10,19,23,24,25,26,27,28,30,32,45,49,52,55,62,64,68,75,76,77,79,81,83,86,89,90,91,93,94,95,96,97,98,99,100,101,102,103,104,105,117"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\datasets\\coco_single.py", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\datasets\\coco_single.py", "file_complexity": {"file_NLOC": "131", "file_CCN": "27", "file_NToken": "1588"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "129", "deleted_lines": "129", "method_info": {"method_name": "__init__", "method_params": "self,dataset_folder,num_images,transform", "method_startline": "124", "method_endline": "137", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "100", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "50", "deleted_lines": "50", "method_info": {"method_name": "__init__", "method_params": "self,dataset_folder,input_size_img,384", "method_startline": "40", "method_endline": "51", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "128", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\datasets\\lip.py", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\datasets\\lip.py", "file_complexity": {"file_NLOC": "90", "file_CCN": "20", "file_NToken": "884"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "76", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,dataset_folder,num_images", "method_startline": "74", "method_endline": "81", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "86", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "99", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,dataset_folder", "method_startline": "97", "method_endline": "101", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "58", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "31", "deleted_lines": "31", "method_info": {"method_name": "__getitem__", "method_params": "self,idx", "method_startline": "28", "method_endline": "53", "method_complexity": {"method_NLOC": "23", "method_CCN": "5", "method_NToken": "252", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "60", "deleted_lines": "60", "method_info": {"method_name": "_generate_keypoint_maps", "method_params": "self,sample", "method_startline": "58", "method_endline": "70", "method_complexity": {"method_NLOC": "11", "method_CCN": "3", "method_NToken": "115", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "20", "deleted_lines": "20", "method_info": {"method_name": "__init__", "method_params": "self,dataset_folder,stride,sigma,transform", "method_startline": "18", "method_endline": "26", "method_complexity": {"method_NLOC": "9", "method_CCN": "2", "method_NToken": "81", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\datasets\\transformations.py", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\datasets\\transformations.py", "file_complexity": {"file_NLOC": "450", "file_CCN": "116", "file_NToken": "4863"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "298", "deleted_lines": "299", "method_info": {"method_name": "__call__", "method_params": "self,sample", "method_startline": "291", "method_endline": "306", "method_complexity": {"method_NLOC": "13", "method_CCN": "4", "method_NToken": "128", "method_nesting_level": "1"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\init_venv.sh", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\init_venv.sh", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "2,13,16,17", "deleted_lines": "12,15"}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\modules\\load_state.py", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\modules\\load_state.py", "file_complexity": {"file_NLOC": "26", "file_CCN": "10", "file_NToken": "226"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "5", "deleted_lines": "5", "method_info": {"method_name": "load_state", "method_params": "net,checkpoint", "method_startline": "4", "method_endline": "15", "method_complexity": {"method_NLOC": "11", "method_CCN": "5", "method_NToken": "102", "method_nesting_level": "0"}}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\modules\\loss.py", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\modules\\loss.py", "file_complexity": {"file_NLOC": "21", "file_CCN": "4", "file_NToken": "213"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "13", "deleted_lines": "13", "method_info": {"method_name": "mse_loss", "method_params": "output,target,mask", "method_startline": "12", "method_endline": "25", "method_complexity": {"method_NLOC": "13", "method_CCN": "2", "method_NToken": "151", "method_nesting_level": "0"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\requirements.txt", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\requirements.txt", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "3,7,8,9", "deleted_lines": "2,4"}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\scripts\\convert_to_onnx.py", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\scripts\\convert_to_onnx.py", "file_complexity": {"file_NLOC": "33", "file_CCN": "3", "file_NToken": "330"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "33,34,39", "deleted_lines": "37"}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pytorch_toolkit\\human_pose_estimation\\val_single.py", "file_new_name": "pytorch_toolkit\\human_pose_estimation\\val_single.py", "file_complexity": {"file_NLOC": "207", "file_CCN": "33", "file_NToken": "2348"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "78,92,96,97,98,111", "deleted_lines": "78,92,96,97,110", "method_info": {"method_name": "evaluate", "method_params": "dataset,output_name,net,multiscale,visualize", "method_startline": "64", "method_endline": "125", "method_complexity": {"method_NLOC": "55", "method_CCN": "13", "method_NToken": "680", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "210,211,212,213", "deleted_lines": "209,210,211,212", "method_info": {"method_name": "val", "method_params": "net,val_dataset,predictions_name,name_dataset", "method_startline": "204", "method_endline": "217", "method_complexity": {"method_NLOC": "13", "method_CCN": "3", "method_NToken": "100", "method_nesting_level": "0"}}}}}}}}