{"BR": {"BR_id": "116", "BR_author": "ajkl", "BRopenT": "2016-05-09T23:57:09Z", "BRcloseT": "2016-09-16T16:11:24Z", "BR_text": {"BRsummary": "ERROR - service creation mllib bad param: using template while network weights exist, remove 'template' from 'mllib' or would you like to 'finetune' instead ?", "BRdescription": "\n I am running CUDA 7.5\n I get this error on the server when i try to index using\n \n (Using this tutorial <denchmark-link:https://github.com/beniz/deepdetect/tree/imgsearch/demo/imgsearch>https://github.com/beniz/deepdetect/tree/imgsearch/demo/imgsearch</denchmark-link>\n )\n I see this on the client\n {\"status\":{\"code\":400,\"msg\":\"BadRequest\",\"dd_code\":1006,\"dd_msg\":\"Service Bad Request Error\"}}\n The info call works fine though curl http://localhost:8080/info\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ajkl", "commentT": "2016-05-10T02:08:32Z", "comment_text": "\n \t\tI get the same error when I try to create a image classification service\n <denchmark-code>curl -X PUT \"http://localhost:8080/services/imageserv\" -d \"{\\\"mllib\\\":\\\"caffe\\\",\\\"description\\\":\\\"image classification service\\\",\\\"type\\\":\\\"supervised\\\",\\\"parameters\\\":{\\\"input\\\":{\\\"connector\\\":\\\"image\\\"},\\\"mllib\\\":{\\\"template\\\":\\\"googlenet\\\",\\\"nclasses\\\":1000}},\\\"model\\\":{\\\"templates\\\":\\\"../templates/caffe/\\\",\\\"repository\\\":\\\"../../models/imgnet\\\"}}\"\n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ajkl", "commentT": "2016-05-10T08:07:07Z", "comment_text": "\n \t\tSeems I also have this problem. I followed <denchmark-link:http://www.deepdetect.com/tutorials/imagenet-classifier/>http://www.deepdetect.com/tutorials/imagenet-classifier/</denchmark-link>\n \n My first time with deepdetect, so I might obviously have screwed up somewhere during the tutorial steps.\n See below for details.\n -----------------info-----------\n The <denchmark-link:http://localhost:8080/info>http://localhost:8080/info</denchmark-link>\n :\n {\"status\":{\"code\":200,\"msg\":\"OK\"},\"head\":{\"method\":\"/info\",\"version\":\"0.1\",\"branch\":\"master\",\"commit\":\"4d56d42e523d68af7c7198a77a5093baca7a6788\",\"services\":[]}}\n -------------curl call-------------\n <..>/deepdetect/build/main $ curl -X PUT \"<denchmark-link:http://localhost:8080/services/imageserv>http://localhost:8080/services/imageserv</denchmark-link>\n \" -d \"{\"mllib\":\"caffe\",\"description\":\"image classification service\",\"type\":\"supervised\",\"parameters\":{\"input\":{\"connector\":\"image\"},\"mllib\":{\"template\":\"googlenet\",\"nclasses\":1000}},\"model\":{\"templates\":\"../templates/caffe/\",\"repository\":\"../../models/imgnet\"}}\"\n {\"status\":{\"code\":400,\"msg\":\"BadRequest\",\"dd_code\":1006,\"dd_msg\":\"Service Bad Request Error\"}}\n ----server side-------\n <..>/deepdetect/build/main $ ./dede\n DeepDetect [ commit <denchmark-link:https://github.com/jolibrain/deepdetect/commit/4d56d42e523d68af7c7198a77a5093baca7a6788>4d56d42</denchmark-link>\n  ]\n Running DeepDetect HTTP server on localhost:8080\n ERROR - 10:04:41 - service creation mllib bad param: using template while network weights exist, remove 'template' from 'mllib' or would you like to 'finetune' instead ?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "ajkl", "commentT": "2016-05-10T08:41:15Z", "comment_text": "\n \t\tThanks for reporting this. This is a protection that was recently added to avoid overriding a trained model net definition in production systems.\n Putting imgsearch aside, current workaround could be do to the PUT services and add the weights file afterward to the model repository. Could you report on this by any chance ? Thanks and apologies for the inconvenience, this was a fix with an obvious regression.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "ajkl", "commentT": "2016-05-10T12:25:13Z", "comment_text": "\n \t\t\n Could you report on this by any chance ?\n \n I'd love to but I'm too clueless and the permutation space, given my utter lack of insight, is too large. E.g. - is the weightfile the corresp.txt mentioned? do I need to change the put call accordingly, given this fist assumption is right? Do I change the template arg in the json? The templates? The reposotitory? How do I add a file afterwards to a repo? I tried doing the tutorial with simply skipping the corresp.txt step. That fails.\n I'll come back, hopefully, when the tutorial works. Nice work btw. Looks interesting!\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "ajkl", "commentT": "2016-05-10T13:23:12Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/yarcyarc>@yarcyarc</denchmark-link>\n  thanks, try out with last commit, I'm severely constrained for a few days, with limited net access, thus my suggestion instead of a fix earlier today. This should also fix the initial report by <denchmark-link:https://github.com/ajkl>@ajkl</denchmark-link>\n  .\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "ajkl", "commentT": "2016-05-10T17:15:33Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/beniz>@beniz</denchmark-link>\n  for the fix, it works!\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "ajkl", "commentT": "2016-05-10T17:30:34Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/beniz>@beniz</denchmark-link>\n  Once you index, you have to delete the model files before you run search  else you get the same error because of the override check.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "ajkl", "commentT": "2016-05-11T11:58:46Z", "comment_text": "\n \t\tBeautiful. Works now. Thanks so far.\n :-)\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "ajkl", "commentT": "2016-05-19T08:49:42Z", "comment_text": "\n \t\tHi again,\n I did a pull and rebuilt. Now the same error seems to be there again. Or perhaps I'm doing silly mistakes. Please see below for details.\n -------------build--------\n <..>/deepdetect/build $ make clean\n <..>/deepdetect/build $ cmake clean ..\n -- Boost version: 1.54.0\n <..>\n <..>/deepdetect/build $ cmake ..\n -- Boost version: 1.54.0\n <..>\n <..>/deepdetect/build $ make\n <..>\n <..>/deepdetect/build $ cd caffe_dd/src/caffe_dd<..>/deepdetect/build/caffe_dd/src/caffe_dd $ ./scripts/download_model_binary.py models/bvlc_googlenet/\n ...100%, 51 MB, 3924 KB/s, 13 seconds passed\n <..>/deepdetect $ cp build/caffe_dd/src/caffe_dd/models/bvlc_googlenet/bvlc_googlenet.caffemodel models/imgnet\n <..>/deepdetect $ cp datasets/imagenet/corresp_ilsvrc12.txt models/imgnet/corresp.txt\n -------------client---------------\n <..>/deepdetect/build/main $ curl -X PUT \"<denchmark-link:http://localhost:8080/services/imageserv>http://localhost:8080/services/imageserv</denchmark-link>\n \" -d \"{\"mllib\":\"caffe\",\"description\":\"image classification service\",\"type\":\"supervised\",\"parameters\":{\"input\":{\"connector\":\"image\"},\"mllib\":{\"template\":\"googlenet\",\"nclasses\":1000}},\"model\":{\"templates\":\"../templates/caffe/\",\"repository\":\"../../models/imgnet\"}}\"\n {\"status\":{\"code\":400,\"msg\":\"BadRequest\",\"dd_code\":1006,\"dd_msg\":\"Service Bad Request Error\"}}\n -------------server----------\n <..>/deepdetect/build/main $ ./dede\n DeepDetect [ commit <denchmark-link:https://github.com/jolibrain/deepdetect/commit/1ca5ec1926527bd386f51fcb3175d6fbae9a0d9c>1ca5ec1</denchmark-link>\n  ]\n Running DeepDetect HTTP server on localhost:8080\n ERROR - 10:40:25 - service creation mllib bad param: using template while network weights exist, remove 'template' from 'mllib' or would you like to 'finetune' instead ?\n -------------info---------\n <denchmark-link:http://localhost:8080/info>http://localhost:8080/info</denchmark-link>\n \n {\"status\":{\"code\":200,\"msg\":\"OK\"},\"head\":{\"method\":\"/info\",\"version\":\"0.1\",\"branch\":\"master\",\"commit\":\"1ca5ec1926527bd386f51fcb3175d6fbae9a0d9c\",\"services\":[]}}\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "ajkl", "commentT": "2016-05-19T09:07:21Z", "comment_text": "\n \t\tSee whether the <denchmark-link:http://www.deepdetect.com/overview/faq/>FAQ</denchmark-link>\n  is useful to you. You probably already have the  files in your model repository and need to remove the  argument from the call, or to first empty the  directory.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "ajkl", "commentT": "2016-06-24T14:16:45Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/beniz>@beniz</denchmark-link>\n  Thanks!\n An update for people who might still be having problems, remove the \"template\":\"googlenet\", from parameters.mllib\n _Change your directories to templates and repository to your respective paths.\n curl -X PUT http://localhost:8080/services/imageserv -d \"{\\\"mllib\\\":\\\"caffe\\\",\\\"description\\\":\\\"image classification service\\\",\\\"type\\\":\\\"supervised\\\",\\\"parameters\\\":{\\\"input\\\":{\\\"connector\\\":\\\"image\\\"},\\\"mllib\\\":{\\\"nclasses\\\":1000}},\\\"model\\\":{\\\"templates\\\":\\\"/path/to/deepdetect/build/templates/caffe/\\\",\\\"repository\\\":\\\"/path/to/deepdetect/models/imgnet\\\"}}\"\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "ajkl", "commentT": "2016-07-06T12:36:06Z", "comment_text": "\n \t\tI wonder why the service is being deleted <denchmark-link:https://github.com/beniz/deepdetect/blob/master/demo/imgsearch/imgsearch.py#L112>here</denchmark-link>\n  ?\n I was having this issue - I commented the service creation part in imgsearch.py and created the service with cURL. This issue went away after that.\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "ajkl", "commentT": "2016-07-07T08:39:37Z", "comment_text": "\n \t\tThis is a demo you need to accommodate to your application. Even remote, you can see the service as an object, and thus delete it after use. Note that the empty clear parameter means that the model data are not deleted, only the logical service on the server.\n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "ajkl", "commentT": "2016-09-16T22:16:00Z", "comment_text": "\n \t\tI'de like to reopen this issue, it seems that the issue stil occurs however I think this is because of <denchmark-link:https://github.com/jolibrain/deepdetect/issues/188>#188</denchmark-link>\n  . For me when I run the deepdetect  from inside the docker container it allows me to index but I see the same  error when I run it with .\n Yes - after indexing there are then files present that are mentioned in <denchmark-link:https://github.com/beniz/deepdetect/issues/116#issuecomment-218231139>https://github.com/beniz/deepdetect/issues/116#issuecomment-218231139</denchmark-link>\n  which I need to remove to re-index again without error\n \t\t"}, "comments_14": {"comment_id": 15, "comment_author": "ajkl", "commentT": "2016-09-17T05:57:03Z", "comment_text": "\n \t\tSee the FAQ.\n \t\t"}, "comments_15": {"comment_id": 16, "comment_author": "ajkl", "commentT": "2017-01-09T07:41:58Z", "comment_text": "\n \t\tI checked the FAQ for clearing a service but the clear call fails too\n step 1) Train\n curl -X PUT \"<denchmark-link:http://localhost:8080/services/imageserv>http://localhost:8080/services/imageserv</denchmark-link>\n \" -d '{\n \"mllib\":\"caffe\",\n \"description\":\"image classification service\",\n \"type\":\"supervised\",\n \"parameters\":{\n \"input\":{\n \"connector\":\"image\"\n },\n \"mllib\":{\n \"template\":\"resnet_50\",\n \"nclasses\":1000\n }\n },\n \"model\":{\n \"templates\":\"/home/zzzz/ws/deepdetect/templates/caffe\",\n \"repository\":\"../../models/resnet\"\n }\n }'\n LOG For Step 1:\n ERROR - 12:59:40 - service creation mllib bad param: using template while network weights exist, remove 'template' from 'mllib' or would you like to 'finetune' instead ?\n ERROR - 12:59:40 - 127.0.0.1 \"PUT /services/imageserv\" 400 0\n Step 2:\n curl -X DELETE \"<denchmark-link:http://localhost:8080/services/imageserv?clear=full>http://localhost:8080/services/imageserv?clear=full</denchmark-link>\n \"\n Log for Step 2:\n ERROR - 13:04: - cannot find service imageserv for removal\n ERROR - 13:04: - 127.0.0.1 \"DELETE /services/imageserv?clear=full\" 404 0\n It wont let me train the same with a different service name either\n \t\t"}, "comments_16": {"comment_id": 17, "comment_author": "ajkl", "commentT": "2017-01-09T07:46:04Z", "comment_text": "\n \t\tYou need to re-create your service first since it appears to have been removed (DELETE cannot find it). Don't use template in mllib when doing so, then call on the DELETE with clear=full or clear=lib as per what your requirement is.\n \t\t"}}}, "commit": {"commit_id": "d84ea7f5f92aead307f860a7ce2bc28fc7ace334", "commit_author": "Emmanuel Benazera", "commitT": "2016-05-10 15:21:49+02:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\caffelib.cc", "file_new_name": "src\\caffelib.cc", "file_complexity": {"file_NLOC": "1967", "file_CCN": "362", "file_NToken": "14548"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "79,80", "deleted_lines": "79", "method_info": {"method_name": "dd::CaffeLib<TInputConnectorStrategy,TOutputConnectorStrategy,TMLModel>::instantiate_template", "method_params": "ad", "method_startline": "67", "method_endline": "168", "method_complexity": {"method_NLOC": "93", "method_CCN": "31", "method_NToken": "933", "method_nesting_level": "1"}}}}}}}}