{"BR": {"BR_id": "405", "BR_author": "hdimitriou", "BRopenT": "2019-02-26T15:48:44Z", "BRcloseT": "2019-03-15T11:11:57Z", "BR_text": {"BRsummary": "pdf.js misconfigured on docker image ?", "BRdescription": "\n Using the web service and going to PDF I see on the browser console\n GET https://grobid.atypon.com/resources/pdf.js/build/pdf.js net::ERR_ABORTED 404\n This is reasonable since the whole resources folder is missing\n root@grobid-84cbcddb44-4ns4b:/opt/grobid# ls /opt/grobid/grobid-home/ config\tlanguage-detection  lexicon  lib  models  pdf2xml  schemas  tmp\n and\n <denchmark-code>root@grobid-84cbcddb44-4ns4b:/opt/grobid# cat grobid-home/config/grobid.properties\n ...\n ##-------------------- start: directories ---------------------\n # properties of where to find directories necessary for Grobid\n # EACH KEY REFERENCING A PATH HAS TO ENDS WITH \".path\"\n grobid.resource.path=./resources\n </denchmark-code>\n \n Out of curiosity, I added pdf.js from mozilla and created the folder structure, that error disappeared but a new popped\n <denchmark-code>grobid.js:342 Uncaught ReferenceError: PDFJS is not defined\n     at FileReader.reader.onloadend (grobid.js:342)\n </denchmark-code>\n \n Moreover, when I do such request, the pod (container) restarts promptly with something like this on the logs\n <denchmark-code>...\n INFO  [2019-02-26 15:37:11,169] org.eclipse.jetty.server.handler.ContextHandler: Started i.d.j.MutableServletContextHandler@40a1b6d4{/,null,AVAILABLE}\n INFO  [2019-02-26 15:37:11,257] io.dropwizard.setup.AdminEnvironment: tasks =\n \n     POST    /tasks/log-level (io.dropwizard.servlets.tasks.LogConfigurationTask)\n     POST    /tasks/gc (io.dropwizard.servlets.tasks.GarbageCollectionTask)\n \n INFO  [2019-02-26 15:37:11,263] org.eclipse.jetty.server.handler.ContextHandler: Started i.d.j.MutableServletContextHandler@79ab97fd{/,null,AVAILABLE}\n INFO  [2019-02-26 15:37:11,307] org.eclipse.jetty.server.AbstractConnector: Started application@429aeac1{HTTP/1.1,[http/1.1]}{0.0.0.0:8070}\n INFO  [2019-02-26 15:37:11,355] org.eclipse.jetty.server.AbstractConnector: Started admin@79eeff87{HTTP/1.1,[http/1.1]}{0.0.0.0:8071}\n INFO  [2019-02-26 15:37:11,355] org.eclipse.jetty.server.Server: Started @16037ms\n 10.0.10.10 - - [26/Feb/2019:15:37:31 +0000] \"GET /resources/pdf.js/build/pdf.js HTTP/1.1\" 404 261 \"https://grobid.atypon.com/\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.109 Safari/537.36\" 74\n </denchmark-code>\n \n I see that this whole process works on the demo site <denchmark-link:http://cloud.science-miner.com/grobid/>http://cloud.science-miner.com/grobid/</denchmark-link>\n \n Can you please explain what I am missing? I am tasked to deploy grobid so I don't know much of its functionality\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "hdimitriou", "commentT": "2019-03-11T13:14:20Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/hdimitriou>@hdimitriou</denchmark-link>\n  sorry I missed your issue. I try to have a look this week.\n Which version are you using from docker?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "hdimitriou", "commentT": "2019-03-12T09:14:15Z", "comment_text": "\n \t\t\"Docker version 18.09.2\", \"18.06.1-ce\"\n I am not sure it has to do with the version.\n I created my own Dockerfile based on yours and it works fine I think.\n The difference is that i clone your repo inside the builder instead of copying folders.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "hdimitriou", "commentT": "2019-03-12T09:54:50Z", "comment_text": "\n \t\tNothing, sorry I was taking about the grobid version\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "hdimitriou", "commentT": "2019-03-12T09:59:58Z", "comment_text": "\n \t\t0.5.4 version of Grobid\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "hdimitriou", "commentT": "2019-03-12T13:10:33Z", "comment_text": "\n \t\tI used to clone the repo but we have changed that afterwards so that it was possible to create the docker version of the actual version that was checked out.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "hdimitriou", "commentT": "2019-03-12T14:55:10Z", "comment_text": "\n \t\tOk it's actually a bug not in the docker but in how the grobid-service jar is built... the sub-directory of pdf.js is called build which is a very unfortunate name cause gradle is likely to ignore it.\n The issue should be fixed in the 0.5.4-fixes branch, but testing it is a pain... so might not be able to finish today.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "hdimitriou", "commentT": "2019-03-12T22:41:34Z", "comment_text": "\n \t\tOK the issue is solved after <denchmark-link:https://github.com/kermitt2/grobid/commit/41fd74e034ee48461e5a881fc2d3b1347aec6a48>41fd74e</denchmark-link>\n  (I'm pushing the new image, might thake the whole day to upload  )\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "hdimitriou", "commentT": "2019-03-13T10:55:22Z", "comment_text": "\n \t\tThe new image has been pushed... \ud83d\udc4d\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "hdimitriou", "commentT": "2019-03-15T05:46:14Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/hdimitriou>@hdimitriou</denchmark-link>\n  could you please test it and close the ticket, if the problem is solved? Thank you!\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "hdimitriou", "commentT": "2019-03-15T11:11:57Z", "comment_text": "\n \t\tIt works fine now, I tested the new image.\n It would be wise if you could tag it with another tag, because anyone who has already downloaded it might not download it again\n \t\t"}}}, "commit": {"commit_id": "7bdc84f312b0cdafdbb16cf26e66dbabebba1f35", "commit_author": "lfoppiano", "commitT": "2019-03-12 23:14:00+09:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "RENAME", "file_Nmethod": 0, "file_old_name": "grobid-service\\src\\main\\resources\\web\\resources\\pdf.js\\build\\pdf.js", "file_new_name": "grobid-service\\src\\main\\resources\\web\\resources\\pdf.js\\build_\\pdf.js", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_1": {"file_change_type": "RENAME", "file_Nmethod": 0, "file_old_name": "grobid-service\\src\\main\\resources\\web\\resources\\pdf.js\\build\\pdf.worker.js", "file_new_name": "grobid-service\\src\\main\\resources\\web\\resources\\pdf.js\\build_\\pdf.worker.js", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "grobid-service\\src\\main\\resources\\web\\resources\\pdf.js\\index.html", "file_new_name": "grobid-service\\src\\main\\resources\\web\\resources\\pdf.js\\index.html", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "13", "deleted_lines": "13"}}}}}}