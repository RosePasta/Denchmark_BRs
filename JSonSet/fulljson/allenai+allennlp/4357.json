{"BR": {"BR_id": "4357", "BR_author": "12seetharaman", "BRopenT": "2020-06-15T00:26:20Z", "BRcloseT": "2020-07-13T20:54:55Z", "BR_text": {"BRsummary": "Bug on calculating \"argmax_predictions\". It increases the false positive count for last label.", "BRdescription": "\n File: <denchmark-link:https://github.com/allenai/allennlp/blob/master/allennlp/training/metrics/fbeta_measure.py>https://github.com/allenai/allennlp/blob/master/allennlp/training/metrics/fbeta_measure.py</denchmark-link>\n \n Line no: 132\n Prediction tensor is all zero \"[0, 0, 0, 0, 0, 0]\", when a record is not classified to any of the labels.\n argmax_predictions = predictions.max(dim=-1)[1].float()\n Here, we are calculating argmax predictions by a max value index.\n In the case of all zeros tensor, we will get the index of the last label. It increases the false positive count of the last label and affects the F1 score.\n <denchmark-code>>>> prediction =  torch.zeros(6)\n >>> prediction\n tensor([0., 0., 0., 0., 0., 0.])\n >>> prediction.max(dim=-1)\n (tensor(0.), tensor(5))\n >>> prediction.max(dim=-1)[1]\n tensor(5)\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "12seetharaman", "commentT": "2020-06-19T16:24:04Z", "comment_text": "\n \t\tThis is definitely a bug. Could you submit a PR to fix it?\n \t\t"}}}, "commit": {"commit_id": "7b188c93b5efe2f417fc541b61f6be29bc2e632f", "commit_author": "Akshita Bhagia", "commitT": "2020-07-13 16:54:54-04:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "32", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "allennlp\\training\\metrics\\fbeta_measure.py", "file_new_name": "allennlp\\training\\metrics\\fbeta_measure.py", "file_complexity": {"file_NLOC": "181", "file_CCN": "19", "file_NToken": "1029"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "132,133,135,136,148", "deleted_lines": "133,145"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "tests\\training\\metrics\\fbeta_measure_test.py", "file_new_name": "tests\\training\\metrics\\fbeta_measure_test.py", "file_complexity": {"file_NLOC": "276", "file_CCN": "21", "file_NToken": "2749"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365", "deleted_lines": null, "method_info": {"method_name": "test_fbeta_handles_no_prediction_true_all_class", "method_params": "self,str", "method_startline": "350", "method_endline": "365", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "135", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329", "deleted_lines": null, "method_info": {"method_name": "test_fbeta_handles_no_prediction_true_last_class", "method_params": "self,str", "method_startline": "314", "method_endline": "329", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "135", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347", "deleted_lines": null, "method_info": {"method_name": "test_fbeta_handles_no_prediction_true_other_class", "method_params": "self,str", "method_startline": "332", "method_endline": "347", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "135", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311", "deleted_lines": null, "method_info": {"method_name": "test_fbeta_handles_no_prediction_false_last_class", "method_params": "self,str", "method_startline": "296", "method_endline": "311", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "135", "method_nesting_level": "1"}}}}}}}}