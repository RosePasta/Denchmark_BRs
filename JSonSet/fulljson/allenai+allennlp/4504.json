{"BR": {"BR_id": "4504", "BR_author": "bratao", "BRopenT": "2020-07-24T03:39:47Z", "BRcloseT": "2020-07-31T16:16:43Z", "BR_text": {"BRsummary": "After #4470 the output is duplicated and Tqdm effect is lost", "BRdescription": "\n <denchmark-h:h2>Checklist</denchmark-h>\n \n \n  I have verified that the issue exists against the master branch of AllenNLP.\n  I have read the relevant section in the contribution guide on reporting bugs.\n  I have checked the issues list for similar or identical bug reports.\n  I have checked the pull requests list for existing proposed fixes.\n  I have checked the CHANGELOG and the commit log to find out if the bug was already fixed in the master branch.\n  I have included in the \"Description\" section below a traceback from any exceptions related to this bug.\n  I have included in the \"Related issues or possible duplicates\" section beloew all related issues and possible duplicate issues (If there are none, check this box anyway).\n  I have included in the \"Environment\" section below the name of the operating system and Python version that I was using when I discovered this bug.\n  I have included in the \"Environment\" section below the output of pip freeze.\n  I have included in the \"Steps to reproduce\" section below a minimally reproducible example.\n \n <denchmark-h:h2>Description</denchmark-h>\n \n In PyCharm console in Windows and in the CI ( Ubuntu 18.04) the output is duplicated. The nice Tqdm bars is lost. The output is repeated like that:\n <denchmark-code>accuracy: 0.9193, accuracy3: 0.9219, precision-overall: 0.3077, recall-overall: 0.2727, f1-measure-overall: 0.2892, loss: 95.4325, reg_loss: 6.7843 ||:  33%|###3      | 1/3 [00:02<00:04,  2.14s/it]\n accuracy: 0.9211, accuracy3: 0.9237, precision-overall: 0.3571, recall-overall: 0.3191, f1-measure-overall: 0.3371, loss: 37.8299, reg_loss: 7.8506 ||: 100%|##########| 3/3 [00:02<00:00,  1.52s/it]\n accuracy: 0.9211, accuracy3: 0.9237, precision-overall: 0.3571, recall-overall: 0.3191, f1-measure-overall: 0.3371, loss: 37.8299, reg_loss: 7.8506 ||: 100%|##########| 3/3 [00:02<00:00,  1.30it/s]\n \n </denchmark-code>\n \n The <denchmark-link:https://github.com/allenai/allennlp/pull/4470>#4470</denchmark-link>\n  Pull by <denchmark-link:https://github.com/epwalsh>@epwalsh</denchmark-link>\n   checks for sys.stderr.isatty() and in my Pycharm console and in my Gitlab C.I the output is duplicated. Probably because the console is redirected internal. A option to keep the previous behavior would be great\n \n Python traceback:\n \n \n \n \n <denchmark-h:h2>Related issues or possible duplicates</denchmark-h>\n \n Happened after the <denchmark-link:https://github.com/allenai/allennlp/pull/4470>#4470</denchmark-link>\n  Pull\n <denchmark-h:h2>Environment</denchmark-h>\n \n OS: Windows 10 or Ubuntu 18.04\n Python version: 3.8\n \n Output of pip freeze:\n \n \n \n \n <denchmark-h:h2>Steps to reproduce</denchmark-h>\n \n \n Example source:\n \n \n N/A - Any training code reproduces this error.\n \n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "bratao", "commentT": "2020-07-24T15:24:32Z", "comment_text": "\n \t\tUgh, in hindsight, maybe getting rid of the --file-friendly-logging flag was a bad idea. But I guess the main issue is that sys.stderr.isatty() is too crude / not really what we want to check.\n Maybe there's a better way to check when we should automatically switch to FFL? Otherwise I'd vote for re-instating the FFL flag.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "bratao", "commentT": "2020-07-24T15:38:09Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/bratao>@bratao</denchmark-link>\n  the double output is just the last progress bar, i.e. when it gets to 100%. I've noticed this elsewhere. I think I have a fix for that.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "bratao", "commentT": "2020-07-24T16:57:35Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/epwalsh>@epwalsh</denchmark-link>\n  . Yeah, I think a flag would be the best solution. Because  is too fragile. Many console emulators report it wrongly.\n \t\t"}}}, "commit": {"commit_id": "2401282352b244ee8faa7d7bd52e7c09c1a76a2a", "commit_author": "Evan Pete Walsh", "commitT": "2020-07-31 09:16:42-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.8717948717948718", "commit_Nprams": "0.9230769230769231"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "19", "deleted_lines": "13,20"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "allennlp\\commands\\evaluate.py", "file_new_name": "allennlp\\commands\\evaluate.py", "file_complexity": {"file_NLOC": "120", "file_CCN": "7", "file_NToken": "649"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "101,102", "deleted_lines": null, "method_info": {"method_name": "evaluate_from_args", "method_params": "Namespace", "method_startline": "100", "method_endline": "156", "method_complexity": {"method_NLOC": "41", "method_CCN": "6", "method_NToken": "302", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "88,89,90,91,92,93", "deleted_lines": null, "method_info": {"method_name": "add_subparser", "method_params": "self,_SubParsersAction", "method_startline": "28", "method_endline": "97", "method_complexity": {"method_NLOC": "58", "method_CCN": "1", "method_NToken": "247", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "allennlp\\commands\\find_learning_rate.py", "file_new_name": "allennlp\\commands\\find_learning_rate.py", "file_complexity": {"file_NLOC": "291", "file_CCN": "8", "file_NToken": "1317"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "106", "deleted_lines": null, "method_info": {"method_name": "find_learning_rate_from_args", "method_params": "Namespace", "method_startline": "102", "method_endline": "117", "method_complexity": {"method_NLOC": "16", "method_CCN": "1", "method_NToken": "78", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "90,91,92,93,94,95", "deleted_lines": null, "method_info": {"method_name": "add_subparser", "method_params": "self,_SubParsersAction", "method_startline": "34", "method_endline": "99", "method_complexity": {"method_NLOC": "62", "method_CCN": "1", "method_NToken": "234", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "allennlp\\commands\\predict.py", "file_new_name": "allennlp\\commands\\predict.py", "file_complexity": {"file_NLOC": "186", "file_CCN": "29", "file_NToken": "1089"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "88,89,90,91,92,93,94", "deleted_lines": null, "method_info": {"method_name": "add_subparser", "method_params": "self,_SubParsersAction", "method_startline": "27", "method_endline": "97", "method_complexity": {"method_NLOC": "58", "method_CCN": "1", "method_NToken": "273", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "205,206", "deleted_lines": null, "method_info": {"method_name": "_predict", "method_params": "Namespace", "method_startline": "204", "method_endline": "222", "method_complexity": {"method_NLOC": "16", "method_CCN": "3", "method_NToken": "81", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "allennlp\\commands\\train.py", "file_new_name": "allennlp\\commands\\train.py", "file_complexity": {"file_NLOC": "580", "file_CCN": "13", "file_NToken": "1947"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "319", "deleted_lines": null, "method_info": {"method_name": "_train_worker", "method_params": "int,Params,str,None,bool,int,str,int,int,None,bool", "method_startline": "308", "method_endline": "319", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "73", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "87,88,89,90,91,92", "deleted_lines": null, "method_info": {"method_name": "add_subparser", "method_params": "self,_SubParsersAction", "method_startline": "37", "method_endline": "96", "method_complexity": {"method_NLOC": "51", "method_CCN": "1", "method_NToken": "197", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "125", "deleted_lines": null, "method_info": {"method_name": "train_model_from_file", "method_params": "str,str,str,bool,bool,int,None,bool,bool", "method_startline": "116", "method_endline": "125", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "65", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "183", "deleted_lines": null, "method_info": {"method_name": "train_model", "method_params": "Params,str,bool,bool,int,None,bool,bool", "method_startline": "175", "method_endline": "183", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "54", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "112", "deleted_lines": null, "method_info": {"method_name": "train_model_from_args", "method_params": "Namespace", "method_startline": "99", "method_endline": "113", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "67", "method_nesting_level": "0"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "allennlp\\common\\logging.py", "file_new_name": "allennlp\\common\\logging.py", "file_complexity": {"file_NLOC": "93", "file_CCN": "15", "file_NToken": "614"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "47,48,49,50,51,52,53,54,55,56", "deleted_lines": null}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "allennlp\\common\\tqdm.py", "file_new_name": "allennlp\\common\\tqdm.py", "file_complexity": {"file_NLOC": "62", "file_CCN": "15", "file_NToken": "330"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "53", "deleted_lines": "53", "method_info": {"method_name": "__init__", "method_params": "self", "method_startline": "52", "method_endline": "53", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "12", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "56,57,58,59,60,62,63,67,68,69", "deleted_lines": "55,57,58,62,63", "method_info": {"method_name": "write", "method_params": "self,message", "method_startline": "55", "method_endline": "73", "method_complexity": {"method_NLOC": "17", "method_CCN": "8", "method_NToken": "116", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "82,83,84,85,86,87,88,89", "deleted_lines": null, "method_info": {"method_name": "tqdm", "method_params": "args,kwargs", "method_startline": "81", "method_endline": "91", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "48", "method_nesting_level": "1"}}}}}}}}