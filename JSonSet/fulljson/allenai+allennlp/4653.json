{"BR": {"BR_id": "4653", "BR_author": "mahnerak", "BRopenT": "2020-09-20T17:21:56Z", "BRcloseT": "2020-10-19T18:32:06Z", "BR_text": {"BRsummary": "Closing the TensorBoard writer", "BRdescription": "\n I had noticed that sometimes tensorboard fails to properly read the tfevents files.\n They are mainly in case of runs which I decided to interrupt the training (not sure about other abortion scenarios).\n Then, I wanted to make sure the tensorboard writer is properly closed. I found the close() is called only here, but not inside any with or finally construct:\n \n \n \n allennlp/allennlp/training/trainer.py\n \n \n          Line 970\n       in\n       fbd2ccc\n \n \n \n \n \n \n  self._tensorboard.close() \n \n \n \n \n \n Here we can see the writer is closed just by calling .close() so there's no guarantee that the data is going to be flushed.\n Is there any reason for this implementation? Does this need to be fixed?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "mahnerak", "commentT": "2020-09-22T17:42:10Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/mahnerak>@mahnerak</denchmark-link>\n , that seems like an oversight on our part. Would you be interested in making a PR to fix that?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "mahnerak", "commentT": "2020-09-22T20:32:17Z", "comment_text": "\n \t\tSure!\n I just don't want to increase the indentation of the train-loop code by adding try/finally and with to train().\n One good option is to add close() method to Trainer so it can handle even multiple handles to be closed. And the trainer instance can be closed from:\n \n \n \n allennlp/allennlp/commands/train.py\n \n \n         Lines 503 to 506\n       in\n       fbd2ccc\n \n \n \n \n \n \n  \n \n \n \n  def run(self) -> Dict[str, Any]: \n \n \n \n  return self.trainer.train() \n \n \n \n  \n \n \n \n \n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "mahnerak", "commentT": "2020-09-22T20:54:34Z", "comment_text": "\n \t\tCool. I think maybe Trainer.clean_up() is a better/more general name for the method?\n \t\t"}}}, "commit": {"commit_id": "00bb6c59b3ac8fdc78dfe8d5b9b645ce8ed085c0", "commit_author": "Dirk Groeneveld", "commitT": "2020-10-19 11:32:05-07:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "84", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "allennlp\\training\\trainer.py", "file_new_name": "allennlp\\training\\trainer.py", "file_complexity": {"file_NLOC": "1046", "file_CCN": "126", "file_NToken": "4930"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "974,1078,1079", "deleted_lines": "1071,1109,1110,1111", "method_info": {"method_name": "_try_train", "method_params": "self", "method_startline": "974", "method_endline": "1122", "method_complexity": {"method_NLOC": "106", "method_CCN": "30", "method_NToken": "809", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "968,969,970,971,972", "deleted_lines": null, "method_info": {"method_name": "train", "method_params": "self", "method_startline": "964", "method_endline": "972", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "30", "method_nesting_level": "1"}}}}}}}}