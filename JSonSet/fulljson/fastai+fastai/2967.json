{"BR": {"BR_id": "2967", "BR_author": "sky1ove", "BRopenT": "2020-11-10T05:01:35Z", "BRcloseT": "2020-11-23T17:48:10Z", "BR_text": {"BRsummary": "Internal assert error in awd_qrnn", "BRdescription": "\n To reproduce the error:<denchmark-link:https://colab.research.google.com/drive/19WzwYTzs78DNvQ7VTw_37hbXq3l5ozsk?usp=sharing>https://colab.research.google.com/drive/19WzwYTzs78DNvQ7VTw_37hbXq3l5ozsk?usp=sharing</denchmark-link>\n \n My input is 872 embeddings (from integer 0 to 872), output is n=206 classifications. AWD_LSTM works fine. However, when I changed to AWD_QRNN, it shows the bug below.\n config = awd_qrnn_clas_config.copy()\n config.update({'bidir':True})\n model =get_text_classifier(AWD_QRNN, 872, 206, seq_len=872, config=config)\n print(model)\n SequentialRNN(\n (0): SentenceEncoder(\n (module): AWD_QRNN(\n (encoder): Embedding(872, 400, padding_idx=1)\n (encoder_dp): EmbeddingDropout(\n (emb): Embedding(872, 400, padding_idx=1)\n )\n (rnns): ModuleList(\n (0): QRNN(\n (layers): ModuleList(\n (0): QRNNLayer(\n (linear): WeightDropout(\n (module): Linear(in_features=800, out_features=2328, bias=True)\n )\n )\n )\n (layers_bwd): ModuleList(\n (0): QRNNLayer(\n (linear): Linear(in_features=800, out_features=2328, bias=True)\n )\n )\n )\n (1): QRNN(\n (layers): ModuleList(\n (0): QRNNLayer(\n (linear): WeightDropout(\n (module): Linear(in_features=1552, out_features=2328, bias=True)\n )\n )\n )\n (layers_bwd): ModuleList(\n (0): QRNNLayer(\n (linear): Linear(in_features=1552, out_features=2328, bias=True)\n )\n )\n )\n (2): QRNN(\n (layers): ModuleList(\n (0): QRNNLayer(\n (linear): WeightDropout(\n (module): Linear(in_features=1552, out_features=2328, bias=True)\n )\n )\n )\n (layers_bwd): ModuleList(\n (0): QRNNLayer(\n (linear): Linear(in_features=1552, out_features=2328, bias=True)\n )\n )\n )\n (3): QRNN(\n (layers): ModuleList(\n (0): QRNNLayer(\n (linear): WeightDropout(\n (module): Linear(in_features=1552, out_features=600, bias=True)\n )\n )\n )\n (layers_bwd): ModuleList(\n (0): QRNNLayer(\n (linear): Linear(in_features=1552, out_features=600, bias=True)\n )\n )\n )\n )\n (input_dp): RNNDropout()\n (hidden_dps): ModuleList(\n (0): RNNDropout()\n (1): RNNDropout()\n (2): RNNDropout()\n (3): RNNDropout()\n )\n )\n )\n (1): PoolingLinearClassifier(\n (layers): Sequential(\n (0): LinBnDrop(\n (0): BatchNorm1d(1200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n (1): Dropout(p=0.4, inplace=False)\n (2): Linear(in_features=1200, out_features=50, bias=False)\n (3): ReLU(inplace=True)\n )\n (1): LinBnDrop(\n (0): BatchNorm1d(50, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n (1): Dropout(p=0.1, inplace=False)\n (2): Linear(in_features=50, out_features=206, bias=False)\n )\n )\n )\n )\n x, y = dls.one_batch()\n model(x)\n <denchmark-link:https://user-images.githubusercontent.com/34699116/98629613-dd8cac00-22de-11eb-8e9b-b47cc137e6e2.png></denchmark-link>\n \n Everything works well with AWD_LSTM, but not with AWD_QRNN. Please fix it. Thanks.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "sky1ove", "commentT": "2020-11-11T00:39:00Z", "comment_text": "\n \t\tPlease provide a complete reproducer. A colab link would be most helpful. The reproducer needs to use a publicly available dataset - preferably a small one that's provided in fastai's URLs class.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "sky1ove", "commentT": "2020-11-11T04:27:26Z", "comment_text": "\n \t\t\n Please provide a complete reproducer. A colab link would be most helpful. The reproducer needs to use a publicly available dataset - preferably a small one that's provided in fastai's URLs class.\n \n <denchmark-link:https://colab.research.google.com/drive/19WzwYTzs78DNvQ7VTw_37hbXq3l5ozsk?usp=sharing>https://colab.research.google.com/drive/19WzwYTzs78DNvQ7VTw_37hbXq3l5ozsk?usp=sharing</denchmark-link>\n \n Please check this colab\n \t\t"}}}, "commit": {"commit_id": "5b6148e6e81cdb7743a4470fb0984f4f27a3c500", "commit_author": "Jeremy Howard", "commitT": "2020-11-23 09:47:59-08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "Makefile", "file_new_name": "Makefile", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "31,34", "deleted_lines": "31,34"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "fastai\\text\\models\\qrnn.py", "file_new_name": "fastai\\text\\models\\qrnn.py", "file_complexity": {"file_NLOC": "137", "file_CCN": "70", "file_NToken": "1898"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "105,107", "deleted_lines": "105,106,108,109", "method_info": {"method_name": "forward", "method_params": "self,inp,hid", "method_startline": "101", "method_endline": "115", "method_complexity": {"method_NLOC": "15", "method_CCN": "12", "method_NToken": "258", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "nbs\\32_text.models.awdlstm.ipynb", "file_new_name": "nbs\\32_text.models.awdlstm.ipynb", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "531,543,557", "deleted_lines": null}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "nbs\\36_text.models.qrnn.ipynb", "file_new_name": "nbs\\36_text.models.qrnn.ipynb", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "348,350,478,490,493,494,495,503,504,510,511,521,522,527,529,530,532,536,537,538,540,541,542,543,544", "deleted_lines": "348,349,351,352,493,494,507,517,523,529"}}}}}}