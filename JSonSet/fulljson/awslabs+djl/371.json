{"BR": {"BR_id": "371", "BR_author": "jinlong-hao", "BRopenT": "2020-11-21T04:41:07Z", "BRcloseT": "2020-12-29T18:06:54Z", "BR_text": {"BRsummary": "EngineException with pytorch-native-cpu:osx-x86_64", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n When I run my inference in osx, I got the EngineException. It seems that the inference call the torch python code in my virtualenvs.\n The Code runs all right in linux if i change the classifier of  pytorch-native-cpu from osx-x86_64 to linux-x86_64.\n My Java code is:\n         Translator<Image, Classifications> translator = ImageClassificationTranslator.builder()\n                 .addTransform(new Resize(200, 150))\n                 .addTransform(new ToTensor())\n                 .build();\n \n         Criteria<Image, Classifications> criteria = Criteria.builder()\n                 .setTypes(Image.class, Classifications.class)\n                 .optApplication(Application.CV.IMAGE_CLASSIFICATION)\n                 .optModelUrls(\"file:///Users/jinlong.hao/Project/02-python/02-pytorch/02-drive-classification/output/model\")\n                 .optTranslator(translator)\n                 .build();\n \n         ZooModel<Image, Classifications> model = ModelZoo.loadModel(criteria);\n         Predictor<Image, Classifications> predictor = model.newPredictor(translator);\n I got the exception while loadModel(criteria)\n my pom:\n     <dependencyManagement>\n         <dependencies>\n             <dependency>\n                 <groupId>ai.djl</groupId>\n                 <artifactId>bom</artifactId>\n                 <version>0.8.0</version>\n                 <type>pom</type>\n                 <scope>import</scope>\n             </dependency>\n         </dependencies>\n     </dependencyManagement>\n \n     <dependencies>\n \n         <dependency>\n             <groupId>ai.djl</groupId>\n             <artifactId>model-zoo</artifactId>\n         </dependency>\n \n         <dependency>\n             <groupId>ai.djl</groupId>\n             <artifactId>api</artifactId>\n         </dependency>\n \n         <dependency>\n             <groupId>ai.djl.pytorch</groupId>\n             <artifactId>pytorch-engine</artifactId>\n             <scope>runtime</scope>\n         </dependency>\n \n         <dependency>\n             <groupId>ai.djl.pytorch</groupId>\n             <artifactId>pytorch-native-cpu</artifactId>\n             <version>1.6.0</version>\n             <classifier>osx-x86_64</classifier>\n             <scope>runtime</scope>\n         </dependency>\n     </dependencies>\n \n <denchmark-h:h3>Expected Behavior</denchmark-h>\n \n The same code can successfully execute in osx.\n <denchmark-h:h3>Error Message</denchmark-h>\n \n <denchmark-code>Exception in thread \"main\" ai.djl.engine.EngineException: \n \n aten::_convolution(Tensor input, Tensor weight, Tensor? bias, int[] stride, int[] padding, int[] dilation, bool transposed, int[] output_padding, int groups, bool benchmark, bool deterministic, bool cudnn_enabled) -> (Tensor):\n Expected at most 12 arguments but found 13 positional arguments.\n :\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/torch/nn/modules/conv.py(420): _conv_forward\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/torch/nn/modules/conv.py(423): forward\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/torch/nn/modules/module.py(709): _slow_forward\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/torch/nn/modules/module.py(725): _call_impl\n <ipython-input-4-9fa5f3569917>(14): forward\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/torch/nn/modules/module.py(709): _slow_forward\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/torch/nn/modules/module.py(725): _call_impl\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/torch/jit/_trace.py(940): trace_module\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/torch/jit/_trace.py(742): trace\n <ipython-input-9-1a9190abafbf>(6): <module>\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/IPython/core/interactiveshell.py(3418): run_code\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/IPython/core/interactiveshell.py(3338): run_ast_nodes\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/IPython/core/interactiveshell.py(3147): run_cell_async\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/IPython/core/async_helpers.py(68): _pseudo_sync_runner\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/IPython/core/interactiveshell.py(2923): _run_cell\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/IPython/core/interactiveshell.py(2878): run_cell\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/ipykernel/zmqshell.py(536): run_cell\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/ipykernel/ipkernel.py(306): do_execute\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/gen.py(234): wrapper\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/ipykernel/kernelbase.py(545): execute_request\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/gen.py(234): wrapper\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/ipykernel/kernelbase.py(268): dispatch_shell\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/gen.py(234): wrapper\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/ipykernel/kernelbase.py(365): process_one\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/gen.py(775): run\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/gen.py(741): __init__\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/gen.py(250): wrapper\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/ipykernel/kernelbase.py(381): dispatch_queue\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/gen.py(775): run\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/gen.py(814): inner\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/ioloop.py(741): _run_callback\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/ioloop.py(688): <lambda>\n /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/asyncio/events.py(88): _run\n /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/asyncio/base_events.py(1775): _run_once\n /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/asyncio/base_events.py(539): run_forever\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/tornado/platform/asyncio.py(199): start\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/ipykernel/kernelapp.py(612): start\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/traitlets/config/application.py(845): launch_instance\n /Users/dev/.local/share/virtualenvs/02-pytorch-Vcd_DXB5/lib/python3.7/site-packages/ipykernel_launcher.py(16): <module>\n /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/runpy.py(85): _run_code\n /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/runpy.py(193): _run_module_as_main\n Serialized   File \"code/__torch__/torch/nn/modules/conv.py\", line 10\n     input: Tensor) -> Tensor:\n     _0 = self.bias\n     input0 = torch._convolution(input, self.weight, _0, [1, 1], [0, 0], [1, 1], False, [0, 0], 1, False, False, True, True)\n              ~~~~~~~~~~~~~~~~~~ <--- HERE\n     return input0\n \n \tat ai.djl.pytorch.jni.PyTorchLibrary.moduleLoad(Native Method)\n \tat ai.djl.pytorch.jni.JniUtils.loadModule(JniUtils.java:1110)\n \tat ai.djl.pytorch.engine.PtModel.load(PtModel.java:72)\n \tat ai.djl.repository.zoo.BaseModelLoader.loadModel(BaseModelLoader.java:142)\n \tat ai.djl.repository.zoo.ModelZoo.loadModel(ModelZoo.java:162)\n \tat cn.eppdev.test.djl.pytorch.ImageClassification.main(ImageClassification.java:63)\n </denchmark-code>\n \n <denchmark-h:h2>How to Reproduce?</denchmark-h>\n \n <denchmark-h:h3>Steps to reproduce</denchmark-h>\n \n 1.download my model.pt and synset.txt to the same directory\n 2.run the same code in osx\n <denchmark-h:h2>What have you tried to solve it?</denchmark-h>\n \n <denchmark-h:h2>Environment Info</denchmark-h>\n \n Please run the command ./gradlew debugEnv from the root directory of DJL (if necessary, clone DJL first). It will output information about your system, environment, and installation that can help us debug your issue. Paste the output of the command below:\n <denchmark-code>PASTE OUTPUT HERE\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jinlong-hao", "commentT": "2020-11-21T04:42:30Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/awslabs/djl/files/5577014/synset.txt>synset.txt</denchmark-link>\n \n <denchmark-link:https://github.com/awslabs/djl/files/5577015/model.pt.zip>model.pt.zip</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jinlong-hao", "commentT": "2020-11-21T08:13:53Z", "comment_text": "\n \t\tThis looks like a jit issue. Looks you you traced model using pytorch 1.7.0\n I got the same error using pytorch 1.6.0, but it works fine with DJL 0.9.0-SNAPSHOT with PyTorch 1.7.0\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "jinlong-hao", "commentT": "2020-11-21T08:53:10Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/frankfliu>@frankfliu</denchmark-link>\n   then where can I get the djl 0.9.0-snapshot?  I search model-zoo and  pytorch-engine in maven.org and only find 0.8.0!\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "jinlong-hao", "commentT": "2020-11-21T10:04:48Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/jinlong-hao>@jinlong-hao</denchmark-link>\n  The latest djl version is 0.8.0, and the new version 0.9.0 has not been released\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "jinlong-hao", "commentT": "2020-11-23T18:10:56Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/jinlong-hao>@jinlong-hao</denchmark-link>\n  we have nightly snapshot available here:\n Gradle:\n <denchmark-code>repositories {\n     maven {\n         url \"https://oss.sonatype.org/content/repositories/snapshots/\"\n     }\n }\n </denchmark-code>\n \n We release our master branch build every night to this repo. You can start using the combination of 0.9.0-SNAPSHOT with PyTorch 1.7.0\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "jinlong-hao", "commentT": "2020-12-29T18:06:54Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/jinlong-hao>@jinlong-hao</denchmark-link>\n  you can try out djl 0.9.0 with pytorch 1.7 now! feel free to reopen the issue if you still have questions\n \t\t"}}}, "commit": {"commit_id": "88724abccdd753e79fd506ae230911f8b38e4dca", "commit_author": "Frank Liu", "commitT": "2020-12-18 17:42:55-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "paddlepaddle\\paddlepaddle-model-zoo\\src\\test\\java\\ai\\djl\\paddlepaddle\\zoo\\ImageClassificationTest.java", "file_new_name": "paddlepaddle\\paddlepaddle-model-zoo\\src\\test\\java\\ai\\djl\\paddlepaddle\\zoo\\ImageClassificationTest.java", "file_complexity": {"file_NLOC": "41", "file_CCN": "1", "file_NToken": "354"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "43", "deleted_lines": null, "method_info": {"method_name": "ImageClassificationTest::testImageClassification", "method_params": "", "method_startline": "35", "method_endline": "56", "method_complexity": {"method_NLOC": "21", "method_CCN": "1", "method_NToken": "184", "method_nesting_level": "1"}}}}}}}}