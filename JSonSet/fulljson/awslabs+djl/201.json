{"BR": {"BR_id": "201", "BR_author": "kkoripl", "BRopenT": "2020-10-10T10:48:26Z", "BRcloseT": "2020-10-12T19:42:40Z", "BR_text": {"BRsummary": "Zero size of a splitted datasets", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n When using randomSplit function with set ratios and receiving sub-RandomAccessDatasets invoking size() function on each of them returns 0, even if data inside is available.\n <denchmark-h:h3>Expected Behavior</denchmark-h>\n \n Function should return actual size of a dataset when limit property of a class RandomAccessDataset set for Long.max_value, as it is in this situation.\n <denchmark-h:h3>Steps to reproduce</denchmark-h>\n \n DatasetPath and batchSize come as a configuration for starting script.\n Repository made out of custom MNIST image dataset setup as described in ImageFolder docs.\n <denchmark-code>    private static final int MNIST_IMG_HEIGHT = 28;\n     private static final int MNIST_IMG_WIDTH = 28;\n \n     ImageFolder dataset = ImageFolder.builder()\n                 .optLimit(Long.MAX_VALUE)\n                 .setRepository(Repository.newInstance(\"mnistCustom\", Paths.get(datasetPath)))\n                 .optPipeline(preprocessImages(MNIST_IMG_WIDTH, MNIST_IMG_HEIGHT))\n                 .setSampling(batchSize, true)\n                 .build();\n \n         dataset.prepare();\n         System.out.println(dataset.size());\n         RandomAccessDataset[] sets = dataset.randomSplit(75, 25);\n         for (RandomAccessDataset set : sets) {\n             System.out.println(set.size());\n         }\n </denchmark-code>\n \n <denchmark-h:h2>What have you tried to solve it?</denchmark-h>\n \n Debugging into RandomAccessDataset class showed that for some reason when invoking .size() function on subdatasets the limit property is set to 0, even though earlier was set to maximum. Debugging into split function showed that limit is MAX during that time. Don't have any idea why is that and how it's set. Setting up limit property by invoking setOptLimit don't work either.\n <denchmark-h:h2>Environment Info</denchmark-h>\n \n Maven:\n `\n \n 4.0.0\n <denchmark-code><groupId>org.example</groupId>\n <artifactId>java-machine-learning</artifactId>\n <version>1.0-SNAPSHOT</version>\n <build>\n     <plugins>\n         <plugin>\n             <groupId>org.apache.maven.plugins</groupId>\n             <artifactId>maven-compiler-plugin</artifactId>\n             <configuration>\n                 <source>8</source>\n                 <target>8</target>\n             </configuration>\n         </plugin>\n     </plugins>\n </build>\n \n <properties>\n     <djl.version>0.6.0</djl.version>\n     <log4j.version>2.12.1</log4j.version>\n     <commons-cli.version>1.4</commons-cli.version>\n     <logback.version>1.1.7</logback.version>\n     <lombok.version>1.18.0</lombok.version>\n     <commons-csv.version>1.8</commons-csv.version>\n </properties>\n \n <dependencies>\n     <!-- Deep Java Library -->\n     <dependency>\n         <groupId>ai.djl</groupId>\n         <artifactId>api</artifactId>\n         <version>${djl.version}</version>\n     </dependency>\n \n     <dependency>\n         <groupId>ai.djl</groupId>\n         <artifactId>repository</artifactId>\n         <version>0.4.1</version>\n     </dependency>\n \n     <!-- DJL modele -->\n     <dependency>\n         <groupId>ai.djl.mxnet</groupId>\n         <artifactId>mxnet-engine</artifactId>\n         <version>${djl.version}</version>\n         <scope>runtime</scope>\n     </dependency>\n     <dependency>\n         <!-- pomaga poprawi\u0107 b\u0142\u0105d:No deep learning engine found exception. -->\n         <groupId>ai.djl.mxnet</groupId>\n         <artifactId>mxnet-native-auto</artifactId>\n         <version>1.7.0-b</version>\n         <scope>runtime</scope>\n     </dependency>\n \n     <dependency>\n         <groupId>ai.djl.mxnet</groupId>\n         <artifactId>mxnet-model-zoo</artifactId>\n         <version>${djl.version}</version>\n     </dependency>\n \n     <dependency>\n         <groupId>ai.djl</groupId>\n         <artifactId>model-zoo</artifactId>\n         <version>${djl.version}</version>\n     </dependency>\n \n     <!-- Basic datasets -->\n     <dependency>\n         <groupId>ai.djl</groupId>\n         <artifactId>basicdataset</artifactId>\n         <version>${djl.version}</version>\n     </dependency>\n \n     <!-- dodatkowe -->\n     <dependency>\n         <groupId>org.apache.logging.log4j</groupId>\n         <artifactId>log4j-slf4j-impl</artifactId>\n         <version>${log4j.version}</version>\n     </dependency>\n     <dependency>\n         <groupId>commons-cli</groupId>\n         <artifactId>commons-cli</artifactId>\n         <version>${commons-cli.version}</version>\n     </dependency>\n     <dependency>\n         <groupId>org.projectlombok</groupId>\n         <artifactId>lombok</artifactId>\n         <version>${lombok.version}</version>\n         <scope>provided</scope>\n     </dependency>\n     <dependency>\n         <groupId>org.apache.commons</groupId>\n         <artifactId>commons-csv</artifactId>\n         <version>${commons-csv.version}</version>\n     </dependency>\n </denchmark-code>\n \n `\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "kkoripl", "commentT": "2020-10-11T00:17:10Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/kkoripl>@kkoripl</denchmark-link>\n  I'm able to reproduce this issue, this is a bug in SubDataset constructor.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "kkoripl", "commentT": "2020-10-12T19:42:40Z", "comment_text": "\n \t\tFeel free to re-open the issue if you still have issue\n \t\t"}}}, "commit": {"commit_id": "3ef6a52945332a608b72dfaa613e81b74df0f89e", "commit_author": "Frank Liu", "commitT": "2020-10-10 19:40:30-07:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "0.875"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "api\\src\\main\\java\\ai\\djl\\training\\dataset\\RandomAccessDataset.java", "file_new_name": "api\\src\\main\\java\\ai\\djl\\training\\dataset\\RandomAccessDataset.java", "file_complexity": {"file_NLOC": "235", "file_CCN": "37", "file_NToken": "1544"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "411", "deleted_lines": null, "method_info": {"method_name": "RandomAccessDataset::SubDataset::SubDataset", "method_params": "dataset,indices,from,to", "method_startline": "406", "method_endline": "412", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "48", "method_nesting_level": "2"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "basicdataset\\src\\test\\java\\ai\\djl\\basicdataset\\ImageFolderTest.java", "file_new_name": "basicdataset\\src\\test\\java\\ai\\djl\\basicdataset\\ImageFolderTest.java", "file_complexity": {"file_NLOC": "96", "file_CCN": "2", "file_NToken": "819"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "113,114,115,116,117,118,119", "deleted_lines": null, "method_info": {"method_name": "ImageFolderTest::testRandomSplit", "method_params": "", "method_startline": "113", "method_endline": "119", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "76", "method_nesting_level": "1"}}}}}}}}