{"BR": {"BR_id": "30248", "BR_author": "junghau", "BRopenT": "2019-06-29T15:10:02Z", "BRcloseT": "2019-07-02T10:06:42Z", "BR_text": {"BRsummary": "tf.io.write_file not working in tf.function decorated function", "BRdescription": "\n System information\n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 18.04.2 and Windows 10\n TensorFlow installed from (source or binary): binary\n TensorFlow version (use command below): 2.0.0-beta1\n Python version: 3.7\n \n Describe the current behavior\n tf.io.write_file creates file in eager execution but produces no output file when decorated with @tf.function.\n Describe the expected behavior\n tf.io.write_file should create an output file whether or not being decorated with @tf.function.\n Code to reproduce the issue\n import tensorflow as tf\n \n @tf.function\n def writeJPEG_graph(img_decoded, filename):\n     out = tf.cast(img_decoded, tf.uint8)\n     out = tf.image.encode_jpeg(out, quality=100)\n     tf.io.write_file(filename, out)\n     \n def writeJPEG_eager(img_decoded, filename):\n     out = tf.cast(img_decoded, tf.uint8)\n     out = tf.image.encode_jpeg(out, quality=100)\n     tf.io.write_file(filename, out)\n \n img = tf.fill([256,256,3], 127) # example gray image\n writeJPEG_graph(img, \"./tfwrite_graph.jpg\") # \"tfwrite_graph.jpg\" not created\n writeJPEG_eager(img, \"./tfwrite_eager.jpg\") # \"tfwrite_eager.jpg\" created\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "junghau", "commentT": "2019-07-01T08:38:17Z", "comment_text": "\n \t\tI have tried on colab with TF version 2.0 beta1 and was able to reproduce the issue.Thanks!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "junghau", "commentT": "2019-07-02T10:06:43Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=30248>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=30248>No</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "junghau", "commentT": "2019-08-21T15:31:35Z", "comment_text": "\n \t\tThis also happens in 1.14, and sadly inhibits visualizing images augmented in tf.data.Dataset pipelines (since they are run as a Graph)\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "junghau", "commentT": "2019-08-21T18:04:51Z", "comment_text": "\n \t\tUnfortunately the fix didn't make it into the 1.14 release, and will only be available in 2.0.\n In 1.14, write_file should still be usable using the old-style tf.control_dependencies.\n \t\t"}}}, "commit": {"commit_id": "3baef3b569344f0af6071950a5fc9d828a4ee6a6", "commit_author": "Dan Moldovan", "commitT": "2019-07-02 03:04:10-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\core\\ops\\io_ops.cc", "file_new_name": "tensorflow\\core\\ops\\io_ops.cc", "file_complexity": {"file_NLOC": "407", "file_CCN": "7", "file_NToken": "2782"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "477", "deleted_lines": null}}}}}}