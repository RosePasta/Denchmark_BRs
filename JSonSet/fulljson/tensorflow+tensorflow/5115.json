{"BR": {"BR_id": "5115", "BR_author": "cgel", "BRopenT": "2016-10-21T13:48:48Z", "BRcloseT": "2016-11-10T03:07:40Z", "BR_text": {"BRsummary": "timeout breaks FIFOQueue", "BRdescription": "\n Ubuntu 14.04.5 LTS\n 0.10.0rc0\n Using timeout with notebooks is very useful in case you dequeue an empty queue or enqueue a full one. The problem is that after a timeout occurs a enqueue or dequeueop  throws an error\n <denchmark-code>import tensorflow as tf\n with tf.device(\"/cpu:0\"):\n     ph = tf.placeholder(tf.float32)\n     q = tf.FIFOQueue(2, tf.float32)\n     enq = q.enqueue(ph)\n     deq = q.dequeue()\n     timeout_option = tf.RunOptions(timeout_in_ms=1000)\n sess = tf.Session()\n sess.run(deq, options=timeout_option)\n </denchmark-code>\n \n here i get the usual timeout error. The problem is that when I then run\n sess.run(enq, feed_dict={ph:2}, options=timeout_option)\n i get the error:\n <denchmark-code>---------------------------------------------------------------------------\n CancelledError                            Traceback (most recent call last)\n <ipython-input-24-9067a9d62797> in <module>()\n ----> 1 sess.run(Q, options=timeout_option)\n \n /usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.pyc in run(self, fetches, feed_dict, options, run_metadata)\n     715     try:\n     716       result = self._run(None, fetches, feed_dict, options_ptr,\n --> 717                          run_metadata_ptr)\n     718       if run_metadata:\n     719         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n \n /usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.pyc in _run(self, handle, fetches, feed_dict, options, run_metadata)\n     913     if final_fetches or final_targets:\n     914       results = self._do_run(handle, final_targets, final_fetches,\n --> 915                              feed_dict_string, options, run_metadata)\n     916     else:\n     917       results = []\n \n /usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.pyc in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n     963     if handle is None:\n     964       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n --> 965                            target_list, options, run_metadata)\n     966     else:\n     967       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n \n /usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.pyc in _do_call(self, fn, *args)\n     983         except KeyError:\n     984           pass\n --> 985       raise type(e)(node_def, op, message)\n     986 \n     987   def _extend_graph(self):\n \n CancelledError: Dequeue operation was cancelled\n      [[Node: fifo_queue_Dequeue = QueueDequeue[_class=[\"loc:@fifo_queue\"], component_types=[DT_FLOAT, DT_INT64, DT_FLOAT], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](fifo_queue)]]\n      [[Node: PlaceholderWithDefault/_25 = _Recv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_14_PlaceholderWithDefault\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/gpu:0\"]()]]\n Caused by op u'fifo_queue_Dequeue', defined at:\n   File \"<string>\", line 1, in <module>\n   File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/kernel/zmq/kernelapp.py\", line 469, in main\n     app.start()\n   File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/kernel/zmq/kernelapp.py\", line 459, in start\n     ioloop.IOLoop.instance().start()\n   File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/ioloop.py\", line 160, in start\n     super(ZMQIOLoop, self).start()\n   File \"/home/cgel/.local/lib/python2.7/site-packages/tornado/ioloop.py\", line 883, in start\n     handler_func(fd_obj, events)\n   File \"/home/cgel/.local/lib/python2.7/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n     return fn(*args, **kwargs)\n   File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 433, in _handle_events\n     self._handle_recv()\n   File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 465, in _handle_recv\n     self._run_callback(callback, msg)\n   File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 407, in _run_callback\n     callback(*args, **kwargs)\n   File \"/home/cgel/.local/lib/python2.7/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n     return fn(*args, **kwargs)\n   File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/kernel/zmq/ipkernel.py\", line 281, in dispatcher\n     return self.dispatch_shell(stream, msg)\n   File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/kernel/zmq/ipkernel.py\", line 245, in dispatch_shell\n     handler(stream, idents, msg)\n   File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/kernel/zmq/ipkernel.py\", line 389, in execute_request\n     shell.run_cell(code, store_history=store_history, silent=silent)\n   File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2741, in run_cell\n     interactivity=interactivity, compiler=compiler)\n   File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2827, in run_ast_nodes\n     if self.run_code(code):\n   File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2883, in run_code\n     exec(code_obj, self.user_global_ns, self.user_ns)\n   File \"<ipython-input-1-73bf93787995>\", line 76, in <module>\n     input_state, action, Y = q.dequeue()\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/data_flow_ops.py\", line 418, in dequeue\n     self._queue_ref, self._dtypes, name=name)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 863, in _queue_dequeue\n     timeout_ms=timeout_ms, name=name)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 747, in apply_op\n     op_def=op_def)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2372, in create_op\n     original_op=self._default_original_op, op_def=op_def)\n   File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1298, in __init__\n     self._traceback = _extract_stack()\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "cgel", "commentT": "2016-10-24T22:36:38Z", "comment_text": "\n \t\tI tried from a recent version and it doesn't happen there. Do you want to upgrade?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "cgel", "commentT": "2016-10-25T18:13:06Z", "comment_text": "\n \t\tI can also reproduce this on 0.11rc0\n If dequeue on empty queue is cancelled because of DeadlineExceededError,\n the queue becomes unusable -- it's no longer possible to enqueue anything\n onto the queue.\n On Fri, Oct 21, 2016 at 6:48 AM, cgel <denchmark-link:mailto:notifications@github.com>notifications@github.com</denchmark-link>\n  wrote:\n \n Ubuntu 14.04.5 LTS\n 0.10.0rc0\n Using timeout with notebooks is very useful in case you dequeue an empty\n queue or enqueue a full one. The problem is that after a timeout occurs a\n enqueue or dequeueop throws an error\n import tensorflow as tf\n with tf.device(\"/cpu:0\"):\n ph = tf.placeholder(tf.float32)\n q = tf.FIFOQueue(2, tf.float32)\n enq = q.enqueue(ph)\n deq = q.dequeue()\n timeout_option = tf.RunOptions(timeout_in_ms=1000)\n sess = tf.Session()\n sess.run(deq, options=timeout_option)\n here i get the usual timeout error. The problem is that when I then run\n sess.run(enq, feed_dict={ph:2}, options=timeout_option)\n i get the error:\n \n CancelledError                            Traceback (most recent call last)\n  in ()\n ----> 1 sess.run(Q, options=timeout_option)\n /usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.pyc in run(self, fetches, feed_dict, options, run_metadata)\n 715     try:\n 716       result = self._run(None, fetches, feed_dict, options_ptr,\n --> 717                          run_metadata_ptr)\n 718       if run_metadata:\n 719         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n /usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.pyc in _run(self, handle, fetches, feed_dict, options, run_metadata)\n 913     if final_fetches or final_targets:\n 914       results = self._do_run(handle, final_targets, final_fetches,\n --> 915                              feed_dict_string, options, run_metadata)\n 916     else:\n 917       results = []\n /usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.pyc in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n 963     if handle is None:\n 964       return self._do_call(_run_fn, self._session, feed_dict, fetch_list,\n --> 965                            target_list, options, run_metadata)\n 966     else:\n 967       return self._do_call(_prun_fn, self._session, handle, feed_dict,\n /usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.pyc in _do_call(self, fn, *args)\n 983         except KeyError:\n 984           pass\n --> 985       raise type(e)(node_def, op, message)\n 986\n 987   def _extend_graph(self):\n CancelledError: Dequeue operation was cancelled\n [[Node: fifo_queue_Dequeue = QueueDequeue_class=[\"loc:@fifo_queue\"], component_types=[DT_FLOAT, DT_INT64, DT_FLOAT], timeout_ms=-1, _device=\"/job:localhost/replica:0/task:0/cpu:0\"]]\n [[Node: PlaceholderWithDefault/_25 = _Recvclient_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/gpu:0\", send_device=\"/job:localhost/replica:0/task:0/cpu:0\", send_device_incarnation=1, tensor_name=\"edge_14_PlaceholderWithDefault\", tensor_type=DT_FLOAT, _device=\"/job:localhost/replica:0/task:0/gpu:0\"]]\n Caused by op u'fifo_queue_Dequeue', defined at:\n File \"\", line 1, in \n File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/kernel/zmq/kernelapp.py\", line 469, in main\n app.start()\n File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/kernel/zmq/kernelapp.py\", line 459, in start\n ioloop.IOLoop.instance().start()\n File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/ioloop.py\", line 160, in start\n super(ZMQIOLoop, self).start()\n File \"/home/cgel/.local/lib/python2.7/site-packages/tornado/ioloop.py\", line 883, in start\n handler_func(fd_obj, events)\n File \"/home/cgel/.local/lib/python2.7/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n return fn(_args, *_kwargs)\n File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 433, in _handle_events\n self._handle_recv()\n File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 465, in _handle_recv\n self._run_callback(callback, msg)\n File \"/usr/lib/python2.7/dist-packages/zmq/eventloop/zmqstream.py\", line 407, in _run_callback\n callback(_args, *_kwargs)\n File \"/home/cgel/.local/lib/python2.7/site-packages/tornado/stack_context.py\", line 275, in null_wrapper\n return fn(_args, *_kwargs)\n File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/kernel/zmq/ipkernel.py\", line 281, in dispatcher\n return self.dispatch_shell(stream, msg)\n File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/kernel/zmq/ipkernel.py\", line 245, in dispatch_shell\n handler(stream, idents, msg)\n File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/kernel/zmq/ipkernel.py\", line 389, in execute_request\n shell.run_cell(code, store_history=store_history, silent=silent)\n File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2741, in run_cell\n interactivity=interactivity, compiler=compiler)\n File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2827, in run_ast_nodes\n if self.run_code(code):\n File \"/home/cgel/.local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2883, in run_code\n exec(code_obj, self.user_global_ns, self.user_ns)\n File \"\", line 76, in \n input_state, action, Y = q.dequeue()\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/data_flow_ops.py\", line 418, in dequeue\n self._queue_ref, self._dtypes, name=name)\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_data_flow_ops.py\", line 863, in _queue_dequeue\n timeout_ms=timeout_ms, name=name)\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py\", line 747, in apply_op\n op_def=op_def)\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 2372, in create_op\n original_op=self._default_original_op, op_def=op_def)\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 1298, in init\n self._traceback = _extract_stack()\n \u2014\n You are receiving this because you are subscribed to this thread.\n Reply to this email directly, view it on GitHub\n #5115, or mute the thread\n https://github.com/notifications/unsubscribe-auth/AABaHEAbq2SwT4ovuH_LMYQUf622LxEqks5q2MLEgaJpZM4KdPpU\n .\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "cgel", "commentT": "2016-10-25T18:22:13Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/gunan>@gunan</denchmark-link>\n  there seems to be a enqueue/dequeue issue in 0.11, that does not appear in HEAD. A candidate for cherry-picking?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "cgel", "commentT": "2016-10-25T18:22:32Z", "comment_text": "\n \t\tSame behavior in 11rc1. To clarify, the problem happens if you call enqueue\n after previous dequeue operation timed out:\n conda create -n tf11rc1-cpu python=3.5\n source activate tf11rc1-cpu\n export TF_BINARY_URL=\n <denchmark-link:https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-0.11.0rc1-py3-none-any.whl>https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-0.11.0rc1-py3-none-any.whl</denchmark-link>\n \n pip install --upgrade $TF_BINARY_URL\n export CUDA_VISIBLE_DEVICES=\n python\n import tensorflow as tf\n print(tf.version)\n q = tf.FIFOQueue(2, tf.float32)\n enq = q.enqueue(1.)\n deq = q.dequeue()\n timeout_option = tf.RunOptions(timeout_in_ms=1000)\n sess = tf.Session()\n print(sess.run(enq))  # works\n print(sess.run(deq))  # works\n print(sess.run(deq, options=timeout_option)) # times out\n print(sess.run(enq))  # doesn't work\n <denchmark-h:hr></denchmark-h>\n \n (tf11rc1-cpu) bash-3.2$ export CUDA_VISIBLE_DEVICES=\n (tf11rc1-cpu) bash-3.2$ python\n Python 3.5.2 |Continuum Analytics, Inc.| (default, Jul  2 2016, 17:52:12)\n [GCC 4.2.1 Compatible Apple LLVM 4.2 (clang-425.0.28)] on darwin\n Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n \n \n \n import tensorflow as tf\n print(tf.version)\n 0.11.0rc1\n q = tf.FIFOQueue(2, tf.float32)\n enq = q.enqueue(1.)\n deq = q.dequeue()\n timeout_option = tf.RunOptions(timeout_in_ms=1000)\n sess = tf.Session()\n print(sess.run(enq))\n None\n print(sess.run(deq))  # works\n 1.0\n print(sess.run(deq, options=timeout_option)) # times out\n W tensorflow/core/kernels/queue_base.cc:302] _0_fifo_queue: Skipping\n cancelled dequeue attempt with queue not closed\n Traceback (most recent call last):\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 972, in _do_call\n return fn(*args)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 954, in _run_fn\n status, run_metadata)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/contextlib.py\",\n line 66, in exit\n next(self.gen)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/framework/errors.py\",\n line 463, in raise_exception_on_not_ok_status\n pywrap_tensorflow.TF_GetCode(status))\n tensorflow.python.framework.errors.DeadlineExceededError: Timed out waiting\n for notification\n \n \n \n During handling of the above exception, another exception occurred:\n Traceback (most recent call last):\n File \"\", line 1, in \n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 717, in run\n run_metadata_ptr)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 915, in _run\n feed_dict_string, options, run_metadata)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 965, in _do_run\n target_list, options, run_metadata)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 985, in _do_call\n raise type(e)(node_def, op, message)\n tensorflow.python.framework.errors.DeadlineExceededError: Timed out waiting\n for notification\n \n \n \n print(sess.run(enq))  # doesn't work\n Traceback (most recent call last):\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 972, in _do_call\n return fn(*args)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 954, in _run_fn\n status, run_metadata)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/contextlib.py\",\n line 66, in exit\n next(self.gen)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/framework/errors.py\",\n line 463, in raise_exception_on_not_ok_status\n pywrap_tensorflow.TF_GetCode(status))\n tensorflow.python.framework.errors.CancelledError: Enqueue operation was\n cancelled\n [[Node: fifo_queue_enqueue = QueueEnqueue[Tcomponents=[DT_FLOAT],\n _class=[\"loc:@fifo_queue\"], timeout_ms=-1,\n _device=\"/job:localhost/replica:0/task:0/cpu:0\"](fifo_queue,\n fifo_queue_enqueue/component_0)]]\n \n \n \n During handling of the above exception, another exception occurred:\n Traceback (most recent call last):\n File \"\", line 1, in \n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 717, in run\n run_metadata_ptr)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 915, in _run\n feed_dict_string, options, run_metadata)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 965, in _do_run\n target_list, options, run_metadata)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/client/session.py\",\n line 985, in _do_call\n raise type(e)(node_def, op, message)\n tensorflow.python.framework.errors.CancelledError: Enqueue operation was\n cancelled\n [[Node: fifo_queue_enqueue = QueueEnqueue[Tcomponents=[DT_FLOAT],\n _class=[\"loc:@fifo_queue\"], timeout_ms=-1,\n _device=\"/job:localhost/replica:0/task:0/cpu:0\"](fifo_queue,\n fifo_queue_enqueue/component_0)]]\n Caused by op 'fifo_queue_enqueue', defined at:\n File \"\", line 1, in \n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/ops/data_flow_ops.py\",\n line 329, in enqueue\n return gen_data_flow_ops._queue_enqueue(self._queue_ref, vals,\n name=scope)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/ops/gen_data_flow_ops.py\",\n line 982, in _queue_enqueue\n name=name)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/framework/op_def_library.py\",\n line 756, in apply_op\n op_def=op_def)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\",\n line 2380, in create_op\n original_op=self._default_original_op, op_def=op_def)\n File\n \"/Users/yaroslav/anaconda/envs/tf11rc1-cpu/lib/python3.5/site-packages/tensorflow/python/framework/ops.py\",\n line 1298, in init\n self._traceback = _extract_stack()\n CancelledError (see above for traceback): Enqueue operation was cancelled\n [[Node: fifo_queue_enqueue = QueueEnqueue[Tcomponents=[DT_FLOAT],\n _class=[\"loc:@fifo_queue\"], timeout_ms=-1,\n _device=\"/job:localhost/replica:0/task:0/cpu:0\"](fifo_queue,\n fifo_queue_enqueue/component_0)]]\n On Mon, Oct 24, 2016 at 3:36 PM, drpngx <denchmark-link:mailto:notifications@github.com>notifications@github.com</denchmark-link>\n  wrote:\n \n I tried from a recent version and it doesn't happen there. Do you want to\n upgrade?\n \u2014\n You are receiving this because you are subscribed to this thread.\n Reply to this email directly, view it on GitHub\n #5115 (comment),\n or mute the thread\n https://github.com/notifications/unsubscribe-auth/AABaHIyD8MLoO3AHyWZdJooYn2zy_hphks5q3TL4gaJpZM4KdPpU\n .\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "cgel", "commentT": "2016-10-25T18:25:49Z", "comment_text": "\n \t\tsure, if we have a fix let's go ahead and cherrypick that into 0.11\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "cgel", "commentT": "2016-10-25T18:27:47Z", "comment_text": "\n \t\tI didn't test after timeout, let me see.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "cgel", "commentT": "2016-10-25T19:17:16Z", "comment_text": "\n \t\tYeah, also broken at HEAD.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "cgel", "commentT": "2016-10-26T01:33:58Z", "comment_text": "\n \t\tRight. The dequeue has a closure which calls Cancel, but that is ignored, because the queue is not closed_.\n <denchmark-code>W1025 18:29:29.356150   47689 queue_base.cc:303] _0_fifo_queue: Skipping cancelled dequeue attempt with queue not closed\n </denchmark-code>\n \n <denchmark-link:https://github.com/ebrevdo>@ebrevdo</denchmark-link>\n  any clue?\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "cgel", "commentT": "2016-10-27T22:04:39Z", "comment_text": "\n \t\tLooks like <denchmark-link:https://github.com/tensorflow/tensorflow/blob/32d1dcc10e1fdf33dc6742337c6e0869f7b3c557/tensorflow/core/common_runtime/direct_session.cc#L1166>this</denchmark-link>\n  is the code responsible:\n       // TODO(sherrym): This cancels all steps in the session, even ones that\n       // have not exceeded their deadline. An alternative would be to use a\n       // two-level cancellation manager with a Session-global one containing\n       // several step-local ones. Probably the RunState should have its own\n       // CancellationManager.\n       cancellation_manager_->StartCancel();\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "cgel", "commentT": "2016-10-28T17:33:19Z", "comment_text": "\n \t\tDo we have a fix for this? We are still accepting cherry-picks for the RC until EOD today.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "cgel", "commentT": "2016-11-07T19:26:25Z", "comment_text": "\n \t\tI have some time to look at this now, so I'll attempt a quick fix.\n \t\t"}}}, "commit": {"commit_id": "f46fe646a26f0514fdfbfcea3882fd0120f24388", "commit_author": "Derek Murray", "commitT": "2016-11-09 13:48:52-08:00", "commit_complexity": {"commit_NLOC": "0.4482758620689655", "commit_CCN": "0.4827586206896552", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "tensorflow\\core\\common_runtime\\direct_session.cc", "file_new_name": "tensorflow\\core\\common_runtime\\direct_session.cc", "file_complexity": {"file_NLOC": "921", "file_CCN": "152", "file_NToken": "6419"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "1171,1172,1173,1174,1175,1176", "method_info": {"method_name": "tensorflow::DirectSession::WaitForNotification", "method_params": "run_state,timeout_in_ms", "method_startline": "1160", "method_endline": "1181", "method_complexity": {"method_NLOC": "17", "method_CCN": "3", "method_NToken": "84", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "410,429,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,489,490,491,492,493,494", "deleted_lines": "428,471,472,473", "method_info": {"method_name": "tensorflow::DirectSession::Run", "method_params": "run_options,inputs,output_names,target_nodes,outputs,run_metadata", "method_startline": "364", "method_endline": "550", "method_complexity": {"method_NLOC": "140", "method_CCN": "22", "method_NToken": "984", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "1183,1194", "deleted_lines": null, "method_info": {"method_name": "tensorflow::DirectSession::WaitForNotification", "method_params": "run_state,cm,timeout_in_ms", "method_startline": "1182", "method_endline": "1199", "method_complexity": {"method_NLOC": "18", "method_CCN": "3", "method_NToken": "88", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "711,712", "deleted_lines": "690", "method_info": {"method_name": "tensorflow::DirectSession::PRun", "method_params": "handle,inputs,output_names,outputs", "method_startline": "628", "method_endline": "718", "method_complexity": {"method_NLOC": "74", "method_CCN": "15", "method_NToken": "492", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\core\\common_runtime\\direct_session.h", "file_new_name": "tensorflow\\core\\common_runtime\\direct_session.h", "file_complexity": {"file_NLOC": "168", "file_CCN": "3", "file_NToken": "1111"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "212,213,214,215", "deleted_lines": "212"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\python\\kernel_tests\\fifo_queue_test.py", "file_new_name": "tensorflow\\python\\kernel_tests\\fifo_queue_test.py", "file_complexity": {"file_NLOC": "1219", "file_CCN": "191", "file_NToken": "11995"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1515,1516,1517,1518,1519,1520,1521,1522,1523,1524,1525,1526,1527,1528,1529,1530", "deleted_lines": null, "method_info": {"method_name": "testReusableAfterTimeout", "method_params": "self", "method_startline": "1515", "method_endline": "1530", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "122", "method_nesting_level": "1"}}}}}}}}