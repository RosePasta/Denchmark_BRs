{"BR": {"BR_id": "46423", "BR_author": "WeiChungChang", "BRopenT": "2021-01-14T08:38:05Z", "BRcloseT": "2021-01-15T02:49:29Z", "BR_text": {"BRsummary": "writer_test of serialization failed for squeeznet", "BRdescription": "\n System information\n \n OS Platform and Distribution  Linux Ubuntu 16.04\n TensorFlow installed from source\n TensorFlow version (use command below):\n Python version: Python 3.5.2\n Bazel version (if compiling from source): Build label: 3.7.2\n GCC/Compiler version (if compiling from source) gcc (Ubuntu 5.4.0-6ubuntu1~16.04.12) 5.4.0 20160609\n \n Describe the current behavior\n \n download squeezenet (squeezenet.tflit)\n build write test of serialization : bazel build -c opt //tensorflow/lite/tools/serialization:writer_test\n bazel-bin/tensorflow/lite/tools/serialization/writer_test [model folder]/squeezenet.tflite\n \n <denchmark-code>ERROR: tensorflow/lite/kernels/reshape.cc:69 num_input_elements != num_output_elements (1001 != 1)\n ERROR: Node number 38 (RESHAPE) failed to prepare.\n \n AllocateTensors failed on the round-tripped model.\n </denchmark-code>\n \n Describe the expected behavior\n pass write test\n Standalone code to reproduce the issue\n \n download squeezenet (squeezenet.tflit)\n build write test of serialization : bazel build -c opt //tensorflow/lite/tools/serialization:writer_test\n bazel-bin/tensorflow/lite/tools/serialization/writer_test [model folder]/squeezenet.tflite\n \n Other info / logs Include any logs or source code that would be helpful to\n <denchmark-code>ERROR: tensorflow/lite/kernels/reshape.cc:69 num_input_elements != num_output_elements (1001 != 1)\n ERROR: Node number 38 (RESHAPE) failed to prepare.\n \n AllocateTensors failed on the round-tripped model.\n </denchmark-code>\n \n A proposal of fix is at: <denchmark-link:https://github.com/tensorflow/tensorflow/pull/46422>#46422</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "WeiChungChang", "commentT": "2021-01-14T09:12:17Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/thaink>@thaink</denchmark-link>\n  could you take a look at this issue and the proposal fix <denchmark-link:https://github.com/tensorflow/tensorflow/pull/46422>#46422</denchmark-link>\n  as well?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "WeiChungChang", "commentT": "2021-01-14T11:04:12Z", "comment_text": "\n \t\tHow did you create the model? Could you share your conversion code to reproduce and some valid sample inputs?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "WeiChungChang", "commentT": "2021-01-14T11:10:21Z", "comment_text": "\n \t\tDear <denchmark-link:https://github.com/abattery>@abattery</denchmark-link>\n \n The model directly comes from tflite hosted_models zoo.\n URL:\n <denchmark-link:https://www.tensorflow.org/lite/guide/hosted_models>https://www.tensorflow.org/lite/guide/hosted_models</denchmark-link>\n \n file:\n <denchmark-link:https://storage.googleapis.com/download.tensorflow.org/models/tflite/model_zoo/upload_20180427/squeezenet_2018_04_27.tgz>https://storage.googleapis.com/download.tensorflow.org/models/tflite/model_zoo/upload_20180427/squeezenet_2018_04_27.tgz</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "WeiChungChang", "commentT": "2021-01-14T11:34:10Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/WeiChungChang>@WeiChungChang</denchmark-link>\n \n I could reproduce your problem. The root cause is that, the deprecated new_shape attribute is not being copied into the result by the writer library. Instead of your fix at <denchmark-link:https://github.com/tensorflow/tensorflow/pull/46422>#46422</denchmark-link>\n  , we will create a simple fix, instead in the writer library.\n Thank you for finding out this issue and reporting to us!\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "WeiChungChang", "commentT": "2021-01-14T11:45:43Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/abattery>@abattery</denchmark-link>\n \n It sounds great.\n Could you put the link of the patch here when close please?\n I would like to know the detail and how to fix it from the other way.\n Thank you!\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "WeiChungChang", "commentT": "2021-01-15T02:49:31Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/46423>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/46423>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "f12082d7af509e9549d8e8fb2b514ccd0db0e84e", "commit_author": "Jaesung Chung", "commitT": "2021-01-14 18:47:51-08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\lite\\tools\\serialization\\option_writer_generator.cc", "file_new_name": "tensorflow\\lite\\tools\\serialization\\option_writer_generator.cc", "file_complexity": {"file_NLOC": "391", "file_CCN": "66", "file_NToken": "2178"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "285,286,287", "deleted_lines": "284", "method_info": {"method_name": "tflite::GenerateImportForReshapeOp", "method_params": "fp", "method_startline": "279", "method_endline": "298", "method_complexity": {"method_NLOC": "20", "method_CCN": "1", "method_NToken": "31", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\lite\\tools\\serialization\\writer_lib_test.cc", "file_new_name": "tensorflow\\lite\\tools\\serialization\\writer_lib_test.cc", "file_complexity": {"file_NLOC": "399", "file_CCN": "21", "file_NToken": "3431"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "330,331,332,333,334,335,336,337,338,339,340,341,342", "deleted_lines": "329,330,331,332,376,378,380", "method_info": {"method_name": "tflite::TEST_P", "method_params": "ReshapeLayerTest,ReshapeLayerTest", "method_startline": "319", "method_endline": "381", "method_complexity": {"method_NLOC": "58", "method_CCN": "5", "method_NToken": "466", "method_nesting_level": "1"}}}}}}}}