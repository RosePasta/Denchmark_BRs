{"BR": {"BR_id": "11016", "BR_author": "c810armyHuan", "BRopenT": "2017-06-23T17:16:38Z", "BRcloseT": "2017-06-30T19:58:01Z", "BR_text": {"BRsummary": "map_func of tf.contrib.data.Dataset.map gets dict keys instead of values when the nested structure of Dataset is dict", "BRdescription": "\n <denchmark-h:h3>System information</denchmark-h>\n \n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow): No\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 16.04\n TensorFlow installed from (source or binary): source\n TensorFlow version (use command below): b'0.5.0-12520-g1111e06d9' 1.2.0-rc2\n Bazel version (if compiling from source): 0.4.5\n CUDA/cuDNN version: 8.0/6\n GPU model and memory:\n \n <denchmark-h:h3>Describe the problem</denchmark-h>\n \n If the nested structure of  is ,  will call <denchmark-link:https://github.com/tensorflow/tensorflow/blob/1111e06d9cd691cbdfcb67cf9f234a504f4e0f6d/tensorflow/contrib/data/python/ops/dataset_ops.py#L1463>map_func(*nested_args)</denchmark-link>\n  and pass the keys of  instead of components in the dataset to . It seems that  or  need to be passed to , so that  could transform the elements in the dataset.\n <denchmark-h:h3>Source code / logs</denchmark-h>\n \n import tensorflow as tf\n \n def foo(*args, **kwargs):\n     print(args, kwargs) # ('a', 'b') {}\n     return 1 * 100, 2 * 200\n \n tf.contrib.data.Dataset.from_tensors({'a': [1], 'b': [2]}).map(foo)\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "c810armyHuan", "commentT": "2017-06-23T22:46:15Z", "comment_text": "\n \t\tI tried reproducing and I think that Dicts are not supported as inputs in general\n \n \n \n a = tf.contrib.data.Dataset.from_tensors({'a': [1], 'b': [2]})\n Traceback (most recent call last):\n File \"\", line 1, in \n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 460, in from_tensors\n return TensorDataset(tensors)\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/contrib/data/python/ops/dataset_ops.py\", line 864, in init\n for i, t in enumerate(nest.flatten(tensors))\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 676, in convert_to_tensor\n as_ref=False)\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py\", line 741, in internal_convert_to_tensor\n ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/constant_op.py\", line 113, in _constant_tensor_conversion_function\n return constant(v, dtype=dtype, name=name)\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/constant_op.py\", line 102, in constant\n tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))\n File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/tensor_util.py\", line 462, in make_tensor_proto\n \"supported type.\" % (type(values), values))\n TypeError: Failed to convert object of type <type 'dict'> to Tensor. Contents: {'a': [1], 'b': [2]}. Consider casting elements to a supported type.\n \n \n \n My tensorflow version was 1.2.0 though.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "c810armyHuan", "commentT": "2017-06-24T01:35:18Z", "comment_text": "\n \t\tIt seems that <denchmark-link:https://github.com/tensorflow/tensorflow/commit/f3f53e8b394bdcaddc707f7bde8dcc98a73531e7>f3f53e8</denchmark-link>\n  adds support for  as nested structures of . I built master branch from source.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "c810armyHuan", "commentT": "2017-06-28T23:37:49Z", "comment_text": "\n \t\tThis is definitely a bug. Thanks for catching it! I have a fix in the works.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "c810armyHuan", "commentT": "2017-06-29T01:36:30Z", "comment_text": "\n \t\tIt seemed that the parameter padded_shapes for tf.contrib.data.Dataset.padded_batch can't be dict too.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "c810armyHuan", "commentT": "2017-06-29T15:05:50Z", "comment_text": "\n \t\tThanks! That turned up when I was testing the fix.\n \t\t"}}}, "commit": {"commit_id": "9b11f458196f6f0528c9974238497a6c8b6da547", "commit_author": "Derek Murray", "commitT": "2017-06-29 11:15:12-07:00", "commit_complexity": {"commit_NLOC": "0.8833333333333333", "commit_CCN": "1.0", "commit_Nprams": "0.9"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tensorflow\\contrib\\data\\python\\kernel_tests\\bucketing_test.py", "file_new_name": "tensorflow\\contrib\\data\\python\\kernel_tests\\bucketing_test.py", "file_complexity": {"file_NLOC": "208", "file_CCN": "27", "file_NToken": "2325"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "260,261,262,263,264,265,266,267,268,269,273,276,277,294,296", "deleted_lines": "260,261,265,268,269,286,288", "method_info": {"method_name": "testEvenOddBucketsFilterOutAllOdd", "method_params": "self", "method_startline": "258", "method_endline": "296", "method_complexity": {"method_NLOC": "22", "method_CCN": "1", "method_NToken": "217", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "264,265,266,267,268,269", "deleted_lines": "265,268,269", "method_info": {"method_name": "testEvenOddBucketsFilterOutAllOdd._dynamic_pad_fn", "method_params": "bucket,window,_", "method_startline": "264", "method_endline": "269", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "68", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "260,261,262", "deleted_lines": "260,261", "method_info": {"method_name": "testEvenOddBucketsFilterOutAllOdd._map_fn", "method_params": "v", "method_startline": "259", "method_endline": "262", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "42", "method_nesting_level": "2"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\contrib\\data\\python\\kernel_tests\\filter_dataset_op_test.py", "file_new_name": "tensorflow\\contrib\\data\\python\\kernel_tests\\filter_dataset_op_test.py", "file_complexity": {"file_NLOC": "71", "file_CCN": "14", "file_NToken": "711"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101", "deleted_lines": null, "method_info": {"method_name": "testFilterDict", "method_params": "self", "method_startline": "86", "method_endline": "101", "method_complexity": {"method_NLOC": "15", "method_CCN": "3", "method_NToken": "158", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\contrib\\data\\python\\kernel_tests\\flat_map_dataset_op_test.py", "file_new_name": "tensorflow\\contrib\\data\\python\\kernel_tests\\flat_map_dataset_op_test.py", "file_complexity": {"file_NLOC": "88", "file_CCN": "15", "file_NToken": "784"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120", "deleted_lines": null, "method_info": {"method_name": "testMapDict", "method_params": "self", "method_startline": "105", "method_endline": "120", "method_complexity": {"method_NLOC": "15", "method_CCN": "3", "method_NToken": "143", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\contrib\\data\\python\\kernel_tests\\map_dataset_op_test.py", "file_new_name": "tensorflow\\contrib\\data\\python\\kernel_tests\\map_dataset_op_test.py", "file_complexity": {"file_NLOC": "260", "file_CCN": "55", "file_NToken": "2341"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "327,328,329,330,331,332,333,334,335,336,337,338,339,340", "deleted_lines": null, "method_info": {"method_name": "testMapDict", "method_params": "self", "method_startline": "327", "method_endline": "340", "method_complexity": {"method_NLOC": "13", "method_CCN": "2", "method_NToken": "127", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "tensorflow\\contrib\\data\\python\\ops\\dataset_ops.py", "file_new_name": "tensorflow\\contrib\\data\\python\\ops\\dataset_ops.py", "file_complexity": {"file_NLOC": "971", "file_CCN": "215", "file_NToken": "6868"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1491", "deleted_lines": "1486", "method_info": {"method_name": "tf_map_func", "method_params": "args", "method_startline": "1483", "method_endline": "1503", "method_complexity": {"method_NLOC": "14", "method_CCN": "6", "method_NToken": "128", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "1402", "deleted_lines": "1397", "method_info": {"method_name": "__init__", "method_params": "self,input_dataset,key_func,reduce_func,window_size", "method_startline": "1389", "method_endline": "1429", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "100", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "1617", "deleted_lines": "1612", "method_info": {"method_name": "__init__", "method_params": "self,input_dataset,predicate", "method_startline": "1603", "method_endline": "1630", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "59", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "1360,1361,1362", "deleted_lines": null, "method_info": {"method_name": "_should_unpack_args", "method_params": "args", "method_startline": "1360", "method_endline": "1362", "method_complexity": {"method_NLOC": "2", "method_CCN": "2", "method_NToken": "21", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "1402", "deleted_lines": "1397", "method_info": {"method_name": "__init__.tf_key_func", "method_params": "args", "method_startline": "1396", "method_endline": "1409", "method_complexity": {"method_NLOC": "12", "method_CCN": "4", "method_NToken": "95", "method_nesting_level": "2"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "1617", "deleted_lines": "1612", "method_info": {"method_name": "__init__.tf_predicate", "method_params": "args", "method_startline": "1609", "method_endline": "1627", "method_complexity": {"method_NLOC": "13", "method_CCN": "5", "method_NToken": "111", "method_nesting_level": "2"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tensorflow\\contrib\\data\\python\\util\\nest.py", "file_new_name": "tensorflow\\contrib\\data\\python\\util\\nest.py", "file_complexity": {"file_NLOC": "166", "file_CCN": "64", "file_NToken": "1043"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "289,290", "deleted_lines": "289", "method_info": {"method_name": "_yield_flat_up_to", "method_params": "shallow_tree,input_tree", "method_startline": "286", "method_endline": "294", "method_complexity": {"method_NLOC": "8", "method_CCN": "4", "method_NToken": "48", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "499", "deleted_lines": null, "method_info": {"method_name": "map_structure_up_to", "method_params": "shallow_tree,func,inputs", "method_startline": "429", "method_endline": "501", "method_complexity": {"method_NLOC": "9", "method_CCN": "5", "method_NToken": "73", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\contrib\\data\\python\\util\\nest_test.py", "file_new_name": "tensorflow\\contrib\\data\\python\\util\\nest_test.py", "file_complexity": {"file_NLOC": "240", "file_CCN": "7", "file_NToken": "2754"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "290,291,292,293,294,295,296", "deleted_lines": null, "method_info": {"method_name": "testFlattenUpTo", "method_params": "self", "method_startline": "190", "method_endline": "296", "method_complexity": {"method_NLOC": "85", "method_CCN": "1", "method_NToken": "872", "method_nesting_level": "1"}}}}}}}}