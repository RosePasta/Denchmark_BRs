{"BR": {"BR_id": "11829", "BR_author": "patrikerdes", "BRopenT": "2017-07-27T22:21:25Z", "BRcloseT": "2017-09-17T20:38:41Z", "BR_text": {"BRsummary": "Slow to import tensorflow.contrib with Python 3 because inspect.stack is slow", "BRdescription": "\n <denchmark-h:h3>System information</denchmark-h>\n \n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow): No\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): macOS Sierra 10.12.5\n TensorFlow installed from (source or binary): source\n TensorFlow version (use command below): v1.2.0-2420-g2b4a0f9a4 1.3.0-rc0\n Python version: 3.6.2\n Bazel version (if compiling from source): 0.5.2-homebrew\n CUDA/cuDNN version: CPU only build\n GPU model and memory: CPU only build\n Exact command to reproduce: time python3 -c \"import tensorflow.contrib\"\n \n <denchmark-h:h3>The problem</denchmark-h>\n \n Doing import tensorflow.contrib take 7.5 seconds on my machine when doing it with Python 3.6.2. With Python 2.7.13 it takes 3.2 seconds.\n Investigating this revealed that a lot of time is spent in _inspect.stack() in the function make_decorator in  python/util/tf_decorator.py. The stack is inspected to find the name of the caller of the function. With Python2 inspect.stack() is fast, but with Python 3 each call to inspect.stack() take approximately 0.2 seconds and there are 23 calls made, which account for the difference in time between Python 2 and 3.\n <denchmark-h:h3>References</denchmark-h>\n \n Keras by default imports tensorflow.contrib when the Tensorflow backend is used. Therefore Keras is slow to import when using Python 3: <denchmark-link:https://github.com/keras-team/keras/issues/7408>keras-team/keras#7408</denchmark-link>\n \n There is a stackoverflow question referencing this issue: <denchmark-link:https://stackoverflow.com/questions/45093653/import-tensorflow-contrib-module-is-slow-in-tensorflow-1-2-1>https://stackoverflow.com/questions/45093653/import-tensorflow-contrib-module-is-slow-in-tensorflow-1-2-1</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "patrikerdes", "commentT": "2017-07-31T22:32:52Z", "comment_text": "\n \t\tIs this PR also useful?  <denchmark-link:https://github.com/tensorflow/tensorflow/pull/11919>#11919</denchmark-link>\n \n Waiting on this PR: <denchmark-link:https://github.com/tensorflow/tensorflow/pull/11830>#11830</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "patrikerdes", "commentT": "2017-10-09T10:51:28Z", "comment_text": "\n \t\tI use TensorFlow and PythonTeX to make reproducible dynamic reports. Every time I update the code chunk that uses tf.contrib I have to wait about 10 seconds till the module is imported. It's so annoying. Fix it, please or suggest temporary workaround to speed up this import.\n There were some patches. So which version is improved?\n P.S. My Python version is 3.5.2, TensorFlow 1.3.0. And I wait from 15 to 30 seconds!\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "patrikerdes", "commentT": "2017-10-09T16:50:07Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/konstunn>@konstunn</denchmark-link>\n  did you sync past <denchmark-link:https://github.com/tensorflow/tensorflow/issues/11829>#11829</denchmark-link>\n ?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "patrikerdes", "commentT": "2017-10-09T17:03:53Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/drpngx>@drpngx</denchmark-link>\n  not sure. Should I install from sources? I used to install TensorFlow from PyPI.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "patrikerdes", "commentT": "2017-10-09T17:12:03Z", "comment_text": "\n \t\tAh, yes, you have to install from source and pull from head. Alternatively, you can use a binary that we distribute. We're releasing release candidates for 1.4, which is the next version. Closer to cutting edge are (assuming you have a GPU): <denchmark-link:https://ci.tensorflow.org/view/Nightly/job/nightly-matrix-linux-gpu/>https://ci.tensorflow.org/view/Nightly/job/nightly-matrix-linux-gpu/</denchmark-link>\n \n There's a corresponding CPU version.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "patrikerdes", "commentT": "2017-10-11T12:52:18Z", "comment_text": "\n \t\tThanks, I've simply done: $ sudo -H pip3 install tf-nightly to install a nightly build from PyPI. Now import tensorflow.contrib takes 1.4 seconds to run. An order of magnitude better! Good job!\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "patrikerdes", "commentT": "2017-10-11T17:11:30Z", "comment_text": "\n \t\tWoohoo!\n <denchmark-link:#>\u2026</denchmark-link>\n \n \n On Wed, Oct 11, 2017, 5:55 AM Konstantin Gorbunov ***@***.***> wrote:\n  Thanks, I've simply done: $ sudo -H pip3 install tf-nightly to install a\n  nightly build from PyPI. Now import tensorflow.contrib takes 1.4 seconds\n  to run. An order of magnitude better! Good job!\n \n  \u2014\n  You are receiving this because you were mentioned.\n  Reply to this email directly, view it on GitHub\n  <#11829 (comment)>,\n  or mute the thread\n  <https://github.com/notifications/unsubscribe-auth/AT_SbTGUVikgzkec_uEPtayawvxsycULks5srLrcgaJpZM4Ol6ZN>\n  .\n \n \n \n \t\t"}}}, "commit": {"commit_id": "d42ca5a1462e75e80536aa9c46c6834bd9455f2b", "commit_author": "Patrik Erdes", "commitT": "2017-09-17 13:38:11-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\python\\util\\tf_decorator.py", "file_new_name": "tensorflow\\python\\util\\tf_decorator.py", "file_complexity": {"file_NLOC": "114", "file_CCN": "12", "file_NToken": "356"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "86,87", "deleted_lines": "86"}}}}}}