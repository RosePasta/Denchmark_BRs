{"BR": {"BR_id": "14985", "BR_author": "balconychy", "BRopenT": "2017-11-30T04:20:21Z", "BRcloseT": "2018-01-05T14:05:19Z", "BR_text": {"BRsummary": "tf.nn.fractional_max_pool output have same batch size when feed with different input batch size", "BRdescription": "\n <denchmark-h:h3>Describe the problem</denchmark-h>\n \n tf.nn.fractional_max_pool output have same batch size when feed with different input batch size.\n Attached is test code I write. 2 different input is feed in with different batch size , outputs get same batch size.\n <denchmark-link:https://github.com/tensorflow/tensorflow/files/1516498/pool_test.py.txt>pool_test.py.txt</denchmark-link>\n \n ###code result\n shape of input_a (3, 32, 32, 3)\n shape of output_a (3, 21, 21, 3)\n shape of input_b (4, 32, 32, 3)\n shape of output_b (3, 21, 21, 3)\n <denchmark-h:h3>System information</denchmark-h>\n \n == cat /etc/issue ===============================================\n Linux c-1080u 4.10.0-40-generic <denchmark-link:https://github.com/tensorflow/tensorflow/issues/44>#44</denchmark-link>\n ~16.04.1-Ubuntu SMP Thu Nov 9 15:37:44 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\n VERSION=\"16.04.3 LTS (Xenial Xerus)\"\n VERSION_ID=\"16.04\"\n VERSION_CODENAME=xenial\n == are we in docker =============================================\n No\n == compiler =====================================================\n c++ (Ubuntu 5.4.0-6ubuntu1~16.04.5) 5.4.0 20160609\n Copyright (C) 2015 Free Software Foundation, Inc.\n This is free software; see the source for copying conditions.  There is NO\n warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n == uname -a =====================================================\n Linux c-1080u 4.10.0-40-generic <denchmark-link:https://github.com/tensorflow/tensorflow/issues/44>#44</denchmark-link>\n ~16.04.1-Ubuntu SMP Thu Nov 9 15:37:44 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\n == check pips ===================================================\n numpy (1.13.3)\n numpydoc (0.7.0)\n == check for virtualenv =========================================\n False\n == tensorflow import ============================================\n Traceback (most recent call last):\n File \"\", line 1, in \n ModuleNotFoundError: No module named 'tensorflow'\n == env ==========================================================\n LD_LIBRARY_PATH /usr/local/cuda-8.0/lib64:\n DYLD_LIBRARY_PATH is unset\n == nvidia-smi ===================================================\n Thu Nov 30 11:55:40 2017\n +-----------------------------------------------------------------------------+\n | NVIDIA-SMI 384.90                 Driver Version: 384.90                    |\n |-------------------------------+----------------------+----------------------+\n | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n |===============================+======================+======================|\n |   0  GeForce GTX 108...  Off  | 00000000:01:00.0  On |                  N/A |\n |  0%   51C    P8    21W / 280W |    860MiB / 11169MiB |      9%      Default |\n +-------------------------------+----------------------+----------------------+\n +-----------------------------------------------------------------------------+\n | Processes:                                                       GPU Memory |\n |  GPU       PID   Type   Process name                             Usage      |\n |=============================================================================|\n |    0      1060      G   /usr/lib/xorg/Xorg                           542MiB |\n |    0      1540      G   compiz                                       315MiB |\n +-----------------------------------------------------------------------------+\n == cuda libs  ===================================================\n /usr/local/cuda-8.0/doc/man/man7/libcudart.7\n /usr/local/cuda-8.0/doc/man/man7/libcudart.so.7\n /usr/local/cuda-8.0/targets/x86_64-linux/lib/libcudart_static.a\n /usr/local/cuda-8.0/targets/x86_64-linux/lib/libcudart.so.8.0.61\n == cat /etc/issue ===============================================\n Linux c-1080u 4.10.0-40-generic <denchmark-link:https://github.com/tensorflow/tensorflow/issues/44>#44</denchmark-link>\n ~16.04.1-Ubuntu SMP Thu Nov 9 15:37:44 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\n VERSION=\"16.04.3 LTS (Xenial Xerus)\"\n VERSION_ID=\"16.04\"\n VERSION_CODENAME=xenial\n == are we in docker =============================================\n No\n == compiler =====================================================\n c++ (Ubuntu 5.4.0-6ubuntu1~16.04.5) 5.4.0 20160609\n Copyright (C) 2015 Free Software Foundation, Inc.\n This is free software; see the source for copying conditions.  There is NO\n warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n == uname -a =====================================================\n Linux c-1080u 4.10.0-40-generic <denchmark-link:https://github.com/tensorflow/tensorflow/issues/44>#44</denchmark-link>\n ~16.04.1-Ubuntu SMP Thu Nov 9 15:37:44 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\n == check pips ===================================================\n numpy (1.13.3)\n protobuf (3.5.0.post1)\n tensorflow-gpu (1.4.0)\n tensorflow-tensorboard (0.4.0rc3)\n == check for virtualenv =========================================\n False\n == tensorflow import ============================================\n tf.VERSION = 1.4.0\n tf.GIT_VERSION = v1.4.0-rc1-11-g130a514\n tf.COMPILER_VERSION = v1.4.0-rc1-11-g130a514\n Sanity check: array([1], dtype=int32)\n == env ==========================================================\n LD_LIBRARY_PATH /usr/local/cuda-8.0/lib64:\n DYLD_LIBRARY_PATH is unset\n == nvidia-smi ===================================================\n Thu Nov 30 11:56:18 2017\n +-----------------------------------------------------------------------------+\n | NVIDIA-SMI 384.90                 Driver Version: 384.90                    |\n |-------------------------------+----------------------+----------------------+\n | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n |===============================+======================+======================|\n |   0  GeForce GTX 108...  Off  | 00000000:01:00.0  On |                  N/A |\n |  0%   51C    P0    80W / 280W |    860MiB / 11169MiB |      0%      Default |\n +-------------------------------+----------------------+----------------------+\n +-----------------------------------------------------------------------------+\n | Processes:                                                       GPU Memory |\n |  GPU       PID   Type   Process name                             Usage      |\n |=============================================================================|\n |    0      1060      G   /usr/lib/xorg/Xorg                           542MiB |\n |    0      1540      G   compiz                                       315MiB |\n +-----------------------------------------------------------------------------+\n == cuda libs  ===================================================\n /usr/local/cuda-8.0/doc/man/man7/libcudart.7\n /usr/local/cuda-8.0/doc/man/man7/libcudart.so.7\n /usr/local/cuda-8.0/targets/x86_64-linux/lib/libcudart_static.a\n /usr/local/cuda-8.0/targets/x86_64-linux/lib/libcudart.so.8.0.61\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "balconychy", "commentT": "2017-11-30T19:51:44Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/balconychy>@balconychy</denchmark-link>\n  Thanks for the clear bug description!\n Looks like <denchmark-link:https://github.com/weiranzhao>@weiranzhao</denchmark-link>\n  wrote the code, and <denchmark-link:https://github.com/josh11b>@josh11b</denchmark-link>\n  might have reviewed it.  Can one of you take a look at this?\n For convenience, here's the repro program that <denchmark-link:https://github.com/balconychy>@balconychy</denchmark-link>\n  created:\n <denchmark-code>import  cifar10\n import tensorflow as tf\n import tensorflow.contrib.slim as slim\n import numpy as np\n \n def check_unequal_size():\n     input_holder = tf.placeholder(tf.float32, [None,32,32,3])\n     out=tf.nn.fractional_max_pool(input_holder,[1,1.5,1.5,1],name=\"low_fea_pool\")\n     sess=tf.Session()\n     (x_train, y_train), (x_test, y_test) = cifar10.load_data()\n     x_train = x_train.astype('float32')\n     input_a=x_train[1:4]\n     input_b=x_train[1:5]\n     output_a,_,_=sess.run(out,\n                {input_holder:input_a\n                 })\n     output_b,_,_= sess.run(out,\n                  {input_holder: input_b\n                  })\n     print(\"shape of input_a\",input_a.shape)\n     print(\"shape of output_a\", output_a.shape)\n     print(\"shape of input_b\", input_b.shape)\n     print(\"shape of output_b\", output_b.shape)\n     pass\n \n check_unequal_size()\n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "balconychy", "commentT": "2017-12-20T01:27:24Z", "comment_text": "\n \t\tIt has been 14 days with no activity and the awaiting tensorflower label was assigned. Please update the label and/or status accordingly.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "balconychy", "commentT": "2017-12-21T20:54:15Z", "comment_text": "\n \t\tThanks for the detailed example. I am working on a fix. Will update the thread when it is checked in to master branch.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "balconychy", "commentT": "2018-01-09T21:37:07Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/balconychy>@balconychy</denchmark-link>\n \n This should have been fixed. I checked this with nightly build at tf-nightly 1.6.0.dev20180109.\n \t\t"}}}, "commit": {"commit_id": "5f0d3395d4c61000cf0cfb3dc681177147be938d", "commit_author": "A. Unique TensorFlower", "commitT": "2018-01-03 15:15:02-08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.4090909090909091", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\core\\kernels\\BUILD", "file_new_name": "tensorflow\\core\\kernels\\BUILD", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "3373", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tensorflow\\core\\kernels\\fractional_avg_pool_op.cc", "file_new_name": "tensorflow\\core\\kernels\\fractional_avg_pool_op.cc", "file_complexity": {"file_NLOC": "240", "file_CCN": "31", "file_NToken": "1996"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "51,52,53,54,55,56,57,58,59,60,61,62,63,64", "deleted_lines": "50,51,52", "method_info": {"method_name": "tensorflow::FractionalAvgPoolOp::FractionalAvgPoolOp", "method_params": "context", "method_startline": "38", "method_endline": "65", "method_complexity": {"method_NLOC": "27", "method_CCN": "6", "method_NToken": "215", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "79,80,82,86,87,88,94,95,96,97,98,99,103,104,105,106,107,119,120,122,123,148,149,150,162,171", "deleted_lines": "68,72,73,74,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,103,104,105,106,107,119,120,121,123,124,149,150,151,163,172", "method_info": {"method_name": "tensorflow::FractionalAvgPoolOp::Compute", "method_params": "context", "method_startline": "67", "method_endline": "181", "method_complexity": {"method_NLOC": "87", "method_CCN": "12", "method_NToken": "868", "method_nesting_level": "2"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tensorflow\\core\\kernels\\fractional_max_pool_op.cc", "file_new_name": "tensorflow\\core\\kernels\\fractional_max_pool_op.cc", "file_complexity": {"file_NLOC": "262", "file_CCN": "36", "file_NToken": "2277"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "82,83,85,91,92,93,99,100,101,102,103,104,108,109,110,111,112,125,126,128,129,151,152,153,165,174", "deleted_lines": "71,77,78,79,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,108,109,110,111,112,125,126,127,129,130,152,153,154,166,175", "method_info": {"method_name": "tensorflow::FractionalMaxPoolOp::Compute", "method_params": "context", "method_startline": "70", "method_endline": "182", "method_complexity": {"method_NLOC": "84", "method_CCN": "12", "method_NToken": "830", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "54,55,56,57,58,59,60,61,62,63,64,65,66,67", "deleted_lines": "53,54,55", "method_info": {"method_name": "tensorflow::FractionalMaxPoolOp::FractionalMaxPoolOp", "method_params": "context", "method_startline": "38", "method_endline": "68", "method_complexity": {"method_NLOC": "27", "method_CCN": "6", "method_NToken": "216", "method_nesting_level": "2"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "238,239,241,244", "deleted_lines": "246,247,248,250,252,254", "method_info": {"method_name": "tensorflow::FractionalMaxPoolGradOp::Compute", "method_params": "context", "method_startline": "215", "method_endline": "357", "method_complexity": {"method_NLOC": "106", "method_CCN": "17", "method_NToken": "1057", "method_nesting_level": "2"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\python\\kernel_tests\\BUILD", "file_new_name": "tensorflow\\python\\kernel_tests\\BUILD", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "372,387", "deleted_lines": null}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\python\\kernel_tests\\fractional_avg_pool_op_test.py", "file_new_name": "tensorflow\\python\\kernel_tests\\fractional_avg_pool_op_test.py", "file_complexity": {"file_NLOC": "407", "file_CCN": "50", "file_NToken": "2874"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342", "deleted_lines": null, "method_info": {"method_name": "testDifferentInputTensorShape", "method_params": "self", "method_startline": "315", "method_endline": "342", "method_complexity": {"method_NLOC": "25", "method_CCN": "1", "method_NToken": "222", "method_nesting_level": "1"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\python\\kernel_tests\\fractional_max_pool_op_test.py", "file_new_name": "tensorflow\\python\\kernel_tests\\fractional_max_pool_op_test.py", "file_complexity": {"file_NLOC": "451", "file_CCN": "49", "file_NToken": "3168"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313", "deleted_lines": null, "method_info": {"method_name": "testDifferentInputTensorShape", "method_params": "self", "method_startline": "286", "method_endline": "313", "method_complexity": {"method_NLOC": "25", "method_CCN": "1", "method_NToken": "222", "method_nesting_level": "1"}}}}}}}}