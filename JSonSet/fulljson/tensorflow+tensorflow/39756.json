{"BR": {"BR_id": "39756", "BR_author": "jeremyholleman", "BRopenT": "2020-05-21T13:49:56Z", "BRcloseT": "2020-05-29T00:41:37Z", "BR_text": {"BRsummary": "problem running visualize.py at import flatbuffersn", "BRdescription": "\n System information\n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow): No\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04):  Mac OS 10.15.3\n Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: n/a\n TensorFlow installed from (source or binary): from source\n TensorFlow version (use command below): v1.12.1-32248-g8670c85844 2.2.0\n Python version: 3.7.4\n Bazel version (if compiling from source): 3.0.0\n GCC/Compiler version (if compiling from source): Apple clang version 11.0.3 (clang-1103.0.32.59) (from gcc --version)\n CUDA/cuDNN version: n/a\n GPU model and memory: n/a\n \n Describe the current behavior\n visualize.py script fails with this error:\n ImportError: cannot import name 'flatbuffersn' from 'flatbuffers.python' (/private/var/tmp/_bazel_jeremy/95159cfd4782ce915016562181875cd6/execroot/org_tensorflow/bazel-out/darwin-opt/bin/tensorflow/lite/tools/visualize.runfiles/flatbuffers/python/__init__.py)\n I am running it with the command\n \n from the top of my tensorflow source directory.  The build phase seems to work fine, then the import error seems to happen on running visualize.py.  Full output in attached file.\n <denchmark-link:https://github.com/tensorflow/tensorflow/files/4662612/vis_dump.txt>vis_dump.txt</denchmark-link>\n \n The target tflite file can be downloaded <denchmark-link:http://download.tensorflow.org/models/mobilenet_v1_2018_08_02/mobilenet_v1_0.25_128_quant.tgz>here</denchmark-link>\n , but I don't think the tflite file ever gets loaded, so I doubt that the specific file is relevant.\n The directory where it is trying to import from is listed here.  There is no flatbuffersn file or directory and the init.py file is empty.\n <denchmark-code>ls -l /private/var/tmp/_bazel_jeremy/95159cfd4782ce915016562181875cd6/execroot/org_tensorflow/bazel-out/darwin-opt/bin/tensorflow/lite/tools/visualize.runfiles/flatbuffers/python/\n total 0\n -r-xr-xr-x   1 jeremy  wheel    0 May 20 16:15 __init__.py*\n drwxr-xr-x   3 jeremy  wheel   96 May 21 09:39 __pycache__/\n drwxr-xr-x  10 jeremy  wheel  320 May 20 16:15 flatbuffers/\n </denchmark-code>\n \n Describe the expected behavior\n I would expect it to dump an html file to ~/tmp/mobnet.html containing a visualization of the mobilenet model in the target tflite file.\n Standalone code to reproduce the issue\n The command line above.\n Other info / logs Include any logs or source code that would be helpful to\n diagnose the problem. If including tracebacks, please include the full\n traceback. Large logs and files should be attached.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jeremyholleman", "commentT": "2020-05-28T13:34:19Z", "comment_text": "\n \t\tYeah, I can actually reproduce this, and I think the import name should be flatbuffers but the following \\n is somehow not correctly escaped and ended up being interpreted as character n.\n This must be a bug somewhere in the flatbuffer build rule, or the flatbuffer tool. Let me dig a bit more about it.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jeremyholleman", "commentT": "2020-05-28T14:53:12Z", "comment_text": "\n \t\tFound the issue, which was caused by the different  tool behavior between linux and mac, as described here: <denchmark-link:https://stackoverflow.com/a/22203933/922135>https://stackoverflow.com/a/22203933/922135</denchmark-link>\n \n I'll send a fix soon, but in the meantime you should be able to try the fix locally.\n In the tensorflow/third_party/flatbuffers/build_defs.bzl file at line365, change:\n <denchmark-code>\"import flatbuffers\\\\n/' > %s\"\n </denchmark-code>\n \n to\n <denchmark-code>\"import flatbuffers\\\\'$'\\\\n/' > %s\"\n </denchmark-code>\n \n and try running the visualize tool again.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "jeremyholleman", "commentT": "2020-05-29T00:41:39Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/39756>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/39756>No</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "jeremyholleman", "commentT": "2020-05-29T10:08:31Z", "comment_text": "\n \t\tThat fixed it for me.  Thanks!\n \t\t"}}}, "commit": {"commit_id": "f9fb66cdb7419d2eadf7faea995f1aacb032104b", "commit_author": "YoungSeok Yoon", "commitT": "2020-05-28 17:34:10-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "third_party\\flatbuffers\\build_defs.bzl", "file_new_name": "third_party\\flatbuffers\\build_defs.bzl", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "365", "deleted_lines": "365"}}}}}}