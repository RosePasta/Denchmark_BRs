{"BR": {"BR_id": "27847", "BR_author": "ppwwyyxx", "BRopenT": "2019-04-15T03:56:42Z", "BRcloseT": "2019-04-29T17:33:39Z", "BR_text": {"BRsummary": "BUG: tfdbg session cannot be used with SessionRunHooks", "BRdescription": "\n Please make sure that this is a bug. As per our GitHub Policy, we only address code/doc bugs, performance issues, feature requests and build/installation issues on GitHub. tag:bug_template\n System information\n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow):yes\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04):ArchLinux\n Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\n TensorFlow installed from (source or binary):binary\n TensorFlow version (use command below):b'v1.13.0-rc2-5-g6612da8' 1.13.1\n Python version:3.7\n Bazel version (if compiling from source):n/a\n GCC/Compiler version (if compiling from source):n/a\n CUDA/cuDNN version:n/a\n GPU model and memory:n/a\n \n The following code:\n #-*- coding: utf-8 -*-\n #File:\n \n \n import numpy as np\n import tensorflow as tf\n from tensorflow.python import debug as tf_debug\n \n a = tf.placeholder(tf.float32, [10])\n b = a + 1\n c = b * 2\n \n class Hook(tf.train.SessionRunHook):\n     def before_run(self, _):\n         return tf.train.SessionRunArgs(fetches=c)\n \n class Hook2(tf.train.SessionRunHook):\n     def before_run(self, _):\n         return tf.train.SessionRunArgs(fetches=b)\n \n sess = tf.Session()\n sess = tf_debug.LocalCLIDebugWrapperSession(sess)\n \n class SessionCreator():\n     def create_session(self):\n         return sess\n final_sess = tf.train.MonitoredSession(session_creator=SessionCreator(), hooks=[Hook(), Hook2()])\n \n final_sess.run(b, feed_dict={a:np.arange(10)})\n Throws:\n <denchmark-code>Traceback (most recent call last):\n   File \"tfdbg.py\", line 30, in <module>\n     final_sess.run(b, feed_dict={a:np.arange(10)})\n   File \"/home/wyx/.local/lib/python3.7/site-packages/tensorflow/python/training/monitored_session.py\", line 676, in run                                                                            \n     run_metadata=run_metadata)\n   File \"/home/wyx/.local/lib/python3.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1171, in run                                                                           \n     run_metadata=run_metadata)\n   File \"/home/wyx/.local/lib/python3.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1270, in run                                                                           \n     raise six.reraise(*original_exc_info)\n   File \"/usr/lib/python3.7/site-packages/six.py\", line 693, in reraise\n     raise value\n   File \"/home/wyx/.local/lib/python3.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1255, in run                                                                           \n     return self._sess.run(*args, **kwargs)\n   File \"/home/wyx/.local/lib/python3.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1327, in run                                                                           \n     run_metadata=run_metadata)\n   File \"/home/wyx/.local/lib/python3.7/site-packages/tensorflow/python/training/monitored_session.py\", line 1091, in run                                                                           \n     return self._sess.run(*args, **kwargs)\n   File \"/home/wyx/.local/lib/python3.7/site-packages/tensorflow/python/debug/wrappers/framework.py\", line 463, in run                                                                              \n     empty_fetches = not nest.flatten(fetches)\n   File \"/home/wyx/.local/lib/python3.7/site-packages/tensorflow/python/pywrap_tensorflow_internal.py\", line 2156, in Flatten                                                                       \n     return _pywrap_tensorflow_internal.Flatten(nested)\n TypeError: '<' not supported between instances of 'Hook' and 'str'\n </denchmark-code>\n \n I believe this issue was introduced in <denchmark-link:https://github.com/tensorflow/tensorflow/commit/1f26c65254268730b7409f517d1ed1b554d01e50>1f26c65</denchmark-link>\n  a year ago.  cannot handle fetches created by hooks.\n The fix will be to obtain  in a smarter way.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ppwwyyxx", "commentT": "2019-04-29T17:33:39Z", "comment_text": "\n \t\tFixed by <denchmark-link:https://github.com/tensorflow/tensorflow/commit/e2d269edb9217411fc4119338df949e1a741432b>e2d269e</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ppwwyyxx", "commentT": "2019-04-29T17:33:40Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=27847>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=27847>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "e2d269edb9217411fc4119338df949e1a741432b", "commit_author": "Shanqing Cai", "commitT": "2019-04-29 10:26:45-07:00", "commit_complexity": {"commit_NLOC": "0.42857142857142855", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\python\\debug\\wrappers\\framework.py", "file_new_name": "tensorflow\\python\\debug\\wrappers\\framework.py", "file_complexity": {"file_NLOC": "515", "file_CCN": "58", "file_NToken": "2252"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "444,445,446,447,448,449,450,451,452,453", "deleted_lines": null, "method_info": {"method_name": "is_empty", "method_params": "x", "method_startline": "444", "method_endline": "453", "method_complexity": {"method_NLOC": "9", "method_CCN": "5", "method_NToken": "55", "method_nesting_level": "2"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tensorflow\\python\\debug\\wrappers\\local_cli_wrapper_test.py", "file_new_name": "tensorflow\\python\\debug\\wrappers\\local_cli_wrapper_test.py", "file_complexity": {"file_NLOC": "613", "file_CCN": "75", "file_NToken": "5943"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "833,834,835,836,837,838,839,840,841,842,843,844,845,846,847,848,849,850,851,852,853,854,855,856,857,858,859,860,861,862,863,864", "deleted_lines": null, "method_info": {"method_name": "testSessionRunHook", "method_params": "self", "method_startline": "833", "method_endline": "864", "method_complexity": {"method_NLOC": "20", "method_CCN": "2", "method_NToken": "173", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "853,854", "deleted_lines": null, "method_info": {"method_name": "testSessionRunHook.create_session", "method_params": "self", "method_startline": "853", "method_endline": "854", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "7", "method_nesting_level": "3"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "840,841", "deleted_lines": null, "method_info": {"method_name": "testSessionRunHook.before_run", "method_params": "self,_", "method_startline": "840", "method_endline": "841", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "16", "method_nesting_level": "3"}}}}}}}}