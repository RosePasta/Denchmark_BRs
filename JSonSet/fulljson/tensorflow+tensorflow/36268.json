{"BR": {"BR_id": "36268", "BR_author": "terhorst", "BRopenT": "2020-01-28T02:49:22Z", "BRcloseT": "2020-09-30T20:02:14Z", "BR_text": {"BRsummary": "tf.debugging.assert_shapes() does not work for SparseTensor", "BRdescription": "\n System information\n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Mac OS X 10.15\n TensorFlow installed from (source or binary): binary\n TensorFlow version (use command below): 2.1\n Python version: 3.8\n \n Describe the current behavior\n tf.debugging.assert_shapes cannot be used with sparse tensors.\n Describe the expected behavior\n tf.debugging.assert_shapes should allow you to mix and match dense and sparse tensors when checking for dimensional consistency.\n Code to reproduce the issue\n <denchmark-code>import tensorflow as tf\n A = tf.range(3)\n tf.debugging.assert_shapes(((A, [3]),))  # works\n # raises \"ValueError: Attempt to convert a value (...) with an unsupported type (<class 'tensorflow.python.framework.sparse_tensor.SparseTensor'>) to a Tensor.\n tf.debugging.assert_shapes(((tf.sparse.from_dense(A), [3]),))\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "terhorst", "commentT": "2020-01-28T08:20:23Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/terhorst>@terhorst</denchmark-link>\n   I believe the input type of sparse_tensor is not the typical use-case for tf.debugging.assert_shapes. Neverthless it shouldn't raise the error.\n I have made a PR to fix it: <denchmark-link:https://github.com/tensorflow/tensorflow/pull/36277>#36277</denchmark-link>\n \n Please have a check if needed.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "terhorst", "commentT": "2020-01-28T14:47:04Z", "comment_text": "\n \t\tThis fixes it, but converting the sparse tensor to dense solely for the purpose of checking its shape seems quite wasteful to me.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "terhorst", "commentT": "2020-01-29T01:25:39Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/terhorst>@terhorst</denchmark-link>\n , I think this function is used for debugging only, right? If so, the efficiency shouldn't be the major problem. And I think this fix changes the least number of code which has lower possibility to induce other issues.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "terhorst", "commentT": "2020-01-29T01:56:19Z", "comment_text": "\n \t\tIn my case, the whole reason for using a SparseTensor in the first place is\n that it cannot fit into memory as dense. With this patch, assert_shapes()\n will produce an OOM or some other form of crash, which seems like a\n regression since that is strictly more annoying and harder to debug than\n mismatched dimensions. But, it's your call; my only point in submitting\n this issue was to bring it to your attention, and I don't have the\n bandwidth to learn how to patch it myself.\n <denchmark-link:#>\u2026</denchmark-link>\n \n \n On Tue, Jan 28, 2020 at 8:25 PM Leslie-Fang ***@***.***> wrote:\n  Hi @terhorst <https://github.com/terhorst>, I think this function is used\n  for debugging only, right? If so, the efficiency shouldn't be the major\n  problem. And I think this fix changes the least number of code which has\n  lower possibility to induce other issues.\n \n  \u2014\n  You are receiving this because you were mentioned.\n  Reply to this email directly, view it on GitHub\n  <#36268?email_source=notifications&email_token=AAAEOHAT2RLP3LNW6REXZF3RADLJRA5CNFSM4KMLQMXKYY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOEKFT6RA#issuecomment-579551044>,\n  or unsubscribe\n  <https://github.com/notifications/unsubscribe-auth/AAAEOHEWTU3R6XWWVPRF2E3RADLJRANCNFSM4KMLQMXA>\n  .\n \n \n -- \n Jonathan\n terhorst@gmail.com\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "terhorst", "commentT": "2020-01-29T09:07:09Z", "comment_text": "\n \t\tI have tried on colab with TF version 2.1.0-rc2, 2.2.0-dev20200128 and was able to reproduce the issue.Please, find the gist <denchmark-link:https://colab.sandbox.google.com/gist/ravikyram/76389a872dc7528d8ba29760a345c37b/untitled596.ipynb>here</denchmark-link>\n .Thanks!\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "terhorst", "commentT": "2020-07-21T11:54:51Z", "comment_text": "\n \t\tI am able to reproduce the isue with TF 2.3-rc1, nightly version().PLease, find the gist <denchmark-link:https://colab.research.google.com/gist/ravikyram/4315d3365fcc9c7170084261951e80eb/untitled162.ipynb>here</denchmark-link>\n .Thanks!\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "terhorst", "commentT": "2020-09-30T20:02:16Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/36268>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/36268>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "11fc1489d01822a2e728103c3af998976b4e7cd1", "commit_author": "Shanqing Cai", "commitT": "2020-09-30 12:53:54-07:00", "commit_complexity": {"commit_NLOC": "0.9929078014184397", "commit_CCN": "0.9929078014184397", "commit_Nprams": "0.9929078014184397"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "RELEASE.md", "file_new_name": "RELEASE.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "292,293,294,295,1199,1209,1365,1370,1378,1384,2630,3109", "deleted_lines": "1195,1205,1361,1366,1374,1380,2626,3105"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 13, "file_old_name": "tensorflow\\python\\kernel_tests\\check_ops_test.py", "file_new_name": "tensorflow\\python\\kernel_tests\\check_ops_test.py", "file_complexity": {"file_NLOC": "1868", "file_CCN": "215", "file_NToken": "16170"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_mixed_dense_and_sparse_success", "method_params": "self", "method_startline": "2047", "method_endline": "2057", "method_complexity": {"method_NLOC": "11", "method_CCN": "1", "method_NToken": "128", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_multiple_assertions_fail", "method_params": "self", "method_startline": "2030", "method_endline": "2044", "method_complexity": {"method_NLOC": "15", "method_CCN": "1", "method_NToken": "170", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "1966,1967,1968,1969,1970,1971,1972,1973,1974", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_symbolic_match_success", "method_params": "self", "method_startline": "1966", "method_endline": "1974", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "115", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_mixed_dense_and_sparse_fail", "method_params": "self", "method_startline": "2060", "method_endline": "2071", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "139", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "1955,1956,1957,1958,1959,1960,1961,1962,1963", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_partially_specified_target_success", "method_params": "self", "method_startline": "1955", "method_endline": "1963", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "107", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "1977,1978,1979,1980,1981,1982,1983,1984,1985,1986", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_partially_specified_target_fail", "method_params": "self", "method_startline": "1977", "method_endline": "1986", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "118", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "1943,1944,1945,1946,1947,1948,1949,1950,1951,1952", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_fully_specified_target_fail", "method_params": "self", "method_startline": "1943", "method_endline": "1952", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "114", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "1909,1910,1911,1912,1913,1914,1915,1916,1917", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_scalar_target_success", "method_params": "self", "method_startline": "1909", "method_endline": "1917", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "89", "method_nesting_level": "1"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_wrong_rank_fail", "method_params": "self", "method_startline": "1989", "method_endline": "1999", "method_complexity": {"method_NLOC": "11", "method_CCN": "1", "method_NToken": "120", "method_nesting_level": "1"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_multiple_assertions_success", "method_params": "self", "method_startline": "2014", "method_endline": "2027", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "159", "method_nesting_level": "1"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "2002,2003,2004,2005,2006,2007,2008,2009,2010,2011", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_wrong_symbolic_match_fail", "method_params": "self", "method_startline": "2002", "method_endline": "2011", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "118", "method_nesting_level": "1"}}}, "hunk_11": {"Ismethod": 1, "added_lines": "1932,1933,1934,1935,1936,1937,1938,1939,1940", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_fully_specified_target_success", "method_params": "self", "method_startline": "1932", "method_endline": "1940", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "103", "method_nesting_level": "1"}}}, "hunk_12": {"Ismethod": 1, "added_lines": "1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929", "deleted_lines": null, "method_info": {"method_name": "test_assert_shapes_sparse_tensor_nonscalar_target_fail", "method_params": "self", "method_startline": "1919", "method_endline": "1929", "method_complexity": {"method_NLOC": "11", "method_CCN": "1", "method_NToken": "103", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "tensorflow\\python\\ops\\check_ops.py", "file_new_name": "tensorflow\\python\\ops\\check_ops.py", "file_complexity": {"file_NLOC": "939", "file_CCN": "169", "file_NToken": "6646"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1799", "deleted_lines": null, "method_info": {"method_name": "assert_shapes.tensor_name", "method_params": "x", "method_startline": "1798", "method_endline": "1801", "method_complexity": {"method_NLOC": "4", "method_CCN": "3", "method_NToken": "26", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "1587", "deleted_lines": "1585", "method_info": {"method_name": "_dimension_sizes", "method_params": "x", "method_startline": "1569", "method_endline": "1597", "method_complexity": {"method_NLOC": "16", "method_CCN": "7", "method_NToken": "125", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "1792,1793,1794,1799", "deleted_lines": "1790,1791,1792,1797", "method_info": {"method_name": "assert_shapes", "method_params": "shapes,data,summarize,message,name", "method_startline": "1696", "method_endline": "1947", "method_complexity": {"method_NLOC": "124", "method_CCN": "28", "method_NToken": "684", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "1154,1155,1162", "deleted_lines": "1154,1161", "method_info": {"method_name": "assert_rank", "method_params": "x,rank,data,summarize,message,name", "method_startline": "1127", "method_endline": "1186", "method_complexity": {"method_NLOC": "29", "method_CCN": "9", "method_NToken": "223", "method_nesting_level": "0"}}}}}}}}