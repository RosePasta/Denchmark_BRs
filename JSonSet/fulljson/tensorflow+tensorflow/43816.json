{"BR": {"BR_id": "43816", "BR_author": "nicolas-harraudeau-sonarsource", "BRopenT": "2020-10-06T12:19:08Z", "BRcloseT": "2020-11-30T18:43:38Z", "BR_text": {"BRsummary": "TypeError in \"Bidirectional.compute_output_shape\"", "BRdescription": "\n Hello,\n While analyzing Tensorflow on SonarCloud I saw what looks like an error in <denchmark-link:https://github.com/tensorflow/tensorflow/blob/d6426459bca2971b611ca9773858e55f6cc1a9af/tensorflow/python/keras/layers/wrappers.py#L522>tensorflow/python/keras/layers/wrappers.py</denchmark-link>\n :\n <denchmark-link:https://user-images.githubusercontent.com/40498978/95199955-eb31ac00-07dd-11eb-8bee-2a0c006ed40f.png></denchmark-link>\n \n You can see the issue in SonarCloud <denchmark-link:https://sonarcloud.io/project/issues?id=nicolas-harraudeau-sonarsource_tensorflow&issues=AXT60Og4BMD9OHnI8p_E&open=AXT60Og4BMD9OHnI8p_E>here</denchmark-link>\n .\n After reviewing the code myself I can indeed see that state_shape will have the type tuple, and using the operator + on a list and a tuple will fail with the exception:\n \n TypeError: can only concatenate list (not \"tuple\") to list\n \n Here is the flow which leads to this issue:\n <denchmark-code>output_shape = tuple(output_shape.as_list())  # output_shape is a tuple\n ...\n if self.return_state:\n       state_shape = output_shape[1:]  # state_shape is a tuple\n ...\n return [output_shape] + state_shape + copy.copy(state_shape)  # the expression \"[output_shape] + state_shape\" will fail\n </denchmark-code>\n \n In case you have any question, suggestion or if you see a False Positive on SonarCloud you can reach out on <denchmark-link:https://community.sonarsource.com/>SonarSource community forum</denchmark-link>\n .\n A few notes in case you want to use SonarCloud:\n \n I am currently testing the python analyzer so the project on SonarCloud will only show python issues, but SonarCloud can also analyze C/C++ code and other languages.\n SonarCloud can also import pylint issues in case you want to use a rule SonarCloud does not already provide. Note however that pylint rules and SonarCloud rules are implemented differently. You might see new issues with SonarCloud, or less issues in some cases (we try to avoid False Positives as much as possible).\n It is free for open-source projects.\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "nicolas-harraudeau-sonarsource", "commentT": "2020-10-07T11:00:15Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/nicholasbutlin>@nicholasbutlin</denchmark-link>\n \n Please share your tf version as you have not filled in the issue template.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "nicolas-harraudeau-sonarsource", "commentT": "2020-10-07T11:20:51Z", "comment_text": "\n \t\t\n @nicholasbutlin\n Please share your tf version as you have not filled in the issue template.\n \n Hi - Not me this time! Think this is for someone else...\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "nicolas-harraudeau-sonarsource", "commentT": "2020-10-07T11:47:44Z", "comment_text": "\n \t\t/cc <denchmark-link:https://github.com/mihaimaruseac>@mihaimaruseac</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "nicolas-harraudeau-sonarsource", "commentT": "2020-10-07T12:48:35Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/Saduf2019>@Saduf2019</denchmark-link>\n . The bug I am describing here is directly in the master branch of tensorflow. I didn't check if it was released in a specific version of tensorflow.\n I read the template but it doesn't seem to apply in this case. I am not describing a runtime issue but rather a bug visible in tensorflow's code. I apologize if there is a specific template for this case and I missed it.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "nicolas-harraudeau-sonarsource", "commentT": "2020-10-07T16:51:55Z", "comment_text": "\n \t\tI think this might be a leftover from Py2. Let's try to convert both sides of + to list?\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "nicolas-harraudeau-sonarsource", "commentT": "2020-10-07T18:00:01Z", "comment_text": "\n \t\tA list of tuples?\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "nicolas-harraudeau-sonarsource", "commentT": "2020-10-20T05:09:52Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/nicolas-harraudeau-sonarsource>@nicolas-harraudeau-sonarsource</denchmark-link>\n \n Is this still an issue.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "nicolas-harraudeau-sonarsource", "commentT": "2020-10-20T06:47:09Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/Saduf2019>@Saduf2019</denchmark-link>\n ,\n As far as I can see the code remained the same, so <denchmark-link:https://github.com/tensorflow/tensorflow/blob/574463afb8581ca65988aee0ce1c956b4614e061/tensorflow/python/keras/layers/wrappers.py#L525>the bug is still there</denchmark-link>\n . The same pattern I described earlier is visible:\n <denchmark-code>output_shape = tuple(output_shape.as_list())  # output_shape is a tuple\n ...\n if self.return_state:\n       state_shape = output_shape[1:]  # state_shape is a tuple\n ...\n return [output_shape] + state_shape + copy.copy(state_shape)  # the expression \"[output_shape] + state_shape\" will fail\n </denchmark-code>\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "nicolas-harraudeau-sonarsource", "commentT": "2020-11-30T18:43:40Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/43816>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/43816>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "5a8b0d3e80cef5ffba362d747a0f449c90862b5d", "commit_author": "Scott Zhu", "commitT": "2020-11-30 10:42:09-08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\python\\keras\\layers\\wrappers.py", "file_new_name": "tensorflow\\python\\keras\\layers\\wrappers.py", "file_complexity": {"file_NLOC": "603", "file_CCN": "96", "file_NToken": "3839"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "559,560,561,562,565,567", "deleted_lines": "558,559,560,562,563,566,568", "method_info": {"method_name": "compute_output_shape", "method_params": "self,input_shape", "method_startline": "556", "method_endline": "575", "method_complexity": {"method_NLOC": "18", "method_CCN": "6", "method_NToken": "154", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\python\\keras\\layers\\wrappers_test.py", "file_new_name": "tensorflow\\python\\keras\\layers\\wrappers_test.py", "file_complexity": {"file_NLOC": "1077", "file_CCN": "111", "file_NToken": "11002"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "969,970,971,972,973,974,975,976,977,978,979,980,981,982,983,984,985,986,987,988,989,990,991", "deleted_lines": null, "method_info": {"method_name": "test_Bidirectional_output_shape", "method_params": "self,rnn", "method_startline": "969", "method_endline": "991", "method_complexity": {"method_NLOC": "18", "method_CCN": "4", "method_NToken": "205", "method_nesting_level": "1"}}}}}}}}