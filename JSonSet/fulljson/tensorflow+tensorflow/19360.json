{"BR": {"BR_id": "19360", "BR_author": "girving", "BRopenT": "2018-05-17T20:28:10Z", "BRcloseT": "2018-08-09T23:49:48Z", "BR_text": {"BRsummary": "tf.split's -1 support doesn't handle zero dimensions", "BRdescription": "\n <denchmark-h:h3>System information</denchmark-h>\n \n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes.\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Colab\n TensorFlow installed from (source or binary): Colab\n TensorFlow version (use command below): ('unknown', '1.7.0') and 1.8.0\n Python version: 3.6.3\n Bazel version (if compiling from source): N/A\n GCC/Compiler version (if compiling from source): N/A\n CUDA/cuDNN version: N/A\n GPU model and memory: N/A\n Exact command to reproduce: tf.split(tf.zeros([0]), [0, -1], axis=-1)\n \n <denchmark-h:h3>Describe the problem</denchmark-h>\n \n The variable size version of tf.split (SplitV in C++) allows one of the sizes to be -1.  The corresponding output will expand as necessary so that the total output size matches the input.\n Unfortunately, the -1 support currently assumes the -1 dimension corresponds to positive size.  It should handle zero as well.  E.g., this should work, but it doesn't:\n <denchmark-code>>>> tf.split(tf.zeros([0]), [0, -1], axis=-1)\n Traceback (most recent call last):\n   File \"/Users/irving/anaconda/envs/openai/lib/python3.6/site-packages/tensorflow/python/framework/ops.py\", line 1592, in _create_c_op\n     c_op = c_api.TF_FinishOperation(op_desc)\n tensorflow.python.framework.errors_impl.InvalidArgumentError: Sum of output sizes must match the size of the original Tensor along the split dimension or the sum of the positive sizes must be less if it contains a -1 for 'split_3' (op: 'SplitV') with input shapes: [0], [2], [] and with computed input tensors: input[1] = <0 -1>, input[2] = <-1>.\n </denchmark-code>\n \n By comparison, the positive case works fine:\n <denchmark-code>>>> tf.split(tf.zeros([1]), [0, -1], axis=-1)\n [<tf.Tensor 'split_4:0' shape=(0,) dtype=float32>, <tf.Tensor 'split_4:1' shape=(?,) dtype=float32>]\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "girving", "commentT": "2018-05-17T20:30:27Z", "comment_text": "\n \t\tHere's a colab exhibiting the problem, though since the repro is a single line it's not really necessary:\n <denchmark-link:https://drive.google.com/file/d/1AyZLBPYkiB3HgUZYL9cWZx3IFu2OzcTI/view?usp=sharing>https://drive.google.com/file/d/1AyZLBPYkiB3HgUZYL9cWZx3IFu2OzcTI/view?usp=sharing</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "girving", "commentT": "2018-05-17T20:35:57Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/benoitsteiner>@benoitsteiner</denchmark-link>\n : Did you introduce this restriction?  Can't tell if <denchmark-link:https://github.com/tensorflow/tensorflow/commit/53f68459f18fd9c707183511e1e58d03e2f367db>53f6845</denchmark-link>\n  is yours.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "girving", "commentT": "2018-05-18T17:23:32Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ekelsen>@ekelsen</denchmark-link>\n  might have more insight into that particular commit?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "girving", "commentT": "2018-06-02T13:59:27Z", "comment_text": "\n \t\tNagging Assignee <denchmark-link:https://github.com/karmel>@karmel</denchmark-link>\n : It has been 14 days with no activity and this issue has an assignee. Please update the label and/or status accordingly.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "girving", "commentT": "2018-06-02T20:04:43Z", "comment_text": "\n \t\tBump for <denchmark-link:https://github.com/ekelsen>@ekelsen</denchmark-link>\n  - do you have any insight here, or is someone else a better bet?\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "girving", "commentT": "2018-06-17T18:41:09Z", "comment_text": "\n \t\tNagging Assignee <denchmark-link:https://github.com/karmel>@karmel</denchmark-link>\n : It has been 14 days with no activity and this issue has an assignee. Please update the label and/or status accordingly.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "girving", "commentT": "2018-07-03T01:02:01Z", "comment_text": "\n \t\tNagging Assignee <denchmark-link:https://github.com/karmel>@karmel</denchmark-link>\n : It has been 29 days with no activity and this issue has an assignee. Please update the label and/or status accordingly.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "girving", "commentT": "2018-07-17T19:26:50Z", "comment_text": "\n \t\tNagging Assignee <denchmark-link:https://github.com/karmel>@karmel</denchmark-link>\n : It has been 44 days with no activity and this issue has an assignee. Please update the label and/or status accordingly.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "girving", "commentT": "2018-07-17T20:36:13Z", "comment_text": "\n \t\tBumping <denchmark-link:https://github.com/ekelsen>@ekelsen</denchmark-link>\n  again, who may be back?\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "girving", "commentT": "2018-08-08T18:57:21Z", "comment_text": "\n \t\tNagging Assignee <denchmark-link:https://github.com/girving>@girving</denchmark-link>\n : It has been 14 days with no activity and this issue has an assignee. Please update the label and/or status accordingly.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "girving", "commentT": "2018-08-08T20:21:01Z", "comment_text": "\n \t\tI sent a PR fixing this two weeks ago, so nagged me is unnecessary.  Hopefully the PR will be reviewed at some point.\n \t\t"}}}, "commit": {"commit_id": "88ba64b668044c5cb776fa27c8429e2c0e64e665", "commit_author": "Geoffrey Irving", "commitT": "2018-08-09 09:44:59-07:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\core\\ops\\array_ops.cc", "file_new_name": "tensorflow\\core\\ops\\array_ops.cc", "file_complexity": {"file_NLOC": "2511", "file_CCN": "101", "file_NToken": "18723"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "634,636,637,638,639,640,641,642,643,644,645,646,652,653,654,655,657,660,661,662,663,664,665,666", "deleted_lines": "634,641,643,645,646,647,648,649,650,652,653,654,655,656,657,659,660,661,662,663,664,665"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tensorflow\\python\\kernel_tests\\split_op_test.py", "file_new_name": "tensorflow\\python\\kernel_tests\\split_op_test.py", "file_complexity": {"file_NLOC": "291", "file_CCN": "55", "file_NToken": "3367"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195", "deleted_lines": null, "method_info": {"method_name": "testDegenerateVariable", "method_params": "self", "method_startline": "178", "method_endline": "195", "method_complexity": {"method_NLOC": "15", "method_CCN": "1", "method_NToken": "264", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "359,360,361,362,363,364,365,366,367", "deleted_lines": null, "method_info": {"method_name": "testVariableShapeFunction", "method_params": "self", "method_startline": "359", "method_endline": "367", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "85", "method_nesting_level": "1"}}}}}}}}