{"BR": {"BR_id": "36067", "BR_author": "byronyi", "BRopenT": "2020-01-20T14:38:28Z", "BRcloseT": "2020-01-20T18:48:51Z", "BR_text": {"BRsummary": "saved_model_cli breaks nightly packages", "BRdescription": "\n Our in-house nightly builds were broken since 2020-01-16 when auditwheel tries to repair my nightly packages. The reason under the hood seems to be an incorrect link from the recent change of adding XLA support to  in <denchmark-link:https://github.com/tensorflow/tensorflow/commit/9959c04433623e0b7ebf6248e0f75bc7a24bd7cb>9959c04</denchmark-link>\n .\n Install the latest nightly, and navigate to the directory of tensorflow_core/compiler/aot:\n <denchmark-code>$ ldd _pywrap_tfcompile.so\n \tlinux-vdso.so.1 (0x00007ffc5e064000)\n \tlibtensorflow_framework.so.2 => /usr/local/lib/python3.7/dist-packages/tensorflow_core/compiler/aot/./../../libtensorflow_framework.so.2 (0x00007fa798bba000)\n \t_pywrap_tensorflow_internal.so => not found\n \tlibdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fa798b77000)\n \tlibpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fa798b56000)\n \tlibm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007fa7989d1000)\n \tlibstdc++.so.6 => /usr/lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007fa79884d000)\n \tlibgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007fa798833000)\n \tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fa798672000)\n \t/lib64/ld-linux-x86-64.so.2 (0x00007fa79afbc000)\n \tlibrt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007fa798668000)\n </denchmark-code>\n \n Obviously it links to _pywrap_tensorflow_internal.so but it is not found with the relative path.\n PS: we are using auditwheel==3.0.0 to produce manylinux2014 builds, but the official tf-nightly uses an older version which fails to catch this.\n PPS: directly using saved_model_cli does not give this error as _pywrap_tensorflow_internal.so seems to be preloaded. But I am pretty sure this is a bug that we need to fix.\n Ping <denchmark-link:https://github.com/ebrevdo>@ebrevdo</denchmark-link>\n  <denchmark-link:https://github.com/mihaimaruseac>@mihaimaruseac</denchmark-link>\n .\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "byronyi", "commentT": "2020-01-20T14:45:09Z", "comment_text": "\n \t\tThe reason seems to be that tf_python_pybind_extension should only be used for packages in //tensorflow/python/... but it is used in //tensorflow/compiler/.. in this case.\n Ping <denchmark-link:https://github.com/av8ramit>@av8ramit</denchmark-link>\n  to double check.\n See <denchmark-link:https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tensorflow.bzl#L2573-L2577>https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tensorflow.bzl#L2573-L2577</denchmark-link>\n .\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "byronyi", "commentT": "2020-01-20T15:02:04Z", "comment_text": "\n \t\tI think we can move pywrap_tfcompile to python/\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "byronyi", "commentT": "2020-01-20T18:01:43Z", "comment_text": "\n \t\tI have a solution; gonna get it through internal reviews and then will ping you when it's available.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "byronyi", "commentT": "2020-01-20T20:08:17Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/byronyi>@byronyi</denchmark-link>\n  let me know if this doesn't work for you.\n \t\t"}}}, "commit": {"commit_id": "0a57a64a022a180abf7a95584a9570e9f126c42e", "commit_author": "Eugene Brevdo", "commitT": "2020-01-20 10:39:37-08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\compiler\\aot\\BUILD", "file_new_name": "tensorflow\\compiler\\aot\\BUILD", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "98,99,100,101,102,103,104,105,106,107,108,109,110", "deleted_lines": "3,4,5,6,7,8,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\python\\BUILD", "file_new_name": "tensorflow\\python\\BUILD", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "13,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,1143", "deleted_lines": "1118"}}}, "file_2": {"file_change_type": "RENAME", "file_Nmethod": 0, "file_old_name": "tensorflow\\compiler\\aot\\tfcompile_wrapper.cc", "file_new_name": "tensorflow\\python\\tfcompile_wrapper.cc", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\python\\tools\\saved_model_cli.py", "file_new_name": "tensorflow\\python\\tools\\saved_model_cli.py", "file_complexity": {"file_NLOC": "868", "file_CCN": "108", "file_NToken": "4932"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "74", "deleted_lines": "74"}}}}}}