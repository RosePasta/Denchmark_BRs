{"BR": {"BR_id": "1665", "BR_author": "Markus92", "BRopenT": "2019-10-29T10:31:25Z", "BRcloseT": "2019-11-28T12:03:52Z", "BR_text": {"BRsummary": "Temporary dir for gpu collection is not always unique among users", "BRdescription": "\n Short summary about the issue/question:\n When running NNI, it puts the gpu metrics collector in /tmp/nni/script, which is not unique among users. So two people cannot run NNI simultaneously (for example on different GPU).\n Brief what process you are following:\n User 1: runs NNI fine\n User 2: runs NNI on different port, but it'll give status error: \"Training service error: EACCES: permission denied, open '/tmp/nni/script/gpu_metrics_collector.sh'\"\n How to reproduce it:\n See above\n nni Environment:\n \n nni version: 1.0 (but also present in HEAD)\n nni mode(local|pai|remote): local\n OS: Ubuntu 18.04LTS\n python version: 3.6\n is conda or virtualenv used?:  Yes (conda)\n is running in docker?: We run it in Singularity (github.com/sylabs/singularity/), with mounted /tmp as our containers itself are read-only. Redefining /tmp is not an option unfortunately (breaks too many other things it seems). Our containers are self-made from a ubuntu base, with conda, then pip install nni\n \n need to update document(yes/no):\n Maybe\n Anything else we need to know:\n Bug can be traced to line 435 - 437 of /src/nni_manager/training_service/remote_machine/remoteMachineTrainingService.ts\n Clearly path.basename(os.homedir()); doesn't expand to username in our configuration, even though os.homedir() should work in our containers (homedir is mounted).\n A solution would be to use either (/var)/run/user/$PID/, create a /tmp/$PID/ or add a random nonce to the path (for example trial id). Another solution would be allowing to specify your own temporary dir. Upstream at nodejs there might also be a fix possible to use the temporary dir supplied by systemd.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Markus92", "commentT": "2019-11-28T12:03:52Z", "comment_text": "\n \t\tfixed, close.\n \t\t"}}}, "commit": {"commit_id": "6a5864cd92bd0b5b6770a1e8c5d0ce418be4549a", "commit_author": "liuzhe-lz", "commitT": "2019-11-21 15:38:12+08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\nni_manager\\training_service\\common\\gpuData.ts", "file_new_name": "src\\nni_manager\\training_service\\common\\gpuData.ts", "file_complexity": {"file_NLOC": "29", "file_CCN": "2", "file_NToken": "179"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": null, "deleted_lines": "62,63,64,65,66,67,68,69"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\nni_manager\\training_service\\common\\util.ts", "file_new_name": "src\\nni_manager\\training_service\\common\\util.ts", "file_complexity": {"file_NLOC": "205", "file_CCN": "6", "file_NToken": "331"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "222,223,224,225,226,228,229,230,232", "deleted_lines": "222,223,224,225,226,228,229,230,231,232", "method_info": {"method_name": "validateCodeDir", "method_params": "string", "method_startline": "39", "method_endline": "232", "method_complexity": {"method_NLOC": "193", "method_CCN": "6", "method_NToken": "254", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\nni_manager\\training_service\\local\\gpuScheduler.ts", "file_new_name": "src\\nni_manager\\training_service\\local\\gpuScheduler.ts", "file_complexity": {"file_NLOC": "83", "file_CCN": "4", "file_NToken": "618"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "46", "deleted_lines": "46", "method_info": {"method_name": "os.tmpdir", "method_params": "", "method_startline": "46", "method_endline": "47", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "10", "method_nesting_level": "0"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\nni_manager\\training_service\\remote_machine\\remoteMachineTrainingService.ts", "file_new_name": "src\\nni_manager\\training_service\\remote_machine\\remoteMachineTrainingService.ts", "file_complexity": {"file_NLOC": "508", "file_CCN": "9", "file_NToken": "4431"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "45,48,457,462,463", "deleted_lines": "45,48,337,338,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,482,483,487,488,491,493,494,495,499"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tools\\nni_gpu_tool\\gpu_metrics_collector.py", "file_new_name": "tools\\nni_gpu_tool\\gpu_metrics_collector.py", "file_complexity": {"file_NLOC": "84", "file_CCN": "14", "file_NToken": "605"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "38", "deleted_lines": "38", "method_info": {"method_name": "check_ready_to_run", "method_params": "", "method_startline": "28", "method_endline": "43", "method_complexity": {"method_NLOC": "16", "method_CCN": "3", "method_NToken": "114", "method_nesting_level": "0"}}}}}}}}