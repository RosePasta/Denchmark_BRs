{"BR": {"BR_id": "1560", "BR_author": "ultmaster", "BRopenT": "2019-09-19T14:07:40Z", "BRcloseT": "2019-09-30T08:49:46Z", "BR_text": {"BRsummary": "Inconsistent annotation parsing between codegen and specific_codegen", "BRdescription": "\n Customer raised.\n specific_code_generator.py Line 305. Inconsistent with code_generator.py. Causing users not to be able to use codegen in 1.0.\n <denchmark-code>Traceback (most recent call last):\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 355, in parse\n     transformer.visit(ast_tree)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 278, in visit\n     return self._visit_children(node)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 333, in _visit_children\n     self.generic_visit(node)\n   File \"/usr/lib/python3.5/ast.py\", line 300, in generic_visit\n     value = self.visit(value)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 295, in visit\n     return self._visit_children(node)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 333, in _visit_children\n     self.generic_visit(node)\n   File \"/usr/lib/python3.5/ast.py\", line 300, in generic_visit\n     value = self.visit(value)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 295, in visit\n     return self._visit_children(node)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 333, in _visit_children\n     self.generic_visit(node)\n   File \"/usr/lib/python3.5/ast.py\", line 300, in generic_visit\n     value = self.visit(value)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 295, in visit\n     return self._visit_children(node)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 333, in _visit_children\n     self.generic_visit(node)\n   File \"/usr/lib/python3.5/ast.py\", line 300, in generic_visit\n     value = self.visit(value)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 286, in visit\n     return self._visit_string(node)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 328, in _visit_string\n     raise AssertionError('Unexpected annotation function')\n AssertionError: Unexpected annotation function\n \n During handling of the above exception, another exception occurred:\n \n Traceback (most recent call last):\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/__init__.py\", line 145, in _generate_specific_file\n     annotated_code = specific_code_generator.parse(src.read(), para_cfg[\"parameters\"], module)\n   File \"/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py\", line 357, in parse\n     raise RuntimeError('%d: %s' % (ast_tree.last_line, exc.args[0]))\n AttributeError: 'Module' object has no attribute 'last_line'\n </denchmark-code>\n \n I believe the solution should be to refactor, instead of syncing these two files.\n \t"}, "comments": {}}, "commit": {"commit_id": "f1210a9cd9be7143ea807b9a36cfc89109097b62", "commit_author": "Yuge Zhang", "commitT": "2019-09-30 16:49:45+08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "0.875"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tools\\nni_annotation\\code_generator.py", "file_new_name": "tools\\nni_annotation\\code_generator.py", "file_complexity": {"file_NLOC": "256", "file_CCN": "67", "file_NToken": "2203"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "330", "deleted_lines": "328,344", "method_info": {"method_name": "_visit_string", "method_params": "self,node", "method_startline": "317", "method_endline": "344", "method_complexity": {"method_NLOC": "23", "method_CCN": "9", "method_NToken": "172", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "204", "deleted_lines": "201", "method_info": {"method_name": "convert_args_to_dict", "method_params": "call,with_lambda", "method_startline": "195", "method_endline": "213", "method_complexity": {"method_NLOC": "14", "method_CCN": "4", "method_NToken": "123", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "83,84", "deleted_lines": "82", "method_info": {"method_name": "parse_annotation_mutable_layers", "method_params": "code,lineno,nas_mode", "method_startline": "28", "method_endline": "121", "method_complexity": {"method_NLOC": "88", "method_CCN": "15", "method_NToken": "763", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tools\\nni_annotation\\search_space_generator.py", "file_new_name": "tools\\nni_annotation\\search_space_generator.py", "file_complexity": {"file_NLOC": "90", "file_CCN": "24", "file_NToken": "698"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "110", "deleted_lines": "67,111", "method_info": {"method_name": "visit_Call", "method_params": "self,node", "method_startline": "67", "method_endline": "131", "method_complexity": {"method_NLOC": "44", "method_CCN": "15", "method_NToken": "395", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tools\\nni_annotation\\specific_code_generator.py", "file_new_name": "tools\\nni_annotation\\specific_code_generator.py", "file_complexity": {"file_NLOC": "239", "file_CCN": "62", "file_NToken": "2053"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "222", "deleted_lines": "220", "method_info": {"method_name": "test_variable_equal", "method_params": "node1,node2", "method_startline": "207", "method_endline": "223", "method_complexity": {"method_NLOC": "15", "method_CCN": "9", "method_NToken": "122", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "187", "deleted_lines": "185", "method_info": {"method_name": "convert_args_to_dict", "method_params": "call,with_lambda", "method_startline": "178", "method_endline": "196", "method_complexity": {"method_NLOC": "14", "method_CCN": "4", "method_NToken": "123", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "307,308,310,311,312,313,314,315,320,321,326,327", "deleted_lines": "306,308,313,318,330", "method_info": {"method_name": "_visit_string", "method_params": "self,node", "method_startline": "299", "method_endline": "337", "method_complexity": {"method_NLOC": "32", "method_CCN": "9", "method_NToken": "383", "method_nesting_level": "1"}}}}}}}}