{"BR": {"BR_id": "1204", "BR_author": "chicm-ms", "BRopenT": "2019-06-25T04:54:02Z", "BRcloseT": "2019-10-12T02:25:20Z", "BR_text": {"BRsummary": "Multiphase job hangs when search space is exhuasted with  NoMoreTrialError raised", "BRdescription": "\n Short summary about the issue/question:\n Brief what process you are following:\n How to reproduce it:\n Batch tuner and Gridsearch tuner raises NoMoreTrialError when search space exhuasted,  but nni does not handle it properly for multiphase jobs.\n I reproduced it using nni/test/config_test/multi_phase/multi_phase_batch.test.yml.\n For example using a small search space with batch tuner:\n <denchmark-code>{\n     \"test\":\n     {\n         \"_type\" : \"choice\",\n         \"_value\" : [1, 100]\n     }\n }\n </denchmark-code>\n \n Then request more than 2 trials, multiphase job hangs.\n [06/25/2019, 11:33:28 AM] DEBUG (nni.msg_dispatcher_base/Thread-1) process_command: command: [CommandType.ReportMetricData], data: [OrderedDict([('type', 'REQUEST_PARAMETER'), ('sequence', 0), ('parameter_index', 1), ('trial_job_id', 'xl6az')])]\n [06/25/2019, 11:33:28 AM] ERROR (nni.msg_dispatcher_base/Thread-1) no more parameters now.\n Traceback (most recent call last):\n File \"/home/quzha/anaconda3/envs/nni/lib/python3.7/site-packages/nni/msg_dispatcher_base.py\", line 102, in command_queue_worker\n self.process_command(command, data)\n File \"/home/quzha/anaconda3/envs/nni/lib/python3.7/site-packages/nni/msg_dispatcher_base.py\", line 160, in process_command\n command_handlers<denchmark-link:data>command</denchmark-link>\n \n File \"/home/quzha/anaconda3/envs/nni/lib/python3.7/site-packages/nni/msg_dispatcher.py\", line 146, in handle_report_metric_data\n param = self.tuner.generate_parameters(param_id, trial_job_id=data['trial_job_id'])\n File \"/home/quzha/anaconda3/envs/nni/lib/python3.7/site-packages/nni/batch_tuner/batch_tuner.py\", line 90, in generate_parameters\n raise nni.NoMoreTrialError('no more parameters now.')\n nni.NoMoreTrialError: no more parameters now.\n nni Environment:\n \n nni version:\n nni mode(local|pai|remote):\n OS:\n python version:\n is conda or virtualenv used?:\n is running in docker?:\n \n need to update document(yes/no):\n Anything else we need to know:\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "chicm-ms", "commentT": "2019-09-16T10:29:30Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/microsoft/nni/pull/1539>#1539</denchmark-link>\n  fixed this issue\n \t\t"}}}, "commit": {"commit_id": "7246593fa4f7cf60bbe4bc027c4cfc3856e9b644", "commit_author": "chicm-ms", "commitT": "2019-09-16 16:16:06+08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\en_US\\AdvancedFeature\\MultiPhase.md", "file_new_name": "docs\\en_US\\AdvancedFeature\\MultiPhase.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "24,25,26,36,37,38,39", "deleted_lines": "11,12"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\nni_manager\\core\\nnimanager.ts", "file_new_name": "src\\nni_manager\\core\\nnimanager.ts", "file_complexity": {"file_NLOC": "630", "file_CCN": "19", "file_NToken": "4847"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "694,695,696,697,698", "deleted_lines": "694,695"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\sdk\\pynni\\nni\\msg_dispatcher.py", "file_new_name": "src\\sdk\\pynni\\nni\\msg_dispatcher.py", "file_complexity": {"file_NLOC": "159", "file_CCN": "49", "file_NToken": "1101"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "148,149,150,151", "deleted_lines": "147", "method_info": {"method_name": "handle_report_metric_data", "method_params": "self,data", "method_startline": "131", "method_endline": "154", "method_complexity": {"method_NLOC": "18", "method_CCN": "6", "method_NToken": "150", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\sdk\\pynni\\nni\\trial.py", "file_new_name": "src\\sdk\\pynni\\nni\\trial.py", "file_complexity": {"file_NLOC": "58", "file_CCN": "10", "file_NToken": "249"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "46,47", "deleted_lines": "46", "method_info": {"method_name": "get_next_parameter", "method_params": "", "method_startline": "45", "method_endline": "52", "method_complexity": {"method_NLOC": "6", "method_CCN": "2", "method_NToken": "26", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "test\\config_test\\multi_phase\\multi_phase.py", "file_new_name": "test\\config_test\\multi_phase\\multi_phase.py", "file_complexity": {"file_NLOC": "10", "file_CCN": "0", "file_NToken": "55"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "7,8,9", "deleted_lines": null}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "test\\pipelines-it-local-windows.yml", "file_new_name": "test\\pipelines-it-local-windows.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "21", "deleted_lines": "21"}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "test\\pipelines-it-local.yml", "file_new_name": "test\\pipelines-it-local.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "34", "deleted_lines": "34"}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "test\\pipelines-it-pai-windows.yml", "file_new_name": "test\\pipelines-it-pai-windows.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "68", "deleted_lines": "68"}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "test\\pipelines-it-pai.yml", "file_new_name": "test\\pipelines-it-pai.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "79", "deleted_lines": "79"}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "test\\pipelines-it-remote-windows.yml", "file_new_name": "test\\pipelines-it-remote-windows.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "42", "deleted_lines": "42"}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "test\\pipelines-it-remote.yml", "file_new_name": "test\\pipelines-it-remote.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "56", "deleted_lines": "56"}}}}}}