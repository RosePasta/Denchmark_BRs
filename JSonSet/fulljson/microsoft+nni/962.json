{"BR": {"BR_id": "962", "BR_author": "PurityFan", "BRopenT": "2019-04-07T13:48:14Z", "BRcloseT": "2019-06-24T03:28:59Z", "BR_text": {"BRsummary": "Can not pass version check when install nni by source code and running an experiment on PAI", "BRdescription": "\n When I install NNI with source code in master (using source install.sh), I will get the NNI with version v0.5.2 (should be others)\n So when I want to run an experiment on PAI, I will meet experiment failed due to version check with docker image \"msranni/nni:latest\", the error message is \"Training service error: NNIManager version is 0.5, TrialKeeper version is 0.6, NNI version does not match!\"\n Even I change the docker image to \"msranni/nni:v0.5\", the experiment still failed with message \"Training service error: Version check failed, didn't get version check response from trialKeeper, please check your NNI version in NNIManager and TrialKeeper!\"\n Therefore, the NNI installed by source install cannot be used on PAI.\n I have synced with <denchmark-link:https://github.com/SparkSnail>@SparkSnail</denchmark-link>\n  , now we can skip the version check by adding \"--debug\" at the create process of the experiment. Actually it's not reasonable. DEBUG mode should be used for debug, not skip version check(and we haven't mentioned it on our doc, may confuse user the activity of --debug).\n It is very common to modify the source code and reinstall nni by source install. So it's neccessary for us to solve this version check conflict problem.\n Suggestion:\n (1) You can add --skip_version_check option to skip this conflict (instead of --debug)\n (2) Set the version of the master code to a constant and compatible with all versions\n (3) Others.....?\n BTW, here is the log of source code installation:\n v-shhuan@srgws-06:~/nni_code/nni$ source install.sh\n # Extracting Node.js\n rm -rf /tmp/v-shhuan/nni-node-linux-x64\n mkdir /tmp/v-shhuan/nni-node-linux-x64\n tar -xf /tmp/v-shhuan/nni-node-linux-x64.tar.xz -C /tmp/v-shhuan/nni-node-linux-x64 --strip-components 1\n mkdir -p /home/v-shhuan/anaconda3/bin\n rm -f /home/v-shhuan/anaconda3/bin/node\n cp /tmp/v-shhuan/nni-node-linux-x64/bin/node /home/v-shhuan/anaconda3/bin/node\n # Extracting Yarn\n rm -rf /tmp/v-shhuan/nni-yarn\n mkdir /tmp/v-shhuan/nni-yarn\n tar -xf /tmp/v-shhuan/nni-yarn.tar.gz -C /tmp/v-shhuan/nni-yarn --strip-components 1\n # Building NNI Manager\n cd src/nni_manager && PATH=/home/v-shhuan/anaconda3/bin:${PATH} /tmp/v-shhuan/nni-yarn/bin/yarn && PATH=/home/v-shhuan/anaconda3/bin:${PATH} /tmp/v-shhuan/nni-yarn/bin/yarn build\n yarn install v1.12.1\n [1/5] Validating package.json...\n [2/5] Resolving packages...\n [3/5] Fetching packages...\n [4/5] Linking dependencies...\n warning \" > express-joi-validator@2.0.0\" has unmet peer dependency \"joi@6.x.x\".\n [5/5] Building fresh packages...\n success Saved lockfile.\n Done in 2.69s.\n yarn run v1.12.1\n $ tsc\n $ cp -rf config ./dist/\n Done in 4.56s.\n # Building WebUI\n cd src/webui && PATH=/home/v-shhuan/anaconda3/bin:${PATH} /tmp/v-shhuan/nni-yarn/bin/yarn && PATH=/home/v-shhuan/anaconda3/bin:${PATH} /tmp/v-shhuan/nni-yarn/bin/yarn build\n yarn install v1.12.1\n [1/4] Resolving packages...\n [2/4] Fetching packages...\n info fsevents@1.2.4: The platform \"linux\" is incompatible with this module.\n info \"fsevents@1.2.4\" is an optional dependency and failed compatibility check. Excluding it from installation.\n [3/4] Linking dependencies...\n warning \"antd > rc-editor-mention@1.1.7\" has unmet peer dependency \"immutable@^3.7.4\".\n warning \" > echarts-for-react@2.0.14\" has unmet peer dependency \"prop-types@^15.5.7\".\n warning \" > react-scripts-ts-antd@2.17.0\" has incorrect peer dependency \"typescript@2.x\".\n warning \"react-scripts-ts-antd > babel-jest@22.4.4\" has unmet peer dependency \"babel-core@^6.0.0 || ^7.0.0-0\".\n warning \"react-scripts-ts-antd > babel-loader@7.1.5\" has unmet peer dependency \"babel-core@6\".\n warning \"react-scripts-ts-antd > babel-preset-react-app@3.1.2\" has unmet peer dependency \"babel-runtime@^6.23.0\".\n warning \"react-scripts-ts-antd > fork-ts-checker-webpack-plugin@0.2.10\" has incorrect peer dependency \"typescript@^2.1.0\".\n warning \"react-scripts-ts-antd > react-app-rewired@1.6.2\" has unmet peer dependency \"react-scripts@^1.0.14\".\n warning \"react-scripts-ts-antd > ts-jest@22.0.1\" has incorrect peer dependency \"typescript@2.x\".\n [4/4] Building fresh packages...\n success Saved lockfile.\n Done in 3.11s.\n yarn run v1.12.1\n $ react-scripts-ts-antd build\n Creating an optimized production build...\n Starting type checking and linting service...\n Using 1 worker with 2048MB memory limit\n ts-loader: Using typescript@3.1.3 and /home/v-shhuan/nni_code/nni/src/webui/tsconfig.json\n No valid rules have been specified for JavaScript files\n Compiled successfully.\n \n File sizes after gzip:\n \n   931.63 KB (-309 B)  build/static/js/main.e235f4d1.js\n   41.24 KB            build/static/css/main.a73075f2.css\n \n The bundle size is significantly larger than recommended.\n Consider reducing it with code splitting: https://goo.gl/9VhYWB\n You can also analyze the project dependencies: https://goo.gl/LeUzfb\n \n The project was built assuming it is hosted at the server root.\n You can control this with the homepage field in your package.json.\n For example, add this to build it for GitHub Pages:\n \n   \"homepage\" : \"http://myname.github.io/myapp\",\n \n The build folder is ready to be deployed.\n You may serve it with a static server:\n \n   yarn global add serve\n   serve -s build\n \n Find out more about deployment here:\n \n   http://bit.ly/2vY88Kr\n \n Done in 54.72s.\n # Installing Python SDK\n sed -ie 's/999.0.0-developing/v0.5.2-111-g6cdea19/' setup.py && python3 -m pip install  .\n Processing /home/v-shhuan/nni_code/nni\n Requirement already satisfied: astor in /home/v-shhuan/.local/lib/python3.7/site-packages (from nni===v0.5.2-111-g6cdea19) (0.7.1)\n Requirement already satisfied: hyperopt in /home/v-shhuan/.local/lib/python3.7/site-packages (from nni===v0.5.2-111-g6cdea19) (0.1.2)\n Requirement already satisfied: json_tricks in /home/v-shhuan/.local/lib/python3.7/site-packages (from nni===v0.5.2-111-g6cdea19) (3.13.1)\n Requirement already satisfied: numpy in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from nni===v0.5.2-111-g6cdea19) (1.15.4)\n Requirement already satisfied: psutil in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from nni===v0.5.2-111-g6cdea19) (5.4.8)\n Requirement already satisfied: pyyaml in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from nni===v0.5.2-111-g6cdea19) (3.13)\n Requirement already satisfied: requests in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from nni===v0.5.2-111-g6cdea19) (2.21.0)\n Requirement already satisfied: scipy in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from nni===v0.5.2-111-g6cdea19) (1.1.0)\n Requirement already satisfied: schema in /home/v-shhuan/.local/lib/python3.7/site-packages (from nni===v0.5.2-111-g6cdea19) (0.7.0)\n Requirement already satisfied: PythonWebHDFS in /home/v-shhuan/.local/lib/python3.7/site-packages (from nni===v0.5.2-111-g6cdea19) (0.2.3)\n Requirement already satisfied: pymongo in /home/v-shhuan/.local/lib/python3.7/site-packages (from hyperopt->nni===v0.5.2-111-g6cdea19) (3.7.2)\n Requirement already satisfied: networkx in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from hyperopt->nni===v0.5.2-111-g6cdea19) (2.2)\n Requirement already satisfied: tqdm in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from hyperopt->nni===v0.5.2-111-g6cdea19) (4.28.1)\n Requirement already satisfied: future in /home/v-shhuan/.local/lib/python3.7/site-packages (from hyperopt->nni===v0.5.2-111-g6cdea19) (0.17.1)\n Requirement already satisfied: six in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from hyperopt->nni===v0.5.2-111-g6cdea19) (1.12.0)\n Requirement already satisfied: certifi>=2017.4.17 in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from requests->nni===v0.5.2-111-g6cdea19) (2018.11.29)\n Requirement already satisfied: chardet<3.1.0,>=3.0.2 in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from requests->nni===v0.5.2-111-g6cdea19) (3.0.4)\n Requirement already satisfied: urllib3<1.25,>=1.21.1 in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from requests->nni===v0.5.2-111-g6cdea19) (1.24.1)\n Requirement already satisfied: idna<2.9,>=2.5 in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from requests->nni===v0.5.2-111-g6cdea19) (2.8)\n Requirement already satisfied: contextlib2==0.5.5 in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from schema->nni===v0.5.2-111-g6cdea19) (0.5.5)\n Requirement already satisfied: simplejson in /home/v-shhuan/.local/lib/python3.7/site-packages (from PythonWebHDFS->nni===v0.5.2-111-g6cdea19) (3.16.0)\n Requirement already satisfied: decorator>=4.3.0 in /home/v-shhuan/anaconda3/lib/python3.7/site-packages (from networkx->hyperopt->nni===v0.5.2-111-g6cdea19) (4.3.0)\n Building wheels for collected packages: nni\n   Running setup.py bdist_wheel for nni ... done\n   Stored in directory: /tmp/pip-ephem-wheel-cache-syb9qfsu/wheels/11/21/26/8e0874255a9f897756c89c715bdd54b54ceab968fa217f7f94\n Successfully built nni\n Installing collected packages: nni\n Successfully installed nni-v0.5.2-111-g6cdea19\n # Installing NNI Package\n rm -rf /home/v-shhuan/anaconda3/nni\n cp -r src/nni_manager/dist /home/v-shhuan/anaconda3/nni\n cp src/nni_manager/package.json /home/v-shhuan/anaconda3/nni\n sed -ie 's/999.0.0-developing/v0.5.2-111-g6cdea19/' /home/v-shhuan/anaconda3/nni/package.json\n PATH=/home/v-shhuan/anaconda3/bin:${PATH} /tmp/v-shhuan/nni-yarn/bin/yarn --prod --cwd /home/v-shhuan/anaconda3/nni\n yarn install v1.12.1\n info No lockfile found.\n [1/5] Validating package.json...\n [2/5] Resolving packages...\n warning express-joi-validator > boom@2.6.1: This version is no longer maintained. Please upgrade to the latest version.\n warning express-joi-validator > joi@6.10.1: This version is no longer maintained. Please upgrade to the latest version.\n warning express-joi-validator > boom > hoek@2.16.3: This version is no longer maintained. Please upgrade to the latest version.\n warning express-joi-validator > joi > hoek@2.16.3: This version is no longer maintained. Please upgrade to the latest version.\n warning express-joi-validator > joi > topo@1.1.0: This version is no longer maintained. Please upgrade to the latest version.\n warning express-joi-validator > joi > topo > hoek@2.16.3: This version is no longer maintained. Please upgrade to the latest version.\n warning rmdir > node.flow > node.extend > object-keys@0.4.0:\n [3/5] Fetching packages...\n [4/5] Linking dependencies...\n warning \" > express-joi-validator@2.0.1\" has unmet peer dependency \"joi@6.x.x\".\n [5/5] Building fresh packages...\n success Saved lockfile.\n Done in 15.45s.\n cp -r src/webui/build /home/v-shhuan/anaconda3/nni/static\n mkdir -p /home/v-shhuan/.bash_completion.d\n install -m644 tools/bash-completion /home/v-shhuan/.bash_completion.d/nnictl\n # Complete! You may want to add /home/v-shhuan/anaconda3/bin to your PATH environment\n # Updating bash configurations\n # Complete!\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "PurityFan", "commentT": "2019-04-10T06:32:14Z", "comment_text": "\n \t\tUpdate: Now install NNI with source code in master (using source install.sh) will get the NNI with version v0.6-83-gaab6b8b\n \t\t"}}}, "commit": {"commit_id": "83fae834c4a09a323ada78a35c08d5b9cb8aa287", "commit_author": "SparkSnail", "commitT": "2019-06-21 13:35:14+07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\en_US\\ExperimentConfig.md", "file_new_name": "docs\\en_US\\ExperimentConfig.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "153,154,155,156,157,161", "deleted_lines": "156"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tools\\nni_cmd\\config_schema.py", "file_new_name": "tools\\nni_cmd\\config_schema.py", "file_complexity": {"file_NLOC": "300", "file_CCN": "4", "file_NToken": "2579"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "59", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tools\\nni_cmd\\launcher.py", "file_new_name": "tools\\nni_cmd\\launcher.py", "file_complexity": {"file_NLOC": "447", "file_CCN": "126", "file_NToken": "3771"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "306,307,308", "deleted_lines": null, "method_info": {"method_name": "set_experiment", "method_params": "experiment_config,mode,port,config_file_name", "method_startline": "280", "method_endline": "348", "method_complexity": {"method_NLOC": "63", "method_CCN": "16", "method_NToken": "601", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "369", "deleted_lines": "366", "method_info": {"method_name": "launch_experiment", "method_params": "args,experiment_config,mode,config_file_name,experiment_id", "method_startline": "350", "method_endline": "504", "method_complexity": {"method_NLOC": "133", "method_CCN": "41", "method_NToken": "950", "method_nesting_level": "0"}}}}}}}}