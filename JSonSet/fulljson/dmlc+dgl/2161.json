{"BR": {"BR_id": "2161", "BR_author": "HenryKenlay", "BRopenT": "2020-09-08T18:32:49Z", "BRcloseT": "2020-09-09T03:00:32Z", "BR_text": {"BRsummary": "Error when using `dgl.data.TUDataset` in the latest versions", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n I get an error when using dgl.data.TUDataset in dgl versions 0.5.0 and 0.5.1. I also get the same error if I build from source.\n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n I've used ENZYMES in this example but it seems to be an issue across all the datasets.\n Steps to reproduce the behaviour:\n \n (Optional) Delete cached data rm -rf ~/.dgl/ENZYMES ~/.dgl/ENZYMES.zip\n Inside a python 3.7 virtualenv pip install dgl torch torchvision\n Import TUDataset from dgl.data import TUDataset\n Try and create an object TUDataset('ENZYMES')\n \n The stack trace is as follows\n <denchmark-code>(venv) kenlay@Henry-2:~/Dropbox/DPhil/research/graph-attack$ python\n Python 3.7.6 (default, Jan  8 2020, 13:42:34) \n [Clang 4.0.1 (tags/RELEASE_401/final)] :: Anaconda, Inc. on darwin\n Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n >>> from dgl.data import TUDataset\n Using backend: pytorch\n >>> TUDataset('ENZYMES')\n /Users/kenlay/Dropbox/DPhil/research/graph-attack/venv/lib/python3.7/site-packages/dgl/data/utils.py:31: UserWarning: Pandas is not installed, now using numpy.loadtxt to load data, which could be extremely slow. Accelerate by installing pandas\n   warnings.warn(\"Pandas is not installed, now using numpy.loadtxt to load data, \"\n Traceback (most recent call last):\n   File \"<stdin>\", line 1, in <module>\n   File \"/Users/kenlay/Dropbox/DPhil/research/graph-attack/venv/lib/python3.7/site-packages/dgl/data/tu.py\", line 288, in __init__\n     verbose=verbose)\n   File \"/Users/kenlay/Dropbox/DPhil/research/graph-attack/venv/lib/python3.7/site-packages/dgl/data/dgl_dataset.py\", line 284, in __init__\n     verbose=verbose)\n   File \"/Users/kenlay/Dropbox/DPhil/research/graph-attack/venv/lib/python3.7/site-packages/dgl/data/dgl_dataset.py\", line 91, in __init__\n     self._load()\n   File \"/Users/kenlay/Dropbox/DPhil/research/graph-attack/venv/lib/python3.7/site-packages/dgl/data/dgl_dataset.py\", line 175, in _load\n     self.process()\n   File \"/Users/kenlay/Dropbox/DPhil/research/graph-attack/venv/lib/python3.7/site-packages/dgl/data/tu.py\", line 326, in process\n     getattr(g, field_name[0])[field_name[1]] = data\n   File \"/Users/kenlay/Dropbox/DPhil/research/graph-attack/venv/lib/python3.7/site-packages/dgl/view.py\", line 81, in __setitem__\n     self._graph._set_n_repr(self._ntid, self._nodes, {key : val})\n   File \"/Users/kenlay/Dropbox/DPhil/research/graph-attack/venv/lib/python3.7/site-packages/dgl/heterograph.py\", line 3753, in _set_n_repr\n     if F.context(val) != self.device:\n   File \"/Users/kenlay/Dropbox/DPhil/research/graph-attack/venv/lib/python3.7/site-packages/dgl/backend/pytorch/tensor.py\", line 76, in context\n     return input.device\n AttributeError: 'numpy.ndarray' object has no attribute 'device'\n </denchmark-code>\n \n Note that installing pandas doesn't fix the issue.\n <denchmark-h:h2>Expected behaviour</denchmark-h>\n \n Have an object returned: <dgl.data.tu.TUDataset object at 0x7fddfc527750>\n <denchmark-h:h2>Environment</denchmark-h>\n \n \n DGL Version (e.g., 1.0): 0.5.0, 0.5.1, installed from source\n Backend Library & Version (e.g., PyTorch 0.4.1, MXNet/Gluon 1.3): Pytorch 1.6.0\n OS (e.g., Linux): MacOS Catalina 10.15.5\n How you installed DGL (conda, pip, source): pip\n Build command you used (if compiling from source): MacOS instructions given here\n Python version: 3.7.6\n CUDA/cuDNN version (if applicable): N/A (cpu version)\n GPU models and configuration (e.g. V100): N/A\n Any other relevant information: N/A\n \n <denchmark-h:h2>Comment</denchmark-h>\n \n This class works for me if I downgrade to 0.4.3. Note that if I use the class in 0.4.3 and then try and load the cached data in 0.5.1 I get the same error.\n I can try to dig into the source code to identify the issue if this is a bug that others can reproduce.\n \t"}, "comments": {}}, "commit": {"commit_id": "0cf99be37838345fcbd9464b24c57a86465a0439", "commit_author": "xiang song(charlie.song)", "commitT": "2020-09-09 11:00:31+08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\dgl\\data\\tu.py", "file_new_name": "python\\dgl\\data\\tu.py", "file_complexity": {"file_NLOC": "317", "file_CCN": "50", "file_NToken": "2064"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "326,327", "deleted_lines": null, "method_info": {"method_name": "process", "method_params": "self", "method_startline": "290", "method_endline": "332", "method_complexity": {"method_NLOC": "37", "method_CCN": "7", "method_NToken": "350", "method_nesting_level": "1"}}}}}}}}