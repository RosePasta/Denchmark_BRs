{"BR": {"BR_id": "854", "BR_author": "alyaxey", "BRopenT": "2020-06-24T11:14:58Z", "BRcloseT": "2020-06-25T04:31:27Z", "BR_text": {"BRsummary": "EarlyStoppingCallback considers first epoch as bad", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug Report</denchmark-h>\n \n EarlyStoppingCallback considers first epoch as bad. This can lead for example to always stopping after first epoch if patience=1.\n <denchmark-h:h3>How To Reproduce</denchmark-h>\n \n You can train a model with early stopping and patience=1 and see that it always stops after first epoch. Or you can use the unit test below that I added to pull request.\n <denchmark-h:h4>Code sample</denchmark-h>\n \n from unittest.mock import MagicMock, PropertyMock\n \n from catalyst.core import EarlyStoppingCallback\n \n \n def test_patience1():\n     \"\"\"@TODO: Docs. Contribution is welcome.\"\"\"\n     early_stop = EarlyStoppingCallback(1)\n     runner = MagicMock()\n     type(runner).stage_name = PropertyMock(return_value=\"training\")\n     type(runner).valid_metrics = PropertyMock(return_value={\"loss\": 0.001})\n     stop_mock = PropertyMock(return_value=False)\n     type(runner).need_early_stop = stop_mock\n \n     early_stop.on_epoch_end(runner)\n \n     assert stop_mock.mock_calls == []\n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n Training doesn't stop after first epoch. And the unit test passes.\n <denchmark-h:h3>Environment</denchmark-h>\n \n Catalyst version: 20.06\n PyTorch version: 1.5.1\n Is debug build: No\n CUDA used to build PyTorch: None\n TensorFlow version: N/A\n TensorBoard version: 2.2.2\n \n OS: Mac OSX 10.15.5\n GCC version: Could not collect\n CMake version: version 3.8.0\n \n Python version: 3.7\n Is CUDA available: No\n CUDA runtime version: No CUDA\n GPU models and configuration: No CUDA\n Nvidia driver version: No CUDA\n cuDNN version: No CUDA\n \n Versions of relevant libraries:\n [pip3] catalyst-codestyle==20.4\n [pip3] catalyst-sphinx-theme==1.1.1\n [pip3] efficientnet-pytorch==0.6.3\n [pip3] numpy==1.18.5\n [pip3] segmentation-models-pytorch==0.1.0\n [pip3] tensorboard==2.2.2\n [pip3] tensorboard-plugin-wit==1.6.0.post3\n [pip3] tensorboardX==2.0\n [pip3] torch==1.5.1\n [pip3] torchvision==0.6.1\n [conda] catalyst-codestyle        20.4                      <pip>\n [conda] catalyst-sphinx-theme     1.1.1                     <pip>\n [conda] efficientnet-pytorch      0.6.3                     <pip>\n [conda] numpy                     1.18.5                    <pip>\n [conda] segmentation-models-pytorch 0.1.0                     <pip>\n [conda] tensorboard               2.2.2                     <pip>\n [conda] tensorboard-plugin-wit    1.6.0.post3               <pip>\n [conda] tensorboardX              2.0                       <pip>\n [conda] torch                     1.5.1                     <pip>\n [conda] torchvision               0.6.1                     <pip>\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "alyaxey", "commentT": "2020-06-24T11:15:34Z", "comment_text": "\n \t\tHi! Thank you for your contribution! Great first issue!\n \t\t"}}}, "commit": {"commit_id": "317c71f95ed0c0d3fa43dbb402a40e4326b0a698", "commit_author": "Oleksii Sliusarenko", "commitT": "2020-06-25 07:31:26+03:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "34,35,36", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "catalyst\\core\\callbacks\\early_stop.py", "file_new_name": "catalyst\\core\\callbacks\\early_stop.py", "file_complexity": {"file_NLOC": "46", "file_CCN": "11", "file_NToken": "331"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "54", "deleted_lines": "54,55,56", "method_info": {"method_name": "on_epoch_end", "method_params": "self,IRunner", "method_startline": "48", "method_endline": "62", "method_complexity": {"method_NLOC": "13", "method_CCN": "5", "method_NToken": "87", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "catalyst\\core\\callbacks\\tests\\__init__.py", "file_new_name": "catalyst\\core\\callbacks\\tests\\__init__.py", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_3": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "catalyst\\core\\callbacks\\tests\\test_early_stop.py", "file_complexity": {"file_NLOC": "11", "file_CCN": "1", "file_NToken": "92"}}}}}