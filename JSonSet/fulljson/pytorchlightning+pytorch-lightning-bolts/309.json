{"BR": {"BR_id": "309", "BR_author": "FrankXinqi", "BRopenT": "2020-10-25T17:05:41Z", "BRcloseT": "2020-11-17T19:36:33Z", "BR_text": {"BRsummary": "How to use SSLOnlineEvaluator callback", "BRdescription": "\n <denchmark-h:h2>\u2753 Questions and Help</denchmark-h>\n \n <denchmark-h:h3>Before asking:</denchmark-h>\n \n Lightning Forum Posted Question: <denchmark-link:https://forums.pytorchlightning.ai/t/how-to-use-sslonlineevaluator/309>https://forums.pytorchlightning.ai/t/how-to-use-sslonlineevaluator/309</denchmark-link>\n \n <denchmark-h:h4>What is your question?</denchmark-h>\n \n I study the code provided here SSL SimCLR on colab, and implemented a similar code.\n I have modified the datamodule to load mine, and I can run the code. However, if I use SSLOnlineEvaluator. I cannot make it work. If I specify the callbacks for model, the error shows:\n TypeError: on_train_batch_end() takes 6 positional arguments but 7 were given\n <denchmark-h:h4>Code</denchmark-h>\n \n I have the following code:\n <denchmark-code>def to_device(batch, device):\n     (img1, _), y = batch\n     img1 = img1.to(device)\n     y = y.to(device)\n     return img1, y\n \n online_finetuner = SSLOnlineEvaluator(z_dim=2048 * 2 * 2, num_classes = 7)\n online_finetuner.to_device = to_device\n \n lr_logger = LearningRateMonitor()\n \n callbacks = [online_finetuner, lr_logger]\n \n # pick data\n rafdb_height=100\n batch_size=64\n \n # data\n dm = RAFDBDataModule(num_workers=0)\n dm.train_transforms = SimCLRTrainDataTransform(input_height=rafdb_height)\n dm.val_transforms = SimCLREvalDataTransform(input_height=rafdb_height)\n dm.test_transforms = SimCLREvalDataTransform(input_height=rafdb_height)\n \n # model\n model = SimCLR(num_samples=dm.num_samples, batch_size=batch_size)\n \n # fit\n trainer = pl.Trainer(gpus=1, max_epochs=20, callbacks=callbacks)\n trainer.fit(model, dm)\n </denchmark-code>\n \n Full Output information:\n <denchmark-code>GPU available: True, used: True\n TPU available: False, using: 0 TPU cores\n LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]\n \n   | Name                 | Type         | Params\n ------------------------------------------------------\n 0 | encoder              | ResNet       | 25 M  \n 1 | projection           | Projection   | 4 M   \n 2 | non_linear_evaluator | SSLEvaluator | 8 M   \n Epoch 0:   0%|          | 0/383 [00:00<?, ?it/s] Traceback (most recent call last):\n   File \"H:/Project/PycharmProject/FER_Long-tailed/train_SimCLR.py\", line 236, in <module>\n     trainer.fit(model, dm)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\trainer.py\", line 440, in fit\n     results = self.accelerator_backend.train()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\accelerators\\gpu_accelerator.py\", line 54, in train\n     results = self.train_or_test()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\accelerators\\accelerator.py\", line 66, in train_or_test\n     results = self.trainer.train()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\trainer.py\", line 483, in train\n     self.train_loop.run_training_epoch()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\training_loop.py\", line 557, in run_training_epoch\n     self.on_train_batch_end(epoch_output, epoch_end_outputs, batch, batch_idx, dataloader_idx)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\training_loop.py\", line 249, in on_train_batch_end\n     self.trainer.call_hook('on_train_batch_end', epoch_end_outputs, batch, batch_idx, dataloader_idx)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\trainer.py\", line 823, in call_hook\n     trainer_hook(*args, **kwargs)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\callback_hook.py\", line 147, in on_train_batch_end\n     callback.on_train_batch_end(self, self.get_model(), outputs, batch, batch_idx, dataloader_idx)\n TypeError: on_train_batch_end() takes 6 positional arguments but 7 were given\n Epoch 0:   0%|          | 0/383 [00:02<?, ?it/s]\n \n Process finished with exit code 1\n </denchmark-code>\n \n <denchmark-h:h4>What have you tried?</denchmark-h>\n \n Try to put OnlineEvaluator as the only callback, but it does not work as well.\n <denchmark-h:h4>What's your environment?</denchmark-h>\n \n \n OS: Win10\n Packaging [e.g. pip, conda]\n Version:\n python                    3.8.6\n pytorch                   1.6.0\n pytorch-lightning         1.0.2                      py_0    conda-forge\n pytorch-lightning-bolts   0.2.5                    pypi_0    pypi\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "FrankXinqi", "commentT": "2020-10-25T17:54:00Z", "comment_text": "\n \t\tI believe this PR <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning-bolts/pull/277>#277</denchmark-link>\n  fixed this\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "FrankXinqi", "commentT": "2020-10-26T01:44:56Z", "comment_text": "\n \t\tCool. I see that an 'output' arg was added. I will install the latest version from GitHub.\n Just an offset question: If I do not want to install the blots package again by\n pip install git+https://github.com/PytorchLightning/pytorch-lightning-bolts.git@master --upgrade, instead I download the package from GitHub, put it in my project folder, and just call any function by its relative path. Would this work with this kind of big project?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "FrankXinqi", "commentT": "2020-10-26T02:02:40Z", "comment_text": "\n \t\tI never tried that but you should be able to make it work. You probably have to add it to the python path or similar to have the imports working.\n We don't recommend this, because you won't get any updates and have to manually repeat the process if you need to get  new version.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "FrankXinqi", "commentT": "2020-10-26T02:12:37Z", "comment_text": "\n \t\tCool. There is a new bug, when I upgrade to the master version.  The network maltiplication has a dimension not match as\n <denchmark-code>  File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\torch\\nn\\functional.py\", line 1676, in linear\n     output = input.matmul(weight.t())\n RuntimeError: mat1 dim 1 must match mat2 dim 0\n </denchmark-code>\n \n The output information\n <denchmark-code>GPU available: True, used: True\n TPU available: False, using: 0 TPU cores\n LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]\n \n   | Name                 | Type         | Params\n ------------------------------------------------------\n 0 | encoder              | ResNet       | 25 M  \n 1 | projection           | Projection   | 4 M   \n 2 | non_linear_evaluator | SSLEvaluator | 8 M   \n Epoch 0:   0%|          | 0/383 [00:00<?, ?it/s] Traceback (most recent call last):\n   File \"H:/Project/PycharmProject/FER_Long-tailed/train_SimCLR.py\", line 276, in <module>\n     trainer.fit(model, dm)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\trainer.py\", line 440, in fit\n     results = self.accelerator_backend.train()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\accelerators\\gpu_accelerator.py\", line 54, in train\n     results = self.train_or_test()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\accelerators\\accelerator.py\", line 66, in train_or_test\n     results = self.trainer.train()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\trainer.py\", line 483, in train\n     self.train_loop.run_training_epoch()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\training_loop.py\", line 557, in run_training_epoch\n     self.on_train_batch_end(epoch_output, epoch_end_outputs, batch, batch_idx, dataloader_idx)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\training_loop.py\", line 249, in on_train_batch_end\n     self.trainer.call_hook('on_train_batch_end', epoch_end_outputs, batch, batch_idx, dataloader_idx)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\trainer.py\", line 823, in call_hook\n     trainer_hook(*args, **kwargs)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\callback_hook.py\", line 147, in on_train_batch_end\n     callback.on_train_batch_end(self, self.get_model(), outputs, batch, batch_idx, dataloader_idx)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pl_bolts\\callbacks\\ssl_online.py\", line 85, in on_train_batch_end\n     mlp_preds = pl_module.non_linear_evaluator(representations)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\torch\\nn\\modules\\module.py\", line 722, in _call_impl\n     result = self.forward(*input, **kwargs)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pl_bolts\\models\\self_supervised\\evaluator.py\", line 30, in forward\n     logits = self.block_forward(x)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\torch\\nn\\modules\\module.py\", line 722, in _call_impl\n     result = self.forward(*input, **kwargs)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\torch\\nn\\modules\\container.py\", line 117, in forward\n     input = module(input)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\torch\\nn\\modules\\module.py\", line 722, in _call_impl\n     result = self.forward(*input, **kwargs)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\torch\\nn\\modules\\linear.py\", line 91, in forward\n     return F.linear(input, self.weight, self.bias)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\torch\\nn\\functional.py\", line 1676, in linear\n     output = input.matmul(weight.t())\n RuntimeError: mat1 dim 1 must match mat2 dim 0\n Epoch 0:   0%|          | 0/383 [00:00<?, ?it/s]\n </denchmark-code>\n \n This bug only happens if I add callback. I works fine for a few time(not sure if it is step, iterations ...), but then it gives input.shape=32,100352, weight.t().shape=8192,1024.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "FrankXinqi", "commentT": "2020-10-26T02:29:55Z", "comment_text": "\n \t\tThe above mentioned issue is with my customed datamodule. Here is a different issue with official CIFAR10.\n The issue seems to relate with CUDA, not sure if the problem is on my side.  Just to make it clear, all codes run well without callbacks passed in.\n <denchmark-code>GPU available: True, used: True\n TPU available: False, using: 0 TPU cores\n LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]\n Files already downloaded and verified\n Files already downloaded and verified\n \n   | Name                 | Type         | Params\n ------------------------------------------------------\n 0 | encoder              | ResNet       | 25 M  \n 1 | projection           | Projection   | 4 M   \n 2 | non_linear_evaluator | SSLEvaluator | 8 M   \n Epoch 0:   0%|          | 0/1562 [00:00<?, ?it/s] C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [0,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [1,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [4,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [8,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [9,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [11,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [12,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [14,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [15,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [20,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [24,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [26,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [27,0,0] Assertion `t >= 0 && t < n_classes` failed.\n C:/cb/pytorch_1000000000000/work/aten/src/THCUNN/ClassNLLCriterion.cu:108: block: [0,0,0], thread: [31,0,0] Assertion `t >= 0 && t < n_classes` failed.\n Traceback (most recent call last):\n   File \"H:/Project/PycharmProject/FER_Long-tailed/example/SimCLR.py\", line 36, in <module>\n     trainer.fit(model, dm)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\trainer.py\", line 440, in fit\n     results = self.accelerator_backend.train()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\accelerators\\gpu_accelerator.py\", line 54, in train\n     results = self.train_or_test()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\accelerators\\accelerator.py\", line 66, in train_or_test\n     results = self.trainer.train()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\trainer.py\", line 483, in train\n     self.train_loop.run_training_epoch()\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\training_loop.py\", line 557, in run_training_epoch\n     self.on_train_batch_end(epoch_output, epoch_end_outputs, batch, batch_idx, dataloader_idx)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\training_loop.py\", line 249, in on_train_batch_end\n     self.trainer.call_hook('on_train_batch_end', epoch_end_outputs, batch, batch_idx, dataloader_idx)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\trainer.py\", line 823, in call_hook\n     trainer_hook(*args, **kwargs)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\trainer\\callback_hook.py\", line 147, in on_train_batch_end\n     callback.on_train_batch_end(self, self.get_model(), outputs, batch, batch_idx, dataloader_idx)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pl_bolts\\callbacks\\ssl_online.py\", line 95, in on_train_batch_end\n     acc = accuracy(mlp_preds, y, num_classes=trainer.datamodule.num_classes)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\metrics\\functional\\classification.py\", line 286, in accuracy\n     tps, fps, tns, fns, sups = stat_scores_multiple_classes(\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\metrics\\functional\\classification.py\", line 197, in stat_scores_multiple_classes\n     num_classes = get_num_classes(pred=pred, target=target, num_classes=num_classes)\n   File \"F:\\Program\\Anaconda3\\envs\\pytorch-lightning\\lib\\site-packages\\pytorch_lightning\\metrics\\functional\\classification.py\", line 96, in get_num_classes\n     num_target_classes = int(target.max().detach().item() + 1)\n RuntimeError: CUDA error: device-side assert triggered\n Epoch 0:   0%|          | 0/1562 [00:00<?, ?it/s]\n </denchmark-code>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "FrankXinqi", "commentT": "2020-11-16T06:53:41Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/FrankXinqi>@FrankXinqi</denchmark-link>\n  what is the number of classes being passed to SSLOnlineEvaluator. What looks to me is the case when num_classes being passed is different than the class labels found in target tensor.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "FrankXinqi", "commentT": "2020-11-16T06:55:54Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/FrankXinqi>@FrankXinqi</denchmark-link>\n  for the first issue, I am merging a fix which should solve this issue. The output of resnet now is a flattened 2048 dimensional feature vector which is taken by the online evaluation callback.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "FrankXinqi", "commentT": "2020-11-16T07:42:56Z", "comment_text": "\n \t\t\n @FrankXinqi what is the number of classes being passed to SSLOnlineEvaluator. What looks to me is the case when num_classes being passed is different than the class labels found in target tensor.\n \n My cutomized dataset has 7 output classes. For CIFAR10, it put is as 10.  However, neither my own dataset or pl CIFAR10 do not work.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "FrankXinqi", "commentT": "2020-11-16T07:45:52Z", "comment_text": "\n \t\t\n @FrankXinqi for the first issue, I am merging a fix which should solve this issue. The output of resnet now is a flattened 2048 dimensional feature vector which is taken by the online evaluation callback.\n \n Many thanks. For the first issue, do you mean this issue \"RuntimeError: mat1 dim 1 must match mat2 dim 0\"?  If so, it may take some time to merge your PR to the master branch. Would you mind pointing out the solution, so I can fix it locally?\n Thx.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "FrankXinqi", "commentT": "2020-11-16T08:43:52Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/FrankXinqi>@FrankXinqi</denchmark-link>\n  changed quite a few things around, like a whole revamp of simclr, difficult to point to a single change.\n <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning-bolts/pull/329>#329</denchmark-link>\n \n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "FrankXinqi", "commentT": "2020-11-16T10:24:39Z", "comment_text": "\n \t\t\n @FrankXinqi changed quite a few things around, like a whole revamp of simclr, difficult to point to a single change.\n #329\n \n Thanks. Seems like there was a merge 14 days ago, but not recently. Wanna to know if I reinstall the lastest one from Github, will the problem be fixed?\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "FrankXinqi", "commentT": "2020-11-16T17:40:26Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/FrankXinqi>@FrankXinqi</denchmark-link>\n \n <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning-bolts/tree/fix/simclr>https://github.com/PyTorchLightning/pytorch-lightning-bolts/tree/fix/simclr</denchmark-link>\n \n This is the branch that will be merged. The PR will close this issue because we have removed all the complexity of SSLOnlineEvaluator callback. Feel free to open new issues based on the new code base if something doesn't work still.\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "FrankXinqi", "commentT": "2020-11-17T02:00:31Z", "comment_text": "\n \t\tThanks. I will try it later and response to this issue still, if there are other bugs met.\n \t\t"}}}, "commit": {"commit_id": "77ff983085cc4889b9cb5a439ec3eb2b2536599c", "commit_author": "Ananya Harsh Jha", "commitT": "2020-11-17 14:36:31-05:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.45901639344262296", "commit_Nprams": "0.907103825136612"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\source\\self_supervised_models.rst", "file_new_name": "docs\\source\\self_supervised_models.rst", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "277,293,314,317,318,319,320,324,325,326,327,328,329,330,331,332,333,334,335,336,434", "deleted_lines": "292,313,316,317,318,319,323,324,325,326,327,425"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pl_bolts\\callbacks\\ssl_online.py", "file_new_name": "pl_bolts\\callbacks\\ssl_online.py", "file_complexity": {"file_NLOC": "85", "file_CCN": "7", "file_NToken": "540"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "29", "deleted_lines": "33", "method_info": {"method_name": "__init__", "method_params": "self,str,float,None,int,int", "method_startline": "27", "method_endline": "33", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "37", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "29", "deleted_lines": "33", "method_info": {"method_name": "__init__", "method_params": "self,float,None,int,int,str", "method_startline": "27", "method_endline": "33", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "38", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "pl_bolts\\models\\self_supervised\\byol\\byol_module.py", "file_new_name": "pl_bolts\\models\\self_supervised\\byol\\byol_module.py", "file_complexity": {"file_NLOC": "163", "file_CCN": "13", "file_NToken": "1042"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "224", "deleted_lines": "223,224,225,226,227,228", "method_info": {"method_name": "cli_main", "method_params": "", "method_startline": "178", "method_endline": "228", "method_complexity": {"method_NLOC": "33", "method_CCN": "4", "method_NToken": "286", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "224", "deleted_lines": "223,224,225,226,227", "method_info": {"method_name": "cli_main.to_device", "method_params": "batch,device", "method_startline": "223", "method_endline": "227", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "36", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "108", "deleted_lines": "108", "method_info": {"method_name": "shared_step", "method_params": "self,batch,batch_idx", "method_startline": "107", "method_endline": "126", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "119", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pl_bolts\\models\\self_supervised\\byol\\models.py", "file_new_name": "pl_bolts\\models\\self_supervised\\byol\\models.py", "file_complexity": {"file_NLOC": "28", "file_CCN": "5", "file_NToken": "222"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "30,31", "method_info": {"method_name": "__init__", "method_params": "self,encoder", "method_startline": "23", "method_endline": "35", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "63", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "39,40", "method_info": {"method_name": "forward", "method_params": "self,x", "method_startline": "37", "method_endline": "43", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "64", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "pl_bolts\\models\\self_supervised\\resnets.py", "file_new_name": "pl_bolts\\models\\self_supervised\\resnets.py", "file_complexity": {"file_NLOC": "307", "file_CCN": "27", "file_NToken": "2042"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "135,136", "deleted_lines": "135,136", "method_info": {"method_name": "__init__", "method_params": "self,inplanes,planes,stride,downsample,groups,base_width,dilation,norm_layer", "method_startline": "135", "method_endline": "136", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "33", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "309", "deleted_lines": null, "method_info": {"method_name": "resnet101", "method_params": "bool,bool,kwargs", "method_startline": "301", "method_endline": "309", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "44", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "134,135,136,137,138,139,140,141,142,143,144,145,146", "deleted_lines": "134,135,136,137", "method_info": {"method_name": "__init__", "method_params": "self,block,layers,num_classes,zero_init_residual,groups,width_per_group,replace_stride_with_dilation,norm_layer,return_all_feature_maps,first_conv,maxpool1", "method_startline": "134", "method_endline": "146", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "44", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "177,178,179", "deleted_lines": "177,178,179", "method_info": {"method_name": "__init__", "method_params": "self,block,layers,num_classes,zero_init_residual,groups,width_per_group,replace_stride_with_dilation,norm_layer,return_all_feature_maps", "method_startline": "177", "method_endline": "179", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "37", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "253,254,255", "deleted_lines": null, "method_info": {"method_name": "forward", "method_params": "self,x", "method_startline": "234", "method_endline": "256", "method_complexity": {"method_NLOC": "19", "method_CCN": "2", "method_NToken": "144", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": null, "deleted_lines": "317,318,319,320,321,322,323,324,325", "method_info": {"method_name": "resnet50_bn", "method_params": "bool,bool,kwargs", "method_startline": "317", "method_endline": "325", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "44", "method_nesting_level": "0"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pl_bolts\\models\\self_supervised\\simclr\\simclr_finetuner.py", "file_new_name": "pl_bolts\\models\\self_supervised\\simclr\\simclr_finetuner.py", "file_complexity": {"file_NLOC": "142", "file_CCN": "5", "file_NToken": "935"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "17,22,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,41,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,66,67,68,70,71,72,73,74,75,78,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,96,97,98,99,100,101,102,103,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161", "deleted_lines": "16,17,19,20,22,23,25,27,28,29,30,31,34,37,39,40,41,43,44,45,46,47,49,50,51,52", "method_info": {"method_name": "cli_main", "method_params": "", "method_startline": "16", "method_endline": "162", "method_complexity": {"method_NLOC": "129", "method_CCN": "5", "method_NToken": "868", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 21, "file_old_name": "pl_bolts\\models\\self_supervised\\simclr\\simclr_module.py", "file_new_name": "pl_bolts\\models\\self_supervised\\simclr\\simclr_module.py", "file_complexity": {"file_NLOC": "360", "file_CCN": "40", "file_NToken": "2718"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "57", "deleted_lines": "57,58,59,60", "method_info": {"method_name": "__init__", "method_params": "self,input_dim,hidden_dim,output_dim", "method_startline": "50", "method_endline": "60", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "92", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314", "deleted_lines": null, "method_info": {"method_name": "nt_xent_loss", "method_params": "self,out_1,out_2,temperature,eps", "method_startline": "279", "method_endline": "316", "method_complexity": {"method_NLOC": "18", "method_CCN": "3", "method_NToken": "227", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "57", "deleted_lines": "57,58,59,60,61,62,63,64", "method_info": {"method_name": "__init__", "method_params": "self,int,int,int,float,float,float,kwargs", "method_startline": "57", "method_endline": "64", "method_complexity": {"method_NLOC": "8", "method_CCN": "1", "method_NToken": "46", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "168,170,171,173,174,175,177,178,179,181,183,186,188", "deleted_lines": "168,169,170,171,172,173,174,175,177,178,179,180,182,183,184,185,186,188", "method_info": {"method_name": "shared_step", "method_params": "self,batch,batch_idx", "method_startline": "168", "method_endline": "190", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "90", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "246,247,248,249,250,251,252,253,254,255", "deleted_lines": "246,247,249,250,251,252,253", "method_info": {"method_name": "optimizer_step", "method_params": "self,int,int,Optimizer,int,None,bool,bool,bool", "method_startline": "246", "method_endline": "255", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "47", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "83,84,85,86,87,88,89,90,91", "deleted_lines": "83,84,85,86,87,88,89,90,91,92,94", "method_info": {"method_name": "init_encoder", "method_params": "self", "method_startline": "83", "method_endline": "94", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "43", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "113,114,115", "deleted_lines": "113,114,115", "method_info": {"method_name": "setup", "method_params": "self,stage", "method_startline": "113", "method_endline": "115", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "30", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355", "deleted_lines": null, "method_info": {"method_name": "add_model_specific_args", "method_params": "parent_parser", "method_startline": "319", "method_endline": "357", "method_complexity": {"method_NLOC": "30", "method_CCN": "1", "method_NToken": "466", "method_nesting_level": "1"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "362,363,371,372,373,374,375,376,382,383,384,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,460,461,462,463,464,465,466,467,468,469,471,472,473,474,475,476,477,478,479,480,481", "deleted_lines": null, "method_info": {"method_name": "cli_main", "method_params": "", "method_startline": "360", "method_endline": "483", "method_complexity": {"method_NLOC": "99", "method_CCN": "11", "method_NToken": "606", "method_nesting_level": "0"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244", "deleted_lines": "214,221,225,226,227,232,233,234,235,236,237,239,240", "method_info": {"method_name": "configure_optimizers", "method_params": "self", "method_startline": "214", "method_endline": "244", "method_complexity": {"method_NLOC": "28", "method_CCN": "5", "method_NToken": "124", "method_nesting_level": "1"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "197,198,199,201,202,203,204,205,206,207,209,210,211,212", "deleted_lines": "197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212", "method_info": {"method_name": "exclude_from_wt_decay", "method_params": "self,named_params,weight_decay,skip_list", "method_startline": "197", "method_endline": "212", "method_complexity": {"method_NLOC": "14", "method_CCN": "5", "method_NToken": "88", "method_nesting_level": "1"}}}, "hunk_11": {"Ismethod": 1, "added_lines": "161,162,163", "deleted_lines": "163", "method_info": {"method_name": "forward", "method_params": "self,x", "method_startline": "161", "method_endline": "163", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "18", "method_nesting_level": "1"}}}, "hunk_12": {"Ismethod": 1, "added_lines": "151,152,153,154,155,157,158", "deleted_lines": "151,152,153,154,157,159", "method_info": {"method_name": "init_model", "method_params": "self", "method_startline": "151", "method_endline": "159", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "44", "method_nesting_level": "1"}}}, "hunk_13": {"Ismethod": 1, "added_lines": "192,194", "deleted_lines": "195", "method_info": {"method_name": "validation_step", "method_params": "self,batch,batch_idx", "method_startline": "191", "method_endline": "195", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "35", "method_nesting_level": "1"}}}, "hunk_14": {"Ismethod": 1, "added_lines": "186,188", "deleted_lines": "185,186,188", "method_info": {"method_name": "training_step", "method_params": "self,batch,batch_idx", "method_startline": "185", "method_endline": "189", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "35", "method_nesting_level": "1"}}}, "hunk_15": {"Ismethod": 1, "added_lines": "165,166,167,168,170,171,173,174,175,177,178,179,181,183", "deleted_lines": "165,168,169,170,171,172,173,174,175,177,178,179,180,182,183", "method_info": {"method_name": "shared_step", "method_params": "self,batch", "method_startline": "165", "method_endline": "183", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "78", "method_nesting_level": "1"}}}, "hunk_16": {"Ismethod": 1, "added_lines": "27,28,30,31,32,34,35,37", "deleted_lines": "27,29,30,31,32,33", "method_info": {"method_name": "forward", "method_params": "ctx,tensor", "method_startline": "27", "method_endline": "37", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "62", "method_nesting_level": "1"}}}, "hunk_17": {"Ismethod": 1, "added_lines": "258,259,260,261,262", "deleted_lines": "258,259,260,261,262", "method_info": {"method_name": "cli_main.to_device", "method_params": "batch,device", "method_startline": "258", "method_endline": "262", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "36", "method_nesting_level": "1"}}}, "hunk_18": {"Ismethod": 1, "added_lines": "25,26,27", "deleted_lines": "24,25,26,27", "method_info": {"method_name": "__init__", "method_params": "self", "method_startline": "24", "method_endline": "27", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "34", "method_nesting_level": "1"}}}, "hunk_19": {"Ismethod": 1, "added_lines": "68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90", "deleted_lines": "77,78,79,80,81,82,83,84,85,86,87,88,89,90", "method_info": {"method_name": "__init__", "method_params": "self,int,int,int,str,int,str,int,int,int,int,float,bool,bool,str,bool,bool,float,float,float,float,kwargs", "method_startline": "68", "method_endline": "90", "method_complexity": {"method_NLOC": "23", "method_CCN": "1", "method_NToken": "126", "method_nesting_level": "1"}}}, "hunk_20": {"Ismethod": 1, "added_lines": "40,41,42,43,44,45,46", "deleted_lines": "44,45,46", "method_info": {"method_name": "backward", "method_params": "ctx,grad_output", "method_startline": "40", "method_endline": "46", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "67", "method_nesting_level": "1"}}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "pl_bolts\\models\\self_supervised\\simclr\\transforms.py", "file_new_name": "pl_bolts\\models\\self_supervised\\simclr\\transforms.py", "file_complexity": {"file_NLOC": "168", "file_CCN": "8", "file_NToken": "852"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "191,194,197", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,kernel_size,p,min,max", "method_startline": "191", "method_endline": "197", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "45", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "97,101", "deleted_lines": "97,98,99,100", "method_info": {"method_name": "__call__", "method_params": "self,sample", "method_startline": "95", "method_endline": "101", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "35", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "108,109,110,111,112,113", "method_info": {"method_name": "__init__", "method_params": "self,int,float,float", "method_startline": "108", "method_endline": "117", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "49", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "40,41,42,43,44,45", "deleted_lines": "40", "method_info": {"method_name": "__init__", "method_params": "self,int,bool,float,normalize", "method_startline": "40", "method_endline": "45", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "26", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "40,41,42,43,44,45,46,47,53,55", "deleted_lines": "40,46,48,49,50,51,52,53,54,55", "method_info": {"method_name": "__init__", "method_params": "self,int,int", "method_startline": "40", "method_endline": "55", "method_complexity": {"method_NLOC": "15", "method_CCN": "2", "method_NToken": "150", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "145,146,147,148,149,150", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,int,float,normalize,bool", "method_startline": "145", "method_endline": "150", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "26", "method_nesting_level": "1"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pl_bolts\\models\\self_supervised\\swav\\swav_finetuner.py", "file_new_name": "pl_bolts\\models\\self_supervised\\swav\\swav_finetuner.py", "file_complexity": {"file_NLOC": "114", "file_CCN": "4", "file_NToken": "801"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "60,61,62,63,64", "deleted_lines": null, "method_info": {"method_name": "cli_main", "method_params": "", "method_startline": "12", "method_endline": "133", "method_complexity": {"method_NLOC": "105", "method_CCN": "4", "method_NToken": "738", "method_nesting_level": "0"}}}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "pl_bolts\\models\\self_supervised\\swav\\swav_module.py", "file_new_name": "pl_bolts\\models\\self_supervised\\swav\\swav_module.py", "file_complexity": {"file_NLOC": "455", "file_CCN": "56", "file_NToken": "3695"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "33", "deleted_lines": "30", "method_info": {"method_name": "__init__", "method_params": "self,int,int,int,str,int,str,int,int,int,int,int,int,float,int,int,str,int,list,list,bool,bool,str,bool,bool,float,float,float,float,float,kwargs", "method_startline": "27", "method_endline": "58", "method_complexity": {"method_NLOC": "32", "method_CCN": "1", "method_NToken": "190", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "33", "deleted_lines": "30", "method_info": {"method_name": "__init__", "method_params": "self,int,int,int,int,str,str,int,int,int,int,int,int,float,int,int,str,int,list,list,bool,bool,str,bool,bool,float,float,float,float,float,kwargs", "method_startline": "27", "method_endline": "58", "method_complexity": {"method_NLOC": "32", "method_CCN": "1", "method_NToken": "188", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "447", "deleted_lines": "447", "method_info": {"method_name": "add_model_specific_args", "method_params": "parent_parser", "method_startline": "414", "method_endline": "477", "method_complexity": {"method_NLOC": "52", "method_CCN": "1", "method_NToken": "730", "method_nesting_level": "1"}}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\models\\self_supervised\\test_models.py", "file_new_name": "tests\\models\\self_supervised\\test_models.py", "file_complexity": {"file_NLOC": "101", "file_CCN": "6", "file_NToken": "843"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "83", "deleted_lines": "83", "method_info": {"method_name": "test_simclr", "method_params": "tmpdir,datadir", "method_startline": "76", "method_endline": "88", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "109", "method_nesting_level": "0"}}}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tests\\models\\self_supervised\\test_scripts.py", "file_new_name": "tests\\models\\self_supervised\\test_scripts.py", "file_complexity": {"file_NLOC": "57", "file_CCN": "12", "file_NToken": "412"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "48,49", "deleted_lines": "48"}}}}}}