{"BR": {"BR_id": "2755", "BR_author": "anyj0527", "BRopenT": "2020-09-21T08:02:38Z", "BRcloseT": "2020-11-02T11:03:43Z", "BR_text": {"BRsummary": "[Android/tflite] Failed to invoke tflite model with nnapi.", "BRdescription": "\n The test  keeps failing by crash.\n (<denchmark-link:https://github.com/nnstreamer/nnstreamer/blob/for-next/api/android/api/src/androidTest/java/org/nnsuite/nnstreamer/APITestSingleShot.java#L272>https://github.com/nnstreamer/nnstreamer/blob/for-next/api/android/api/src/androidTest/java/org/nnsuite/nnstreamer/APITestSingleShot.java#L272</denchmark-link>\n )\n Currently, tflite (1.13.1) utilizes nnapi by default: \n (<denchmark-link:https://github.com/nnstreamer/nnstreamer/blob/master/ext/nnstreamer/tensor_filter/tensor_filter_tensorflow_lite.cc#L574>https://github.com/nnstreamer/nnstreamer/blob/master/ext/nnstreamer/tensor_filter/tensor_filter_tensorflow_lite.cc#L574</denchmark-link>\n )\n If I modify this line with use_nnapi = FALSE;, the failures do not occur.\n This may be related with file access permission.\n Test failure log:\n <denchmark-code>...\n 2020-09-21 16:03:25.046 4220-4323/? D/nnstreamer: Framework = tensorflow-lite\n 2020-09-21 16:03:25.046 4220-4323/? I/GLib: nnapi = 1, accl = cpu\n 2020-09-21 16:03:25.047 684-684/? D/keymaster_swd: keymaster_swd [WRN] (swd_run_cb:249) swd_finish() returns 0\n 2020-09-21 16:03:25.047 4220-4323/? W/nnstreamer: The number of tensor name is mismatched in filter.\n 2020-09-21 16:03:25.047 4220-4323/? W/nnstreamer: The number of tensor name is mismatched in filter.\n 2020-09-21 16:03:25.047 1053-4566/? D/keystore: [FINISH::end]\n 2020-09-21 16:03:25.048 4220-4323/? E/NeuralNetworks: SecFeature = 3\n 2020-09-21 16:03:25.050 4220-4323/? D/NativeHcmServiceManager: [NativeHcm] BpSemHcmManager::BpSemHcmManager()\n 2020-09-21 16:03:25.050 1055-12636/? I/HcmInfo::HcmManagerService: ctc pid=4220, uid=10131, Package Name:org.nnsuite.nnstreamer.test\n 2020-09-21 16:03:25.051 1055-2553/? D/CustomFrequencyManagerService: acquireDVFSLockLocked : type : DVFS_MIN_LIMIT  frequency : 2457600  uid : 1000  pid : 1055  pkgName : hcm@81\n 2020-09-21 16:03:25.060 4220-4323/? I/TypeManager: Failed to read /vendor/etc/nnapi_extensions_app_allowlist ; No app allowlisted for vendor extensions use.\n 2020-09-21 16:03:25.061 4220-4323/? E/nnstreamer.tes: getSupportedOperations_1_2 failure: Status(EX_TRANSACTION_FAILED): 'FAILED_TRANSACTION: '\n 2020-09-21 16:03:25.061 4220-4323/? E/Manager: IDevice::getSupportedOperations returned the error GENERAL_FAILURE\n 2020-09-21 16:03:25.061 4220-4323/? E/nnstreamer.tes: getSupportedOperations_1_2 failure: Status(EX_TRANSACTION_FAILED): 'FAILED_TRANSACTION: '\n 2020-09-21 16:03:25.061 4220-4323/? E/Manager: IDevice::getSupportedOperations returned the error GENERAL_FAILURE\n 2020-09-21 16:03:25.061 747-747/? E/audit: type=1400 audit(1600671805.056:101959): avc:  denied  { read } for  pid=4220 comm=\"roidJUnitRunner\" path=\"/storage/emulated/0/nnstreamer/test/add/add.tflite\" dev=\"sdcardfs\" ino=23663 scontext=u:r:hal_neuralnetworks_default:s0 tcontext=u:object_r:sdcardfs:s0 tclass=file permissive=0 SEPF_SM-G981N_10_0021 audit_filtered\n 2020-09-21 16:03:25.061 4220-4323/? E/nnstreamer.tes: getSupportedOperations_1_2 failure: Status(EX_TRANSACTION_FAILED): 'FAILED_TRANSACTION: '\n 2020-09-21 16:03:25.061 747-747/? E/audit: type=1300 audit(1600671805.056:101959): arch=c00000b7 syscall=29 success=yes exit=0 a0=43 a1=c0306201 a2=7c679f03a0 a3=7c679f06a0 items=0 ppid=765 pid=4220 auid=4294967295 uid=10131 gid=10131 euid=10131 suid=10131 fsuid=10131 egid=10131 sgid=10131 fsgid=10131 tty=(none) ses=4294967295 comm=\"roidJUnitRunner\" exe=\"/system/bin/app_process64\" subj=u:r:untrusted_app_27:s0:c131,c256,c512,c768 key=(null)\n 2020-09-21 16:03:25.061 4220-4323/? E/Manager: IDevice::getSupportedOperations returned the error GENERAL_FAILURE\n 2020-09-21 16:03:25.061 747-747/? E/audit: type=1327 audit(1600671805.056:101959): proctitle=\"org.nnsuite.nnstreamer.test\"\n 2020-09-21 16:03:25.061 4220-4323/? E/nnstreamer.tes: getSupportedOperations_1_2 failure: Status(EX_TRANSACTION_FAILED): 'FAILED_TRANSACTION: '\n 2020-09-21 16:03:25.062 4220-4323/? E/Manager: IDevice::getSupportedOperations returned the error GENERAL_FAILURE\n 2020-09-21 16:03:25.062 747-747/? E/audit: type=1400 audit(1600671805.056:101960): avc:  denied  { read } for  pid=4220 comm=\"roidJUnitRunner\" path=\"/storage/emulated/0/nnstreamer/test/add/add.tflite\" dev=\"sdcardfs\" ino=23663 scontext=u:r:hal_neuralnetworks_default:s0 tcontext=u:object_r:sdcardfs:s0 tclass=file permissive=0 SEPF_SM-G981N_10_0021 audit_filtered\n 2020-09-21 16:03:25.062 747-747/? E/audit: type=1300 audit(1600671805.056:101960): arch=c00000b7 syscall=29 success=yes exit=0 a0=43 a1=c0306201 a2=7c679f03a0 a3=7c679f06a0 items=0 ppid=765 pid=4220 auid=4294967295 uid=10131 gid=10131 euid=10131 suid=10131 fsuid=10131 egid=10131 sgid=10131 fsgid=10131 tty=(none) ses=4294967295 comm=\"roidJUnitRunner\" exe=\"/system/bin/app_process64\" subj=u:r:untrusted_app_27:s0:c131,c256,c512,c768 key=(null)\n 2020-09-21 16:03:25.062 747-747/? E/audit: type=1327 audit(1600671805.056:101960): proctitle=\"org.nnsuite.nnstreamer.test\"\n 2020-09-21 16:03:25.062 747-747/? E/audit: type=1400 audit(1600671805.056:101961): avc:  denied  { read } for  pid=4220 comm=\"roidJUnitRunner\" path=\"/storage/emulated/0/nnstreamer/test/add/add.tflite\" dev=\"sdcardfs\" ino=23663 scontext=u:r:hal_neuralnetworks_default:s0 tcontext=u:object_r:sdcardfs:s0 tclass=file permissive=0 SEPF_SM-G981N_10_0021 audit_filtered\n \n ...\n \n 2020-09-21 16:03:25.093 4220-4323/? E/ExecutionBuilder: Setting argument with invalid length: 8, expected length: 4\n 2020-09-21 16:03:25.093 4220-4323/? E/tflite: Aborting since NNAPI returned failure nnapi_delegate.cc:805\n \n ...\n \n 2020-09-21 16:03:25.111 1055-11453/? I/ActivityManager: Process org.nnsuite.nnstreamer.test (pid 4220) has died: fore FGS (2707,4407)\n 2020-09-21 16:03:25.112 1055-11453/? W/ActivityManager: Crash of app org.nnsuite.nnstreamer.test running instrumentation ComponentInfo{org.nnsuite.nnstreamer.test/android.support.test.runner.AndroidJUnitRunner}\n 2020-09-21 16:03:25.112 1055-11453/? I/ActivityManager: Force stopping org.nnsuite.nnstreamer.test appid=10131 user=0: finished inst\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "anyj0527", "commentT": "2020-09-21T08:02:40Z", "comment_text": "\n \t\t : Thank you for posting issue <denchmark-link:https://github.com/nnstreamer/nnstreamer/issues/2755>#2755</denchmark-link>\n . The person in charge will reply soon.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "anyj0527", "commentT": "2020-09-24T05:13:23Z", "comment_text": "\n \t\tWith tflite v1.15.2 and v2.3.0, the test does not crash but give unexpected return value:\n expected: 3.5f, but was : 0.0f\n <denchmark-code>2020-09-24 16:13:15.517 13086-13131/org.nnsuite.nnstreamer.test I/nnstreamer: NNStreamer 1.7.0 GStreamer 1.16.2 GLib 2.56.1\n 2020-09-24 16:13:15.519 13086-13131/org.nnsuite.nnstreamer.test D/nnstreamer: Framework = tensorflow-lite\n 2020-09-24 16:13:15.519 13086-13131/org.nnsuite.nnstreamer.test I/GLib: nnapi = 1, accl = cpu\n 2020-09-24 16:13:15.519 13086-13131/org.nnsuite.nnstreamer.test I/tflite: Initialized TensorFlow Lite runtime.\n 2020-09-24 16:13:15.519 13086-13131/org.nnsuite.nnstreamer.test I/GLib: Model is loaded: 208\n 2020-09-24 16:13:15.519 13086-13131/org.nnsuite.nnstreamer.test I/GLib: tensorMeta[0] >> type:7, dim[1:1:1:1]\n 2020-09-24 16:13:15.519 13086-13131/org.nnsuite.nnstreamer.test I/GLib: tensorMeta[0] >> type:7, dim[1:1:1:1]\n 2020-09-24 16:13:15.519 13086-13131/org.nnsuite.nnstreamer.test W/nnstreamer: The number of tensor name is mismatched in filter.\n 2020-09-24 16:13:15.519 13086-13131/org.nnsuite.nnstreamer.test W/nnstreamer: The number of tensor name is mismatched in filter.\n 2020-09-24 16:13:15.519 13086-13131/org.nnsuite.nnstreamer.test I/GLib: tensorMeta[0] >> type:7, dim[1:1:1:1]\n 2020-09-24 16:13:15.519 13086-13131/org.nnsuite.nnstreamer.test I/GLib: tensorMeta[0] >> type:7, dim[1:1:1:1]\n 2020-09-24 16:13:15.520 13086-13131/org.nnsuite.nnstreamer.test W/nnstreamer-tflite: The ptr of input tensor before invoke: 0x7c08530060\n 2020-09-24 16:13:15.520 13086-13131/org.nnsuite.nnstreamer.test I/tflite: Created TensorFlow Lite delegate for NNAPI.\n 2020-09-24 16:13:15.521 13086-13131/org.nnsuite.nnstreamer.test I/Manager: DeviceManager::DeviceManager\n 2020-09-24 16:13:15.521 13086-13131/org.nnsuite.nnstreamer.test I/Manager: findAvailableDevices\n 2020-09-24 16:13:15.521 13086-13131/org.nnsuite.nnstreamer.test I/Manager: Found interface qti-default\n 2020-09-24 16:13:15.522 13086-13131/org.nnsuite.nnstreamer.test I/Manager: Capab {.relaxedFloat32toFloat16PerformanceScalar = {.execTime = 0.600000, .powerUsage = 0.800000}, .relaxedFloat32toFloat16PerformanceTensor = {.execTime = 0.600000, .powerUsage = 0.800000}, .operandPerformance = [16]{{.type = FLOAT32, .info = {.execTime = 0.600000, .powerUsage = 0.800000}}, {.type = INT32, .info = {.execTime = 0.600000, .powerUsage = 0.800000}}, {.type = UINT32, .info = {.execTime = 0.600000, .powerUsage = 0.800000}}, {.type = TENSOR_FLOAT32, .info = {.execTime = 0.600000, .powerUsage = 0.800000}}, {.type = TENSOR_INT32, .info = {.execTime = 0.600000, .powerUsage = 0.800000}}, {.type = TENSOR_QUANT8_ASYMM, .info = {.execTime = 0.700000, .powerUsage = 0.700000}}, {.type = BOOL, .info = {.execTime = 0.600000, .powerUsage = 0.800000}}, {.type = TENSOR_QUANT16_SYMM, .info = {.execTime = 0.700000, .powerUsage = 0.700000}}, {.type = TENSOR_FLOAT16, .info = {.execTime = 0.600000, .powerUsage = 0.800000}}, {.type = TENSOR_BOOL8, .info = {.execTime = 0.600000, .powerUsage = 0.800000}}, {.type = FLOA\n 2020-09-24 16:13:15.522 13086-13131/org.nnsuite.nnstreamer.test I/Manager: Found interface qti-dsp\n 2020-09-24 16:13:15.527 13086-13131/org.nnsuite.nnstreamer.test I/Manager: Capab {.relaxedFloat32toFloat16PerformanceScalar = {.execTime = 2.000000, .powerUsage = 2.000000}, .relaxedFloat32toFloat16PerformanceTensor = {.execTime = 2.000000, .powerUsage = 2.000000}, .operandPerformance = [16]{{.type = FLOAT32, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = INT32, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = UINT32, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_FLOAT32, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_INT32, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_QUANT8_ASYMM, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = BOOL, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_QUANT16_SYMM, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = TENSOR_FLOAT16, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_BOOL8, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = FLOA\n 2020-09-24 16:13:15.527 13086-13131/org.nnsuite.nnstreamer.test I/Manager: Found interface qti-gpu\n 2020-09-24 16:13:15.529 13086-13131/org.nnsuite.nnstreamer.test I/Manager: Capab {.relaxedFloat32toFloat16PerformanceScalar = {.execTime = 1.100000, .powerUsage = 1.100000}, .relaxedFloat32toFloat16PerformanceTensor = {.execTime = 1.100000, .powerUsage = 1.100000}, .operandPerformance = [16]{{.type = FLOAT32, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = INT32, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = UINT32, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = TENSOR_FLOAT32, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = TENSOR_INT32, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = TENSOR_QUANT8_ASYMM, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = BOOL, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = TENSOR_QUANT16_SYMM, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_FLOAT16, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = TENSOR_BOOL8, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = FLOA\n 2020-09-24 16:13:15.529 13086-13131/org.nnsuite.nnstreamer.test I/Manager: Found interface qti-hta\n 2020-09-24 16:13:15.530 13086-13131/org.nnsuite.nnstreamer.test I/Manager: Capab {.relaxedFloat32toFloat16PerformanceScalar = {.execTime = 2.000000, .powerUsage = 2.000000}, .relaxedFloat32toFloat16PerformanceTensor = {.execTime = 2.000000, .powerUsage = 2.000000}, .operandPerformance = [16]{{.type = FLOAT32, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = INT32, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = UINT32, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_FLOAT32, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_INT32, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_QUANT8_ASYMM, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = BOOL, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_QUANT16_SYMM, .info = {.execTime = 1.100000, .powerUsage = 1.100000}}, {.type = TENSOR_FLOAT16, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = TENSOR_BOOL8, .info = {.execTime = 2.000000, .powerUsage = 2.000000}}, {.type = FLOA\n 2020-09-24 16:13:15.532 13086-13131/org.nnsuite.nnstreamer.test E/NeuralNetworks: SecFeature = 3\n 2020-09-24 16:13:15.534 13086-13131/org.nnsuite.nnstreamer.test D/NativeHcmServiceManager: [NativeHcm] BpSemHcmManager::BpSemHcmManager()\n 2020-09-24 16:13:15.534 1055-10001/? I/HcmInfo::HcmManagerService: ctc pid=13086, uid=10460, Package Name:org.nnsuite.nnstreamer.test\n 2020-09-24 16:13:15.534 13086-13131/org.nnsuite.nnstreamer.test I/ModelBuilder: setOperandValueFromMemory for operand 1 offset 116 size 4\n 2020-09-24 16:13:15.534 13086-13131/org.nnsuite.nnstreamer.test I/TypeManager: TypeManager::TypeManager\n 2020-09-24 16:13:15.534 13086-13131/org.nnsuite.nnstreamer.test I/TypeManager: Failed to read /vendor/etc/nnapi_extensions_app_allowlist ; No app allowlisted for vendor extensions use.\n 2020-09-24 16:13:15.536 13086-13131/org.nnsuite.nnstreamer.test I/TypeManager: NNAPI Vendor extensions enabled: 0\n 2020-09-24 16:13:15.536 13086-13131/org.nnsuite.nnstreamer.test I/Memory: add()\n 2020-09-24 16:13:15.536 13086-13131/org.nnsuite.nnstreamer.test I/Memory: It's new\n 2020-09-24 16:13:15.536 13086-13131/org.nnsuite.nnstreamer.test I/ModelBuilder: setOperandValue for operand 2 size 4\n 2020-09-24 16:13:15.536 13086-13131/org.nnsuite.nnstreamer.test I/ModelBuilder: Copied small value to offset 0\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/ModelBuilder: copyLargeValuesToSharedMemory has 0 values.\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump: // ModelBuilder::finish\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump: digraph {\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump:     d0 [style=filled fillcolor=black fontcolor=white label=\"0\\nTF32(1x1x1x1)\"]\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump:     d1 [label=\"1: REF\\nTF32(1)\"]\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump:     d2 [label=\"2: COPY\\nI32 = 0\"]\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump:     d3 [style=filled fillcolor=black fontcolor=white label=\"3\\nTF32(1x1x1x1)\"]\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump:     n0 [shape=box ordering=in label=\"0: ADD\"]\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump:     d0 -> n0 [label=0]\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump:     d1 -> n0 [label=1]\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump:     d2 -> n0 [label=2]\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump:     n0 -> d3\n 2020-09-24 16:13:15.537 13086-13131/org.nnsuite.nnstreamer.test I/GraphDump: }\n 2020-09-24 16:13:15.538 13086-13131/org.nnsuite.nnstreamer.test I/CompilationBuilder: CompilationBuilder::CompilationBuilder\n 2020-09-24 16:13:15.538 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionPlan: ModelBuilder::partitionTheWork: deviceCount = 5, operationCount = 1\n 2020-09-24 16:13:15.538 13086-13131/org.nnsuite.nnstreamer.test E/nnstreamer.tes: getSupportedOperations_1_2 failure: Status(EX_TRANSACTION_FAILED): 'FAILED_TRANSACTION: '\n 2020-09-24 16:13:15.538 13086-13131/org.nnsuite.nnstreamer.test E/Manager: IDevice::getSupportedOperations returned the error GENERAL_FAILURE\n 2020-09-24 16:13:15.538 13086-13131/org.nnsuite.nnstreamer.test E/nnstreamer.tes: getSupportedOperations_1_2 failure: Status(EX_TRANSACTION_FAILED): 'FAILED_TRANSACTION: '\n 2020-09-24 16:13:15.538 13086-13131/org.nnsuite.nnstreamer.test E/Manager: IDevice::getSupportedOperations returned the error GENERAL_FAILURE\n 2020-09-24 16:13:15.538 13086-13131/org.nnsuite.nnstreamer.test E/nnstreamer.tes: getSupportedOperations_1_2 failure: Status(EX_TRANSACTION_FAILED): 'FAILED_TRANSACTION: '\n 2020-09-24 16:13:15.538 13086-13131/org.nnsuite.nnstreamer.test E/Manager: IDevice::getSupportedOperations returned the error GENERAL_FAILURE\n 2020-09-24 16:13:15.538 13086-13131/org.nnsuite.nnstreamer.test E/nnstreamer.tes: getSupportedOperations_1_2 failure: Status(EX_TRANSACTION_FAILED): 'FAILED_TRANSACTION: '\n 2020-09-24 16:13:15.538 13086-13131/org.nnsuite.nnstreamer.test E/Manager: IDevice::getSupportedOperations returned the error GENERAL_FAILURE\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionPlan: Device qti-default can't do operation ADD\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionPlan: Device qti-dsp can't do operation ADD\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionPlan: Device qti-gpu can't do operation ADD\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionPlan: Device qti-hta can't do operation ADD\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionPlan: ModelBuilder::findBestDeviceForEachOperation(ADD) = 4 (nnapi-reference)\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionPlan: ModelBuilder::partitionTheWork: only one best device: 4 = nnapi-reference\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionPlan: ExecutionPlan::SimpleBody::finish, compilation\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionBuilder: ExecutionBuilder::ExecutionBuilder\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/Memory: add()\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/Memory: It's new\n 2020-09-24 16:13:15.539 747-747/? E/audit: type=1400 audit(1600931595.534:146712): avc:  denied  { read } for  pid=13086 comm=\"roidJUnitRunner\" path=\"/storage/emulated/0/nnstreamer/test/add/add.tflite\" dev=\"sdcardfs\" ino=23663 scontext=u:r:hal_neuralnetworks_default:s0 tcontext=u:object_r:sdcardfs:s0 tclass=file permissive=0 SEPF_SM-G981N_10_0021 audit_filtered\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/Memory: add()\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/Memory: It's new\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionBuilder: ExecutionBuilder::compute (synchronous API)\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionBuilder: ExecutionBuilder::compute (from plan, iteratively)\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionBuilder: looking for next StepExecutor\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionPlan: ExecutionPlan::next(): mNextStepIndex = 0\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionBuilder: input[0] = MEMORY(pool=0, off=0)\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionBuilder: output[0] = MEMORY(pool=1, off=0)\n 2020-09-24 16:13:15.539 747-747/? E/audit: type=1327 audit(1600931595.534:146712): proctitle=\"org.nnsuite.nnstreamer.test\"\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/CpuExecutor: CpuExecutor::run() with request()\n 2020-09-24 16:13:15.539 747-747/? E/audit: type=1400 audit(1600931595.538:146713): avc:  denied  { read } for  pid=13086 comm=\"roidJUnitRunner\" path=\"/storage/emulated/0/nnstreamer/test/add/add.tflite\" dev=\"sdcardfs\" ino=23663 scontext=u:r:hal_neuralnetworks_default:s0 tcontext=u:object_r:sdcardfs:s0 tclass=file permissive=0 SEPF_SM-G981N_10_0021 audit_filtered\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/CpuExecutor: CpuExecutor::initializeRunTimeInfo\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/CpuExecutor: Completed run normally\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionBuilder: looking for next StepExecutor\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/ExecutionPlan: ExecutionPlan::next(): mNextStepIndex = 1\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test W/nnstreamer-tflite: The ptr of input tensor before invoke: 0x7c08530060\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test E/GLib: Invoke() is finished: 19185\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/TestRunner: failed: testInvokeDynamicTFLite(org.nnsuite.nnstreamer.APITestSingleShot)\n 2020-09-24 16:13:15.539 13086-13131/org.nnsuite.nnstreamer.test I/TestRunner: ----- begin exception -----\n 2020-09-24 16:13:15.540 13086-13131/org.nnsuite.nnstreamer.test I/TestRunner: java.lang.AssertionError: expected:<3.5> but was:<0.0>\n         at org.junit.Assert.fail(Assert.java:88)\n         at org.junit.Assert.failNotEquals(Assert.java:834)\n         at org.junit.Assert.assertEquals(Assert.java:575)\n         at org.junit.Assert.assertEquals(Assert.java:700)\n         at org.nnsuite.nnstreamer.APITestSingleShot.runInvokeDynamic(APITestSingleShot.java:259)\n         at org.nnsuite.nnstreamer.APITestSingleShot.testInvokeDynamicTFLite(APITestSingleShot.java:278)\n         at java.lang.reflect.Method.invoke(Native Method)\n         at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n         at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n         at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\n         at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n         at android.support.test.internal.runner.junit4.statement.RunBefores.evaluate(RunBefores.java:80)\n         at android.support.test.rule.GrantPermissionRule$RequestPermissionStatement.evaluate(GrantPermissionRule.java:129)\n         at org.junit.rules.RunRules.evaluate(RunRules.java:20)\n         at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\n         at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\n         at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\n         at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n         at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n         at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n         at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n         at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n         at org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n         at android.support.test.runner.AndroidJUnit4.run(AndroidJUnit4.java:101)\n         at org.junit.runners.Suite.runChild(Suite.java:128)\n         at org.junit.runners.Suite.runChild(Suite.java:27)\n         at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n         at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n         at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n         at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n         at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n         at org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n         at org.junit.runner.JUnitCore.run(JUnitCore.java:137)\n         at org.junit.runner.JUnitCore.run(JUnitCore.java:115)\n         at android.support.test.internal.runner.TestExecutor.execute(TestExecutor.java:56)\n         at android.support.test.runner.AndroidJUnitRunner.onStart(AndroidJUnitRunner.java:384)\n         at android.app.Instrumentation$InstrumentationThread.run(Instrumentation.java:2214)\n 2020-09-24 16:13:15.540 13086-13131/org.nnsuite.nnstreamer.test I/TestRunner: ----- end exception -----\n 2020-09-24 16:13:15.540 13086-13131/org.nnsuite.nnstreamer.test I/TestRunner: finished: testInvokeDynamicTFLite(org.nnsuite.nnstreamer.APITestSingleShot)\n </denchmark-code>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "anyj0527", "commentT": "2020-09-28T07:04:06Z", "comment_text": "\n \t\ttflite v1.13.1 does not support resize for nnapi delegate (<denchmark-link:https://github.com/tensorflow/tensorflow/blob/v1.13.1/tensorflow/lite/delegates/nnapi/nnapi_delegate_test.cc#L107>https://github.com/tensorflow/tensorflow/blob/v1.13.1/tensorflow/lite/delegates/nnapi/nnapi_delegate_test.cc#L107</denchmark-link>\n ).\n So the test testInvokeDynamicTFLite() should fail because it calls ResizeInputTensor which does not supported.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "anyj0527", "commentT": "2020-09-28T07:05:05Z", "comment_text": "\n \t\tStill need to figure out why nnapi does not operate correctly with tflite v1.15.2 and v2.3.0\n \t\t"}}}, "commit": {"commit_id": "eb20de7221f58702b253d40d9c53e8ec26767f5d", "commit_author": "Yongjoo Ahn", "commitT": "2020-11-02 20:03:42+09:00", "commit_complexity": {"commit_NLOC": "0.09090909090909091", "commit_CCN": "0.09090909090909091", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "ext\\nnstreamer\\tensor_filter\\tensor_filter_tensorflow_lite.cc", "file_new_name": "ext\\nnstreamer\\tensor_filter\\tensor_filter_tensorflow_lite.cc", "file_complexity": {"file_NLOC": "723", "file_CCN": "132", "file_NToken": "3923"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,330", "deleted_lines": "291,292,293,302,303,304", "method_info": {"method_name": "TFLiteInterpreter::loadModel", "method_params": "num_threads,accelerator", "method_startline": "277", "method_endline": "336", "method_complexity": {"method_NLOC": "42", "method_CCN": "13", "method_NToken": "255", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "125", "deleted_lines": null, "method_info": {"method_name": "TFLiteInterpreter::setDelegate", "method_params": "delegate", "method_startline": "125", "method_endline": "125", "method_complexity": {"method_NLOC": "1", "method_CCN": "1", "method_NToken": "12", "method_nesting_level": "1"}}}}}}}}