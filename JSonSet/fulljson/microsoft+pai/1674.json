{"BR": {"BR_id": "1674", "BR_author": "Gerhut", "BRopenT": "2018-11-07T09:55:25Z", "BRcloseT": "2019-03-04T07:06:24Z", "BR_text": {"BRsummary": "Wrong WebHDFS 307 redirection in Pylon", "BRdescription": "\n Here is a case without location rewrite.\n <denchmark-code>$ curl -i -X PUT \"http://dummy ip.234/webhdfs/webhdfs/v1/test/test_file?op=CREATE\"\n HTTP/1.1 307 TEMPORARY_REDIRECT\n Server: nginx/1.13.8\n Date: Wed, 07 Nov 2018 09:40:12 GMT\n Content-Type: application/octet-stream\n Transfer-Encoding: chunked\n Connection: keep-alive\n Cache-Control: no-cache\n Expires: Wed, 07 Nov 2018 09:40:12 GMT\n Pragma: no-cache\n Expires: Wed, 07 Nov 2018 09:40:12 GMT\n Pragma: no-cache\n X-FRAME-OPTIONS: SAMEORIGIN\n Location: http://dummy ip.233:5075/webhdfs/v1/test/test_file?op=CREATE&namenoderpcaddress=dummy ip.234:9000&createflag=&createparent=true&overwrite=false\n </denchmark-code>\n \n However, the request url is wrong, should be\n <denchmark-code>$ curl -i -X PUT \"http://*.234:80/webhdfs/api/v1/test/test_file?op=CREATE\"\n HTTP/1.1 307 Temporary Redirect\n Server: nginx/1.13.8\n Date: Wed, 07 Nov 2018 09:46:07 GMT\n Content-Type: text/html\n Content-Length: 187\n Connection: keep-alive\n Location: http://*.234/a/dummy ip.238:5075/webhdfs/v1/test/test_file?op=CREATE&namenoderpcaddress=dummy ip.234:9000&createflag=&createparent=true&overwrite=false\n </denchmark-code>\n \n Currently, the rewrite rules are:\n \n If the request uri starts with //pylon-host/webhdfs/api, it will be treated as a WebHDFS api call, and proxied to //webhdfs-host/webhdfs, and provide 307 redirect rewrite.\n Otherwise, if the request uri starts with //pylon-host/webhdfs, it will be treated as a WebHDFS dashboard call, and proxied to //webhdfs-host, and provide some response body replacements.\n \n So,\n <denchmark-link:https://user-images.githubusercontent.com/39592018/51975149-82e4e000-24bc-11e9-986a-3499c4cd0e8f.png></denchmark-link>\n \n Both uri will be proxied to the same WebHDFS endpoint, but treated as different request type.\n May merge these 2 rules into 1 rule to resolve the confusions, or disable the api call in dashboard rule.\n //replace real ip with dummy ip\n \t"}, "comments": {}}, "commit": {"commit_id": "35b922820f3feb754f1df7d7f8e5aed22427ab73", "commit_author": "George Cheng", "commitT": "2019-02-13 16:41:33+08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\pylon\\src\\nginx.conf.template", "file_new_name": "src\\pylon\\src\\nginx.conf.template", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "108,109,110,111,115,116", "deleted_lines": "108,112"}}}}}}