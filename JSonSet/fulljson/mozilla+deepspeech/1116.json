{"BR": {"BR_id": "1116", "BR_author": "alirezadir", "BRopenT": "2017-12-19T02:34:00Z", "BRcloseT": "2017-12-19T20:57:59Z", "BR_text": {"BRsummary": "Unable to train when installing TensorFlow and DeepSpeech bindings in the same python env: cannot register 2 metrics with the same name", "BRdescription": "\n \n OS Platform and Distribution: Linux Ubuntu 16.04:\n TensorFlow installed from:\n python util/taskcluster.py --target /tmp --source tensorflow --arch gpu --artifact tensorflow_gpu_warpctc-1.4.0-cp27-cp27mu-linux_x86_64.whl\n pip install /tmp/tensorflow_gpu_warpctc-1.4.0-cp27-cp27mu-linux_x86_64.whl\n native client installed  using:\n python util/taskcluster.py --target . --arch gpu\n Deep speech installed using:\n pip install https://index.taskcluster.net/v1/task/project.deepspeech.deepspeech.native_client.master.gpu/artifacts/public/deepspeech_gpu-0.1.0-cp27-cp27mu-manylinux1_x86_64.whl\n TensorFlow version: tensorflow-gpu-warpctc (1.4.0)  eigen-osx-fix-8d1ccfd9c5a0-2973-g1390dc1', '1.4.0-warpctc0.1\n Python version: 2.7.12\n CUDA/cuDNN version: CUDA: 8.0 / cudnn 6.0\n GPU model and memory: GeForce GTX 1080 TI\n Exact command to reproduce: python ./DeepSpeech.py --help\n \n Hey guys,\n I have been trying to run deepspeech with  gpu support with cudnn 6.0. I keep getting several issues with tensorflow  after uninstalling tensorflow 1.4 and installing the warp-ctc version (including no module found). This is the latest error that I get after creating a new virtualenv and trying everything fresh, when I run python ./DeepSpeech.py --help:\n <denchmark-code>F tensorflow/core/lib/monitoring/collection_registry.cc:77] Cannot register 2 metrics with the same name: /tensorflow/cc/saved_model/load_attempt_count\n Aborted (core dumped)\n </denchmark-code>\n \n I appreciate your help.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "alirezadir", "commentT": "2017-12-19T02:45:25Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/alirezadir>@alirezadir</denchmark-link>\n , can you retry with tensorflow upstream ? Destroy your virtual env, create one were you install first just tensorflow==1.4.0, then try training. I mean, without installing the  package as well.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "alirezadir", "commentT": "2017-12-19T03:25:04Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/alirezadir>@alirezadir</denchmark-link>\n  I do reproduce the issue locally, when installing  package. Looks like it's broken :(\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "alirezadir", "commentT": "2017-12-19T03:31:48Z", "comment_text": "\n \t\tSo, those venv fails, when installing:\n \n upstream tensorflow cpu + deepspeech cpu python bindings\n upstream tensorflow gpu + deepspeech gpu python bindings\n \n Not installing deepspeech bindings in the same venv is enough.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "alirezadir", "commentT": "2017-12-19T03:51:07Z", "comment_text": "\n \t\tSo, during training, we can leverage some code from the deepspeech or the deepspeech-gpu package, as you can read in util/audio.py:\n <denchmark-code>from deepspeech.utils import audioToInputVector\n </denchmark-code>\n \n However, Python wrapper deepspeech/_utils.so is linking against too much, including libdeepspeech.so, libtensorflow_cc.so and libtensorflow_framework.so. Using patchelf to quickly remove those deps (I don't have a ready to use build dir on my machine right now), I removed those and the result was:\n \n tensorflow-gpu + deepspeech-gpu in the same virtualenv\n python DeepSpeech --help does not fail anymore like above\n no warning about lack of deepspeech.utils.audioToInputVector, so libdeepspeech_utils.so is actually leveraged.\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "alirezadir", "commentT": "2017-12-19T05:24:08Z", "comment_text": "\n \t\t<denchmark-link:https://tools.taskcluster.net/groups/VShe5svMTCC4gLsZNtuh8g>https://tools.taskcluster.net/groups/VShe5svMTCC4gLsZNtuh8g</denchmark-link>\n  for PR <denchmark-link:https://github.com/mozilla/DeepSpeech/pull/1117>#1117</denchmark-link>\n  reproduces the issue. I have some local changes that should fix that, it needs some more cleanup and testing, though.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "alirezadir", "commentT": "2017-12-19T20:06:28Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/lissyx>@lissyx</denchmark-link>\n  thank you very much for your follow up. Here is my result of your initial suggestion:\n I tried tensorflow upstream (tensorflow==1.4.0), and I can run the training, but it throws a warning:\n WARNING: libdeepspeech failed to load, resorting to deprecated code Refer to README.md for instructions on installing libdeepspeech\n Then I tried a new venv, and installed deepspeech-gpu using pip install deepspeech-gpu. Now I get the error:\n \n which I think is for the same reason as <denchmark-link:https://github.com/mozilla/DeepSpeech/issues/1094>#1094</denchmark-link>\n  . I think I need to install deepspeech from , but then it will require the new native client, which will loop me back to the same situation. I will try your work-around suggestions soon.\n Thanks,\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "alirezadir", "commentT": "2017-12-19T20:22:10Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/alirezadir>@alirezadir</denchmark-link>\n  Thanks, as you can see, it should be okay once we merge <denchmark-link:https://github.com/mozilla/DeepSpeech/pull/1117>#1117</denchmark-link>\n  and you will be able to pip install from TaskCluster :)\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "alirezadir", "commentT": "2017-12-19T20:58:59Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/alirezadir>@alirezadir</denchmark-link>\n  As soon as tasks from <denchmark-link:https://tools.taskcluster.net/groups/IUAMmrcSRISjrTiNBlajOg>https://tools.taskcluster.net/groups/IUAMmrcSRISjrTiNBlajOg</denchmark-link>\n  are finished, you should be able to pip install from taskcluster with fixes :)\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "alirezadir", "commentT": "2017-12-21T18:49:19Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/lissyx>@lissyx</denchmark-link>\n  thanks for fixing he issue. So what would be the new link to do ?\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "alirezadir", "commentT": "2017-12-21T18:57:01Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/lissyx>@lissyx</denchmark-link>\n  also, which versions of tensorflow and naive-client should I use? :)\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "alirezadir", "commentT": "2017-12-21T18:57:43Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/alirezadir>@alirezadir</denchmark-link>\n  This should work and install you the fixed version: , same link yes :).\n And for TensorFlow, you can stick with upstream.\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "alirezadir", "commentT": "2017-12-21T21:30:54Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/lissyx>@lissyx</denchmark-link>\n  thanks a lot. It works now :)\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "alirezadir", "commentT": "2019-01-03T06:05:08Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "968c22c392bf1a6d305542e72bfa2d5ec5bb6113", "commit_author": "Alexandre Lissy", "commitT": "2017-12-19 20:33:10+01:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "native_client\\Makefile", "file_new_name": "native_client\\Makefile", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "35", "deleted_lines": "35"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "native_client\\definitions.mk", "file_new_name": "native_client\\definitions.mk", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "41,42,43,44,45,46,47,52,53,61,66", "deleted_lines": "41,42,47,55,60"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "native_client\\setup.py", "file_new_name": "native_client\\setup.py", "file_complexity": {"file_NLOC": "64", "file_CCN": "0", "file_NToken": "404"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "38,39,44", "deleted_lines": "38"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "taskcluster\\.build.yml", "file_new_name": "taskcluster\\.build.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "33", "deleted_lines": null}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "taskcluster\\test-linux-opt-base.tyml", "file_new_name": "taskcluster\\test-linux-opt-base.tyml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "42", "deleted_lines": null}}}, "file_5": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "taskcluster\\test-training+deepspeech-linux-amd64-py27-opt.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_6": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "taskcluster\\test-training+deepspeech-linux-amd64-py36-opt.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_7": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "taskcluster\\test-training_upstream+deepspeech-linux-amd64-py27-opt.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_8": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "taskcluster\\test-training_upstream+deepspeech-linux-amd64-py36-opt.yml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tc-train-tests.sh", "file_new_name": "tc-train-tests.sh", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "9,42,43,44,45,46", "deleted_lines": null}}}}}}