{"BR": {"BR_id": "180", "BR_author": "leoburgy", "BRopenT": "2019-02-04T10:30:42Z", "BRcloseT": "2019-02-15T18:08:39Z", "BR_text": {"BRsummary": "CLAHE is not working on grayscale images", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n Steps to reproduce the behavior:\n \n Import an image as a grey-scale image\n Construct an augmentation with CLAHE\n Pass the image to it\n \n <denchmark-code>from albumentations import CLAHE\n import cv2\n \n aug = CLAHE(p=1)\n img = cv2.imread('../data/images/ss1_075.png', cv2.IMREAD_GRAYSCALE)\n img.shape\n # (256, 256)\n aug(image=img, p=1)\n </denchmark-code>\n \n <denchmark-code>---------------------------------------------------------------------------\n error                                     Traceback (most recent call last)\n <ipython-input-25-6a9d0f41d618> in <module>()\n       6 img.shape\n       7 # (256, 256)\n ----> 8 aug(image=img, p=1)\n \n /usr/local/lib/python3.7/site-packages/albumentations/core/transforms_interface.py in __call__(self, **kwargs)\n      36                     target_function = self._get_target_function(key)\n      37                     target_dependencies = {k: kwargs[k] for k in self.target_dependence.get(key, [])}\n ---> 38                     res[key] = target_function(arg, **dict(params, **target_dependencies))\n      39                 else:\n      40                     res[key] = None\n \n /usr/local/lib/python3.7/site-packages/albumentations/augmentations/transforms.py in apply(self, img, clip_limit, **params)\n     985 \n     986     def apply(self, img, clip_limit=2, **params):\n --> 987         return F.clahe(img, clip_limit, self.tile_grid_size)\n     988 \n     989     def get_params(self):\n \n /usr/local/lib/python3.7/site-packages/albumentations/augmentations/functional.py in clahe(img, clip_limit, tile_grid_size)\n     274     if img.dtype != np.uint8:\n     275         raise TypeError('clahe supports only uint8 inputs')\n --> 276     img = cv2.cvtColor(img, cv2.COLOR_RGB2LAB)\n     277     clahe = cv2.createCLAHE(clipLimit=clip_limit, tileGridSize=tile_grid_size)\n     278     img[:, :, 0] = clahe.apply(img[:, :, 0])\n \n error: OpenCV(3.4.3) /Users/travis/build/skvark/opencv-python/opencv/modules/imgproc/src/color.hpp:255: error: (-2:Unspecified error) in function 'cv::CvtHelper<cv::Set<3, 4, -1>, cv::Set<3, -1, -1>, cv::Set<0, 5, -1>, cv::SizePolicy::NONE>::CvtHelper(InputArray, OutputArray, int) [VScn = cv::Set<3, 4, -1>, VDcn = cv::Set<3, -1, -1>, VDepth = cv::Set<0, 5, -1>, sizePolicy = cv::SizePolicy::NONE]'\n > Invalid number of channels in input image:\n >     'VScn::contains(scn)'\n > where\n >     'scn' is 1\n </denchmark-code>\n \n <denchmark-h:h2>Expected behavior</denchmark-h>\n \n <denchmark-h:h2>Environment</denchmark-h>\n \n \n Albumentations version: 0.1.11\n Python version: 3.7\n OS (e.g., Linux): MacOS 10.14\n How you installed albumentations: pip\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "leoburgy", "commentT": "2019-02-04T16:29:37Z", "comment_text": "\n \t\tright now we don't support single-channel images. a workaround is described here: <denchmark-link:https://github.com/albumentations-team/albumentations/issues/67>#67</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "leoburgy", "commentT": "2019-02-08T18:53:39Z", "comment_text": "\n \t\tIt would be a good idea to add this transformation. Especially useful for medical imagery.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "leoburgy", "commentT": "2019-02-08T18:54:24Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ternaus>@ternaus</denchmark-link>\n  you are welcome with PR\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "leoburgy", "commentT": "2019-02-15T18:08:39Z", "comment_text": "\n \t\tFixed in <denchmark-link:https://github.com/albumentations-team/albumentations/pull/190>#190</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "8d02597c4297963077db628473815849b868942b", "commit_author": "Vladimir Iglovikov", "commitT": "2019-02-15 10:08:09-08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "albumentations\\augmentations\\functional.py", "file_new_name": "albumentations\\augmentations\\functional.py", "file_complexity": {"file_NLOC": "591", "file_CCN": "133", "file_NToken": "5766"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "300,302,303,304,305,306,307,308,309", "deleted_lines": "300,302,303", "method_info": {"method_name": "clahe", "method_params": "img,clip_limit,tile_grid_size,8", "method_startline": "297", "method_endline": "310", "method_complexity": {"method_NLOC": "11", "method_CCN": "3", "method_NToken": "115", "method_nesting_level": "0"}}}}}}}}