{"BR": {"BR_id": "541", "BR_author": "hhsecond", "BRopenT": "2020-12-22T06:32:41Z", "BRcloseT": "2020-12-22T13:04:14Z", "BR_text": {"BRsummary": "RedisAI crashes on MODELSCAN & SCRIPTSCAN", "BRdescription": "\n The latest push to master introduce a regression that causes RedisAI to crash when doing MODELSCAN. Interestingly, if the MODELSET is tagged, it doesn't crash. I haven't looked into the core for the exact crash issue yet but made a script to reproduce if anybody else has time (run it from the root of redisai-py to match the relative path to the provided model)\n from ml2rt import load_model\n from redisai import Client\n \n con = Client()\n \n model_path = 'test/testdata/'\n ptmodel = load_model(model_path + \"pt-minimal.pt\")\n \n \n def core_dump_when_not_tagged():\n     con.modelset(\"pt_model\", 'torch', 'cpu', ptmodel)\n     con.modelscan()\n \n \n def no_core_dump_when_tagged():\n     con.modelset(\"pt_model\", 'torch', 'cpu', ptmodel, tag='v1.0')\n     con.modelscan()\n \n \n if __name__ == \"__main__\":\n     no_core_dump_when_tagged()\n     core_dump_when_not_tagged()\n Crash on SCRIPTSCAN is also easy to reproduce\n \t"}, "comments": {}}, "commit": {"commit_id": "e06c663c74bda3ba543b77e0f997babacd390c9c", "commit_author": "Luca Antiga", "commitT": "2020-12-22 14:04:13+01:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.8", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\model.c", "file_new_name": "src\\model.c", "file_complexity": {"file_NLOC": "510", "file_CCN": "111", "file_NToken": "3669"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "122", "deleted_lines": "122", "method_info": {"method_name": "RAI_Model_RdbLoad", "method_params": "io,encver", "method_startline": "25", "method_endline": "125", "method_complexity": {"method_NLOC": "76", "method_CCN": "9", "method_NToken": "571", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "src\\redisai.c", "file_new_name": "src\\redisai.c", "file_complexity": {"file_NLOC": "901", "file_CCN": "200", "file_NToken": "6360"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "793,797,799", "deleted_lines": "793", "method_info": {"method_name": "RedisAI_ScriptScan_RedisCommand", "method_params": "ctx,argv,argc", "method_startline": "779", "method_endline": "805", "method_complexity": {"method_NLOC": "21", "method_CCN": "4", "method_NToken": "153", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "474,476", "deleted_lines": "474", "method_info": {"method_name": "RedisAI_ModelGet_RedisCommand", "method_params": "ctx,argv,argc", "method_startline": "407", "method_endline": "509", "method_complexity": {"method_NLOC": "79", "method_CCN": "21", "method_NToken": "582", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "550,554,556", "deleted_lines": "552", "method_info": {"method_name": "RedisAI_ModelScan_RedisCommand", "method_params": "ctx,argv,argc", "method_startline": "536", "method_endline": "562", "method_complexity": {"method_NLOC": "21", "method_CCN": "4", "method_NToken": "153", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\flow\\tests_pytorch.py", "file_new_name": "tests\\flow\\tests_pytorch.py", "file_complexity": {"file_NLOC": "691", "file_CCN": "91", "file_NToken": "7316"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "862,873", "deleted_lines": "862,873", "method_info": {"method_name": "test_pytorch_modelscan_scriptscan", "method_params": "env", "method_startline": "843", "method_endline": "885", "method_complexity": {"method_NLOC": "27", "method_CCN": "2", "method_NToken": "307", "method_nesting_level": "0"}}}}}}}}