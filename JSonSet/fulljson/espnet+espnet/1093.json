{"BR": {"BR_id": "1093", "BR_author": "Fhrozen", "BRopenT": "2019-08-15T11:36:34Z", "BRcloseT": "2019-08-15T12:46:36Z", "BR_text": {"BRsummary": "V.6.0.0 asr_train with transformer raise error", "BRdescription": "\n Given that the argument atype was moved to e2e_asr.py, the asr.py will raise error in chainer backend when the config is set to train the transformer.\n <denchmark-code>Traceback (most recent call last):\n   File \"/export/db/espnet/egs/voxforge/asr1/../../../espnet/bin/asr_train.py\", line 341, in <module>\n     main(sys.argv[1:])\n   File \"/export/db/espnet/egs/voxforge/asr1/../../../espnet/bin/asr_train.py\", line 325, in main\n     train(args)\n   File \"/export/db/espnet/espnet/asr/chainer_backend/asr.py\", line 81, in train\n     if args.atype not in ['noatt', 'dot', 'location']:\n AttributeError: 'Namespace' object has no attribute 'atype'\n </denchmark-code>\n \n not sure if it is required to remove:\n     # check attention type\n     if args.atype not in ['noatt', 'dot', 'location']:\n         raise NotImplementedError('chainer supports only noatt, dot, and location attention.')\n or not move to another part. Let me know to submit a PR\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Fhrozen", "commentT": "2019-08-15T11:52:42Z", "comment_text": "\n \t\tIt seems that following lines are duplicated.\n \n \n \n espnet/espnet/asr/chainer_backend/asr.py\n \n \n         Lines 80 to 82\n       in\n       8c810b7\n \n \n \n \n \n \n  # check attention type \n \n \n \n  if args.atype not in ['noatt', 'dot', 'location']: \n \n \n \n  raise NotImplementedError('chainer supports only noatt, dot, and location attention.') \n \n \n \n \n \n \n \n \n espnet/espnet/nets/chainer_backend/rnn/attentions.py\n \n \n         Lines 248 to 258\n       in\n       8c810b7\n \n \n \n \n \n \n  if args.atype == 'dot': \n \n \n \n  att = AttDot(args.eprojs, args.dunits, args.adim) \n \n \n \n  elif args.atype == 'location': \n \n \n \n  att = AttLoc(args.eprojs, args.dunits, \n \n \n \n  args.adim, args.aconv_chans, args.aconv_filts) \n \n \n \n  elif args.atype == 'noatt': \n \n \n \n  att = NoAtt() \n \n \n \n  else: \n \n \n \n  logging.error( \n \n \n \n  \"Error: need to specify an appropriate attention architecture\") \n \n \n \n  sys.exit() \n \n \n \n \n \n We should remove first one.\n BTW, in the latter one, we should use raise NotImplementedError instead of logging.error and sys.exit().\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Fhrozen", "commentT": "2019-08-15T11:53:43Z", "comment_text": "\n \t\tAlso, this error will be also caused in master.\n \t\t"}}}, "commit": {"commit_id": "ee3d8c3bb80361564f04c8d480ecea0fe99e1589", "commit_author": "Fhrozen", "commitT": "2019-08-15 21:04:37+09:00", "commit_complexity": {"commit_NLOC": "0.5", "commit_CCN": "0.5", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "espnet\\asr\\chainer_backend\\asr.py", "file_new_name": "espnet\\asr\\chainer_backend\\asr.py", "file_complexity": {"file_NLOC": "317", "file_CCN": "56", "file_NToken": "2848"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "80,81,82,83", "method_info": {"method_name": "train", "method_params": "args", "method_startline": "53", "method_endline": "359", "method_complexity": {"method_NLOC": "232", "method_CCN": "48", "method_NToken": "2123", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "espnet\\nets\\chainer_backend\\rnn\\attentions.py", "file_new_name": "espnet\\nets\\chainer_backend\\rnn\\attentions.py", "file_complexity": {"file_NLOC": "147", "file_CCN": "24", "file_NToken": "1197"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "256", "deleted_lines": "256,257", "method_info": {"method_name": "att_for", "method_params": "args", "method_startline": "238", "method_endline": "257", "method_complexity": {"method_NLOC": "11", "method_CCN": "4", "method_NToken": "81", "method_nesting_level": "0"}}}}}}}}