{"BR": {"BR_id": "5721", "BR_author": "GabrieleDalmazzone", "BRopenT": "2015-11-30T11:29:02Z", "BRcloseT": "2015-12-03T10:48:15Z", "BR_text": {"BRsummary": "cuda::HOG instability bug in release mode", "BRdescription": "\n Hello,\n I have found that the opencv cuda HOG implementation is non deterministic:\n if you write a code where you perform HOG features extraction a thousand of times in a loop, you will see that the returned descriptors are not always the same (about 3 to 5 times over 1000 they are different).\n This doesn't happen in debug mode (with -g -G compilation flags).\n I have found that the instability originates from the cuda-kernel: normalize_hists_kernel_many_blocks.\n SOLUTION:\n there is a race condition in calling reduce_smem kernel.\n In order to fix this a __syncthreads() has to be added before the second call of reduce_smem.\n But I have no answer to the question: why not before the first call too???\n Hope this can help\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "GabrieleDalmazzone", "commentT": "2015-11-30T13:22:24Z", "comment_text": "\n \t\tHello,\n Thank you for your investigation. Could you create a pull request with your fix?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "GabrieleDalmazzone", "commentT": "2015-12-01T08:22:09Z", "comment_text": "\n \t\tI think I have completed the pull-request procedure.\n By\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "GabrieleDalmazzone", "commentT": "2015-12-03T08:02:38Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/GabrieleDalmazzone>@GabrieleDalmazzone</denchmark-link>\n  , you've merged the fix to your fork, not to OpenCV mainline. Please create pull request to Itseez/OpenCV repository: <denchmark-link:https://github.com/opencv/opencv/compare/master...GabrieleDalmazzone:GabrieleDalmazzone-patch-1>master...GabrieleDalmazzone:GabrieleDalmazzone-patch-1</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "5a72be08fd75e221bc6c8b5f197fc1f9531508f3", "commit_author": "GabrieleDalmazzone", "commitT": "2015-12-01 09:19:31+01:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "modules\\cudaobjdetect\\src\\cuda\\hog.cu", "file_new_name": "modules\\cudaobjdetect\\src\\cuda\\hog.cu", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "334,340", "deleted_lines": null}}}}}}