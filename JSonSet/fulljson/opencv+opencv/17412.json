{"BR": {"BR_id": "17412", "BR_author": "themightyoarfish", "BRopenT": "2020-05-28T15:28:56Z", "BRcloseT": "2020-07-17T02:28:51Z", "BR_text": {"BRsummary": "FileStorage access segfaults after assignment (assignment operator invalidates object)", "BRdescription": "\n <denchmark-h:h5>System information (version)</denchmark-h>\n \n \n OpenCV => 4.3.0 (homebrew)\n Operating System / Platform => macos 10.15\n Compiler => Clang 10.0.1\n \n <denchmark-h:h5>Detailed description</denchmark-h>\n \n When a cv::FileStorage object is assigned, the object cannot be used and causes a segfault with every access.\n <denchmark-h:h5>Steps to reproduce</denchmark-h>\n \n CMakeLists.txt\n <denchmark-code>find_package(OpenCV 4.0 REQUIRED)\n set(CMAKE_CXX_STANDARD 14)\n cmake_minimum_required(VERSION 3.15.0)\n project(test)\n add_executable(test test.cpp)\n include_directories(${OpenCV_INCLUDE_DIRS})\n target_link_libraries(test ${OpenCV_LIBRARIES})\n </denchmark-code>\n \n test.cpp\n <denchmark-code>#include <iostream>\n #include <opencv2/core/persistence.hpp>\n \n int main(int argc, char *argv[]) {\n   // crash:\n   cv::FileStorage fs;\n   fs = cv::FileStorage(\"test.yml\",  cv::FileStorage::READ);\n   // no crash\n   /* cv::FileStorage fs(\"test.yml\", cv::FileStorage::READ); */\n   std::string s;\n   fs[\"string\"] >> s;\n   std::cout << \"read value '\" << s << \"'\" << std::endl;\n   return 0;\n }\n \n </denchmark-code>\n \n test.yml\n <denchmark-code>%YAML:1.0\n string: \"wat\"\n \n </denchmark-code>\n \n <denchmark-h:h5>Issue submission checklist</denchmark-h>\n \n \n  I report the issue, it's not a question\n \n \n  I checked the problem with documentation, FAQ, open issues,\n answers.opencv.org, Stack Overflow, etc and have not found solution\n The issue has been raised here, but so far as I can see, no bug report submitted\n  I updated to latest OpenCV version and the issue is still there. I checked with current master, the problem persists.\n  There is reproducer code and related data files: videos, images, onnx, etc\n \n \t"}, "comments": {"comments_0": {"comment_id": 2, "comment_author": "themightyoarfish", "commentT": "2020-05-30T23:28:27Z", "comment_text": "\n \t\tConfirmed with OpenCV 4.x (OpenCV 3.4.x works good).\n relates <denchmark-link:https://github.com/opencv/opencv/pull/13011>#13011</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "4564b8a224545a54c545e9d2743cce3c0e1f1c5b", "commit_author": "Vadim Pisarevsky", "commitT": "2020-07-17 02:28:50+00:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\core\\src\\persistence.cpp", "file_new_name": "modules\\core\\src\\persistence.cpp", "file_complexity": {"file_NLOC": "2266", "file_CCN": "625", "file_NToken": "15317"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "1822", "method_info": {"method_name": "cv::FileStorage::~FileStorage", "method_params": "", "method_startline": "1820", "method_endline": "1823", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "13", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\core\\test\\test_io.cpp", "file_new_name": "modules\\core\\test\\test_io.cpp", "file_complexity": {"file_NLOC": "1512", "file_CCN": "198", "file_NToken": "12733"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1775,1776,1777,1778,1779,1780,1781,1782,1783,1784,1785,1786,1787,1788,1789", "deleted_lines": null, "method_info": {"method_name": "opencv_test::TEST", "method_params": "Core_InputOutput,FileStorage_copy_constructor_17412", "method_startline": "1775", "method_endline": "1789", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "98", "method_nesting_level": "2"}}}}}}}}