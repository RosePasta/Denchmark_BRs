{"BR": {"BR_id": "4265", "BR_author": "opencv-pushbot", "BRopenT": "2015-07-27T08:31:33Z", "BRcloseT": "2019-09-26T13:44:44Z", "BR_text": {"BRsummary": "Multiple bugs in cv::LevMarqSparse, which let it crash and not work properly.", "BRdescription": "\n Transferred from <denchmark-link:http://code.opencv.org/issues/888>http://code.opencv.org/issues/888</denchmark-link>\n \n <denchmark-code>|| avanindra singh on 2011-02-14 16:13\n || Priority: Normal\n || Affected: 2.4.0 - 2.4.7\n || Category: legacy, contrib\n || Tracker: Bug\n || Difficulty: \n || PR: \n || Platform: x64 / Linux\n </denchmark-code>\n \n <denchmark-h:h2>Multiple bugs in cv::LevMarqSparse, which let it crash and not work properly.</denchmark-h>\n \n <denchmark-code>ile name: ba.cpp\n \n I have found more than one bug in this implementation. I would list them out:\n \n 1) The implementation assumes pointer size to be 32 bit, while on my 64 bit UBUNTU/OPENSUSE system, gcc shows size of pointer to be 64 bit and because of this it crashes during run time.\n \n The matrices A, B, W and Vis_index which store pointers, have type CV_32S. (line 214 - 217). If I chage the type to CV_32SC2, this bug gets fixed.\n \n 2) In the method fjac in Jacobian computation, at line 728\n \n CvMat* _mp = cvCreateMat(1, 2, CV_64F ); //projection of the point\n \n The type CV_64F cause assertion failure during run time in cvProjectPoints2 . This bug gets fixed, if I change the type to CV_64FC2 and reduce number of cols to 1, i.e. \n \n CvMat* _mp = cvCreateMat(1, 1, CV_64FC2 ); //projection of the point\n \n The same bug lies in function named 'func', which is used to compute projections. At line 937\n \n  CvMat* _mp = cvCreateMat(1, 2, CV_64F ); //projection of the point\n \n again if I change type to CV_64FC2, it gets fixed. Also in this case it would need to be reshaped before \n   line 963:\n \n cvTranspose( _mp, estim );\n \n i.e.\n \n cvReshape(_mp,_mp,1,0);\n cvTranspose( _mp, estim );\n \n \n 3) At line 1106:\n params.rowRange(i*num_cam_param + 10,i*num_cam_param+10+numdist).copyTo(distCoeffs[i]);\n \n    The distortion being copied is the one which has been given as input for optimization, but rather it should be optimized one. i.e.\n \n (levmar.P).rowRange(i*num_cam_param + 10,i*num_cam_param+10+numdist).copyTo(distCoeffs[i]);\n \n This causes wrong output of optimization.\n \n 4) I noticed that the optimization does not let focal length and principal point vary at all, it only changes distortion and motion parameters. Though, I do not have any specific line to point out, but I still believe it is not natural behaviour of bundle adjustment. I compared it's output with sba package provided at http://www.ics.forth.gr/~lourakis/sba/  and sba's output confirms my suspecion.\n \n I wanted to use this implementation in a software. I would be grateful if anyone fixes it soon.\n \n Regards\n Avanindra\n </denchmark-code>\n \n <denchmark-h:h2>History</denchmark-h>\n \n <denchmark-h:h5>Alexander Shishkov on 2012-02-12 21:17</denchmark-h>\n \n <denchmark-code>-   Description changed from ile name: ba.cpp I have found more than one\n     bug in this implementation. I wo... to ile name: ba.cpp I have found\n     more than one bug in this implementation. I wo... More\n </denchmark-code>\n \n <denchmark-h:h5>Alexander Shishkov on 2012-03-21 21:37</denchmark-h>\n \n <denchmark-code>-   Target version deleted ()\n -   Priority changed from High to Normal\n </denchmark-code>\n \n <denchmark-h:h5>Alexander Shishkov on 2012-03-25 20:46</denchmark-h>\n \n <denchmark-code>-   Assignee deleted (Vadim Pisarevsky)\n </denchmark-code>\n \n <denchmark-h:h5>Alexander Shishkov on 2012-04-05 12:43</denchmark-h>\n \n <denchmark-code>-   Target version deleted ()\n </denchmark-code>\n \n <denchmark-h:h5>Rui Marques on 2014-03-28 17:49</denchmark-h>\n \n <denchmark-code>Any special reason why this is open? Not reproducible, no longer relevant (legacy), not enough resources (developer time) to fix?\n </denchmark-code>\n \n <denchmark-h:h5>Nikita Manovich on 2014-04-01 12:49</denchmark-h>\n \n <denchmark-code>-   Affected version set to 2.4.0 - 2.4.7\n -   Operating System set to Linux\n -   HW Platform set to x64\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "opencv-pushbot", "commentT": "2019-09-26T13:39:20Z", "comment_text": "\n \t\tsuggest to close this\n \t\t"}}}, "commit": {"commit_id": "309c9621694664430ec2b358460bcd60b5e826bc", "commit_author": "Pascal Thomet", "commitT": "2017-07-08 16:15:26+02:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "modules\\core\\include\\opencv2\\core\\bufferpool.hpp", "file_new_name": "modules\\core\\include\\opencv2\\core\\bufferpool.hpp", "file_complexity": {"file_NLOC": "13", "file_CCN": "1", "file_NToken": "54"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "10,11,12,13,14,36,37,38,39", "deleted_lines": null}}}}}}