{"BR": {"BR_id": "7458", "BR_author": "reunanen", "BRopenT": "2016-10-11T14:08:45Z", "BRcloseT": "2017-10-08T20:18:56Z", "BR_text": {"BRsummary": "drawContours fails for very large images", "BRdescription": "\n <denchmark-h:h5>System information (version)</denchmark-h>\n \n \n OpenCV => 3.1\n Operating System / Platform => Windows 64 Bit\n Compiler => Visual Studio 2013\n \n <denchmark-h:h5>Detailed description</denchmark-h>\n \n For very large images, the drawContours function does not produce the expected results.\n See also <denchmark-link:https://github.com/opencv/opencv/issues/7449>#7449</denchmark-link>\n  \u2013 probably related. However, drawContours does not crash the program \u2013 it just produces an incorrect result.\n <denchmark-h:h5>Steps to reproduce</denchmark-h>\n \n Please note that you'll need to have merged at least one of <denchmark-link:https://github.com/opencv/opencv/pull/7451>#7451</denchmark-link>\n  and <denchmark-link:https://github.com/opencv/opencv/pull/7452>#7452</denchmark-link>\n , because otherwise already the  call crashes the program:\n <denchmark-code>cv::Mat largeImage(79925, 49955, CV_8UC1);\n largeImage.setTo(0);\n \n cv::circle(largeImage, cv::Point(largeImage.cols / 2, largeImage.rows / 2), 5000, 255, CV_FILLED);\n \n std::vector<std::vector<cv::Point>> contours;\n cv::findContours(largeImage, contours, cv::RETR_EXTERNAL, cv::CHAIN_APPROX_SIMPLE);\n \n largeImage.setTo(0);\n cv::drawContours(largeImage, contours, -1, 255, CV_FILLED);\n \n cv::Mat smallImage;\n cv::resize(largeImage, smallImage, cv::Size(499, 799));\n \n cv::imwrite(\"smallImage.png\", smallImage);\n </denchmark-code>\n \n Result (not ok):\n <denchmark-link:https://cloud.githubusercontent.com/assets/2297572/19273301/ae33676a-8fd4-11e6-99b0-5ff54eb341db.png></denchmark-link>\n \n However, this code does work as expected (when pasted right after the above snippet, so that contours has already been found):\n <denchmark-code>std::vector<std::vector<cv::Point>> contours2 = contours;\n for (auto& contour : contours2) {\n     for (auto& point : contour) {\n         point.x /= 100;\n         point.y /= 100;\n     }\n }\n \n cv::Mat smallImage2(smallImage.size(), CV_8UC1);\n smallImage2.setTo(0);\n cv::drawContours(smallImage2, contours2, -1, 255, CV_FILLED);\n cv::imwrite(\"smallImage2.png\", smallImage2);\n </denchmark-code>\n \n Result (ok):\n <denchmark-link:https://cloud.githubusercontent.com/assets/2297572/19273302/ae3367ec-8fd4-11e6-8dad-72ce62064e19.png></denchmark-link>\n \n I'll try to find and fix the problem myself.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "reunanen", "commentT": "2017-10-08T19:45:09Z", "comment_text": "\n \t\ti think this can be closed down.\n \t\t"}}}, "commit": {"commit_id": "5bb08bae2884a85d42626d8af1584e59b0246282", "commit_author": "Juha Reunanen", "commitT": "2016-11-14 16:31:29+03:00", "commit_complexity": {"commit_NLOC": "0.25", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "modules\\imgproc\\test\\test_contours.cpp", "file_new_name": "modules\\imgproc\\test\\test_contours.cpp", "file_complexity": {"file_NLOC": "363", "file_CCN": "74", "file_NToken": "3005"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "239,241", "deleted_lines": null, "method_info": {"method_name": "CV_FindContourTest::prepare_test_case", "method_params": "test_case_idx", "method_startline": "225", "method_endline": "260", "method_complexity": {"method_NLOC": "25", "method_CCN": "3", "method_NToken": "253", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "139,140,141,142,152,153,154,155,156,157,158,160,161", "deleted_lines": "136,137,139,140", "method_info": {"method_name": "CV_FindContourTest::read_params", "method_params": "fs", "method_startline": "128", "method_endline": "164", "method_complexity": {"method_NLOC": "28", "method_CCN": "7", "method_NToken": "279", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "91,96,97,98,99,100", "deleted_lines": null, "method_info": {"method_name": "CV_FindContourTest::CV_FindContourTest", "method_params": "", "method_startline": "87", "method_endline": "106", "method_complexity": {"method_NLOC": "15", "method_CCN": "5", "method_NToken": "78", "method_nesting_level": "0"}}}}}}}}