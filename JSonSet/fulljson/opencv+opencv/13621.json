{"BR": {"BR_id": "13621", "BR_author": "olegb94", "BRopenT": "2019-01-12T14:55:34Z", "BRcloseT": "2019-02-01T12:03:08Z", "BR_text": {"BRsummary": "Bug in SVM sigmoid kernel", "BRdescription": "\n Normally sigmoid kernel used in SVM is:\n K(x, y) = tanh(gamma * <x, y> + coef0)\n But in this  code different formula is implemented:\n K(x, y) = -tanh(gamma * <x, y> + coef0)\n \n \n \n opencv/modules/ml/src/svm.cpp\n \n \n         Lines 198 to 214\n       in\n       7d4bb94\n \n \n \n \n \n \n  void calc_sigmoid( int vcount, int var_count, const float* vecs, \n \n \n \n  const float* another, Qfloat* results ) \n \n \n \n  { \n \n \n \n  int j; \n \n \n \n  calc_non_rbf_base( vcount, var_count, vecs, another, results, \n \n \n \n                        -2*params.gamma, -2*params.coef0 ); \n \n \n \n  // TODO: speedup this \n \n \n \n  for( j = 0; j < vcount; j++ ) \n \n \n \n      { \n \n \n \n          Qfloat t = results[j]; \n \n \n \n          Qfloat e = std::exp(-std::abs(t)); \n \n \n \n  if( t > 0 ) \n \n \n \n              results[j] = (Qfloat)((1. - e)/(1. + e)); \n \n \n \n  else \n \n \n \n              results[j] = (Qfloat)((e - 1.)/(e + 1.)); \n \n \n \n      } \n \n \n \n  } \n \n \n \n \n \n I'm not sure if it is intended, looks like a bug for me.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "olegb94", "commentT": "2019-01-21T12:11:11Z", "comment_text": "\n \t\tFeel free to to prepare PR with proposed fix.\n Unfortunately this code part is <denchmark-link:http://pullrequest.opencv.org/buildbot/export/opencv_releases/3_4_coverage-lin64-debug/20190121-011752_273/coverage_html/index.html>not covered by OpenCV tests</denchmark-link>\n . It would be nice to add some simple test for this code too.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "olegb94", "commentT": "2019-01-28T21:36:55Z", "comment_text": "\n \t\tIf <denchmark-link:https://github.com/olegb94>@olegb94</denchmark-link>\n  isn't already looking at this, I'd love to have a look.  I'm new to contributing to OpenCV but familiar with SVMs and keen to get involved.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "olegb94", "commentT": "2019-01-28T23:29:12Z", "comment_text": "\n \t\tI've been looking at this and plan to put together some tests and a proposed fix tomorrow evening \ud83d\udc4d\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "olegb94", "commentT": "2019-01-30T17:26:54Z", "comment_text": "\n \t\tI'm not working on it, you can go ahead.\n \t\t"}}}, "commit": {"commit_id": "418898029c2243797e55f9496d5e416696b307f9", "commit_author": "Hannah McLaughlin", "commitT": "2019-01-31 15:34:36+03:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "modules\\ml\\src\\svm.cpp", "file_new_name": "modules\\ml\\src\\svm.cpp", "file_complexity": {"file_NLOC": "1835", "file_CCN": "431", "file_NToken": "13584"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "1313,1314", "method_info": {"method_name": "cv::ml::SVMImplCV_FINAL::checkParams", "method_params": "", "method_startline": "1296", "method_endline": "1360", "method_complexity": {"method_NLOC": "54", "method_CCN": "33", "method_NToken": "398", "method_nesting_level": "3"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "203,208,211,212", "deleted_lines": "203,208,210,211", "method_info": {"method_name": "cv::ml::SVMKernelImplCV_FINAL::calc_sigmoid", "method_params": "vcount,var_count,vecs,another,results", "method_startline": "198", "method_endline": "214", "method_complexity": {"method_NLOC": "16", "method_CCN": "3", "method_NToken": "145", "method_nesting_level": "3"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\ml\\test\\test_svmtrainauto.cpp", "file_new_name": "modules\\ml\\test\\test_svmtrainauto.cpp", "file_complexity": {"file_NLOC": "129", "file_CCN": "13", "file_NToken": "1385"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134", "deleted_lines": null, "method_info": {"method_name": "opencv_test::TEST", "method_params": "ML_SVM,trainauto_sigmoid", "method_startline": "91", "method_endline": "134", "method_complexity": {"method_NLOC": "33", "method_CCN": "2", "method_NToken": "381", "method_nesting_level": "2"}}}}}}}}