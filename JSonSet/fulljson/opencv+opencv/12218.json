{"BR": {"BR_id": "12218", "BR_author": "hovnatan", "BRopenT": "2018-08-15T11:20:30Z", "BRcloseT": "2018-09-04T20:14:20Z", "BR_text": {"BRsummary": "cv::distanceTransform() fail on a large image", "BRdescription": "\n \n OpenCV => 3.4.2\n Operating System / Platform => Ubuntu 18.04\n Compiler => gcc 8\n \n Run\n int main() {\n   cv::Mat non_valid = cv::imread(\"surfaces_nonvalid.tif\", cv::IMREAD_ANYDEPTH);\n   cv::Mat dst;\n   cv::Mat labels;\n   cv::distanceTransform(non_valid, dst, labels, cv::DIST_L2, cv::DIST_MASK_3,\n                         cv::DIST_LABEL_PIXEL);\n   std::cout << labels.at<int>(0, 0) << std::endl; // <-- Error here: 0\n   std::cout << labels.at<int>(50, 50) << std::endl; // <-- Error here: 0\n   std::cout << labels.at<int>(5000, 5000) << std::endl; // Looks reasonable\n   return 0;\n }\n \n on  image from <denchmark-link:https://github.com/opencv/opencv/files/2290343/surfaces_nonvalid.zip>surfaces_nonvalid.zip</denchmark-link>\n . The labels output has a lot of erroneous zero label values on the left part of the output as seen on this screenshot (left image: input non_valid image, right image: output labels image. black pixels ):\n <denchmark-link:https://user-images.githubusercontent.com/8426582/44145688-9ab5d80e-a09d-11e8-9850-6534955b7aec.png></denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "hovnatan", "commentT": "2018-08-16T12:05:37Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/alalek>@alalek</denchmark-link>\n  I found that the root of the problem is the large size of the input image: temporary integer distances calculated are larger than the max int value. If OpenCV supported s this can be easily solved. Is there a plan in the future to support this? Or can I try adding this myself?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "hovnatan", "commentT": "2018-08-16T12:34:49Z", "comment_text": "\n \t\tcv::Mat_<long int> is not supported. Only int = int32_t.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "hovnatan", "commentT": "2018-08-17T12:25:59Z", "comment_text": "\n \t\tI have a solution using cv::Mat1d memory as a cv::Mat with long int (in Linux, at least, long int and double have the same size). If you think this is an acceptable solution I can commit the fix to OpenCV.\n \t\t"}}}, "commit": {"commit_id": "cb7ee27cd9a2f06cf07c91eab1970be8d9232678", "commit_author": "yuki takehara", "commitT": "2018-09-03 17:18:10+03:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.8421052631578947", "commit_Nprams": "0.8421052631578947"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "modules\\imgproc\\src\\distransform.cpp", "file_new_name": "modules\\imgproc\\src\\distransform.cpp", "file_complexity": {"file_NLOC": "687", "file_CCN": "150", "file_NToken": "5630"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "149,150,151,168,179,180,203,207,210,228", "deleted_lines": "147,148,149,166,177,178,201,205,208", "method_info": {"method_name": "cv::distanceTransform_5x5", "method_params": "_src,_temp,_dist,metrics", "method_startline": "145", "method_endline": "232", "method_complexity": {"method_NLOC": "79", "method_CCN": "24", "method_NToken": "824", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "241,242,243,262,277,339,344,348,399", "deleted_lines": "238,239,240,259,274,336,341,345", "method_info": {"method_name": "cv::distanceTransformEx_5x5", "method_params": "_src,_temp,_dist,_labels,metrics", "method_startline": "236", "method_endline": "403", "method_complexity": {"method_NLOC": "155", "method_CCN": "25", "method_NToken": "1144", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "75,76,93,104,105,120,124,127,137", "deleted_lines": "74,75,92,103,104,119,123,126", "method_info": {"method_name": "cv::distanceTransform_3x3", "method_params": "_src,_temp,_dist,metrics", "method_startline": "71", "method_endline": "141", "method_complexity": {"method_NLOC": "62", "method_CCN": "16", "method_NToken": "617", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\imgproc\\test\\test_distancetransform.cpp", "file_new_name": "modules\\imgproc\\test\\test_distancetransform.cpp", "file_complexity": {"file_NLOC": "216", "file_CCN": "42", "file_NToken": "1855"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303", "deleted_lines": null, "method_info": {"method_name": "opencv_test::BIGDATA_TEST", "method_params": "Imgproc_DistanceTransform,large_image_12218", "method_startline": "286", "method_endline": "303", "method_complexity": {"method_NLOC": "16", "method_CCN": "4", "method_NToken": "177", "method_nesting_level": "2"}}}}}}}}