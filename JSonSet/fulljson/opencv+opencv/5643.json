{"BR": {"BR_id": "5643", "BR_author": "amroamroamro", "BRopenT": "2015-11-08T14:45:47Z", "BRcloseT": "2015-12-23T16:14:43Z", "BR_text": {"BRsummary": "[shape] wrong mat copy in ShapeContextDistanceExtractor::getImages", "BRdescription": "\n There's a small bug in cv::ShapeContextDistanceExtractor::getImages.\n Here is a simple example to reproduce it (tested in OpenCV 3.0.0, Win x64):\n #include <iostream>\n #include \"opencv2/core.hpp\"\n #include \"opencv2/shape.hpp\"\n using namespace std;\n using namespace cv;\n \n int main()\n {\n     Mat img1(3, 4, CV_8UC1, Scalar::all(1));\n     Mat img2(3, 4, CV_8UC1, Scalar::all(2));\n \n     Ptr<ShapeContextDistanceExtractor> sc = createShapeContextDistanceExtractor();\n     sc->setImages(img1, img2);\n \n     Mat im1, im2;\n     sc->getImages(im1, im2);\n \n     cout << \"img1 = \\n\" << img1 << endl;\n     cout << \"im1 = \\n\" << im1 << endl;\n     // same thing with im2/img2\n \n     return 0;\n }\n The returned matrices are created but never filled (we get garbage values):\n <denchmark-code>img1 =\n [  1,   1,   1,   1;\n    1,   1,   1,   1;\n    1,   1,   1,   1]\n im1 =\n [  0,   0,   0,   0;\n   12, 106,  80,  32;\n   32,  13,  10, 135]\n </denchmark-code>\n \n I believe the assignments on <denchmark-link:https://github.com/Itseez/opencv/blob/master/modules/shape/src/sc_dis.cpp#L129>these lines</denchmark-link>\n  are incorrect :\n virtual void getImages(OutputArray _image1, OutputArray _image2) const\n {\n     CV_Assert((!image1.empty()) && (!image2.empty()));\n     _image1.create(image1.size(), image1.type());\n     _image2.create(image2.size(), image2.type());\n     _image1.getMat()=image1;   // <---\n     _image2.getMat()=image2;   // <---\n }\n Instead maybe we should do something like:\n virtual void getImages(OutputArray _image1, OutputArray _image2) const\n {\n     CV_Assert((!image1.empty()) && (!image2.empty()));\n     image1.copyTo(_image1);\n     image2.copyTo(_image2);\n }\n \t"}, "comments": {}}, "commit": {"commit_id": "bb78b01aceb937b50fa63e4e970f8e0f7c95a604", "commit_author": "Dikay900", "commitT": "2015-12-23 10:48:36+01:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\shape\\src\\sc_dis.cpp", "file_new_name": "modules\\shape\\src\\sc_dis.cpp", "file_complexity": {"file_NLOC": "615", "file_CCN": "128", "file_NToken": "4483"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "127,128", "deleted_lines": "127,128,129", "method_info": {"method_name": "cv::ShapeContextDistanceExtractorImpl::getImages", "method_params": "_image1,_image2", "method_startline": "124", "method_endline": "129", "method_complexity": {"method_NLOC": "6", "method_CCN": "2", "method_NToken": "46", "method_nesting_level": "2"}}}}}}}}