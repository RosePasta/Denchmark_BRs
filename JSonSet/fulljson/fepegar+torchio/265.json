{"BR": {"BR_id": "265", "BR_author": "fepegar", "BRopenT": "2020-08-12T17:04:53Z", "BRcloseT": "2020-08-12T20:51:38Z", "BR_text": {"BRsummary": "ValueError in Subject.spatial_shape", "BRdescription": "\n \ud83d\udc1bBug\n An error is raised if images have different number of channels, even if the spatial shape of all images are the same. This happens because it is computed using Subject.shape. It used to work until we added support for 4D images.\n To reproduce\n import torchio as tio\n icbm = tio.datasets.ICBM2009CNonlinearSymmetryc()\n del icbm['face']  # this one does have a different spatial shape\n icbm.spatial_shape\n ---------------------------------------------------------------------------\n ValueError                                Traceback (most recent call last)\n <ipython-input-2-6b7dc2edb3cc> in <module>\n ----> 1 icbm.spatial_shape\n \n ~/git/torchio/torchio/data/subject.py in spatial_shape(self)\n      95         Consistency of shapes across images in the subject is checked first.\n      96         \"\"\"\n ---> 97         return self.shape[1:]\n      98\n      99     @property\n \n ~/git/torchio/torchio/data/subject.py in shape(self)\n      85         Consistency of shapes across images in the subject is checked first.\n      86         \"\"\"\n ---> 87         self.check_consistent_shape()\n      88         image = self.get_images(intensity_only=False)[0]\n      89         return image.shape\n \n ~/git/torchio/torchio/data/subject.py in check_consistent_shape(self)\n     135                 f'\\n{pprint.pformat(shapes_dict)}'\n     136             )\n --> 137             raise ValueError(message)\n     138\n     139     def check_consistent_orientation(self) -> None:\n \n ValueError: Images in subject have inconsistent shapes:\n {'brain': (1, 193, 229, 193),\n  'eyes': (1, 193, 229, 193),\n  'pd': (1, 193, 229, 193),\n  't1': (1, 193, 229, 193),\n  't2': (1, 193, 229, 193),\n  'tissues': (3, 193, 229, 193)}\n Expected behavior\n It should check for spatial shapes of images only.\n TorchIO version\n 0.17.26.\n \t"}, "comments": {}}, "commit": {"commit_id": "a22b490ec9294d32ddc4658c023cb09fbcbd84b1", "commit_author": "Fernando P\u00e9rez-Garc\u00eda", "commitT": "2020-08-12 21:51:37+01:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\data\\test_subject.py", "file_new_name": "tests\\data\\test_subject.py", "file_complexity": {"file_NLOC": "40", "file_CCN": "6", "file_NToken": "297"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "35,36,37,38,39,40,41,42", "deleted_lines": null, "method_info": {"method_name": "test_inconsistent_shape", "method_params": "self", "method_startline": "35", "method_endline": "42", "method_complexity": {"method_NLOC": "8", "method_CCN": "1", "method_NToken": "64", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "44,45,46,47,48,49,50", "deleted_lines": null, "method_info": {"method_name": "test_inconsistent_spatial_shape", "method_params": "self", "method_startline": "44", "method_endline": "50", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "61", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\test_utils.py", "file_new_name": "tests\\test_utils.py", "file_complexity": {"file_NLOC": "92", "file_CCN": "13", "file_NToken": "767"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "46,47,48,49,50,51", "method_info": {"method_name": "test_check_consistent_shape", "method_params": "self", "method_startline": "46", "method_endline": "51", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "35", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 12, "file_old_name": "torchio\\data\\subject.py", "file_new_name": "torchio\\data\\subject.py", "file_complexity": {"file_NLOC": "138", "file_CCN": "34", "file_NToken": "717"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "53,56", "deleted_lines": "52", "method_info": {"method_name": "__repr__", "method_params": "self", "method_startline": "52", "method_endline": "58", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "28", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "101,103,104", "deleted_lines": "103", "method_info": {"method_name": "spacing", "method_params": "self", "method_startline": "98", "method_endline": "104", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "20", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "139,140,141,142,143,144,145,146,147,148,149,150", "method_info": {"method_name": "check_consistent_orientation", "method_params": "self", "method_startline": "139", "method_endline": "150", "method_complexity": {"method_NLOC": "12", "method_CCN": "3", "method_NToken": "70", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "174,175", "deleted_lines": null, "method_info": {"method_name": "remove_image", "method_params": "self,str", "method_startline": "174", "method_endline": "175", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "16", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "119,120", "deleted_lines": null, "method_info": {"method_name": "check_consistent_shape", "method_params": "self", "method_startline": "119", "method_endline": "120", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "13", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "91,92,94,95", "deleted_lines": "88,89,95", "method_info": {"method_name": "spatial_shape", "method_params": "self", "method_startline": "88", "method_endline": "95", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "19", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "48", "deleted_lines": "48,49,50", "method_info": {"method_name": "__init__", "method_params": "self,args,str", "method_startline": "39", "method_endline": "50", "method_complexity": {"method_NLOC": "12", "method_CCN": "4", "method_NToken": "93", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "106,107,108,109,110,111,112,113,114,115,116,117", "deleted_lines": "106,107", "method_info": {"method_name": "check_consistent_attribute", "method_params": "self,str", "method_startline": "106", "method_endline": "117", "method_complexity": {"method_NLOC": "12", "method_CCN": "3", "method_NToken": "78", "method_nesting_level": "1"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "122,123", "deleted_lines": null, "method_info": {"method_name": "check_consistent_spatial_shape", "method_params": "self", "method_startline": "122", "method_endline": "123", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "13", "method_nesting_level": "1"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "84,85", "deleted_lines": null, "method_info": {"method_name": "shape", "method_params": "self", "method_startline": "79", "method_endline": "85", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "20", "method_nesting_level": "1"}}}, "hunk_10": {"Ismethod": 1, "added_lines": null, "deleted_lines": "180", "method_info": {"method_name": "add_image", "method_params": "self,image,image_name", "method_startline": "180", "method_endline": "182", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "20", "method_nesting_level": "1"}}}, "hunk_11": {"Ismethod": 1, "added_lines": "170", "deleted_lines": null, "method_info": {"method_name": "add_image", "method_params": "self,Image,str", "method_startline": "170", "method_endline": "172", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "26", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "torchio\\transforms\\augmentation\\spatial\\random_affine.py", "file_new_name": "torchio\\transforms\\augmentation\\spatial\\random_affine.py", "file_complexity": {"file_NLOC": "258", "file_CCN": "18", "file_NToken": "1263"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "160", "deleted_lines": "160", "method_info": {"method_name": "apply_transform", "method_params": "self,Subject", "method_startline": "159", "method_endline": "202", "method_complexity": {"method_NLOC": "41", "method_CCN": "6", "method_NToken": "210", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "torchio\\transforms\\augmentation\\spatial\\random_elastic_deformation.py", "file_new_name": "torchio\\transforms\\augmentation\\spatial\\random_elastic_deformation.py", "file_complexity": {"file_NLOC": "253", "file_CCN": "12", "file_NToken": "977"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "218", "deleted_lines": "218", "method_info": {"method_name": "apply_transform", "method_params": "self,Subject", "method_startline": "217", "method_endline": "239", "method_complexity": {"method_NLOC": "23", "method_CCN": "4", "method_NToken": "122", "method_nesting_level": "1"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "torchio\\transforms\\preprocessing\\spatial\\crop_or_pad.py", "file_new_name": "torchio\\transforms\\preprocessing\\spatial\\crop_or_pad.py", "file_complexity": {"file_NLOC": "207", "file_CCN": "11", "file_NToken": "1064"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "102", "deleted_lines": "102", "method_info": {"method_name": "_get_sample_shape", "method_params": "Subject", "method_startline": "100", "method_endline": "106", "method_complexity": {"method_NLOC": "7", "method_CCN": "2", "method_NToken": "35", "method_nesting_level": "1"}}}}}}}}