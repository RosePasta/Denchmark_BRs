{"BR": {"BR_id": "3713", "BR_author": "fizban99", "BRopenT": "2019-05-09T13:22:52Z", "BRcloseT": "2019-05-11T13:48:41Z", "BR_text": {"BRsummary": "\"illegal type for path parameter\" on Linux when using CLI train", "BRdescription": "\n <denchmark-h:h2>How to reproduce the behaviour</denchmark-h>\n \n After running the train CLI tool, I get an error on Linux:\n <denchmark-code>File \"[...]/lib/python3.5/site-packages/spacy/cli/train.py\", line 382, in _collate_best_model\n     shutil.copytree(output_path / \"model-final\", best_dest)\n   File \"[...]/lib/python3.5/shutil.py\", line 309, in copytree\n     names = os.listdir(src)\n TypeError: argument should be string, bytes or integer, not PosixPath\n Exception ignored in: <bound method GoldCorpus.__del__ of <spacy.gold.GoldCorpus object at 0x7f6e53d262b0>>\n Traceback (most recent call last):\n   File \"gold.pyx\", line 116, in spacy.gold.GoldCorpus.__del__\n   File \"[...]/lib/python3.5/shutil.py\", line 471, in rmtree\n     onerror(os.lstat, path, sys.exc_info())\n   File \"[...]/lib/python3.5/shutil.py\", line 469, in rmtree\n     orig_st = os.lstat(path)\n TypeError: lstat: illegal type for path parameter\n \n </denchmark-code>\n \n It looks like in lines 381-382 of train.py copytree is used with a PosixPath and it fails on Linux.\n <denchmark-code>    best_dest = output_path / \"model-best\"\n     shutil.copytree(output_path / \"model-final\", best_dest)\n </denchmark-code>\n \n This works fine on Windows. Shouldn't the paths be coerced to string with str()?\n <denchmark-h:h2>Your Environment</denchmark-h>\n \n \n Platform: Linux-4.4.0-145-generic-x86_64-with-centos-7.6.1810-Core\n spaCy version: 2.1.3\n Python version: 3.5.5\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "fizban99", "commentT": "2019-05-10T23:47:32Z", "comment_text": "\n \t\tThanks. I've been testing this on 3.6, where the standard library supports PosixPath objects. A PR would be welcome.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "fizban99", "commentT": "2019-05-13T08:26:05Z", "comment_text": "\n \t\tThank you. You are right. I had 3.7 on Windows.\n I tried the new version of the train.py file modified by Ines and, although the model-best version is created, I still get the following:\n <denchmark-code>Exception ignored in: <bound method GoldCorpus.__del__ of <spacy.gold.GoldCorpus object at 0x7f08792459e8>>\n Traceback (most recent call last):\n   File \"gold.pyx\", line 116, in spacy.gold.GoldCorpus.__del__\n   File \"[...]/lib/python3.5/shutil.py\", line 471, in rmtree\n     onerror(os.lstat, path, sys.exc_info())\n   File \"[...]/lib/python3.5/shutil.py\", line 469, in rmtree\n     orig_st = os.lstat(path)\n TypeError: lstat: illegal type for path parameter\n </denchmark-code>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "fizban99", "commentT": "2019-05-14T13:45:33Z", "comment_text": "\n \t\tStrangely, I do not get that error anymore...\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "fizban99", "commentT": "2019-06-13T16:40:08Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "6b3a79ac963bae3545628e12ed2b5367cd0103eb", "commit_author": "Ines Montani", "commitT": "2019-05-11 15:48:35+02:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "spacy\\cli\\train.py", "file_new_name": "spacy\\cli\\train.py", "file_complexity": {"file_NLOC": "434", "file_CCN": "33", "file_NToken": "2943"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "427,429,430,431,432", "deleted_lines": "426,428,429", "method_info": {"method_name": "_collate_best_model", "method_params": "meta,output_path,components", "method_startline": "422", "method_endline": "437", "method_complexity": {"method_NLOC": "16", "method_CCN": "4", "method_NToken": "132", "method_nesting_level": "0"}}}}}}}}