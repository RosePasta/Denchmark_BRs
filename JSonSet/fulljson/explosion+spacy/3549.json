{"BR": {"BR_id": "3549", "BR_author": "jjhbw", "BRopenT": "2019-04-07T09:11:48Z", "BRcloseT": "2019-04-09T10:50:51Z", "BR_text": {"BRsummary": "Matcher with `validate = True` raises on valid patterns", "BRdescription": "\n Hi guys, thanks for this amazing library!\n I was playing with the rule based matching functionality and came across some weird behaviour with the Matcher class. It seems initiating it with validate = True causes valid patterns to raise spacy.errors.MatchPatternError.\n I've copied an <denchmark-link:https://spacy.io/usage/rule-based-matching#adding-patterns>example from the docs</denchmark-link>\n  and added the  kwarg.\n <denchmark-h:h2>How to reproduce the behaviour</denchmark-h>\n \n import spacy\n from spacy.matcher import Matcher\n nlp = spacy.load(\"en_core_web_sm\")\n \n matcher = Matcher(nlp.vocab, validate = True)\n pattern = [{\"LOWER\": \"hello\"}, {\"LOWER\": \"world\"}]\n matcher.add(\"HelloWorld\", None, pattern)\n doc = nlp(u'hello world!')\n matches = matcher(doc)\n This results in:\n <denchmark-code>Traceback (most recent call last):\n   File \"./tests/matchertest.py\", line 7, in <module>\n     matcher.add(\"HelloWorld\", None, pattern)\n   File \"matcher.pyx\", line 109, in spacy.matcher.matcher.Matcher.add\n spacy.errors.MatchPatternError: Invalid token patterns for matcher rule 'HelloWorld'\n \n Pattern 0:\n \n \n </denchmark-code>\n \n <denchmark-h:h2>Info about spaCy</denchmark-h>\n \n \n spaCy version: 2.1.3\n Platform: Darwin-18.5.0-x86_64-i386-64bit\n Python version: 3.6.8\n Models: en\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jjhbw", "commentT": "2019-04-09T10:50:56Z", "comment_text": "\n \t\tThanks for the report \u2013 no idea how this happened \ud83e\udd14 Looks like the match pattern error was also raising even if there were no errors. Should be fixed now!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jjhbw", "commentT": "2019-04-09T11:34:33Z", "comment_text": "\n \t\tWow that was quick, thanks so much for the fix!\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "jjhbw", "commentT": "2019-05-09T12:16:19Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "4d198a7e92f813fb9df2ade72fbeaf847284a7a0", "commit_author": "Ines Montani", "commitT": "2019-04-09 12:50:43+02:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "spacy\\matcher\\matcher.pyx", "file_new_name": "spacy\\matcher\\matcher.pyx", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "108", "deleted_lines": "108"}}}, "file_1": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "spacy\\tests\\regression\\test_issue3549.py", "file_complexity": {"file_NLOC": "10", "file_CCN": "1", "file_NToken": "84"}}}}}