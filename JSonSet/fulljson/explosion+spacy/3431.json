{"BR": {"BR_id": "3431", "BR_author": "emiguevara", "BRopenT": "2019-03-19T15:17:29Z", "BRcloseT": "2019-03-20T11:10:00Z", "BR_text": {"BRsummary": "Doc.vector and Doc.vector_norm not working with GPU", "BRdescription": "\n <denchmark-h:h2>How to reproduce the behaviour</denchmark-h>\n \n <denchmark-code>virtualenv --python=python3.6 env\n source env/bin/activate\n pip install --no-cache-dir spacy[cuda90] jupyter\n python -m spacy download en_core_web_lg\n </denchmark-code>\n \n <denchmark-code>import spacy\n spacy.require_gpu()\n import en_core_web_lg\n nlp = en_core_web_lg.load()\n \n txt = (\n     'A deadly cyclone that struck Mozambique and other countries in southern Africa '\n     'has nearly obliterated the worst-affected areas, flooding vast stretches of land, '\n     'destroying roads and dams, and cutting off victims from help. '\n     'The cyclone, called Idai, has affected more than 1.5 million people, '\n     'with a death toll now in the dozens but feared to be far higher. '\n     'The storm destroyed \u201c90 percent\u201d of Beira, a city of about a half-million '\n     'people that is Mozambique\u2019s fourth largest and faces the Indian Ocean, the '\n     'International Federation of Red Cross and Red Crescent Societies said on Monday.'\n )\n doc = nlp(txt)\n \n print(doc.has_vector)\n print(doc.vector)\n \n True\n ---------------------------------------------------------------------------\n TypeError                                 Traceback (most recent call last)\n <ipython-input-20-93c3a0ab48a5> in <module>\n       1 print(doc.has_vector)\n ----> 2 print(doc.vector)\n \n doc.pyx in __iter__()\n cupy/core/core.pyx in cupy.core.core.ndarray.__add__()\n cupy/core/_kernel.pyx in cupy.core._kernel.ufunc.__call__()\n cupy/core/_kernel.pyx in cupy.core._kernel._preprocess_args()\n TypeError: Unsupported type <class 'numpy.ndarray'>\n </denchmark-code>\n \n <denchmark-code>print(doc.vector_norm)\n ---------------------------------------------------------------------------\n TypeError                                 Traceback (most recent call last)\n <ipython-input-21-1ca711652528> in <module>\n ----> 1 print(doc.vector_norm)\n doc.pyx in spacy.tokens.doc.Doc.vector_norm.__get__()\n doc.pyx in __iter__()\n cupy/core/core.pyx in cupy.core.core.ndarray.__add__()\n cupy/core/_kernel.pyx in cupy.core._kernel.ufunc.__call__()\n cupy/core/_kernel.pyx in cupy.core._kernel._preprocess_args()\n TypeError: Unsupported type <class 'numpy.ndarray'>\n </denchmark-code>\n \n This is most probably related to <denchmark-link:https://github.com/explosion/spaCy/issues/3348>#3348</denchmark-link>\n  and <denchmark-link:https://github.com/explosion/spaCy/issues/3412>#3412</denchmark-link>\n . Maybe the fix in <denchmark-link:https://github.com/explosion/spaCy/pull/3362>#3362</denchmark-link>\n  was not enough.\n NB: other instances of .vector seem to be working fine: for example, Token.vector and Ent.vector\n <denchmark-h:h2>Your Environment</denchmark-h>\n \n \n spaCy version: 2.1.0\n Platform: Linux-4.15.0-46-generic-x86_64-with-Ubuntu-18.04-bionic\n Python version: 3.6.7\n Environment Information: Cuda 9.0, Cudnn 7.5.0\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "emiguevara", "commentT": "2019-04-19T11:59:02Z", "comment_text": "\n \t\tThis thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.\n \t\t"}}}, "commit": {"commit_id": "72889a16d558848191e51f4bfb200e70d3bc413a", "commit_author": "Matthew Honnibal", "commitT": "2019-03-20 12:09:59+01:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "spacy\\tokens\\doc.pyx", "file_new_name": "spacy\\tokens\\doc.pyx", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "419,420,421,430", "deleted_lines": "419,420,429"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "spacy\\tokens\\span.pyx", "file_new_name": "spacy\\tokens\\span.pyx", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "423,424,426,427", "deleted_lines": "423,424,426,427,428,429"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "spacy\\tokens\\token.pyx", "file_new_name": "spacy\\tokens\\token.pyx", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "407,408,409", "deleted_lines": "407"}}}}}}