{"BR": {"BR_id": "4033", "BR_author": "jdunwoody", "BRopenT": "2020-05-28T13:19:57Z", "BRcloseT": "2020-05-28T23:50:40Z", "BR_text": {"BRsummary": "[Solved] Installing mlagents doesn't generate a compatible Tensorflow.", "BRdescription": "\n mlagents-learn generates a stack trace because of Tensorflow with any command\n <denchmark-code>ImportError: DLL load failed: The specified module could not be found.\n </denchmark-code>\n \n a requirements.txt file would be helpful to lock down the various dependencies.\n Tensorflow messageboards suggest downgrading protobuff versions and tensorflow versions. Could someone freeze a recent version of their environment and post it? This might help find a combination of dependencies that work together with the latest release of mlagents.\n To Reproduce\n <denchmark-code>C:\\Projects\\Unity\\ml-agents>python --version\n Python 3.7.7\n </denchmark-code>\n \n <denchmark-code>C:\\Projects\\Unity\\ml-agents>pip list\n Package    Version\n ---------- -------\n pip        20.1.1\n setuptools 41.2.0\n </denchmark-code>\n \n <denchmark-code>C:\\Projects\\Unity\\ml-agents>pip install mlagents --no-cache-dir\n \n C:\\Projects\\Unity\\ml-agents>pip list\n Package                Version\n ---------------------- -----------\n absl-py                0.9.0\n astunparse             1.6.3\n cachetools             4.1.0\n certifi                2020.4.5.1\n chardet                3.0.4\n cloudpickle            1.4.1\n gast                   0.3.3\n google-auth            1.15.0\n google-auth-oauthlib   0.4.1\n google-pasta           0.2.0\n grpcio                 1.29.0\n h5py                   2.10.0\n idna                   2.9\n importlib-metadata     1.6.0\n Keras-Preprocessing    1.1.2\n Markdown               3.2.2\n mlagents               0.16.1\n mlagents-envs          0.16.1\n numpy                  1.18.4\n oauthlib               3.1.0\n opt-einsum             3.2.1\n Pillow                 7.1.2\n pip                    20.1.1\n protobuf               3.12.2\n pyasn1                 0.4.8\n pyasn1-modules         0.2.8\n pypiwin32              223\n pywin32                227\n PyYAML                 5.3.1\n requests               2.23.0\n requests-oauthlib      1.3.0\n rsa                    4.0\n scipy                  1.4.1\n setuptools             41.2.0\n six                    1.15.0\n tensorboard            2.2.1\n tensorboard-plugin-wit 1.6.0.post3\n tensorflow             2.2.0\n tensorflow-estimator   2.2.0\n termcolor              1.1.0\n urllib3                1.25.9\n Werkzeug               1.0.1\n wheel                  0.34.2\n wrapt                  1.12.1\n zipp                   3.1.0\n </denchmark-code>\n \n <denchmark-code>C:\\Projects\\Unity\\ml-agents>mlagents-learn\n Traceback (most recent call last):\n   File \"c:\\python\\python37\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 58, in <module>\n     from tensorflow.python.pywrap_tensorflow_internal import *\n   File \"c:\\python\\python37\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow_internal.py\", line 28, in <module>\n     _pywrap_tensorflow_internal = swig_import_helper()\n   File \"c:\\python\\python37\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow_internal.py\", line 24, in swig_import_helper\n     _mod = imp.load_module('_pywrap_tensorflow_internal', fp, pathname, description)\n   File \"c:\\python\\python37\\lib\\imp.py\", line 242, in load_module\n     return load_dynamic(name, filename, file)\n   File \"c:\\python\\python37\\lib\\imp.py\", line 342, in load_dynamic\n     return _load(spec)\n ImportError: DLL load failed: The specified module could not be found.\n \n During handling of the above exception, another exception occurred:\n \n Traceback (most recent call last):\n   File \"c:\\python\\python37\\lib\\runpy.py\", line 193, in _run_module_as_main\n     \"__main__\", mod_spec)\n   File \"c:\\python\\python37\\lib\\runpy.py\", line 85, in _run_code\n     exec(code, run_globals)\n   File \"C:\\Python\\Python37\\Scripts\\mlagents-learn.exe\\__main__.py\", line 4, in <module>\n   File \"c:\\python\\python37\\lib\\site-packages\\mlagents\\trainers\\learn.py\", line 12, in <module>\n     from mlagents import tf_utils\n   File \"c:\\python\\python37\\lib\\site-packages\\mlagents\\tf_utils\\__init__.py\", line 1, in <module>\n     from mlagents.tf_utils.tf import tf as tf  # noqa\n   File \"c:\\python\\python37\\lib\\site-packages\\mlagents\\tf_utils\\tf.py\", line 3, in <module>\n     import tensorflow as tf  # noqa I201\n   File \"c:\\python\\python37\\lib\\site-packages\\tensorflow\\__init__.py\", line 41, in <module>\n     from tensorflow.python.tools import module_util as _module_util\n   File \"c:\\python\\python37\\lib\\site-packages\\tensorflow\\python\\__init__.py\", line 50, in <module>\n     from tensorflow.python import pywrap_tensorflow\n   File \"c:\\python\\python37\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 69, in <module>\n     raise ImportError(msg)\n ImportError: Traceback (most recent call last):\n   File \"c:\\python\\python37\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 58, in <module>\n     from tensorflow.python.pywrap_tensorflow_internal import *\n   File \"c:\\python\\python37\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow_internal.py\", line 28, in <module>\n     _pywrap_tensorflow_internal = swig_import_helper()\n   File \"c:\\python\\python37\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow_internal.py\", line 24, in swig_import_helper\n     _mod = imp.load_module('_pywrap_tensorflow_internal', fp, pathname, description)\n   File \"c:\\python\\python37\\lib\\imp.py\", line 242, in load_module\n     return load_dynamic(name, filename, file)\n   File \"c:\\python\\python37\\lib\\imp.py\", line 342, in load_dynamic\n     return _load(spec)\n ImportError: DLL load failed: The specified module could not be found.\n \n Failed to load the native TensorFlow runtime.\n \n See https://www.tensorflow.org/install/errors\n \n for some common reasons and solutions.  Include the entire stack trace\n above this error message when asking for help.\n </denchmark-code>\n \n Environment:\n \n Unity Version: 2018.4.23f1\n OS + version: Microsoft Windows 10 Home\n ML-Agents version: release_2_branch\n TensorFlow version: 2.2.0\n Environment: No environment, root directory running mlagents-learn --help`\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jdunwoody", "commentT": "2020-05-28T13:22:08Z", "comment_text": "\n \t\tI have also tried with Anaconda.\n <denchmark-code>> python --version\n Python 3.7.7\n </denchmark-code>\n \n <denchmark-code>> pip list (before install)\n \n Package      Version\n ------------ -------------------\n certifi      2020.4.5.1\n pip          20.0.2\n setuptools   46.4.0.post20200518\n wheel        0.34.2\n wincertstore 0.2\n </denchmark-code>\n \n <denchmark-code>> git status\n On branch release_2_branch\n Your branch is up to date with 'origin/release_2_branch'.\n </denchmark-code>\n \n <denchmark-code>> unity version\n 2018.4.23f1\n </denchmark-code>\n \n <denchmark-code>> ML Agents (com.unity.ml-agents)\n 1.0.2 preview\n </denchmark-code>\n \n <denchmark-code>> pip install mlagents\n \n (Python37MLAgents) C:\\Projects\\Unity\\ml-agents>pip list\n Package                Version\n ---------------------- -------------------\n absl-py                0.9.0\n astunparse             1.6.3\n cachetools             4.1.0\n certifi                2020.4.5.1\n chardet                3.0.4\n cloudpickle            1.4.1\n gast                   0.3.3\n google-auth            1.15.0\n google-auth-oauthlib   0.4.1\n google-pasta           0.2.0\n grpcio                 1.29.0\n h5py                   2.10.0\n idna                   2.9\n importlib-metadata     1.6.0\n Keras-Preprocessing    1.1.2\n Markdown               3.2.2\n mlagents               0.16.1\n mlagents-envs          0.16.1\n numpy                  1.18.4\n oauthlib               3.1.0\n opt-einsum             3.2.1\n Pillow                 7.1.2\n pip                    20.0.2\n protobuf               3.12.2\n pyasn1                 0.4.8\n pyasn1-modules         0.2.8\n pypiwin32              223\n pywin32                227\n PyYAML                 5.3.1\n requests               2.23.0\n requests-oauthlib      1.3.0\n rsa                    4.0\n scipy                  1.4.1\n setuptools             46.4.0.post20200518\n six                    1.15.0\n tensorboard            2.2.1\n tensorboard-plugin-wit 1.6.0.post3\n tensorflow             2.2.0\n tensorflow-estimator   2.2.0\n termcolor              1.1.0\n urllib3                1.25.9\n Werkzeug               1.0.1\n wheel                  0.34.2\n wincertstore           0.2\n wrapt                  1.12.1\n zipp                   3.1.0\n </denchmark-code>\n \n <denchmark-code>(Python37MLAgents) C:\\Projects\\Unity\\ml-agents>mlagents-learn --help\n Traceback (most recent call last):\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 58, in <module>\n     from tensorflow.python.pywrap_tensorflow_internal import *\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow_internal.py\", line 28, in <module>\n     _pywrap_tensorflow_internal = swig_import_helper()\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow_internal.py\", line 24, in swig_import_helper\n     _mod = imp.load_module('_pywrap_tensorflow_internal', fp, pathname, description)\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\imp.py\", line 242, in load_module\n     return load_dynamic(name, filename, file)\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\imp.py\", line 342, in load_dynamic\n     return _load(spec)\n ImportError: DLL load failed: The specified module could not be found.\n \n During handling of the above exception, another exception occurred:\n \n Traceback (most recent call last):\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\runpy.py\", line 193, in _run_module_as_main\n     \"__main__\", mod_spec)\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\runpy.py\", line 85, in _run_code\n     exec(code, run_globals)\n   File \"C:\\python\\anaconda3\\envs\\Python37MLAgents\\Scripts\\mlagents-learn.exe\\__main__.py\", line 4, in <module>\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\mlagents\\trainers\\learn.py\", line 12, in <module>\n     from mlagents import tf_utils\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\mlagents\\tf_utils\\__init__.py\", line 1, in <module>\n     from mlagents.tf_utils.tf import tf as tf  # noqa\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\mlagents\\tf_utils\\tf.py\", line 3, in <module>\n     import tensorflow as tf  # noqa I201\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\tensorflow\\__init__.py\", line 41, in <module>\n     from tensorflow.python.tools import module_util as _module_util\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\tensorflow\\python\\__init__.py\", line 50, in <module>\n     from tensorflow.python import pywrap_tensorflow\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 69, in <module>\n     raise ImportError(msg)\n ImportError: Traceback (most recent call last):\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 58, in <module>\n     from tensorflow.python.pywrap_tensorflow_internal import *\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow_internal.py\", line 28, in <module>\n     _pywrap_tensorflow_internal = swig_import_helper()\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow_internal.py\", line 24, in swig_import_helper\n     _mod = imp.load_module('_pywrap_tensorflow_internal', fp, pathname, description)\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\imp.py\", line 242, in load_module\n     return load_dynamic(name, filename, file)\n   File \"c:\\python\\anaconda3\\envs\\python37mlagents\\lib\\imp.py\", line 342, in load_dynamic\n     return _load(spec)\n ImportError: DLL load failed: The specified module could not be found.\n \n \n Failed to load the native TensorFlow runtime.\n \n See https://www.tensorflow.org/install/errors\n \n for some common reasons and solutions.  Include the entire stack trace\n above this error message when asking for help.\n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jdunwoody", "commentT": "2020-05-28T17:02:06Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/jdunwoody>@jdunwoody</denchmark-link>\n  This appears to be a general tensorflow problem, and not specific to ML-Agents.\n Have you tried this? <denchmark-link:https://github.com/tensorflow/tensorflow/issues/22794#issuecomment-573297027>tensorflow/tensorflow#22794 (comment)</denchmark-link>\n  (which I found by following the link to <denchmark-link:https://www.tensorflow.org/install/errors>https://www.tensorflow.org/install/errors</denchmark-link>\n )\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "jdunwoody", "commentT": "2020-05-28T23:50:40Z", "comment_text": "\n \t\t\n @jdunwoody This appears to be a general tensorflow problem, and not specific to ML-Agents.\n Have you tried this? tensorflow/tensorflow#22794 (comment) (which I found by following the link to https://www.tensorflow.org/install/errors)\n \n That was exactly it! Thankyou very much!\n Here is the solution in case the tensorflow link breaks:\n For this problem\n <denchmark-code>ImportError: DLL load failed: The specified module could not be found.\n </denchmark-code>\n \n Install this\n <denchmark-link:https://support.microsoft.com/en-my/help/2977003/the-latest-supported-visual-c-downloads>https://support.microsoft.com/en-my/help/2977003/the-latest-supported-visual-c-downloads</denchmark-link>\n \n I also looked into the Tensorflow messageboards for reasons for this error but didn't get to the bottom of the discussion - to find this gem! Too many suggestions from the Tensorflow community suggesting various combinations of protobuf, tensorflow and cuda that I couldn't find a combination that works.\n Would it be worthwhile adding this dependency to the mlagents installation docs, given that this requirement is now default for Linux and Windows Tensforflow?\n I can raise a pull request if you'd like me to do it.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "jdunwoody", "commentT": "2020-05-29T00:38:59Z", "comment_text": "\n \t\tGlad that fixed it!\n I think we should definitely add it to the FAQ here: <denchmark-link:https://github.com/Unity-Technologies/ml-agents/blob/master/docs/FAQ.md#tensorflow-dependency>https://github.com/Unity-Technologies/ml-agents/blob/master/docs/FAQ.md#tensorflow-dependency</denchmark-link>\n \n An additional option would be to do a try-catch around the tensorflow import here \n \n \n ml-agents/ml-agents/mlagents/tf_utils/tf.py\n \n \n          Line 3\n       in\n       801c05b\n \n \n \n \n \n \n  import tensorflow as tf # noqa I201 \n \n \n \n \n \n and log a better error message if the exception contains \"DLL load failed\". I like this option since it keeps the solution close to the problem, unfortunately I'm not on Windows so it's hard for me to test.\n As for the installation instructions, <denchmark-link:https://github.com/mmattar>@mmattar</denchmark-link>\n  (who's currently on PTO until the end of the week) has some opinions on what should and shouldn't go in the install guide, and recently rewrote some large swaths of it.\n If you want to make a pull request for either the FAQ or the try-catch, please do. You're welcome to for the installation instructions too, it just might take a few days to get it reviewed.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "jdunwoody", "commentT": "2020-05-29T00:58:21Z", "comment_text": "\n \t\tI'll submit a PR for at least the FAQ. I'll see how the guard code could work.\n Thanks again for your response and suggestion.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "jdunwoody", "commentT": "2020-09-04T05:58:56Z", "comment_text": "\n \t\tCould this be made more obvious in the Installation Guide? I think it should be mentioned there pretty clearly, since I only found out the solution to this problem by searching through previous issues and finding this. I didn't even consider looking for a FAQ since I interpreted Tensorflow's problem as a problem or bug rather than a question.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "jdunwoody", "commentT": "2020-09-04T06:12:39Z", "comment_text": "\n \t\tActually my bad, repairing the C++ redistributables did not solve my problem. I still get the following:\n <denchmark-code>Python 3.7.9 (tags/v3.7.9:13c94747c7, Aug 17 2020, 18:58:18) [MSC v.1900 64 bit (AMD64)] on win32\n Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n >>> import tensorflow\n 2020-09-04 01:08:21.885272: W tensorflow/stream_executor/platform/default/dso_loader.cc:59] Could not load dynamic library 'cudart64_101.dll'; dlerror: cudart64_101.dll not found\n 2020-09-04 01:08:21.888741: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n </denchmark-code>\n \n (not sure why it says win32, I'm definitely 64-bit)\n EDIT: Needed to restart after CUDA install, ok good now ^_^\n \t\t"}}}, "commit": {"commit_id": "791803b6550dc1f6fd31c08a49c847284a4b020f", "commit_author": "James Dunwoody", "commitT": "2020-05-28 21:57:19-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\FAQ.md", "file_new_name": "docs\\FAQ.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "36,37,38,39,40,41,42,43,44,45,46,47,48,49", "deleted_lines": null}}}}}}