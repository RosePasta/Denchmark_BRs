{"BR": {"BR_id": "4598", "BR_author": "Bobgy", "BRopenT": "2019-12-24T08:41:03Z", "BRcloseT": "2020-01-25T05:31:02Z", "BR_text": {"BRsummary": "Central-dashboard doesn't sync iframe url to document when navigation happens programmatically", "BRdescription": "\n /kind bug\n This is a corner case of <denchmark-link:https://github.com/kubeflow/kubeflow/issues/3042>#3042</denchmark-link>\n \n What steps did you take and what happened:\n \n Use pipelines UI\n Clone an existing run\n It goes to experiment page with run list\n Refresh page\n \n Bug: it goes back to clone run page\n Expected: it should stay in experiment page\n Anything else you would like to add:\n Env: in kubeflow deployment (I verified KFP standalone doesn't have this bug)\n When the page is in the bug state, location of KFP iframe is <denchmark-link:https://multiuser-bugbash.endpoints.gongyuan-pipeline-test.cloud.goog/pipeline/#/experiments/details/a984b224-e675-4dae-960f-ba0254d0940a>https://multiuser-bugbash.endpoints.gongyuan-pipeline-test.cloud.goog/pipeline/#/experiments/details/a984b224-e675-4dae-960f-ba0254d0940a</denchmark-link>\n , but the root page is <denchmark-link:https://multiuser-bugbash.endpoints.gongyuan-pipeline-test.cloud.goog/_/pipeline/?ns=kubeflow-gongyuan#/runs/new?cloneFromRun=88b132f6-f414-48ce-b223-3ffab1e3b271>https://multiuser-bugbash.endpoints.gongyuan-pipeline-test.cloud.goog/_/pipeline/?ns=kubeflow-gongyuan#/runs/new?cloneFromRun=88b132f6-f414-48ce-b223-3ffab1e3b271</denchmark-link>\n \n The path mismatch is the problem. Somehow centraldashboard didn't update this navigation.\n I did some investigation and found the root cause:\n Central dashboard detects iframe url change every time a click happens and syncs it to root url: <denchmark-link:https://github.com/kubeflow/kubeflow/blob/master/components/centraldashboard/public/components/iframe-container.js#L54>https://github.com/kubeflow/kubeflow/blob/master/components/centraldashboard/public/components/iframe-container.js#L54</denchmark-link>\n \n and <denchmark-link:https://github.com/kubeflow/kubeflow/blob/master/components/centraldashboard/public/components/main-page.js#L264>https://github.com/kubeflow/kubeflow/blob/master/components/centraldashboard/public/components/main-page.js#L264</denchmark-link>\n \n However, in this bug, the navigation happens in this sequence:\n \n user clicks create button\n a network request is sent to create the run\n when the request returns successfully, navigate to run list page\n \n Therefore, the navigation hasn't happened when page was clicked, so it isn't captured by central dashboard.\n I think it would be too complex if central dashboard monitors every type of event that might trigger a navigation.\n Two choices:\n \n Also monitors for https://developer.mozilla.org/en-US/docs/Web/API/Window/hashchange_event of the iframe. This should work with clients using hash navigation.\n Add a timer which checks url updates every second. (In cases other than click, I think 1 second delay of syncing back the url is good enough)\n \n What do you think about this?\n Environment:\n \n Kubeflow version: (version number can be found at the bottom left corner of the Kubeflow dashboard): 0.7.0\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Bobgy", "commentT": "2019-12-24T08:41:06Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the label kind/bug to this issue, with a confidence of 0.99. Please mark this comment with \ud83d\udc4d or \ud83d\udc4e to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Bobgy", "commentT": "2019-12-24T08:41:30Z", "comment_text": "\n \t\t/area centraldashboard\n /assign <denchmark-link:https://github.com/prodonjs>@prodonjs</denchmark-link>\n \n /assign <denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "Bobgy", "commentT": "2020-01-06T05:29:51Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/prodonjs>@prodonjs</denchmark-link>\n  <denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n \n Ping after holiday. Any thoughts?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "Bobgy", "commentT": "2020-01-06T14:49:33Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Bobgy>@Bobgy</denchmark-link>\n  - Thanks for the excellent analysis!\n /cc <denchmark-link:https://github.com/kwasi>@kwasi</denchmark-link>\n  who is now working on Kubeflow front-end projects with <denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n .\n TL;DR - Sounds like either the hashchange trigger or polling after a click are viable options and would be good for quick fixes. Long term, it makes sense to investigate better integration between the applications and centraldashboard by extending the event handling library if team cycles permit.\n This is definitely an edge case that the currently implementation fails to provide an adequate solution for. I think your solution of adding some sort of polling for a navigation change after a click event would work. I would imagine that we'd want to place some sort of upper bound on the number of polls  (maybe 5s?). However, if it's really just Pipelines (and possibly Metadata) that we're concerned about, and both of them use hash-based routing, perhaps the hashchange event is the better option.\n We did write a relatively simple library that could be included in the iframed-application code (<denchmark-link:https://github.com/kubeflow/kubeflow/blob/master/components/centraldashboard/public/library.js>https://github.com/kubeflow/kubeflow/blob/master/components/centraldashboard/public/library.js</denchmark-link>\n ). However, that would require more extensive work on both the Central Dashboard and Pipelines codebases to build the more sophisticated integration. I do think that in the long run, doing something like this would be advantageous rather than finding these different edge cases and fixing them as one offs. However, I'm not really involved in the KF front-end work at this time so I can't speak for what the plans are for the year and how this might fit in.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "Bobgy", "commentT": "2020-01-06T14:49:53Z", "comment_text": "\n \t\t/assign <denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "Bobgy", "commentT": "2020-01-07T03:23:01Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/prodonjs>@prodonjs</denchmark-link>\n  for shedding some light on this.\n To clarify, I didn't mean polling after click. Just periodic polling sounds better. This event handler is very lightweight, I don't think it will cause any problems.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "Bobgy", "commentT": "2020-01-07T19:33:18Z", "comment_text": "\n \t\t/priority p1\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "Bobgy", "commentT": "2020-01-22T07:41:57Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n  any chance this can be dealt with soon?\n I can submit a PR too if you are busy.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "Bobgy", "commentT": "2020-01-23T02:54:06Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/Bobgy>@Bobgy</denchmark-link>\n , I don't have cycles till mid-Feb to tackle any more Kubeflow task items (since I'm heads down on MLMD work currently). I'm more than happy to review any PRs you send my way though :)\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "Bobgy", "commentT": "2020-01-23T03:13:12Z", "comment_text": "\n \t\tNo problem, I will submit a PR for this.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "Bobgy", "commentT": "2020-01-23T03:14:58Z", "comment_text": "\n \t\t/assign <denchmark-link:https://github.com/Bobgy>@Bobgy</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "b14004469f4e45b6d48e5554e92c408783ace46a", "commit_author": "Yuan (Bob) Gong", "commitT": "2020-01-24 21:31:01-08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "components\\centraldashboard\\public\\components\\iframe-container.js", "file_new_name": "components\\centraldashboard\\public\\components\\iframe-container.js", "file_complexity": {"file_NLOC": "84", "file_CCN": "14", "file_NToken": "413"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "54,61", "deleted_lines": "54,61", "method_info": {"method_name": "syncIframePage", "method_params": "", "method_startline": "54", "method_endline": "61", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "43", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "54,61,62,63,64", "deleted_lines": "54,61", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "53", "method_endline": "65", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "35", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "54,61,62,63,64", "deleted_lines": "54,61", "method_info": {"method_name": "ready", "method_params": "", "method_startline": "44", "method_endline": "66", "method_complexity": {"method_NLOC": "8", "method_CCN": "1", "method_NToken": "61", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "components\\centraldashboard\\public\\components\\iframe-container_test.js", "file_new_name": "components\\centraldashboard\\public\\components\\iframe-container_test.js", "file_complexity": {"file_NLOC": "104", "file_CCN": "11", "file_NToken": "642"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "82,83,84,85,86,87,88,89,90,91,92,93,94", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "82", "method_endline": "94", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "85", "method_nesting_level": "0"}}}}}}}}