{"BR": {"BR_id": "3520", "BR_author": "jlewi", "BRopenT": "2019-06-21T14:15:07Z", "BRcloseT": "2019-11-07T23:35:30Z", "BR_text": {"BRsummary": "Fix dynamic loading of platform plugins", "BRdescription": "\n <denchmark-link:https://github.com/kubeflow/kubeflow/pull/3045>#3045</denchmark-link>\n  disabled dynamic loading in kfctl of KfApp plugins for platforms. Plugins are still supported for the package manager.\n The relevant change is here\n <denchmark-link:https://github.com/kubeflow/kubeflow/tree/1c07de4d4825f381062c7d7091398b837113b7f1/bootstrap/pkg/kfapp>https://github.com/kubeflow/kubeflow/tree/1c07de4d4825f381062c7d7091398b837113b7f1/bootstrap/pkg/kfapp</denchmark-link>\n \n Specifically getPlatform no longer calls LoadKfApp to dynamically load the plugin if there is no match.\n This change was made because getPlatform's return type was changed to kftypes.Platform which is no longer compatible with LoadKfApp.\n This was changed because <denchmark-link:https://github.com/kubeflow/kubeflow/pull/3045>#3045</denchmark-link>\n  also introduced the interface kfTypes.Platform in order to add a GetK8sConfig method to allow plugins to configure how K8s credentials are obtained.\n Possible fixes\n \n \n Define a LoadKfPlatform method that would dynamically load platform plugins\n \n Code would be similar to LoadKfApp but return type kftypes.Platform\n \n \n \n Get rid of kftypes.Platform by adding GetK8sConfig to the KfApp interface\n \n It could be a null op in the case of package managers.\n \n \n \n Also related to <denchmark-link:https://github.com/kubeflow/kubeflow/issues/3518>#3518</denchmark-link>\n  which suggests adopting semantics like reconcile.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jlewi", "commentT": "2019-06-21T14:15:10Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the label kind/bug to this issue, with a confidence of 0.56. Please mark this comment with \ud83d\udc4d or \ud83d\udc4e to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jlewi", "commentT": "2019-06-24T15:28:12Z", "comment_text": "\n \t\tThis will be fixed in an upcoming PR in which I add plugins to KFDef.Spec and allow each plugin to provide an arbitrary struct as a runtime.RawExtension\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "jlewi", "commentT": "2019-07-22T01:40:41Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/kubeflow/kubeflow/pull/3651>#3651</denchmark-link>\n  refactored the coordinator code.\n PackageManagers and Platforms should now have the same interface; platforms no longer take extra args during construction.\n It should not be relatively straightforward to add back dynamic loading of plugins.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "jlewi", "commentT": "2019-11-04T23:38:58Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/jlewi>@jlewi</denchmark-link>\n  I think this was fixed?\n \t\t"}}}, "commit": {"commit_id": "36b8f619e9c4f2dc43496c8e620f5b046f68979f", "commit_author": "Jeremy Lewi", "commitT": "2019-07-02 14:43:11-07:00", "commit_complexity": {"commit_NLOC": "0.12361331220285261", "commit_CCN": "0.49128367670364503", "commit_Nprams": "0.9144215530903328"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "bootstrap\\cmd\\bootstrap\\app\\kfctlUtil.go", "file_new_name": "bootstrap\\cmd\\bootstrap\\app\\kfctlUtil.go", "file_complexity": {"file_NLOC": "36", "file_CCN": "3", "file_NToken": "217"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102", "deleted_lines": "46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103", "method_info": {"method_name": "DeployWithKfctl", "method_params": "CreateRequest", "method_startline": "38", "method_endline": "103", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "22", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\go.mod", "file_new_name": "bootstrap\\go.mod", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "34", "deleted_lines": "34"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "bootstrap\\pkg\\kfapp\\coordinator\\coordinator.go", "file_new_name": "bootstrap\\pkg\\kfapp\\coordinator\\coordinator.go", "file_complexity": {"file_NLOC": "768", "file_CCN": "115", "file_NToken": "5044"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "136,141", "deleted_lines": "136,137,138,139,140,145", "method_info": {"method_name": "getPlatform", "method_params": "KfDef", "method_startline": "136", "method_endline": "150", "method_complexity": {"method_NLOC": "13", "method_CCN": "4", "method_NToken": "102", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "654", "deleted_lines": null, "method_info": {"method_name": "LoadKfAppCfgFile", "method_params": "string", "method_startline": "644", "method_endline": "656", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "72", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "67,76", "deleted_lines": "67,76", "method_info": {"method_name": "GetKfApp", "method_params": "KfDef,byte", "method_startline": "67", "method_endline": "86", "method_complexity": {"method_NLOC": "19", "method_CCN": "4", "method_NToken": "107", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "67,76", "deleted_lines": "67,76", "method_info": {"method_name": "GetKfApp", "method_params": "KfDef", "method_startline": "67", "method_endline": "86", "method_complexity": {"method_NLOC": "19", "method_CCN": "4", "method_NToken": "100", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "141", "deleted_lines": "140,145", "method_info": {"method_name": "getPlatform", "method_params": "KfDef,byte", "method_startline": "140", "method_endline": "154", "method_complexity": {"method_NLOC": "13", "method_CCN": "4", "method_NToken": "109", "method_nesting_level": "0"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 13, "file_old_name": "bootstrap\\pkg\\kfapp\\gcp\\gcp.go", "file_new_name": "bootstrap\\pkg\\kfapp\\gcp\\gcp.go", "file_complexity": {"file_NLOC": "1629", "file_CCN": "61", "file_NToken": "11615"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "203,204,207,212", "deleted_lines": "202,205,210,211,212", "method_info": {"method_name": "getAccount", "method_params": "", "method_startline": "202", "method_endline": "213", "method_complexity": {"method_NLOC": "12", "method_CCN": "2", "method_NToken": "85", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "102,103,104", "deleted_lines": "102,103,104", "method_info": {"method_name": "SetTokenSource", "method_params": "TokenSource", "method_startline": "102", "method_endline": "105", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "23", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "204,207,212", "deleted_lines": "205,210,211,212", "method_info": {"method_name": "getGcloudDefaultAccount", "method_params": "", "method_startline": "204", "method_endline": "213", "method_complexity": {"method_NLOC": "10", "method_CCN": "2", "method_NToken": "78", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "113,114,115,116,117,119", "deleted_lines": "113,114,115,116,117", "method_info": {"method_name": "getDefaultArgs", "method_params": "", "method_startline": "113", "method_endline": "119", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "23", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "182,183,184,185,186,190,191,192,193,194,195,199", "deleted_lines": "188,192,193,197,201", "method_info": {"method_name": "GetK8sConfig", "method_params": "", "method_startline": "181", "method_endline": "201", "method_complexity": {"method_NLOC": "14", "method_CCN": "3", "method_NToken": "109", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "503,507,508,509,510,511,512,513,514,515,516,517,519", "deleted_lines": "508,512,513,514,525", "method_info": {"method_name": "ConfigK8s", "method_params": "", "method_startline": "497", "method_endline": "525", "method_complexity": {"method_NLOC": "23", "method_CCN": "6", "method_NToken": "122", "method_nesting_level": "0"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,138,140,141,142,143,144,145,146,147,148,150,151,152,154,156,157,159,161,162,163,164,165", "deleted_lines": "122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,142,143,144,145,146,147,148,149,150,152,153,155,156,157,158,161,162,163,164,165,166,168,169,170,171,172,173", "method_info": {"method_name": "GetPlatform", "method_params": "KfDef,byte", "method_startline": "122", "method_endline": "174", "method_complexity": {"method_NLOC": "53", "method_CCN": "8", "method_NToken": "321", "method_nesting_level": "0"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "133,134,135,136,138,140,141,142,143,144,145,146,147,148,150,151,152,154,156,157,159,161,162,163,164,165", "deleted_lines": "133,134,135,136,137,138,139,142,143,144,145,146,147,148,149,150,152,153,155,156,157,158,161,162,163,164,165,166", "method_info": {"method_name": "initGcpClient", "method_params": "", "method_startline": "133", "method_endline": "166", "method_complexity": {"method_NLOC": "23", "method_CCN": "5", "method_NToken": "151", "method_nesting_level": "0"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "369,386", "deleted_lines": "374,391", "method_info": {"method_name": "updateDeployment", "method_params": "Service,string,string", "method_startline": "367", "method_endline": "422", "method_complexity": {"method_NLOC": "54", "method_CCN": "6", "method_NToken": "378", "method_nesting_level": "0"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "123,124,125,126,127,128,129,130", "deleted_lines": "123,124,125,126,127,128,129,130", "method_info": {"method_name": "GetPluginSpec", "method_params": "", "method_startline": "123", "method_endline": "130", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "39", "method_nesting_level": "0"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "297,298", "deleted_lines": "302,303", "method_info": {"method_name": "getK8sClientset", "method_params": "Context", "method_startline": "296", "method_endline": "321", "method_complexity": {"method_NLOC": "25", "method_CCN": "4", "method_NToken": "198", "method_nesting_level": "0"}}}, "hunk_11": {"Ismethod": 1, "added_lines": "114,115,116,117,119", "deleted_lines": "114,115,116,117", "method_info": {"method_name": "GetPlatform", "method_params": "KfDef", "method_startline": "114", "method_endline": "120", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "36", "method_nesting_level": "0"}}}, "hunk_12": {"Ismethod": 1, "added_lines": "216,217,218,219", "deleted_lines": "216,217,218,219,220,221,222,223,224", "method_info": {"method_name": "writeConfigFile", "method_params": "", "method_startline": "215", "method_endline": "227", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "75", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "bootstrap\\pkg\\kfapp\\gcp\\gcp_plugin.go", "file_complexity": {"file_NLOC": "62", "file_CCN": "10", "file_NToken": "278"}}, "file_5": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "bootstrap\\pkg\\kfapp\\gcp\\gcp_plugin_test.go", "file_complexity": {"file_NLOC": "115", "file_CCN": "3", "file_NToken": "414"}}, "file_6": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "bootstrap\\pkg\\kfapp\\gcp\\gcp_test.go", "file_complexity": {"file_NLOC": "343", "file_CCN": "25", "file_NToken": "1591"}}, "file_7": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "bootstrap\\pkg\\kfapp\\gcp\\testdata\\doc.go", "file_complexity": {"file_NLOC": "1", "file_CCN": "0", "file_NToken": "2"}}, "file_8": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "bootstrap\\pkg\\kfapp\\gcp\\testdata\\kfctl_gcp.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "bootstrap\\v2\\pkg\\apis\\apps\\kfdef\\v1alpha1\\application_types.go", "file_new_name": "bootstrap\\v2\\pkg\\apis\\apps\\kfdef\\v1alpha1\\application_types.go", "file_complexity": {"file_NLOC": "406", "file_CCN": "58", "file_NToken": "2400"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "528,529,530,531,532,533", "method_info": {"method_name": "GetPluginSpec", "method_params": "string", "method_startline": "528", "method_endline": "533", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "39", "method_nesting_level": "0"}}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 7, "file_old_name": "bootstrap\\v2\\pkg\\apis\\apps\\kfdef\\v1alpha1\\zz_generated.deepcopy.go", "file_new_name": "bootstrap\\v2\\pkg\\apis\\apps\\kfdef\\v1alpha1\\zz_generated.deepcopy.go", "file_complexity": {"file_NLOC": "532", "file_CCN": "130", "file_NToken": "3074"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "214,215,216,217,218,219,220", "deleted_lines": null, "method_info": {"method_name": "DeepCopyInto", "method_params": "KfDefSpec", "method_startline": "192", "method_endline": "222", "method_complexity": {"method_NLOC": "31", "method_CCN": "8", "method_NToken": "264", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408", "deleted_lines": null, "method_info": {"method_name": "DeepCopyInto", "method_params": "KustomizeConfig", "method_startline": "390", "method_endline": "408", "method_complexity": {"method_NLOC": "19", "method_CCN": "4", "method_NToken": "143", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "76,77,78,79,80,81,82,83,84", "deleted_lines": null, "method_info": {"method_name": "DeepCopyInto", "method_params": "Application", "method_startline": "76", "method_endline": "84", "method_complexity": {"method_NLOC": "9", "method_CCN": "2", "method_NToken": "58", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "581,582,583,584", "deleted_lines": null, "method_info": {"method_name": "DeepCopyInto", "method_params": "RepoRef", "method_startline": "581", "method_endline": "584", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "20", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "411,412,413,414,415,416,417,418", "deleted_lines": null, "method_info": {"method_name": "DeepCopy", "method_params": "", "method_startline": "411", "method_endline": "418", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "35", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "87,88,89,90,91,92,93,94", "deleted_lines": null, "method_info": {"method_name": "DeepCopy", "method_params": "", "method_startline": "87", "method_endline": "94", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "35", "method_nesting_level": "0"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "587,588,589,590,591,592,593,594", "deleted_lines": null, "method_info": {"method_name": "DeepCopy", "method_params": "", "method_startline": "587", "method_endline": "594", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "35", "method_nesting_level": "0"}}}}}}}}