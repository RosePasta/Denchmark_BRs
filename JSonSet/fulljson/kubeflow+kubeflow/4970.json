{"BR": {"BR_id": "4970", "BR_author": "lalithvaka", "BRopenT": "2020-04-20T23:11:01Z", "BRcloseT": "2020-07-03T00:13:13Z", "BR_text": {"BRsummary": "Manage contributor add failure - rolebinding unique name issue", "BRdescription": "\n /kind bug\n \n Manage contributor screen. Adding a contributor creates a role binding / service role binding with name including userID's first character by ignoring the digits and not able to add other users with similar numbers.\n our Org uses UserIDs as <denchmark-link:mailto:a1234@xx.org>a1234@xx.org</denchmark-link>\n , <denchmark-link:mailto:a2345@xx.org>a2345@xx.org</denchmark-link>\n .\n <denchmark-link:https://user-images.githubusercontent.com/8292387/79807750-b2317800-8320-11ea-8939-a32d2bf33618.png></denchmark-link>\n \n <denchmark-link:https://user-images.githubusercontent.com/8292387/79807788-c2495780-8320-11ea-9654-67fdbca24cca.png></denchmark-link>\n \n What did you expect to happen:\n rolebinding and service role bindings names to use digits too\n Anything else you would like to add:\n [Miscellaneous information that will assist in solving the issue.]\n Environment:\n \n Kubeflow version: (version number can be found at the bottom left corner of the Kubeflow dashboard):1.0.2\n kfctl version: (use kfctl version):\n Kubernetes platform: (e.g. minikube)\n Kubernetes version: (use kubectl version):\n OS (e.g. from /etc/os-release):\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "lalithvaka", "commentT": "2020-04-20T23:11:10Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the labels:\n \n \n \n Label\n Probability\n \n \n \n \n kind/bug\n 0.95\n \n \n \n Please mark this comment with  or  to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://github.com/marketplace/issue-label-botdata/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "lalithvaka", "commentT": "2020-04-26T17:06:16Z", "comment_text": "\n \t\tThis is the code that decides the name of RoleBindings/ServiceRoleBindings:\n \n \n \n kubeflow/components/access-management/kfam/bindings.go\n \n \n         Lines 56 to 72\n       in\n       8f8e348\n \n \n \n \n \n \n  //getBindingName returns bindingName, which is combination of user kind, username, RoleRef kind, RoleRef name. \n \n \n \n  func getBindingName(binding *Binding) (string, error) { \n \n \n \n  nameRaw := strings.ToLower( \n \n \n \n  strings.Join([]string{ \n \n \n \n  binding.User.Kind, \n \n \n \n  url.QueryEscape(binding.User.Name), \n \n \n \n  binding.RoleRef.Kind, \n \n \n \n  binding.RoleRef.Name, \n \n \n \n  \t\t},\"-\"), \n \n \n \n  \t) \n \n \n \n  // Only keep lower case letters, replace other with - \n \n \n \n  reg, err := regexp.Compile(\"[^a-z]+\") \n \n \n \n  if err != nil { \n \n \n \n  return \"\", err \n \n \n \n  \t} \n \n \n \n  return reg.ReplaceAllString(nameRaw, \"-\"), nil \n \n \n \n  } \n \n \n \n \n \n We should probably amend that logic.\n I'm not sure what priority to put on this.\n We should decide our plans for the contributor UI first, because if we are moving towards a GitOps approach, the contributor UI becomes less valuable.\n On the other hand, this should be an easy fix if we can decide on what naming rule to use.\n /area multiuser\n cc <denchmark-link:https://github.com/jlewi>@jlewi</denchmark-link>\n  <denchmark-link:https://github.com/kunmingg>@kunmingg</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "lalithvaka", "commentT": "2020-04-26T20:48:24Z", "comment_text": "\n \t\tThank you <denchmark-link:https://github.com/yanniszark>@yanniszark</denchmark-link>\n  , I was able to fix this code(with my limited go knowledge) to support numbers in the email address. This changes  email address to <denchmark-link:mailto:i397401@zq.msds.kp.org>i397401@zq.msds.kp.org</denchmark-link>\n  to i397401-zq-msds-kp-org which is being used in the role binding names.\n //getBindingName returns bindingName, which is combination of user kind, username, RoleRef kind, RoleRef name.\n func getBindingName(binding *Binding) (string, error) {\n \t// Only keep lower case letters, replace other with -\n \treg, err := regexp.Compile(\"[^a-z0-9]+\")\n \tif err != nil {\n \t\treturn \"\", err\n \t}\n \tnameRaw := strings.ToLower(\n \t\tstrings.Join([]string{\n \t\t\tbinding.User.Kind,\n \t\t\turl.QueryEscape(reg.ReplaceAllString(binding.User.Name, \"-\")),\n \t\t\tbinding.RoleRef.Kind,\n \t\t\tbinding.RoleRef.Name,\n \t\t}, \"-\"),\n \t)\n \n \treturn reg.ReplaceAllString(nameRaw, \"-\"), nil\n }\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "lalithvaka", "commentT": "2020-04-27T02:35:03Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/yanniszark>@yanniszark</denchmark-link>\n  submitted a pull request - <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4979>#4979</denchmark-link>\n \n /area multiuser\n cc <denchmark-link:https://github.com/jlewi>@jlewi</denchmark-link>\n  <denchmark-link:https://github.com/kunmingg>@kunmingg</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "4bf2d4131a5aebe0f1b53d36dd94031f88426c0b", "commit_author": "Lalith Vaka", "commitT": "2020-05-23 17:37:10-07:00", "commit_complexity": {"commit_NLOC": "0.6428571428571429", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "components\\access-management\\kfam\\bindings.go", "file_new_name": "components\\access-management\\kfam\\bindings.go", "file_complexity": {"file_NLOC": "177", "file_CCN": "21", "file_NToken": "1018"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "59,60,61,62,63,67,70,72", "deleted_lines": "61,64,66,67,68,69,70", "method_info": {"method_name": "getBindingName", "method_params": "Binding", "method_startline": "58", "method_endline": "74", "method_complexity": {"method_NLOC": "15", "method_CCN": "2", "method_NToken": "101", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "85,89,90,105,106", "deleted_lines": "83,87,88,103,104", "method_info": {"method_name": "Create", "method_params": "Binding,string,string", "method_startline": "76", "method_endline": "128", "method_complexity": {"method_NLOC": "50", "method_CCN": "3", "method_NToken": "321", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "195,196,197,198,199,200,201,202,203", "deleted_lines": "193,194,195,196,197,198,199,200,201,202,203,204", "method_info": {"method_name": "List", "method_params": "string,string,string", "method_startline": "168", "method_endline": "211", "method_complexity": {"method_NLOC": "44", "method_CCN": "11", "method_NToken": "257", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "components\\access-management\\kfam\\bindings_test.go", "file_complexity": {"file_NLOC": "48", "file_CCN": "8", "file_NToken": "255"}}}}}