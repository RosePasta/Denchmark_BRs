{"BR": {"BR_id": "3805", "BR_author": "tlkh", "BRopenT": "2019-08-01T14:54:08Z", "BRcloseT": "2019-08-19T18:37:31Z", "BR_text": {"BRsummary": "Dex login is not enforced (Onprem existing_arrikto config)", "BRdescription": "\n /kind bug\n What steps did you take and what happened:\n On a freshly installed Kubernetes on-prem (single node for testing), Kubeflow deploys successfully (used MetalLB for LoadBalancer). Following instruction on <denchmark-link:https://www.kubeflow.org/docs/started/getting-started-k8s/>this page</denchmark-link>\n  under \"Log in as a static user\", I can reach the dashboard right away by adding the port number, thus bypassing the Dex authentication mechanism.\n Working:\n \n https://ip-addr/ directs me correctly to the Dex login screen\n https://ip-addr:5556/dex/auth/local?req=xxx directs me correctly to the Dex login screen\n Wrong passwords on the login screen are rejected, so that part seems to be working.\n \n Not Working:\n \n https://172.17.31.15:5556/ lets me access the central dashboard right away (tested again with Incognito and other devices)\n In central dashboard, even after login, the user (top right) shows as anonymous@kubeflow.org\n \n What did you expect to happen:\n Expected behaviour is for an unauthenticated user to be forced to login, and not able to bypass and reach the central dashboard. In addition, the correct user (eg email) should be shown in central dashboard.\n Environment:\n \n Kubeflow version: 0.6\n kfctl version: (use kfctl version): 0.6\n Kubernetes platform: (e.g. minikube) On-prem (existing_arrikto)\n Kubernetes version: (use kubectl version): 1.15.1\n OS (e.g. from /etc/os-release): Ubuntu 18.04.2 LTS\n \n Anything else you would like to add:\n Some of the pods don't seem to be deploy correctly, but I don't think that should affect the authentication mechanism. When checking logs, it seems to be some kind of permission errors.\n <denchmark-code>> kubectl logs mysql-75654987c5-vj75v -n kubeflow\n chown: changing ownership of '/var/lib/mysql/': Operation not permitted\n \n > kubectl logs metadata-db-8d9b95598-p5928 -n kubeflow\n chown: changing ownership of '/var/lib/mysql/datadir/': Operation not permitted\n </denchmark-code>\n \n Output from kubectl get pods -n kubeflow:\n <denchmark-code>admission-webhook-bootstrap-stateful-set-0                  1/1     Running            0          26m\n admission-webhook-deployment-b77bd65c5-gzp6s                1/1     Running            0          26m\n argo-ui-6db54c878-95pp7                                     1/1     Running            0          26m\n centraldashboard-7b69b696cb-74668                           1/1     Running            0          26m\n dex-6847f88df6-x27kh                                        1/1     Running            0          26m\n jupyter-web-app-deployment-fbb87f9d-wqdqs                   1/1     Running            0          26m\n katib-controller-55ccdcc6c8-dml4t                           1/1     Running            1          26m\n katib-db-b48df7777-s9h9t                                    0/1     CrashLoopBackOff   10         26m\n katib-manager-6944b56f96-r64bb                              0/1     CrashLoopBackOff   11         26m\n katib-manager-rest-6f6b8f4b54-mpkkz                         1/1     Running            0          26m\n katib-suggestion-bayesianoptimization-66c6764d5b-jm2sm      1/1     Running            0          26m\n katib-suggestion-grid-5c758dbf4b-bcwvw                      1/1     Running            0          26m\n katib-suggestion-hyperband-76cdd95f46-6cll6                 1/1     Running            0          26m\n katib-suggestion-nasrl-6bc7855ddd-b5dsg                     1/1     Running            0          26m\n katib-suggestion-random-65c489b584-rflf4                    1/1     Running            0          26m\n katib-ui-57bcbb9f56-khhbr                                   1/1     Running            0          26m\n metacontroller-0                                            1/1     Running            0          26m\n metadata-db-8d9b95598-p5928                                 0/1     CrashLoopBackOff   10         26m\n metadata-deployment-545d79c747-6w6zb                        0/1     CrashLoopBackOff   9          26m\n metadata-deployment-545d79c747-bx4hh                        0/1     CrashLoopBackOff   9          26m\n metadata-deployment-545d79c747-zpckv                        0/1     Error              10         26m\n metadata-ui-76b5498765-dn2nq                                1/1     Running            0          26m\n minio-56dc668bd-2768b                                       1/1     Running            0          26m\n ml-pipeline-567b7d6b44-zhhb9                                1/1     Running            3          26m\n ml-pipeline-persistenceagent-69f558486c-9gj4p               0/1     CrashLoopBackOff   6          26m\n ml-pipeline-scheduledworkflow-869954f57c-pzcgs              1/1     Running            0          26m\n ml-pipeline-ui-c8d7b55cc-6w6b8                              1/1     Running            0          26m\n ml-pipeline-viewer-controller-deployment-566d875695-jhzqp   1/1     Running            0          26m\n mysql-75654987c5-vj75v                                      0/1     Error              10         26m\n notebook-controller-deployment-58c6c5d8cc-qf6kr             1/1     Running            0          26m\n profiles-deployment-7f8d45c9f9-9nw6s                        2/2     Running            0          26m\n pytorch-operator-69d875b748-k4w7h                           1/1     Running            0          26m\n spartakus-volunteer-6cfc55fd88-gwpgh                        1/1     Running            0          26m\n tensorboard-5f685f9d79-gq67h                                1/1     Running            0          26m\n tf-job-dashboard-5fc794cc7c-2xdbs                           1/1     Running            0          26m\n tf-job-operator-6c9674bcd8-nfg4t                            1/1     Running            0          26m\n workflow-controller-5b4764bc47-97grs                        1/1     Running            0          26m\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "tlkh", "commentT": "2019-08-01T14:54:10Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the label kind/bug to this issue, with a confidence of 0.98. Please mark this comment with \ud83d\udc4d or \ud83d\udc4e to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "tlkh", "commentT": "2019-08-05T02:04:11Z", "comment_text": "\n \t\t/cc <denchmark-link:https://github.com/krishnadurai>@krishnadurai</denchmark-link>\n  <denchmark-link:https://github.com/yanniszark>@yanniszark</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "tlkh", "commentT": "2019-08-07T17:09:09Z", "comment_text": "\n \t\tI took a look at this and I believe the following is happening:\n \n Kubeflow VirtualService bind to all ports of the Istio Gateway, meaning they are accessible from 5556 as well.\n The Dex VirtualService only handles requests to paths that starts with /dex. Requests that don't start with /dex will be directed to Kubeflow.\n \n When <denchmark-link:https://github.com/kubeflow/kubeflow/issues/3839>#3839</denchmark-link>\n  is resolved, this problem will no longer exist.\n Until then, a quick solution would be to edit the Dex VirtualService to handle all the traffic coming to port 5556.\n I will make a PR soon.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "tlkh", "commentT": "2019-08-13T15:41:28Z", "comment_text": "\n \t\tUntil the long term solution <denchmark-link:https://github.com/kubeflow/kubeflow/issues/3839>#3839</denchmark-link>\n  is implemented, I made a PR to fix this:\n <denchmark-link:https://github.com/kubeflow/kubeflow/pull/3885>#3885</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "940f14ed03be401a06489468f7914f8af86913cb", "commit_author": "Yannis Zarkadas", "commitT": "2019-08-19 11:37:30-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "deployment\\existing\\auth_oidc\\gateway.yaml", "file_new_name": "deployment\\existing\\auth_oidc\\gateway.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "45", "deleted_lines": "45,46,47"}}}}}}