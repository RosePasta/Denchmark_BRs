{"BR": {"BR_id": "4749", "BR_author": "daikeshi", "BRopenT": "2020-02-10T18:24:52Z", "BRcloseT": "2020-06-17T20:40:44Z", "BR_text": {"BRsummary": "Profile controller uses project id from user sa for identity namespace", "BRdescription": "\n /kind bug\n What steps did you take and what happened:\n We have teams in different gcp projects are using a shared Kubeflow cluster.  When I try to use a gcp service account from a different project for gcpServiceAccount field in a user's profile, profile-controller throws an error:\n Identity namespace does not exist (${PROJECT_ID}.svc.id.goog)\n It seems the project id used in identity namespace is inferred from user's gcp service account. <denchmark-link:https://github.com/kubeflow/kubeflow/blob/master/components/profile-controller/controllers/plugin_workload_identity.go#L54>https://github.com/kubeflow/kubeflow/blob/master/components/profile-controller/controllers/plugin_workload_identity.go#L54</denchmark-link>\n \n What did you expect to happen:\n I think it might make more sense to use the id of the project where Kubeflow cluster was created in.\n Anything else you would like to add:\n [Miscellaneous information that will assist in solving the issue.]\n Environment:\n \n Kubeflow version: (version number can be found at the bottom left corner of the Kubeflow dashboard):\n kfctl version: (use kfctl version): 0.7.1\n Kubernetes platform: (e.g. minikube): GKE\n Kubernetes version: (use kubectl version): v1.14.8-gke.33\n OS (e.g. from /etc/os-release): mac OS Mojave v10.14.6\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "daikeshi", "commentT": "2020-02-10T18:25:10Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the labels:\n \n \n \n Label\n Probability\n \n \n \n \n kind/bug\n 0.98\n \n \n \n Please mark this comment with  or  to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://github.com/marketplace/issue-label-botdata/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "daikeshi", "commentT": "2020-02-11T06:18:18Z", "comment_text": "\n \t\t/cc <denchmark-link:https://github.com/kunmingg>@kunmingg</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "daikeshi", "commentT": "2020-05-11T11:22:49Z", "comment_text": "\n \t\tThis issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "daikeshi", "commentT": "2020-05-18T13:20:59Z", "comment_text": "\n \t\tI don't know that we will fix this issue.\n Per <denchmark-link:https://github.com/kubeflow/manifests/issues/1136>kubeflow/manifests#1136</denchmark-link>\n  I think we are moving away from profiles and bootstrapping namespaces using GitOps and declarative packages.\n We are also moving to using Cloud Config Connector.\n <denchmark-link:https://github.com/kubeflow/gcp-blueprints>https://github.com/kubeflow/gcp-blueprints</denchmark-link>\n \n So in this new world if you wanted to configure which GCP service account is bound to a KSA you would just modify the K8s resource and if necessary create an IAMPolicyMember to grant the appropriate workload identity on the GCP SA.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "daikeshi", "commentT": "2020-05-19T02:18:16Z", "comment_text": "\n \t\tTha's OK. We currently use a fork of profile controller (with the fix) as the workaround.\n We will need some migration after Kubeflow deprecates profile in the future, but it should be fine.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "daikeshi", "commentT": "2020-06-15T17:52:28Z", "comment_text": "\n \t\tRemoving from 1.1 because I don't think anyone is working on it.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "daikeshi", "commentT": "2020-06-17T13:40:49Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/jlewi>@jlewi</denchmark-link>\n , the fix I made has already been merged in master with this PR <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4754>#4754</denchmark-link>\n . I think we just need to publish a new image and update the deployment manifest. Will that be automatically taken care of in Kubeflow 1.1 release so we can remove our fork? Let me know if there's anything I can help with.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "daikeshi", "commentT": "2020-06-17T20:40:44Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/kubeflow/kubeflow/issues/5067>#5067</denchmark-link>\n  is tracking the release of the profile controller for KF 1.1\n \t\t"}}}, "commit": {"commit_id": "4d22c26133009469002893d4df30ed41cec67545", "commit_author": "Keshi Dai", "commitT": "2020-02-11 15:58:09-08:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "components\\profile-controller\\controllers\\plugin_workload_identity.go", "file_new_name": "components\\profile-controller\\controllers\\plugin_workload_identity.go", "file_complexity": {"file_NLOC": "110", "file_CCN": "20", "file_NToken": "752"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "92,93,105,106,107,108,109,110,111,117,118,119,120,121,122,123", "deleted_lines": "92,93,105,111,112", "method_info": {"method_name": "updateWorkloadIdentity", "method_params": "string,string,Policy,string", "method_startline": "85", "method_endline": "132", "method_complexity": {"method_NLOC": "36", "method_CCN": "7", "method_NToken": "235", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "components\\profile-controller\\controllers\\profile_controller_test.go", "file_new_name": "components\\profile-controller\\controllers\\profile_controller_test.go", "file_complexity": {"file_NLOC": "55", "file_CCN": "3", "file_NToken": "253"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "55", "deleted_lines": "55", "method_info": {"method_name": "TestUpdateNamespaceLabels", "method_params": "T", "method_startline": "11", "method_endline": "58", "method_complexity": {"method_NLOC": "48", "method_CCN": "3", "method_NToken": "242", "method_nesting_level": "0"}}}}}}}}