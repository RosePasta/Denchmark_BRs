{"BR": {"BR_id": "3282", "BR_author": "gabrielwen", "BRopenT": "2019-05-15T21:13:45Z", "BRcloseT": "2019-06-21T21:29:55Z", "BR_text": {"BRsummary": "[kfctl] kfctl init with ISTIO still deploys ambassador", "BRdescription": "\n We already removed ambassador from components when using ISTIO.  Somehow if we deploy from HEAD ambassador is deployed despite of using ISTIO.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "gabrielwen", "commentT": "2019-05-15T21:13:47Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the label kind/bug to this issue, with a confidence of 0.79. Please mark this comment with \ud83d\udc4d or \ud83d\udc4e to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "gabrielwen", "commentT": "2019-05-15T21:14:07Z", "comment_text": "\n \t\t/cc <denchmark-link:https://github.com/kkasravi>@kkasravi</denchmark-link>\n  <denchmark-link:https://github.com/jlewi>@jlewi</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "gabrielwen", "commentT": "2019-05-15T21:15:35Z", "comment_text": "\n \t\t/area kfctl\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "gabrielwen", "commentT": "2019-05-15T21:15:43Z", "comment_text": "\n \t\t/priority p0\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "gabrielwen", "commentT": "2019-05-15T21:17:28Z", "comment_text": "\n \t\twhen running kfctl init, with params --platform gcp --project <project> -V --skip-init-gcp-project, app.yaml looks like this:\n apiVersion: kfdef.apps.kubeflow.org/v1alpha1                                                                                                                                                                        \n kind: KfDef\n metadata:\n   creationTimestamp: null\n   labels:\n     app.kubernetes.io/name: presubmit-testing\n   name: presubmit-testing\n   namespace: kubeflow\n spec:\n   appdir: /usr/local/google/home/gabrielwen/kubeflow/presubmit-testing\n   componentParams:\n     ambassador:\n     - name: ambassadorServiceType\n       value: NodePort\n     argo:\n     - initRequired: true\n       name: injectIstio\n       value: \"true\"\n     centraldashboard:\n     - initRequired: true\n       name: injectIstio\n       value: \"true\"\n     cert-manager:\n     - initRequired: true\n       name: acmeEmail\n       value: johnDoe@acme.com\n     cloud-endpoints:\n     - name: secretName\n       value: admin-gcp-sa\n     iap-ingress:\n     - initRequired: true\n       name: ipName\n       value: ipName\n     - initRequired: true\n       name: hostname\n       value: <deployName>.endpoints.<project>.cloud.goog\n     jupyter-web-app:\n     - initRequired: true\n       name: injectIstio\n       value: \"true\"\n     katib:\n     - initRequired: true\n       name: injectIstio\n       value: \"true\"\n     notebook-controller:\n     - name: injectGcpCredentials\n       value: \"true\"\n     spartakus:\n     - initRequired: true\n       name: usageId\n       value: <randomly-generated-id>\n     - initRequired: true\n     - initRequired: true\n       name: reportUsage\n       value: \"true\"\n     tensorboard:\n     - initRequired: true\n       name: injectIstio\n       value: \"true\"\n     tf-job-operator:\n     - initRequired: true\n       name: injectIstio\n       value: \"true\"\n   components:\n   - metacontroller\n   - ambassador\n   - argo\n   - centraldashboard\n   - jupyter-web-app\n   - katib\n   - notebook-controller\n   - pytorch-operator\n   - tensorboard\n   - tf-job-operator\n   - pipeline\n   - cert-manager\n   - cloud-endpoints\n   - gpu-driver\n   - iap-ingress\n   - spartakus\n   email: gabrielwen@google.com\n   packageManager: ksonnet\n   packages:\n   - argo\n   - common\n   - examples\n   - jupyter\n   - katib\n   - metacontroller\n   - modeldb\n   - mpi-job\n   - pytorch-job\n   - seldon\n   - tensorboard\n   - tf-serving\n   - tf-training\n   - pipeline\n   - gcp\n   platform: gcp\n   project: gabrielwen-learning\n   repo: /usr/local/google/home/gabrielwen/kubeflow/presubmit-testing/.cache/kubeflow/master/kubeflow\n   serverVersion: file:/usr/local/google/home/gabrielwen/kubeflow/presubmit-testing/.cache/kubeflow/master/bootstrap/k8sSpec/v1.11.7/api/openapi-spec/swagger.json\n   skipInitProject: true\n   useBasicAuth: false\n   useIstio: true\n   version: master\n status: {}\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "gabrielwen", "commentT": "2019-05-15T21:29:35Z", "comment_text": "\n \t\tseems like it's introduced in <denchmark-link:https://github.com/kubeflow/kubeflow/pull/3108>#3108</denchmark-link>\n \n seems like we use kustomize regardless of the package manager we choose:\n <denchmark-link:https://github.com/kubeflow/kubeflow/blob/master/bootstrap/pkg/kfapp/coordinator/coordinator.go#L66-L104>https://github.com/kubeflow/kubeflow/blob/master/bootstrap/pkg/kfapp/coordinator/coordinator.go#L66-L104</denchmark-link>\n \n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "gabrielwen", "commentT": "2019-05-15T21:30:56Z", "comment_text": "\n \t\t/cc <denchmark-link:https://github.com/kkasravi>@kkasravi</denchmark-link>\n \n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "gabrielwen", "commentT": "2019-05-15T21:55:32Z", "comment_text": "\n \t\tthe right package manager is picked but kustomize will build the app.yaml. See <denchmark-link:https://github.com/kubeflow/manifests#merging-multiple-overlays-to-generate-appyaml>https://github.com/kubeflow/manifests#merging-multiple-overlays-to-generate-appyaml</denchmark-link>\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "gabrielwen", "commentT": "2019-05-15T22:05:31Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/gabrielwen>@gabrielwen</denchmark-link>\n  the generated app.yaml should look like <denchmark-link:https://github.com/kubeflow/kubeflow/blob/master/bootstrap/config/kfctl_iap.yaml>kfctl_iap.yaml</denchmark-link>\n  - though all 3 will be phased out once the UI is also using kustomize. I do see that iap-ingress is missing the injectIstio Parameter - which needs to be added <denchmark-link:https://github.com/kubeflow/kubeflow/blob/master/bootstrap/config/overlays/gcp/kfctl_default.yaml>here</denchmark-link>\n \n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "gabrielwen", "commentT": "2019-05-15T22:10:35Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/kkasravi>@kkasravi</denchmark-link>\n \n so the differences are:\n \n ambassador is added, so is its parameter.\n iap-ingress doesn't have param injectIstio.\n pipeline doesn't have all of parameters it should have.\n \n params are easy - we just need to add them back as you suggested.  First item is more tricky - we don't want it with ISTIO, but we do all others.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "gabrielwen", "commentT": "2019-05-15T22:46:32Z", "comment_text": "\n \t\tambassador is only in config/base.\n iap-ingress is in config/overlays/gcp\n pipeline is in both config/overlays/{ksonnet,kustomize}\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "gabrielwen", "commentT": "2019-05-17T03:06:06Z", "comment_text": "\n \t\tCurrent task: check basic auth.\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "gabrielwen", "commentT": "2019-05-23T17:42:49Z", "comment_text": "\n \t\t/remove-priority p0\n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "gabrielwen", "commentT": "2019-05-23T17:42:57Z", "comment_text": "\n \t\t/priority p1\n \t\t"}, "comments_14": {"comment_id": 15, "comment_author": "gabrielwen", "commentT": "2019-06-21T21:29:55Z", "comment_text": "\n \t\tShould be fixed on master.\n \t\t"}}}, "commit": {"commit_id": "8681f7306f3fb7503a5d3c2736ddb24ed9f71b30", "commit_author": "Hung-Ting Wen", "commitT": "2019-05-15 20:21:43-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\base\\kfctl_default.yaml", "file_new_name": "bootstrap\\config\\base\\kfctl_default.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "29,33,34,35,36,37,38,39", "deleted_lines": "23,33,34,35"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\overlays\\basic_auth\\kfctl_default-patch.yaml", "file_new_name": "bootstrap\\config\\overlays\\basic_auth\\kfctl_default-patch.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1,2,3,4", "deleted_lines": "21,22,23,24"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\overlays\\basic_auth\\kfctl_default.yaml", "file_new_name": "bootstrap\\config\\overlays\\basic_auth\\kfctl_default.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "7,8,9", "deleted_lines": "55,56,57,58,59,60,61"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\overlays\\gcp\\kfctl_default-patch.yaml", "file_new_name": "bootstrap\\config\\overlays\\gcp\\kfctl_default-patch.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": null, "deleted_lines": "17,18,19,20"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\overlays\\gcp\\kfctl_default.yaml", "file_new_name": "bootstrap\\config\\overlays\\gcp\\kfctl_default.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "32,33,34", "deleted_lines": "51,52,53,54,55,56,57"}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\overlays\\ksonnet\\kustomization.yaml", "file_new_name": "bootstrap\\config\\overlays\\ksonnet\\kustomization.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "5,6", "deleted_lines": null}}}}}}