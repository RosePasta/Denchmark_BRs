{"BR": {"BR_id": "4446", "BR_author": "Bobgy", "BRopenT": "2019-11-01T03:46:23Z", "BRcloseT": "2019-11-05T00:22:39Z", "BR_text": {"BRsummary": "Double back button clicks needed for navigating back in central dashboard", "BRdescription": "\n /kind bug\n /area centraldashboard\n \n In KFP run detail page, I need to click back button twice to go back to run list page. It's similar for other pages including Katib and notebook servers.\n <denchmark-link:https://screencast.googleplex.com/cast/NDYyNzM2NjM0MzA4MTk4NHxhZjI5MDBlMC05Zg>https://screencast.googleplex.com/cast/NDYyNzM2NjM0MzA4MTk4NHxhZjI5MDBlMC05Zg</denchmark-link>\n \n What did you expect to happen:\n Single click on back button should be enough.\n Anything else you would like to add:\n [Miscellaneous information that will assist in solving the issue.]\n Environment:\n \n Kubeflow version: (version number can be found at the bottom left corner of the Kubeflow dashboard): build version 0.7.0\n kfctl version: (use kfctl version): kfctl v0.7.0-rc.5-27-g7f64d8b0\n Kubernetes platform: (e.g. minikube) gcp-iap\n Kubernetes version: (use kubectl version):\n \n <denchmark-code>Client Version: version.Info{Major:\"1\", Minor:\"16\", GitVersion:\"v1.16.0\", GitCommit:\"2bd9643cee5b3b3a5ecbd3af49d09018f0773c77\", GitTreeState:\"clean\", BuildDate:\"2019-09-18T14:36:53Z\", GoVersion:\"go1.12.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}\n Server Version: version.Info{Major:\"1\", Minor:\"13+\", GitVersion:\"v1.13.10-gke.0\", GitCommit:\"569511c9540f78a94cc6a41d895c382d0946c11a\", GitTreeState:\"clean\", BuildDate:\"2019-08-21T23:28:44Z\", GoVersion:\"go1.11.13b4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\n </denchmark-code>\n \n \n OS (e.g. from /etc/os-release): both for linux and mac\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Bobgy", "commentT": "2019-11-01T03:46:33Z", "comment_text": "\n \t\tIssue Label Bot is not confident enough to auto-label this issue.\n See <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  for more details.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Bobgy", "commentT": "2019-11-01T03:47:02Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/prodonjs>@prodonjs</denchmark-link>\n  <denchmark-link:https://github.com/avdaredevil>@avdaredevil</denchmark-link>\n  do you have any context?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "Bobgy", "commentT": "2019-11-01T10:40:30Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Bobgy>@Bobgy</denchmark-link>\n  - We did have this regression but addressed it in <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4326>#4326</denchmark-link>\n  which should be included in the rc-5 candidate you indicated. It looks like the issue might be somewhat different though than the core one that we wanted to address. Both Katib and KFP use hash based routing and the back button you reference in KFP simply uses the browsers's history functionality to go back a page.\n When using KFP or any other KF app inside the context of the centraldashboard's iframe, we added code that listens for any clicks in the iframe and updates the parent page's URL when the location changes. So if I click on the Pipelines link in the left nav menu, the top-level path becomes /_/pipeline/. Then, if I click a Pipline definition, it becomes /_/pipeline/#/pipelines/details/<pipeline_id>. Then, clicking the button to go back to the list page calls history.goBack(), but my theory is that due to the iframe context, the back operation is affecting the overall browser's URL and therefore dropping the # section of the URL and changing it back to /_/pipeline/. To the centraldashboard, this is not a navigation event since it doesn't use hash-based routing. I believe what happens is that the dashboard tries to reset the iframe's source to the new URL that no longer contains the #, but that doesn't trigger a reload of the KFP page so it's as if the navigation event didn't happen.\n A quick test of this theory would be to see if changing the functionality of the back button in KFP to use a standard anchor tag to the list page fixes the issue. In general, it's been a bit of a challenge to handle some of the nuances of iframing without explicitly establishing a channel for apps and the centraldashboard to use. Hopefully this is something we can address without major changes.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "Bobgy", "commentT": "2019-11-01T13:41:57Z", "comment_text": "\n \t\tI can confirm that this is a regression based on the changes made in <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4230>#4230</denchmark-link>\n  to account for navigation changes in the iframed-child pages to the URL of the parent as the v0.6.2 version of the dashboard does not exhibit the same behavior.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "Bobgy", "commentT": "2019-11-02T01:59:55Z", "comment_text": "\n \t\tJust two cents from my understanding, haven't tried it out.\n IFrame history changes are already records in window history, ref: <denchmark-link:http://www.webdeveasy.com/back-button-behavior-on-a-page-with-an-iframe/>http://www.webdeveasy.com/back-button-behavior-on-a-page-with-an-iframe/</denchmark-link>\n \n So when we sync iframe location change to window, we shouldn't use  which creates a second entry in <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4230/files#diff-5184304ce3ffddcc77cdade1f1140072R250>https://github.com/kubeflow/kubeflow/pull/4230/files#diff-5184304ce3ffddcc77cdade1f1140072R250</denchmark-link>\n .\n Instead, we should use , ref: <denchmark-link:https://developer.mozilla.org/en-US/docs/Web/API/History/replaceState>https://developer.mozilla.org/en-US/docs/Web/API/History/replaceState</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "Bobgy", "commentT": "2019-11-04T03:22:11Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Bobgy>@Bobgy</denchmark-link>\n  - That's a great suggestion. I think that should resolve the issue so I'll test it tomorrow morning and get a PR ready if it works as expected.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "Bobgy", "commentT": "2019-11-04T13:42:13Z", "comment_text": "\n \t\tFix is ready in PR <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4454>#4454</denchmark-link>\n . If you want to verify it, you can try image gcr.io/prodonjs-kubeflow-dev/centraldashboard@sha256:702fe888e94d4596b353ea9002aa0b8ac6818d1d5573bf9c37320c2d05f5b0cf\n \t\t"}}}, "commit": {"commit_id": "bf57f130421d3093310c7c714dace147db693edd", "commit_author": "Jason Prodonovich", "commitT": "2019-11-04 16:22:38-08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "components\\centraldashboard\\public\\components\\main-page.js", "file_new_name": "components\\centraldashboard\\public\\components\\main-page.js", "file_complexity": {"file_NLOC": "245", "file_CCN": "41", "file_NToken": "1310"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "265", "deleted_lines": "265", "method_info": {"method_name": "_iframePageChanged", "method_params": "newPage", "method_startline": "264", "method_endline": "267", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "18", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "components\\centraldashboard\\public\\components\\main-page_test.js", "file_new_name": "components\\centraldashboard\\public\\components\\main-page_test.js", "file_complexity": {"file_NLOC": "228", "file_CCN": "27", "file_NToken": "1634"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "229", "deleted_lines": "229", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "228", "method_endline": "236", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "54", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "229", "deleted_lines": "229", "method_info": {"method_name": "JSON.stringify", "method_params": "hasWorkgroup", "method_startline": "204", "method_endline": "266", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "62", "method_nesting_level": "0"}}}}}}}}