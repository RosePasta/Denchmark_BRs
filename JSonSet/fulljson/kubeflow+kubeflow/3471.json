{"BR": {"BR_id": "3471", "BR_author": "yanniszark", "BRopenT": "2019-06-14T14:19:45Z", "BRcloseT": "2019-07-22T18:59:30Z", "BR_text": {"BRsummary": "kfctl: repo for KfDef is not calculated correctly", "BRdescription": "\n The repo field in KfDef should be the folder under which the kubeflow repository code lives.\n In other words, it must hold that:\n $ ls <repo>\n bootstrap\n build\n ...\n Currently, we are passing the wrong value for repo.\n The value we are passing is <repo>/kubeflow:\n \n \n \n kubeflow/bootstrap/pkg/kfapp/coordinator/coordinator.go\n \n \n          Line 296\n       in\n       7ca3cfb\n \n \n \n \n \n \n  kfDef.Spec.Repo = path.Join(cacheDir, kftypes.KubeflowRepo) \n \n \n \n \n \n While the repo value is wrong, the way that GCP handles it makes it work.\n More specifically, the path.Dir function is used which cuts out the wrong part.\n \n \n \n kubeflow/bootstrap/pkg/kfapp/gcp/gcp.go\n \n \n          Line 1211\n       in\n       7ca3cfb\n \n \n \n \n \n \n  parentDir := path.Dir(repo) \n \n \n \n \n \n We should pass the correct value and use it as is.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "yanniszark", "commentT": "2019-06-14T14:19:47Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the label kind/bug to this issue, with a confidence of 0.97. Please mark this comment with \ud83d\udc4d or \ud83d\udc4e to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "yanniszark", "commentT": "2019-06-14T15:34:18Z", "comment_text": "\n \t\t/cc <denchmark-link:https://github.com/lluunn>@lluunn</denchmark-link>\n \n /assign <denchmark-link:https://github.com/yanniszark>@yanniszark</denchmark-link>\n \n /assign <denchmark-link:https://github.com/lluunn>@lluunn</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "yanniszark", "commentT": "2019-06-14T15:49:07Z", "comment_text": "\n \t\tI think it was intended.\n Because under github repo kubeflow/kubeflow, the dir kubeflow is the repo for ksonnet registry.\n So it was defined that way I believe.\n What error does this cause?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "yanniszark", "commentT": "2019-06-14T16:21:01Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/lluunn>@lluunn</denchmark-link>\n  I see what you mean.\n Does it make sense to keep it that way since:\n \n We are moving away from kustomize but other code, unrelated to kustomize, depends on this option.\n The name of the field (repo) and its description (Name of repository.) suggests it is the Kubeflow repo and not a ksonnet registry. Couple that with the fact that there is an actual RegistryConfig type inside applications_type.go and it gets somewhat confusing. If the repo was actually representing a ksonnet registry, shouldn't it use the RegistryConfig type?\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "yanniszark", "commentT": "2019-06-14T18:17:30Z", "comment_text": "\n \t\tYeah, I think we should probably change as we don't need the kubeflow dir as the ks registry anymore.\n cc <denchmark-link:https://github.com/kunmingg>@kunmingg</denchmark-link>\n  <denchmark-link:https://github.com/kkasravi>@kkasravi</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "yanniszark", "commentT": "2019-06-18T13:03:06Z", "comment_text": "\n \t\tShould KfDef.repo be referring to cachedir at all?\n Cachedir should be an internal property of the KfApp. The value in the KfDef should refer to the source of truth e.g. a specific commit in the git repo. This way if the user checks in the app into source control and checks out on a different machine we can reconstruct the cachedir from the source of truth.\n See for example <denchmark-link:https://github.com/kubeflow/kubeflow/issues/2959>#2959</denchmark-link>\n  we should redownload files to cachedir if they don't exist.\n A second issue I forsee is that with the move to kustomize we now have multiple repos\n \n GCP/Azure configs are stored in kubeflow/kubeflow\n kustomize manifests are stored in kubeflow/manifests\n \n We should probably generalize repos to be a list. Alternative would be to put the configs all in kubeflow/manifests but I think that's only going to postpone the problem.\n /cc <denchmark-link:https://github.com/kkasravi>@kkasravi</denchmark-link>\n \n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "yanniszark", "commentT": "2019-06-18T13:06:46Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/yanniszark>@yanniszark</denchmark-link>\n  My initial thought for what the semantics would be something like this\n <denchmark-code>repos:\n   - name: kubeflow\n     uri: https://github.com/kubeflow/kubeflow.git\n   - name: manifests\n      uri: https://github.com/kubeflow/manifests.git\n </denchmark-code>\n \n The semantics should then be checkout each uri to   join(cachedir, name)\n Files can then be consistently referred to as\n join(cachedir, name, repo_relative_path)\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "yanniszark", "commentT": "2019-07-22T18:33:56Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/yanniszark>@yanniszark</denchmark-link>\n  the semantics mentioned in my last comment are now implemented on master and in 0.6.0.\n Can we mark this as fixed?\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "yanniszark", "commentT": "2019-07-22T18:59:30Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/jlewi>@jlewi</denchmark-link>\n  absolutely\n \t\t"}}}, "commit": {"commit_id": "2f3592d0c19375649e5ff6b9df7e66fb622fcd3e", "commit_author": "Jeremy Lewi", "commitT": "2019-06-27 17:27:20-07:00", "commit_complexity": {"commit_NLOC": "0.07706093189964158", "commit_CCN": "0.6308243727598566", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\gcp_prototype.yaml", "file_new_name": "bootstrap\\config\\gcp_prototype.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1,2", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\kfctl_basic_auth.yaml", "file_new_name": "bootstrap\\config\\kfctl_basic_auth.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1,2", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\kfctl_default.yaml", "file_new_name": "bootstrap\\config\\kfctl_default.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1,2", "deleted_lines": null}}}, "file_3": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "bootstrap\\config\\kfctl_gcp_iap.0.6.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\kfctl_iap.yaml", "file_new_name": "bootstrap\\config\\kfctl_iap.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1,2", "deleted_lines": null}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "bootstrap\\config\\zz_generated.deepcopy.go", "file_new_name": "bootstrap\\config\\zz_generated.deepcopy.go", "file_complexity": {"file_NLOC": "88", "file_CCN": "19", "file_NToken": "504"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "111,112,113,114", "deleted_lines": null, "method_info": {"method_name": "DeepCopyInto", "method_params": "StorageOption", "method_startline": "111", "method_endline": "114", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "20", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "117,118,119,120,121,122,123,124", "deleted_lines": null, "method_info": {"method_name": "DeepCopy", "method_params": "", "method_startline": "117", "method_endline": "124", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "35", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\developer_guide.md", "file_new_name": "bootstrap\\developer_guide.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "271,272,274,276,280,281,282,283,286", "deleted_lines": "271,273,275,279,280"}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\go.mod", "file_new_name": "bootstrap\\go.mod", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "59", "deleted_lines": null}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\pkg\\apis\\apps\\group.go", "file_new_name": "bootstrap\\pkg\\apis\\apps\\group.go", "file_complexity": {"file_NLOC": "285", "file_CCN": "39", "file_NToken": "1546"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "50,51", "deleted_lines": null}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\pkg\\apis\\apps\\kfdef\\v1alpha1\\zz_generated.deepcopy.go", "file_new_name": "bootstrap\\pkg\\apis\\apps\\kfdef\\v1alpha1\\zz_generated.deepcopy.go", "file_complexity": {"file_NLOC": "302", "file_CCN": "74", "file_NToken": "1762"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "3,4,5,6,7,8,9,10,11,12,13,14,15,16,17", "deleted_lines": "3,4,5,6,7,8,9,10,11,12,13,14,15"}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 12, "file_old_name": "bootstrap\\pkg\\kfapp\\coordinator\\coordinator.go", "file_new_name": "bootstrap\\pkg\\kfapp\\coordinator\\coordinator.go", "file_complexity": {"file_NLOC": "740", "file_CCN": "109", "file_NToken": "4891"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "156,162,163,169,170", "deleted_lines": "158,159", "method_info": {"method_name": "getPackageManager", "method_params": "KfDef,Platform", "method_startline": "156", "method_endline": "172", "method_complexity": {"method_NLOC": "16", "method_CCN": "4", "method_NToken": "127", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "133,134", "deleted_lines": "132", "method_info": {"method_name": "getPlatform", "method_params": "KfDef,byte", "method_startline": "126", "method_endline": "138", "method_complexity": {"method_NLOC": "11", "method_CCN": "3", "method_NToken": "94", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,518,519,520,521,522,523", "deleted_lines": null, "method_info": {"method_name": "backfillKfDefFromInitOptions", "method_params": "KfDef", "method_startline": "446", "method_endline": "523", "method_complexity": {"method_NLOC": "60", "method_CCN": "20", "method_NToken": "521", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583", "deleted_lines": null, "method_info": {"method_name": "backfillKfDefFromGenerateOptions", "method_params": "KfDef", "method_startline": "536", "method_endline": "585", "method_complexity": {"method_NLOC": "42", "method_CCN": "20", "method_NToken": "444", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "627,628,629,630,631,632,633,634,636", "deleted_lines": null, "method_info": {"method_name": "LoadKfAppCfgFile", "method_params": "string", "method_startline": "627", "method_endline": "639", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "74", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "143", "deleted_lines": "145,151", "method_info": {"method_name": "getPackageManagers", "method_params": "KfDef", "method_startline": "140", "method_endline": "151", "method_complexity": {"method_NLOC": "12", "method_CCN": "3", "method_NToken": "100", "method_nesting_level": "0"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "595,596,604,608,611,612,613,614,615,617,618,619,620,622,623,624", "deleted_lines": null, "method_info": {"method_name": "LoadKfApp", "method_params": "", "method_startline": "593", "method_endline": "624", "method_complexity": {"method_NLOC": "26", "method_CCN": "5", "method_NToken": "180", "method_nesting_level": "0"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "211,257,258,260,261,262,264,267,270,271,272,275,276,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,331,332,333,334,336,337,338,339,340,342,344,345,346,351,354,355,356,357,358,359,360,361", "deleted_lines": "244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,268,269,270,271,272,273,274,275,276,277,281,284,285,286,287,288,289,290,296,297,298,299,300,303,304,305,306,308,309,310,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,347,348,349,350,351,352,353,354,355,356,357,358,359,362", "method_info": {"method_name": "CreateKfDefFromOptions", "method_params": "", "method_startline": "211", "method_endline": "362", "method_complexity": {"method_NLOC": "131", "method_CCN": "20", "method_NToken": "939", "method_nesting_level": "0"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "156", "deleted_lines": "145,151,152,158,159", "method_info": {"method_name": "getPackageManager", "method_params": "string,KfDef,Platform", "method_startline": "145", "method_endline": "161", "method_complexity": {"method_NLOC": "17", "method_CCN": "4", "method_NToken": "127", "method_nesting_level": "0"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434", "deleted_lines": "396,397,398,399,400,401,402,403,407,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434", "method_info": {"method_name": "NewKfApp", "method_params": "", "method_startline": "394", "method_endline": "434", "method_complexity": {"method_NLOC": "29", "method_CCN": "6", "method_NToken": "175", "method_nesting_level": "0"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390", "deleted_lines": "368,369,370,371,374,375,376,377,378", "method_info": {"method_name": "CreateKfAppCfgFile", "method_params": "KfDef", "method_startline": "368", "method_endline": "390", "method_complexity": {"method_NLOC": "20", "method_CCN": "4", "method_NToken": "179", "method_nesting_level": "0"}}}, "hunk_11": {"Ismethod": 1, "added_lines": "364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383", "deleted_lines": "364,365,366,367,368,369,370,371,374,375,376,377,378", "method_info": {"method_name": "unmarshalAppYaml", "method_params": "string,KfDef", "method_startline": "364", "method_endline": "383", "method_complexity": {"method_NLOC": "20", "method_CCN": "4", "method_NToken": "132", "method_nesting_level": "0"}}}}}, "file_11": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "bootstrap\\pkg\\kfapp\\coordinator\\coordinator_test.go", "file_complexity": {"file_NLOC": "340", "file_CCN": "21", "file_NToken": "1605"}}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\pkg\\kfapp\\gcp\\gcp.go", "file_new_name": "bootstrap\\pkg\\kfapp\\gcp\\gcp.go", "file_complexity": {"file_NLOC": "1530", "file_CCN": "41", "file_NToken": "10621"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "81", "deleted_lines": null}}}, "file_13": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "bootstrap\\v2\\pkg\\apis\\apps\\kfdef\\v1alpha1\\application_types.go", "file_new_name": "bootstrap\\v2\\pkg\\apis\\apps\\kfdef\\v1alpha1\\application_types.go", "file_complexity": {"file_NLOC": "350", "file_CCN": "46", "file_NToken": "2061"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "493,494,495,496,497,498,499,500,501,502,503,504,505,506,507", "deleted_lines": null, "method_info": {"method_name": "IsValid", "method_params": "", "method_startline": "493", "method_endline": "507", "method_complexity": {"method_NLOC": "10", "method_CCN": "4", "method_NToken": "82", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370", "deleted_lines": null, "method_info": {"method_name": "SyncCache", "method_params": "", "method_startline": "322", "method_endline": "370", "method_complexity": {"method_NLOC": "38", "method_CCN": "8", "method_NToken": "275", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318", "deleted_lines": null, "method_info": {"method_name": "LoadKFDefFromURI", "method_params": "string", "method_startline": "274", "method_endline": "318", "method_complexity": {"method_NLOC": "33", "method_CCN": "6", "method_NToken": "226", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371", "deleted_lines": "385", "method_info": {"method_name": "SetPluginSpec", "method_params": "string", "method_startline": "344", "method_endline": "387", "method_complexity": {"method_NLOC": "28", "method_CCN": "6", "method_NToken": "169", "method_nesting_level": "0"}}}}}, "file_14": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "bootstrap\\v2\\pkg\\apis\\apps\\kfdef\\v1alpha1\\application_types_test.go", "file_new_name": "bootstrap\\v2\\pkg\\apis\\apps\\kfdef\\v1alpha1\\application_types_test.go", "file_complexity": {"file_NLOC": "363", "file_CCN": "34", "file_NToken": "1639"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107", "deleted_lines": null, "method_info": {"method_name": "TestSyncCache", "method_params": "T", "method_startline": "71", "method_endline": "107", "method_complexity": {"method_NLOC": "28", "method_CCN": "4", "method_NToken": "200", "method_nesting_level": "0"}}}}}, "file_15": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "bootstrap\\v2\\pkg\\apis\\apps\\kfdef\\v1alpha1\\testdata\\doc.go", "file_complexity": {"file_NLOC": "1", "file_CCN": "0", "file_NToken": "2"}}, "file_16": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "bootstrap\\v2\\pkg\\kfapp\\kustomize\\kustomize.go", "file_new_name": "bootstrap\\v2\\pkg\\kfapp\\kustomize\\kustomize.go", "file_complexity": {"file_NLOC": "959", "file_CCN": "52", "file_NToken": "6392"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "413,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,445,451,454", "deleted_lines": "431", "method_info": {"method_name": "error", "method_params": "", "method_startline": "411", "method_endline": "469", "method_complexity": {"method_NLOC": "52", "method_CCN": "10", "method_NToken": "370", "method_nesting_level": "0"}}}}}, "file_17": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "testing\\kfctl\\kfctl_go_test.py", "file_new_name": "testing\\kfctl\\kfctl_go_test.py", "file_complexity": {"file_NLOC": "90", "file_CCN": "13", "file_NToken": "625"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "98,99,100,101,102", "deleted_lines": "98", "method_info": {"method_name": "test_build_kfctl_go", "method_params": "app_path,project,use_basic_auth,use_istio", "method_startline": "32", "method_endline": "129", "method_complexity": {"method_NLOC": "59", "method_CCN": "10", "method_NToken": "447", "method_nesting_level": "0"}}}}}}}}