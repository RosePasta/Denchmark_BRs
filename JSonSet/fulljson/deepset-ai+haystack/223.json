{"BR": {"BR_id": "223", "BR_author": "Krak91", "BRopenT": "2020-07-13T13:09:57Z", "BRcloseT": "2020-10-19T07:30:13Z", "BR_text": {"BRsummary": "Version mismatch at installation & encoding issue", "BRdescription": "\n I get the following error when trying to ask the model a question. My pipeline looks like this:\n def pipeline(docs, questions):\n <denchmark-code>document_store = InMemoryDocumentStore()\n document_store.write_documents(docs)\n retriever = TfidfRetriever(document_store=document_store)\n reader = FARMReader(model_name_or_path=\"deepset/roberta-base-squad2\", use_gpu=False)\n finder = Finder(reader, retriever)\n predictions = {}\n for question in questions:\n \tpredictions[question] = finder.get_answers(question=question, top_k_retriever=5, top_k_reader=3)\n </denchmark-code>\n \n <denchmark-code>return predictions\n </denchmark-code>\n \n Error message\n File \".../model.py\", line 23, in pipeline\n predictions[question] = finder.get_answers(question=question, top_k_retriever=5, top_k_reader=3)\n File \"...venv\\lib\\site-packages\\haystack\\finder.py\", line 57, in get_answers\n top_k=top_k_reader)  # type: Dict[str, Any]\n File \"...\\venv\\lib\\site-packages\\haystack\\reader\\farm.py\", line 259, in predict\n if self._check_no_answer(ans):\n File \"...\\venv\\lib\\site-packages\\haystack\\reader\\farm.py\", line 416, in _check_no_answer\n assert d[\"answer\"] == \"is_impossible\", f\"Check for no answer is not working\"\n AssertionError: Check for no answer is not working\n Expected behavior\n Return model predictions\n \u2506Issue is synchronized with this <denchmark-link:https://deepset-ai.atlassian.net/browse/HS-48>Jira Task</denchmark-link>\n  by <denchmark-link:https://www.unito.io/learn-more>Unito</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Krak91", "commentT": "2020-07-13T15:52:18Z", "comment_text": "\n \t\tDid you try doing this:\n <denchmark-code>for question in questions:\n \tprediction = finder.get_answers(question=question, top_k_retriever=5, top_k_reader=3)\n         predictions.append((question,prediction))\n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Krak91", "commentT": "2020-07-13T15:58:36Z", "comment_text": "\n \t\tyes, the error is still the same at the \"prediction = finder.get_answers(question=question, top_k_retriever=5, top_k_reader=3)\"\n argument\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "Krak91", "commentT": "2020-07-13T16:56:10Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/Krak91>@Krak91</denchmark-link>\n  ,\n What versions of Haystack and FARM are you using?\n The error makes me believe that you are using Haystack from latest master + FARM 0.4.6.\n These two versions are not compatible yet (we'll update to FARM 0.4.6 shortly in <denchmark-link:https://github.com/deepset-ai/haystack/pull/172>#172</denchmark-link>\n  ).\n To resolve this you can do one of these options:\n \n Last stable release: pip install haystack==0.2.1\n Latest code:\n \n <denchmark-code>git clone https://github.com/deepset-ai/haystack.git\n cd haystack\n pip install -e .\n </denchmark-code>\n \n (which will install FARM 0.4.5)\n Let me know if this resolves your issue!\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "Krak91", "commentT": "2020-07-14T07:25:21Z", "comment_text": "\n \t\tHi, I've installed the right versions of farm and haystack and it worked. Thanks.\n Some more information:\n I've noticed that all the scripts are in the 'haystack' folder of the project. As I'm just trying to add its functionality to my existing project, I simply move that folder to my virtual environment so that the imports in the scripts say valid. A few other things I've noticed:\n \n Always during installation (either by cloning or pip) it shows this error: \"ERROR: Could not find a version that satisfies the requirement torch==1.4.0 (from farm==0.4.3->farm-haystack) (from versions: 0.1.2, 0.1.2.post1, 0.1.2.post2)\n ERROR: No matching distribution found for torch==1.4.0 (from farm==0.4.3->farm-haystack)'. Versions vary depending on release. Need to go install torch manually.\n I always need to modify haystack/indexing/utils line 36 whenever I install the package to avoid errors when trying to open documents with funny characters (encoding='x', errors='ignore'). I like the new functions for passing the document store raw text (dicts of title, text) rather than a physical file's path.\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "Krak91", "commentT": "2020-07-15T17:20:29Z", "comment_text": "\n \t\t\n Always during installation (either by cloning or pip) it shows this error: \"ERROR: Could not find a version that satisfies the requirement torch==1.4.0 (from farm==0.4.3->farm-haystack) (from versions: 0.1.2, 0.1.2.post1, 0.1.2.post2)\n ERROR: No matching distribution found for torch==1.4.0 (from farm==0.4.3->farm-haystack)'. Versions vary depending on release. Need to go install torch manually.\n \n This should be resolved in the latest version as we upgraded to torch 1.5.1\n \n I always need to modify haystack/indexing/utils line 36 whenever I install the package to avoid errors when trying to open documents with funny characters (encoding='x', errors='ignore'). I like the new functions for passing the document store raw text (dicts of title, text) rather than a physical file's path.\n \n Can you please elaborate on what you are exactly changing there? Are you using utf-8 encoding there? What errors come up that you want to ignore?\n As encodings are always a big pain, we could think of adding an arg to convert_files_to_dicts() to specify the encoding or at least put a better default there ...\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "Krak91", "commentT": "2020-07-15T17:48:11Z", "comment_text": "\n \t\tI'm changing with open(path) as doc:  to with open(path, encoding='utf-8', errors='ignore') as doc:\n It's a unicode error:\n UnicodeDecodeError: 'charmap' codec can't decode byte 0x90 in position 24072: character maps to <undefined>\n The actual character in this case is: \u2010\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "Krak91", "commentT": "2020-10-19T07:30:13Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/Krak91>@Krak91</denchmark-link>\n , this issue should be resolved by <denchmark-link:https://github.com/deepset-ai/haystack/pull/478>#478</denchmark-link>\n . I'm closing the thread but please feel free to update here if you still face any encoding errors.\n \t\t"}}}, "commit": {"commit_id": "955e6f7b3accd4222f2deaa044939793464f703a", "commit_author": "Zenahr Barzani", "commitT": "2020-10-12 17:32:04+02:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "haystack\\file_converter\\txt.py", "file_new_name": "haystack\\file_converter\\txt.py", "file_complexity": {"file_NLOC": "72", "file_CCN": "2", "file_NToken": "422"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "46,47,48,49", "deleted_lines": "47,48", "method_info": {"method_name": "convert", "method_params": "self,Path,str,None,str", "method_startline": "46", "method_endline": "49", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "36", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "47,48,49,50,51,52,53,54,55,56,57,58,59,60", "deleted_lines": "47,48", "method_info": {"method_name": "convert", "method_params": "self,Path,str,None", "method_startline": "47", "method_endline": "94", "method_complexity": {"method_NLOC": "37", "method_CCN": "15", "method_NToken": "287", "method_nesting_level": "1"}}}}}}}}