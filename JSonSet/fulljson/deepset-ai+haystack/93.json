{"BR": {"BR_id": "93", "BR_author": "Ierezell", "BRopenT": "2020-05-04T18:04:23Z", "BRcloseT": "2020-06-05T11:48:45Z", "BR_text": {"BRsummary": "Built-in API returns AttributeError when Reader not loaded", "BRdescription": "\n Thanks a lot for this nice framework.\n It runs perfectly in jupyter or python but I encoutered this bug trying to use the native API.\n Launching\n gunicorn haystack.api.application:app -b 0.0.0.0:8080 -k uvicorn.workers.UvicornWorker\n Port 8080 because 80 was already taken\n Then\n curl --request POST --url 'http://127.0.0.1:8080/models/1/doc-qa' --data '{\"questions\": [\"Who is the father of George Orwell?\"]}' \n And it returns\n <denchmark-code>[2020-05-04 14:03:54 -0400] [8037] [INFO] Starting gunicorn 20.0.4\n [2020-05-04 14:03:54 -0400] [8037] [INFO] Listening at: http://0.0.0.0:8080 (8037)\n [2020-05-04 14:03:54 -0400] [8037] [INFO] Using worker: uvicorn.workers.UvicornWorker\n [2020-05-04 14:03:54 -0400] [8039] [INFO] Booting worker with pid: 8039\n 05/04/2020 14:03:56 - INFO - elasticsearch -   PUT http://localhost:9200/document [status:400 request:0.004s]\n 05/04/2020 14:03:56 - INFO - elasticsearch -   PUT http://localhost:9200/document [status:400 request:0.004s]\n 05/04/2020 14:03:56 - INFO - haystack.api.application -   Open http://127.0.0.1:8000/docs to see Swagger API Documentation.\n 05/04/2020 14:03:56 - INFO - haystack.api.application -   \n Or just try it out directly: curl --request POST --url 'http://127.0.0.1:8000/models/1/doc-qa' --data '{\"questions\": [\"What is the capital of Germany?\"]}'\n \n [2020-05-04 14:03:56 -0400] [8039] [INFO] Started server process [8039]\n [2020-05-04 14:03:56 -0400] [8039] [INFO] Waiting for application startup.\n [2020-05-04 14:03:56 -0400] [8039] [INFO] Application startup complete.\n 05/04/2020 14:04:01 - INFO - haystack.retriever.elasticsearch -   Got 3 candidates from retriever\n 05/04/2020 14:04:01 - INFO - haystack.finder -   Reader is looking for detailed answer in 167899 chars ...\n [2020-05-04 14:04:01 -0400] [8039] [ERROR] Exception in ASGI application\n Traceback (most recent call last):\n   File \"/home/pedro/.local/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 385, in run_asgi\n     result = await app(self.scope, self.receive, self.send)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py\", line 45, in __call__\n     return await self.app(scope, receive, send)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/fastapi/applications.py\", line 149, in __call__\n     await super().__call__(scope, receive, send)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/starlette/applications.py\", line 102, in __call__\n     await self.middleware_stack(scope, receive, send)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/starlette/middleware/errors.py\", line 181, in __call__\n     raise exc from None\n   File \"/home/pedro/.local/lib/python3.8/site-packages/starlette/middleware/errors.py\", line 159, in __call__\n     await self.app(scope, receive, _send)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/starlette/middleware/cors.py\", line 76, in __call__\n     await self.app(scope, receive, send)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/starlette/exceptions.py\", line 82, in __call__\n     raise exc from None\n   File \"/home/pedro/.local/lib/python3.8/site-packages/starlette/exceptions.py\", line 71, in __call__\n     await self.app(scope, receive, sender)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/starlette/routing.py\", line 550, in __call__\n     await route.handle(scope, receive, send)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/starlette/routing.py\", line 227, in handle\n     await self.app(scope, receive, send)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/starlette/routing.py\", line 41, in app\n     response = await func(request)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/fastapi/routing.py\", line 196, in app\n     raw_response = await run_endpoint_function(\n   File \"/home/pedro/.local/lib/python3.8/site-packages/fastapi/routing.py\", line 150, in run_endpoint_function\n     return await run_in_threadpool(dependant.call, **values)\n   File \"/home/pedro/.local/lib/python3.8/site-packages/starlette/concurrency.py\", line 34, in run_in_threadpool\n     return await loop.run_in_executor(None, func, *args)\n   File \"/usr/lib/python3.8/concurrent/futures/thread.py\", line 57, in run\n     result = self.fn(*self.args, **self.kwargs)\n   File \"/home/pedro/git_clones/haystack/haystack/api/controller/search.py\", line 117, in doc_qa\n     result = finder.get_answers(\n   File \"/home/pedro/git_clones/haystack/haystack/finder.py\", line 43, in get_answers\n     results = self.reader.predict(question=question,\n AttributeError: 'NoneType' object has no attribute 'predict'\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Ierezell", "commentT": "2020-05-04T18:25:43Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/Ierezell>@Ierezell</denchmark-link>\n  ,\n It seems that your Reader was not loaded properly.  Can you please try setting READER_MODEL_PATH here in the config\n \n \n \n haystack/haystack/api/config.py\n \n \n          Line 23\n       in\n       37e0ff7\n \n \n \n \n \n \n  READER_MODEL_PATH = os.getenv(\"READER_MODEL_PATH\", None) \n \n \n \n \n \n or via an environment variable?\n A possible value would be a local path or public model name (e.g. deepset/roberta-base-squad2 like in the tutorial). Hope that helps. If not, we'll dig deeper :)\n In any case we should add a proper check + error message here.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Ierezell", "commentT": "2020-06-05T11:48:44Z", "comment_text": "\n \t\tThis issue is resolved by <denchmark-link:https://github.com/deepset-ai/haystack/pull/113>#113</denchmark-link>\n .\n \t\t"}}}, "commit": {"commit_id": "a7d2a5275918d794d722672556a1253bc8b6bc07", "commit_author": "Stan Kirdey", "commitT": "2020-06-05 13:48:06+02:00", "commit_complexity": {"commit_NLOC": "0.3333333333333333", "commit_CCN": "0.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "haystack\\finder.py", "file_new_name": "haystack\\finder.py", "file_complexity": {"file_NLOC": "217", "file_CCN": "18", "file_NToken": "1437"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "21,22", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,reader,retriever", "method_startline": "18", "method_endline": "22", "method_complexity": {"method_NLOC": "5", "method_CCN": "3", "method_NToken": "37", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "75,76,77", "deleted_lines": null, "method_info": {"method_name": "get_answers_via_similar_questions", "method_params": "self,str,int,dict", "method_startline": "64", "method_endline": "109", "method_complexity": {"method_NLOC": "24", "method_CCN": "6", "method_NToken": "217", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "36,37,38,50", "deleted_lines": null, "method_info": {"method_name": "get_answers", "method_params": "self,str,int,int,dict", "method_startline": "24", "method_endline": "62", "method_complexity": {"method_NLOC": "19", "method_CCN": "8", "method_NToken": "176", "method_nesting_level": "1"}}}}}}}}