{"BR": {"BR_id": "2635", "BR_author": "ibeltagy", "BRopenT": "2020-07-17T19:38:29Z", "BRcloseT": "2020-07-28T20:29:47Z", "BR_text": {"BRsummary": "Loss value in the progress bar is wrong when `accumulate_grad_batches &gt; 1`", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n The loss value reported in the progress bar is the_correct_loss_value / accumulate_grad_batches, so this value is wrong when accumulate_grad_batches > 1.\n This is happening because <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/blob/0.8.5/pytorch_lightning/trainer/training_loop.py#L799>here</denchmark-link>\n  the loss is divided by , then <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/blob/0.8.5/pytorch_lightning/trainer/training_loop.py#L663>here</denchmark-link>\n  the running loss is the  of these losses.\n To fix this, either remove the first line (no division by accumulate_grad_batches) or replace mean with sum in the second line.\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n \n Train any model with accumulate_grad_batches=1 and note the loss value reported in the progress bar\n Train the same model with accumulate_grad_batches=2 and half the batch size,  now the loss value in the progress bar will be half the value from step 1.\n \n <denchmark-h:h3>Expected Behaviour</denchmark-h>\n \n The loss in steps (1) and (2) should be the same\n <denchmark-h:h3>Environment</denchmark-h>\n \n pytorch-lightning==v0.8.5\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ibeltagy", "commentT": "2020-07-19T20:02:40Z", "comment_text": "\n \t\tduplicate of <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/issues/2569>#2569</denchmark-link>\n ?\n \t\t"}}}, "commit": {"commit_id": "c047676fae8cdbfe77189c218cfde73d863acc91", "commit_author": "Iz Beltagy", "commitT": "2020-07-28 16:29:46-04:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\training_loop.py", "file_new_name": "pytorch_lightning\\trainer\\training_loop.py", "file_complexity": {"file_NLOC": "727", "file_CCN": "189", "file_NToken": "3856"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "775", "deleted_lines": "775", "method_info": {"method_name": "run_training_batch", "method_params": "self,batch,batch_idx", "method_startline": "677", "method_endline": "801", "method_complexity": {"method_NLOC": "70", "method_CCN": "22", "method_NToken": "501", "method_nesting_level": "1"}}}}}}}}