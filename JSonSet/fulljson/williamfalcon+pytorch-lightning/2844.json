{"BR": {"BR_id": "2844", "BR_author": "ananthsub", "BRopenT": "2020-08-06T01:26:00Z", "BRcloseT": "2020-08-07T13:13:22Z", "BR_text": {"BRsummary": "Tensorboard logger fails to save model OmegaConf hparams", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n The Tensorboard logger fails to log module hyperparameters configured with OmegaConf. This happens when updating the logger hparams here:\n \n The trainer calls the logger's log_hyperparams here:\n Inside log_hyperparams the logger's hparams are updated here. This causes the hparams type to now be dict instead of DictConfig\n As a result, this branch in [save_hparams_to_yaml](https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pytorch_lightning/core/saving.py#L330-L333) is never triggered\n \n This is the stacktrace when logging hyperparams: <denchmark-link:https://gist.github.com/ananthsub/7acfdb0e0f551ed030f05f7674c37b46>https://gist.github.com/ananthsub/7acfdb0e0f551ed030f05f7674c37b46</denchmark-link>\n \n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n <denchmark-h:h4>Code sample</denchmark-h>\n \n A hacky fix would be something like changing the hparams update to use this inside the tensorboard logger:\n <denchmark-code>if isinstance(params, Container):\n    self.hparams = OmegaConf.merge(self.hparams, params)\n else:\n     self.hparams.update(params)\n </denchmark-code>\n \n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n <denchmark-h:h3>Environment</denchmark-h>\n \n Please copy and paste the output from our\n <denchmark-link:https://raw.githubusercontent.com/PyTorchLightning/pytorch-lightning/master/tests/collect_env_details.py>environment collection script</denchmark-link>\n \n (or fill out the checklist below manually).\n You can get the script and run it with:\n <denchmark-code>wget https://raw.githubusercontent.com/PyTorchLightning/pytorch-lightning/master/tests/collect_env_details.py\n # For security purposes, please check the contents of collect_env_details.py before running it.\n python collect_env_details.py\n </denchmark-code>\n \n \n PyTorch Version (e.g., 1.0):\n OS (e.g., Linux):\n How you installed PyTorch (conda, pip, source):\n Build command you used (if compiling from source):\n Python version:\n CUDA/cuDNN version:\n GPU models and configuration:\n Any other relevant information:\n \n <denchmark-h:h3>Additional context</denchmark-h>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "b39f4798a6859d2237b48b29b39a2390164612c1", "commit_author": "ananthsub", "commitT": "2020-08-07 09:13:21-04:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "42,43", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\core\\saving.py", "file_new_name": "pytorch_lightning\\core\\saving.py", "file_complexity": {"file_NLOC": "283", "file_CCN": "41", "file_NToken": "1177"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "332", "deleted_lines": "330", "method_info": {"method_name": "save_hparams_to_yaml", "method_params": "config_yaml,dict", "method_startline": "323", "method_endline": "345", "method_complexity": {"method_NLOC": "19", "method_CCN": "6", "method_NToken": "125", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pytorch_lightning\\loggers\\tensorboard.py", "file_new_name": "pytorch_lightning\\loggers\\tensorboard.py", "file_complexity": {"file_NLOC": "169", "file_CCN": "26", "file_NToken": "871"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "20,21,22,23,24,25,26,122,123,124,125", "deleted_lines": "115"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\training_io.py", "file_new_name": "pytorch_lightning\\trainer\\training_io.py", "file_complexity": {"file_NLOC": "371", "file_CCN": "96", "file_NToken": "1870"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "395", "deleted_lines": "393", "method_info": {"method_name": "dump_checkpoint", "method_params": "self,bool", "method_startline": "335", "method_endline": "402", "method_complexity": {"method_NLOC": "45", "method_CCN": "20", "method_NToken": "310", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "tests\\loggers\\test_tensorboard.py", "file_new_name": "tests\\loggers\\test_tensorboard.py", "file_complexity": {"file_NLOC": "104", "file_CCN": "9", "file_NToken": "777"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "97", "deleted_lines": "97", "method_info": {"method_name": "test_tensorboard_no_name", "method_params": "tmpdir,name", "method_startline": "92", "method_endline": "97", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "49", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "22,28,32,36", "deleted_lines": "19,20,21,22,28,32,36", "method_info": {"method_name": "test_tensorboard_hparams_reload", "method_params": "tmpdir", "method_startline": "19", "method_endline": "36", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "101", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "107", "deleted_lines": "107", "method_info": {"method_name": "test_tensorboard_log_metrics", "method_params": "tmpdir,step_idx", "method_startline": "101", "method_endline": "109", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "55", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "143,144,145,146,147,148,149,150,151,152,153,154,155,156,157", "deleted_lines": null, "method_info": {"method_name": "test_tensorboard_log_omegaconf_hparams_and_metrics", "method_params": "tmpdir", "method_startline": "143", "method_endline": "158", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "87", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "134,136,137,139,140", "deleted_lines": "134,136,137,139", "method_info": {"method_name": "test_tensorboard_log_hparams_and_metrics", "method_params": "tmpdir", "method_startline": "127", "method_endline": "140", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "101", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "119,121,122", "deleted_lines": "119,121,122", "method_info": {"method_name": "test_tensorboard_log_hyperparams", "method_params": "tmpdir", "method_startline": "112", "method_endline": "124", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "83", "method_nesting_level": "0"}}}}}}}}