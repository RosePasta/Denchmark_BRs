{"BR": {"BR_id": "2956", "BR_author": "lezwon", "BRopenT": "2020-08-13T17:37:50Z", "BRcloseT": "2020-08-13T22:57:24Z", "BR_text": {"BRsummary": "'NoneType' object has no attribute 'lower'  while training on TPU", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n distributed_backend is not set to 'tpu' which breaks it here: line \n \n \n pytorch-lightning/pytorch_lightning/trainer/distrib_data_parallel.py\n \n \n          Line 412\n       in\n       2c935d0\n \n \n \n \n \n \n  if self.distributed_backend.lower() not in ['ddp_spawn', 'ddp_cpu', 'tpu']: \n \n \n \n \n \n distributed_backend has to be explicitly specified in Trainer params to have it working which is misleading from the docs: <denchmark-link:https://pytorch-lightning.readthedocs.io/en/latest/tpu.html#distributed-backend-with-tpu>https://pytorch-lightning.readthedocs.io/en/latest/tpu.html#distributed-backend-with-tpu</denchmark-link>\n \n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n Steps to reproduce the behavior:\n <denchmark-link:https://www.kaggle.com/lezwon/lightning-mnist-tpu>https://www.kaggle.com/lezwon/lightning-mnist-tpu</denchmark-link>\n \n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n Should automatically set distributed_backend and train successfully.\n <denchmark-h:h3>Additional context</denchmark-h>\n \n Related to :\n <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/issues/2698#issuecomment-671665202>#2698 (comment)</denchmark-link>\n \n <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/issues/2812#issuecomment-668659590>#2812 (comment)</denchmark-link>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "cfd06a083b47b6c5c619f5362441197cb4e93e9e", "commit_author": "Lezwon Castelino", "commitT": "2020-08-13 18:57:23-04:00", "commit_complexity": {"commit_NLOC": "0.2", "commit_CCN": "0.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\distrib_data_parallel.py", "file_new_name": "pytorch_lightning\\trainer\\distrib_data_parallel.py", "file_complexity": {"file_NLOC": "374", "file_CCN": "88", "file_NToken": "1552"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "241,242,243", "method_info": {"method_name": "init_tpu", "method_params": "self", "method_startline": "240", "method_endline": "245", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "10", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pytorch_lightning\\trainer\\trainer.py", "file_new_name": "pytorch_lightning\\trainer\\trainer.py", "file_complexity": {"file_NLOC": "1109", "file_CCN": "141", "file_NToken": "4911"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "524", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 12, "file_old_name": "tests\\models\\test_tpu.py", "file_new_name": "tests\\models\\test_tpu.py", "file_complexity": {"file_NLOC": "176", "file_CCN": "14", "file_NToken": "1151"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "199,200,201,202,203", "deleted_lines": null, "method_info": {"method_name": "test_dataloaders_passed_to_fit", "method_params": "tmpdir", "method_startline": "194", "method_endline": "205", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "55", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "44", "method_info": {"method_name": "test_model_tpu_cores_1", "method_params": "tmpdir", "method_startline": "38", "method_endline": "51", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "64", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "128", "method_info": {"method_name": "test_model_16bit_tpu_index", "method_params": "tmpdir,tpu_core", "method_startline": "119", "method_endline": "137", "method_complexity": {"method_NLOC": "17", "method_CCN": "1", "method_NToken": "107", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": null, "deleted_lines": "189", "method_info": {"method_name": "test_tpu_grad_norm", "method_params": "tmpdir", "method_startline": "183", "method_endline": "197", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "70", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": null, "deleted_lines": "63", "method_info": {"method_name": "test_model_tpu_index", "method_params": "tmpdir,tpu_core", "method_startline": "57", "method_endline": "71", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "79", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": null, "deleted_lines": "149", "method_info": {"method_name": "test_model_16bit_tpu_cores_8", "method_params": "tmpdir", "method_startline": "142", "method_endline": "160", "method_complexity": {"method_NLOC": "15", "method_CCN": "1", "method_NToken": "78", "method_nesting_level": "0"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "238,239,240,241,242,243", "deleted_lines": "239", "method_info": {"method_name": "test_exception_when_no_tpu_found", "method_params": "tmpdir", "method_startline": "231", "method_endline": "244", "method_complexity": {"method_NLOC": "12", "method_CCN": "1", "method_NToken": "62", "method_nesting_level": "0"}}}, "hunk_7": {"Ismethod": 1, "added_lines": null, "deleted_lines": "175", "method_info": {"method_name": "test_model_tpu_early_stop", "method_params": "tmpdir", "method_startline": "165", "method_endline": "178", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "54", "method_nesting_level": "0"}}}, "hunk_8": {"Ismethod": 1, "added_lines": null, "deleted_lines": "82", "method_info": {"method_name": "test_model_tpu_cores_8", "method_params": "tmpdir", "method_startline": "76", "method_endline": "93", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "74", "method_nesting_level": "0"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "241,242,243", "deleted_lines": null, "method_info": {"method_name": "test_distributed_backend_set_when_using_tpu", "method_params": "tmpdir,tpu_cores", "method_startline": "241", "method_endline": "243", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "19", "method_nesting_level": "0"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "220", "deleted_lines": null, "method_info": {"method_name": "test_tpu_misconfiguration", "method_params": "", "method_startline": "217", "method_endline": "220", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "27", "method_nesting_level": "0"}}}, "hunk_11": {"Ismethod": 1, "added_lines": null, "deleted_lines": "105", "method_info": {"method_name": "test_model_16bit_tpu_cores_1", "method_params": "tmpdir", "method_startline": "98", "method_endline": "113", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "80", "method_nesting_level": "0"}}}}}}}}