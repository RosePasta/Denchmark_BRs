{"BR": {"BR_id": "3402", "BR_author": "paulkre", "BRopenT": "2020-06-07T18:15:33Z", "BRcloseT": "2020-06-08T18:39:02Z", "BR_text": {"BRsummary": "`tf.LayersModel.save` not working inside web worker", "BRdescription": "\n <denchmark-h:h4>TensorFlow.js version</denchmark-h>\n \n 2.0.0\n <denchmark-h:h4>Browser version</denchmark-h>\n \n Chrome 83.0.4103.61\n <denchmark-h:h4>Description</denchmark-h>\n \n <denchmark-code>model.worker.ts:4 Uncaught ReferenceError: window is not defined\n     at Module../node_modules/workerize-loader/dist/rpc-worker-loader.js!./node_modules/babel-loader/lib/index.js?!./node_modules/eslint-loader/dist/cjs.js?!./src/game/ml/model.worker.ts (model.worker.ts:4)\n     at __webpack_require__ (bootstrap:19)\n     at bootstrap:83\n     at bootstrap:83\n </denchmark-code>\n \n Saving a LayersModel to the IndexedDB inside a web worker does not work because the window object is not defined. This is because inside a web worker the global scope is saved in a variable named self or globalThis.\n The problem was identified in <denchmark-link:https://github.com/tensorflow/tfjs/issues/2643>#2643</denchmark-link>\n  and it was attempted to be fixed in PR <denchmark-link:https://github.com/tensorflow/tfjs/pull/2647>#2647</denchmark-link>\n . Unfortunately, the merged solution did not fix the problem (I am not sure how it passed the review).\n <denchmark-link:https://github.com/tensorflow/tfjs/blob/81b390dbc5be3109db049f098117eae0e08721da/tfjs-core/src/io/indexed_db.ts#L60>The following line</denchmark-link>\n  will throw a  because  is not defined.\n const theWindow: any = window || self;\n A better implementation would be:\n const theWindow: any = typeof window === 'undefined' ? self : window;\n \t"}, "comments": {}}, "commit": {"commit_id": "64f0a8b1df610ee0b38ce3047ef031cb4dc7f9d0", "commit_author": "Paul Kretschel", "commitT": "2020-06-08 11:39:01-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\io\\indexed_db.ts", "file_new_name": "tfjs-core\\src\\io\\indexed_db.ts", "file_complexity": {"file_NLOC": "247", "file_CCN": "64", "file_NToken": "1693"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "60", "deleted_lines": "60", "method_info": {"method_name": "getIndexedDBFactory", "method_params": "", "method_startline": "50", "method_endline": "69", "method_complexity": {"method_NLOC": "16", "method_CCN": "8", "method_NToken": "84", "method_nesting_level": "0"}}}}}}}}