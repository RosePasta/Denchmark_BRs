{"BR": {"BR_id": "4481", "BR_author": "zhuyingyan", "BRopenT": "2021-01-04T12:35:17Z", "BRcloseT": "2021-01-06T00:31:40Z", "BR_text": {"BRsummary": "Use tfjs 2.8.2 executeAsync show 'length' undefined error", "BRdescription": "\n System information\n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow.js): No\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows 10\n TensorFlow.js installed from (npm or script link): script link\n TensorFlow.js version (use command below): 2.8.2\n Browser version: Google Chrome. Version 87.0.4280.88\n \n \n I use a train model by myself. When I use Tensorflow.js 2.7.0, it was ok. But, when I use the latest Version Tensorflow.js 2.8.2(script link: <denchmark-link:https://cdn.jsdelivr.net/npm/@tensorflow/tfjs>https://cdn.jsdelivr.net/npm/@tensorflow/tfjs</denchmark-link>\n ), use code , it show an error:\n \n Describe the expected behavior\n I just want to use as Tensorflow.js 2.7.0 as well\n Standalone code to reproduce the issue\n Here is the code:\n <denchmark-code>const MODEL_URL = \"./niu_web_model/model.json\";\n const model = await tf.loadGraphModel(MODEL_URL);\n const cat = document.getElementById(\"cat\");\n model\n    .executeAsync(tf.browser.fromPixels(cat).expandDims(0))   // error when execute to here\n    .then((modelres) => {                       \n       console.log(modelres[6].dataSync(),modelres[7].dataSync())\n     });\n </denchmark-code>\n \n error show:\n <denchmark-code>Uncaught (in promise) TypeError: Cannot read property 'length' of undefined\n     at Vz (tfjs:17)\n     at Object.kernelFunc (tfjs:17)\n     at p (tfjs:17)\n     at tfjs:17\n     at e.t.scopedRun (tfjs:17)\n     at e.t.runKernelFunc (tfjs:17)\n     at e.t.runKernel (tfjs:17)\n     at topk_ (tfjs:17)\n     at topk__op (tfjs:17)\n     at tfjs:17\n </denchmark-code>\n \n It 's ok when use in Tensorflow.js 2.7.0.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "zhuyingyan", "commentT": "2021-01-04T19:08:16Z", "comment_text": "\n \t\tI got a similar error, but when running tf.topk() on my prediction results instead.\n What seemed to fix it was running .print() on the inference output tensor.\n This works:\n <denchmark-code>const prediction = model.predict(x);\n prediction.print();\n const topPreds = tf.topk(prediction, 3, true);`\n </denchmark-code>\n \n But this throws an error\n <denchmark-code>const prediction = model.predict(x);\n const topPreds = tf.topk(prediction, 3, true);\n \n Unhandled Promise rejection: Cannot read property 'length' of undefined ; Zone: <root> ; Task: Promise.then ; Value: TypeError: Cannot read property 'length' of undefined\n     at topKImpl (TopK_impl.js:22)\n     at Object.topK [as kernelFunc] (TopK.js:24)\n     at kernelFunc (engine.js:440)\n     at engine.js:504\n     at Engine.scopedRun (engine.js:333)\n     at Engine.runKernelFunc (engine.js:502)\n     at Engine.runKernel (engine.js:391)\n     at topk_ (topk.js:57)\n     at Module.topk__op (operation.js:44)\n </denchmark-code>\n \n No clue why the error is being thrown without the print though.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "zhuyingyan", "commentT": "2021-01-04T23:51:36Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/zhuyingyan>@zhuyingyan</denchmark-link>\n  <denchmark-link:https://github.com/MiksVasiljevs>@MiksVasiljevs</denchmark-link>\n  can either of you provide a codepen example for this failure?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "zhuyingyan", "commentT": "2021-01-05T07:01:15Z", "comment_text": "\n \t\t\n @zhuyingyan @MiksVasiljevs can either of you provide a codepen example for this failure?\n \n See here:\n <denchmark-link:https://codepen.io/miksvasiljevs/pen/VwKxpGK>https://codepen.io/miksvasiljevs/pen/VwKxpGK</denchmark-link>\n \n Let me know if there are any issues with the pen or anything.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "zhuyingyan", "commentT": "2021-01-06T00:31:41Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4481>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4481>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "e249b6d7c62ea34cbb0a6c6a498bf1935a97ee3c", "commit_author": "Ping Yu", "commitT": "2021-01-05 16:31:39-08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-backend-webgl\\src\\kernels\\Bincount.ts", "file_new_name": "tfjs-backend-webgl\\src\\kernels\\Bincount.ts", "file_complexity": {"file_NLOC": "22", "file_CCN": "1", "file_NToken": "173"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "32,33", "deleted_lines": "32,33", "method_info": {"method_name": "bincount", "method_params": "BincountInputs,MathBackendWebGL", "method_startline": "23", "method_endline": "39", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "112", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tfjs-backend-webgl\\src\\kernels\\Concat_impl.ts", "file_new_name": "tfjs-backend-webgl\\src\\kernels\\Concat_impl.ts", "file_complexity": {"file_NLOC": "74", "file_CCN": "17", "file_NToken": "745"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "60", "deleted_lines": "60", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "59", "method_endline": "106", "method_complexity": {"method_NLOC": "35", "method_CCN": "4", "method_NToken": "327", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "60", "deleted_lines": "60", "method_info": {"method_name": "backend.readSync", "method_params": "dataId", "method_startline": "60", "method_endline": "61", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "14", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "60", "deleted_lines": "60", "method_info": {"method_name": "backend.texData.get", "method_params": "dataId", "method_startline": "60", "method_endline": "61", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "16", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-backend-webgl\\src\\kernels\\DenseBincount.ts", "file_new_name": "tfjs-backend-webgl\\src\\kernels\\DenseBincount.ts", "file_complexity": {"file_NLOC": "32", "file_CCN": "3", "file_NToken": "289"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "33,34", "deleted_lines": "33,34,35", "method_info": {"method_name": "denseBincount", "method_params": "DenseBincountInputs,MathBackendWebGL", "method_startline": "23", "method_endline": "52", "method_complexity": {"method_NLOC": "24", "method_CCN": "3", "method_NToken": "226", "method_nesting_level": "0"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-backend-webgl\\src\\kernels\\Tile.ts", "file_new_name": "tfjs-backend-webgl\\src\\kernels\\Tile.ts", "file_complexity": {"file_NLOC": "26", "file_CCN": "3", "file_NToken": "238"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "32,33,34", "deleted_lines": "32", "method_info": {"method_name": "tile", "method_params": "TileInputs,MathBackendWebGL", "method_startline": "24", "method_endline": "45", "method_complexity": {"method_NLOC": "17", "method_CCN": "2", "method_NToken": "161", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-backend-webgl\\src\\kernels\\TopK.ts", "file_new_name": "tfjs-backend-webgl\\src\\kernels\\TopK.ts", "file_complexity": {"file_NLOC": "24", "file_CCN": "1", "file_NToken": "190"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "30", "deleted_lines": "30", "method_info": {"method_name": "topK", "method_params": "TopKInputs,MathBackendWebGL", "method_startline": "23", "method_endline": "40", "method_complexity": {"method_NLOC": "16", "method_CCN": "1", "method_NToken": "127", "method_nesting_level": "0"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\bincount_test.ts", "file_new_name": "tfjs-core\\src\\ops\\bincount_test.ts", "file_complexity": {"file_NLOC": "64", "file_CCN": "12", "file_NToken": "781"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "90,91,92,93,94,95,96,97,98,99,100", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "22", "method_endline": "101", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "90", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\dense_bincount_test.ts", "file_new_name": "tfjs-core\\src\\ops\\dense_bincount_test.ts", "file_complexity": {"file_NLOC": "95", "file_CCN": "17", "file_NToken": "1233"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "132,133,134,135,136,137,138,139,140,141,142,143", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "22", "method_endline": "144", "method_complexity": {"method_NLOC": "15", "method_CCN": "1", "method_NToken": "134", "method_nesting_level": "0"}}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\topk_test.ts", "file_new_name": "tfjs-core\\src\\ops\\topk_test.ts", "file_complexity": {"file_NLOC": "140", "file_CCN": "15", "file_NToken": "1674"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "167,168,169,170,171,172,173,174,175,176,177,178,179", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "27", "method_endline": "180", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "132", "method_nesting_level": "0"}}}}}}}}