{"BR": {"BR_id": "3869", "BR_author": "kashikarparth", "BRopenT": "2020-09-01T09:41:32Z", "BRcloseT": "2020-09-03T22:07:02Z", "BR_text": {"BRsummary": "Memory leak issues in tensor.max()", "BRdescription": "\n <denchmark-h:h4>TensorFlow.js version : 2.3.0</denchmark-h>\n \n <denchmark-h:h4>Browser version: Google Chrome 74</denchmark-h>\n \n async function predicttest() {\n while (true) {\n     console.log('Executing');\n     tf.engine().startScope();  \n         const img = tf.ones([300,300])\n         const fbmx = tf.tidy(() => img.max()); //giving memory leak, but min doesnt.\n         img.dispose();\n         fbmx.dispose();\n     tf.engine().endScope();\n     await tf.nextFrame(); \n   }\n }\n GPU memory allocated continues to rise while executing this while loop (made after isolating the leak). No issues if tensor.min() is used instead.\n I have tried to use tf.setBackend('webgl') and tf.disposeVariables(), but to no avail.\n Is there a way to eliminate the memory leak? The issue is solely from the max() operation.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "kashikarparth", "commentT": "2020-09-01T13:58:46Z", "comment_text": "\n \t\tConfirmed with minimal <denchmark-link:https://codepen.io/tafsiri/pen/dyMzrMm?editable=true&editors=0012%3Dhttps%3A%2F%2Fjs.tensorflow.org%2Fapi%2Flatest%2F>codepen reproduction</denchmark-link>\n , <denchmark-link:https://github.com/annxingyuan>@annxingyuan</denchmark-link>\n  would you be able to take a look.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "kashikarparth", "commentT": "2020-09-03T22:07:04Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tfjs/issues/3869>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tfjs/issues/3869>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "6d39fab41fec9dc6ffb71bf8f0d8893972a3a95a", "commit_author": "Ann Yuan", "commitT": "2020-09-03 18:07:01-04:00", "commit_complexity": {"commit_NLOC": "0.3793103448275862", "commit_CCN": "1.0", "commit_Nprams": "0.8620689655172413"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-backend-webgl\\src\\argminmax_gpu.ts", "file_new_name": "tfjs-backend-webgl\\src\\argminmax_gpu.ts", "file_complexity": {"file_NLOC": "39", "file_CCN": "1", "file_NToken": "241"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "29", "deleted_lines": "29,30,31,32"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-backend-webgl\\src\\backend_webgl.ts", "file_new_name": "tfjs-backend-webgl\\src\\backend_webgl.ts", "file_complexity": {"file_NLOC": "2404", "file_CCN": "68", "file_NToken": "15741"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1046,1047,1067,1068,1069,1070,1071,1072", "deleted_lines": "1046,1066"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-backend-webgl\\src\\kernel_utils\\reduce.ts", "file_new_name": "tfjs-backend-webgl\\src\\kernel_utils\\reduce.ts", "file_complexity": {"file_NLOC": "36", "file_CCN": "4", "file_NToken": "300"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "27,28", "deleted_lines": "28", "method_info": {"method_name": "getReductionStages", "method_params": "", "method_startline": "27", "method_endline": "28", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "23", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "48,49,50,51,52,53,54,55,56,57,58,59,60,61,64", "deleted_lines": null, "method_info": {"method_name": "reduce", "method_params": "TensorInfo,DataType,ReduceTypes,MathBackendWebGL", "method_startline": "45", "method_endline": "65", "method_complexity": {"method_NLOC": "17", "method_CCN": "3", "method_NToken": "138", "method_nesting_level": "0"}}}}}, "file_3": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tfjs-backend-webgl\\src\\kernels\\Max_test.ts", "file_complexity": {"file_NLOC": "16", "file_CCN": "2", "file_NToken": "143"}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-backend-webgl\\src\\reduce_gpu.ts", "file_new_name": "tfjs-backend-webgl\\src\\reduce_gpu.ts", "file_complexity": {"file_NLOC": "129", "file_CCN": "0", "file_NToken": "879"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "29", "deleted_lines": "29,30,31,32"}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\max_test.ts", "file_new_name": "tfjs-core\\src\\ops\\max_test.ts", "file_complexity": {"file_NLOC": "208", "file_CCN": "47", "file_NToken": "3100"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "35,36,37,38,39,40,41", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "35", "method_endline": "41", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "50", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\reduce_util.ts", "file_new_name": "tfjs-core\\src\\ops\\reduce_util.ts", "file_complexity": {"file_NLOC": "14", "file_CCN": "2", "file_NToken": "75"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "30", "deleted_lines": null}}}}}}