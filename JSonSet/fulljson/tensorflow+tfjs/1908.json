{"BR": {"BR_id": "1908", "BR_author": "jungwook", "BRopenT": "2019-08-24T04:41:22Z", "BRcloseT": "2019-09-28T19:31:08Z", "BR_text": {"BRsummary": "Cannot save then load LSTM layers model", "BRdescription": "\n To get help from the community, we encourage using Stack Overflow and the <denchmark-link:https://stackoverflow.com/questions/tagged/tensorflow.js>tensorflow.js</denchmark-link>\n  tag.\n <denchmark-h:h4>TensorFlow.js version</denchmark-h>\n \n 1.2.7\n <denchmark-h:h4>Browser version</denchmark-h>\n \n N/A. using node\n <denchmark-h:h4>Describe the problem or feature request</denchmark-h>\n \n Cannot load a saved model with LSTM layers.\n <denchmark-h:h4>Code to reproduce the bug / link to feature request</denchmark-h>\n \n <denchmark-code>const model = tf.sequential();\n model.add(tf.layers.dense({units: 1, inputShape: [10, 20]}));\n const cells = [\n     tf.layers.lstmCell({units: 4}),\n     tf.layers.lstmCell({units: 8}),\n ];\n const rnn = tf.layers.rnn({cell: cells, returnSequences: true});\n model.add(rnn);\n \n model.save('file://test1').then( _ =>{\n     tf.loadLayersModel('file://test1/model.json').then(m2=>{\n         console.log(m2);\n     })\n })  \n </denchmark-code>\n \n Then you get something like the following.\n (node:20145) UnhandledPromiseRejectionWarning: Error: Duplicate weight name: rnn_RNN1/kernel at new ValueError (/Users/jungwook/Documents/Development/Tensor/node_modules/@tensorflow/tfjs-layers/dist/errors.js:68:28)at Sequential.Container.loadWeights (/Users/jungwook/Documents/Development/Tensor/node_modules/@tensorflow/tfjs-layers/dist/engine/container. at /Users/jungwook/Documents/Development/Tensor/node_modules/@tensorflow/tfjs-layers/dist/models.js:302:27 at step (/Users/jungwook/Documents/Development/Tensor/node_modules/@tensorflow/tfjs-layers/dist/models.js:54:23) at Object.next (/Users/jungwook/Documents/Development/Tensor/node_modules/@tensorflow/tfjs-layers/dist/models.js:35:53) at fulfilled (/Users/jungwook/Documents/Development/Tensor/node_modules/@tensorflow/tfjs-layers/dist/models.js:26:58)\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jungwook", "commentT": "2019-08-27T21:55:06Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/caisq>@caisq</denchmark-link>\n  there is a fix which was merged earlier <denchmark-link:https://github.com/tensorflow/tfjs-layers/pull/547>here</denchmark-link>\n  , but the issue still persists , can you please check again. Thank you related issues\n <denchmark-link:https://github.com/tensorflow/tfjs/issues/1476>#1476</denchmark-link>\n  , <denchmark-link:https://github.com/tensorflow/tfjs/issues/1721>#1721</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jungwook", "commentT": "2019-08-27T22:04:07Z", "comment_text": "\n \t\tStill not working. I\u2019m using the latest version of tfjs but same error persists\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "jungwook", "commentT": "2019-08-29T20:56:49Z", "comment_text": "\n \t\tHey guys, hope to contribute a little as well!\n Version: \"@tensorflow/tfjs-node\": \"^1.2.8\"\n Error:\n <denchmark-code>Error: Duplicate weight name: rnn_RNN1/kernel\n at new ValueError (/Users/myuser/Projects/test/tf_proj/node_modules/@tensorflow/tfjs-layers/src/errors.ts:48:5)\n at Sequential.Container.loadWeights (/Users/myuser/Projects/test/tf_proj/node_modules/@tensorflow/tfjs-layers/src/engine/container.ts:583:17)\n at /Users/myuser/Projects/test/tf_proj/node_modules/@tensorflow/tfjs-layers/src/models.ts:324:11\n at step (/Users/myuser/Projects/test/tf_proj/node_modules/@tensorflow/tfjs-layers/dist/models.js:54:23)\n at Object.next (/Users/myuser/Projects/test/tf_proj/node_modules/@tensorflow/tfjs-layers/dist/models.js:35:53)\n at fulfilled (/Users/myuser/Projects/test/tf_proj/node_modules/@tensorflow/tfjs-layers/dist/models.js:26:58)\n </denchmark-code>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "jungwook", "commentT": "2019-09-21T20:20:45Z", "comment_text": "\n \t\tStill not working.\n Tenserflow 1.2.9.\n Tested in Chrome 76, Win x64.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "jungwook", "commentT": "2019-09-27T21:13:38Z", "comment_text": "\n \t\tThe root cause of the problem is that the s of the weights of different RNN cells clashed.\n <denchmark-link:https://github.com/tensorflow/tfjs/pull/2105>#2105</denchmark-link>\n  should fix it.\n Sorry for the delay.\n \t\t"}}}, "commit": {"commit_id": "b3eed6824c15910be9adbbb46fc0e2c806daf084", "commit_author": "Shanqing Cai", "commitT": "2019-09-28 15:31:07-04:00", "commit_complexity": {"commit_NLOC": "0.4473684210526316", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-layers\\src\\layers\\recurrent.ts", "file_new_name": "tfjs-layers\\src\\layers\\recurrent.ts", "file_complexity": {"file_NLOC": "1535", "file_CCN": "180", "file_NToken": "11557"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "2204,2205,2206,2207,2208,2209,2210,2211,2212,2213,2214,2215,2216", "deleted_lines": "2204,2205,2206,2207,2208,2209,2210,2211,2212", "method_info": {"method_name": "this.cells.forEach", "method_params": "", "method_startline": "2204", "method_endline": "2216", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "18", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "2205,2206,2207,2208,2209,2210,2211,2212,2213,2214,2215", "deleted_lines": "2205,2206,2207,2208,2209,2210,2211,2212", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "2205", "method_endline": "2215", "method_complexity": {"method_NLOC": "9", "method_CCN": "2", "method_NToken": "53", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-layers\\src\\layers\\recurrent_test.ts", "file_new_name": "tfjs-layers\\src\\layers\\recurrent_test.ts", "file_complexity": {"file_NLOC": "2067", "file_CCN": "191", "file_NToken": "19263"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1658,1659,1660,1661,1662,1663,1664,1665,1666,1667,1668,1669,1670,1671,1672,1673,1674,1675,1676,1677,1678,1679,1680,1681,1682,1683,1684,1685", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "1658", "method_endline": "1685", "method_complexity": {"method_NLOC": "21", "method_CCN": "1", "method_NToken": "238", "method_nesting_level": "0"}}}}}}}}