{"BR": {"BR_id": "4386", "BR_author": "martun", "BRopenT": "2020-12-10T16:30:16Z", "BRcloseT": "2020-12-17T11:25:41Z", "BR_text": {"BRsummary": "Tensorflow.js with wasm backend is trying to use unsupported function 'resizeNearestNeighbor', even though I used bilinear interpolation in all the places", "BRdescription": "\n Please make sure that this is a bug. As per our\n GitHub Policy,\n we only address code/doc bugs, performance issues, feature requests and\n build/installation issues on GitHub. tag:bug_template\n System information\n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow.js): No\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 18.04\n Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\n TensorFlow.js installed from (npm or script link): pip install tensorflowjs\n TensorFlow.js version (use command below): 2.7.0\n Browser version: Google Chrome Version 84.0.4147.89 (Official Build) (64-bit)\n Tensorflow.js Converter Version: v2.4.0\n \n Describe the current behavior\n Tensorflow.js with wasm backend is trying to use unsupported function 'resizeNearestNeighbor', even though I used bilinear interpolation in all the places. I get the following error when trying to run inference in the browser \"Error: 'resizeNearestNeighbor' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen\".\n Code runs smoothly but slowly when switching to \"cpu\" backend.\n Describe the expected behavior\n I would like the inference to run without errors and use Bilinear interpolation which is supported on all the backends.\n Standalone code to reproduce the issue\n Provide a reproducible test case that is the bare minimum necessary to generate\n the problem. If possible, please share a link to Colab/CodePen/any notebook.\n I can not share the trained weights, but the rest of inference code is here. You can see the model.json file, which does not contain any nearest neighbor interpolation.\n <denchmark-link:https://github.com/martun/tensorflow_js_issue>https://github.com/martun/tensorflow_js_issue</denchmark-link>\n \n Other info / logs Include any logs or source code that would be helpful to\n diagnose the problem. If including tracebacks, please include the full\n traceback. Large logs and files should be attached.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "martun", "commentT": "2020-12-10T17:19:50Z", "comment_text": "\n \t\tRelated to <denchmark-link:https://github.com/tensorflow/tfjs/issues/4340>#4340</denchmark-link>\n  and <denchmark-link:https://github.com/tensorflow/tfjs/issues/4212>#4212</denchmark-link>\n \n The underlying issue is the UpSampling2D layer (used in your model0 directly calls  and doesn't seem handle the bilinear interpolation option. <denchmark-link:https://github.com/pyu10055>@pyu10055</denchmark-link>\n  <denchmark-link:https://github.com/caisq>@caisq</denchmark-link>\n , should this be an enhancement to the UpSampling2D layer?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "martun", "commentT": "2020-12-10T18:36:23Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/tafsiri>@tafsiri</denchmark-link>\n  I agree this should be considered as an enhancement. It is currently unimplemented is most likely lack of support by tfjs-core. So it's possible that the nearest-neighbor resampling support is still unavailable from tfjs-core and that'll need to be addressed first.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "martun", "commentT": "2020-12-11T16:42:28Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/caisq>@caisq</denchmark-link>\n  tfjs-core has both resizeNearestNeighbour (currently called) and resizeBilinear, so we should be able to switch on that unless resizeBilinear does not support something required by upsampling2d.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "martun", "commentT": "2020-12-11T16:43:18Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/caisq>@caisq</denchmark-link>\n  Actually looks like its been added!\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "martun", "commentT": "2020-12-17T11:25:30Z", "comment_text": "\n \t\tThanks guys, it started to work after I updated to tfjs version: 2.8.0\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "martun", "commentT": "2020-12-17T11:25:42Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4386>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4386>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "a535ae1328546469e0565a612f470f697b1b5671", "commit_author": "Ping Yu", "commitT": "2020-12-10 13:47:33-08:00", "commit_complexity": {"commit_NLOC": "0.4657534246575342", "commit_CCN": "0.9726027397260274", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-layers\\src\\common.ts", "file_new_name": "tfjs-layers\\src\\common.ts", "file_complexity": {"file_NLOC": "63", "file_CCN": "14", "file_NToken": "430"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "26,27,28,29", "deleted_lines": null, "method_info": {"method_name": "checkInterpolationFormat", "method_params": "string", "method_startline": "26", "method_endline": "29", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "18", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-layers\\src\\common_test.ts", "file_new_name": "tfjs-layers\\src\\common_test.ts", "file_complexity": {"file_NLOC": "135", "file_CCN": "38", "file_NToken": "1088"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "41", "method_endline": "63", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "22", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-layers\\src\\keras_format\\common.ts", "file_new_name": "tfjs-layers\\src\\keras_format\\common.ts", "file_complexity": {"file_NLOC": "15", "file_CCN": "0", "file_NToken": "149"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "24,25", "deleted_lines": null}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tfjs-layers\\src\\layers\\convolutional.ts", "file_new_name": "tfjs-layers\\src\\layers\\convolutional.ts", "file_complexity": {"file_NLOC": "901", "file_CCN": "100", "file_NToken": "7187"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "567", "deleted_lines": "567", "method_info": {"method_name": "tidy", "method_params": "", "method_startline": "562", "method_endline": "599", "method_complexity": {"method_NLOC": "34", "method_CCN": "8", "method_NToken": "292", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "1263,1264,1265,1266,1271,1272,1273", "deleted_lines": "1258", "method_info": {"method_name": "tfc.tidy", "method_params": "", "method_startline": "1255", "method_endline": "1275", "method_complexity": {"method_NLOC": "19", "method_CCN": "4", "method_NToken": "189", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "1234,1235,1236,1237", "deleted_lines": null, "method_info": {"method_name": "constructor", "method_params": "UpSampling2DLayerArgs", "method_startline": "1228", "method_endline": "1238", "method_complexity": {"method_NLOC": "11", "method_CCN": "4", "method_NToken": "88", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-layers\\src\\layers\\convolutional_test.ts", "file_new_name": "tfjs-layers\\src\\layers\\convolutional_test.ts", "file_complexity": {"file_NLOC": "1407", "file_CCN": "275", "file_NToken": "12711"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1460,1461,1462,1463,1464,1465,1466,1467,1468,1469,1470,1471,1472,1473,1474,1476,1477,1478,1479,1480,1482,1483,1484,1485,1486,1487,1488,1489,1491,1492,1494,1495,1496,1497,1498,1499,1500,1501,1502,1503,1504,1505,1506,1507,1508,1509,1510,1511,1512,1513,1514,1515,1516,1517,1518,1519,1522,1523", "deleted_lines": "1460,1461,1462,1463,1464,1465,1466,1467,1468,1469,1470,1472,1473,1474,1475,1477,1478,1479,1480,1481,1482,1483,1484,1485,1486,1487,1488,1489,1490,1491,1492,1493,1494,1495,1496,1497,1498,1499,1500,1501,1502,1503,1505,1506,1508,1509,1510,1511,1512,1513,1515,1517,1518", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "1460", "method_endline": "1523", "method_complexity": {"method_NLOC": "60", "method_CCN": "14", "method_NToken": "419", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "1459,1460,1461,1462,1463,1464,1465,1466,1467,1468,1469,1470,1471,1472,1473,1474,1476,1477,1478,1479,1480,1482,1483,1484,1485,1486,1487,1488,1489,1491,1492,1494,1495,1496,1497,1498,1499,1500,1501,1502,1503,1504,1505,1506,1507,1508,1509,1510,1511,1512,1513,1514,1515,1516,1517,1518,1519,1522,1523,1524", "deleted_lines": "1459,1460,1461,1462,1463,1464,1465,1466,1467,1468,1469,1470,1472,1473,1474,1475,1477,1478,1479,1480,1481,1482,1483,1484,1485,1486,1487,1488,1489,1490,1491,1492,1493,1494,1495,1496,1497,1498,1499,1500,1501,1502,1503,1505,1506,1508,1509,1510,1511,1512,1513,1515,1517,1518", "method_info": {"method_name": "JSON.stringify", "method_params": "undeterminedDimension", "method_startline": "1459", "method_endline": "1528", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "21", "method_nesting_level": "0"}}}}}}}}