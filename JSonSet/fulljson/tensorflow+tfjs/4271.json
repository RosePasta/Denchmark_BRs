{"BR": {"BR_id": "4271", "BR_author": "BruceDai", "BRopenT": "2020-11-19T12:42:07Z", "BRcloseT": "2020-11-26T07:17:38Z", "BR_text": {"BRsummary": "[tfjs-core] Error: The output # of rows (11.4) must be an integer when running pool test", "BRdescription": "\n System information\n \n TensorFlow.js version (use command below):\n \"@tensorflow-core\": \"^2.7.0\"\n \n \n When running <denchmark-link:https://brucedai.github.io/report-bug/unset_roundingMode_param.html>this pool test</denchmark-link>\n , error happened\n \n None error, and the output # of rows is an integer (11) computed with below Python code of <denchmark-link:https://android.googlesource.com/platform/frameworks/ml/+/refs/tags/android-cts-11.0_r1/nn/runtime/test/specs/V1_0/avg_pool_float_2.mod.py>AVERAGE_POOL_2D test</denchmark-link>\n  from NNAPI  CTS.\n row = 52\n std = 5\n flt = 100\n pad = 50\n output_row = (row + 2 * pad - flt + std) // std #L35\n \n Here's a <denchmark-link:https://brucedai.github.io/report-bug/unset_roundingMode_param.html>test case</denchmark-link>\n .\n Other info / logs Include any logs or source code that would be helpful to\n When calling function conditionalRound, none value (undefined) was passed to the second roundingMode paramter, so as the first value paramter being not an integer (11.4), the value wasn't rounded.\n /**\n  * Rounds a value depending on the rounding mode\n  * @param value\n  * @param roundingMode\n  */\n function conditionalRound(\n     value: number, roundingMode?: 'floor'|'round'|'ceil') {\n   if (!roundingMode) {\n     return value;\n   }\n   switch (roundingMode) {\n     case 'round':\n       // used for Caffe Conv\n       return Math.round(value);\n     case 'ceil':\n       // used for Caffe Pool\n       return Math.ceil(value);\n     case 'floor':\n       return Math.floor(value);\n     default:\n       throw new Error(`Unknown roundingMode ${roundingMode}`);\n   }\n }\n Traced that when calling function  of <denchmark-link:https://github.com/tensorflow/tfjs/blob/master/tfjs-core/src/ops/pool.ts#L85>tfjs-core/src/ops/pool.ts#L85</denchmark-link>\n , none value (undefined) was passed to the sixth  parameter .\n   const convInfo = conv_util.computePool2DInfo(\n       x4D.shape, windowShape, strides, dilations, pad);\n According to <denchmark-link:https://github.com/tensorflow/tfjs/blob/4d81b29a13cb67a0fae67833890cac326ca4d720/tfjs-core/src/ops/conv_util.ts#L119>computePool2DInfo definitions</denchmark-link>\n :\n export function computePool2DInfo(\n     inShape: [number, number, number, number],\n     filterSize: [number, number]|number, strides: number|[number, number],\n     dilations: number|[number, number], pad: 'same'|'valid'|number,\n     roundingMode?: 'floor'|'round'|'ceil',\n     dataFormat: 'channelsFirst'|'channelsLast' = 'channelsLast')\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "BruceDai", "commentT": "2020-11-19T20:50:38Z", "comment_text": "\n \t\tmight be related issue <denchmark-link:https://github.com/tensorflow/tfjs/issues/1055>here</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "BruceDai", "commentT": "2020-11-19T22:00:42Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/BruceDai>@BruceDai</denchmark-link>\n , thank you for the bug report! Do you want to contribute a fix PR?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "BruceDai", "commentT": "2020-11-20T00:14:42Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/lina128>@lina128</denchmark-link>\n  OK, I'll submit a PR for it.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "BruceDai", "commentT": "2020-11-20T15:26:33Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/lina128>@lina128</denchmark-link>\n  Please take a look this PR <denchmark-link:https://github.com/tensorflow/tfjs/pull/4282>#4282</denchmark-link>\n , thanks.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "BruceDai", "commentT": "2020-11-26T07:17:40Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4271>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4271>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "ec6c319c969bf9e1316bc12a400a7c134ece075e", "commit_author": "BruceDai", "commitT": "2020-11-25 23:17:37-08:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\avg_pool.ts", "file_new_name": "tfjs-core\\src\\ops\\avg_pool.ts", "file_complexity": {"file_NLOC": "60", "file_CCN": "11", "file_NToken": "568"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "49,50", "deleted_lines": "49,50,51"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\avg_pool_3d.ts", "file_new_name": "tfjs-core\\src\\ops\\avg_pool_3d.ts", "file_complexity": {"file_NLOC": "75", "file_CCN": "11", "file_NToken": "660"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "60,61", "deleted_lines": "60,61,62"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\avg_pool_3d_grad.ts", "file_new_name": "tfjs-core\\src\\ops\\avg_pool_3d_grad.ts", "file_complexity": {"file_NLOC": "67", "file_CCN": "9", "file_NToken": "659"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "56,57", "deleted_lines": "56,57,58,59"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\conv1d.ts", "file_new_name": "tfjs-core\\src\\ops\\conv1d.ts", "file_complexity": {"file_NLOC": "61", "file_CCN": "11", "file_NToken": "672"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "50,51", "deleted_lines": "50,51,52"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\conv2d.ts", "file_new_name": "tfjs-core\\src\\ops\\conv2d.ts", "file_complexity": {"file_NLOC": "69", "file_CCN": "12", "file_NToken": "698"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "57,58", "deleted_lines": "57,58,59"}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\conv2d_backprop_filter.ts", "file_new_name": "tfjs-core\\src\\ops\\conv2d_backprop_filter.ts", "file_complexity": {"file_NLOC": "67", "file_CCN": "14", "file_NToken": "695"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "45,46", "deleted_lines": "45,46,47,48"}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\conv2d_backprop_input.ts", "file_new_name": "tfjs-core\\src\\ops\\conv2d_backprop_input.ts", "file_complexity": {"file_NLOC": "78", "file_CCN": "16", "file_NToken": "809"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "49,50", "deleted_lines": "49,50,51"}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\conv2d_test.ts", "file_new_name": "tfjs-core\\src\\ops\\conv2d_test.ts", "file_complexity": {"file_NLOC": "546", "file_CCN": "52", "file_NToken": "6385"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "37", "method_endline": "699", "method_complexity": {"method_NLOC": "35", "method_CCN": "1", "method_NToken": "346", "method_nesting_level": "0"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\conv2d_transpose.ts", "file_new_name": "tfjs-core\\src\\ops\\conv2d_transpose.ts", "file_complexity": {"file_NLOC": "16", "file_CCN": "1", "file_NToken": "166"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "39,40", "deleted_lines": "39,40,41"}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "tfjs-core\\src\\ops\\conv_util.ts", "file_new_name": "tfjs-core\\src\\ops\\conv_util.ts", "file_complexity": {"file_NLOC": "456", "file_CCN": "63", "file_NToken": "3459"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "356,358", "deleted_lines": "358,360,361,362", "method_info": {"method_name": "computeOutputShape2D", "method_params": "number,number,number,number", "method_startline": "347", "method_endline": "362", "method_complexity": {"method_NLOC": "14", "method_CCN": "2", "method_NToken": "123", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "375,377,379", "deleted_lines": "364,365,367,368,369,370", "method_info": {"method_name": "computeOutputShape4D", "method_params": "number,number,number,number,number,number,number", "method_startline": "364", "method_endline": "383", "method_complexity": {"method_NLOC": "18", "method_CCN": "2", "method_NToken": "169", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "470,473", "deleted_lines": null, "method_info": {"method_name": "getPadAndOutInfo", "method_params": "ExplicitPadding,number,number,number,number,number,number", "method_startline": "427", "method_endline": "479", "method_complexity": {"method_NLOC": "52", "method_CCN": "14", "method_NToken": "568", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": null, "deleted_lines": "578,579,581", "method_info": {"method_name": "conditionalRound", "method_params": "number", "method_startline": "578", "method_endline": "595", "method_complexity": {"method_NLOC": "16", "method_CCN": "5", "method_NToken": "80", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "554,556", "deleted_lines": null, "method_info": {"method_name": "round", "method_params": "number", "method_startline": "554", "method_endline": "570", "method_complexity": {"method_NLOC": "15", "method_CCN": "5", "method_NToken": "85", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": null, "deleted_lines": "362,363", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "362", "method_endline": "363", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "5", "method_nesting_level": "0"}}}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\conv_util_test.ts", "file_new_name": "tfjs-core\\src\\ops\\conv_util_test.ts", "file_complexity": {"file_NLOC": "898", "file_CCN": "73", "file_NToken": "9459"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "762,763,764,765,766", "deleted_lines": "762,763,764,765,766", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "762", "method_endline": "767", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "48", "method_nesting_level": "0"}}}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\depthwise_conv2d.ts", "file_new_name": "tfjs-core\\src\\ops\\depthwise_conv2d.ts", "file_complexity": {"file_NLOC": "71", "file_CCN": "11", "file_NToken": "695"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "70,71", "deleted_lines": "70,71,72"}}}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\fused\\conv2d.ts", "file_new_name": "tfjs-core\\src\\ops\\fused\\conv2d.ts", "file_complexity": {"file_NLOC": "167", "file_CCN": "24", "file_NToken": "1363"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "85,86", "deleted_lines": "85,86,87"}}}, "file_13": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\fused\\depthwise_conv2d.ts", "file_new_name": "tfjs-core\\src\\ops\\fused\\depthwise_conv2d.ts", "file_complexity": {"file_NLOC": "168", "file_CCN": "22", "file_NToken": "1343"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "82,83", "deleted_lines": "82,83,84"}}}, "file_14": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\max_pool.ts", "file_new_name": "tfjs-core\\src\\ops\\max_pool.ts", "file_complexity": {"file_NLOC": "61", "file_CCN": "11", "file_NToken": "560"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "53,54", "deleted_lines": "53,54,55"}}}, "file_15": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\max_pool_3d.ts", "file_new_name": "tfjs-core\\src\\ops\\max_pool_3d.ts", "file_complexity": {"file_NLOC": "74", "file_CCN": "11", "file_NToken": "655"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "59,60", "deleted_lines": "59,60,61"}}}, "file_16": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\max_pool_3d_grad.ts", "file_new_name": "tfjs-core\\src\\ops\\max_pool_3d_grad.ts", "file_complexity": {"file_NLOC": "77", "file_CCN": "10", "file_NToken": "775"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "57,58", "deleted_lines": "57,58,59,60"}}}, "file_17": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\ops\\max_pool_grad.ts", "file_new_name": "tfjs-core\\src\\ops\\max_pool_grad.ts", "file_complexity": {"file_NLOC": "49", "file_CCN": "7", "file_NToken": "496"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "46,47", "deleted_lines": "46,47,48,49"}}}, "file_18": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\pool_test.ts", "file_new_name": "tfjs-core\\src\\ops\\pool_test.ts", "file_complexity": {"file_NLOC": "268", "file_CCN": "29", "file_NToken": "3164"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "22", "method_endline": "262", "method_complexity": {"method_NLOC": "19", "method_CCN": "1", "method_NToken": "165", "method_nesting_level": "0"}}}}}, "file_19": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-node\\src\\run_tests.ts", "file_new_name": "tfjs-node\\src\\run_tests.ts", "file_complexity": {"file_NLOC": "77", "file_CCN": "5", "file_NToken": "382"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "84,85,86,87,88", "deleted_lines": "84"}}}}}}