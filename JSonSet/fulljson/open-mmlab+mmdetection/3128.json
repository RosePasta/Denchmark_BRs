{"BR": {"BR_id": "3128", "BR_author": "sandylaker", "BRopenT": "2020-06-25T20:44:11Z", "BRcloseT": "2020-08-14T03:26:47Z", "BR_text": {"BRsummary": "VOCDataset object has no attribute dataset", "BRdescription": "\n Thanks for your error report and we appreciate it a lot.\n Checklist\n \n I have searched related issues but cannot get the expected help.\n The bug has not been fixed in the latest version.\n \n Describe the bug\n I tried to train my model on Pascal VOC 2012 dataset, and set the config for data as follows:\n batch_size = 8\n \n data = dict(\n     samples_per_gpu=batch_size,\n     workers_per_gpu=4,\n     train=dict(\n         type=dataset_type,\n         ann_file=data_root + 'VOC2012/ImageSets/Main/train.txt',\n         img_prefix=data_root + 'VOC2012/',\n         pipeline=train_pipeline,),\n     val=dict(\n         type=dataset_type,\n         ann_file=data_root + 'VOC2012/ImageSets/Main/val.txt',\n         img_prefix=data_root + 'VOC2012/',\n         pipeline=test_pipeline,),\n )\n \n evaluation=dict(interval=1, metric='mAP')\n But during evaluation, it raised following error:\n File \"train.py\", line 166, in <module>\n     main()\n   File \"train.py\", line 162, in main\n     meta=meta)\n   File \"/home/lfc199471/mmdetection/mmdet/apis/train.py\", line 128, in train_detector\n     runner.run(data_loaders, cfg.workflow, cfg.total_epochs)\n   File \"/home/lfc199471/anaconda3/lib/python3.7/site-packages/mmcv/runner/epoch_based_runner.py\", line 122, in run\n     epoch_runner(data_loaders[i], **kwargs)\n   File \"/home/lfc199471/anaconda3/lib/python3.7/site-packages/mmcv/runner/epoch_based_runner.py\", line 46, in train\n     self.call_hook('after_train_epoch')\n   File \"/home/lfc199471/anaconda3/lib/python3.7/site-packages/mmcv/runner/base_runner.py\", line 282, in call_hook\n     getattr(hook, fn_name)(self)\n   File \"/home/lfc199471/mmdetection/mmdet/core/evaluation/eval_hooks.py\", line 28, in after_train_epoch\n     self.evaluate(runner, results)\n   File \"/home/lfc199471/mmdetection/mmdet/core/evaluation/eval_hooks.py\", line 32, in evaluate\n     results, logger=runner.logger, **self.eval_kwargs)\n   File \"/home/lfc199471/mmdetection/mmdet/datasets/voc.py\", line 43, in evaluate\n     ds_name = self.dataset.CLASSES\n AttributeError: 'VOCDataset' object has no attribute 'dataset'\n I checked the voc.py in mmdet and found that in line 43, it was\n ds_name = self.dataset.CLASSES\n but VOCDataset and its superclasses XMLDataset and CustomDataset don't have this attribute.  Is it a bug or did I make some mistakes in the config?\n Reproduction\n \n What command or script did you run?\n \n <denchmark-code>python tools/train.py --gpus 1 configs/<my_config_file>\n </denchmark-code>\n \n \n \n Did you make any modifications on the code or config? Did you understand what you have modified?\n Yes, please see above.\n \n \n What dataset did you use?\n Pascal VOC 2012 detection\n Environment\n \n \n Please run python mmdet/utils/collect_env.py to collect necessary environment infomation and paste it here.\n \n \n sys.platform: linux\n Python: 3.7.6 (default, Jan  8 2020, 19:59:22) [GCC 7.3.0]\n CUDA available: True\n CUDA_HOME: /usr/local/cuda\n NVCC: Cuda compilation tools, release 10.2, V10.2.89\n GPU 0: Tesla P100-PCIE-16GB\n GCC: gcc (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0\n PyTorch: 1.5.1\n PyTorch compiling details: PyTorch built with:\n   - GCC 7.3\n   - C++ Version: 201402\n   - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191122 for Intel(R) 64 architecture applications\n   - Intel(R) MKL-DNN v0.21.1 (Git Hash 7d2fd500bc78936d1d648ca713b901012f470dbc)\n   - OpenMP 201511 (a.k.a. OpenMP 4.5)\n   - NNPACK is enabled\n   - CPU capability usage: AVX2\n   - CUDA Runtime 10.2\n   - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37\n   - CuDNN 7.6.5\n   - Magma 2.5.2\n   - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS= -Wno-deprecated -fvisibility-inlines-hidden -fopenmp -DNDEBUG -DUSE_FBGEMM -DUSE_QNNPACK -DUSE_PYTORCH_QNNPACK -DUSE_XNNPACK -DUSE_INTERNAL_THREADPOOL_IMPL -O2 -fPIC -Wno-narrowing -Wall -Wextra -Werror=return-type -Wno-missing-field-initializers -Wno-type-limits -Wno-array-bounds -Wno-unknown-pragmas -Wno-sign-compare -Wno-unused-parameter -Wno-unused-variable -Wno-unused-function -Wno-unused-result -Wno-strict-overflow -Wno-strict-aliasing -Wno-error=deprecated-declarations -Wno-stringop-overflow -Wno-error=pedantic -Wno-error=redundant-decls -Wno-error=old-style-cast -fdiagnostics-color=always -faligned-new -Wno-unused-but-set-variable -Wno-maybe-uninitialized -fno-math-errno -fno-trapping-math -Werror=format -Wno-stringop-overflow, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=ON, USE_NNPACK=ON, USE_OPENMP=ON, USE_STATIC_DISPATCH=OFF, \n \n TorchVision: 0.6.0a0+35d732a\n OpenCV: 4.2.0\n MMCV: 0.6.1\n MMDetection: 2.1.0+b44e78b\n MMDetection Compiler: GCC 7.5\n MMDetection CUDA Compiler: 10.2\n \n You may add addition that may be helpful for locating the problem, such as\n \n How you installed PyTorch [e.g., pip, conda, source] : conda\n \n \n \n If you need any log file or some source code from me, just let me know.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "sandylaker", "commentT": "2020-06-28T04:56:02Z", "comment_text": "\n \t\tyou can modify ds_name = self.CLASSES   in voc.py  then it is run  well\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "sandylaker", "commentT": "2020-06-28T07:05:01Z", "comment_text": "\n \t\tThis is a bug. You can modify self.dataset.CLASSES to self.CLASSES. It will be appreciated if you are would like to create a PR to fix it.\n \t\t"}}}, "commit": {"commit_id": "04c44d0134c378ec1132beb7e548523d775344f4", "commit_author": "Jerry Jiarui XU", "commitT": "2020-08-14 11:26:46+08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "mmdet\\datasets\\voc.py", "file_new_name": "mmdet\\datasets\\voc.py", "file_complexity": {"file_NLOC": "81", "file_CCN": "4", "file_NToken": "408"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "65", "deleted_lines": "65"}}}}}}