{"BR": {"BR_id": "4857", "BR_author": "YannDubs", "BRopenT": "2020-11-25T16:44:23Z", "BRcloseT": "2020-12-06T13:01:44Z", "BR_text": {"BRsummary": "Logging not working in `on_train_batch_end` of a callback.", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n logging in on_train_batch_end of a callback doesn't work but for on_train_validation_batch_end it does.\n I.e. below only eval will be logged not train\n class TestCallback(Callback):\n   \n     def on_train_batch_end(self, trainer, pl_module, outputs, batch, batch_idx, dataloader_idx):\n         pl_module.log(\"train\", 0)\n \n     def on_validation_batch_end(self, trainer, pl_module, outputs, batch, batch_idx, dataloader_idx):\n         pl_module.log(\"eval\", 0)\n reproduce:  <denchmark-link:https://colab.research.google.com/drive/1Utnf7uqQTPid68_baS9yMdApZaoMP6Lq?usp=sharing>https://colab.research.google.com/drive/1Utnf7uqQTPid68_baS9yMdApZaoMP6Lq?usp=sharing</denchmark-link>\n \n context: I found that error because logging of training in pl_bolts.callbacks.ssl_online.SSLOnlineEvaluator does not work.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "YannDubs", "commentT": "2020-11-25T16:45:05Z", "comment_text": "\n \t\tHi! thanks for your contribution!, great first issue!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "YannDubs", "commentT": "2020-11-25T18:25:17Z", "comment_text": "\n \t\tcan you try with master??\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "YannDubs", "commentT": "2020-11-25T19:45:56Z", "comment_text": "\n \t\tworks! thanks\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "YannDubs", "commentT": "2020-12-03T00:44:22Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/rohitgr7>@rohitgr7</denchmark-link>\n  now it doesn't work even on master (see  <denchmark-link:https://colab.research.google.com/drive/1Utnf7uqQTPid68_baS9yMdApZaoMP6Lq?usp=sharing>https://colab.research.google.com/drive/1Utnf7uqQTPid68_baS9yMdApZaoMP6Lq?usp=sharing</denchmark-link>\n  )\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "YannDubs", "commentT": "2020-12-03T14:54:16Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/tchaton>@tchaton</denchmark-link>\n , mind check this?\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "YannDubs", "commentT": "2020-12-04T08:30:07Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/YannDubs>@YannDubs</denchmark-link>\n ,\n Yes, I deactivated to optimize logging.\n <denchmark-code>******************************\n Logging from a LightningModule\n ******************************\n \n Lightning offers automatic log functionalities for logging scalars, or manual logging for anything else.\n \n Automatic logging\n =================\n Use the :func:`~~pytorch_lightning.core.lightning.LightningModule.log` method to log from :ref:`lightning_module` and :ref:`callbacks`\n Currently, it is supported in the following functions:\n     - training_step\n     - evaluation_step\n     - test_step\n     - training_epoch_end\n     - validation_epoch_end\n     - test_epoch_end\n     - on_train_epoch_end\n     - on_validation_epoch_end\n     - on_validation_end\n     - on_test_epoch_end\n     - on_test_end\n     - on_epoch_end\n </denchmark-code>\n \n However, I have an idea for an Hybrid version which might work out.\n I will update you when finished.\n \t\t"}}}, "commit": {"commit_id": "2e838e6dd8803f40da3a1d4111669bd69ae7dd0f", "commit_author": "chaton", "commitT": "2020-12-06 13:01:43+00:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "0.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\source\\logging.rst", "file_new_name": "docs\\source\\logging.rst", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "9,60,62,63,64,100,101,102,152,153,246", "deleted_lines": "9,60,62,147,148,241"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pytorch_lightning\\trainer\\connectors\\logger_connector\\epoch_result_store.py", "file_new_name": "pytorch_lightning\\trainer\\connectors\\logger_connector\\epoch_result_store.py", "file_complexity": {"file_NLOC": "348", "file_CCN": "87", "file_NToken": "2301"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "360,361,362,368,399,400", "deleted_lines": "358,367,369", "method_info": {"method_name": "update_logger_connector", "method_params": "self", "method_startline": "348", "method_endline": "400", "method_complexity": {"method_NLOC": "37", "method_CCN": "4", "method_NToken": "198", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "342,343,344", "deleted_lines": "342", "method_info": {"method_name": "cache_result", "method_params": "self", "method_startline": "307", "method_endline": "346", "method_complexity": {"method_NLOC": "25", "method_CCN": "6", "method_NToken": "172", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\connectors\\logger_connector\\logger_connector.py", "file_new_name": "pytorch_lightning\\trainer\\connectors\\logger_connector\\logger_connector.py", "file_complexity": {"file_NLOC": "367", "file_CCN": "107", "file_NToken": "2732"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "590,595,596,597,598,599", "deleted_lines": "593,595,596,597", "method_info": {"method_name": "log_train_step_metrics", "method_params": "self,batch_output", "method_startline": "589", "method_endline": "599", "method_complexity": {"method_NLOC": "9", "method_CCN": "6", "method_NToken": "78", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "pytorch_lightning\\trainer\\evaluation_loop.py", "file_new_name": "pytorch_lightning\\trainer\\evaluation_loop.py", "file_complexity": {"file_NLOC": "244", "file_CCN": "86", "file_NToken": "1875"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "349,350", "deleted_lines": "349,350,351,352", "method_info": {"method_name": "__log_result_step_metrics", "method_params": "self,step_log_metrics,step_pbar_metrics,batch_idx", "method_startline": "348", "method_endline": "364", "method_complexity": {"method_NLOC": "12", "method_CCN": "4", "method_NToken": "106", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "109,111", "deleted_lines": "109,111", "method_info": {"method_name": "on_evaluation_end", "method_params": "self,args,kwargs", "method_startline": "107", "method_endline": "111", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "46", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "332,334", "deleted_lines": "332,334", "method_info": {"method_name": "on_evaluation_epoch_end", "method_params": "self,args,kwargs", "method_startline": "329", "method_endline": "334", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "46", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "pytorch_lightning\\trainer\\trainer.py", "file_new_name": "pytorch_lightning\\trainer\\trainer.py", "file_complexity": {"file_NLOC": "658", "file_CCN": "75", "file_NToken": "3140"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "858,859", "deleted_lines": null, "method_info": {"method_name": "_reset_result_and_set_hook_fx_name", "method_params": "self,hook_name", "method_startline": "857", "method_endline": "865", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "41", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "873,875,898", "deleted_lines": "871,873,874,897", "method_info": {"method_name": "call_hook", "method_params": "self,hook_name,args,capture,kwargs", "method_startline": "871", "method_endline": "899", "method_complexity": {"method_NLOC": "18", "method_CCN": "6", "method_NToken": "136", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "873,875,898", "deleted_lines": "873,874,897", "method_info": {"method_name": "call_hook", "method_params": "self,hook_name,args,kwargs", "method_startline": "873", "method_endline": "900", "method_complexity": {"method_NLOC": "17", "method_CCN": "5", "method_NToken": "132", "method_nesting_level": "1"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\training_loop.py", "file_new_name": "pytorch_lightning\\trainer\\training_loop.py", "file_complexity": {"file_NLOC": "553", "file_CCN": "167", "file_NToken": "4175"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "828,829", "deleted_lines": "828,829", "method_info": {"method_name": "run_on_epoch_end_hook", "method_params": "self,epoch_output", "method_startline": "824", "method_endline": "829", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "34", "method_nesting_level": "1"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tests\\test_deprecated.py", "file_new_name": "tests\\test_deprecated.py", "file_complexity": {"file_NLOC": "88", "file_CCN": "18", "file_NToken": "728"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1,2,3,4,5,6,7,8,9,10,11,12,13", "deleted_lines": null}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tests\\trainer\\logging_tests\\test_eval_loop_logging_1_0.py", "file_new_name": "tests\\trainer\\logging_tests\\test_eval_loop_logging_1_0.py", "file_complexity": {"file_NLOC": "643", "file_CCN": "100", "file_NToken": "4862"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "673,674", "deleted_lines": "678,679,680", "method_info": {"method_name": "test_log_works_in_test_callback.on_test_batch_end", "method_params": "self,trainer,pl_module,outputs,batch,batch_idx,dataloader_idx", "method_startline": "673", "method_endline": "680", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "50", "method_nesting_level": "2"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "673,674,722,726", "deleted_lines": "665,678,679,680,681,682,693,731,735,736,737", "method_info": {"method_name": "test_log_works_in_test_callback", "method_params": "tmpdir", "method_startline": "602", "method_endline": "782", "method_complexity": {"method_NLOC": "104", "method_CCN": "18", "method_NToken": "675", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "487,495,543,547", "deleted_lines": "475,476,513,514,544,546,550,553", "method_info": {"method_name": "test_log_works_in_val_callback", "method_params": "tmpdir", "method_startline": "427", "method_endline": "598", "method_complexity": {"method_NLOC": "100", "method_CCN": "16", "method_NToken": "591", "method_nesting_level": "0"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\trainer\\logging_tests\\test_train_loop_logging_1_0.py", "file_new_name": "tests\\trainer\\logging_tests\\test_train_loop_logging_1_0.py", "file_complexity": {"file_NLOC": "549", "file_CCN": "77", "file_NToken": "4246"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "561", "deleted_lines": "561,574,575,576,577,578,579,580,581,582,595,632,636,637,641,642", "method_info": {"method_name": "test_log_works_in_train_callback", "method_params": "tmpdir", "method_startline": "504", "method_endline": "674", "method_complexity": {"method_NLOC": "94", "method_CCN": "17", "method_NToken": "632", "method_nesting_level": "0"}}}}}}}}