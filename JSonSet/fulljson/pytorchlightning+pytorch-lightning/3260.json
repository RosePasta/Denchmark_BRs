{"BR": {"BR_id": "3260", "BR_author": "maxjeblick", "BRopenT": "2020-08-29T22:09:45Z", "BRcloseT": "2020-10-06T17:54:49Z", "BR_text": {"BRsummary": "auto_scale_batch_size won't reset current_epoch", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n When auto_scale_batch_size is enabled, the model is initially trained with varying batch sizes. When training begins, trainer.current_epoch equals 1 instead of 0.\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n Either observe the progress bar or use a simple callback to track the epoch number, once with  auto_scale_batch_size  enabled and once with  auto_scale_batch_size disabled.\n <denchmark-code>from pytorch_lightning import Callback\n \n class PrintCallback(Callback):\n     \n     def __init__(self):\n         self.observed_epochs = []\n         \n     def on_train_epoch_start(self, trainer, pl_module):\n         print(f'Current Epoch: {trainer.current_epoch}')\n         self.observed_epochs.append(trainer.current_epoch)\n \n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "maxjeblick", "commentT": "2020-08-30T12:50:23Z", "comment_text": "\n \t\tsince it calls it with various batch_sizes did you find where it sets current_epoch to 0 before checking it on next batch_size?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "maxjeblick", "commentT": "2020-08-31T11:43:44Z", "comment_text": "\n \t\tThe problem is during <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pytorch_lightning/trainer/training_io.py#L335>model checkpointing</denchmark-link>\n . The checkpoint sets  . That checkpoint will be loaded after having completed the batch size finder. During batch size scaling, the epoch won't be increased.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "maxjeblick", "commentT": "2020-09-02T18:48:34Z", "comment_text": "\n \t\tCurrently blocked until trainer.tune is added.\n \t\t"}}}, "commit": {"commit_id": "39b3704285e40a29a5862c4d8145b68d3b35d45e", "commit_author": "maxjeblick", "commitT": "2020-10-06 19:54:48+02:00", "commit_complexity": {"commit_NLOC": "0.75", "commit_CCN": "1.0", "commit_Nprams": "0.75"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "107,108", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "pytorch_lightning\\tuner\\batch_size_scaling.py", "file_new_name": "pytorch_lightning\\tuner\\batch_size_scaling.py", "file_complexity": {"file_NLOC": "213", "file_CCN": "21", "file_NToken": "1054"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "156", "deleted_lines": null, "method_info": {"method_name": "__scale_batch_restore_params", "method_params": "trainer", "method_startline": "154", "method_endline": "166", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "119", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "142", "deleted_lines": null, "method_info": {"method_name": "__scale_batch_reset_params", "method_params": "trainer,model,steps_per_trial", "method_startline": "139", "method_endline": "151", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "82", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "126", "deleted_lines": null, "method_info": {"method_name": "__scale_batch_dump_params", "method_params": "trainer", "method_startline": "122", "method_endline": "136", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "77", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\trainer\\test_trainer_tricks.py", "file_new_name": "tests\\trainer\\test_trainer_tricks.py", "file_complexity": {"file_NLOC": "211", "file_CCN": "19", "file_NToken": "1671"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "185,186", "deleted_lines": "185", "method_info": {"method_name": "test_trainer_reset_correctly", "method_params": "tmpdir", "method_startline": "167", "method_endline": "200", "method_complexity": {"method_NLOC": "25", "method_CCN": "4", "method_NToken": "119", "method_nesting_level": "0"}}}}}}}}