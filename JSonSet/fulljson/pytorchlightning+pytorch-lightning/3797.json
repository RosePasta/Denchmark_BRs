{"BR": {"BR_id": "3797", "BR_author": "carmocca", "BRopenT": "2020-10-02T15:05:18Z", "BRcloseT": "2020-10-02T17:51:03Z", "BR_text": {"BRsummary": "Broken ddp_cpu backend", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n Broken on current master.\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n def test(tmpdir):\n     import pytorch_lightning as pl\n     trainer = pl.Trainer(\n         default_root_dir=tmpdir,\n         max_epochs=3,\n         limit_train_batches=10,\n         limit_val_batches=10,\n         distributed_backend=\"ddp_cpu\",\n     )\n     model = DummyModule() # Linear layer on MNIST\n     trainer.fit(model)\n Error:\n <denchmark-code>E       -- Process 0 terminated with the following error:\n E       Traceback (most recent call last):\n E         File \"/home/carmocca/projects/PyLaia/venv/lib/python3.8/site-packages/torch/multiprocessing/spawn.py\", line 20, in _wrap\n E           fn(i, *args)\n E         File \"/home/carmocca/projects/PyLaia/venv/src/pytorch-lightning/pytorch_lightning/accelerators/ddp_cpu_spawn_backend.py\", line 137, in ddp_train\n E           results = self.train_or_test()\n E         File \"/home/carmocca/projects/PyLaia/venv/src/pytorch-lightning/pytorch_lightning/accelerators/base_backend.py\", line 43, in train_or_test\n E           results = self.trainer.train()\n E         File \"/home/carmocca/projects/PyLaia/venv/src/pytorch-lightning/pytorch_lightning/trainer/trainer.py\", line 464, in train\n E           self.run_sanity_check(self.get_model())\n E         File \"/home/carmocca/projects/PyLaia/venv/src/pytorch-lightning/pytorch_lightning/trainer/trainer.py\", line 649, in run_sanity_check\n E           _, eval_results = self.run_evaluation(test_mode=False, max_batches=self.num_sanity_val_batches)\n E         File \"/home/carmocca/projects/PyLaia/venv/src/pytorch-lightning/pytorch_lightning/trainer/trainer.py\", line 571, in run_evaluation\n E           output = self.evaluation_loop.evaluation_step(test_mode, batch, batch_idx, dataloader_idx)\n E         File \"/home/carmocca/projects/PyLaia/venv/src/pytorch-lightning/pytorch_lightning/trainer/evaluation_loop.py\", line 149, in evaluation_step\n E           output = self.trainer.accelerator_backend.validation_step(args)\n E         File \"/home/carmocca/projects/PyLaia/venv/src/pytorch-lightning/pytorch_lightning/accelerators/ddp_cpu_spawn_backend.py\", line 157, in validation_step\n E           output = self.training_step(args)\n E         File \"/home/carmocca/projects/PyLaia/venv/src/pytorch-lightning/pytorch_lightning/accelerators/ddp_cpu_spawn_backend.py\", line 153, in training_step\n E           output = self.trainer.model(*args)\n E         File \"/home/carmocca/projects/PyLaia/venv/lib/python3.8/site-packages/torch/nn/modules/module.py\", line 722, in _call_impl\n E           result = self.forward(*input, **kwargs)\n E         File \"/home/carmocca/projects/PyLaia/venv/src/pytorch-lightning/pytorch_lightning/overrides/data_parallel.py\", line 209, in forward\n E           warn_missing_output(fx_called)\n E         File \"/home/carmocca/projects/PyLaia/venv/src/pytorch-lightning/pytorch_lightning/overrides/data_parallel.py\", line 228, in warn_missing_output\n E           warning_cache.warn(m)\n E       UnboundLocalError: local variable 'm' referenced before assignment\n </denchmark-code>\n \n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n Does not fail\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "carmocca", "commentT": "2020-10-02T17:22:57Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/williamFalcon>@williamFalcon</denchmark-link>\n  could it be linked to you refactoring?\n seems to be similar to <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/issues/3798>#3798</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "carmocca", "commentT": "2020-10-02T17:46:55Z", "comment_text": "\n \t\tjust a typo... easy fix\n \t\t"}}}, "commit": {"commit_id": "22efce8f400ab452ad1369e6ec9e8e733cc9a93d", "commit_author": "Jirka Borovec", "commitT": "2020-10-02 13:51:02-04:00", "commit_complexity": {"commit_NLOC": "0.1111111111111111", "commit_CCN": "0.1111111111111111", "commit_Nprams": "0.1111111111111111"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pytorch_lightning\\overrides\\data_parallel.py", "file_new_name": "pytorch_lightning\\overrides\\data_parallel.py", "file_complexity": {"file_NLOC": "235", "file_CCN": "76", "file_NToken": "1697"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "215,216,218", "deleted_lines": "217,218", "method_info": {"method_name": "warn_missing_output", "method_params": "fx_called", "method_startline": "213", "method_endline": "218", "method_complexity": {"method_NLOC": "6", "method_CCN": "3", "method_NToken": "33", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "209", "deleted_lines": "209,210", "method_info": {"method_name": "forward", "method_params": "self,inputs,kwargs", "method_startline": "162", "method_endline": "210", "method_complexity": {"method_NLOC": "33", "method_CCN": "10", "method_NToken": "281", "method_nesting_level": "1"}}}}}}}}