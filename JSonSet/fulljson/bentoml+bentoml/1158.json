{"BR": {"BR_id": "1158", "BR_author": "yubozhao", "BRopenT": "2020-10-04T21:11:00Z", "BRcloseT": "2020-10-15T02:42:54Z", "BR_text": {"BRsummary": "Failed to set suitable adapter on DefaultOutput, when returning InferenceResult as result", "BRdescription": "\n Describe the bug\n DefaultOutput.actual_adapter is not set when user return InferenceResult and result in AttributeError.\n To Reproduce\n \n create BentoService with an api function that returns bentoml.types.InferenceResult.\n $ bentoml serve BentoService\n make request on the swagger UI\n \n \n <denchmark-code>[2020-10-04 20:28:53,853] ERROR - Exception on /predict [POST]\n Traceback (most recent call last):\n   File \"/opt/conda/lib/python3.7/site-packages/bentoml/server/api_server.py\", line 288, in api_func\n     response = api.handle_request(request)\n   File \"/opt/conda/lib/python3.7/site-packages/bentoml/service/inference_api.py\", line 283, in handle_request\n     response = self.output_adapter.to_http_response(result)\n   File \"/opt/conda/lib/python3.7/site-packages/bentoml/adapters/default_output.py\", line 82, in to_http_response\n     return self.actual_adapter.to_http_response(result)\n AttributeError: 'NoneType' object has no attribute 'to_http_response'\n </denchmark-code>\n \n Expected behavior\n Screenshots/Logs\n Environment:\n \n OS: [e.g. MacOS 10.14.3]\n Python Version [e.g. Python 3.7.1]\n BentoML Version [e.g. BentoML-0.8.6]\n \n Additional context\n \t"}, "comments": {}}, "commit": {"commit_id": "936bc3d4a39f748f66f820fa428e0ba7528b6a77", "commit_author": "bojiang", "commitT": "2020-10-15 10:42:53+08:00", "commit_complexity": {"commit_NLOC": "0.42857142857142855", "commit_CCN": "0.8979591836734694", "commit_Nprams": "0.7346938775510204"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "bentoml\\adapters\\default_output.py", "file_new_name": "bentoml\\adapters\\default_output.py", "file_complexity": {"file_NLOC": "63", "file_CCN": "13", "file_NToken": "312"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "95,96,97", "deleted_lines": null, "method_info": {"method_name": "to_aws_lambda_event", "method_params": "self,result", "method_startline": "94", "method_endline": "97", "method_complexity": {"method_NLOC": "4", "method_CCN": "2", "method_NToken": "32", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "90,91,92", "deleted_lines": null, "method_info": {"method_name": "to_cli", "method_params": "self,results", "method_startline": "89", "method_endline": "92", "method_complexity": {"method_NLOC": "4", "method_CCN": "2", "method_NToken": "32", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "85,86,87", "deleted_lines": "85", "method_info": {"method_name": "to_http_response", "method_params": "self,result", "method_startline": "84", "method_endline": "87", "method_complexity": {"method_NLOC": "4", "method_CCN": "2", "method_NToken": "32", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "68,69,70", "deleted_lines": null, "method_info": {"method_name": "__init__", "method_params": "self,kwargs", "method_startline": "65", "method_endline": "70", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "37", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "bentoml\\service\\inference_api.py", "file_new_name": "bentoml\\service\\inference_api.py", "file_complexity": {"file_NLOC": "229", "file_CCN": "50", "file_NToken": "1245"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "227,228,229,230,231,232,233,234,235,236,245,259", "deleted_lines": "227,228,229,230,231,232,233", "method_info": {"method_name": "infer", "method_params": "self", "method_startline": "218", "method_endline": "281", "method_complexity": {"method_NLOC": "55", "method_CCN": "19", "method_NToken": "348", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "153", "deleted_lines": "153", "method_info": {"method_name": "user_func", "method_params": "self", "method_startline": "141", "method_endline": "192", "method_complexity": {"method_NLOC": "14", "method_CCN": "3", "method_NToken": "62", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\integration\\api_server\\example_service.py", "file_new_name": "tests\\integration\\api_server\\example_service.py", "file_complexity": {"file_NLOC": "133", "file_CCN": "31", "file_NToken": "1120"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "69,70,71,72,73,74,75,76", "deleted_lines": null, "method_info": {"method_name": "predict_strict_json", "method_params": "self,input_datas,None", "method_startline": "69", "method_endline": "76", "method_complexity": {"method_NLOC": "8", "method_CCN": "3", "method_NToken": "72", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "118,119,120,121,122", "deleted_lines": null, "method_info": {"method_name": "predict_strict_json", "method_params": "self,input_data,InferenceTask", "method_startline": "118", "method_endline": "122", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "66", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\integration\\api_server\\test_adapter.py", "file_new_name": "tests\\integration\\api_server\\test_adapter.py", "file_complexity": {"file_NLOC": "106", "file_CCN": "11", "file_NToken": "632"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132", "deleted_lines": null, "method_info": {"method_name": "test_api_server_strict_json", "method_params": "host", "method_startline": "110", "method_endline": "132", "method_complexity": {"method_NLOC": "23", "method_CCN": "4", "method_NToken": "122", "method_nesting_level": "0"}}}}}}}}