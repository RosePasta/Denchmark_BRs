{"BR": {"BR_id": "643", "BR_author": "fernandocamargoti", "BRopenT": "2020-05-08T18:34:27Z", "BRcloseT": "2020-05-14T07:01:07Z", "BR_text": {"BRsummary": "YataiService's Docker doesn't include psycog", "BRdescription": "\n Describe the bug\n According to the docs, I could use YaitaiService's Docker with another database as follows:\n <denchmark-code>docker run -p 3000:3000 -p 50051:50051 \\\n     -e AWS_SECRET_ACCESS_KEY=... -e AWS_ACCESS_KEY_ID=...  \\\n     bentoml/yatai-service:0.7.2 \\\n     --db-url postgresql://scott:tiger@localhost:5432/bentomldb \\\n     --repo-base-url s3://my-bentoml-repo/\n </denchmark-code>\n \n But we get a \"ModuleNotFoundError: No module named 'psycopg2'\" if we try it.\n To Reproduce\n The following docker-compose.yml is the easiest way to reproduce:\n <denchmark-code>version: '3'\n \n services:\n   yatai-service:\n     build: yatai-service\n     restart: unless-stopped\n     command: \"--db-url=postgres://postgres@yatai-db:5432/bentomldb --repo-base-url=/bentoml/repository\"\n     volumes:\n       - ./data/yatai/repository:/bentoml/repository\n     depends_on:\n       - yatai-db\n     networks:\n       - yatai\n   yatai-db:\n     image: library/postgres:latest\n     environment:\n       - LC_ALL=C.UTF-8\n       - POSTGRES_DB=bentomldb\n       - POSTGRES_USER=postgres\n       - POSTGRES_PASSWORD=\n       - POSTGRES_HOST_AUTH_METHOD=trust\n     volumes:\n       - ./data/yatai/db:/var/lib/postgresql/data\n     networks:\n       - yatai\n networks:\n   yatai: {}\n </denchmark-code>\n \n Expected behavior\n YataiService connecting to the database.\n Environment:\n \n OS: Manjaro 20.0\n YataiService Version: 0.7.5\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "fernandocamargoti", "commentT": "2020-05-11T06:55:45Z", "comment_text": "\n \t\thi <denchmark-link:https://github.com/fernandocamargoti>@fernandocamargoti</denchmark-link>\n , this issue has been fixed and we are re-releasing the YataiService docker images from version 0.7.0-0.7.5, I've verified with the following docker-compose.yml file and the server starts up properly now:\n <denchmark-code>version: '3'\n \n services:\n   yatai-service:\n     restart: unless-stopped\n     image: bentoml/yatai-service:0.7.5\n     command: \"--db-url=postgres://postgres@yatai-db:5432/bentomldb --repo-base-url=/bentoml/repository\"\n     volumes:\n       - ./data/yatai/repository:/bentoml/repository\n     depends_on:\n       - yatai-db\n     networks:\n       - yatai\n   yatai-db:\n     image: library/postgres:latest\n     environment:\n       - LC_ALL=C.UTF-8\n       - POSTGRES_DB=bentomldb\n       - POSTGRES_USER=postgres\n       - POSTGRES_PASSWORD=\n       - POSTGRES_HOST_AUTH_METHOD=trust\n     volumes:\n       - ./data/yatai/db:/var/lib/postgresql/data\n     networks:\n       - yatai\n networks:\n   yatai: {}\n </denchmark-code>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "fernandocamargoti", "commentT": "2020-05-14T07:01:07Z", "comment_text": "\n \t\tClosing this issue now since we've re-released the docker image and added end-to-end tests covering this behavior.\n Feel free to re-open if you run into other issues related to this <denchmark-link:https://github.com/fernandocamargoti>@fernandocamargoti</denchmark-link>\n , thanks again for reporting the issue!\n \t\t"}}}, "commit": {"commit_id": "1489b00827d2ede6954929452745c7152a6df36c", "commit_author": "Bozhao", "commitT": "2020-05-10 18:53:14-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "bentoml\\yatai\\web\\src\\server.ts", "file_new_name": "bentoml\\yatai\\web\\src\\server.ts", "file_complexity": {"file_NLOC": "207", "file_CCN": "14", "file_NToken": "1778"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "212,214", "deleted_lines": "212,214", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "209", "method_endline": "216", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "57", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docker\\yatai-service\\Dockerfile", "file_new_name": "docker\\yatai-service\\Dockerfile", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "57", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "e2e_tests\\conftest.py", "file_new_name": "e2e_tests\\conftest.py", "file_complexity": {"file_NLOC": "129", "file_CCN": "11", "file_NToken": "593"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "112,113,114", "deleted_lines": "92,93,94,95,96,97,98,99,100,101,102", "method_info": {"method_name": "temporary_docker_postgres_url", "method_params": "", "method_startline": "92", "method_endline": "120", "method_complexity": {"method_NLOC": "26", "method_CCN": "1", "method_NToken": "80", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88", "deleted_lines": "84,85,86,87,88", "method_info": {"method_name": "wait_for_docker_container_ready", "method_params": "container_name,check_message", "method_startline": "65", "method_endline": "88", "method_complexity": {"method_NLOC": "19", "method_CCN": "5", "method_NToken": "125", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163", "deleted_lines": null, "method_info": {"method_name": "temporary_yatai_service_url", "method_params": "", "method_startline": "133", "method_endline": "163", "method_complexity": {"method_NLOC": "27", "method_CCN": "1", "method_NToken": "84", "method_nesting_level": "0"}}}}}, "file_3": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "e2e_tests\\yatai_server\\test_yatai_docker_container.py", "file_complexity": {"file_NLOC": "31", "file_CCN": "1", "file_NToken": "171"}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "setup.py", "file_new_name": "setup.py", "file_complexity": {"file_NLOC": "123", "file_CCN": "0", "file_NToken": "380"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "60", "deleted_lines": "60"}}}}}}