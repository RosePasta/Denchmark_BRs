{"BR": {"BR_id": "680", "BR_author": "Steve-Tod", "BRopenT": "2020-09-11T15:32:49Z", "BRcloseT": "2020-09-17T08:19:46Z", "BR_text": {"BRsummary": "RandomResizedCrop gives same relative scale across batch samples", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n Steps to reproduce the behavior:\n transform = K.RandomResizedCrop(size=(224, 224), same_on_batch=False, return_transform=True)\n sample = torch.randn(4, 3, 256, 256)\n out, trans = transform(sample)\n print(trans)\n output:\n <denchmark-code>tensor([[[ 1.2120e+00,  0.0000e+00, -4.4842e+01],\n          [-1.0788e-09,  1.0773e+00, -3.2319e+00],\n          [-9.2969e-11, -9.8340e-19,  1.0000e+00]],\n \n         [[ 1.2120e+00,  0.0000e+00, -6.6658e+01],\n          [ 7.9805e-09,  1.0773e+00, -3.0164e+01],\n          [-9.2969e-11,  8.2639e-11,  1.0000e+00]],\n \n         [[ 1.2120e+00,  1.6034e-08, -7.2717e+01],\n          [ 1.5634e-08,  1.0773e+00, -4.4169e+01],\n          [-9.2969e-11, -3.3056e-10,  1.0000e+00]],\n \n         [[ 1.2120e+00,  0.0000e+00, -4.8478e+00],\n          [-2.5364e-09,  1.0773e+00, -4.3092e+00],\n          [ 4.9971e-10, -3.4089e-10,  1.0000e+00]]])\n </denchmark-code>\n \n <denchmark-h:h2>Expected behavior</denchmark-h>\n \n Since I set same_on_batch=False, it should give different relative scales for different samples. However, in the corresponding items in the returned transformation matrix((0, 0), (1, 1)), we can see the numbers are the same, which is not expected.\n <denchmark-h:h2>Environment</denchmark-h>\n \n \n PyTorch Version (e.g., 1.0): 1.5.0\n OS (e.g., Linux): Linux\n How you installed PyTorch (conda, pip, source): conda\n Python version: 3.7.7\n kornia: 0.3.2\n \n <denchmark-h:h2>Additional context</denchmark-h>\n \n I think the problem is <denchmark-link:https://github.com/kornia/kornia/blob/57f5aeb605d0c69de88a0a1aa1563cee52d4bfaf/kornia/augmentation/augmentation.py#L758>here</denchmark-link>\n . When you compute the target crop size, batch size is not taken as an input and one single crop size is returned, which will be used for every sample in the batch.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Steve-Tod", "commentT": "2020-09-13T10:19:08Z", "comment_text": "\n \t\t/cc <denchmark-link:https://github.com/shijianjian>@shijianjian</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Steve-Tod", "commentT": "2020-09-13T10:37:14Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Steve-Tod>@Steve-Tod</denchmark-link>\n  Got it. Will look into it.\n \t\t"}}}, "commit": {"commit_id": "a2fde6dc4e514183f8c448f5b72ee75c03067858", "commit_author": "shijianjian", "commitT": "2020-09-17 16:19:43+08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "kornia\\augmentation\\augmentation.py", "file_new_name": "kornia\\augmentation\\augmentation.py", "file_complexity": {"file_NLOC": "898", "file_CCN": "93", "file_NToken": "6091"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "728", "deleted_lines": "727", "method_info": {"method_name": "generate_parameters", "method_params": "self,Size", "method_startline": "726", "method_endline": "730", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "94", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "kornia\\augmentation\\random_generator\\random_generator.py", "file_new_name": "kornia\\augmentation\\random_generator\\random_generator.py", "file_complexity": {"file_NLOC": "669", "file_CCN": "15", "file_NToken": "3799"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "328", "deleted_lines": "327,328,329,330,331,332", "method_info": {"method_name": "random_crop_size_generator", "method_params": "int,int,Tensor,Tensor,bool", "method_startline": "327", "method_endline": "332", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "32", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "kornia\\augmentation\\utils\\helpers.py", "file_new_name": "kornia\\augmentation\\utils\\helpers.py", "file_complexity": {"file_NLOC": "174", "file_CCN": "27", "file_NToken": "1145"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "125", "deleted_lines": "125"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "kornia\\geometry\\transform\\crop.py", "file_new_name": "kornia\\geometry\\transform\\crop.py", "file_complexity": {"file_NLOC": "340", "file_CCN": "8", "file_NToken": "1623"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "341,342", "deleted_lines": null, "method_info": {"method_name": "bbox_generator", "method_params": "Tensor,Tensor,Tensor,Tensor", "method_startline": "341", "method_endline": "342", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "25", "method_nesting_level": "0"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "test\\augmentation\\test_augmentation.py", "file_new_name": "test\\augmentation\\test_augmentation.py", "file_complexity": {"file_NLOC": "1182", "file_CCN": "79", "file_NToken": "16745"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1491,1498,1501,1502,1503", "deleted_lines": "1491,1498,1501,1502,1503", "method_info": {"method_name": "test_crop_scale_ratio", "method_params": "self,device,dtype", "method_startline": "1491", "method_endline": "1507", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "172", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "1509,1516,1519,1520,1521,1522,1523,1524,1528", "deleted_lines": "1509,1516,1519,1520,1521,1522,1523,1524,1528", "method_info": {"method_name": "test_crop_scale_ratio_batch", "method_params": "self,device", "method_startline": "1509", "method_endline": "1528", "method_complexity": {"method_NLOC": "18", "method_CCN": "1", "method_NToken": "224", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "1491,1498,1501,1502,1503", "deleted_lines": "1491,1498,1501,1502,1503", "method_info": {"method_name": "test_crop_scale_ratio", "method_params": "self,device", "method_startline": "1491", "method_endline": "1507", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "164", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "1509,1516,1519,1520,1521,1522,1523,1524,1528", "deleted_lines": "1509,1516,1519,1520,1521,1522,1523,1524,1528", "method_info": {"method_name": "test_crop_scale_ratio_batch", "method_params": "self,device,dtype", "method_startline": "1509", "method_endline": "1528", "method_complexity": {"method_NLOC": "18", "method_CCN": "1", "method_NToken": "244", "method_nesting_level": "1"}}}}}}}}