{"BR": {"BR_id": "843", "BR_author": "chenglin", "BRopenT": "2020-06-18T12:03:40Z", "BRcloseT": "2020-06-19T00:59:03Z", "BR_text": {"BRsummary": "Integration with ingress: dns resolve error", "BRdescription": "\n <denchmark-h:h3>Describe the bug</denchmark-h>\n \n I enabled ingress when depoly polyaxon.\n When I run an experiment from https://github.com/polyaxon/polyaxon-quick-start,  there are errors about Temporary failure in name resolution\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n \n deploy polyaxon:\n \n <denchmark-code>polyaxon admin deploy -f polyaxon_config.yaml\n </denchmark-code>\n \n polyaxon_config.yaml:\n <denchmark-code>deploymentType: microk8s\n deploymentChart: platform\n deploymentVersion: 1.0.99-rc2\n \n gateway:\n   imageTag: 1.0.99-rc2\n \n streams:\n   imageTag: 1.0.99-rc2\n \n api:\n   imageTag: 1.0.99-rc2\n \n scheduler:\n   imageTag: 1.0.99-rc2\n \n hooks:\n   imageTag: 1.0.99-rc2\n \n init:\n   imageTag: 1.0.99-rc2\n \n sidecar:\n   imageTag: 1.0.99-rc2\n \n \n ingress:\n   enabled: true\n   hostName: polyaxon.domainname.com\n \n user:\n   username: root\n   email: root@polyaxon.local\n   password: rootpassword\n </denchmark-code>\n \n \n clone polyaxon-quick-start:\n \n <denchmark-code>git clone https://github.com/polyaxon/polyaxon-quick-start\n </denchmark-code>\n \n \n create a project named quick-start from the web ui\n run a experiment\n \n <denchmark-code>cd polyaxon-quick-start\n polyaxon run -p quick-start -f experimentation/simple.yml\n </denchmark-code>\n \n \n \n open web ui log tab\n \n \n \n polyaxon-init-git-polyaxon-quick-start\n \n \n <denchmark-code>polyaxon-init-git-polyaxon-quick-start:\n     Container ID:  containerd://70e5a7c9b6b74a90519f2b9f481224c9a7241c891fa59103a9c9bffad4e45260\n     Image:         polyaxon/polyaxon-init:1.0.99-rc2\n     Image ID:      docker.io/polyaxon/polyaxon-init@sha256:ab195eda86530e696379f0b78b3b7a674f348c5fcc6cb8e072cccebe3529b6a8\n     Port:          <none>\n     Host Port:     <none>\n     Command:\n       polyaxon\n       initializer\n       git\n     Args:\n       --repo_path=/plx-context/artifacts/polyaxon-quick-start\n       --url=https://github.com/polyaxon/polyaxon-quick-start\n     State:          Running\n       Started:      Thu, 18 Jun 2020 19:41:46 +0800\n     Ready:          False\n     Restart Count:  0\n     Limits:\n       cpu:     1\n       memory:  2000Mi\n     Requests:\n       cpu:     100m\n       memory:  100Mi\n     Environment:\n       POLYAXON_API_HOST:                                polyaxon.domainname.com\n       POLYAXON_IS_MANAGED:                              true\n       POLYAXON_API_VERSION:                             v1\n       POLYAXON_K8S_NODE_NAME:                            (v1:spec.nodeName)\n       POLYAXON_K8S_NAMESPACE:                           polyaxon (v1:metadata.namespace)\n       POLYAXON_K8S_POD_ID:                              plx-operation-cc2e0a4ef46941d586610e1a01cb5833-jdb92 (v1:metadata.name)\n       POLYAXON_RUN_INSTANCE:                             (v1:metadata.labels['app.kubernetes.io/instance'])\n       POLYAXON_HEADER:                                  X-POLYAXON-SERVICE\n       POLYAXON_HEADER_SERVICE:                          initializer\n       POLYAXON_AUTHENTICATION_TYPE:                     Token\n       POLYAXON_CONNECTION_SCHEMA_POLYAXON-QUICK-START:  {\"name\": \"polyaxon-quick-start\", \"kind\": \"git\", \"schema\": {\"url\": \"https://github.com/polyaxon/polyaxon-quick-start\", \"kind\": \"git\"}}\n     Mounts:\n       /plx-context/artifacts from artifacts-context (rw)\n       /var/run/secrets/kubernetes.io/serviceaccount from polyaxon-polyaxon-runs-sa-token-8f7mk (ro)\n </denchmark-code>\n \n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n experiment finished successfully\n <denchmark-h:h3>Environment</denchmark-h>\n \n OS: ubuntu 20.04\n k8s: microk8s, one node\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "chenglin", "commentT": "2020-06-18T12:10:08Z", "comment_text": "\n \t\tPolyaxon CE should always use local api/streams host for resolving endpoints.\n Hopefully a fix will be pushed today with the new RC3.\n \t\t"}}}, "commit": {"commit_id": "210a57765d414129a5bd966f8cc8c909d346929a", "commit_author": "mouradmourafiq", "commitT": "2020-06-19 02:57:29+02:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\agent\\templates\\common-cm.yaml", "file_new_name": "helm\\agent\\templates\\common-cm.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "22,25,28,30,34", "deleted_lines": "22,25,28,30"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\agent\\templates\\partials\\_api.tpl", "file_new_name": "helm\\agent\\templates\\partials\\_api.tpl", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "2,6", "deleted_lines": "2,3,4,5,6,10,11,12,13,14,15,16,17,18,19,20,21,22"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\agent\\templates\\partials\\_proxies.tpl", "file_new_name": "helm\\agent\\templates\\partials\\_proxies.tpl", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34", "deleted_lines": null}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\agent\\templates\\proxies-cm.yaml", "file_new_name": "helm\\agent\\templates\\proxies-cm.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "20,21,22,23", "deleted_lines": "20,21,22,23"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\polyaxon\\templates\\common-cm.yaml", "file_new_name": "helm\\polyaxon\\templates\\common-cm.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "22,25,28,30,34", "deleted_lines": "22,25,28,30"}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\polyaxon\\templates\\partials\\_api.tpl", "file_new_name": "helm\\polyaxon\\templates\\partials\\_api.tpl", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "2,6", "deleted_lines": "2,3,4,5,6,10,11,12,13,14,15,16,17,18,19,20,21,22"}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\polyaxon\\templates\\partials\\_proxies.tpl", "file_new_name": "helm\\polyaxon\\templates\\partials\\_proxies.tpl", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34", "deleted_lines": null}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\polyaxon\\templates\\proxies-cm.yaml", "file_new_name": "helm\\polyaxon\\templates\\proxies-cm.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "20,21,22,23", "deleted_lines": "20,21,22,23"}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\templates\\common\\common-cm.yaml", "file_new_name": "helm\\templates\\common\\common-cm.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "22,25,28,30,34", "deleted_lines": "22,25,28,30"}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\templates\\common\\partials\\_api.tpl", "file_new_name": "helm\\templates\\common\\partials\\_api.tpl", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "2,6", "deleted_lines": "2,3,4,5,6,10,11,12,13,14,15,16,17,18,19,20,21,22"}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\templates\\common\\partials\\_proxies.tpl", "file_new_name": "helm\\templates\\common\\partials\\_proxies.tpl", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34", "deleted_lines": null}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "helm\\templates\\common\\proxies-cm.yaml", "file_new_name": "helm\\templates\\common\\proxies-cm.yaml", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "20,21,22,23", "deleted_lines": "20,21,22,23"}}}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "platform\\polycommon\\polycommon\\settings\\api.py", "file_new_name": "platform\\polycommon\\polycommon\\settings\\api.py", "file_complexity": {"file_NLOC": "46", "file_CCN": "5", "file_NToken": "237"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "29,30,31", "deleted_lines": "29,30,31", "method_info": {"method_name": "set_api.get_allowed_hosts", "method_params": "", "method_startline": "24", "method_endline": "33", "method_complexity": {"method_NLOC": "9", "method_CCN": "2", "method_NToken": "55", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "29,30,31", "deleted_lines": "29,30,31", "method_info": {"method_name": "set_api", "method_params": "context,ConfigManager,None", "method_startline": "21", "method_endline": "70", "method_complexity": {"method_NLOC": "36", "method_CCN": "3", "method_NToken": "172", "method_nesting_level": "0"}}}}}}}}