{"BR": {"BR_id": "1910", "BR_author": "athewsey", "BRopenT": "2020-09-21T02:07:46Z", "BRcloseT": "2020-10-07T19:58:33Z", "BR_text": {"BRsummary": "KeyError: 'NetworkConfig' in predictor.list_monitors()", "BRdescription": "\n Describe the bug\n predictor.list_monitors() raises KeyError: 'NetworkConfig' when called on a (non-VPC) endpoint (PyTorch framework model, custom Docker monitoring job).\n Per the <denchmark-link:https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_MonitoringJobDefinition.html#sagemaker-Type-MonitoringJobDefinition-NetworkConfig>MonitoringJobDefinition API doc</denchmark-link>\n , this field is optional in the response so should not be assumed.\n To reproduce\n Specifically I'm using the <denchmark-link:https://github.com/aws-samples/amazon-sagemaker-analyze-model-predictions>\"Detecting and analyzing incorrect model predictions with Amazon SageMaker Model Monitor and Debugger\"</denchmark-link>\n  sample, and trying to re-attach to my endpoint's existing monitoring schedule after a kernel restart.\n In general I expect you could:\n \n Deploy an endpoint not in a VPC, with no VPC/network configurations specified\n Attach a monitoring schedule, also with no VPC/network config\n call predictor.list_monitors()\n \n Expected behavior\n List monitors regardless of whether NetworkConfig/VPC information is available\n Screenshots or logs\n Traceback:\n <denchmark-code>~/anaconda3/envs/pytorch_p36/lib/python3.6/site-packages/sagemaker/predictor.py in list_monitors(self)\n     358                     ModelMonitor.attach(\n     359                         monitor_schedule_name=schedule_name,\n --> 360                         sagemaker_session=self.sagemaker_session,\n     361                     )\n     362                 )\n \n ~/anaconda3/envs/pytorch_p36/lib/python3.6/site-packages/sagemaker/model_monitor/model_monitoring.py in attach(cls, monitor_schedule_name, sagemaker_session)\n     680 \n     681         vpc_config = schedule_desc[\"MonitoringScheduleConfig\"][\"MonitoringJobDefinition\"][\n --> 682             \"NetworkConfig\"\n     683         ].get(\"VpcConfig\")\n     684 \n \n KeyError: 'NetworkConfig'\n </denchmark-code>\n \n System information\n A description of your system. Please provide:\n \n SageMaker Python SDK version: 2.9.1\n Framework name (eg. PyTorch) or algorithm (eg. KMeans): PyTorch\n Framework version: 1.3.1\n Python version: 3.6\n CPU or GPU: CPU\n Custom Docker image (Y/N): Y for processing job, N for endpoint\n \n Additional context\n None\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "athewsey", "commentT": "2020-09-21T10:20:29Z", "comment_text": "\n \t\tUpdate: This issue also appears to break ModelMonitor.attach() even if you're able to recover the monitoring schedule name via boto3.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "athewsey", "commentT": "2020-10-07T19:58:33Z", "comment_text": "\n \t\tA fix for this has been merged: <denchmark-link:https://github.com/aws/sagemaker-python-sdk/pull/1911>#1911</denchmark-link>\n \n Pending release.\n \t\t"}}}, "commit": {"commit_id": "2b812c88db0da710796ea956883fee01d760ce8b", "commit_author": "Chuyang", "commitT": "2020-10-07 11:43:00-07:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\sagemaker\\model_monitor\\model_monitoring.py", "file_new_name": "src\\sagemaker\\model_monitor\\model_monitoring.py", "file_complexity": {"file_NLOC": "1255", "file_CCN": "106", "file_NToken": "6006"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,661,662,663,665,667,668,669,679", "deleted_lines": "644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,668,669,670,671,672,673,675,676,677,678,679,681,682,683", "method_info": {"method_name": "attach", "method_params": "cls,monitor_schedule_name,sagemaker_session", "method_startline": "626", "method_endline": "705", "method_complexity": {"method_NLOC": "59", "method_CCN": "7", "method_NToken": "301", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\unit\\sagemaker\\monitor\\test_model_monitoring.py", "file_new_name": "tests\\unit\\sagemaker\\monitor\\test_model_monitoring.py", "file_complexity": {"file_NLOC": "157", "file_CCN": "5", "file_NToken": "727"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "184,185,186,187,188,189,190,191,192", "deleted_lines": null, "method_info": {"method_name": "test_model_monitor_without_network_config", "method_params": "sagemaker_session", "method_startline": "184", "method_endline": "192", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "41", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "108,109,110", "deleted_lines": null, "method_info": {"method_name": "sagemaker_session", "method_params": "", "method_startline": "94", "method_endline": "111", "method_complexity": {"method_NLOC": "18", "method_CCN": "1", "method_NToken": "95", "method_nesting_level": "0"}}}}}}}}