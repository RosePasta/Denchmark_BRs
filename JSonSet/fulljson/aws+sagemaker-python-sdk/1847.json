{"BR": {"BR_id": "1847", "BR_author": "metrizable", "BRopenT": "2020-08-20T17:20:58Z", "BRcloseT": "2020-08-20T21:27:56Z", "BR_text": {"BRsummary": "bug: AttributeError: 'NoneType' object has no attribute 'module' when applying the v2 upgrade tool", "BRdescription": "\n Describe the bug\n When applying the sagemaker-upgrade-v2 automated CLI tool, earlier ast modification leads to an AttributeError exception.\n To reproduce\n \n Craft a script that will be modified by a SerDe import renamer\n Apply the V2 upgrade CLI tool:\n \n An AttributeError exception is raised.\n Expected behavior\n The V2 upgrade CLI would properly upgrade the script.\n Screenshots or logs\n <denchmark-code>\u276f cat v1.py\n import sagemaker\n \n from sagemaker.predictor import csv_serializer\n \n csv_serializer.__doc___\n \n \u276f sagemaker-upgrade-v2 --in-file v1.py --out-file v2.py\n Traceback (most recent call last):\n   File \"~/testvenv/bin/sagemaker-upgrade-v2\", line 8, in <module>\n     sys.exit(main())\n   File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/sagemaker_upgrade_v2.py\", line 78, in main\n     _update_file(args.in_file, args.out_file)\n   File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/sagemaker_upgrade_v2.py\", line 50, in _update_file\n     updater_cls(input_path=input_file, output_path=output_file).update()\n   File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/files.py\", line 72, in update\n     output = self._update_ast(self._read_input_file())\n   File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/files.py\", line 86, in _update_ast\n     return ASTTransformer().visit(input_ast)\n   File \"/usr/lib/python3.8/ast.py\", line 363, in visit\n     return visitor(node)\n   File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/ast_transformer.py\", line 136, in visit_Module\n     self.generic_visit(node)\n   File \"/usr/lib/python3.8/ast.py\", line 439, in generic_visit\n     value = self.visit(value)\n   File \"/usr/lib/python3.8/ast.py\", line 363, in visit\n     return visitor(node)\n   File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/ast_transformer.py\", line 155, in visit_ImportFrom\n     node = import_checker.check_and_modify_node(node)\n   File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/modifiers/modifier.py\", line 26, in check_and_modify_node\n     if self.node_should_be_modified(node):\n   File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/modifiers/image_uris.py\", line 115, in node_should_be_modified\n     return node.module in GET_IMAGE_URI_NAMESPACES and any(\n AttributeError: 'NoneType' object has no attribute 'module'\n </denchmark-code>\n \n System information\n A description of your system. Please provide:\n \n SageMaker Python SDK version: 2.4.1\n Framework name (eg. PyTorch) or algorithm (eg. KMeans):\n Framework version:\n Python version:\n CPU or GPU:\n Custom Docker image (Y/N):\n \n Additional context\n The problem comes from <denchmark-link:https://github.com/aws/sagemaker-python-sdk/blob/v2.4.1/src/sagemaker/cli/compatibility/v2/ast_transformer.py#L59-L60>the ordering</denchmark-link>\n , which the existing, isolated unit tests do not cover. The earlier renamer modifies the ast, and the later renamer cannot handle this situation:\n <denchmark-code> 59     modifiers.serde.SerdeImportFromPredictorRenamer(),\n  60     modifiers.image_uris.ImageURIRetrieveImportFromRenamer(),\n </denchmark-code>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "059c98e6696dd6c1334731118a2b8725a2903151", "commit_author": "Eric Johnson", "commitT": "2020-08-20 14:27:55-07:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\sagemaker\\cli\\compatibility\\v2\\modifiers\\image_uris.py", "file_new_name": "src\\sagemaker\\cli\\compatibility\\v2\\modifiers\\image_uris.py", "file_complexity": {"file_NLOC": "70", "file_CCN": "23", "file_NToken": "473"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "115,116,117,118", "deleted_lines": "115,116", "method_info": {"method_name": "node_should_be_modified", "method_params": "self,node", "method_startline": "105", "method_endline": "119", "method_complexity": {"method_NLOC": "6", "method_CCN": "4", "method_NToken": "36", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\unit\\sagemaker\\cli\\compatibility\\v2\\test_ast_transformer.py", "file_complexity": {"file_NLOC": "27", "file_CCN": "3", "file_NToken": "89"}}}}}