{"BR": {"BR_id": "1759", "BR_author": "RobinKa", "BRopenT": "2020-07-28T14:58:41Z", "BRcloseT": "2020-08-05T16:13:03Z", "BR_text": {"BRsummary": "Default model_dir uses backslashes on Windows", "BRdescription": "\n Describe the bug\n The default model_dir will contain backslashes when running the following code to start tensorflow training on Windows.\n from sagemaker.tensorflow import TensorFlow\n \n role = \"<role>\"\n \n tf_estimator = TensorFlow(\n     source_dir=\"src\", script_mode=True,\n     framework_version=\"1.15.2\", py_version=\"py37\",\n     entry_point=\"main.py\", role=role,\n     train_instance_count=1, train_instance_type=\"ml.g4dn.xlarge\",\n     train_volume_size=50,\n     output_path=\"<bucketpath>/exported_model\"\n )\n \n tf_estimator.fit({\n     \"train\": \"<bucketpath>/<train dir>\",\n     \"test\": \"<bucketpath>/<test dir>\",\n })\n Trying to then upload something to the model_dir path (eg. when tensorflow tries to save checkpoints) will not work as S3 requires forward slashes. Example args that are passed when executing the above code\n <denchmark-code>Args: Namespace(alpha=0.25, augment=True, batch_size=3, classes=2, crop_size=512, current_host='algo-1', epochs=3, fl_weight=0.1, gamma=2.0, hosts=['algo-1'], init_lr=0.004, layer_depth=21, mode='train', model_dir='<bucketpath>/exported_model\\\\tensorflow-training-2020\n -07-28-14-00-00-884\\\\model', momentum=0.9, num_gpus=1, output_dir='output', power=0.9, regularization_scale=0.0001, sm_model_dir='/opt/ml/model', stddev=0.02, test_dir='/opt/ml/input/data/test', train_dir='/opt/ml/input/data/train')\n </denchmark-code>\n \n As a workaround I just did args.model_dir = args.model_dir.replace(\"\\\\\", \"/\") in my training code.\n Expected behavior\n The model_dir path should use forward slashes no matter which OS the code to initiate training is run from for S3 paths.\n System information\n A description of your system. Please provide:\n \n SageMaker Python SDK version: 1.71.1\n Framework name (eg. PyTorch) or algorithm (eg. KMeans): TensorFlow\n Framework version: 1.15.2\n Python version: 3.7.? on server, 3.7.3 locally\n CPU or GPU: GPU\n Custom Docker image (Y/N): N\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "RobinKa", "commentT": "2020-07-28T17:36:24Z", "comment_text": "\n \t\tThanks for the bug report! I've opened a PR to address this: <denchmark-link:https://github.com/aws/sagemaker-python-sdk/pull/1763>#1763</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "RobinKa", "commentT": "2020-08-05T16:13:03Z", "comment_text": "\n \t\tI have merged <denchmark-link:https://github.com/aws/sagemaker-python-sdk/pull/1763>#1763</denchmark-link>\n  - sorry for the delay!\n \t\t"}}}, "commit": {"commit_id": "81ae9daa3e7ac41dffb2853d3f8d2ecf2b8ee517", "commit_author": "Lauren Yu", "commitT": "2020-08-05 09:12:29-07:00", "commit_complexity": {"commit_NLOC": "0.8461538461538461", "commit_CCN": "0.8461538461538461", "commit_Nprams": "0.8461538461538461"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\sagemaker\\local\\utils.py", "file_new_name": "src\\sagemaker\\local\\utils.py", "file_complexity": {"file_NLOC": "29", "file_CCN": "7", "file_NToken": "194"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "75,76,77,78,79,80,81,82,83,84,85,86,87,88", "method_info": {"method_name": "_create_s3_prefix", "method_params": "path,job_name", "method_startline": "75", "method_endline": "88", "method_complexity": {"method_NLOC": "3", "method_CCN": "2", "method_NToken": "33", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "67,68", "deleted_lines": "65,66", "method_info": {"method_name": "move_to_destination", "method_params": "source,destination,job_name,sagemaker_session", "method_startline": "48", "method_endline": "74", "method_complexity": {"method_NLOC": "14", "method_CCN": "3", "method_NToken": "99", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\sagemaker\\model_monitor\\data_capture_config.py", "file_new_name": "src\\sagemaker\\model_monitor\\data_capture_config.py", "file_complexity": {"file_NLOC": "60", "file_CCN": "8", "file_NToken": "299"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "19,69", "deleted_lines": "19,20,70"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 11, "file_old_name": "src\\sagemaker\\model_monitor\\model_monitoring.py", "file_new_name": "src\\sagemaker\\model_monitor\\model_monitoring.py", "file_complexity": {"file_NLOC": "1267", "file_CCN": "105", "file_NToken": "6076"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "874", "deleted_lines": "872", "method_info": {"method_name": "_normalize_processing_output", "method_params": "self,output", "method_startline": "862", "method_endline": "884", "method_complexity": {"method_NLOC": "12", "method_CCN": "2", "method_NToken": "59", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "898", "deleted_lines": "896", "method_info": {"method_name": "_normalize_monitoring_output", "method_params": "self,output", "method_startline": "886", "method_endline": "905", "method_complexity": {"method_NLOC": "9", "method_CCN": "2", "method_NToken": "44", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "1857", "deleted_lines": "1842", "method_info": {"method_name": "baseline_statistics", "method_params": "self,file_name,kms_key", "method_startline": "1838", "method_endline": "1874", "method_complexity": {"method_NLOC": "22", "method_CCN": "4", "method_NToken": "114", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "2011", "deleted_lines": "1996", "method_info": {"method_name": "statistics", "method_params": "self,file_name,kms_key", "method_startline": "1992", "method_endline": "2028", "method_complexity": {"method_NLOC": "22", "method_CCN": "4", "method_NToken": "114", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "1672,1681,1682", "deleted_lines": "1667", "method_info": {"method_name": "_normalize_monitoring_output", "method_params": "self,output_s3_uri", "method_startline": "1662", "method_endline": "1685", "method_complexity": {"method_NLOC": "14", "method_CCN": "2", "method_NToken": "64", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "847,853", "deleted_lines": "845,851", "method_info": {"method_name": "_normalize_baseline_inputs", "method_params": "self,baseline_inputs", "method_startline": "821", "method_endline": "860", "method_complexity": {"method_NLOC": "24", "method_CCN": "6", "method_NToken": "139", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "1895", "deleted_lines": "1880", "method_info": {"method_name": "suggested_constraints", "method_params": "self,file_name,kms_key", "method_startline": "1876", "method_endline": "1912", "method_complexity": {"method_NLOC": "22", "method_CCN": "4", "method_NToken": "114", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "919,928,931", "deleted_lines": "917,926,929", "method_info": {"method_name": "_s3_uri_from_local_path", "method_params": "self,path", "method_startline": "907", "method_endline": "932", "method_complexity": {"method_NLOC": "17", "method_CCN": "2", "method_NToken": "96", "method_nesting_level": "1"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "1648,1657", "deleted_lines": "1643,1658", "method_info": {"method_name": "_normalize_baseline_output", "method_params": "self,output_s3_uri", "method_startline": "1638", "method_endline": "1660", "method_complexity": {"method_NLOC": "14", "method_CCN": "2", "method_NToken": "65", "method_nesting_level": "1"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "1759,1768", "deleted_lines": "1744,1753", "method_info": {"method_name": "_upload_and_convert_to_processing_input", "method_params": "self,source,destination,name", "method_startline": "1740", "method_endline": "1773", "method_complexity": {"method_NLOC": "19", "method_CCN": "3", "method_NToken": "101", "method_nesting_level": "1"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "812,813,814,815", "deleted_lines": "812,813", "method_info": {"method_name": "_normalize_endpoint_input", "method_params": "self,endpoint_input", "method_startline": "797", "method_endline": "819", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "43", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "src\\sagemaker\\model_monitor\\monitoring_files.py", "file_new_name": "src\\sagemaker\\model_monitor\\monitoring_files.py", "file_complexity": {"file_NLOC": "226", "file_CCN": "23", "file_NToken": "1138"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "247", "deleted_lines": "248", "method_info": {"method_name": "from_s3_uri", "method_params": "cls,constraints_file_s3_uri,kms_key,sagemaker_session", "method_startline": "229", "method_endline": "265", "method_complexity": {"method_NLOC": "21", "method_CCN": "2", "method_NToken": "78", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "121", "deleted_lines": "122", "method_info": {"method_name": "from_s3_uri", "method_params": "cls,statistics_file_s3_uri,kms_key,sagemaker_session", "method_startline": "103", "method_endline": "136", "method_complexity": {"method_NLOC": "18", "method_CCN": "2", "method_NToken": "73", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "401", "deleted_lines": "402", "method_info": {"method_name": "from_s3_uri", "method_params": "cls,constraint_violations_file_s3_uri,kms_key,sagemaker_session", "method_startline": "383", "method_endline": "420", "method_complexity": {"method_NLOC": "22", "method_CCN": "2", "method_NToken": "74", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "70", "deleted_lines": "71", "method_info": {"method_name": "save", "method_params": "self,new_save_location_s3_uri", "method_startline": "53", "method_endline": "75", "method_complexity": {"method_NLOC": "9", "method_CCN": "2", "method_NToken": "58", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\sagemaker\\multidatamodel.py", "file_new_name": "src\\sagemaker\\multidatamodel.py", "file_complexity": {"file_NLOC": "159", "file_CCN": "11", "file_NToken": "839"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "294,299,302,306,308,311", "deleted_lines": "293,298,301,305,307,310", "method_info": {"method_name": "add_model", "method_params": "self,model_data_source,model_data_path", "method_startline": "270", "method_endline": "317", "method_complexity": {"method_NLOC": "23", "method_CCN": "5", "method_NToken": "186", "method_nesting_level": "1"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "src\\sagemaker\\processing.py", "file_new_name": "src\\sagemaker\\processing.py", "file_complexity": {"file_NLOC": "460", "file_CCN": "67", "file_NToken": "2385"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "523,524,525,526", "deleted_lines": null, "method_info": {"method_name": "_set_entrypoint", "method_params": "self,command,user_script_name", "method_startline": "517", "method_endline": "528", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "38", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "508,509,510,511", "deleted_lines": "501,502,514,515", "method_info": {"method_name": "_convert_code_and_add_to_inputs", "method_params": "self,inputs,s3_uri", "method_startline": "493", "method_endline": "515", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "54", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "482,483,486,489", "deleted_lines": "477,482", "method_info": {"method_name": "_upload_code", "method_params": "self,code", "method_startline": "471", "method_endline": "491", "method_complexity": {"method_NLOC": "11", "method_CCN": "1", "method_NToken": "56", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "218,219,222,225", "deleted_lines": "217,222", "method_info": {"method_name": "_normalize_inputs", "method_params": "self,inputs", "method_startline": "189", "method_endline": "232", "method_complexity": {"method_NLOC": "25", "method_CCN": "6", "method_NToken": "143", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "264,265,268", "deleted_lines": "261", "method_info": {"method_name": "_normalize_outputs", "method_params": "self,outputs", "method_startline": "234", "method_endline": "273", "method_complexity": {"method_NLOC": "20", "method_CCN": "6", "method_NToken": "118", "method_nesting_level": "1"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "src\\sagemaker\\s3.py", "file_new_name": "src\\sagemaker\\s3.py", "file_complexity": {"file_NLOC": "62", "file_CCN": "17", "file_NToken": "483"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "28,31,34,35,36", "deleted_lines": "31", "method_info": {"method_name": "parse_s3_url", "method_params": "url", "method_startline": "25", "method_endline": "41", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "46", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "185", "deleted_lines": null, "method_info": {"method_name": "list", "method_params": "s3_uri,sagemaker_session", "method_startline": "168", "method_endline": "185", "method_complexity": {"method_NLOC": "5", "method_CCN": "3", "method_NToken": "56", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59", "deleted_lines": null, "method_info": {"method_name": "s3_path_join", "method_params": "args", "method_startline": "44", "method_endline": "59", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "77", "method_nesting_level": "0"}}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\sagemaker\\tensorflow\\estimator.py", "file_new_name": "src\\sagemaker\\tensorflow\\estimator.py", "file_complexity": {"file_NLOC": "243", "file_CCN": "35", "file_NToken": "1293"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "331", "deleted_lines": "332", "method_info": {"method_name": "_default_s3_path", "method_params": "self,directory,mpi", "method_startline": "323", "method_endline": "332", "method_complexity": {"method_NLOC": "9", "method_CCN": "5", "method_NToken": "69", "method_nesting_level": "1"}}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\sagemaker\\tensorflow\\model.py", "file_new_name": "src\\sagemaker\\tensorflow\\model.py", "file_complexity": {"file_NLOC": "187", "file_CCN": "25", "file_NToken": "910"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "250", "deleted_lines": "250", "method_info": {"method_name": "prepare_container_def", "method_params": "self,instance_type,accelerator_type", "method_startline": "230", "method_endline": "264", "method_complexity": {"method_NLOC": "25", "method_CCN": "5", "method_NToken": "150", "method_nesting_level": "1"}}}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\unit\\test_s3.py", "file_new_name": "tests\\unit\\test_s3.py", "file_complexity": {"file_NLOC": "94", "file_CCN": "9", "file_NToken": "555"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "115,116,117,118,119,120,121,122,123,124,125,126", "deleted_lines": null, "method_info": {"method_name": "test_path_join", "method_params": "", "method_startline": "115", "method_endline": "126", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "89", "method_nesting_level": "0"}}}}}}}}