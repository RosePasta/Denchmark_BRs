{"BR": {"BR_id": "289", "BR_author": "lockder", "BRopenT": "2018-12-11T09:13:00Z", "BRcloseT": "2018-12-12T14:39:52Z", "BR_text": {"BRsummary": "Crash trying to export model using SequenceRecordInputter", "BRdescription": "\n What I see its calling to _get_serving_input inside SequenceRecordInputter before make_dataset\n is called. so self.input_depth doesn't exist yet\n File \"/usr/local/lib/python3.6/dist-packages/opennmt/bin/main.py\", line 179, in main\n export_dir_base=args.export_dir_base)\n File \"/usr/local/lib/python3.6/dist-packages/opennmt/runner.py\", line 376, in export\n **kwargs)\n File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/estimator/estimator.py\", line 734, in export_saved_model\n strip_default_attrs=True)\n File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/estimator/estimator.py\", line 663, in export_savedmodel\n mode=model_fn_lib.ModeKeys.PREDICT)\n File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/estimator/estimator.py\", line 789, in _export_saved_model_for_mode\n strip_default_attrs=strip_default_attrs)\n File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/estimator/estimator.py\", line 907, in _export_all_saved_models\n mode=model_fn_lib.ModeKeys.PREDICT)\n File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/estimator/estimator.py\", line 977, in _add_meta_graph_for_mode\n input_receiver = input_receiver_fn()\n File \"/usr/local/lib/python3.6/dist-packages/opennmt/models/model.py\", line 509, in \n return lambda: self._serving_input_fn_impl(metadata)\n File \"/usr/local/lib/python3.6/dist-packages/opennmt/models/model.py\", line 497, in _serving_input_fn_impl\n return self._get_serving_input_receiver()\n File \"/usr/local/lib/python3.6/dist-packages/opennmt/models/model.py\", line 272, in _get_serving_input_receiver\n return self.features_inputter.get_serving_input_receiver()\n File \"/usr/local/lib/python3.6/dist-packages/opennmt/inputters/inputter.py\", line 104, in get_serving_input_receiver\n receiver_tensors, features = self._get_serving_input()\n File \"/usr/local/lib/python3.6/dist-packages/opennmt/inputters/inputter.py\", line 333, in _get_serving_input\n receiver_tensors, features = inputter._get_serving_input()  # pylint: disable=protected-access\n File \"/usr/local/lib/python3.6/dist-packages/opennmt/inputters/record_inputter.py\", line 42, in _get_serving_input\n \"tensor\": tf.placeholder(self.dtype, shape=(None, None, self.input_depth)),\n AttributeError: 'SequenceRecordInputter' object has no attribute 'input_depth'\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "lockder", "commentT": "2018-12-11T12:02:44Z", "comment_text": "\n \t\tMmh yes, that is an issue.\n Initially, the user had to set the input depth in the configuration file. However, since <denchmark-link:https://github.com/OpenNMT/OpenNMT-tf/commit/d9f0cbd3cb7ae6830aa77675c63424dd2a959d45>d9f0cbd</denchmark-link>\n , the depth is directly inferred from the data but the export code was not updated accordingly. We may need to rethink this as the training data should not be required when exporting a model.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "lockder", "commentT": "2018-12-11T13:14:08Z", "comment_text": "\n \t\tI glad to help :)\n \t\t"}}}, "commit": {"commit_id": "07d6ffa86efa3c397a3f13b9231f955982c91e40", "commit_author": "Guillaume Klein", "commitT": "2018-12-12 15:39:51+01:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "21,22", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "opennmt\\models\\model.py", "file_new_name": "opennmt\\models\\model.py", "file_complexity": {"file_NLOC": "275", "file_CCN": "53", "file_NToken": "1867"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "497,498,499,500,501", "deleted_lines": null, "method_info": {"method_name": "_serving_input_fn_impl", "method_params": "self,metadata", "method_startline": "494", "method_endline": "502", "method_complexity": {"method_NLOC": "5", "method_CCN": "3", "method_NToken": "45", "method_nesting_level": "1"}}}}}}}}