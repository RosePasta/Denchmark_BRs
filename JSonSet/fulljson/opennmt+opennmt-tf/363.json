{"BR": {"BR_id": "363", "BR_author": "BigFishMaster", "BRopenT": "2019-03-04T13:30:47Z", "BRcloseT": "2019-03-05T11:56:58Z", "BR_text": {"BRsummary": "Sharing Embedding meets ERROR!", "BRdescription": "\n when I set \"share_embeddings=EmbeddingsSharingLevel.ALL\" in Transformer model, The trained model can not be correctly infered, e.g. the model will output serveral same tokens for each input query. There may be a bug under this parameter. I also tried share_embeddings=EmbeddingsSharingLevel.NONE, it's ok.\n my env:\n gpu: k40\n os:redhat\n cuda:9.0\n opennmt-tf version: v1.20.1 and the current master.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "BigFishMaster", "commentT": "2019-03-04T13:50:36Z", "comment_text": "\n \t\tDid you make sure to train with a joint vocabulary? If yes, how does the training loss look like with share_embeddings=EmbeddingsSharingLevel.ALL?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "BigFishMaster", "commentT": "2019-03-04T16:06:11Z", "comment_text": "\n \t\tYes.My task is Dialogue so I use same vocabulary for input and target. The loss curve seems well but the problem only happens during inference.\n I guess the embedding sharing has something bug. Please help me the fix that.\n The embedding sharing Transformer I used is just from config/models/transformer_share_embeddings.py\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "BigFishMaster", "commentT": "2019-03-04T16:07:07Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/guillaumekln>@guillaumekln</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "BigFishMaster", "commentT": "2019-03-04T17:26:49Z", "comment_text": "\n \t\tYeah looks like there is a bug. Thanks for testing and reporting, that's helpful.\n \t\t"}}}, "commit": {"commit_id": "aa1e2b2f040786a3fa87a6a8dfe93561cdcc1566", "commit_author": "Guillaume Klein", "commitT": "2019-03-05 12:56:57+01:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "20", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "opennmt\\inputters\\inputter.py", "file_new_name": "opennmt\\inputters\\inputter.py", "file_complexity": {"file_NLOC": "388", "file_CCN": "110", "file_NToken": "2666"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "457", "deleted_lines": null, "method_info": {"method_name": "build", "method_params": "self,input_shape", "method_startline": "444", "method_endline": "462", "method_complexity": {"method_NLOC": "17", "method_CCN": "8", "method_NToken": "171", "method_nesting_level": "1"}}}}}}}}