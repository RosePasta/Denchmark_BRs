{"BR": {"BR_id": "1129", "BR_author": "Nic-Ma", "BRopenT": "2020-10-22T02:54:19Z", "BRcloseT": "2020-11-06T21:13:00Z", "BR_text": {"BRsummary": "Some metrics don't handle batch and channel dims", "BRdescription": "\n Describe the bug\n Recently, we added several new medical metrics and I found some segmentation metrics don't handle batch and channel dims which are the aligned data shape in MONAI.\n Like MeanDice metric, I think we should compute segmentation metrics on [B, C, H, W, ] data and return M x N results, where M corresponding to batch dim and N corresponding to channel dim. Then compute the average value after 1 epoch.\n And it should handle both non-one-hot and one-hot labels.\n Please feel free to correct me if I misunderstand anything.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Nic-Ma", "commentT": "2020-10-22T02:55:16Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/yiheng-wang-nv>@yiheng-wang-nv</denchmark-link>\n  ,\n Could you please help double confirm and update these metrics ASAP?\n Thanks in advance.\n \t\t"}}}, "commit": {"commit_id": "97af84c1fa9986c452782949a239aa1943af61ba", "commit_author": "Yiheng Wang", "commitT": "2020-11-06 21:12:59+00:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\source\\metrics.rst", "file_new_name": "docs\\source\\metrics.rst", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "22,23,24,25", "deleted_lines": "22"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "monai\\handlers\\confusion_matrix.py", "file_new_name": "monai\\handlers\\confusion_matrix.py", "file_complexity": {"file_NLOC": "83", "file_CCN": "6", "file_NToken": "323"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "83", "deleted_lines": "77,78,79,80,82,83", "method_info": {"method_name": "__init__", "method_params": "self,bool,str,None,float,5,str,Average,MACRO,int,Callable,None", "method_startline": "75", "method_endline": "85", "method_complexity": {"method_NLOC": "11", "method_CCN": "1", "method_NToken": "94", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "73,74", "deleted_lines": "72", "method_info": {"method_name": "reset", "method_params": "self", "method_startline": "72", "method_endline": "74", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "19", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "97,98,99,100,101,102,103,104,105", "deleted_lines": "98,99", "method_info": {"method_name": "compute", "method_params": "self", "method_startline": "97", "method_endline": "105", "method_complexity": {"method_NLOC": "9", "method_CCN": "2", "method_NToken": "28", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "83,89,90,91,92,93,94", "deleted_lines": "77,78,79,80,82,83,88,89,90,91,92,93,94", "method_info": {"method_name": "update", "method_params": "self", "method_startline": "77", "method_endline": "94", "method_complexity": {"method_NLOC": "16", "method_CCN": "2", "method_NToken": "74", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "32,34,35", "deleted_lines": "30,31,32,33,34,35,36,37", "method_info": {"method_name": "__init__", "method_params": "self,bool,str,bool,bool,Callable,None", "method_startline": "30", "method_endline": "37", "method_complexity": {"method_NLOC": "8", "method_CCN": "1", "method_NToken": "48", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "monai\\handlers\\mean_dice.py", "file_new_name": "monai\\handlers\\mean_dice.py", "file_complexity": {"file_NLOC": "67", "file_CCN": "6", "file_NToken": "301"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "73,74", "deleted_lines": "63,64,65,66,67", "method_info": {"method_name": "update", "method_params": "self", "method_startline": "61", "method_endline": "78", "method_complexity": {"method_NLOC": "16", "method_CCN": "2", "method_NToken": "74", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "33,34,35,36,37", "method_info": {"method_name": "__init__", "method_params": "self,bool,bool,bool,bool,None,float,Callable,None", "method_startline": "30", "method_endline": "39", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "65", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "monai\\metrics\\__init__.py", "file_new_name": "monai\\metrics\\__init__.py", "file_complexity": {"file_NLOC": "7", "file_CCN": "0", "file_NToken": "39"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "12,18", "deleted_lines": "12,13"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "monai\\metrics\\confusion_matrix.py", "file_new_name": "monai\\metrics\\confusion_matrix.py", "file_complexity": {"file_NLOC": "216", "file_CCN": "52", "file_NToken": "1577"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "22,23,24,25,26,27,28,29,30,31", "deleted_lines": "22,25,26,27,28,29,30,31", "method_info": {"method_name": "compute_confusion_matrix", "method_params": "Tensor,Tensor,bool,str,None,float,5,str,Average,MACRO,int", "method_startline": "22", "method_endline": "31", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "84", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "112,115", "deleted_lines": null, "method_info": {"method_name": "get_confusion_matrix", "method_params": "Tensor,Tensor,bool", "method_startline": "112", "method_endline": "115", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "20", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "49,50,51,52,53,54", "deleted_lines": "49,50,51,52,53,54", "method_info": {"method_name": "__init__", "method_params": "self,bool,str,bool,bool", "method_startline": "49", "method_endline": "54", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "28", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109", "deleted_lines": "67,68,69,70,71,72,73,74,75,76,77,78,79,81,82,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106", "method_info": {"method_name": "__call__", "method_params": "self,Tensor,Tensor", "method_startline": "62", "method_endline": "109", "method_complexity": {"method_NLOC": "34", "method_CCN": "11", "method_NToken": "259", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314", "deleted_lines": null, "method_info": {"method_name": "check_confusion_matrix_metric_name", "method_params": "str", "method_startline": "265", "method_endline": "314", "method_complexity": {"method_NLOC": "39", "method_CCN": "18", "method_NToken": "243", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "168,169,170,180,181,183,184,185,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261", "deleted_lines": null, "method_info": {"method_name": "compute_confusion_matrix_metric", "method_params": "str,Tensor", "method_startline": "168", "method_endline": "262", "method_complexity": {"method_NLOC": "72", "method_CCN": "21", "method_NToken": "770", "method_nesting_level": "0"}}}}}, "file_5": {"file_change_type": "DELETE", "file_Nmethod": 0, "file_old_name": "monai\\metrics\\confusion_matrix_utils.py", "file_new_name": "None", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "monai\\metrics\\meandice.py", "file_new_name": "monai\\metrics\\meandice.py", "file_complexity": {"file_NLOC": "86", "file_CCN": "6", "file_NToken": "350"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "53,54,55,56,59,60", "deleted_lines": "55,56,57,58,59", "method_info": {"method_name": "__init__", "method_params": "self,bool,bool,bool,bool,None,float,MetricReduction,MEAN", "method_startline": "52", "method_endline": "60", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "58", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "151,152,153,154,155", "method_info": {"method_name": "compute_meandice", "method_params": "Tensor,Tensor,bool,bool,bool,bool,None,float", "method_startline": "147", "method_endline": "155", "method_complexity": {"method_NLOC": "9", "method_CCN": "1", "method_NToken": "55", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "49,53,54,55,56,59,60,62,63,64,65,66,67,68,76,77,78", "deleted_lines": "49,55,56,57,58,59,63,64,66,67,68,69,70,71,73,74,75", "method_info": {"method_name": "__call__", "method_params": "self,Tensor,Tensor", "method_startline": "49", "method_endline": "78", "method_complexity": {"method_NLOC": "15", "method_CCN": "4", "method_NToken": "111", "method_nesting_level": "1"}}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "monai\\metrics\\utils.py", "file_new_name": "monai\\metrics\\utils.py", "file_complexity": {"file_NLOC": "149", "file_CCN": "4", "file_NToken": "871"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "26,27,28", "deleted_lines": null, "method_info": {"method_name": "ignore_background", "method_params": "Tensor,Tensor", "method_startline": "26", "method_endline": "28", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "14", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "44,45,46", "deleted_lines": null, "method_info": {"method_name": "do_metric_reduction", "method_params": "Tensor,MetricReduction,MEAN", "method_startline": "44", "method_endline": "46", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "21", "method_nesting_level": "0"}}}}}, "file_8": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\test_compute_confusion_matrix.py", "file_complexity": {"file_NLOC": "278", "file_CCN": "5", "file_NToken": "3079"}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\test_compute_meandice.py", "file_new_name": "tests\\test_compute_meandice.py", "file_complexity": {"file_NLOC": "167", "file_CCN": "4", "file_NToken": "2689"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "198", "deleted_lines": null, "method_info": {"method_name": "test_nans_class", "method_params": "self,params,input_data,expected_value", "method_startline": "195", "method_endline": "199", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "51", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "191", "deleted_lines": null, "method_info": {"method_name": "test_value_class", "method_params": "self,input_data,expected_value", "method_startline": "184", "method_endline": "192", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "80", "method_nesting_level": "1"}}}}}, "file_10": {"file_change_type": "DELETE", "file_Nmethod": 0, "file_old_name": "tests\\test_compute_tnr.py", "file_new_name": "None", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_11": {"file_change_type": "DELETE", "file_Nmethod": 0, "file_old_name": "tests\\test_compute_tpr.py", "file_new_name": "None", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tests\\test_handler_confusion_matrix.py", "file_new_name": "tests\\test_handler_confusion_matrix.py", "file_complexity": {"file_NLOC": "31", "file_CCN": "2", "file_NToken": "397"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "23,24,25,26,27,28,29,30,31,32,33", "deleted_lines": "21,22,23,24,25,26,28,29,30,31,32,33", "method_info": {"method_name": "test_compute", "method_params": "self", "method_startline": "21", "method_endline": "33", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "144", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "27,28,29,30,31,32,33,34,35,36,37,38,39", "deleted_lines": "28,29,30,31,32,33", "method_info": {"method_name": "test_compute", "method_params": "self,input_params,expected_avg", "method_startline": "27", "method_endline": "39", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "167", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "42,43,44,45,46,47,48,49,50,51,52", "deleted_lines": null, "method_info": {"method_name": "test_shape_mismatch", "method_params": "self,input_params,_expected", "method_startline": "42", "method_endline": "52", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "124", "method_nesting_level": "1"}}}}}, "file_13": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\test_handler_mean_dice.py", "file_new_name": "tests\\test_handler_mean_dice.py", "file_complexity": {"file_NLOC": "31", "file_CCN": "2", "file_NToken": "373"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "43,44,45,46,47,48,49", "method_info": {"method_name": "test_misconfig", "method_params": "self,input_params", "method_startline": "43", "method_endline": "49", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "66", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "31,35", "deleted_lines": "32,36", "method_info": {"method_name": "test_compute", "method_params": "self,input_params,expected_avg", "method_startline": "27", "method_endline": "39", "method_complexity": {"method_NLOC": "10", "method_CCN": "1", "method_NToken": "167", "method_nesting_level": "1"}}}}}}}}