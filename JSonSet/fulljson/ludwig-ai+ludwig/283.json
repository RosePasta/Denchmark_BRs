{"BR": {"BR_id": "283", "BR_author": "shrinivaskallol", "BRopenT": "2019-04-11T18:55:38Z", "BRcloseT": "2019-04-12T23:30:20Z", "BR_text": {"BRsummary": "Cannot reproduce NLU example from the website", "BRdescription": "\n Describe the bug\n Cannot reproduce the Natural language understanding result with the data and the model definition file displayed on the website in Ludwig>examples>Natural language understanding\n To Reproduce\n Steps to reproduce the behavior:\n model_definition = {}\n model_definition['input_features'] = [{'name': 'utterance', 'type': 'text', 'level':'word','encoder':'rnn','cell_type': 'lstm',\n 'bidirectional': 'true','num_layers': 2,'reduce_output': 'none'}\n ]\n model_definition['output_features'] = [{'name': 'intent', 'type': 'category', 'reduce_input': 'sum',\n 'num_fc_layers': 1,'fc_size': 64},\n {'name':'slots','type':'sequence', 'decoder':'tagger'}]\n model_definition['preprocessing'] = { 'sequence': {   'fill_value': '',\n 'format': 'space',\n 'lowercase': False,\n 'missing_value_strategy': 'fill_with_const',\n 'most_common': 20000,\n 'padding': 'left',\n 'padding_symbol': '',\n 'sequence_length_limit': 256,\n 'unknown_symbol': ''},\n <denchmark-code>                                     'text': {'char_format': 'characters',\n                                      'char_most_common': 70,\n                                      'char_sequence_length_limit': 1024,\n                                      'fill_value': '',\n                                      'lowercase': True,\n                                      'missing_value_strategy': 'fill_with_const',\n                                      'padding': 'right',\n                                      'padding_symbol': '<PAD>',\n                                      'unknown_symbol': '<UNK>',\n                                      'word_format': 'space',\n                                      'word_most_common': 20000,\n                                      'word_sequence_length_limit': 256}}\n </denchmark-code>\n \n data = pd.DataFrame({'utterance': ['I want a pizza','Book a flight to Boston','Book a flight at 7pm to London'],\n 'intent': ['order_food','book_flight','book_flight'],\n 'slots':['O O O B-Food_type','O O O O B-City', 'O O O O B-Departure_time O B-City']})\n model = ludwig.LudwigModel(model_definition)\n trained_model = model.train(data_df=data, random_seed=42)\n <denchmark-h:h2>ERROR MESSAGE:</denchmark-h>\n \n InvalidArgumentError                      Traceback (most recent call last)\n ~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n 1333     try:\n -> 1334       return fn(*args)\n 1335     except errors.OpError as e:\n ~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _run_fn(feed_dict, fetch_list, target_list, options, run_metadata)\n 1318       return self._call_tf_sessionrun(\n -> 1319           options, feed_dict, fetch_list, target_list, run_metadata)\n 1320\n ~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _call_tf_sessionrun(self, options, feed_dict, fetch_list, target_list, run_metadata)\n 1406         self._session, options, feed_dict, fetch_list, target_list,\n -> 1407         run_metadata)\n 1408\n InvalidArgumentError: Paddings must be non-negative: 0 -1\n [[{{node slots/loss_slots/Pad}}]]\n During handling of the above exception, another exception occurred:\n InvalidArgumentError                      Traceback (most recent call last)\n  in \n ----> 1 trained_model = model.train(data_df=data, random_seed=42)\n ~/anaconda3/lib/python3.7/site-packages/ludwig/api.py in train(self, data_df, data_train_df, data_validation_df, data_test_df, data_csv, data_train_csv, data_validation_csv, data_test_csv, data_hdf5, data_train_hdf5, data_validation_hdf5, data_test_hdf5, train_set_metadata_json, dataset_type, model_name, model_load_path, model_resume_path, skip_save_model, skip_save_progress, skip_save_log, skip_save_processed_input, output_directory, gpus, gpu_fraction, random_seed, logging_level, debug, **kwargs)\n 516             gpu_fraction=gpu_fraction,\n 517             random_seed=random_seed,\n --> 518             debug=debug\n 519         )\n 520\n ~/anaconda3/lib/python3.7/site-packages/ludwig/train.py in train(training_set, validation_set, test_set, model_definition, save_path, model_load_path, resume, skip_save_model, skip_save_progress, skip_save_log, gpus, gpu_fraction, use_horovod, random_seed, debug)\n 428         gpus=gpus, gpu_fraction=gpu_fraction,\n 429         random_seed=random_seed,\n --> 430         **model_definition['training']\n 431     )\n 432\n ~/anaconda3/lib/python3.7/site-packages/ludwig/models/model.py in train(self, training_set, validation_set, test_set, validation_field, validation_measure, save_path, regularization_lambda, epochs, learning_rate, batch_size, eval_batch_size, bucketing_field, dropout_rate, early_stop, reduce_learning_rate_on_plateau, reduce_learning_rate_on_plateau_patience, reduce_learning_rate_on_plateau_rate, increase_batch_size_on_plateau, increase_batch_size_on_plateau_patience, increase_batch_size_on_plateau_rate, increase_batch_size_on_plateau_max, learning_rate_warmup_epochs, resume, skip_save_model, skip_save_progress, skip_save_log, gpus, gpu_fraction, random_seed, **kwargs)\n 519                         learning_rate=current_learning_rate,\n 520                         dropout_rate=dropout_rate,\n --> 521                         is_training=True\n 522                     )\n 523                 )\n ~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in run(self, fetches, feed_dict, options, run_metadata)\n 927     try:\n 928       result = self._run(None, fetches, feed_dict, options_ptr,\n --> 929                          run_metadata_ptr)\n 930       if run_metadata:\n 931         proto_data = tf_session.TF_GetBuffer(run_metadata_ptr)\n ~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _run(self, handle, fetches, feed_dict, options, run_metadata)\n 1150     if final_fetches or final_targets or (handle and feed_dict_tensor):\n 1151       results = self._do_run(handle, final_targets, final_fetches,\n -> 1152                              feed_dict_tensor, options, run_metadata)\n 1153     else:\n 1154       results = []\n ~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _do_run(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)\n 1326     if handle is None:\n 1327       return self._do_call(_run_fn, feeds, fetches, targets, options,\n -> 1328                            run_metadata)\n 1329     else:\n 1330       return self._do_call(_prun_fn, handle, feeds, fetches)\n ~/anaconda3/lib/python3.7/site-packages/tensorflow/python/client/session.py in _do_call(self, fn, *args)\n 1346           pass\n 1347       message = error_interpolation.interpolate(message, self._graph)\n -> 1348       raise type(e)(node_def, op, message)\n 1349\n 1350   def _extend_graph(self):\n InvalidArgumentError: Paddings must be non-negative: 0 -1\n [[node slots/loss_slots/Pad (defined at /Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/modules/loss_modules.py:66) ]]\n Caused by op 'slots/loss_slots/Pad', defined at:\n File \"/Users/shrinivas/anaconda3/lib/python3.7/runpy.py\", line 193, in _run_module_as_main\n \"main\", mod_spec)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/runpy.py\", line 85, in _run_code\n exec(code, run_globals)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py\", line 16, in \n app.launch_new_instance()\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/traitlets/config/application.py\", line 658, in launch_instance\n app.start()\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/kernelapp.py\", line 505, in start\n self.io_loop.start()\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/platform/asyncio.py\", line 132, in start\n self.asyncio_loop.run_forever()\n File \"/Users/shrinivas/anaconda3/lib/python3.7/asyncio/base_events.py\", line 528, in run_forever\n self._run_once()\n File \"/Users/shrinivas/anaconda3/lib/python3.7/asyncio/base_events.py\", line 1764, in _run_once\n handle._run()\n File \"/Users/shrinivas/anaconda3/lib/python3.7/asyncio/events.py\", line 88, in _run\n self._context.run(self._callback, *self._args)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/ioloop.py\", line 758, in _run_callback\n ret = callback()\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/stack_context.py\", line 300, in null_wrapper\n return fn(*args, **kwargs)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/gen.py\", line 1233, in inner\n self.run()\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/gen.py\", line 1147, in run\n yielded = self.gen.send(value)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/kernelbase.py\", line 357, in process_one\n yield gen.maybe_future(dispatch(*args))\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/gen.py\", line 326, in wrapper\n yielded = next(result)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/kernelbase.py\", line 267, in dispatch_shell\n yield gen.maybe_future(handler(stream, idents, msg))\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/gen.py\", line 326, in wrapper\n yielded = next(result)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/kernelbase.py\", line 534, in execute_request\n user_expressions, allow_stdin,\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tornado/gen.py\", line 326, in wrapper\n yielded = next(result)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/ipkernel.py\", line 294, in do_execute\n res = shell.run_cell(code, store_history=store_history, silent=silent)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ipykernel/zmqshell.py\", line 536, in run_cell\n return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 2819, in run_cell\n raw_cell, store_history, silent, shell_futures)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 2845, in _run_cell\n return runner(coro)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/async_helpers.py\", line 67, in _pseudo_sync_runner\n coro.send(None)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 3020, in run_cell_async\n interactivity=interactivity, compiler=compiler, result=result)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 3185, in run_ast_nodes\n if (yield from self.run_code(code, result)):\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 3267, in run_code\n exec(code_obj, self.user_global_ns, self.user_ns)\n File \"\", line 1, in \n trained_model = model.train(data_df=data, random_seed=42)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/api.py\", line 518, in train\n debug=debug\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/train.py\", line 413, in train\n debug=debug\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/model.py\", line 109, in init\n **kwargs\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/model.py\", line 183, in __build\n is_training=self.is_training\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/outputs.py\", line 43, in build_outputs\n **kwargs\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/outputs.py\", line 93, in build_single_output\n **kwargs\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/features/base_feature.py\", line 314, in concat_dependencies_and_build_output\n **kwargs\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/features/sequence_feature.py\", line 250, in build_output\n kwarg=kwargs\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/features/sequence_feature.py\", line 299, in build_sequence_output\n class_biases\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/features/sequence_feature.py\", line 497, in sequence_loss\n eval_logits\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/modules/loss_modules.py\", line 66, in seq2seq_sequence_loss\n padded_logits = tf.pad(logits, [[0, 0], [0, difference], [0, 0]])\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/array_ops.py\", line 2299, in pad\n result = gen_array_ops.pad(tensor, paddings, name=name)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/gen_array_ops.py\", line 5539, in pad\n \"Pad\", input=input, paddings=paddings, name=name)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/framework/op_def_library.py\", line 788, in _apply_op_helper\n op_def=op_def)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/util/deprecation.py\", line 507, in new_func\n return func(*args, **kwargs)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/framework/ops.py\", line 3300, in create_op\n op_def=op_def)\n File \"/Users/shrinivas/anaconda3/lib/python3.7/site-packages/tensorflow/python/framework/ops.py\", line 1801, in init\n self._traceback = tf_stack.extract_stack()\n InvalidArgumentError (see above for traceback): Paddings must be non-negative: 0 -1\n [[node slots/loss_slots/Pad (defined at /Users/shrinivas/anaconda3/lib/python3.7/site-packages/ludwig/models/modules/loss_modules.py:66) ]]\n Expected behavior\n trained model and multivariate prediction\n Screenshots\n If applicable, add screenshots to help explain your problem.\n Environment (please complete the following information):\n \n OS: [e.g. iOS]\n Version [e.g. 22]\n Python version 3.7.1\n Ludwig version 0.1.1\n \n Additional context\n Add any other context about the problem here.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "shrinivaskallol", "commentT": "2019-04-12T23:30:20Z", "comment_text": "\n \t\tThanks for providing this. I pushed a commit that solves the issue (the `word_format was not used, english_tokenizer was used instead). Closing this, feel free to comment again if the error persists.\n \t\t"}}}, "commit": {"commit_id": "e6c0dd201d369a5097b09e6a6b11db606d693c96", "commit_author": "piero", "commitT": "2019-04-12 16:28:23-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "ludwig\\features\\text_feature.py", "file_new_name": "ludwig\\features\\text_feature.py", "file_complexity": {"file_NLOC": "452", "file_CCN": "19", "file_NToken": "2273"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "58", "deleted_lines": "58,59", "method_info": {"method_name": "feature_meta", "method_params": "column,most_common_characters,most_common_words,lowercase", "method_startline": "58", "method_endline": "59", "method_complexity": {"method_NLOC": "2", "method_CCN": "1", "method_NToken": "11", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "95", "deleted_lines": "96,97,98,99", "method_info": {"method_name": "get_feature_meta", "method_params": "column,preprocessing_parameters", "method_startline": "93", "method_endline": "126", "method_complexity": {"method_NLOC": "34", "method_CCN": "1", "method_NToken": "106", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "58,67,68,77,78,79", "deleted_lines": "58,59,68,69,78,79,80", "method_info": {"method_name": "feature_meta", "method_params": "column,preprocessing_parameters", "method_startline": "58", "method_endline": "90", "method_complexity": {"method_NLOC": "33", "method_CCN": "1", "method_NToken": "88", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ludwig\\models\\modules\\loss_modules.py", "file_new_name": "ludwig\\models\\modules\\loss_modules.py", "file_complexity": {"file_NLOC": "244", "file_CCN": "12", "file_NToken": "1572"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "65,67", "deleted_lines": "65"}}}}}}