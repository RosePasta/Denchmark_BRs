{"BR": {"BR_id": "1009", "BR_author": "mangleddata", "BRopenT": "2020-11-16T04:40:05Z", "BRcloseT": "2020-11-16T21:56:16Z", "BR_text": {"BRsummary": "Preload fails with ludwig", "BRdescription": "\n I am using ludwig on cpu only mode on multicore system. I run as below\n horovodrun -np 24 -H localhost:24 --binding-args=\"-bind-to socket -map-by socket\" ludwig train --training_set train.csv --validation_set valid.csv --random_seed 42 -cf ${MODELFILE} --model_name ${MODELNAME}\n Now I am trying to preload the model file for a different run (all else being the same. Infact, exact same data file even).\n horovodrun -np 24 -H localhost:24 --binding-args=\"-bind-to socket -map-by socket\" ludwig train --training_set train.csv --validation_set valid.csv --random_seed 42 -cf ${MODELFILE} --model_name ${MODELNAME} -mlp results/experiment_train_model/model\n I am assuming this is the correct way to make multicore (otherwise ludwig just runs on single core)\n It fails with error\n <denchmark-code>[1,2]<stderr>:    \"Intra op parallelism cannot be modified after initialization.\")\n [1,2]<stderr>:RuntimeError: Intra op parallelism cannot be modified after initialization.\n </denchmark-code>\n \n Any idea why preload fails ?\n Will build a reproducer if needed, but want to eliminative trivial issues if I am missing something.\n \n OS:  18.04.1-Ubuntu\n Python version 3.7.6\n Ludwig version\n Tensorflow 2.3.1\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "mangleddata", "commentT": "2020-11-16T18:11:49Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/mangleddata>@mangleddata</denchmark-link>\n , thanks for reporting this.  This does look like a bug on our side when specifying the .  The root of the problem, I suspect, is that we are not plumbing the parameters <denchmark-link:https://github.com/uber/ludwig/blob/master/ludwig/train.py#L162>here</denchmark-link>\n , resulting in attempts to initialize TensorFlow with different parameters.  I'll take a look at this today.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "mangleddata", "commentT": "2020-11-16T19:57:57Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/mangleddata>@mangleddata</denchmark-link>\n , can you try <denchmark-link:https://github.com/ludwig-ai/ludwig/pull/1011>#1011</denchmark-link>\n  and let me know if it addresses your issue?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "mangleddata", "commentT": "2020-11-28T05:38:26Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/tgaddair>@tgaddair</denchmark-link>\n  Thanks for fixing it. I am able to preload now.\n \t\t"}}}, "commit": {"commit_id": "1c6c1a34727c620a6d419b9cfb67637371f79617", "commit_author": "Travis Addair", "commitT": "2020-11-16 13:56:15-08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ludwig\\api.py", "file_new_name": "ludwig\\api.py", "file_complexity": {"file_NLOC": "1562", "file_CCN": "22", "file_NToken": "4345"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1295,1296,1298,1299", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ludwig\\train.py", "file_new_name": "ludwig\\train.py", "file_complexity": {"file_NLOC": "367", "file_CCN": "3", "file_NToken": "1077"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "162,163,164,165,166,167,168,169", "deleted_lines": "162"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "tests\\integration_tests\\test_cli.py", "file_new_name": "tests\\integration_tests\\test_cli.py", "file_complexity": {"file_NLOC": "294", "file_CCN": "27", "file_NToken": "1626"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173", "deleted_lines": null, "method_info": {"method_name": "test_train_cli_horovod", "method_params": "csv_filename", "method_startline": "149", "method_endline": "173", "method_complexity": {"method_NLOC": "22", "method_CCN": "1", "method_NToken": "88", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "50,51,52", "deleted_lines": null, "method_info": {"method_name": "_run_ludwig_horovod", "method_params": "command,ludwig_kwargs", "method_startline": "50", "method_endline": "52", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "29", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "45,46,47", "deleted_lines": null, "method_info": {"method_name": "_run_ludwig", "method_params": "command,ludwig_kwargs", "method_startline": "45", "method_endline": "47", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "23", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "31,36,37", "deleted_lines": "31,32,37", "method_info": {"method_name": "_run_commands", "method_params": "commands,ludwig_kwargs", "method_startline": "31", "method_endline": "42", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "76", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "308,316,318,331,333", "deleted_lines": "293,295", "method_info": {"method_name": "test_collect_summary_activations_weights_cli", "method_params": "csv_filename", "method_startline": "291", "method_endline": "356", "method_complexity": {"method_NLOC": "50", "method_CCN": "9", "method_NToken": "324", "method_nesting_level": "0"}}}}}}}}