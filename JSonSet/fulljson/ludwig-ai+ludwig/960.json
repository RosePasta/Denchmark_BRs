{"BR": {"BR_id": "960", "BR_author": "brightsparc", "BRopenT": "2020-10-19T03:22:28Z", "BRcloseT": "2020-11-04T20:35:10Z", "BR_text": {"BRsummary": "Save SavedModel fails for SetInputFeature", "BRdescription": "\n Describe the bug\n Error when attempting to call save_savedmodel for a model that containers a set property.  See error:\n <denchmark-code>2020-10-19 03:06:47.001119: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version\n Traceback (most recent call last):\n   File \"train.py\", line 78, in <module>\n     train(args)\n   File \"train.py\", line 41, in train\n     ludwig_model.save_savedmodel(args.model_dir)\n   File \"/usr/local/lib/python3.6/dist-packages/ludwig/api.py\", line 1445, in save_savedmodel\n     self.model.save_savedmodel(save_path)\n   File \"/usr/local/lib/python3.6/dist-packages/ludwig/models/ecd.py\", line 82, in save_savedmodel\n     keras_model = self.get_connected_model(training=False)\n   File \"/usr/local/lib/python3.6/dist-packages/ludwig/models/ecd.py\", line 77, in get_connected_model\n     inputs = inputs or self.get_model_inputs(training)\n   File \"/usr/local/lib/python3.6/dist-packages/ludwig/models/ecd.py\", line 63, in get_model_inputs\n     self.input_features.items()\n   File \"/usr/local/lib/python3.6/dist-packages/ludwig/models/ecd.py\", line 62, in <dictcomp>\n     for input_feature_name, input_feature in\n   File \"/usr/local/lib/python3.6/dist-packages/ludwig/features/base_feature.py\", line 70, in create_input\n     return tf.keras.Input(shape=self.get_input_shape(),\n   File \"/usr/local/lib/python3.6/dist-packages/ludwig/features/set_feature.py\", line 127, in get_input_shape\n     return len(self.vocab),\n AttributeError: 'SetInputFeature' object has no attribute 'vocab'\n </denchmark-code>\n \n <denchmark-link:https://github.com/uber/ludwig/blob/master/ludwig/features/set_feature.py#L127>https://github.com/uber/ludwig/blob/master/ludwig/features/set_feature.py#L127</denchmark-link>\n \n To Reproduce\n Create a model definition with a set property - in my case I had two set properties for a regression output.\n <denchmark-code>preprocessing:\n     text:\n         most_common_word: 10000\n input_features:\n # set features\n     -   name: base_colour\n         type: set\n     -   name: manufacturer_colour\n         type: set\n # more features...\n # regression output\n output_features:\n     -   name: days_online\n         type: numerical\n </denchmark-code>\n \n Sample dataset for the three fields above:\n <denchmark-code>days_online,base_colour,manufacturer_colour\n 14,white,white\n 8,meteor grey,\n 4,brown,\n 11,white,\n 44,white,fuji white\n </denchmark-code>\n \n Expected behavior\n Expected to be able to create the tensorflow model.\n Environment (please complete the following information):\n \n OS: Ubuntu\n Version: 18.04.3 LTS\n Python: 3.6.9\n Ludwig version:  master (commit hash ab9bb7c) ~0.3\n TF version: tensorflow:2.3.0-gpu\n \n Additional context\n I was testing this so that I could produce the the TF pb file for visualizing the TF graph in tensorboard as I wasn't able to do this with just the checkpoint and logs.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "brightsparc", "commentT": "2020-10-19T22:37:25Z", "comment_text": "\n \t\tThanks for reporting this, looking into it.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "brightsparc", "commentT": "2020-10-20T00:27:33Z", "comment_text": "\n \t\tI confirm I was able to reproduce.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "brightsparc", "commentT": "2020-11-04T03:56:17Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/brightsparc>@brightsparc</denchmark-link>\n , can you try running with <denchmark-link:https://github.com/ludwig-ai/ludwig/pull/980>#980</denchmark-link>\n  and let us know if it addresses the issue for you?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "brightsparc", "commentT": "2020-11-04T20:37:21Z", "comment_text": "\n \t\tMerged the PR, which automatically closed the issue. <denchmark-link:https://github.com/brightsparc>@brightsparc</denchmark-link>\n  if you are still experiencing it we can reopen it.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "brightsparc", "commentT": "2020-11-18T04:39:15Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/tgaddair>@tgaddair</denchmark-link>\n  confirming this fix is working.\n \t\t"}}}, "commit": {"commit_id": "b55aa92277941e717c8ed01dac8853e01517664c", "commit_author": "Piero Molino", "commitT": "2020-11-04 12:35:10-08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ludwig\\decoders\\sequence_decoders.py", "file_new_name": "ludwig\\decoders\\sequence_decoders.py", "file_complexity": {"file_NLOC": "582", "file_CCN": "40", "file_NToken": "3197"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "290", "deleted_lines": "290"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ludwig\\features\\bag_feature.py", "file_new_name": "ludwig\\features\\bag_feature.py", "file_complexity": {"file_NLOC": "97", "file_CCN": "11", "file_NToken": "503"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "96", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ludwig\\features\\sequence_feature.py", "file_new_name": "ludwig\\features\\sequence_feature.py", "file_complexity": {"file_NLOC": "442", "file_CCN": "33", "file_NToken": "2535"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "250", "deleted_lines": "250"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ludwig\\features\\set_feature.py", "file_new_name": "ludwig\\features\\set_feature.py", "file_complexity": {"file_NLOC": "236", "file_CCN": "22", "file_NToken": "1232"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "105", "deleted_lines": null}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ludwig\\features\\vector_feature.py", "file_new_name": "ludwig\\features\\vector_feature.py", "file_complexity": {"file_NLOC": "225", "file_CCN": "24", "file_NToken": "1158"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "102", "deleted_lines": null}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\integration_tests\\test_savedmodel.py", "file_new_name": "tests\\integration_tests\\test_savedmodel.py", "file_complexity": {"file_NLOC": "136", "file_CCN": "7", "file_NToken": "855"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220", "deleted_lines": "37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182", "method_info": {"method_name": "test_savedmodel", "method_params": "csv_filename,should_load_model", "method_startline": "37", "method_endline": "220", "method_complexity": {"method_NLOC": "119", "method_CCN": "7", "method_NToken": "750", "method_nesting_level": "0"}}}}}}}}