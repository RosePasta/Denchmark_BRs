{"BR": {"BR_id": "1040", "BR_author": "michaelbzhu", "BRopenT": "2020-12-04T06:39:51Z", "BRcloseT": "2020-12-06T19:52:51Z", "BR_text": {"BRsummary": "Hyperopt: Category feature preprocessing in hyperopt raising Attribute Error", "BRdescription": "\n So I'm running hyperopt() with the following arguments\n <denchmark-code>hyperopt(\n     config=config,\n     training_set=train_data,\n     validation_set=validation_data,\n     test_set=test_data,\n     skip_save_progress=True,\n     skip_save_model=True,\n     skip_save_processed_input=True\n )\n </denchmark-code>\n \n and I'm getting a AttributeError: 'int' object has no attribute 'strip' during the data preprocessing step\n <denchmark-code>---------------------------------------------------------------------------\n AttributeError                            Traceback (most recent call last)\n <ipython-input-13-c2e6c8f1ae7c> in <module>()\n      10     skip_save_progress=True,\n      11     skip_save_model=False,\n ---> 12     skip_save_processed_input=True\n      13 )\n /usr/local/lib/python3.6/dist-packages/ludwig/hyperopt/run.py in hyperopt(config, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, experiment_name, model_name, skip_save_training_description, skip_save_training_statistics, skip_save_model, skip_save_progress, skip_save_log, skip_save_processed_input, skip_save_unprocessed_output, skip_save_predictions, skip_save_eval_stats, skip_save_hyperopt_statistics, output_directory, gpus, gpu_memory_limit, allow_parallel_threads, use_horovod, random_seed, debug, **kwargs)\n     289         random_seed=random_seed,\n     290         debug=debug,\n --> 291         **kwargs\n     292     )\n     293 \n /usr/local/lib/python3.6/dist-packages/ludwig/hyperopt/execution.py in execute(self, config, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, experiment_name, model_name, skip_save_training_description, skip_save_training_statistics, skip_save_model, skip_save_progress, skip_save_log, skip_save_processed_input, skip_save_unprocessed_output, skip_save_predictions, skip_save_eval_stats, output_directory, gpus, gpu_memory_limit, allow_parallel_threads, use_horovod, random_seed, debug, **kwargs)\n     149                     skip_collect_overall_stats=False,\n     150                     random_seed=random_seed,\n --> 151                     debug=debug,\n     152                 )\n     153                 metric_score = self.get_metric_score(eval_stats)\n /usr/local/lib/python3.6/dist-packages/ludwig/api.py in experiment(self, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, experiment_name, model_name, model_load_path, model_resume_path, eval_split, skip_save_training_description, skip_save_training_statistics, skip_save_model, skip_save_progress, skip_save_log, skip_save_processed_input, skip_save_unprocessed_output, skip_save_predictions, skip_save_eval_stats, skip_collect_predictions, skip_collect_overall_stats, output_directory, random_seed, debug, **kwargs)\n    1054             output_directory=output_directory,\n    1055             random_seed=random_seed,\n -> 1056             debug=debug,\n    1057         )\n    1058 \n /usr/local/lib/python3.6/dist-packages/ludwig/api.py in train(self, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, experiment_name, model_name, model_resume_path, skip_save_training_description, skip_save_training_statistics, skip_save_model, skip_save_progress, skip_save_log, skip_save_processed_input, output_directory, random_seed, debug, **kwargs)\n     415                     random_seed=random_seed,\n     416                     devbug=debug,\n --> 417                     **kwargs,\n     418                 )\n     419                 (training_set,\n /usr/local/lib/python3.6/dist-packages/ludwig/api.py in preprocess(self, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, skip_save_processed_input, random_seed, debug, **kwargs)\n    1261             preprocessing_params=self.config[PREPROCESSING],\n    1262             backend=self.backend,\n -> 1263             random_seed=random_seed\n    1264         )\n    1265 \n /usr/local/lib/python3.6/dist-packages/ludwig/data/preprocessing.py in preprocess_for_training(config, dataset, training_set, validation_set, test_set, training_set_metadata, data_format, skip_save_processed_input, preprocessing_params, backend, random_seed)\n    1395         preprocessing_params=preprocessing_params,\n    1396         backend=backend,\n -> 1397         random_seed=random_seed\n    1398     )\n    1399     training_set, test_set, validation_set, training_set_metadata = processed\n /usr/local/lib/python3.6/dist-packages/ludwig/data/preprocessing.py in preprocess_for_training(features, dataset, training_set, validation_set, test_set, training_set_metadata, skip_save_processed_input, preprocessing_params, backend, random_seed)\n     183             preprocessing_params=preprocessing_params,\n     184             backend=backend,\n --> 185             random_seed=random_seed\n     186         )\n     187 \n /usr/local/lib/python3.6/dist-packages/ludwig/data/preprocessing.py in _preprocess_df_for_training(features, dataset, training_set, validation_set, test_set, training_set_metadata, preprocessing_params, backend, random_seed)\n    1645         metadata=training_set_metadata,\n    1646         random_seed=random_seed,\n -> 1647         backend=backend\n    1648     )\n    1649 \n /usr/local/lib/python3.6/dist-packages/ludwig/data/preprocessing.py in build_dataset(dataset_df, features, global_preprocessing_parameters, metadata, backend, random_seed)\n    1013             features,\n    1014             global_preprocessing_parameters,\n -> 1015             backend\n    1016         )\n    1017 \n /usr/local/lib/python3.6/dist-packages/ludwig/data/preprocessing.py in build_metadata(dataset_df, features, global_preprocessing_parameters, backend)\n    1122                 column,\n    1123                 preprocessing_parameters,\n -> 1124                 backend\n    1125             )\n    1126 \n /usr/local/lib/python3.6/dist-packages/ludwig/features/category_feature.py in get_feature_meta(column, preprocessing_parameters, backend)\n      65             lowercase=preprocessing_parameters['lowercase'],\n      66             add_padding=False,\n ---> 67             processor=backend.df_engine\n      68         )\n      69         return {\n /usr/local/lib/python3.6/dist-packages/ludwig/utils/strings_utils.py in create_vocabulary(data, tokenizer_type, add_unknown, add_padding, lowercase, num_most_frequent, vocab_file, unknown_symbol, padding_symbol, pretrained_model_name_or_path, processor)\n     139         vocab = load_vocabulary(vocab_file)\n     140 \n --> 141     processed_lines = data.map(lambda line: tokenizer(line.lower() if lowercase else line))\n     142     processed_counts = processed_lines.explode().value_counts(sort=False)\n     143     processed_counts = processor.compute(processed_counts)\n /usr/local/lib/python3.6/dist-packages/pandas/core/series.py in map(self, arg, na_action)\n    3980         dtype: object\n    3981         \"\"\"\n -> 3982         new_values = super()._map_values(arg, na_action=na_action)\n    3983         return self._constructor(new_values, index=self.index).__finalize__(\n    3984             self, method=\"map\"\n /usr/local/lib/python3.6/dist-packages/pandas/core/base.py in _map_values(self, mapper, na_action)\n    1158 \n    1159         # mapper is a function\n -> 1160         new_values = map_f(values, mapper)\n    1161 \n    1162         return new_values\n pandas/_libs/lib.pyx in pandas._libs.lib.map_infer()\n /usr/local/lib/python3.6/dist-packages/ludwig/utils/strings_utils.py in <lambda>(line)\n     139         vocab = load_vocabulary(vocab_file)\n     140 \n --> 141     processed_lines = data.map(lambda line: tokenizer(line.lower() if lowercase else line))\n     142     processed_counts = processed_lines.explode().value_counts(sort=False)\n     143     processed_counts = processor.compute(processed_counts)\n /usr/local/lib/python3.6/dist-packages/ludwig/utils/strings_utils.py in __call__(self, text)\n     305 class StrippedStringToListTokenizer(BaseTokenizer):\n     306     def __call__(self, text):\n --> 307         return [text.strip()]\n     308 \n     309 \n AttributeError: 'int' object has no attribute 'strip'\n </denchmark-code>\n \n Environment :\n \n Run on Google Colab\n Python version: 3.6\n Ludwig version: Using ludwig from github repo up to commit fcb01e3\n \n Seems like this is related to the recent commits (on Dec 3, 2020) as this bug hasn't happened before\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "michaelbzhu", "commentT": "2020-12-05T06:54:47Z", "comment_text": "\n \t\tThis is probably related to a change made in <denchmark-link:https://github.com/ludwig-ai/ludwig/pull/1038>#1038</denchmark-link>\n  that changes the data type casting during preprocessing.  I'll take a look.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "michaelbzhu", "commentT": "2020-12-05T17:38:45Z", "comment_text": "\n \t\tHey <denchmark-link:https://github.com/michaelbzhu>@michaelbzhu</denchmark-link>\n , can you try <denchmark-link:https://github.com/ludwig-ai/ludwig/pull/1042>#1042</denchmark-link>\n  and let me know if it solves your issue?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "michaelbzhu", "commentT": "2020-12-06T03:18:45Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/tgaddair>@tgaddair</denchmark-link>\n  yeah it's working now when I use <denchmark-link:https://github.com/ludwig-ai/ludwig/pull/1042>#1042</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "michaelbzhu", "commentT": "2020-12-06T19:53:23Z", "comment_text": "\n \t\tMerged ;)\n \t\t"}}}, "commit": {"commit_id": "13c35ec79f930e7dac295e642d92abe82f8c8046", "commit_author": "Travis Addair", "commitT": "2020-12-06 11:52:50-08:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "ludwig\\features\\bag_feature.py", "file_new_name": "ludwig\\features\\bag_feature.py", "file_complexity": {"file_NLOC": "102", "file_CCN": "12", "file_NToken": "543"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "50", "deleted_lines": null, "method_info": {"method_name": "get_feature_meta", "method_params": "column,preprocessing_parameters,backend", "method_startline": "49", "method_endline": "64", "method_complexity": {"method_NLOC": "16", "method_CCN": "1", "method_NToken": "86", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "ludwig\\features\\category_feature.py", "file_new_name": "ludwig\\features\\category_feature.py", "file_complexity": {"file_NLOC": "427", "file_CCN": "31", "file_NToken": "2095"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "62", "deleted_lines": null, "method_info": {"method_name": "get_feature_meta", "method_params": "column,preprocessing_parameters,backend", "method_startline": "61", "method_endline": "75", "method_complexity": {"method_NLOC": "15", "method_CCN": "1", "method_NToken": "82", "method_nesting_level": "1"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "ludwig\\features\\sequence_feature.py", "file_new_name": "ludwig\\features\\sequence_feature.py", "file_complexity": {"file_NLOC": "454", "file_CCN": "34", "file_NToken": "2586"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "76", "deleted_lines": null, "method_info": {"method_name": "get_feature_meta", "method_params": "column,preprocessing_parameters,backend", "method_startline": "75", "method_endline": "96", "method_complexity": {"method_NLOC": "22", "method_CCN": "1", "method_NToken": "117", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "ludwig\\features\\set_feature.py", "file_new_name": "ludwig\\features\\set_feature.py", "file_complexity": {"file_NLOC": "277", "file_CCN": "23", "file_NToken": "1455"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "55", "deleted_lines": null, "method_info": {"method_name": "get_feature_meta", "method_params": "column,preprocessing_parameters,backend", "method_startline": "54", "method_endline": "69", "method_complexity": {"method_NLOC": "16", "method_CCN": "1", "method_NToken": "85", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "ludwig\\features\\text_feature.py", "file_new_name": "ludwig\\features\\text_feature.py", "file_complexity": {"file_NLOC": "441", "file_CCN": "25", "file_NToken": "2187"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "124", "deleted_lines": null, "method_info": {"method_name": "get_feature_meta", "method_params": "column,preprocessing_parameters,backend", "method_startline": "123", "method_endline": "169", "method_complexity": {"method_NLOC": "47", "method_CCN": "1", "method_NToken": "156", "method_nesting_level": "1"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "ludwig\\features\\timeseries_feature.py", "file_new_name": "ludwig\\features\\timeseries_feature.py", "file_complexity": {"file_NLOC": "159", "file_CCN": "16", "file_NToken": "741"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "51", "deleted_lines": null, "method_info": {"method_name": "get_feature_meta", "method_params": "column,preprocessing_parameters,backend", "method_startline": "50", "method_endline": "65", "method_complexity": {"method_NLOC": "15", "method_CCN": "2", "method_NToken": "72", "method_nesting_level": "1"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\integration_tests\\test_simple_features.py", "file_new_name": "tests\\integration_tests\\test_simple_features.py", "file_complexity": {"file_NLOC": "151", "file_CCN": "7", "file_NToken": "800"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205", "deleted_lines": null, "method_info": {"method_name": "test_category_int_dtype", "method_params": "tmpdir", "method_startline": "190", "method_endline": "205", "method_complexity": {"method_NLOC": "13", "method_CCN": "2", "method_NToken": "116", "method_nesting_level": "0"}}}}}}}}