{"BR": {"BR_id": "1130", "BR_author": "vfdev-5", "BRopenT": "2020-06-15T09:43:31Z", "BRcloseT": "2020-06-21T19:39:24Z", "BR_text": {"BRsummary": "Auto dataloader - ValueError: batch_size should be a positive integer value, but got batch_size=0", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug description</denchmark-h>\n \n The following code will brake if batch_size is smaller than world size :\n import torch\n import ignite.distributed as idist\n \n def foo(i):\n     data = torch.arange(100).reshape(25, 4)\n     data_loader = idist.auto_dataloader(data, batch_size=6, num_workers=12)\n \n \n if __name__ == \"__main__\":\n     idist.spawn(\"gloo\", foo, args=(), nproc_per_node=8)    \n <denchmark-code>ValueError: batch_size should be a positive integer value, but got batch_size=0\n </denchmark-code>\n \n A fix can be:\n \n keep batch size as provided if smaller than world size\n same for num_workers\n \n <denchmark-h:h2>Environment</denchmark-h>\n \n \n PyTorch Version (e.g., 1.4): 1.5.0\n Ignite Version (e.g., 0.3.0): master\n OS (e.g., Linux): linux\n How you installed Ignite (conda, pip, source):\n Python version: 3.7\n Any other relevant information:\n \n <denchmark-link:https://github.com/InCogNiTo124>@InCogNiTo124</denchmark-link>\n  would you like to fix this as you recently played around  ?\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "vfdev-5", "commentT": "2020-06-15T12:23:09Z", "comment_text": "\n \t\tSure, I will look into it sometime this week. Is there a deadline I should know of?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "vfdev-5", "commentT": "2020-06-15T12:27:46Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/InCogNiTo124>@InCogNiTo124</denchmark-link>\n  thanks! I'd say sooner is better. Let's say to have it done before this friday. Anyway, no worries about if you haven't time for that. If it becomes urgent, we'll do it :)\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "vfdev-5", "commentT": "2020-06-15T12:29:17Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/vfdev-5>@vfdev-5</denchmark-link>\n  alright, I'll let you know if I can't fix it by then :)\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "vfdev-5", "commentT": "2020-06-17T11:47:07Z", "comment_text": "\n \t\tI think I know the source of the bug, the world_size in this example is 8, but batch_size is 6, so ignite/distributed/auto.py:L68 makes it 0.\n \n A fix cant be:\n \n <denchmark-link:https://github.com/vfdev-5>@vfdev-5</denchmark-link>\n  I'm not sure if this is a typo or not\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "vfdev-5", "commentT": "2020-06-17T11:54:27Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/InCogNiTo124>@InCogNiTo124</denchmark-link>\n  yes, you are correct about that: 6 // 8 = 0\n \n \n A fix cant be:\n \n \n \n @vfdev-5 I'm not sure if this is a typo or not\n \n And yes, it is a typo. I fixed it.\n \t\t"}}}, "commit": {"commit_id": "676890b1d99a25ff3eb4d8746b7332ffeddf2e6b", "commit_author": "Marijan Smetko", "commitT": "2020-06-21 21:39:23+02:00", "commit_complexity": {"commit_NLOC": "0.3333333333333333", "commit_CCN": "0.3333333333333333", "commit_Nprams": "0.3333333333333333"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "ignite\\distributed\\auto.py", "file_new_name": "ignite\\distributed\\auto.py", "file_complexity": {"file_NLOC": "182", "file_CCN": "37", "file_NToken": "1007"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "24,25,67,70,71", "deleted_lines": "24,25,66,68,71,72", "method_info": {"method_name": "auto_dataloader", "method_params": "dataset,kwargs", "method_startline": "18", "method_endline": "121", "method_complexity": {"method_NLOC": "47", "method_CCN": "16", "method_NToken": "338", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "tests\\ignite\\distributed\\test_auto.py", "file_new_name": "tests\\ignite\\distributed\\test_auto.py", "file_complexity": {"file_NLOC": "125", "file_CCN": "32", "file_NToken": "1125"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "80,81,82", "deleted_lines": "83,84", "method_info": {"method_name": "test_auto_methods_no_dist", "method_params": "", "method_startline": "78", "method_endline": "84", "method_complexity": {"method_NLOC": "5", "method_CCN": "1", "method_NToken": "48", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "129,130,131", "deleted_lines": "118,119", "method_info": {"method_name": "_test_auto_methods_xla", "method_params": "index,ws", "method_startline": "114", "method_endline": "134", "method_complexity": {"method_NLOC": "15", "method_CCN": "3", "method_NToken": "114", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "106,107,108", "deleted_lines": null, "method_info": {"method_name": "test_auto_methods_nccl", "method_params": "distributed_context_single_node_nccl", "method_startline": "102", "method_endline": "111", "method_complexity": {"method_NLOC": "8", "method_CCN": "1", "method_NToken": "76", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "15,28,29,30,35,36,37,38,39,40,41,42", "deleted_lines": "15,28,34,35", "method_info": {"method_name": "_test_auto_dataloader", "method_params": "ws,nproc,sampler_name,dl_type", "method_startline": "15", "method_endline": "43", "method_complexity": {"method_NLOC": "23", "method_CCN": "8", "method_NToken": "213", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "92,93,94", "deleted_lines": "96", "method_info": {"method_name": "test_auto_methods_gloo", "method_params": "distributed_context_single_node_gloo", "method_startline": "89", "method_endline": "96", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "67", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "15,28,29,30,35,36,37,38,39,40,41,42", "deleted_lines": "15,28,34,35", "method_info": {"method_name": "_test_auto_dataloader", "method_params": "ws,nproc,batch_size,num_workers,sampler_name,dl_type", "method_startline": "15", "method_endline": "51", "method_complexity": {"method_NLOC": "31", "method_CCN": "10", "method_NToken": "245", "method_nesting_level": "0"}}}}}}}}