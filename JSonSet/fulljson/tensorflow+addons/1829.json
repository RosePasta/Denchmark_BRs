{"BR": {"BR_id": "1829", "BR_author": "WindQAQ", "BRopenT": "2020-05-13T20:01:15Z", "BRcloseT": "2020-05-14T00:20:24Z", "BR_text": {"BRsummary": "tfa.image.equalize is not compatible with tf.data.Dataset", "BRdescription": "\n System information\n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): colab\n TensorFlow version and how it was installed (source or binary): 2.2.0\n TensorFlow-Addons version and how it was installed (source or binary): tfa-nightly\n Python version: 3.6\n Is GPU used? (yes/no): no\n \n Describe the bug\n The error raises if using tfa.image.equalize with tf.data.Dataset. The error is either\n <denchmark-code>OperatorNotAllowedInGraphError: using a `tf.Tensor` as a Python `bool` is not allowed in Graph execution\n </denchmark-code>\n \n or\n <denchmark-code>OperatorNotAllowedInGraphError: using a `tf.Tensor` as a Python `bool` is not allowed: AutoGraph did not convert this function.\n </denchmark-code>\n \n depending on whether tf.function is used.\n Seems that there are something mysterious about the subgraph in tf.data.Dataset. The direct fix is to use tf.cond instead of python control flow, but it might violate TF 2.x style.\n Code to reproduce the issue\n <denchmark-link:https://colab.research.google.com/drive/1B2Bl0Dwmto7sN8rqRodrtXEtZdp07e0w?usp=sharing>https://colab.research.google.com/drive/1B2Bl0Dwmto7sN8rqRodrtXEtZdp07e0w?usp=sharing</denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "WindQAQ", "commentT": "2020-05-13T21:26:43Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/tensorflow/addons/pull/1830>#1830</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "WindQAQ", "commentT": "2020-05-14T00:21:34Z", "comment_text": "\n \t\tFor tracking, this is related to <denchmark-link:https://github.com/tensorflow/tensorflow/issues/26091>tensorflow/tensorflow#26091</denchmark-link>\n  and <denchmark-link:https://github.com/tensorflow/tensorflow/issues/26602>tensorflow/tensorflow#26602</denchmark-link>\n .\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "WindQAQ", "commentT": "2020-05-18T19:47:46Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/WindQAQ>@WindQAQ</denchmark-link>\n  It was . My PR was merged in Tensorflow <denchmark-link:https://github.com/tensorflow/tensorflow/pull/39541>tensorflow/tensorflow#39541</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "379fe62676add3ded683c2717efcfd8b0c82347e", "commit_author": "bhack", "commitT": "2020-05-13 17:20:23-07:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow_addons\\image\\color_ops.py", "file_new_name": "tensorflow_addons\\image\\color_ops.py", "file_complexity": {"file_NLOC": "104", "file_CCN": "11", "file_NToken": "758"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "33", "deleted_lines": null, "method_info": {"method_name": "equalize_image", "method_params": "TensorLike,str", "method_startline": "30", "method_endline": "77", "method_complexity": {"method_NLOC": "7", "method_CCN": "3", "method_NToken": "64", "method_nesting_level": "0"}}}}}}}}