{"BR": {"BR_id": "720", "BR_author": "n3011", "BRopenT": "2019-11-26T20:04:04Z", "BRcloseT": "2019-12-04T20:25:12Z", "BR_text": {"BRsummary": "CohenKappa reset_states distributed training setup errors.", "BRdescription": "\n System information\n \n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Google Colab\n TensorFlow version and how it was installed (source or binary): 2.0.0\n TensorFlow-Addons version and how it was installed (source or binary): 0.6.0\n Python version: 3.6\n Is GPU used? (yes/no): yes\n \n Describe the bug\n When using cohen kappa metric within the distribution strategy scope, reset_states throws the following errors:\n <denchmark-code> UFuncTypeError                            Traceback (most recent call last)\n  <ipython-input-20-56dc62930e1d> in <module>()\n  38     train_accuracy.reset_states()\n  39     test_accuracy.reset_states()\n   ---> 40     test_kappa.reset_states()\n \n  2 frames\n   /tensorflow-2.0.0/python3.6/tensorflow_core/python/distribute/values.py in assign(self, *args, \n    **kwargs)\n  1218         tensor = args[0]\n  1219         if self._aggregation == vs.VariableAggregation.SUM: \n      -> 1220           tensor *= 1. / len(self.devices)\n  1221         return control_flow_ops.group(tuple(\n   1222             _assign_on_device(v.device, v, tensor) for v in self._values))\n \n  UFuncTypeError: Cannot cast ufunc 'multiply' output from dtype('float64') to dtype('int32') with \n       casting rule 'same_kind'\n </denchmark-code>\n \n \n <denchmark-link:https://colab.research.google.com/drive/13MfjnWWsg6cKTINeKtBe5SKBhdeCHhr0>Colab notebook</denchmark-link>\n \n attached.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "n3011", "commentT": "2019-11-26T20:16:47Z", "comment_text": "\n \t\tcc: <denchmark-link:https://github.com/AakashKumarNain>@AakashKumarNain</denchmark-link>\n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "n3011", "commentT": "2019-11-27T08:53:30Z", "comment_text": "\n \t\tI have fixed it temporarily by changing the variables and weight matrix dtype to tf.float32. I think float should be the correct dtype for the weight matrix by default.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "n3011", "commentT": "2019-11-27T09:38:46Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/n3011>@n3011</denchmark-link>\n  Could you please make a PR with the fix?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "n3011", "commentT": "2019-11-27T11:03:24Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Squadrick>@Squadrick</denchmark-link>\n  Sure will do.\n \t\t"}}}, "commit": {"commit_id": "9b7fdc73803b4fe7c6a40342e255720603dbfa99", "commit_author": "Ishant Mrinal Haloi", "commitT": "2019-12-01 11:12:37-08:00", "commit_complexity": {"commit_NLOC": "0.8", "commit_CCN": "1.0", "commit_Nprams": "0.6"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tensorflow_addons\\metrics\\cohens_kappa.py", "file_new_name": "tensorflow_addons\\metrics\\cohens_kappa.py", "file_complexity": {"file_NLOC": "114", "file_CCN": "9", "file_NToken": "671"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "128", "deleted_lines": "128", "method_info": {"method_name": "update_state", "method_params": "self,y_true,y_pred,sample_weight", "method_startline": "98", "method_endline": "131", "method_complexity": {"method_NLOC": "13", "method_CCN": "2", "method_NToken": "97", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "135,139,142,170,171,172,173", "deleted_lines": "135,139,142,170,171", "method_info": {"method_name": "result", "method_params": "self", "method_startline": "133", "method_endline": "173", "method_complexity": {"method_NLOC": "28", "method_CCN": "3", "method_NToken": "315", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tensorflow_addons\\metrics\\cohens_kappa_test.py", "file_new_name": "tensorflow_addons\\metrics\\cohens_kappa_test.py", "file_complexity": {"file_NLOC": "94", "file_CCN": "11", "file_NToken": "1124"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "59,60,61,62", "deleted_lines": null, "method_info": {"method_name": "reset_obj_states", "method_params": "self,obj1,obj2,obj3", "method_startline": "59", "method_endline": "62", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "26", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "138,139,140,141,142,143,144,145,146", "deleted_lines": null, "method_info": {"method_name": "test_kappa_reset_states", "method_params": "self", "method_startline": "138", "method_endline": "146", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "52", "method_nesting_level": "1"}}}}}}}}