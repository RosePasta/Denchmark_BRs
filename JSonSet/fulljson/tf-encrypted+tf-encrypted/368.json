{"BR": {"BR_id": "368", "BR_author": "bendecoste", "BRopenT": "2018-12-20T11:23:22Z", "BRcloseT": "2018-12-21T15:42:11Z", "BR_text": {"BRsummary": "starting a session w/ tensorflow 1.12 can crash", "BRdescription": "\n While doing some testing with a distributed config using tf 1.12 I sometimes see the master node crash\n <denchmark-code>2018-12-20 11:05:44.914953: I tensorflow/core/distributed_runtime/master_session.cc:1161] Start master session 4a57d81601d24336 with config: intra_op_parallelism_threads: 8 inter_op_parallelism_threads: 8\n Traceback (most recent call last):\n   File \"/usr/local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1334, in _do_call\n     return fn(*args)\n   File \"/usr/local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1319, in _run_fn\n     options, feed_dict, fetch_list, target_list, run_metadata)\n   File \"/usr/local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1407, in _call_tf_sessionrun\n     run_metadata)\n tensorflow.python.framework.errors_impl.UnavailableError: Socket closed\n \n During handling of the above exception, another exception occurred:\n \n Traceback (most recent call last):\n   File \"bin/serve\", line 196, in <module>\n     sess.run(tfe.global_variables_initializer(), tag='init')\n   File \"/usr/src/tf-encrypted/tf_encrypted/session.py\", line 122, in run\n     run_metadata=run_metadata\n   File \"/usr/local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 929, in run\n     run_metadata_ptr)\n   File \"/usr/local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1152, in _run\n     feed_dict_tensor, options, run_metadata)\n   File \"/usr/local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1328, in _do_run\n     run_metadata)\n   File \"/usr/local/lib/python3.5/site-packages/tensorflow/python/client/session.py\", line 1348, in _do_call\n     raise type(e)(node_def, op, message)\n tensorflow.python.framework.errors_impl.UnavailableError: Socket closed\n </denchmark-code>\n \n This was introduced by <denchmark-link:https://github.com/tf-encrypted/tf-encrypted/commit/cedcca305b7c49b765d7a983f6171dd059bb20aa>cedcca3</denchmark-link>\n \n At first I thought it was because I wasn't waiting for all of the servers to start, in 1.9 we would get a \"waiting\" message, but now the program will crash.\n However, I have added logic to have the master node wait quite a while before connecting and still seeing this error.\n Since distributed is the real use case for tfe I think we should be more graceful here (even though the error is coming from tensorflow).\n We should either retry, or catch the error and throw one with a better error message.  My vote is for the former, perhaps then throw an error if the connection cannot be achieved after some threshold amount of time.\n \t"}, "comments": {}}, "commit": {"commit_id": "1b987665cb82562cc080ba5038f9dcc3141ec0af", "commit_author": "Justin Patriquin", "commitT": "2018-12-21 11:42:10-04:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "Dockerfile", "file_new_name": "Dockerfile", "file_complexity": {"file_NLOC": "None", "file_CCN": "None", "file_NToken": "None"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "1", "deleted_lines": "1"}}}}}}