{"BR": {"BR_id": "23", "BR_author": "akshaykhatri639", "BRopenT": "2018-07-31T02:08:22Z", "BRcloseT": "2018-11-07T16:47:15Z", "BR_text": {"BRsummary": "tagger = SequenceTagger.load('ner-ontonotes') does not work", "BRdescription": "\n Trying to use the ner-ontonotes model on a Mac. Installed flair via pip.\n <denchmark-code>from flair.tagging_model import SequenceTagger\n tagger = SequenceTagger.load('ner-ontonotes')\n </denchmark-code>\n \n Here's the traceback:\n <denchmark-code>---------------------------------------------------------------------------\n OSError                                   Traceback (most recent call last)\n <ipython-input-4-4d86fef1ef40> in <module>()\n ----> 1 tagger = SequenceTagger.load('ner-ontonotes')\n \n ~/.virtualenvs/py36/lib/python3.6/site-packages/flair/tagging_model.py in load(model)\n     459 \n     460         if model_file is not None:\n --> 461             tagger: SequenceTagger = SequenceTagger.load_from_file(model_file)\n     462             return tagger\n     463 \n \n ~/.virtualenvs/py36/lib/python3.6/site-packages/flair/tagging_model.py in load_from_file(cls, model_file)\n     123         # serialization of torch objects\n     124         warnings.filterwarnings(\"ignore\")\n --> 125         state = torch.load(model_file, map_location={'cuda:0': 'cpu'})\n     126         warnings.filterwarnings(\"default\")\n     127 \n \n ~/.virtualenvs/py36/lib/python3.6/site-packages/torch/serialization.py in load(f, map_location, pickle_module)\n     301         f = open(f, 'rb')\n     302     try:\n --> 303         return _load(f, map_location, pickle_module)\n     304     finally:\n     305         if new_fd:\n \n ~/.virtualenvs/py36/lib/python3.6/site-packages/torch/serialization.py in _load(f, map_location, pickle_module)\n     467     unpickler = pickle_module.Unpickler(f)\n     468     unpickler.persistent_load = persistent_load\n --> 469     result = unpickler.load()\n     470 \n     471     deserialized_storage_keys = pickle_module.load(f)\n \n OSError: [Errno 22] Invalid argument\n </denchmark-code>\n \n Note: tagger = SequenceTagger.load('ner') works fine\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "akshaykhatri639", "commentT": "2018-07-31T07:24:36Z", "comment_text": "\n \t\tHi Akshay, thanks for your interest! Could you also try some of the other models?\n tagger = SequenceTagger.load('chunk')\n tagger = SequenceTagger.load('pos')\n tagger = SequenceTagger.load('frame')\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "akshaykhatri639", "commentT": "2018-08-02T19:56:01Z", "comment_text": "\n \t\tHey Alan, all of these models work fine\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "akshaykhatri639", "commentT": "2018-08-03T16:51:35Z", "comment_text": "\n \t\tRelease 0.2 fixes this bug. git pull or pip install flair --upgrade to get the newest version!\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "akshaykhatri639", "commentT": "2018-08-14T21:37:34Z", "comment_text": "\n \t\tThe error still persists in version 0.2.1\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "akshaykhatri639", "commentT": "2018-08-14T22:20:30Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/akshaykhatri639>@akshaykhatri639</denchmark-link>\n  Could you please check the checksum of the  model?\n Just go to the ~/.flair/models folder and execute sha256sum en-ner-ontonotes-v0.2.pt:\n $ sha256sum en-ner-ontonotes-v0.2.pt \n 34044e832903456139d942ea6b346dafbbcbb922c0df93684a6412951984cdc5  en-ner-ontonotes-v0.2.pt\n If that command outputs another checksum, then I guess something went wrong during the download of the model. In that case just delete the model and download it again using tagger = SequenceTagger.load('ner-ontonotes') :)\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "akshaykhatri639", "commentT": "2018-08-15T19:52:32Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/stefan-it>@stefan-it</denchmark-link>\n  Thanks for the quick response but the checksum is correct.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "akshaykhatri639", "commentT": "2018-08-16T07:09:06Z", "comment_text": "\n \t\tHm very strange - could you try deleting the model ~/.flair/models/en-ner-ontonotes-v0.2.pt and try again?\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "akshaykhatri639", "commentT": "2018-08-16T21:24:26Z", "comment_text": "\n \t\tNo luck\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "akshaykhatri639", "commentT": "2018-08-20T23:12:09Z", "comment_text": "\n \t\tSame problem here.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "akshaykhatri639", "commentT": "2018-08-21T00:03:30Z", "comment_text": "\n \t\tBut all the other models work? including 'ner-ontonotes-fast'?\n One thing that is different amout the 'ner-ontonotes' model is that it is the largest model we've trained. Could it somehow be a memory issue? Could you monitor memory as you load the model?\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "akshaykhatri639", "commentT": "2018-08-21T08:44:29Z", "comment_text": "\n \t\tHi,\n using:\n from flair.models import SequenceTagger\n \n tagger = SequenceTagger.load('ner-ontonotes')\n Outputs:\n stefan@stefan-power-workstation:/tmp$ \\time -v python ontonotes.py \n \tCommand being timed: \"python ontonotes.py\"\n \tUser time (seconds): 6.21\n \tSystem time (seconds): 2.62\n \tPercent of CPU this job got: 112%\n \tElapsed (wall clock) time (h:mm:ss or m:ss): 0:07.89\n \tAverage shared text size (kbytes): 0\n \tAverage unshared data size (kbytes): 0\n \tAverage stack size (kbytes): 0\n \tAverage total size (kbytes): 0\n \tMaximum resident set size (kbytes): 6037476\n \tAverage resident set size (kbytes): 0\n \tMajor (requiring I/O) page faults: 0\n \tMinor (reclaiming a frame) page faults: 1641289\n \tVoluntary context switches: 157\n \tInvoluntary context switches: 75\n \tSwaps: 0\n \tFile system inputs: 0\n \tFile system outputs: 0\n \tSocket messages sent: 0\n \tSocket messages received: 0\n \tSignals delivered: 0\n \tPage size (bytes): 4096\n \tExit status: 0\n So max. resident size was 6037476 kb = ~ 6GB of RAM.\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "akshaykhatri639", "commentT": "2018-08-21T18:43:11Z", "comment_text": "\n \t\tYes  fails too. I reran the code and monitored the memory usage using  and it did not get anywhere close to full.  Is this stackoverflow post related? <denchmark-link:https://stackoverflow.com/questions/11662960/ioerror-errno-22-invalid-argument-when-reading-writing-large-bytestring>https://stackoverflow.com/questions/11662960/ioerror-errno-22-invalid-argument-when-reading-writing-large-bytestring</denchmark-link>\n \n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "akshaykhatri639", "commentT": "2018-08-21T19:18:08Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/pwichmann>@pwichmann</denchmark-link>\n  Do you also use you a MAC?\n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "akshaykhatri639", "commentT": "2018-08-21T19:22:27Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/akshaykhatri639>@akshaykhatri639</denchmark-link>\n  thanks for testing this. This kind of supports the theory that this may have something to do with model size and that large models fail to load on some setups.\n Since we cannot reproduce the error ourselves, could we ask you to try loading each of the 13 pre-trained models listed <denchmark-link:https://github.com/zalandoresearch/flair/blob/master/resources/docs/TUTORIAL_TAGGING.md>here</denchmark-link>\n  and tell us which ones work and which ones fail? If all the large ones fail, we get closer to diagnosing the problem.\n (After the test, you can delete the models again in ~/.flair/models/ so as not to run up your hard drive with a bunch of models :))\n \t\t"}, "comments_14": {"comment_id": 15, "comment_author": "akshaykhatri639", "commentT": "2018-08-21T19:28:09Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/stefan-it>@stefan-it</denchmark-link>\n  Yes, I used a Mac.\n \t\t"}, "comments_15": {"comment_id": 16, "comment_author": "akshaykhatri639", "commentT": "2018-08-29T20:31:39Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/akshaykhatri639>@akshaykhatri639</denchmark-link>\n  Did you manage to solve the problem?\n \t\t"}, "comments_16": {"comment_id": 17, "comment_author": "akshaykhatri639", "commentT": "2018-08-29T20:39:59Z", "comment_text": "\n \t\tNo, I moved to a linux environment \ud83d\ude05\n \t\t"}, "comments_17": {"comment_id": 18, "comment_author": "akshaykhatri639", "commentT": "2018-08-29T20:57:14Z", "comment_text": "\n \t\tSo, it is a Mac problem? That's weird...\n \t\t"}, "comments_18": {"comment_id": 19, "comment_author": "akshaykhatri639", "commentT": "2018-11-07T16:47:15Z", "comment_text": "\n \t\tFixed in master branch, will be part of next version release!\n \t\t"}}}, "commit": {"commit_id": "5921d6bc99fc161f0e9eb846afc39e169bc6b2fd", "commit_author": "aakbik", "commitT": "2018-08-03 16:42:33+02:00", "commit_complexity": {"commit_NLOC": "0.0", "commit_CCN": "0.8571428571428571", "commit_Nprams": "1.0"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "flair\\models\\sequence_tagger_model.py", "file_new_name": "flair\\models\\sequence_tagger_model.py", "file_complexity": {"file_NLOC": "354", "file_CCN": "64", "file_NToken": "3017"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "364,365,366", "deleted_lines": null, "method_info": {"method_name": "predict", "method_params": "self,mini_batch_size", "method_startline": "359", "method_endline": "383", "method_complexity": {"method_NLOC": "16", "method_CCN": "6", "method_NToken": "145", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "tests\\test_sequence_tagger.py", "file_complexity": {"file_NLOC": "8", "file_CCN": "1", "file_NToken": "51"}}}}}