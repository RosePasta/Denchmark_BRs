{"BR": {"BR_id": "351", "BR_author": "haamoon", "BRopenT": "2017-07-30T22:51:27Z", "BRcloseT": "2017-07-30T23:56:44Z", "BR_text": {"BRsummary": "Having BNReLU activation inside freeze_variables", "BRdescription": "\n Apparently, tensorpack does not like to see BNReLU activation when using varreplace.freeze_variables(). Here is a minimal code to reproduce the error:\n <denchmark-code>import tensorflow as tf\n from tensorpack import *\n \n class Model(ModelDesc):\n     def __init__(self, data_format):\n         self.data_format = data_format\n     def _get_inputs(self):\n         return [InputDesc(tf.float32, [1, 224, 224, 3], 'im')]\n     def _build_graph(self, inputs):\n         image = inputs[0]\n         if self.data_format == 'NCHW':\n             image = tf.transpose(image, [0, 3, 1, 2])\n         with argscope([Conv2D, BatchNorm], data_format=self.data_format):\n             with varreplace.freeze_variables():\n                 fea = Conv2D('conv0', image, 64, 7, stride=2, nl=BNReLU)\n     def _get_optimizer(self):\n         pass\n \n if __name__ == '__main__':\n     model = Model('NCHW');\n     inputs = [tf.placeholder(dtype=inp.type, shape=inp.shape, name=inp.name) for inp in model._get_inputs()]\n     with TowerContext('', is_training=True):\n           model._build_graph(inputs)\n </denchmark-code>\n \n without nl=BNReLU or freeze_variables it runs without any problem. Any Idea how to fix it?\n \t"}, "comments": {}}, "commit": {"commit_id": "2a1af832ba1582b41377a4ce9694c61e39707218", "commit_author": "Yuxin Wu", "commitT": "2017-07-30 16:56:24-07:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tensorpack\\tfutils\\varreplace.py", "file_new_name": "tensorpack\\tfutils\\varreplace.py", "file_complexity": {"file_NLOC": "34", "file_CCN": "10", "file_NToken": "223"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "65,66,67,68,69", "deleted_lines": "65", "method_info": {"method_name": "freeze_variables.custom_getter", "method_params": "getter,args,kwargs", "method_startline": "65", "method_endline": "69", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "41", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "54,65,66,67,68,69,70", "deleted_lines": "54,65", "method_info": {"method_name": "freeze_variables", "method_params": "", "method_startline": "52", "method_endline": "70", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "12", "method_nesting_level": "0"}}}}}}}}