{"BR": {"BR_id": "200", "BR_author": "chuanmingliu", "BRopenT": "2018-09-17T10:00:07Z", "BRcloseT": "2019-08-19T05:31:49Z", "BR_text": {"BRsummary": "semaphore_tracker: There appear to be 1 leaked semaphores to clean up at shutdown   len(cache))", "BRdescription": "\n <denchmark-h:h3>Bug Description</denchmark-h>\n \n Hi, everyone! When I try to use autokeras fit some data and label, I encounter such warnings as:\n \"semaphore_tracker: There appear to be 1 leaked semaphores to clean up at shutdown   len(cache))\"\n After some iterations, for example, after prompt \"Model 9\", the program is hanging due to insufficient memory.\n I don't think it has connection with my code, here is my code:\n <denchmark-code>from autokeras.image_supervised import ImageClassifier\n import numpy as np\n \n if __name__ == '__main__':\n     x_train = np.load('x_train.npy')\n     y_train = np.load('y_train.npy')\n     x_test = np.load('x_test.npy')\n     y_test = np.load('y_test.npy')\n     x_train = x_train.reshape((-1, 32, 32, 3))\n     y_train.reshape((-1, 1))\n     x_test = x_test.reshape((-1, 32, 32, 3))\n     y_test = y_test.reshape((-1, 1))\n     clf = ImageClassifier(verbose=True)\n     clf.fit(x_train, y_train, time_limit=12*60*60)\n     clf.final_fit(x_train, y_train, x_test, y_test, retrain=True)\n     pred = clf.evaluate(x_test, y_test)\n     print(pred)\n </denchmark-code>\n \n The magnitude of my dataset is similar to CIFAR10.\n I want to know, how to fix this warning and following memory issue? Does anyone has experience in fixing such things? Thanks in advance.\n <denchmark-h:h3>Reproducing Steps</denchmark-h>\n \n Steps to reproduce the behavior:\n \n Step 1: ...\n Step 2: ...\n \n <denchmark-h:h3>Expected Behavior</denchmark-h>\n \n <denchmark-h:h3>Setup Details</denchmark-h>\n \n Include the details about the versions of:\n \n OS type and version: Ubuntu 16.04\n Python: 3.6\n autokeras: \n scikit-learn:\n numpy:\n keras: 2.2.2\n scipy:\n tensorflow: 1.10.0\n pytorch:\n All requirements are installed by \"pip install autokeras\" and I run my code in a Docker instance,\n Some info on my Docker environment:\n chuanming@Galadriel:~$ nvidia-docker version\n NVIDIA Docker: 2.0.3\n Client:\n Version: 18.03.1-ce\n API version: 1.37\n Go version: go1.9.5\n Git commit: 9ee9f40\n Built: Thu Apr 26 07:17:20 2018\n OS/Arch: linux/amd64\n Experimental: false\n Orchestrator: swarm\n \n Server:\n Engine:\n Version: 18.03.1-ce\n API version: 1.37 (minimum version 1.12)\n Go version: go1.9.5\n Git commit: 9ee9f40\n Built: Thu Apr 26 07:15:30 2018\n OS/Arch: linux/amd64\n Experimental: false\n <denchmark-h:h3>Additional context</denchmark-h>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "chuanmingliu", "commentT": "2018-09-25T03:50:17Z", "comment_text": "\n \t\tI experienced the same warning.\n UserWarning: semaphore_tracker: There appear to be 1 leaked semaphores to clean up at shutdown\n len(cache))\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "chuanmingliu", "commentT": "2018-10-21T11:12:42Z", "comment_text": "\n \t\tSame issue here. But how long will autokeras terminate on MNIST training? It's training on my mac in 8 hours. As screenshot below.\n <denchmark-link:https://user-images.githubusercontent.com/6853884/47266158-3efd4900-d565-11e8-8a0f-d93aaa3037be.png></denchmark-link>\n \n How to get the resulted model? Which path does these models save?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "chuanmingliu", "commentT": "2019-08-12T04:55:31Z", "comment_text": "\n \t\tThis issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n \t\t"}}}, "commit": {"commit_id": "b2fc09bef6c6609a0bea421cd09a641d1ed5c873", "commit_author": "tl-yang", "commitT": "2018-12-21 08:43:29-06:00", "commit_complexity": {"commit_NLOC": "1.0", "commit_CCN": "1.0", "commit_Nprams": "0.7708333333333334"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "autokeras\\bayesian.py", "file_new_name": "autokeras\\bayesian.py", "file_complexity": {"file_NLOC": "312", "file_CCN": "91", "file_NToken": "2594"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "310,316,350", "deleted_lines": "310,316,350", "method_info": {"method_name": "generate", "method_params": "self,descriptors,timeout,sync_message", "method_startline": "310", "method_endline": "381", "method_complexity": {"method_NLOC": "55", "method_CCN": "17", "method_NToken": "430", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "310,316,350", "deleted_lines": "310,316,350", "method_info": {"method_name": "generate", "method_params": "self,descriptors,timeout,multiprocessing_queue", "method_startline": "310", "method_endline": "381", "method_complexity": {"method_NLOC": "55", "method_CCN": "16", "method_NToken": "416", "method_nesting_level": "1"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "autokeras\\nn\\layers.py", "file_new_name": "autokeras\\nn\\layers.py", "file_complexity": {"file_NLOC": "368", "file_CCN": "119", "file_NToken": "2887"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "516,517,518,519,520,521,522,523,524,525,526,527", "deleted_lines": "516,517,518,519,520,521,522,523,524,525,526,527"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "autokeras\\nn\\model_trainer.py", "file_new_name": "autokeras\\nn\\model_trainer.py", "file_complexity": {"file_NLOC": "317", "file_CCN": "40", "file_NToken": "1820"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "167,168", "deleted_lines": null, "method_info": {"method_name": "_train", "method_params": "self", "method_startline": "155", "method_endline": "179", "method_complexity": {"method_NLOC": "22", "method_CCN": "7", "method_NToken": "160", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "56,57", "deleted_lines": null, "method_info": {"method_name": "train_model", "method_params": "self,max_iter_num,max_no_improvement_num,timeout", "method_startline": "54", "method_endline": "57", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "17", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "196,197", "deleted_lines": null, "method_info": {"method_name": "_test", "method_params": "self", "method_startline": "181", "method_endline": "214", "method_complexity": {"method_NLOC": "27", "method_CCN": "7", "method_NToken": "242", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "51", "deleted_lines": "52", "method_info": {"method_name": "train_model", "method_params": "self,max_iter_num,max_no_improvement_num", "method_startline": "50", "method_endline": "52", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "13", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 8, "file_old_name": "autokeras\\search.py", "file_new_name": "autokeras\\search.py", "file_complexity": {"file_NLOC": "220", "file_CCN": "49", "file_NToken": "1666"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270", "deleted_lines": "244,247,248,249,266", "method_info": {"method_name": "sp_search", "method_params": "self,graph,other_info,model_id,train_data,test_data,timeout", "method_startline": "240", "method_endline": "270", "method_complexity": {"method_NLOC": "12", "method_CCN": "5", "method_NToken": "125", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "266,267,268,269,270,271,285,288,289", "deleted_lines": "266", "method_info": {"method_name": "train", "method_params": "q,graph,train_data,test_data,trainer_args,metric,loss,verbose,path", "method_startline": "266", "method_endline": "289", "method_complexity": {"method_NLOC": "23", "method_CCN": "6", "method_NToken": "161", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263", "deleted_lines": "244,247,248,249", "method_info": {"method_name": "generate", "method_params": "self,remaining_time,multiprocessing_queue", "method_startline": "244", "method_endline": "263", "method_complexity": {"method_NLOC": "8", "method_CCN": "2", "method_NToken": "69", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "285,288,289,296", "deleted_lines": null, "method_info": {"method_name": "generate", "method_params": "self,multiprocessing_queue", "method_startline": "285", "method_endline": "304", "method_complexity": {"method_NLOC": "9", "method_CCN": "2", "method_NToken": "80", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "320,344,345,346,347", "deleted_lines": null, "method_info": {"method_name": "train", "method_params": "q,graph,train_data,test_data,trainer_args,metric,loss,verbose,path,timeout", "method_startline": "320", "method_endline": "347", "method_complexity": {"method_NLOC": "27", "method_CCN": "8", "method_NToken": "189", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "306,307,308,309,310,311,312,313,314,315,316,317", "deleted_lines": null, "method_info": {"method_name": "_search_common", "method_params": "self,mp_queue", "method_startline": "306", "method_endline": "317", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "77", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "199,200,203,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226", "deleted_lines": "199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217", "method_info": {"method_name": "mp_search", "method_params": "self,graph,other_info,model_id,train_data,test_data,timeout", "method_startline": "199", "method_endline": "238", "method_complexity": {"method_NLOC": "19", "method_CCN": "6", "method_NToken": "183", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "183,193,194,196,197", "deleted_lines": "176,190,192,195", "method_info": {"method_name": "search", "method_params": "self,train_data,test_data,timeout", "method_startline": "164", "method_endline": "197", "method_complexity": {"method_NLOC": "15", "method_CCN": "5", "method_NToken": "160", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "examples\\mnist.py", "file_new_name": "examples\\mnist.py", "file_complexity": {"file_NLOC": "11", "file_CCN": "0", "file_NToken": "120"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "6,7", "deleted_lines": "6,7"}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\nn\\test_model_trainer.py", "file_new_name": "tests\\nn\\test_model_trainer.py", "file_complexity": {"file_NLOC": "48", "file_CCN": "4", "file_NToken": "348"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "44,45,46,47,48,49,50,51,52,53,54,55,56", "deleted_lines": null, "method_info": {"method_name": "test_model_trainer_timout", "method_params": "", "method_startline": "44", "method_endline": "56", "method_complexity": {"method_NLOC": "13", "method_CCN": "1", "method_NToken": "87", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\test_search.py", "file_new_name": "tests\\test_search.py", "file_complexity": {"file_NLOC": "83", "file_CCN": "12", "file_NToken": "739"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "32,33,34,35,36,37,38,39,40,41,42", "deleted_lines": null, "method_info": {"method_name": "test_bayesian_searcher_sp", "method_params": "_,_1,_2,_3", "method_startline": "32", "method_endline": "42", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "101", "method_nesting_level": "0"}}}}}}}}