{"BR": {"BR_id": "1562", "BR_author": "shendiaomo", "BRopenT": "2019-12-27T14:01:11Z", "BRcloseT": "2020-01-21T05:00:32Z", "BR_text": {"BRsummary": "Cannot switch database with `USE` command.", "BRdescription": "\n <denchmark-link:https://user-images.githubusercontent.com/4180295/71519782-de4d6700-28f3-11ea-9897-775b2759bd30.png></denchmark-link>\n \n sqlflow> use iris;\n \n 0 row affected\n +\n +\n sqlflow> show tables;\n \n 2019/12/27 13:56:50 runSQLProgram error: runQuery failed: Error 1046: No database selected\n +\n +\n sqlflow>\n This is a known problem as described in <denchmark-link:https://github.com/go-sql-driver/mysql/issues/173>go-sql-driver/mysql#173</denchmark-link>\n , we may consider to fix this using a transaction to improve user experience.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "shendiaomo", "commentT": "2019-12-30T03:11:17Z", "comment_text": "\n \t\tMaybe it is not a good idea to support use iris; since it introduces states between SQL statements, while our design tends to keep the server stateless.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "shendiaomo", "commentT": "2019-12-30T04:01:34Z", "comment_text": "\n \t\tCan keep the context in one sql program like:\n use iris;\n show tables;\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "shendiaomo", "commentT": "2019-12-30T05:03:05Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Yancey1989>@Yancey1989</denchmark-link>\n  I don't think this works. Since different SQL statements run in separate workflow steps, and separate steps are not sharing states.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "shendiaomo", "commentT": "2019-12-30T06:36:11Z", "comment_text": "\n \t\t\n @Yancey1989 I don't think this works. Since different SQL statements run in separate workflow steps, and separate steps are not sharing states.\n \n <denchmark-link:https://github.com/tonyyang-svail>@tonyyang-svail</denchmark-link>\n  you're right, it does not work with argo mode, but works well on local mode in the all-in-one Docker image.\n \n \n \n sqlflow/pkg/sql/executor_ir.go\n \n \n         Lines 58 to 64\n       in\n       254a5e6\n \n \n \n \n \n \n  if db, err = database.OpenAndConnectDB(session.DbConnStr); err != nil { \n \n \n \n  wr.Write(fmt.Errorf(\"create DB failed: %v\", err)) \n \n \n \n  log.Printf(\"create DB failed: %v\", err) \n \n \n \n  } \n \n \n \n  defer wr.Close() \n \n \n \n  err = runSQLProgram(wr, sqlProgram, db, modelDir, session) \n \n \n \n  \n \n \n \n \n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "shendiaomo", "commentT": "2019-12-30T06:37:05Z", "comment_text": "\n \t\tMaybe share db context between workflow steps can be the next feature in argo mode.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "shendiaomo", "commentT": "2019-12-31T07:42:51Z", "comment_text": "\n \t\t\n Maybe it is not a good idea to support use iris; since it introduces states between SQL statements, while our design tends to keep the server stateless.\n \n I think it doesn't have to be a state in the server, we can process this in the client, for example, we can parse the database name and pass it to every connection and workflow step. Let's see how many people need this feature before we decide whether to do it or not\u3002\n \t\t"}}}, "commit": {"commit_id": "13207b568d19fa76e19d6e0c24d976ff8c517c7a", "commit_author": "shendiaomo", "commitT": "2020-01-21 13:00:30+08:00", "commit_complexity": {"commit_NLOC": "0.21649484536082475", "commit_CCN": "0.21649484536082475", "commit_Nprams": "0.9278350515463918"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "cmd\\repl\\repl.go", "file_new_name": "cmd\\repl\\repl.go", "file_complexity": {"file_NLOC": "327", "file_CCN": "21", "file_NToken": "540"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,319", "deleted_lines": "180,181,182,183,184,185,186,187,189,190,193,194,195", "method_info": {"method_name": "getBase64EncodedImage", "method_params": "string", "method_startline": "88", "method_endline": "351", "method_complexity": {"method_NLOC": "261", "method_CCN": "9", "method_NToken": "242", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "cmd\\repl\\repl_test.go", "file_new_name": "cmd\\repl\\repl_test.go", "file_complexity": {"file_NLOC": "217", "file_CCN": "21", "file_NToken": "2027"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "35,36,37,38,39,40,41", "deleted_lines": null, "method_info": {"method_name": "testGetDataSource", "method_params": "T,dataSource,string", "method_startline": "35", "method_endline": "41", "method_complexity": {"method_NLOC": "7", "method_CCN": "1", "method_NToken": "83", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58", "deleted_lines": null, "method_info": {"method_name": "TestGetDataSource", "method_params": "T", "method_startline": "42", "method_endline": "58", "method_complexity": {"method_NLOC": "14", "method_CCN": "1", "method_NToken": "110", "method_nesting_level": "0"}}}}}}}}