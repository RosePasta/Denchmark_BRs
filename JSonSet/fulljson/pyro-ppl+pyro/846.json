{"BR": {"BR_id": "846", "BR_author": "fritzo", "BRopenT": "2018-03-04T04:13:36Z", "BRcloseT": "2018-03-16T23:56:00Z", "BR_text": {"BRsummary": "Errors when combining iarange + discrete enumeration", "BRdescription": "\n This issue tracks progress of combining enumeration <denchmark-link:https://github.com/pyro-ppl/pyro/issues/742>#742</denchmark-link>\n  and nested  <denchmark-link:https://github.com/pyro-ppl/pyro/pull/780>#780</denchmark-link>\n . Currently  gives incorrect results when enumerating any , even in SS-VAE (as discovered by <denchmark-link:https://github.com/rohitsingh0812>@rohitsingh0812</denchmark-link>\n ).\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "fritzo", "commentT": "2018-03-06T21:21:24Z", "comment_text": "\n \t\tThis was mostly fixed by <denchmark-link:https://github.com/pyro-ppl/pyro/pull/828>#828</denchmark-link>\n . What remains is to fix broadcasting issues due to global variables that appear in s.\n \t\t"}}}, "commit": {"commit_id": "3e05a1001067c2605fa292e9dbab03f30c7aa7eb", "commit_author": "Fritz Obermeyer", "commitT": "2018-03-16 16:55:59-07:00", "commit_complexity": {"commit_NLOC": "0.7777777777777778", "commit_CCN": "0.3611111111111111", "commit_Nprams": "0.8472222222222222"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "pyro\\infer\\enum.py", "file_new_name": "pyro\\infer\\enum.py", "file_complexity": {"file_NLOC": "53", "file_CCN": "19", "file_NToken": "431"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "18,20,22,23,25,28", "deleted_lines": "25,27,28", "method_info": {"method_name": "_iter_discrete_extend", "method_params": "trace,site", "method_startline": "18", "method_endline": "28", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "92", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "12,13,14,15", "method_info": {"method_name": "_iter_discrete_filter", "method_params": "msg", "method_startline": "12", "method_endline": "15", "method_complexity": {"method_NLOC": "4", "method_CCN": "3", "method_NToken": "34", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "25,28", "deleted_lines": "25,27,28,33,34,35", "method_info": {"method_name": "_iter_discrete_extend", "method_params": "trace,site,enum_tree", "method_startline": "25", "method_endline": "35", "method_complexity": {"method_NLOC": "11", "method_CCN": "2", "method_NToken": "110", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "43,45,46,47,48,49,50,51,52,53", "deleted_lines": "38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53", "method_info": {"method_name": "_iter_discrete_queue", "method_params": "graph_type,fn,args,kwargs", "method_startline": "38", "method_endline": "53", "method_complexity": {"method_NLOC": "16", "method_CCN": "4", "method_NToken": "139", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "43,45,46,47,48,49,50,51,52,53,54,55,56,57,58", "deleted_lines": "33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53", "method_info": {"method_name": "iter_discrete_traces", "method_params": "graph_type,fn,args,kwargs", "method_startline": "31", "method_endline": "58", "method_complexity": {"method_NLOC": "15", "method_CCN": "4", "method_NToken": "125", "method_nesting_level": "0"}}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "pyro\\infer\\traceenum_elbo.py", "file_new_name": "pyro\\infer\\traceenum_elbo.py", "file_complexity": {"file_NLOC": "84", "file_CCN": "24", "file_NToken": "580"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "16,17,18,19,20,21,22,23,24,25,26,27", "deleted_lines": "16,17,18,19,20,21,22,23,24,25,26,27", "method_info": {"method_name": "_compute_dice_elbo", "method_params": "model_trace,guide_trace", "method_startline": "16", "method_endline": "27", "method_complexity": {"method_NLOC": "11", "method_CCN": "4", "method_NToken": "89", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "98,99,102,103,104,105,106,107,109,115,116,117", "deleted_lines": "93,94,95,96,108,109,112,113,114,115,116,117,118,119,120,121,122,123", "method_info": {"method_name": "loss_and_grads", "method_params": "self,model,guide,args,kwargs", "method_startline": "93", "method_endline": "123", "method_complexity": {"method_NLOC": "19", "method_CCN": "9", "method_NToken": "151", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "54,71", "deleted_lines": "51,52,69", "method_info": {"method_name": "_get_traces", "method_params": "self,model,guide,args,kwargs", "method_startline": "45", "method_endline": "71", "method_complexity": {"method_NLOC": "18", "method_CCN": "7", "method_NToken": "168", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "78,81,82,83,84,86", "deleted_lines": "76,79,80,81,82,83,85,86,87,88,89,90,91", "method_info": {"method_name": "loss", "method_params": "self,model,guide,args,kwargs", "method_startline": "73", "method_endline": "91", "method_complexity": {"method_NLOC": "11", "method_CCN": "4", "method_NToken": "85", "method_nesting_level": "1"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "16,17,18,19,20,21,22,23,24,25,26,27", "deleted_lines": "16,17,18,19,20,21,22,23,24,25,26,27", "method_info": {"method_name": "_compute_upstream_grads", "method_params": "trace", "method_startline": "16", "method_endline": "27", "method_complexity": {"method_NLOC": "10", "method_CCN": "4", "method_NToken": "58", "method_nesting_level": "0"}}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 11, "file_old_name": "pyro\\infer\\util.py", "file_new_name": "pyro\\infer\\util.py", "file_complexity": {"file_NLOC": "131", "file_CCN": "57", "file_NToken": "846"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "179,181,182,183,184,185,186", "deleted_lines": "179,180,181,182,183,184,185", "method_info": {"method_name": "exp", "method_params": "self", "method_startline": "179", "method_endline": "186", "method_complexity": {"method_NLOC": "6", "method_CCN": "2", "method_NToken": "45", "method_nesting_level": "1"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "170,171,173", "deleted_lines": "170,171,172,173", "method_info": {"method_name": "_freeze", "method_params": "self", "method_startline": "170", "method_endline": "173", "method_complexity": {"method_NLOC": "4", "method_CCN": "2", "method_NToken": "23", "method_nesting_level": "1"}}}, "hunk_2": {"Ismethod": 1, "added_lines": "154,155,156,158,159,160,161,162,163,164,166,167,168", "deleted_lines": "154,156,158,159,160,161,162,163,164,165,166,167,168", "method_info": {"method_name": "get_upstream", "method_params": "self,key", "method_startline": "154", "method_endline": "168", "method_complexity": {"method_NLOC": "12", "method_CCN": "5", "method_NToken": "78", "method_nesting_level": "1"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "128,129,130,131,132", "deleted_lines": "129,130,132", "method_info": {"method_name": "_dict_iadd", "method_params": "items,key,value", "method_startline": "128", "method_endline": "132", "method_complexity": {"method_NLOC": "5", "method_CCN": "2", "method_NToken": "33", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "177,179,181,182,183,184,185,186,187,188,189,190,191,192,193,194", "deleted_lines": "177,178,179,180,181,182,183,184,185,187,188,189,190,191", "method_info": {"method_name": "in_context", "method_params": "self,cond_indep_stack", "method_startline": "177", "method_endline": "195", "method_complexity": {"method_NLOC": "14", "method_CCN": "9", "method_NToken": "110", "method_nesting_level": "1"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "154,155,156,158,159,160,161,162,163,164,166,167,168,169,170,171,173,174,175", "deleted_lines": "154,156,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175", "method_info": {"method_name": "__init__", "method_params": "self,guide_trace", "method_startline": "154", "method_endline": "175", "method_complexity": {"method_NLOC": "19", "method_CCN": "8", "method_NToken": "143", "method_nesting_level": "1"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "144,145,146,147,148,149,150,151,152", "deleted_lines": "144,145,146,147,148,149,150,151,152", "method_info": {"method_name": "add", "method_params": "self,key,value", "method_startline": "144", "method_endline": "152", "method_complexity": {"method_NLOC": "6", "method_CCN": "2", "method_NToken": "49", "method_nesting_level": "1"}}}, "hunk_7": {"Ismethod": 1, "added_lines": "132,133,134,135", "deleted_lines": "132,133,134,135", "method_info": {"method_name": "__init__", "method_params": "self", "method_startline": "132", "method_endline": "135", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "22", "method_nesting_level": "1"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "137,138,139,140,141,142", "deleted_lines": "137,138,139,140,141,142", "method_info": {"method_name": "copy", "method_params": "self", "method_startline": "137", "method_endline": "142", "method_complexity": {"method_NLOC": "6", "method_CCN": "1", "method_NToken": "41", "method_nesting_level": "1"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "175,176,177", "deleted_lines": "175,176,177", "method_info": {"method_name": "items", "method_params": "self", "method_startline": "175", "method_endline": "177", "method_complexity": {"method_NLOC": "3", "method_CCN": "1", "method_NToken": "18", "method_nesting_level": "1"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "188,189,190,191", "deleted_lines": "188,189,190,191", "method_info": {"method_name": "prune", "method_params": "self,key", "method_startline": "188", "method_endline": "191", "method_complexity": {"method_NLOC": "4", "method_CCN": "1", "method_NToken": "33", "method_nesting_level": "1"}}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pyro\\poutine\\replay_poutine.py", "file_new_name": "pyro\\poutine\\replay_poutine.py", "file_complexity": {"file_NLOC": "51", "file_CCN": "20", "file_NToken": "426"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "42,43,44", "deleted_lines": "42", "method_info": {"method_name": "_process_message", "method_params": "self,msg", "method_startline": "38", "method_endline": "46", "method_complexity": {"method_NLOC": "8", "method_CCN": "4", "method_NToken": "85", "method_nesting_level": "1"}}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 12, "file_old_name": "tests\\infer\\test_enum.py", "file_new_name": "tests\\infer\\test_enum.py", "file_complexity": {"file_NLOC": "618", "file_CCN": "96", "file_NToken": "8073"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "34", "deleted_lines": "36", "method_info": {"method_name": "test_iter_discrete_traces_order", "method_params": "depth,graph_type", "method_startline": "24", "method_endline": "36", "method_complexity": {"method_NLOC": "8", "method_CCN": "5", "method_NToken": "80", "method_nesting_level": "0"}}}, "hunk_1": {"Ismethod": 1, "added_lines": "605", "deleted_lines": "624", "method_info": {"method_name": "test_non_mean_field_bern_bern_elbo_gradient", "method_params": "enumerate1,pi1,pi2", "method_startline": "603", "method_endline": "642", "method_complexity": {"method_NLOC": "26", "method_CCN": "3", "method_NToken": "323", "method_nesting_level": "0"}}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "85,89,90,91,92,93,94,95", "method_info": {"method_name": "test_iter_discrete_traces_vector", "method_params": "graph_type", "method_startline": "68", "method_endline": "95", "method_complexity": {"method_NLOC": "15", "method_CCN": "2", "method_NToken": "138", "method_nesting_level": "0"}}}, "hunk_3": {"Ismethod": 1, "added_lines": "355", "deleted_lines": "374", "method_info": {"method_name": "test_elbo_irange", "method_params": "irange_dim,enumerate1,enumerate2", "method_startline": "353", "method_endline": "389", "method_complexity": {"method_NLOC": "21", "method_CCN": "2", "method_NToken": "230", "method_nesting_level": "0"}}}, "hunk_4": {"Ismethod": 1, "added_lines": "190", "deleted_lines": "209", "method_info": {"method_name": "test_elbo_bern", "method_params": "quantity,enumerate1", "method_startline": "188", "method_endline": "221", "method_complexity": {"method_NLOC": "25", "method_CCN": "4", "method_NToken": "236", "method_nesting_level": "0"}}}, "hunk_5": {"Ismethod": 1, "added_lines": "313", "deleted_lines": "332", "method_info": {"method_name": "test_elbo_iarange", "method_params": "iarange_dim,enumerate1,enumerate2", "method_startline": "311", "method_endline": "347", "method_complexity": {"method_NLOC": "21", "method_CCN": "2", "method_NToken": "230", "method_nesting_level": "0"}}}, "hunk_6": {"Ismethod": 1, "added_lines": "456", "deleted_lines": "475", "method_info": {"method_name": "test_elbo_iarange_irange", "method_params": "outer_dim,inner_dim,enumerate1,enumerate2,enumerate3", "method_startline": "454", "method_endline": "495", "method_complexity": {"method_NLOC": "21", "method_CCN": "2", "method_NToken": "242", "method_nesting_level": "0"}}}, "hunk_7": {"Ismethod": 1, "added_lines": null, "deleted_lines": "55,59,60,61,62,63,64", "method_info": {"method_name": "test_iter_discrete_traces_scalar", "method_params": "graph_type", "method_startline": "42", "method_endline": "64", "method_complexity": {"method_NLOC": "14", "method_CCN": "2", "method_NToken": "129", "method_nesting_level": "0"}}}, "hunk_8": {"Ismethod": 1, "added_lines": "556", "deleted_lines": "568,575", "method_info": {"method_name": "test_elbo_irange_irange", "method_params": "outer_dim,inner_dim,enumerate1,enumerate2,enumerate3", "method_startline": "554", "method_endline": "597", "method_complexity": {"method_NLOC": "21", "method_CCN": "2", "method_NToken": "242", "method_nesting_level": "0"}}}, "hunk_9": {"Ismethod": 1, "added_lines": "505", "deleted_lines": "517,524", "method_info": {"method_name": "test_elbo_irange_iarange", "method_params": "outer_dim,inner_dim,enumerate1,enumerate2,enumerate3", "method_startline": "503", "method_endline": "546", "method_complexity": {"method_NLOC": "21", "method_CCN": "2", "method_NToken": "242", "method_nesting_level": "0"}}}, "hunk_10": {"Ismethod": 1, "added_lines": "400", "deleted_lines": "411,412,413,414,419", "method_info": {"method_name": "test_elbo_iarange_iarange", "method_params": "outer_dim,inner_dim,enumerate1,enumerate2,enumerate3,enumerate4", "method_startline": "398", "method_endline": "446", "method_complexity": {"method_NLOC": "22", "method_CCN": "2", "method_NToken": "249", "method_nesting_level": "0"}}}, "hunk_11": {"Ismethod": 1, "added_lines": "229", "deleted_lines": "248", "method_info": {"method_name": "test_elbo_berns", "method_params": "enumerate1,enumerate2,enumerate3", "method_startline": "227", "method_endline": "261", "method_complexity": {"method_NLOC": "21", "method_CCN": "4", "method_NToken": "251", "method_nesting_level": "0"}}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\infer\\test_gradient.py", "file_new_name": "tests\\infer\\test_gradient.py", "file_complexity": {"file_NLOC": "132", "file_CCN": "21", "file_NToken": "1717"}, "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "29", "deleted_lines": "29", "method_info": {"method_name": "test_subsample_gradient", "method_params": "trace_graph,enum_discrete,reparameterized,subsample", "method_startline": "25", "method_endline": "65", "method_complexity": {"method_NLOC": "26", "method_CCN": "6", "method_NToken": "308", "method_nesting_level": "0"}}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tests\\poutine\\test_properties.py", "file_new_name": "tests\\poutine\\test_properties.py", "file_complexity": {"file_NLOC": "94", "file_CCN": "13", "file_NToken": "912"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "56,69,85", "deleted_lines": "56,69,85"}}}}}}