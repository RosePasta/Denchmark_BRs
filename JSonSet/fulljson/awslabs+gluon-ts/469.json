{"BR": {"BR_id": "469", "BR_author": "RXY3832", "BRopenT": "2019-11-21T03:02:05Z", "BRcloseT": "2020-01-07T12:38:50Z", "BR_text": {"BRsummary": "Best way to add holiday, weekend, weekend features", "BRdescription": "\n What's the best way to add holiday, weekend, weekend features to DeepAR?\n I've seen one example that used feat_dynamic_real, but DeepAR has a parameter for time_features. Is time_features the better way? I have not seen examples of using the time_features parameter anywhere. If time_features is the best option, how would I use it?\n Thanks!\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "RXY3832", "commentT": "2019-11-21T08:19:14Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/RXY3832>@RXY3832</denchmark-link>\n  the  option in the estimator allows you to customize which features (such as the ones you mention) the model should use. The default settings will enable the features which are relevant for the specific frequency that you set: these are selected according to the logic here \n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "RXY3832", "commentT": "2019-11-21T08:22:17Z", "comment_text": "\n \t\tSo, in principle you don\u2019t need to explicitly set them. However, if you really want to customize them you can explicitly provide them in a list:\n <denchmark-code>time_features=[HourOfDay(), DayOfWeek()]\n </denchmark-code>\n \n will make the model see the hour of day and day of week features. You can check the module I linked above to see how to import the necessary stuff.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "RXY3832", "commentT": "2019-11-21T08:24:48Z", "comment_text": "\n \t\tThis said, I agree we should add an example on this :-)\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "RXY3832", "commentT": "2019-11-21T09:16:55Z", "comment_text": "\n \t\tWe also have a few holidays already implemented here: <denchmark-link:https://github.com/awslabs/gluon-ts/blob/master/src/gluonts/time_feature/holiday.py>https://github.com/awslabs/gluon-ts/blob/master/src/gluonts/time_feature/holiday.py</denchmark-link>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "RXY3832", "commentT": "2019-11-21T12:40:25Z", "comment_text": "\n \t\tThanks for the information!\n I tried adding Holidays, like in the link provided, and while Christmas and Christmas Eve worked, other date are giving me AssertionError: No closest holiday for the date index error. Below is the code and more detailed error.\n Code:\n <denchmark-code>from gluonts.time_feature.holiday import (\n         squared_exponential_kernel,\n         SpecialDateFeatureSet,\n         NEW_YEARS_DAY,\n         MARTIN_LUTHER_KING_DAY,\n         SUPERBOWL,\n         THANKSGIVING,\n         CHRISTMAS_EVE,\n         CHRISTMAS_DAY,\n         NEW_YEARS_EVE\n     )\n \n h_days = [NEW_YEARS_DAY,\n           MARTIN_LUTHER_KING_DAY,\n           SUPERBOWL,\n           THANKSGIVING,\n           CHRISTMAS_EVE,\n           CHRISTMAS_DAY,\n           NEW_YEARS_EVE]\n \n #import pandas as pd\n sfs = SpecialDateFeatureSet(h_days)\n date_indices = pd.date_range(\n     start=\"2016-01-01\",\n     end=\"2019-11-30\",\n     freq='D'\n     )\n \n sfs(date_indices)\n </denchmark-code>\n \n Error Details:\n <denchmark-code>---------------------------------------------------------------------------\n AssertionError                            Traceback (most recent call last)\n <ipython-input-50-58f607c96e79> in <module>()\n      27     )\n      28 \n ---> 29 sfs(date_indices)\n \n ~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/gluonts/time_feature/holiday.py in __call__(self, dates)\n     211                     ]\n     212                 )\n --> 213                 for feat_name in self.feature_names\n     214             ]\n     215         )\n \n ~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/gluonts/time_feature/holiday.py in <listcomp>(.0)\n     211                     ]\n     212                 )\n --> 213                 for feat_name in self.feature_names\n     214             ]\n     215         )\n \n ~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/gluonts/time_feature/holiday.py in <listcomp>(.0)\n     208                             SPECIAL_DATE_FEATURES[feat_name](index)\n     209                         )\n --> 210                         for index in dates\n     211                     ]\n     212                 )\n \n ~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/gluonts/time_feature/holiday.py in distance_to_day(index)\n      43         assert (\n      44             len(holiday_date) != 0\n ---> 45         ), f\"No closest holiday for the date index {index} found.\"\n      46         # It sometimes returns two dates if it is exactly half a year after the\n      47         # holiday. In this case, the smaller distance (182 days) is returned.\n \n AssertionError: No closest holiday for the date index 2018-07-18 00:00:00 found.\n </denchmark-code>\n \n Let me know if I should move this over to another thread too.\n Thanks!\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "RXY3832", "commentT": "2019-12-05T08:37:29Z", "comment_text": "\n \t\tSorry for coming back to this so late. I'll look into this.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "RXY3832", "commentT": "2019-12-05T21:36:28Z", "comment_text": "\n \t\ti have the same error -\n code:\n <denchmark-code>from gluonts.time_feature.holiday import (\n         squared_exponential_kernel,\n         SpecialDateFeatureSet,\n         NEW_YEARS_DAY,\n         MARTIN_LUTHER_KING_DAY,\n         SUPERBOWL,\n         THANKSGIVING,\n         CHRISTMAS_EVE,\n         CHRISTMAS_DAY,\n         NEW_YEARS_EVE\n     )\n \n hdays = [NEW_YEARS_DAY,\n           MARTIN_LUTHER_KING_DAY,\n           SUPERBOWL,\n           THANKSGIVING,\n           CHRISTMAS_EVE,\n           CHRISTMAS_DAY,\n           NEW_YEARS_EVE]\n kernel = squared_exponential_kernel(alpha=1.0)\n \n sfs = SpecialDateFeatureSet(hdays, kernel)\n date_indices = pd.date_range(\n      start=\"2018-01-01\",\n      end=\"2019-12-31\",\n      freq='D')\n \n sfs(date_indices)\n </denchmark-code>\n \n error:\n <denchmark-code>---------------------------------------------------------------------------\n AssertionError                            Traceback (most recent call last)\n <ipython-input-55-63f69419d55d> in <module>\n      20 kernel = squared_exponential_kernel(alpha=1.0)\n      21 sfs = SpecialDateFeatureSet(hdays, kernel)\n ---> 22 sfs(dfwide.index)\n \n ~/anaconda3/envs/btq/lib/python3.7/site-packages/gluonts/time_feature/holiday.py in __call__(self, dates)\n     211                     ]\n     212                 )\n --> 213                 for feat_name in self.feature_names\n     214             ]\n     215         )\n \n ~/anaconda3/envs/btq/lib/python3.7/site-packages/gluonts/time_feature/holiday.py in <listcomp>(.0)\n     211                     ]\n     212                 )\n --> 213                 for feat_name in self.feature_names\n     214             ]\n     215         )\n \n ~/anaconda3/envs/btq/lib/python3.7/site-packages/gluonts/time_feature/holiday.py in <listcomp>(.0)\n     208                             SPECIAL_DATE_FEATURES[feat_name](index)\n     209                         )\n --> 210                         for index in dates\n     211                     ]\n     212                 )\n \n ~/anaconda3/envs/btq/lib/python3.7/site-packages/gluonts/time_feature/holiday.py in distance_to_day(index)\n      43         assert (\n      44             len(holiday_date) != 0\n ---> 45         ), f\"No closest holiday for the date index {index} found.\"\n      46         # It sometimes returns two dates if it is exactly half a year after the\n      47         # holiday. In this case, the smaller distance (182 days) is returned.\n \n AssertionError: No closest holiday for the date index 2018-07-18 00:00:00 found.```\n </denchmark-code>\n \n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "RXY3832", "commentT": "2020-01-07T12:39:50Z", "comment_text": "\n \t\tHas been fixed by <denchmark-link:https://github.com/kashif>@kashif</denchmark-link>\n   in <denchmark-link:https://github.com/awslabs/gluon-ts/pull/542>#542</denchmark-link>\n . Thank you <denchmark-link:https://github.com/kashif>@kashif</denchmark-link>\n !\n \t\t"}}}, "commit": {"commit_id": "0bfa906930e09ff3bbffb2b83ee6b96701a8f32b", "commit_author": "Kashif Rasul", "commitT": "2020-01-07 13:38:47+01:00", "commit_complexity": {"commit_NLOC": "None", "commit_CCN": "None", "commit_Nprams": "None"}, "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\gluonts\\time_feature\\holiday.py", "file_new_name": "src\\gluonts\\time_feature\\holiday.py", "file_complexity": {"file_NLOC": "173", "file_CCN": "13", "file_NToken": "750"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "19,33,34,35,68,69,70,71,72,73,74,75,76,77,78,79,97,98,117,118", "deleted_lines": "32,33,34,67,85"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "test\\time_feature\\test_holiday.py", "file_new_name": "test\\time_feature\\test_holiday.py", "file_complexity": {"file_NLOC": "251", "file_CCN": "5", "file_NToken": "855"}, "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "38,39,103,104,105,106,107,108,109,110,111,112,113,114,115,116", "deleted_lines": null}}}}}}