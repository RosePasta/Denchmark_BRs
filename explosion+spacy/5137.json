{"BR": {"BR_id": "5137", "BR_author": "alessandrobokan", "BRopenT": "2020-03-11T23:02:11Z", "BRcloseT": "2020-04-29T11:01:32Z", "BR_text": {"BRsummary": "cfg parameter is empty when run spacy.load()", "BRdescription": "\n <denchmark-h:h2>How to reproduce the behaviour</denchmark-h>\n \n My component class:\n <denchmark-code>class MyComponent(object):\n     name = \"my_component\"\n \n     def __init__(self, nlp, **cfg):\n         self.nlp = nlp\n         self.categories = cfg.get(\"categories\", \"all_categories\")  # cfg is EMPTY\n </denchmark-code>\n \n I used entry points to add the component my_component to the pipeline. I updated the spacy_factories from setup.py. Then I run python setup.py sdist, generate the lib en_core_web_test_sm, and installed it by pip install.\n However, when I run following code:\n <denchmark-code>import spacy\n \n nlp = spacy.load(\"en_core_web_test_sm\", categories=[\"category1\", \"category2\"])\n </denchmark-code>\n \n the parameter cfg from __init__(self, nlp, **cfg): is EMPTY, so I can't get categories.\n Why does this happen? Did I do something wrong? Is this a bug? I just followed the <denchmark-link:https://spacy.io/usage/saving-loading#advanced-cfg>documentation</denchmark-link>\n .\n   is not passed here <denchmark-link:https://github.com/explosion/spaCy/blob/master/spacy/util.py#L209>https://github.com/explosion/spaCy/blob/master/spacy/util.py#L209</denchmark-link>\n \n <denchmark-h:h2>Your Environment</denchmark-h>\n \n \n Operating System: Linux\n Python Version Used: 3.6\n spaCy Version Used: 2.2.3\n Environment Information: virtualenv\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "alessandrobokan", "commentT": "2020-03-13T09:16:53Z", "comment_text": "\n \t\tThanks for the report, this does look like a problem for spacy.load().\n <denchmark-link:https://github.com/ines>@ines</denchmark-link>\n  may have a better idea, but my first suggestion would be that  in  should be used to update the  that's passed to the component:\n     for name in pipeline:\n         if name not in disable:\n             config = meta.get(\"pipeline_args\", {}).get(name, {})\n             config.update(overrides.get(\"pipeline_args\", {}).get(name, {}))\n             factory = factories.get(name, name)\n             component = nlp.create_pipe(factory, config=config)\n             nlp.add_pipe(component, name=name)\n instead of:\n \n \n \n spaCy/spacy/util.py\n \n \n         Lines 205 to 210\n       in\n       26a90f0\n \n \n \n \n \n \n  for name in pipeline: \n \n \n \n  if name not in disable: \n \n \n \n  config = meta.get(\"pipeline_args\", {}).get(name, {}) \n \n \n \n  factory = factories.get(name, name) \n \n \n \n  component = nlp.create_pipe(factory, config=config) \n \n \n \n  nlp.add_pipe(component, name=name) \n \n \n \n \n \n I think a second possibility would be to store the overrides in nlp somewhere so it's accessible to pipeline components from this point on:\n \n \n \n spaCy/spacy/util.py\n \n \n          Line 197\n       in\n       26a90f0\n \n \n \n \n \n \n  nlp = cls(meta=meta, **overrides) \n \n \n \n \n \n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "alessandrobokan", "commentT": "2020-03-27T21:08:52Z", "comment_text": "\n \t\tHello guys, there is no answer from <denchmark-link:https://github.com/adrianeboyd>@adrianeboyd</denchmark-link>\n  ... I think this issue is kinda important. It appear in the spacy documentation also.\n Thanks \ud83d\udc4d\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "alessandrobokan", "commentT": "2020-04-29T11:01:32Z", "comment_text": "\n \t\tAddressed by PR <denchmark-link:https://github.com/explosion/spaCy/pull/5374>#5374</denchmark-link>\n , will be fixed in spaCy 2.3 onwards.\n \t\t"}}}, "commit": {"commit_id": "cfdaf99b8029d6762730c5d5bd2b6f6c173c1241", "commit_author": "Sofie Van Landeghem", "commitT": "2020-04-29 12:56:17+02:00", "changed_files": {"file_0": {"file_change_type": "ADD", "file_Nmethod": 0, "file_old_name": "None", "file_new_name": "spacy\\tests\\regression\\test_issue5137.py"}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "spacy\\util.py", "file_new_name": "spacy\\util.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "211", "deleted_lines": null, "method_info": {"method_name": "load_model_from_path", "method_params": "model_path,meta,overrides", "method_startline": "191", "method_endline": "215"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "website\\docs\\usage\\saving-loading.md", "file_new_name": "website\\docs\\usage\\saving-loading.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "219,464", "deleted_lines": "219,464"}}}}}}