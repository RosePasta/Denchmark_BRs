{"BR": {"BR_id": "39186", "BR_author": "grofte", "BRopenT": "2020-05-05T13:38:20Z", "BRcloseT": "2020-05-08T00:05:00Z", "BR_text": {"BRsummary": "tf.data.experimental.make_csv_dataset modifies mutable variables passed to it", "BRdescription": "\n Please make sure that this is a bug. As per our\n GitHub Policy,\n we only address code/doc bugs, performance issues, feature requests and\n build/installation issues on GitHub. tag:bug_template\n System information\n \n TensorFlow installed from (source or binary): docker\n TensorFlow version (use command below): TF 2.1.0\n \n Describe the current behavior\n tf.data.experimental.make_csv_dataset modifies passed variables in place. So if you call\n \n the variable  is changed. It's in line 463 <denchmark-link:https://github.com/tensorflow/tensorflow/blob/v2.1.0/tensorflow/python/data/experimental/ops/readers.py#L463>https://github.com/tensorflow/tensorflow/blob/v2.1.0/tensorflow/python/data/experimental/ops/readers.py#L463</denchmark-link>\n  but it may happen to other variables passed. Specifically the list sent to  is replaced by a list of the indices of those columns in the file to read.\n Describe the expected behavior\n A function should never modify the mutable objects passed to it. This is only ever appropriate for methods of a class.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "grofte", "commentT": "2020-05-06T05:00:41Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/grofte>@grofte</denchmark-link>\n \n Please provide with simple stand alone code for us to replicate the issue faced.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "grofte", "commentT": "2020-05-06T11:15:15Z", "comment_text": "\n \t\timport tensorflow as tf\n import pandas as pd\n \n df = pd.DataFrame({'a': [2, 3, 5], 'b': [3, 4, 6], 'c': [4, 5, 7]})\n df.to_csv('tf.csv', index=False)\n columns_to_use = ['b', 'c']\n print(columns_to_use)\n ds = tf.data.experimental.make_csv_dataset('tf.csv', \n                                             batch_size=1, \n                                             select_columns=columns_to_use)\n print(columns_to_use)\n ['b', 'c']\n [1, 2]\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "grofte", "commentT": "2020-05-06T11:38:51Z", "comment_text": "\n \t\tI am able to replicate this issue please find the <denchmark-link:https://colab.sandbox.google.com/gist/Saduf2019/e52ece5e44c25385b36a7e6288063ece/untitled166.ipynb>gist here</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "grofte", "commentT": "2020-05-06T19:29:30Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/rachellim>@rachellim</denchmark-link>\n  could you please take a look? thanks\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "grofte", "commentT": "2020-05-07T22:39:25Z", "comment_text": "\n \t\tthanks for catching this <denchmark-link:https://github.com/grofte>@grofte</denchmark-link>\n  ! fix incoming.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "grofte", "commentT": "2020-05-08T00:05:01Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/39186>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/39186>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "79acb0824b8bbb1fb887d2ff625f2f170d80fe1f", "commit_author": "Rachel Lim", "commitT": "2020-05-07 16:54:35-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tensorflow\\python\\data\\experimental\\kernel_tests\\csv_dataset_test.py", "file_new_name": "tensorflow\\python\\data\\experimental\\kernel_tests\\csv_dataset_test.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "44,46", "deleted_lines": "44,46", "method_info": {"method_name": "_setup_files", "method_params": "self,inputs,linebreak,compression_type", "method_startline": "42", "method_endline": "60"}}, "hunk_1": {"Ismethod": 1, "added_lines": "583,584,585,586,587,588,589", "deleted_lines": null, "method_info": {"method_name": "testCsvDataset_immutableParams", "method_params": "self", "method_startline": "583", "method_endline": "589"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\python\\data\\experimental\\ops\\readers.py", "file_new_name": "tensorflow\\python\\data\\experimental\\ops\\readers.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "186,187,188,189,195,196,197,198,202,203,206,207,209", "deleted_lines": "186,192,193,197,200,201,203", "method_info": {"method_name": "_get_sorted_col_indices", "method_params": "select_columns,column_names", "method_startline": "182", "method_endline": "209"}}}}}}}