{"BR": {"BR_id": "9441", "BR_author": "Netzeband", "BRopenT": "2017-04-25T15:38:51Z", "BRcloseT": "2017-05-01T16:22:27Z", "BR_text": {"BRsummary": "Non deterministic behaviour of tf.train.batch in case the number of threads is higher than 1.", "BRdescription": "\n This is related to the StackOverflow question: <denchmark-link:http://stackoverflow.com/questions/43612366/tf-train-batch-output-is-not-deterministic/43613376#43613376>http://stackoverflow.com/questions/43612366/tf-train-batch-output-is-not-deterministic/43613376#43613376</denchmark-link>\n \n The thread owner creates a batch with the following code:\n <denchmark-code>BatchedInputs = tf.train.batch(\n   Inputs,\n   batch_size=64,\n   num_threads=8,\n   capacity=500 + 3 * 64)\n </denchmark-code>\n \n And he noticed that created batches are not in every run the same. They are quite similar, but sometimes the inputs are mixed or some are missing.\n According to the answer on StackOverflow reducing the number of pre-fetch threads to 1 is solving this issue.\n Since this could be an issue for test-set evaluation (where everyone would expect the exact same outcome for every run), I wonder if this is the intended behaviour?\n It should at least be added to the documentation for tf.train.batch that the generated batches can be non-deterministic.\n <denchmark-h:hr></denchmark-h>\n \n <denchmark-h:h3>System information</denchmark-h>\n \n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow):\n Yes\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04):\n Windows 10\n TensorFlow installed from (source or binary):\n Binary (pip3)\n TensorFlow version (use command below):\n 1.1.0\n Bazel version (if compiling from source):\n non\n CUDA/cuDNN version:\n CUDA 8.0, cuDNN 5.1\n GPU model and memory:\n GTX680\n Exact command to reproduce:\n See above.\n \n <denchmark-h:h3>Describe the problem</denchmark-h>\n \n see above\n <denchmark-h:h3>Source code / logs</denchmark-h>\n \n \n \n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Netzeband", "commentT": "2017-04-25T16:14:04Z", "comment_text": "\n \t\tI've added it to our docs fixit event list of documentation items to fix. Thanks for the contribution.\n \t\t"}}}, "commit": {"commit_id": "561fb9b89f49fe12e594f093a7073568c74910ef", "commit_author": "Geoffrey Irving", "commitT": "2017-04-28 16:23:31-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\python\\training\\input.py", "file_new_name": "tensorflow\\python\\training\\input.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "888,889,941,942,986,987,988", "deleted_lines": "888,940"}}}}}}