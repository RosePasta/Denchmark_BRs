{"BR": {"BR_id": "39075", "BR_author": "hartikainen", "BRopenT": "2020-05-01T09:54:27Z", "BRcloseT": "2020-05-05T19:06:12Z", "BR_text": {"BRsummary": "ForwardAccumulator fails with `experimental_run_functions_eagerly(True)`", "BRdescription": "\n System information\n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow): No\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04): macos Catalina\n TensorFlow installed from (source or binary): binary\n TensorFlow version (use command below):  2.2.0rc4\n Python version: 3.7.5\n Bazel version (if compiling from source): n/a\n GCC/Compiler version (if compiling from source): n/a\n CUDA/cuDNN version: n/a\n GPU model and memory: n/a\n \n \n Running the examples in <denchmark-link:https://www.tensorflow.org/api_docs/python/tf/autodiff/ForwardAccumulator>tf.ForwardAccumulator docs</denchmark-link>\n  fail with  when running with .\n \n Running the examples in <denchmark-link:https://www.tensorflow.org/api_docs/python/tf/autodiff/ForwardAccumulator>tf.ForwardAccumulator docs</denchmark-link>\n  with  work the same way as when running with .\n \n This is the standard example from <denchmark-link:https://www.tensorflow.org/api_docs/python/tf/autodiff/ForwardAccumulator>https://www.tensorflow.org/api_docs/python/tf/autodiff/ForwardAccumulator</denchmark-link>\n , with just the  call added.\n import tensorflow as tf\n \n tf.config.experimental_run_functions_eagerly(True)\n \n \n v = tf.Variable([1., 2.])\n with tf.autodiff.ForwardAccumulator(\n     v,\n     # The \"vector\" in Hessian-vector product.\n     tf.constant([1., 0.])) as acc:\n   with tf.GradientTape() as tape:\n     y = tf.reduce_sum(v ** 3.)\n   backward = tape.gradient(y, v)\n backward  # gradient from backprop\n \n acc.jvp(backward)  # forward-over-backward Hessian-vector product\n Other info / logs Include any logs or source code that would be helpful to\n diagnose the problem. If including tracebacks, please include the full\n traceback. Large logs and files should be attached.\n <denchmark-code>...\n     self._push_tape()\n   File \"/Users/hartikainen/conda/envs/policy-evaluation/lib/python3.7/site-packages/tensorflow/python/eager/backprop.py\", line 849, in _push_tape\n     watch_accessed_variables=self._watch_accessed_variables)\n   File \"/Users/hartikainen/conda/envs/policy-evaluation/lib/python3.7/site-packages/tensorflow/python/eager/tape.py\", line 48, in push_new_tape\n     return Tape(tape)\n RecursionError: maximum recursion depth exceeded\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "hartikainen", "commentT": "2020-05-04T06:08:10Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/hartikainen>@hartikainen</denchmark-link>\n \n I have tried in colab with TF 2.1.0, 2.2-rc4 and i am able to reproduce the issue.With  i am able to reproduce the issue.However with i am not seeing any issue.Please, find the gist <denchmark-link:https://colab.sandbox.google.com/gist/ravikyram/6a9e8b37f8f59badd116f25c9de947f9/untitled847.ipynb>here</denchmark-link>\n .Thanks!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "hartikainen", "commentT": "2020-05-04T09:07:32Z", "comment_text": "\n \t\tYep, that's what I see too: fails with tf.config.experimental_run_functions_eagerly(True) and works with tf.config.experimental_run_functions_eagerly(False). Sorry if that was not clear from the title and description.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "hartikainen", "commentT": "2020-05-05T18:44:55Z", "comment_text": "\n \t\tThank you for the report. I'll opt that forwardprop utility function out of run_functions_eagerly. The change should land in a few hours.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "hartikainen", "commentT": "2020-05-05T19:06:13Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/39075>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/39075>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "3e6697b916c9e775dc61375b913d21ba9d22126f", "commit_author": "Allen Lavoie", "commitT": "2020-05-05 12:05:03-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tensorflow\\python\\eager\\forwardprop.py", "file_new_name": "tensorflow\\python\\eager\\forwardprop.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "28,148,149,150,151,152,153,154,156", "deleted_lines": "26,148,150"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tensorflow\\python\\eager\\forwardprop_test.py", "file_new_name": "tensorflow\\python\\eager\\forwardprop_test.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "238,239,240,241,242,243,244,245,246,247", "deleted_lines": null, "method_info": {"method_name": "testRunFunctionsEagerly", "method_params": "self", "method_startline": "238", "method_endline": "247"}}}}}}}