{"BR": {"BR_id": "27431", "BR_author": "guillaumekln", "BRopenT": "2019-04-02T14:40:22Z", "BRcloseT": "2019-04-11T18:20:19Z", "BR_text": {"BRsummary": "Using layer classes as attribute throw an exception", "BRdescription": "\n System information\n \n Have I written custom code: Yes\n OS Platform and Distribution: Ubuntu 16.04\n TensorFlow installed from: binary\n TensorFlow version: 2.0.0.dev20190402\n Python version: 2.7.12\n \n Describe the current behavior\n When a layer class is used as attribute, the code will throw a TypeError exception when calling self._gather_children_attribute. It appears that the layer class is tracked.\n Describe the expected behavior\n Only layer instances should be tracked, not classes.\n Code to reproduce the issue\n import tensorflow as tf\n \n class Layer(tf.keras.layers.Layer):\n \n     def __init__(self):\n         super(Layer, self).__init__()\n         self.layer_fn = tf.keras.layers.Dense\n \n layer = Layer()\n print(layer.variables)\n Other info / logs\n <denchmark-code>Traceback (most recent call last):\n   File \"tf2/class.py\", line 10, in <module>\n     print(layer.variables)\n   File \"/tmp/tf2/local/lib/python2.7/site-packages/tensorflow/python/keras/engine/base_layer.py\", line 1330, in variables\n     return self.weights\n   File \"/tmp/tf2/local/lib/python2.7/site-packages/tensorflow/python/keras/engine/base_layer.py\", line 708, in weights\n     return self.trainable_weights + self.non_trainable_weights\n   File \"/tmp/tf2/local/lib/python2.7/site-packages/tensorflow/python/keras/engine/base_layer.py\", line 687, in trainable_weights\n     nested = self._gather_children_attribute('trainable_weights')\n   File \"/tmp/tf2/local/lib/python2.7/site-packages/tensorflow/python/keras/engine/base_layer.py\", line 1850, in _gather_children_attribute\n     getattr(layer, attribute) for layer in nested_layers))\n TypeError: 'property' object is not iterable\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "guillaumekln", "commentT": "2019-04-04T22:03:50Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/qlzh727>@qlzh727</denchmark-link>\n  this is a better project for someone working on TF Keras. I am realistically never going to get to it. (It's near code I've modified, but I don't think those modifications made the situation any worse.)\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "guillaumekln", "commentT": "2019-04-04T22:07:33Z", "comment_text": "\n \t\tAck, I will take it from here.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "guillaumekln", "commentT": "2019-04-11T18:20:19Z", "comment_text": "\n \t\tShould be fixed by <denchmark-link:https://github.com/tensorflow/tensorflow/commit/9d724a8e6034d321e97cdc9972d4d6e7adb3e3ca>9d724a8</denchmark-link>\n  now.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "guillaumekln", "commentT": "2019-04-11T18:20:20Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=27431>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=27431>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "9d724a8e6034d321e97cdc9972d4d6e7adb3e3ca", "commit_author": "Scott Zhu", "commitT": "2019-04-11 11:14:21-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tensorflow\\python\\keras\\engine\\base_layer_test.py", "file_new_name": "tensorflow\\python\\keras\\engine\\base_layer_test.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "549,550,551", "deleted_lines": null, "method_info": {"method_name": "test_layer_class_not_tracked_as_sublayer.__init__", "method_params": "self", "method_startline": "549", "method_endline": "551"}}, "hunk_1": {"Ismethod": 1, "added_lines": "544,545,546,547,548,549,550,551,552,553,554,555", "deleted_lines": null, "method_info": {"method_name": "test_layer_class_not_tracked_as_sublayer", "method_params": "self", "method_startline": "544", "method_endline": "555"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tensorflow\\python\\training\\tracking\\layer_utils.py", "file_new_name": "tensorflow\\python\\training\\tracking\\layer_utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "37,38", "deleted_lines": "37", "method_info": {"method_name": "has_weights", "method_params": "obj", "method_startline": "33", "method_endline": "38"}}, "hunk_1": {"Ismethod": 1, "added_lines": "30", "deleted_lines": "30", "method_info": {"method_name": "is_layer", "method_params": "obj", "method_startline": "27", "method_endline": "30"}}}}}}}