{"BR": {"BR_id": "4114", "BR_author": "gabrielwen", "BRopenT": "2019-09-11T22:42:18Z", "BRcloseT": "2019-09-17T13:22:24Z", "BR_text": {"BRsummary": "Tests are failing on both master and v0.6-branch", "BRdescription": "\n /kind bug\n \n post-submits are failing 100%: <denchmark-link:https://k8s-testgrid.appspot.com/sig-big-data>link</denchmark-link>\n \n Anything else you would like to add:\n Test TestKfctlClientServer_GoKit is failing on both of branches.\n On master test_endpoint_is_ready is also failing.\n Somehow this doesn't block submissions as presubmits don't include the tests as part of result.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "gabrielwen", "commentT": "2019-09-11T22:42:26Z", "comment_text": "\n \t\tIssue Label Bot is not confident enough to auto-label this issue.\n See <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  for more details.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "gabrielwen", "commentT": "2019-09-11T22:42:28Z", "comment_text": "\n \t\t/priority p0\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "gabrielwen", "commentT": "2019-09-11T22:42:37Z", "comment_text": "\n \t\t/area kfctl\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "gabrielwen", "commentT": "2019-09-16T13:28:45Z", "comment_text": "\n \t\tI think we are out of SSL quota. It doesn't look like we are cleaning up SSL certificates\n <denchmark-link:https://github.com/kubeflow/testing/blob/master/py/kubeflow/testing/cleanup_ci.py>https://github.com/kubeflow/testing/blob/master/py/kubeflow/testing/cleanup_ci.py</denchmark-link>\n \n We recently enabled GKEManaged certificates on master and I think that might be eating up our quota.\n I will add some logic to our cleanup_ci script to cleanup old certificates.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "gabrielwen", "commentT": "2019-09-16T18:06:39Z", "comment_text": "\n \t\tAfter cleaning up the SSL certificates the test_endpoint_is_ready test is passing in the most recent presubmit run\n <denchmark-link:https://k8s-testgrid.appspot.com/sig-big-data#kubeflow-periodic-master>https://k8s-testgrid.appspot.com/sig-big-data#kubeflow-periodic-master</denchmark-link>\n \n github.com/kubeflow/kubeflow/bootstrap/v3/cmd/bootstrap/app.TestKfctlClientServer_GoKit\n Is still failing\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "gabrielwen", "commentT": "2019-09-17T01:28:24Z", "comment_text": "\n \t\tThe test output isn't very helpful.\n /usr/local/go/src/runtime/sys_linux_amd64.s:535 +0x21\n /usr/local/go/src/runtime/os_linux.go:46 +0x4b\n /usr/local/go/src/runtime/lock_futex.go:151 +0xa1\n /usr/local/go/src/runtime/proc.go:1936 +0xc1\n /usr/local/go/src/runtime/proc.go:2399 +0x54a\n /usr/local/go/src/runtime/proc.go:2525 +0x21c\n /usr/local/go/src/runtime/proc.go:2605 +0xa1\n /usr/local/go/src/runtime/asm_amd64.s:299 +0x5b\n /usr/local/go/src/testing/testing.go:917 +0x381\n /usr/local/go/src/testing/testing.go:1157 +0x78\n /usr/local/go/src/testing/testing.go:865 +0xc0\n /usr/local/go/src/testing/testing.go:1155 +0x2a9\n /usr/local/go/src/testing/testing.go:1072 +0x162\n _testmain.go:64 +0x13e\n /go/pkg/mod/k8s.io/klog@v0.3.0/klog.go:975 +0x8b\n /go/pkg/mod/k8s.io/klog@v0.3.0/klog.go:404 +0x6c\n /go/pkg/mod/go.opencensus.io@v0.21.0/stats/view/worker.go:154 +0x100\n /go/pkg/mod/go.opencensus.io@v0.21.0/stats/view/worker.go:32 +0x57\n /usr/local/go/src/runtime/sigqueue.go:139 +0x9c\n /usr/local/go/src/os/signal/signal_unix.go:23 +0x22\n /usr/local/go/src/os/signal/signal_unix.go:29 +0x41\n /mnt/test-data-volume/kubeflow-presubmit-unittests-4129-4b72708-2160-31b5/src/kubeflow/kubeflow/bootstrap/cmd/bootstrap/app/kfctlServer.go:276 +0x96\n /mnt/test-data-volume/kubeflow-presubmit-unittests-4129-4b72708-2160-31b5/src/kubeflow/kubeflow/bootstrap/cmd/bootstrap/app/kfctlServer.go:83 +0x21f\n /go/pkg/mod/github.com/cenkalti/backoff@v2.1.1+incompatible/retry.go:60 +0x1e7\n /go/pkg/mod/github.com/cenkalti/backoff@v2.1.1+incompatible/retry.go:24\n /mnt/test-data-volume/kubeflow-presubmit-unittests-4129-4b72708-2160-31b5/src/kubeflow/kubeflow/bootstrap/cmd/bootstrap/app/kfctlClient.go:118 +0x395\n /mnt/test-data-volume/kubeflow-presubmit-unittests-4129-4b72708-2160-31b5/src/kubeflow/kubeflow/bootstrap/cmd/bootstrap/app/kfctl_test.go:78 +0x7aa\n /usr/local/go/src/testing/testing.go:865 +0xc0\n /usr/local/go/src/testing/testing.go:916 +0x35a\n /usr/local/go/src/runtime/netpoll.go:182 +0x56\n /usr/local/go/src/internal/poll/fd_poll_runtime.go:87 +0x9b\n /usr/local/go/src/internal/poll/fd_poll_runtime.go:92\n /usr/local/go/src/internal/poll/fd_unix.go:384 +0x1ba\n /usr/local/go/src/net/fd_unix.go:238 +0x42\n /usr/local/go/src/net/tcpsock_posix.go:139 +0x32\n /usr/local/go/src/net/tcpsock.go:260 +0x48\n /usr/local/go/src/net/http/server.go:2859 +0x22d\n /usr/local/go/src/net/http/server.go:2456\n /mnt/test-data-volume/kubeflow-presubmit-unittests-4129-4b72708-2160-31b5/src/kubeflow/kubeflow/bootstrap/cmd/bootstrap/app/ksServer.go:845 +0x561\n /mnt/test-data-volume/kubeflow-presubmit-unittests-4129-4b72708-2160-31b5/src/kubeflow/kubeflow/bootstrap/cmd/bootstrap/app/kfctl_test.go:51 +0x34\n /mnt/test-data-volume/kubeflow-presubmit-unittests-4129-4b72708-2160-31b5/src/kubeflow/kubeflow/bootstrap/cmd/bootstrap/app/kfctl_test.go:50 +0x39b\n /usr/local/go/src/runtime/proc.go:307\n /usr/local/go/src/runtime/time.go:105 +0x159\n /mnt/test-data-volume/kubeflow-presubmit-unittests-4129-4b72708-2160-31b5/src/kubeflow/kubeflow/bootstrap/cmd/bootstrap/app/ksServer.go:652 +0x30\n /mnt/test-data-volume/kubeflow-presubmit-unittests-4129-4b72708-2160-31b5/src/kubeflow/kubeflow/bootstrap/cmd/bootstrap/app/ksServer.go:841 +0x484\n /usr/local/go/src/runtime/netpoll.go:182 +0x56\n /usr/local/go/src/internal/poll/fd_poll_runtime.go:87 +0x9b\n /usr/local/go/src/internal/poll/fd_poll_runtime.go:92\n /usr/local/go/src/internal/poll/fd_unix.go:169 +0x19b\n /usr/local/go/src/net/fd_unix.go:202 +0x4f\n /usr/local/go/src/net/net.go:177 +0x69\n /usr/local/go/src/net/http/transport.go:1524 +0x7b\n /usr/local/go/src/bufio/bufio.go:100 +0x10f\n /usr/local/go/src/bufio/bufio.go:138 +0x4f\n /usr/local/go/src/net/http/transport.go:1677 +0x1a3\n /usr/local/go/src/net/http/transport.go:1357 +0xae8\n /usr/local/go/src/net/http/transport.go:1958 +0x113\n /usr/local/go/src/net/http/transport.go:1358 +0xb0d\n /usr/local/go/src/runtime/netpoll.go:182 +0x56\n /usr/local/go/src/internal/poll/fd_poll_runtime.go:87 +0x9b\n /usr/local/go/src/internal/poll/fd_poll_runtime.go:92\n /usr/local/go/src/internal/poll/fd_unix.go:169 +0x19b\n /usr/local/go/src/net/fd_unix.go:202 +0x4f\n /usr/local/go/src/net/net.go:177 +0x69\n /usr/local/go/src/net/http/server.go:787 +0x107\n /usr/local/go/src/bufio/bufio.go:100 +0x10f\n /usr/local/go/src/bufio/bufio.go:138 +0x4f\n /usr/local/go/src/net/http/server.go:964 +0xb5a\n /usr/local/go/src/net/http/server.go:1819 +0x6ad\n /usr/local/go/src/net/http/server.go:2884 +0x2f4\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "gabrielwen", "commentT": "2019-09-17T01:56:37Z", "comment_text": "\n \t\tIt looks like the problem is here\n \n \n \n kubeflow/bootstrap/cmd/bootstrap/app/kfctlClient.go\n \n \n          Line 118\n       in\n       ae9b2c7\n \n \n \n \n \n \n  permErr = backoff.Retry(func() error { \n \n \n \n \n \n The code keeps retrying for up to 30 minutes if the conditions is length 0.\n It looks like this code was recently added in <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4014>#4014</denchmark-link>\n \n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "gabrielwen", "commentT": "2019-09-17T02:05:51Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/kunmingg>@kunmingg</denchmark-link>\n \n Why is createDeployment waiting for up to 30 minutes?\n <denchmark-link:https://github.com/kubeflow/kubeflow/blame/ae9b2c7513c62b497e06d09e1d1f334e7a3c6146/bootstrap/cmd/bootstrap/app/kfctlClient.go#L83>https://github.com/kubeflow/kubeflow/blame/ae9b2c7513c62b497e06d09e1d1f334e7a3c6146/bootstrap/cmd/bootstrap/app/kfctlClient.go#L83</denchmark-link>\n \n This waiting is in the client. Which is called from the router.\n So if we end up waiting for 30 minutes then the request never returns.\n It looks like <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4014>#4014</denchmark-link>\n  was done to monitor the deployment and report metrics.\n Why are we monitoring the deployment from the client and not from the server?\n i.e. why aren't we recording counters about deployment  in handleDeployment in kfctlServer\n <denchmark-link:https://github.com/kubeflow/kubeflow/blob/master/bootstrap/cmd/bootstrap/app/kfctlServer.go#L98>https://github.com/kubeflow/kubeflow/blob/master/bootstrap/cmd/bootstrap/app/kfctlServer.go#L98</denchmark-link>\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "gabrielwen", "commentT": "2019-09-17T02:16:58Z", "comment_text": "\n \t\tServer side metrics are temporary while router side is relatively permanent, we can print router side metrics in stackdriver UI, but summing up server side metrics might overload stackdriver UI backend.\n For TestKfctlClientServer_GoKit case should we return an error from server side?\n Or in kfdef append error to condition?\n Either one should resolve the waiting.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "gabrielwen", "commentT": "2019-09-17T13:22:24Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/kubeflow/testing/issues/412>kubeflow/testing#412</denchmark-link>\n  is tracking why the failed go unit test didn't cause the prow job to be reported as failed.\n Here's a passing postsubmit in which the kfctl_test.go test passed\n <denchmark-link:https://prow.k8s.io/view/gcs/kubernetes-jenkins/logs/kubeflow_kubeflow/kubeflow-postsubmit/1173837237868040192>https://prow.k8s.io/view/gcs/kubernetes-jenkins/logs/kubeflow_kubeflow/kubeflow-postsubmit/1173837237868040192</denchmark-link>\n \n The workflow for basic auth failed but I think that's unrelated to this issue so I'm closing this issue as fixed.\n \t\t"}}}, "commit": {"commit_id": "0d52bb563d5f2f28da0def25f9b55fa99eefb740", "commit_author": "Jeremy Lewi", "commitT": "2019-09-16 22:52:23-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\cmd\\bootstrap\\app\\kfctlClient.go", "file_new_name": "bootstrap\\cmd\\bootstrap\\app\\kfctlClient.go", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "83,84,85,86,87,88,89,90,124,125,126,127,128,129,130,131", "deleted_lines": "83"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\cmd\\bootstrap\\app\\kfctl_test.go", "file_new_name": "bootstrap\\cmd\\bootstrap\\app\\kfctl_test.go", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "78,79", "deleted_lines": "78"}}}}}}