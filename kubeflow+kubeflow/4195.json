{"BR": {"BR_id": "4195", "BR_author": "jlewi", "BRopenT": "2019-09-27T03:41:15Z", "BRcloseT": "2019-09-27T23:53:35Z", "BR_text": {"BRsummary": "kfctl on GCP failed to create the GCP cluster but kept going - issue with reconcile", "BRdescription": "\n /kind bug\n I used kfctl on master at @663e888ac506a1b35ba495b3fa67a8fbd7f5bd61 to deploy on GCP with IAP.\n GKE failed to create the cluster for some reason but kfctl kept going trying to deploy the k8s resources.\n This is a bug in the way reconcile semantics are implemented in apply.\n \n \n \n kubeflow/bootstrap/pkg/kfapp/coordinator/coordinator.go\n \n \n          Line 758\n       in\n       663e888\n \n \n \n \n \n \n  platformErr := platform.Apply(resources) \n \n \n \n \n \n Here if there is an error we just keep going.\n I think we need to fix this by updating apply to use conditions to implement reconcile semantics and not just blindly retry on errors.\n <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4166>#4166</denchmark-link>\n  added conditions. So if the plugin fails we should probably abort.\n Alternatively, kfctl kustomize.go should have some way of determining whether its pointing at the correct cluster.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "jlewi", "commentT": "2019-09-27T03:41:26Z", "comment_text": "\n \t\tIssue Label Bot is not confident enough to auto-label this issue.\n See <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  for more details.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "jlewi", "commentT": "2019-09-27T13:46:45Z", "comment_text": "\n \t\tI think to fix this we will need to make use of conditions\n e.g.\n \n \n \n kubeflow/bootstrap/pkg/apis/apps/kfdef/v1beta1/application_types.go\n \n \n          Line 170\n       in\n       4a3766b\n \n \n \n \n \n \n  func GetPluginSucceededCondition(pluginKind PluginKindType) KfDefConditionType { \n \n \n \n \n \n We should use conditions to indicate whether a plugin is done or had an error/failed. In the event of failure we shouldn't just go on to deploying the K8s applications.\n In the interim we should probably revert the original change: <denchmark-link:https://github.com/kubeflow/kubeflow/pull/4106>#4106</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "2d80547ae67efd630e8d25e5af1ef1abb52025d2", "commit_author": "Jeremy Lewi", "commitT": "2019-09-27 16:49:40-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "bootstrap\\pkg\\kfapp\\coordinator\\coordinator.go", "file_new_name": "bootstrap\\pkg\\kfapp\\coordinator\\coordinator.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "217,218,219,220,221,222", "method_info": {"method_name": "newReconcileReq", "method_params": "error", "method_startline": "217", "method_endline": "222"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247", "method_info": {"method_name": "error", "method_params": "", "method_startline": "225", "method_endline": "247"}}}}}}}