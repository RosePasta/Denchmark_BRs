{"BR": {"BR_id": "4808", "BR_author": "Tomcli", "BRopenT": "2020-02-28T23:24:20Z", "BRcloseT": "2020-06-19T14:09:59Z", "BR_text": {"BRsummary": "Admission Webhook prevents Kubeflow pod deployment.", "BRdescription": "\n /kind bug\n What steps did you take and what happened:\n [A clear and concise description of what the bug is.]\n When admission-webhook-mutating-webhook-configuration deployed before the Admission Webhook pod is ready. The webhook is preventing pod deployment under the kubeflow namespace including the Admission Webhook pod. Thus, it permanently stops all the pod deployment unless we delete the admission-webhook-mutating-webhook-configuration.\n What did you expect to happen:\n admission-webhook at least should not prevent the Admission Webhook pod deployment.\n Anything else you would like to add:\n [Miscellaneous information that will assist in solving the issue.]\n Environment:\n \n Kubeflow version: (version number can be found at the bottom left corner of the Kubeflow dashboard): 1.0\n kfctl version: (use kfctl version): 1.0-rc4\n Kubernetes platform: (e.g. minikube)\n Kubernetes version: (use kubectl version): 1.16\n OS (e.g. from /etc/os-release):\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Tomcli", "commentT": "2020-02-28T23:24:30Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the labels:\n \n \n \n Label\n Probability\n \n \n \n \n kind/bug\n 0.98\n \n \n \n Please mark this comment with  or  to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://github.com/marketplace/issue-label-botdata/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Tomcli", "commentT": "2020-03-03T00:39:08Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Tomcli>@Tomcli</denchmark-link>\n  is this an issue withe admission webhook not being properly scoped to only apply to profile created namespaces?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "Tomcli", "commentT": "2020-03-03T00:55:34Z", "comment_text": "\n \t\tYes, there's no namespace selector for the admission webhook. So probably it's trying to watch pods from all namespaces.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "Tomcli", "commentT": "2020-03-18T00:31:14Z", "comment_text": "\n \t\tthink this is critical - we deployed Tekton with alongside Kubeflow on the same cluster, and it started watching that as well, which is precisely the kind of behavior we need to limit Kubeflow for.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "Tomcli", "commentT": "2020-03-20T22:54:40Z", "comment_text": "\n \t\tIf we are going to add a namespace selector for the admission webhook, what label name would you prefer for the admission webhook.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "Tomcli", "commentT": "2020-03-21T17:46:10Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Tomcli>@Tomcli</denchmark-link>\n  that's a good question!\n Currently, here is the code making the namespaces: \n \n It doesn't apply any kubeflow labels.\n I think it's a good idea to label the profile-created namespaces with a specific label.\n How about , inspired from the <denchmark-link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels/#labels>kubernetes recommended labels</denchmark-link>\n .\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "Tomcli", "commentT": "2020-05-29T14:46:12Z", "comment_text": "\n \t\tAs part of closing this issue lets add a test per <denchmark-link:https://github.com/kubeflow/kubeflow/issues/1213>#1213</denchmark-link>\n ; we've been bitten by admission hooks a couple times now so its worth it to start investing in tests to prevent future problems.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "Tomcli", "commentT": "2020-06-15T17:57:13Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Tomcli>@Tomcli</denchmark-link>\n  Would you be willing to write a unittest?\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "Tomcli", "commentT": "2020-06-16T00:40:44Z", "comment_text": "\n \t\tSorry I missed your previous comment. Sure I can write the unittest for admission manifest.\n \t\t"}}}, "commit": {"commit_id": "a49f658f047f83b634365a238c6a2ba2baa97c9d", "commit_author": "Tommy Li", "commitT": "2020-05-29 07:53:15-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "components\\profile-controller\\controllers\\profile_controller.go", "file_new_name": "components\\profile-controller\\controllers\\profile_controller.go", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "68", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "components\\profile-controller\\controllers\\profile_controller_test.go", "file_new_name": "components\\profile-controller\\controllers\\profile_controller_test.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "25,47", "deleted_lines": null, "method_info": {"method_name": "TestUpdateNamespaceLabels", "method_params": "T", "method_startline": "11", "method_endline": "60"}}}}}}}