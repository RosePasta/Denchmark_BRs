{"BR": {"BR_id": "3891", "BR_author": "Jeffwan", "BRopenT": "2019-08-13T21:02:45Z", "BRcloseT": "2019-08-27T05:36:41Z", "BR_text": {"BRsummary": "Load balancer 443 listener can not be created successfully (aws)", "BRdescription": "\n /kind bug\n aws specific issue\n \n There is a problem with installation instructions here <denchmark-link:https://www.kubeflow.org/docs/aws/deploy/install-kubeflow/>https://www.kubeflow.org/docs/aws/deploy/install-kubeflow/</denchmark-link>\n . in step 5, after calling  I get the response\n <denchmark-code>NAME            HOSTS   ADDRESS   PORTS   AGE\n istio-ingress   *                 80      32m\n </denchmark-code>\n \n Check logs.\n <denchmark-code>E0813 20:54:20.759908       1 :0] kubebuilder/controller \"msg\"=\"Reconciler error\" \"error\"=\"failed to reconcile listeners due to failed to reconcile extra certificates on listener arn:aws:elasticloadbalancing:us-west-2:348134392524:listener/app/1bb9b272-istiosystem-istio-2af2/6d42fb2bee4fa1db/f9f47b6c4897d6fa: AccessDenied: User: arn:aws:sts::348134392524:assumed-role/eksctl-kfworkshop-nodegroup-cpu-n-NodeInstanceRole-5RU3EEH3OLKL/i-064f80cf6e51dbe65 is not authorized to perform: elasticloadbalancing:DescribeListenerCertificates\\n\\tstatus code: 403, request id: 85f03eb8-be0c-11e9-9aed-2792dfdc0674\"  \"controller\"=\"alb-ingress-controller\" \"request\"={\"Namespace\":\"istio-system\",\"Name\":\"istio-ingress\"}\n \n </denchmark-code>\n \n ALB IAM Policy miss elasticloadbalancing:DescribeListenerCertificates and it can not attach certificate to application load balancer.\n What did you expect to happen:\n Load balancer get created by alb ingress controller.\n Environment:\n \n Kubeflow version: (version number can be found at the bottom left corner of the Kubeflow dashboard): v0.6.1\n kfctl version: (use kfctl version): v0.6.1-rc.2-1-g3a37cbc6\n Kubernetes platform: (e.g. minikube): aws\n Kubernetes version: (use kubectl version): 1.13.7\n OS (e.g. from /etc/os-release): darwin\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Jeffwan", "commentT": "2019-08-13T21:02:47Z", "comment_text": "\n \t\tIssue-Label Bot is automatically applying the label kind/bug to this issue, with a confidence of 0.98. Please mark this comment with \ud83d\udc4d or \ud83d\udc4e to give our bot feedback!\n Links: <denchmark-link:https://github.com/marketplace/issue-label-bot>app homepage</denchmark-link>\n , <denchmark-link:https://mlbot.net/data/kubeflow/kubeflow>dashboard</denchmark-link>\n  and <denchmark-link:https://github.com/hamelsmu/MLapp>code</denchmark-link>\n  for this bot.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Jeffwan", "commentT": "2019-08-13T21:03:27Z", "comment_text": "\n \t\tI will have a patch to fix this issue.\n /assign\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "Jeffwan", "commentT": "2019-09-07T16:22:41Z", "comment_text": "\n \t\tec2:DescribeNetworkInterfaces is also missing now\n <denchmark-link:https://github.com/kubernetes-sigs/aws-load-balancer-controller/issues/912>kubernetes-sigs/aws-load-balancer-controller#912</denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "Jeffwan", "commentT": "2019-09-10T19:03:06Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/jamesthegiantpeach>@jamesthegiantpeach</denchmark-link>\n  It's included in the merged PR. please have a check\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "Jeffwan", "commentT": "2019-09-10T21:53:39Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Jeffwan>@Jeffwan</denchmark-link>\n  Can you describe how to apply the files changed in <denchmark-link:https://github.com/kubeflow/kubeflow/pull/3895>#3895</denchmark-link>\n  to resolve the load balancer issue?\n I too am following documentation from <denchmark-link:https://www.kubeflow.org/docs/aws/deploy/install-kubeflow/>https://www.kubeflow.org/docs/aws/deploy/install-kubeflow/</denchmark-link>\n  on a vanilla EKS cluster created by\n <denchmark-code>eksctl create cluster \\\n --name demokf \\\n --version 1.13 \\\n --nodegroup-name standard-workers \\\n --node-type t3.large \\\n --nodes 3 \\\n --nodes-min 1 \\\n --nodes-max 4 \\\n --node-ami auto\n </denchmark-code>\n \n and using kfctl v0.6.2\n I'm at the  step and replaced my kfctl_aws.yaml at /tmp/kfctl_aws.yaml. But where do we put kfctl_aws_cognito.yaml and iam_alb_ingress_policy.json from <denchmark-link:https://github.com/kubeflow/kubeflow/pull/3895>#3895</denchmark-link>\n  ?\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "Jeffwan", "commentT": "2019-09-10T21:59:43Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/danieldn>@danieldn</denchmark-link>\n  I changed it by just editing the generated iam_alb_ingress_policy.json file in the aws_config dir\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "Jeffwan", "commentT": "2019-09-10T22:58:25Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/danieldn>@danieldn</denchmark-link>\n  You can either use or .\n iam_alb_ingress_policy will be copied to your workdir after you run \n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "Jeffwan", "commentT": "2019-09-11T15:27:15Z", "comment_text": "\n \t\tThanks for clarification. Confirming this works for me now after performing step 1 with wget on the updated kfctl_aws.yaml and then proceeding through rest of documentation.\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "Jeffwan", "commentT": "2020-01-21T23:58:07Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Jeffwan>@Jeffwan</denchmark-link>\n  I'm running into an issue where the ALB is created, but there are no listeners. Trying to use the . How did you debug your original issue? Like finding the logs for \n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "Jeffwan", "commentT": "2020-02-05T09:27:05Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/wdhorton>@wdhorton</denchmark-link>\n  did you resolve this? I am also getting no listener being created in the ALB for port 443.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "Jeffwan", "commentT": "2020-02-15T00:37:12Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/wdhorton>@wdhorton</denchmark-link>\n  <denchmark-link:https://github.com/dilzeem>@dilzeem</denchmark-link>\n  Does this PR address your problem? <denchmark-link:https://github.com/kubeflow/manifests/commit/c799b2873c9a92edfe3b966027df4934f048602c>kubeflow/manifests@c799b28</denchmark-link>\n \n I will backport to v1.0.1\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "Jeffwan", "commentT": "2020-02-17T17:20:36Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Jeffwan>@Jeffwan</denchmark-link>\n  is there way to reference this commit in the  file?\n I tried modifying this section in the kfctl_aws_cognito.v1.0.0.yaml file but to no avail\n   repos:\n   - name: manifests\n     uri: https://github.com/kubeflow/manifests/archive/v1.0-branch.tar.gz\n   version: v1.0.0\n I tried then manually copying the files into the kustomize folder and ran kfctl apply, and I get this:\n <denchmark-link:https://user-images.githubusercontent.com/8899724/74674033-c803af00-51b0-11ea-85fe-0662177ce91d.png></denchmark-link>\n \n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "Jeffwan", "commentT": "2020-02-18T09:19:37Z", "comment_text": "\n \t\tSo I figured out how to reference that exact commit. Tried deploying, and no ALB was created at all.\n This is the error that is logged\n <denchmark-code>namespace/cert-manager created\n mutatingwebhookconfiguration.admissionregistration.k8s.io/cert-manager-webhook created\n serviceaccount/cert-manager created\n serviceaccount/cert-manager-cainjector created\n serviceaccount/cert-manager-webhook created\n clusterrole.rbac.authorization.k8s.io/cert-manager-edit created\n clusterrole.rbac.authorization.k8s.io/cert-manager-view created\n clusterrole.rbac.authorization.k8s.io/cert-manager-webhook:webhook-requester created\n clusterrole.rbac.authorization.k8s.io/cert-manager-cainjector created\n clusterrole.rbac.authorization.k8s.io/cert-manager-controller-certificates created\n clusterrole.rbac.authorization.k8s.io/cert-manager-controller-challenges created\n clusterrole.rbac.authorization.k8s.io/cert-manager-controller-clusterissuers created\n clusterrole.rbac.authorization.k8s.io/cert-manager-controller-ingress-shim created\n clusterrole.rbac.authorization.k8s.io/cert-manager-controller-issuers created\n clusterrole.rbac.authorization.k8s.io/cert-manager-controller-orders created\n clusterrolebinding.rbac.authorization.k8s.io/cert-manager-cainjector created\n clusterrolebinding.rbac.authorization.k8s.io/cert-manager-controller-certificates created\n clusterrolebinding.rbac.authorization.k8s.io/cert-manager-controller-challenges created\n clusterrolebinding.rbac.authorization.k8s.io/cert-manager-controller-clusterissuers created\n clusterrolebinding.rbac.authorization.k8s.io/cert-manager-controller-ingress-shim created\n clusterrolebinding.rbac.authorization.k8s.io/cert-manager-controller-issuers created\n clusterrolebinding.rbac.authorization.k8s.io/cert-manager-controller-orders created\n clusterrolebinding.rbac.authorization.k8s.io/cert-manager-webhook:auth-delegator created\n configmap/cert-manager-parameters created\n service/cert-manager created\n service/cert-manager-webhook created\n deployment.apps/cert-manager created\n deployment.apps/cert-manager-cainjector created\n deployment.apps/cert-manager-webhook created\n apiservice.apiregistration.k8s.io/v1beta1.webhook.cert-manager.io created\n application.app.k8s.io/cert-manager created\n validatingwebhookconfiguration.admissionregistration.k8s.io/cert-manager-webhook created\n WARN[0043] Encountered error applying application cert-manager:  (kubeflow.error): Code 500 with message: Apply.Run  Error error when creating \"/tmp/kout804151543\": Internal error occurred: failed calling webhook \"webhook.cert-manager.io\": the server is currently unable to handle the request  filename=\"kustomize/kustomize.go:202\"\n WARN[0043] Will retry in 2 seconds.                      filename=\"kustomize/kustomize.go:203\"\n </denchmark-code>\n \n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "Jeffwan", "commentT": "2020-02-18T09:51:07Z", "comment_text": "\n \t\tOkay the ALB and listener are created with the commit works and work with kfctl_aws_cognito.0.7.1.yaml\n It does not work with kfctl_aws_cognito.v1.0.0.yaml\n \t\t"}, "comments_14": {"comment_id": 15, "comment_author": "Jeffwan", "commentT": "2020-02-19T09:10:54Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/dilzeem>@dilzeem</denchmark-link>\n \n Cert-managed is the new package in 1.0 and it will just wait for webhook pod to be ready and then retry. This is not an issue.\n em.. As I remember, we didn't make changes from 0.7.1 -> 1.0.0 on the manifest.\n \n Okay the ALB and listener are created with the commit works and work with kfctl_aws_cognito.0.7.1.yaml\n \n You mean the commit doesn't work with v1.0.0 but 0.7.1?  That's weird. This PR should address the problem. You still see HTTP:80 in listeners?\n \t\t"}, "comments_15": {"comment_id": 16, "comment_author": "Jeffwan", "commentT": "2020-02-19T09:16:01Z", "comment_text": "\n \t\t\n You mean the commit doesn't work with v1.0.0 but 0.7.1?\n \n yes\n \n You still see HTTP:80 in listeners?\n \n In v1.0 I didn't even see the ALB create.\n In v0.71 it created and had the HTTPS:443 listener. As expected.\n That is strange I get something different with the version, if nothing has changed. I can double check again later today with v1.0.\n \t\t"}, "comments_16": {"comment_id": 17, "comment_author": "Jeffwan", "commentT": "2020-02-19T20:24:37Z", "comment_text": "\n \t\tPlease double check with 1.0 and I at least see HTTP:80 without patch using v1.0. If you still have problems, please share alb-ingress-controller logs\n \t\t"}, "comments_17": {"comment_id": 18, "comment_author": "Jeffwan", "commentT": "2020-02-28T16:58:12Z", "comment_text": "\n \t\tOkay I tried with version 1.0, and ALB gets created by no listener.\n When I apply the patch uri: https://github.com/kubeflow/manifests/archive/c799b2873c9a92edfe3b966027df4934f048602c.tar.gz to version 1.0, I get an error with regards to a missing kustomize/aws-istio-authz-adaptor directory.\n \t\t"}, "comments_18": {"comment_id": 19, "comment_author": "Jeffwan", "commentT": "2020-03-02T13:44:17Z", "comment_text": "\n \t\tOkay now following this.\n <denchmark-link:https://www.kubeflow.org/docs/aws/aws-e2e/>https://www.kubeflow.org/docs/aws/aws-e2e/</denchmark-link>\n \n I believed I was using the wrong kfctl_aws_cognito.v1.0.0.yaml file\n \t\t"}}}, "commit": {"commit_id": "3efa764868bb633b491dc3ee201e133f0effa3e2", "commit_author": "Jiaxin Shan", "commitT": "2019-08-26 22:36:40-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\kfctl_aws.yaml", "file_new_name": "bootstrap\\config\\kfctl_aws.yaml", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "114,115,227,228,229,230,231,232,233,234,235,236,237,238", "deleted_lines": "177,178,187,188"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "bootstrap\\config\\kfctl_aws_cognito.yaml", "file_new_name": "bootstrap\\config\\kfctl_aws_cognito.yaml", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "114,115,231,232,233,234,235,236,237,238,239,240,241,242", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "deployment\\aws\\infra_configs\\iam_alb_ingress_policy.json", "file_new_name": "deployment\\aws\\infra_configs\\iam_alb_ingress_policy.json", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "21,22,25,26,40,51,67,79,85,86,87,88,89,90,91,118", "deleted_lines": "101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,122"}}}}}}