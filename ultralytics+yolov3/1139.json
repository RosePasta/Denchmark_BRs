{"BR": {"BR_id": "1139", "BR_author": "glenn-jocher", "BRopenT": "2020-05-06T17:17:21Z", "BRcloseT": "2020-05-06T17:26:37Z", "BR_text": {"BRsummary": "RuntimeError: CUDA error: CUBLAS_STATUS_ALLOC_FAILED when calling `cublasCreate(handle)`", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n <denchmark-code>Traceback (most recent call last):\n   File \"train.py\", line 399, in <module>\n     train()\n   File \"train.py\", line 308, in train\n     multi_label=ni > n_burn)\n   File \"/usr/src/app/test.py\", line 92, in test\n     output = non_max_suppression(inf_out, conf_thres=conf_thres, iou_thres=iou_thres, multi_label=multi_label)\n   File \"/usr/src/app/utils/utils.py\", line 558, in non_max_suppression\n     x[i, :4] = torch.mm(weights / weights.sum(1, keepdim=True), x[:, :4]).float()  # merged boxes\n   File \"/opt/conda/lib/python3.6/site-packages/apex/amp/wrap.py\", line 28, in wrapper\n     return orig_fn(*new_args, **kwargs)\n RuntimeError: CUDA error: CUBLAS_STATUS_ALLOC_FAILED when calling `cublasCreate(handle)`\n \n </denchmark-code>\n \n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n <denchmark-code>python train.py\n </denchmark-code>\n \n <denchmark-h:h2>Expected behavior</denchmark-h>\n \n Train normally\n <denchmark-h:h2>Environment</denchmark-h>\n \n GCP Deep Learning VM\n <denchmark-h:h2>Additional context</denchmark-h>\n \n Problem originates in matrix multiplication in merge NMS, appears to be a CUDA issue. Will attempt to resolve by placing affected region in try pass statement.\n <denchmark-code>x[i, :4] = torch.mm(weights / weights.sum(1, keepdim=True), x[:, :4]).float()  # merged boxes\n </denchmark-code>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "965155ee60b534e0f71029a1c7ddc0a2cad50f8d", "commit_author": "Glenn Jocher", "commitT": "2020-05-06 10:26:28-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "utils\\utils.py", "file_new_name": "utils\\utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "559,560,561,562,563,564,565,566,567", "deleted_lines": "559,560,561,562,563,564,565", "method_info": {"method_name": "non_max_suppression", "method_params": "prediction,conf_thres,iou_thres,multi_label,classes,agnostic", "method_startline": "497", "method_endline": "575"}}}}}}}