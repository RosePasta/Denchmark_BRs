{"BR": {"BR_id": "520", "BR_author": "ftesser", "BRopenT": "2020-09-05T05:49:38Z", "BRcloseT": "2020-09-14T16:33:11Z", "BR_text": {"BRsummary": "`examples/natural_questions.py` fails", "BRdescription": "\n Describe the bug\n Running the examples/natural_questions.py script I obtain the error below.\n The error is thrown from model.inference_from_dicts method.\n Error message\n <denchmark-code>\"\"\"\n Traceback (most recent call last):\n   File \"/usr/lib/python3.8/multiprocessing/pool.py\", line 125, in worker\n     result = (True, func(*args, **kwds))\n   File \"/home/fabio/src/git_repositories/FARM/farm/infer.py\", line 569, in _create_datasets_chunkwise\n     dataset, tensor_names, baskets = processor.dataset_from_dicts(dicts, indices, return_baskets=True)\n   File \"/home/fabio/src/git_repositories/FARM/farm/data_handler/processor.py\", line 361, in dataset_from_dicts\n     id_external = self._id_from_dict(d)\n   File \"/home/fabio/src/git_repositories/FARM/farm/data_handler/processor.py\", line 403, in _id_from_dict\n     ext_id = try_get(ID_NAMES, d[\"qas\"][0])\n   File \"/home/fabio/src/git_repositories/FARM/farm/utils.py\", line 432, in try_get\n     ret = dictionary[key]\n TypeError: string indices must be integers\n \"\"\"\n \n The above exception was the direct cause of the following exception:\n \n Traceback (most recent call last):\n   File \"/home/fabio/src/git_repositories/FARM/examples/natural_questions.py\", line 142, in <module>\n     question_answering()\n   File \"/home/fabio/src/git_repositories/FARM/examples/natural_questions.py\", line 135, in question_answering\n     result = model.inference_from_dicts(dicts=QA_input, return_json=False) # result is a list of QAPred objects\n   File \"/home/fabio/src/git_repositories/FARM/farm/infer.py\", line 696, in inference_from_dicts\n     return Inferencer.inference_from_dicts(self, dicts, return_json=return_json,\n   File \"/home/fabio/src/git_repositories/FARM/farm/infer.py\", line 474, in inference_from_dicts\n     return list(predictions)\n   File \"/home/fabio/src/git_repositories/FARM/farm/infer.py\", line 545, in _inference_with_multiprocessing\n     for dataset, tensor_names, baskets in results:\n   File \"/usr/lib/python3.8/multiprocessing/pool.py\", line 865, in next\n     raise value\n TypeError: string indices must be integers\n \n </denchmark-code>\n \n Expected behavior\n NO errors\n Additional context\n It seems that QA_input in the format  \"qas\" + \"context\" is not managed here.\n In fact if I try to use the \"questions\" + \"text\" keys in the QA_input dictionary, no errors are thrown.\n To Reproduce\n run examples/natural_questions.py (to save time: the same error is obtained  running the script just from point 9 (\n \n \n FARM/examples/natural_questions.py\n \n \n          Line 125\n       in\n       c6871b6\n \n \n \n \n \n \n  # 9. Since training on the whole NQ corpus requires substantial compute resources we trained and uploaded a model on s3 \n \n \n \n \n )\n System:\n \n OS: Linux Ubuntu 20.04.1 LTS\n GPU/CPU: both\n FARM version: 0.4.7\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ftesser", "commentT": "2020-09-05T08:42:16Z", "comment_text": "\n \t\tThanks for reporting. I can reproduce the error and created a quick fix in <denchmark-link:https://github.com/deepset-ai/FARM/pull/521>#521</denchmark-link>\n \n You can base your experiments off of this branch <denchmark-link:https://github.com/ftesser>@ftesser</denchmark-link>\n  until we find a better solution and merge it into master.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ftesser", "commentT": "2020-09-07T11:38:35Z", "comment_text": "\n \t\tthanks <denchmark-link:https://github.com/Timoeller>@Timoeller</denchmark-link>\n  I see your fix also in the master now\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "ftesser", "commentT": "2020-09-07T12:02:31Z", "comment_text": "\n \t\tExactly, we quick-fixed it and will work on a more general solution, as Branden mentioned, later on.\n Is the issue fixed for you?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "ftesser", "commentT": "2020-09-07T13:28:07Z", "comment_text": "\n \t\t\n Is the issue fixed for you?\n \n yes, thanks!\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "ftesser", "commentT": "2020-09-14T16:33:10Z", "comment_text": "\n \t\tFixed in <denchmark-link:https://github.com/deepset-ai/FARM/pull/521>#521</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "d7b5cb61f062436789aa9081a85ade4f56e2db6f", "commit_author": "Timo Moeller", "commitT": "2020-09-07 12:47:17+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "examples\\natural_questions.py", "file_new_name": "examples\\natural_questions.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "139", "deleted_lines": "139", "method_info": {"method_name": "question_answering", "method_params": "", "method_startline": "19", "method_endline": "139"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "farm\\utils.py", "file_new_name": "farm\\utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "430,431,432,433,434,435,436,437,438", "deleted_lines": "430,431,432,433,434,435", "method_info": {"method_name": "try_get", "method_params": "keys,dictionary", "method_startline": "429", "method_endline": "439"}}}}}}}