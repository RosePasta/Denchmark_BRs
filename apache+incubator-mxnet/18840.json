{"BR": {"BR_id": "18840", "BR_author": "eric-haibin-lin", "BRopenT": "2020-08-02T05:44:04Z", "BRcloseT": "2020-08-03T20:11:07Z", "BR_text": {"BRsummary": "MacOS nightly build broken", "BRdescription": "\n <denchmark-code>pip install https://repo.mxnet.io/dist/python/cpu/mxnet-2.0.0b20200802-py3-none-macosx_10_14_x86_64.whl --user \n \n </denchmark-code>\n \n  probably caused by <denchmark-link:https://github.com/apache/incubator-mxnet/pull/18836>#18836</denchmark-link>\n   or <denchmark-link:https://github.com/apache/incubator-mxnet/pull/18796>#18796</denchmark-link>\n \n <denchmark-code>Traceback (most recent call last):\n   File \"<string>\", line 1, in <module>\n   File \"/Users/haibilin/.local/lib/python3.7/site-packages/mxnet/__init__.py\", line 23, in <module>\n     from .context import Context, current_context, cpu, gpu, cpu_pinned\n   File \"/Users/haibilin/.local/lib/python3.7/site-packages/mxnet/context.py\", line 20, in <module>\n     from .base import _LIB\n   File \"/Users/haibilin/.local/lib/python3.7/site-packages/mxnet/base.py\", line 288, in <module>\n     _LIB = _load_lib()\n   File \"/Users/haibilin/.local/lib/python3.7/site-packages/mxnet/base.py\", line 279, in _load_lib\n     lib = ctypes.CDLL(lib_path[0], ctypes.RTLD_LOCAL)\n   File \"/opt/miniconda3/lib/python3.7/ctypes/__init__.py\", line 364, in __init__\n     self._handle = _dlopen(self._name, mode)\n OSError: dlopen(/Users/haibilin/.local/lib/python3.7/site-packages/mxnet/libmxnet.dylib, 6): Library not loaded: /Users/travis/build/dmlc/mxnet-distro/mxnet-build/staticdeps/lib/libprotobuf.15.dylib\n   Referenced from: /Users/haibilin/.local/lib/python3.7/site-packages/mxnet/libmxnet.dylib\n   Reason: image not found\n </denchmark-code>\n \n <denchmark-code>curl --retry 10 -s https://raw.githubusercontent.com/dmlc/gluon-nlp/master/tools/diagnose.py | python\n \n ----------Python Info----------\n Version      : 3.7.4\n Compiler     : Clang 4.0.1 (tags/RELEASE_401/final)\n Build        : ('default', 'Aug 13 2019 15:17:50')\n Arch         : ('64bit', '')\n ------------Pip Info-----------\n Version      : 19.3.1\n Directory    : /opt/miniconda3/lib/python3.7/site-packages/pip\n ----------MXNet Info-----------\n Hashtag not found. Not installed from pre-built package.\n ----------System Info----------\n Platform     : Darwin-18.7.0-x86_64-i386-64bit\n system       : Darwin\n node         : a483e7be4c92.ant.amazon.com\n release      : 18.7.0\n version      : Darwin Kernel Version 18.7.0: Mon Feb 10 21:08:45 PST 2020; root:xnu-4903.278.28~1/RELEASE_X86_64\n ----------Hardware Info----------\n machine      : x86_64\n processor    : i386\n b'machdep.cpu.brand_string: Intel(R) Core(TM) i7-8569U CPU @ 2.80GHz'\n b'machdep.cpu.features: FPU VME DE PSE TSC MSR PAE MCE CX8 APIC SEP MTRR PGE MCA CMOV PAT PSE36 CLFSH DS ACPI MMX FXSR SSE SSE2 SS HTT TM PBE SSE3 PCLMULQDQ DTES64 MON DSCPL VMX EST TM2 SSSE3 FMA CX16 TPR PDCM SSE4.1 SSE4.2 x2APIC MOVBE POPCNT AES PCID XSAVE OSXSAVE SEGLIM64 TSCTMR AVX1.0 RDRAND F16C'\n b'machdep.cpu.leaf7_features: RDWRFSGS TSC_THREAD_OFFSET SGX BMI1 AVX2 SMEP BMI2 ERMS INVPCID FPU_CSDS MPX RDSEED ADX SMAP CLFSOPT IPT MDCLEAR TSXFA IBRS STIBP L1DF SSBD'\n b'machdep.cpu.extfeatures: SYSCALL XD 1GBPAGE EM64T LAHF LZCNT PREFETCHW RDTSCP TSCI'\n ----------Network Test----------\n </denchmark-code>\n \n <denchmark-link:https://github.com/leezu>@leezu</denchmark-link>\n   FYI\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "eric-haibin-lin", "commentT": "2020-08-02T06:09:14Z", "comment_text": "\n \t\tLooks like protobuf was missing. I think in the past we've been statically linking protobuf. <denchmark-link:https://github.com/leezu>@leezu</denchmark-link>\n  is the change towards dynamic linking intentional?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "eric-haibin-lin", "commentT": "2020-08-03T16:33:15Z", "comment_text": "\n \t\tActually it's changed to static linkage <denchmark-link:https://github.com/szha>@szha</denchmark-link>\n :\n \n \n \n incubator-mxnet/CMakeLists.txt\n \n \n         Lines 151 to 157\n       in\n       51340d8\n \n \n \n \n \n \n  if(CMAKE_BUILD_TYPE STREQUAL \"Distribution\" AND UNIX AND NOT APPLE) \n \n \n \n  set(CMAKE_BUILD_WITH_INSTALL_RPATH ON) \n \n \n \n  set(CMAKE_INSTALL_RPATH $\\{ORIGIN\\}) \n \n \n \n  # Enforce DT_PATH instead of DT_RUNPATH \n \n \n \n  set(CMAKE_SHARED_LINKER_FLAGS \"-Wl,--disable-new-dtags\") \n \n \n \n  set(CMAKE_EXE_LINKER_FLAGS \"-Wl,--disable-new-dtags\") \n \n \n \n  set(Protobuf_USE_STATIC_LIBS ON) \n \n \n \n \n \n The problem is though that there is a AND NOT APPLE in the if condition. Need to move the static linkage option to a separate if clause.\n Previously we have not linked protobuf in the cmake build as ps-lite was disabled.\n \t\t"}}}, "commit": {"commit_id": "f872b43407ccfb7d17fe7492c7d869b83194f3a6", "commit_author": "Leonard Lausen", "commitT": "2020-08-03 13:11:06-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CMakeLists.txt", "file_new_name": "CMakeLists.txt", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "151,152,153,154,155,156,157,158", "deleted_lines": "151,152,153,154,155,156"}}}}}}