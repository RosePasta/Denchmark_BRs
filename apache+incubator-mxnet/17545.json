{"BR": {"BR_id": "17545", "BR_author": "apeforest", "BRopenT": "2020-02-07T18:45:05Z", "BRcloseT": "2020-02-09T21:19:29Z", "BR_text": {"BRsummary": "CMake GPU build broken by #16654", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n The CMake build instruction on ubuntu not working on a ubuntu instance with DLAMI\n <denchmark-h:h3>Error Message</denchmark-h>\n \n FAILED: : && /usr/bin/c++  -mf16c -Wall -Wno-unknown-pragmas -Wno-sign-compare -O3 -msse3 -std=c++11 -fopenmp   tests/CMakeFiles/mxnet_unit_tests.dir/cpp/engine/engine_shutdown_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/engine/omp_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/engine/thread_local_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/engine/threaded_engine_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/kvstore/gpu_topology_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/misc/base.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/misc/libinfo_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/activation_perf.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/batchnorm_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/coreop_perf.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/dropout_perf.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/fully_conn_perf.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/krprod_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/mkldnn_operator_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/mkldnn_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/runner/core_op_runner_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/slice_channel_perf.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/operator/tune/operator_tune_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/storage/storage_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/test_main.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cpp/thread_safety/thread_safety_test.cc.o tests/CMakeFiles/mxnet_unit_tests.dir/cmake_device_link.o  -o tests/mxnet_unit_tests -L/usr/local/cuda/lib64  -L/usr/local/cuda/lib64/stubs -Wl,-rpath,/usr/local/cuda/lib64:/usr/local/lib:/home/ubuntu/src/incubator-mxnet/build/3rdparty/openmp/runtime/src lib/libgtest.a -Wl,--whole-archive libmxnet.a -Wl,--no-whole-archive 3rdparty/dmlc-core/libdmlc.a 3rdparty/mkldnn/src/libdnnl.a /usr/local/lib/libopenblas.so /usr/lib/x86_64-linux-gnu/librt.so /usr/local/lib/libopencv_highgui.so.4.0.0 3rdparty/openmp/runtime/src/libomp.so -lpthread -llapack /usr/local/cuda/lib64/libcudnn.so /usr/local/lib/libopencv_videoio.so.4.0.0 /usr/local/lib/libopencv_imgcodecs.so.4.0.0 /usr/local/lib/libopencv_imgproc.so.4.0.0 /usr/local/lib/libopencv_core.so.4.0.0 -lpthread /usr/local/cuda/lib64/libcudart.so /usr/lib/x86_64-linux-gnu/libcublas.so /usr/local/cuda/lib64/libcufft.so /usr/local/cuda/lib64/libcusolver.so /usr/local/cuda/lib64/libcurand.so /usr/local/cuda/lib64/libnvToolsExt.so -ldl -lrt -lcudadevrt -lcudart_static -lrt -lpthread -ldl && :\n libmxnet.a(cached_op.cc.o): In function mxnet::CachedOp::CachedOpState::CachedOpState(mxnet::Context const&, nnvm::Graph const&, nnvm::Graph const&, bool)': cached_op.cc:(.text._ZN5mxnet8CachedOp13CachedOpStateC2ERKNS_7ContextERKN4nnvm5GraphES8_b[_ZN5mxnet8CachedOp13CachedOpStateC5ERKNS_7ContextERKN4nnvm5GraphES8_b]+0x6e9): undefined reference to mxnet::exec::FusePointwiseForward(nnvm::Graph&&)'\n cached_op.cc:(.text._ZN5mxnet8CachedOp13CachedOpStateC2ERKNS_7ContextERKN4nnvm5GraphES8_b[_ZN5mxnet8CachedOp13CachedOpStateC5ERKNS_7ContextERKN4nnvm5GraphES8_b]+0x7c5): undefined reference to `mxnet::exec::FusePointwiseBackward(nnvm::Graph&&)'\n collect2: error: ld returned 1 exit status\n [587/587] Linking CXX shared library libmxnet.so\n ninja: build stopped: subcommand failed.\n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n Follow exactly the steps on <denchmark-link:https://mxnet.apache.org/get_started/ubuntu_setup.html>https://mxnet.apache.org/get_started/ubuntu_setup.html</denchmark-link>\n \n <denchmark-h:h3>Steps to reproduce</denchmark-h>\n \n git clone --recursive <denchmark-link:https://github.com/apache/incubator-mxnet.git>https://github.com/apache/incubator-mxnet.git</denchmark-link>\n  mxnet\n cd mxnet\n cp config/config.cmake config.cmake\n rm -rf build\n mkdir -p build && cd build\n cmake -GNinja -C ../config.cmake ..\n cmake --build . --parallel 8\n <denchmark-h:h2>Environment</denchmark-h>\n \n <denchmark-code>----------Python Info----------\n Version      : 3.6.6\n Compiler     : GCC 7.2.0\n Build        : ('default', 'Jun 28 2018 17:14:51')\n Arch         : ('64bit', '')\n ------------Pip Info-----------\n Version      : 19.3.1\n Directory    : /home/ubuntu/anaconda3/lib/python3.6/site-packages/pip\n ----------MXNet Info-----------\n Version      : 1.6.0\n Directory    : /home/ubuntu/src/mxnet/python/mxnet\n Num GPUs     : 8\n Hashtag not found. Not installed from pre-built package.\n ----------System Info----------\n Platform     : Linux-4.4.0-1100-aws-x86_64-with-debian-stretch-sid\n system       : Linux\n node         : ip-172-31-20-50\n release      : 4.4.0-1100-aws\n version      : #111-Ubuntu SMP Wed Dec 4 12:20:15 UTC 2019\n ----------Hardware Info----------\n machine      : x86_64\n processor    : x86_64\n Architecture:          x86_64\n CPU op-mode(s):        32-bit, 64-bit\n Byte Order:            Little Endian\n CPU(s):                64\n On-line CPU(s) list:   0-63\n Thread(s) per core:    2\n Core(s) per socket:    16\n Socket(s):             2\n NUMA node(s):          2\n Vendor ID:             GenuineIntel\n CPU family:            6\n Model:                 79\n Model name:            Intel(R) Xeon(R) CPU E5-2686 v4 @ 2.30GHz\n Stepping:              1\n CPU MHz:               1267.785\n CPU max MHz:           3000.0000\n CPU min MHz:           1200.0000\n BogoMIPS:              4600.11\n Hypervisor vendor:     Xen\n Virtualization type:   full\n L1d cache:             32K\n L1i cache:             32K\n L2 cache:              256K\n L3 cache:              46080K\n NUMA node0 CPU(s):     0-15,32-47\n NUMA node1 CPU(s):     16-31,48-63\n Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon rep_good nopl xtopology nonstop_tsc aperfmperf pni pclmulqdq monitor est ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single kaiser fsgsbase bmi1 hle avx2 smep bmi2 erms invpcid rtm rdseed adx xsaveopt ida\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "apeforest", "commentT": "2020-02-07T20:24:47Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/apache/incubator-mxnet/commit/b1e491182fa9c15da89f1b701778de3a1421811b>b1e4911</denchmark-link>\n  is the first bad commit\n commit <denchmark-link:https://github.com/apache/incubator-mxnet/commit/b1e491182fa9c15da89f1b701778de3a1421811b>b1e4911</denchmark-link>\n \n Author: Anirudh Subramanian <denchmark-link:mailto:anirudh2290@ufl.edu>anirudh2290@ufl.edu</denchmark-link>\n \n Date:   Sat Feb 1 09:36:59 2020 -0800\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "apeforest", "commentT": "2020-02-08T02:31:27Z", "comment_text": "\n \t\tRoot cause seems to be the change in preprocessor logic. Compare\n <denchmark-link:https://github.com/apache/incubator-mxnet/commit/b1e491182fa9c15da89f1b701778de3a1421811b#diff-ca9cfe7afd877e3f6a1601e9f9894ea1R233>b1e4911#diff-ca9cfe7afd877e3f6a1601e9f9894ea1R233</denchmark-link>\n \n <denchmark-link:https://github.com/apache/incubator-mxnet/commit/b1e491182fa9c15da89f1b701778de3a1421811b#diff-b7c9df82199fd093bf767c1635607088L170>b1e4911#diff-b7c9df82199fd093bf767c1635607088L170</denchmark-link>\n \n Another thing exposed by this PR is that the config.cmake should include set(ENABLE_CUDA_RTC ON instead of OFF. It's set off by default based on a misunderstanding on my side that this feature is not commonly used anymore.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "apeforest", "commentT": "2020-02-08T02:54:53Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/leezu>@leezu</denchmark-link>\n  . Also, need another test on the CI to build with ENABLE_CUDA_RTC OFF.\n \t\t"}}}, "commit": {"commit_id": "3ab0509f9b1dbd642bc281620af11b5b94c3f089", "commit_author": "Leonard Lausen", "commitT": "2020-02-09 13:19:28-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ci\\docker\\runtime_functions.sh", "file_new_name": "ci\\docker\\runtime_functions.sh", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "892,893,894,895,896,897,898,899,900,901,902,903,904,905,906,907,908,909,910,911,912,913,914,915", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ci\\jenkins\\Jenkins_steps.groovy", "file_new_name": "ci\\jenkins\\Jenkins_steps.groovy", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "314,315,316,317,318,319,320,321,322,323,324,325,326", "deleted_lines": null}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "ci\\jenkins\\Jenkinsfile_unix_gpu", "file_new_name": "ci\\jenkins\\Jenkinsfile_unix_gpu", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "46", "deleted_lines": null}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "config\\config.cmake", "file_new_name": "config\\config.cmake", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "128", "deleted_lines": "128"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\imperative\\cached_op.h", "file_new_name": "src\\imperative\\cached_op.h", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "233,268,269,270,271,272,273,274", "deleted_lines": "233,268", "method_info": {"method_name": "mxnet::OptimizeGraph", "method_params": "full_graph,fwd_graph,grad_graph,context,num_forward_outputs,inlining", "method_startline": "231", "method_endline": "285"}}}}}}}