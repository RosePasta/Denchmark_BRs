{"BR": {"BR_id": "18414", "BR_author": "sxjscience", "BRopenT": "2020-05-27T06:14:42Z", "BRcloseT": "2020-06-02T15:45:17Z", "BR_text": {"BRsummary": "Type inference bug of negation", "BRdescription": "\n import mxnet as mx\n mx.npx.set_np()\n a = mx.np.ones((10, 10), dtype=mx.np.int32)\n b = -a\n print(b.dtype)\n Output:\n <denchmark-code>float64\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "sxjscience", "commentT": "2020-05-27T07:46:27Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/sxjscience>@sxjscience</denchmark-link>\n \n Thanks for your issue, I was able to reproduce this issue on my device, we discovered that the cause of this problem is <denchmark-link:https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/numpy/multiarray.py#L988>https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/numpy/multiarray.py#L988</denchmark-link>\n , where the origin tensor would be multiplied by  when calling negation.\n I believe this problem could be resolved by changing -1.0 to -1, as the backend is now able to perform type promotion for scalar-tensor binary ops, which should return a value of type int32.\n I will create a fix for this issue.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "sxjscience", "commentT": "2020-05-27T19:28:29Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/CassiniXu>@CassiniXu</denchmark-link>\n  thanks for finding the root cause. In terms of the solution, I'm not sure if multiply is the right way to go. After all, we don't want int8 number to be promoted to int32 when being negated. How about implementing a negation kernel?\n \t\t"}}}, "commit": {"commit_id": "ca2bdb6c6885f40fbe690906a0ccc06d3461284e", "commit_author": "Xingjian Shi", "commitT": "2020-06-02 08:45:16-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\mxnet\\numpy\\multiarray.py", "file_new_name": "python\\mxnet\\numpy\\multiarray.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "988", "deleted_lines": "988", "method_info": {"method_name": "__neg__", "method_params": "self", "method_startline": "987", "method_endline": "988"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\mxnet\\symbol\\numpy\\_symbol.py", "file_new_name": "python\\mxnet\\symbol\\numpy\\_symbol.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "283", "deleted_lines": "283", "method_info": {"method_name": "__neg__", "method_params": "self", "method_startline": "281", "method_endline": "283"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "tests\\python\\unittest\\test_numpy_op.py", "file_new_name": "tests\\python\\unittest\\test_numpy_op.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "2379", "deleted_lines": "2376", "method_info": {"method_name": "test_np_unary_funcs.check_unary_func", "method_params": "func,ref_grad,shape,low,high", "method_startline": "2366", "method_endline": "2409"}}, "hunk_1": {"Ismethod": 1, "added_lines": "2430,2431,2432,2433,2434,2435,2436,2437,2438,2439,2440,2441,2442,2443,2444", "deleted_lines": null, "method_info": {"method_name": "test_negation", "method_params": "", "method_startline": "2430", "method_endline": "2444"}}, "hunk_2": {"Ismethod": 1, "added_lines": "2379", "deleted_lines": "2376,2423", "method_info": {"method_name": "test_np_unary_funcs", "method_params": "", "method_startline": "2365", "method_endline": "2426"}}, "hunk_3": {"Ismethod": 1, "added_lines": "2432,2433", "deleted_lines": null, "method_info": {"method_name": "test_negation.hybrid_forward", "method_params": "self,F,a", "method_startline": "2432", "method_endline": "2433"}}}}}}}