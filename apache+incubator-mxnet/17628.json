{"BR": {"BR_id": "17628", "BR_author": "sxjscience", "BRopenT": "2020-02-19T19:26:50Z", "BRcloseT": "2020-02-25T01:54:28Z", "BR_text": {"BRsummary": "Missing dnnl_config.h when installing horovod", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n I tried to compile MXNet using the cmake command:\n <denchmark-code>cmake -GNinja -C ../config.cmake ..\n cmake --build .\n </denchmark-code>\n \n and then install horovod\n <denchmark-code>HOROVOD_WITHOUT_TENSORFLOW=1 HOROVOD_GPU_ALLREDUCE=NCCL HOROVOD_GPU_BROADCAST=NCCL pip3 install -e . --no-cache-dir --user\n </denchmark-code>\n \n The error message is\n <denchmark-code>/home/ubuntu/mxnet/python/mxnet/../../include/mkldnn/dnnl.hpp:23:10: fatal error: dnnl_config.h: No such file or directory\n </denchmark-code>\n \n I find that we have these lines in mkldnn.mk \n \n \n incubator-mxnet/mkldnn.mk\n \n \n         Lines 52 to 53\n       in\n       c2aff58\n \n \n \n \n \n \n  cp $(MKLDNN_BUILDDIR)/include/dnnl_version.h $(MXNET_INCLDIR)/mkldnn/. \n \n \n \n  cp $(MKLDNN_BUILDDIR)/include/dnnl_config.h $(MXNET_INCLDIR)/mkldnn/. \n \n \n \n \n \n The problem might be that we haven't copied the files to mxnet/include/mkldnn so the build system used in horovod is broken.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "sxjscience", "commentT": "2020-02-19T19:28:06Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/leezu>@leezu</denchmark-link>\n  <denchmark-link:https://github.com/apeforest>@apeforest</denchmark-link>\n  Have you met problems when building horovod with cmake-built MXNet?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "sxjscience", "commentT": "2020-02-19T19:32:57Z", "comment_text": "\n \t\tA temporary fix is to manually copy files inside the build directory to include/mkldnn. I've confirmed that this solves the problem in horovod installation.\n <denchmark-code>cp build/3rdparty/mkldnn/include/dnnl_config.h include/mkldnn\n cp build/3rdparty/mkldnn/include/dnnl_version.h include/mkldnn\n </denchmark-code>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "sxjscience", "commentT": "2020-02-20T01:15:03Z", "comment_text": "\n \t\tI will take a look at this. I remember previously the recommended build system of mxnet was makefile when cooperating with horovod.\n <denchmark-link:https://github.com/sxjscience>@sxjscience</denchmark-link>\n  is this the only issue when using cmake to build mxnet and linking it to horovod?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "sxjscience", "commentT": "2020-02-20T04:13:59Z", "comment_text": "\n \t\tThat\u2019s currently the only one I found for linking to horovod. However I just ran setup.py in horovod and hasn\u2019t run distributed training yet. I\u2019m having some other issues in the cmake-built MXNet which I\u2019m still investigating.\n \n Get Outlook for iOS<<denchmark-link:https://aka.ms/o0ukef>https://aka.ms/o0ukef</denchmark-link>\n >\n <denchmark-link:#>\u2026</denchmark-link>\n \n \n ________________________________\n From: Tao Lv <notifications@github.com>\n Sent: Wednesday, February 19, 2020 5:15:05 PM\n To: apache/incubator-mxnet <incubator-mxnet@noreply.github.com>\n Cc: Xingjian SHI <xshiab@connect.ust.hk>; Mention <mention@noreply.github.com>\n Subject: Re: [apache/incubator-mxnet] Missing dnnl_config.h when installing horovod (#17628)\n \n \n I will take a look at this. I remember previously the recommended build system of mxnet was makefile when cooperating with horovod.\n @sxjscience<https://github.com/sxjscience> is this the only issue when using cmake to build mxnet and linking it to horovod?\n \n \u2014\n You are receiving this because you were mentioned.\n Reply to this email directly, view it on GitHub<#17628?email_source=notifications&email_token=ABHQH3QTVXH2GQ6L4GGODWTRDXKRTA5CNFSM4KYACRAKYY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOEMKLJQY#issuecomment-588559555>, or unsubscribe<https://github.com/notifications/unsubscribe-auth/ABHQH3VFOAX6T6T4WKRZDY3RDXKRTANCNFSM4KYACRAA>.\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "sxjscience", "commentT": "2020-02-21T02:15:09Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/TaoLv>@TaoLv</denchmark-link>\n  what's your status on this issue?\n I think this issue is currently blocking Makefile build removal so we should fix it soon. (You mentioned you plan to work on it, so please let us know if you don't plan to work on it soon.)\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "sxjscience", "commentT": "2020-02-21T02:43:18Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/leezu>@leezu</denchmark-link>\n  I\u2018m working on a fix.\n \t\t"}}}, "commit": {"commit_id": "fc778fc093f2e40f1ac5b83f45ba66d7b8df4a80", "commit_author": "Tao Lv", "commitT": "2020-02-24 17:54:27-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CMakeLists.txt", "file_new_name": "CMakeLists.txt", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "759,760,761,762,763,764,765,766", "deleted_lines": null}}}}}}