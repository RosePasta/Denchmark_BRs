{"BR": {"BR_id": "17875", "BR_author": "leezu", "BRopenT": "2020-03-19T20:18:39Z", "BRcloseT": "2020-03-23T18:25:42Z", "BR_text": {"BRsummary": "USE_TVM_OP=1 build broken with DMLC_LOG_FATAL_THROW=0", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n Setting -DDMLC_LOG_FATAL_THROW=0 is useful for debugging with gdb or lldb. Unfortunately we can't compile MXNet with USE_TVM_OP=1 in that case.\n <denchmark-h:h3>Error Message</denchmark-h>\n \n <denchmark-code>[658/658] Linking CXX shared library libmxnet.so\n FAILED: libmxnet.so\n : && /usr/bin/c++ -fPIC -Wall -Wno-sign-compare -O3 -std=c++11 -fopenmp   -shared -Wl,-soname,libmxnet.so -o libmxnet.so CMakeFiles/mxnet.dir/dummy.c.o -L/home/ubuntu/src/mxnet-master/build/3rdparty/tvm -Wl,-rpath,/usr/local/lib:/home/ubuntu/src/mxnet-master/build/3rdparty/tvm:  -Wl,--whole-archive  libmxnet.a  -Wl,--no-whole-archive  libmxnet.a  3rdparty/dmlc-core/libdmlc.a  -ldl  3rdparty/mkldnn/src/libdnnl.a  -lpthread  -Wl,--start-group  /opt/intel/mkl/lib/intel64/libmkl_intel_lp64.a  /opt/intel/mkl/lib/intel64/libmkl_intel_thread.a  /opt/intel/mkl/lib/intel64/libmkl_core.a  /usr/local/lib/libiomp5.so  -Wl,--end-group  /usr/lib/x86_64-linux-gnu/librt.so  /usr/lib/x86_64-linux-gnu/libopencv_highgui.so.3.2.0  /usr/lib/x86_64-linux-gnu/libopencv_imgcodecs.so.3.2.0  /usr/lib/x86_64-linux-gnu/libopencv_imgproc.so.3.2.0  /usr/lib/x86_64-linux-gnu/libopencv_core.so.3.2.0  -llapack  -ltvm_runtime  /usr/lib/gcc/x86_64-linux-gnu/7/libgomp.so  -lpthread  -lrt && cd /home/ubuntu/src/mxnet-master/build && /home/ubuntu/.pyenv/versions/3.8.2-debug/lib/python3.8/site-packages/cmake/data/bin/cmake -E copy /home/ubuntu/src/mxnet-master/build/3rdparty/mkldnn/include/dnnl_config.h /home/ubuntu/src/mxnet-master/include/mkldnn/ && /home/ubuntu/.pyenv/versions/3.8.2-debug/lib/python3.8/site-packages/cmake/data/bin/cmake -E copy /home/ubuntu/src/mxnet-master/build/3rdparty/mkldnn/include/dnnl_version.h /home/ubuntu/src/mxnet-master/include/mkldnn/ && cd /home/ubuntu/src/mxnet-master/build && /home/ubuntu/.pyenv/versions/3.8.2-debug/lib/python3.8/site-packages/cmake/data/bin/cmake -E env PYTHONPATH=\"/home/ubuntu/src/mxnet-master/3rdparty/tvm/python:/home/ubuntu/src/mxnet-master/3rdparty/tvm/topi/python:/home/ubuntu/src/mxnet-master/contrib\" LD_LIBRARY_PATH=/home/ubuntu/src/mxnet-master/build:/home/ubuntu/src/mxnet-master/build/3rdparty/tvm:/usr/local/cuda/lib64:/usr/local/lib:/usr/lib:/usr/local/cuda/extras/CUPTI/lib64:/usr/local/mpi/lib:/home/ubuntu/local/lib:/home/ubuntu/local/lib:/usr/local/cuda/lib64:/usr/local/lib:/usr/lib:/usr/local/cuda/extras/CUPTI/lib64:/usr/local/mpi/lib:/home/ubuntu/local/lib /home/ubuntu/.pyenv/versions/3.8.2-debug/bin/python3.8 /home/ubuntu/src/mxnet-master/contrib/tvmop/compile.py -o/home/ubuntu/src/mxnet-master/build --config /home/ubuntu/src/mxnet-master/build/tvmop.conf -L /home/ubuntu/src/mxnet-master/build/3rdparty/tvm\n [19:56:21] ../3rdparty/tvm/src/node/reflection.cc:113: AttributeError: Variable object has no attributed shape\n \n Child aborted\n ninja: build stopped: subcommand failed.\n </denchmark-code>\n \n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n <denchmark-h:h3>Steps to reproduce</denchmark-h>\n \n \n Apply patch below\n Compile with cmake -GNinja -DUSE_CUDA=0 -DUSE_TVM_OP=ON ..; ninja\n \n diff --git a/CMakeLists.txt b/CMakeLists.txt\n index 365da2d90..b4c9d267b 100644\n --- a/CMakeLists.txt\n +++ b/CMakeLists.txt\n @@ -151,7 +151,7 @@ endif()\n  add_definitions(-DDMLC_MODERN_THREAD_LOCAL=0)\n  # disable stack trace in exception by default.\n  add_definitions(-DDMLC_LOG_STACK_TRACE_SIZE=0)\n -add_definitions(-DDMLC_LOG_FATAL_THROW=1)\n +add_definitions(-DDMLC_LOG_FATAL_THROW=0)\n \n  if(MSVC)\n    add_definitions(-DWIN32_LEAN_AND_MEAN)\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "leezu", "commentT": "2020-03-20T00:30:18Z", "comment_text": "\n \t\tThis failure is from tvmop/compile.py. Backtrace:\n <denchmark-code>frame #2: 0x00007fff4cc3a496 libtvm.so`dmlc::LogMessageFatal::~LogMessageFatal() + 166                                                                                                 frame #3: 0x00007fff4cdbf0cd libtvm.so`tvm::ReflectionVTable::GetAttr(tvm::runtime::Object*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&\n ) const + 605                                                                                                                                                                              frame #4: 0x00007fff4cdbf79e libtvm.so`tvm::NodeGetAttr(tvm::runtime::TVMArgs, tvm::runtime::TVMRetValue*) + 766\n     frame #5: 0x00007fff4cdc0d84 libtvm.so`std::_Function_handler<void (tvm::runtime::TVMArgs, tvm::runtime::TVMRetValue*), void (*)(tvm::runtime::TVMArgs, tvm::runtime::TVMRetValue*)>::_M_invoke(std::_Any_data const&, tvm::runtime::TVMArgs&&, tvm::runtime::TVMRetValue*&&) + 20\n     frame #6: 0x00007fff4d49c75e libtvm.so`TVMFuncCall + 110\n     frame #7: 0x00007ffff5965dae libffi.so.6`ffi_call_unix64 + 76\n     frame #8: 0x00007ffff596571f libffi.so.6`ffi_call + 559\n </denchmark-code>\n \n \t\t"}}}, "commit": {"commit_id": "3840786a25b16d0cfe6411e26f25aba8d3b574ff", "commit_author": "Leonard Lausen", "commitT": "2020-03-23 11:25:26-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CMakeLists.txt", "file_new_name": "CMakeLists.txt", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "74,696,714,715,716,717,718,719,720,721,722,723,725,726,727,728,730,731,732,733,734,735,736,737,738,739,740,741,742,743,744,745,746,747,750,751,752,753,754,755,756,759", "deleted_lines": "154,713,714,715,716,717,718,719,720,721,722,723,724,725,726,727,728,729,730,731,732,733,734,735,736,737,738,739,740,741,742,743,744,745,746,747,748,750,751,753,754,755,756,757,760,765"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "cmake\\BuildTVM.cmake", "file_new_name": "cmake\\BuildTVM.cmake", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "142,143,144,145,146", "deleted_lines": "140,141,142"}}}}}}