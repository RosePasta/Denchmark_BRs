{"BR": {"BR_id": "14875", "BR_author": "ehsanmok", "BRopenT": "2019-05-03T23:52:41Z", "BRcloseT": "2020-02-20T21:04:10Z", "BR_text": {"BRsummary": "MXNet to ONNX export bug", "BRdescription": "\n When trying to convert yolov3_mobilenetv1.0_coco pretrained from gluonCV v0.5 to ONNX via onnx_mxnet.export_model (using mxnet-cu90mkl==1.5.0b20190313 ), I get the following error:\n <denchmark-code>/anaconda3/lib/python3.7/site-packages/mxnet/contrib/onnx/mx2onnx/_op_translations.py in convert_slice_axis(node, **kwargs)\n    1320     axes = int(attrs.get(\"axis\"))\n    1321     starts = int(attrs.get(\"begin\"))\n -> 1322     ends = int(attrs.get(\"end\", None))\n    1323     if not ends:\n    1324         raise ValueError(\"Slice: ONNX doesnt't support 'None' in 'end' attribute\")\n \n ValueError: invalid literal for int() with base 10: 'None'\n </denchmark-code>\n \n This matches <denchmark-link:https://github.com/apache/incubator-mxnet/blame/master/python/mxnet/contrib/onnx/mx2onnx/_op_translations.py#L1502>this line</denchmark-link>\n  which is a bug introduced in <denchmark-link:https://github.com/apache/incubator-mxnet/pull/12878>#12878 </denchmark-link>\n .\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ehsanmok", "commentT": "2019-05-03T23:52:44Z", "comment_text": "\n \t\tHey, this is the MXNet Label Bot.\n Thank you for submitting the issue! I will try and suggest some labels so that the appropriate MXNet community members can help resolve it.\n Here are my recommended labels: ONNX, Bug\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ehsanmok", "commentT": "2019-05-05T06:23:03Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Roshrini>@Roshrini</denchmark-link>\n  Could you please take a look?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "ehsanmok", "commentT": "2019-05-06T11:06:49Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ehsanmok>@ehsanmok</denchmark-link>\n  mxnet isn't responsible for this error, it's only ONNX.\n update your ONNX version, should work when ONNX==1.2.2\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "ehsanmok", "commentT": "2019-05-06T17:42:07Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/AnaRhisT94>@AnaRhisT94</denchmark-link>\n  No, my ONNX is already the latest v1.5.0. It's when calling <denchmark-link:https://mxnet.apache.org/api/python/contrib/onnx.html?highlight=onnx#module-mxnet.contrib.onnx.mx2onnx.export_model>export_model</denchmark-link>\n  causes that to happen.  is never valid.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "ehsanmok", "commentT": "2019-05-06T23:27:14Z", "comment_text": "\n \t\tTry to use ONNX 1.2.2\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "ehsanmok", "commentT": "2019-05-06T23:44:25Z", "comment_text": "\n \t\tSame error with ONNX 1.2.2\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "ehsanmok", "commentT": "2019-05-13T17:32:58Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/mxnet-label-bot>@mxnet-label-bot</denchmark-link>\n  add [Bug]\n <denchmark-link:https://github.com/ehsanmok>@ehsanmok</denchmark-link>\n  I'm looking into this, could you share your script?\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "ehsanmok", "commentT": "2019-05-15T13:07:29Z", "comment_text": "\n \t\t\n Same error with ONNX 1.2.2\n \n I see, well just delete the None then?\n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "ehsanmok", "commentT": "2019-05-15T19:57:42Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/vandanavk>@vandanavk</denchmark-link>\n  here is an MVE\n from os import path as osp\n import numpy as np\n import mxnet as mx\n from mxnet.contrib import onnx as onnx_mxnet\n from mxnet import gluon\n from gluoncv import model_zoo, data, utils\n \n OUTPUT = \"./output\"\n DATA = \"./data/cat.png\"\n SIZE = 320\n MODEL = \"yolo3_mobilenet1.0_coco\"\n INPUT_SHAPE = (1, 3, SIZE, SIZE)\n \n net = model_zoo.get_model(MODEL, pretrained=True)\n net.hybridize()\n # pass an img to trigger init after hybridize\n x, _ = data.transforms.presets.yolo.load_test(DATA, short=SIZE)\n _, _ = net(x)\n \n net.export(osp.join(OUTPUT, MODEL))\n sym = osp.join(OUTPUT, MODEL + \"-symbol.json\")\n params = osp.join(OUTPUT, MODEL + \"-0000.params\")\n onnx_file = osp.join(OUTPUT, MODEL + \".onnx\")\n \n converted_model_path = onnx_mxnet.export_model(sym, params, [INPUT_SHAPE], np.float32, onnx_file, verbose=True)\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "ehsanmok", "commentT": "2019-07-10T17:32:08Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ehsanmok>@ehsanmok</denchmark-link>\n  I tried the following code with the PR <denchmark-link:https://github.com/apache/incubator-mxnet/pull/14942>#14942</denchmark-link>\n .  error doesn't occur anymore but I do see . _arange export can be filed as separate feature request. Please try PR <denchmark-link:https://github.com/apache/incubator-mxnet/pull/14942>#14942</denchmark-link>\n  and let me know if it works for you.\n <denchmark-code>from os import path as osp\n import numpy as np\n import mxnet as mx\n from mxnet.contrib import onnx as onnx_mxnet\n from mxnet import gluon\n from gluoncv import model_zoo, data, utils\n \n OUTPUT = \"./\"\n DATA = \"./cat.jpg\"\n SIZE = 320\n MODEL = \"yolo3_darknet53_coco\"\n INPUT_SHAPE = (1, 3, SIZE, SIZE)\n \n net = model_zoo.get_model(MODEL, pretrained=True)\n net.hybridize()\n # pass an img to trigger init after hybridize\n x, _ = data.transforms.presets.yolo.load_test(DATA, short=SIZE)\n _ = net(x)\n \n net.export(osp.join(OUTPUT, MODEL))\n sym = osp.join(OUTPUT, MODEL + \"-symbol.json\")\n params = osp.join(OUTPUT, MODEL + \"-0000.params\")\n onnx_file = osp.join(OUTPUT, MODEL + \".onnx\")\n \n converted_model_path = onnx_mxnet.export_model(sym, params, [INPUT_SHAPE], np.float32, onnx_file, verbose=True)\n </denchmark-code>\n \n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "ehsanmok", "commentT": "2019-07-16T23:03:15Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/ehsanmok>@ehsanmok</denchmark-link>\n  I met the same problem with you. I saw the issue has been around for 3 months. Did you solve it?\n \t\t"}, "comments_11": {"comment_id": 12, "comment_author": "ehsanmok", "commentT": "2019-07-22T20:04:39Z", "comment_text": "\n \t\t\n @ehsanmok I met the same problem with you. I saw the issue has been around for 3 months. Did you solve it?\n \n Can you try the PR <denchmark-link:https://github.com/apache/incubator-mxnet/pull/14942>#14942</denchmark-link>\n ? I dint see the issue with this PR.\n \t\t"}, "comments_12": {"comment_id": 13, "comment_author": "ehsanmok", "commentT": "2019-08-18T07:28:31Z", "comment_text": "\n \t\tI found that there are several ops not supported during converting, including slice_axis(..., end =None), slice_like, repeat, arange. But for a fixed input dimension, these operations can be replaced with normal slice_like, concat. The main problem is in box_nms.\n \t\t"}, "comments_13": {"comment_id": 14, "comment_author": "ehsanmok", "commentT": "2019-08-23T03:28:07Z", "comment_text": "\n \t\tNot sure if this is the right place to post, but I used the fixes from  PR <denchmark-link:https://github.com/apache/incubator-mxnet/pull/14942>#14942</denchmark-link>\n , fixed the issue for me but the next error is:\n 'AttributeError: No conversion function registered for op type _greater_scalar yet.'\n Attempting to export 'ssd_512_mobilenet1.0_voc'\n \t\t"}, "comments_14": {"comment_id": 15, "comment_author": "ehsanmok", "commentT": "2019-08-31T00:06:19Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/caiqi>@caiqi</denchmark-link>\n  <denchmark-link:https://github.com/ntomer>@ntomer</denchmark-link>\n  feel free to contribute the ONNX conversion for these missing operators \n \t\t"}, "comments_15": {"comment_id": 16, "comment_author": "ehsanmok", "commentT": "2019-11-05T21:53:47Z", "comment_text": "\n \t\tDoes anyone have any update on this ? I am having the same issue ...\n \t\t"}, "comments_16": {"comment_id": 17, "comment_author": "ehsanmok", "commentT": "2019-12-03T03:22:28Z", "comment_text": "\n \t\tthe bug is happen in yolo3.py line 161, there is a None param, fix it. and then u will meet the _arange op not regist\n \t\t"}, "comments_17": {"comment_id": 18, "comment_author": "ehsanmok", "commentT": "2019-12-11T03:50:11Z", "comment_text": "\n \t\t\n Not sure if this is the right place to post, but I used the fixes from PR #14942, fixed the issue for me but the next error is:\n 'AttributeError: No conversion function registered for op type _greater_scalar yet.'\n Attempting to export 'ssd_512_mobilenet1.0_voc'\n \n Did you find some ways to fix it? I meet it with \"ssd_512_resnet50_v1_voc\"\n \t\t"}, "comments_18": {"comment_id": 19, "comment_author": "ehsanmok", "commentT": "2019-12-11T23:06:40Z", "comment_text": "\n \t\tnope, raised a ticket in Amazon but no one is currently working on this ..\n \t\t"}, "comments_19": {"comment_id": 20, "comment_author": "ehsanmok", "commentT": "2020-01-16T06:58:55Z", "comment_text": "\n \t\tsame problom, when used torch yolov32onnx.py, so easy to convert\n I will give up mxnet never look back\n \t\t"}, "comments_20": {"comment_id": 21, "comment_author": "ehsanmok", "commentT": "2020-01-31T06:23:36Z", "comment_text": "\n \t\tI met the same problem.\n And I tried the solution in PR<denchmark-link:https://github.com/apache/incubator-mxnet/pull/14942>#14942</denchmark-link>\n , found a new bug.\n \n File \"D:\\WorkingSoftware\\Anaconda3\\lib\\site-packages\\mxnet\\contrib\\onnx\\mx2onnx\\export_model.py\", line 83, in export_model\n verbose=verbose)\n File \"D:\\WorkingSoftware\\Anaconda3\\lib\\site-packages\\mxnet\\contrib\\onnx\\mx2onnx\\export_onnx.py\", line 253, in create_onnx_graph_proto\n idx=idx\n File \"D:\\WorkingSoftware\\Anaconda3\\lib\\site-packages\\mxnet\\contrib\\onnx\\mx2onnx\\export_onnx.py\", line 90, in convert_layer\n raise AttributeError(\"No conversion function registered for op type %s yet.\" % op)\n AttributeError: No conversion function registered for op type _arange yet.\n \n \t\t"}, "comments_21": {"comment_id": 22, "comment_author": "ehsanmok", "commentT": "2020-02-04T23:46:37Z", "comment_text": "\n \t\t\n I met the same problem.\n And I tried the solution in PR#14942, found a new bug.\n \n File \"D:\\WorkingSoftware\\Anaconda3\\lib\\site-packages\\mxnet\\contrib\\onnx\\mx2onnx\\export_model.py\", line 83, in export_model\n verbose=verbose)\n File \"D:\\WorkingSoftware\\Anaconda3\\lib\\site-packages\\mxnet\\contrib\\onnx\\mx2onnx\\export_onnx.py\", line 253, in create_onnx_graph_proto\n idx=idx\n File \"D:\\WorkingSoftware\\Anaconda3\\lib\\site-packages\\mxnet\\contrib\\onnx\\mx2onnx\\export_onnx.py\", line 90, in convert_layer\n raise AttributeError(\"No conversion function registered for op type %s yet.\" % op)\n AttributeError: No conversion function registered for op type _arange yet.\n \n \n Had same error on Nov 5, 2019.. tried to build make the operator but didnt work..\n \t\t"}}}, "commit": {"commit_id": "9dcf71d8fe33f77ed316a95fcffaf1f7f883ff70", "commit_author": "Vandana Kannan", "commitT": "2020-02-20 13:04:09-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\mxnet\\contrib\\onnx\\mx2onnx\\_op_translations.py", "file_new_name": "python\\mxnet\\contrib\\onnx\\mx2onnx\\_op_translations.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1498,1499,1500,1501,1502,1503,1511", "deleted_lines": "1498,1499,1500,1508", "method_info": {"method_name": "convert_slice_axis", "method_params": "node,kwargs", "method_startline": "1490", "method_endline": "1514"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "python\\mxnet\\contrib\\onnx\\onnx2mx\\_op_translations.py", "file_new_name": "python\\mxnet\\contrib\\onnx\\onnx2mx\\_op_translations.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "502,503,511,513,514", "deleted_lines": "509", "method_info": {"method_name": "_slice", "method_params": "attrs,inputs,proto_obj", "method_startline": "500", "method_endline": "519"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tests\\python-pytest\\onnx\\test_cases.py", "file_new_name": "tests\\python-pytest\\onnx\\test_cases.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "44", "deleted_lines": null}}}}}}