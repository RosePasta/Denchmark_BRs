{"BR": {"BR_id": "4133", "BR_author": "pyu10055", "BRopenT": "2020-10-26T18:26:33Z", "BRcloseT": "2020-11-17T01:36:42Z", "BR_text": {"BRsummary": "GatherV2 op missing support for batch_dims parameter", "BRdescription": "\n Please make sure that this is a bug. As per our\n GitHub Policy,\n we only address code/doc bugs, performance issues, feature requests and\n build/installation issues on GitHub. tag:bug_template\n System information\n \n Have I written custom code (as opposed to using a stock example script provided in TensorFlow.js):\n OS Platform and Distribution (e.g., Linux Ubuntu 16.04):\n Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\n TensorFlow.js installed from (npm or script link): 2.6.0\n TensorFlow.js version (use command below):\n Browser version:\n Tensorflow.js Converter Version: 2.6.0\n \n \n The GatherV2 op does not support  param as described in the <denchmark-link:https://www.tensorflow.org/api_docs/python/tf/raw_ops/GatherV2?hl=en>python API</denchmark-link>\n \n tf.raw_ops.GatherV2(\n params, indices, axis, batch_dims=0, name=None\n )\n indices must be an integer tensor of any dimension (usually 0-D or 1-D). Produces an output tensor with shape params.shape[:axis] + indices.shape[batch_dims:] + params.shape[axis + 1:]\n Ref model that is failing due to this missing support <denchmark-link:https://github.com/tensorflow/tfjs/issues/4128>#4128</denchmark-link>\n \n \n The GatherV2 API should support batch_dims param.\n Standalone code to reproduce the issue\n Provide a reproducible test case that is the bare minimum necessary to generate\n the problem. If possible, please share a link to Colab/CodePen/any notebook.\n Other info / logs Include any logs or source code that would be helpful to\n diagnose the problem. If including tracebacks, please include the full\n traceback. Large logs and files should be attached.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "pyu10055", "commentT": "2020-11-15T00:46:03Z", "comment_text": "\n \t\tI have investigated the unstack op, the num parameter has to be same as the dimension of the axis, which means it is not needed.\n The issue of <denchmark-link:https://github.com/tensorflow/tfjs/issues/4128>#4128</denchmark-link>\n  is caused by GatherV2 op not supporting batch_dims parameter, I have verified with this fix, the model can be executed without errors.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "pyu10055", "commentT": "2020-11-17T01:36:44Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4133>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tfjs/issues/4133>No</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "b85f40d419a30f2c64305bd606974aaf47bcf88b", "commit_author": "Ping Yu", "commitT": "2020-11-16 17:36:41-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-backend-cpu\\src\\backend_cpu.ts", "file_new_name": "tfjs-backend-cpu\\src\\backend_cpu.ts", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "507,508,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,532,533,534,535,540", "deleted_lines": "507,509,510,511,512,513,514,520,525"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "tfjs-backend-wasm\\src\\cc\\kernels\\Gather.cc", "file_new_name": "tfjs-backend-wasm\\src\\cc\\kernels\\Gather.cc", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "53,69,70,73,74,77,78", "deleted_lines": "52,68,69,72,73,76,77", "method_info": {"method_name": "tfjs::wasm::Gather", "method_params": "x_id,dtype,x_strides_ptr,strides_size,indices_id,axis,out_strides_ptr,out_id", "method_startline": "50", "method_endline": "83"}}, "hunk_1": {"Ismethod": 1, "added_lines": "26,27,28,31,32,33", "deleted_lines": "26,27,28,31,32", "method_info": {"method_name": "gather_impl", "method_params": "x_ptr,x_strides,indices_ptr,out_size,batch_size,out_strides,out_buf_ptr", "method_startline": "25", "method_endline": "41"}}, "hunk_2": {"Ismethod": 1, "added_lines": "26,27,28,31,32,33", "deleted_lines": "26,27,28,31,32", "method_info": {"method_name": "gather_impl", "method_params": "x_ptr,x_strides,indices_ptr,axis,out_size,out_strides,out_buf_ptr", "method_startline": "25", "method_endline": "40"}}, "hunk_3": {"Ismethod": 1, "added_lines": "53,69,70,73,74,77,78", "deleted_lines": "52,68,69,72,73,76,77", "method_info": {"method_name": "tfjs::wasm::Gather", "method_params": "x_id,dtype,x_strides_ptr,strides_size,indices_id,batch_size,out_strides_ptr,out_id", "method_startline": "51", "method_endline": "84"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tfjs-backend-wasm\\src\\kernels\\GatherV2.ts", "file_new_name": "tfjs-backend-wasm\\src\\kernels\\GatherV2.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "37", "deleted_lines": "36", "method_info": {"method_name": "setup", "method_params": "BackendWasm", "method_startline": "30", "method_endline": "41"}}, "hunk_1": {"Ismethod": 1, "added_lines": "28", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "28", "method_endline": "28"}}, "hunk_2": {"Ismethod": 1, "added_lines": "48,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,79,81,84,89,90,91,92,95,96", "deleted_lines": "47,49,50,51,52,53,58,61,66,67,68,69,72,73,76,77,78,79", "method_info": {"method_name": "gatherV2", "method_params": "BackendWasm,GatherV2Inputs", "method_startline": "43", "method_endline": "101"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-backend-webgl\\src\\backend_webgl.ts", "file_new_name": "tfjs-backend-webgl\\src\\backend_webgl.ts", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "833,834,836,837,841,842,843,844,845,846,847,848,849,850,851,852,853,854,855,856,857", "deleted_lines": "833,835,839,840,841"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-backend-webgl\\src\\gather_gpu.ts", "file_new_name": "tfjs-backend-webgl\\src\\gather_gpu.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "48,49", "deleted_lines": "45,46,47,48,49,50,51,52", "method_info": {"method_name": "getSourceCoords", "method_params": "number", "method_startline": "43", "method_endline": "55"}}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-converter\\python\\tensorflowjs\\op_list\\slice_join.json", "file_new_name": "tfjs-converter\\python\\tensorflowjs\\op_list\\slice_join.json", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "72,73,74,75,76,77,78,79", "deleted_lines": "90,91,92,93,94,95"}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-converter\\src\\operations\\executors\\slice_join_executor.ts", "file_new_name": "tfjs-converter\\src\\operations\\executors\\slice_join_executor.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "56,57", "deleted_lines": null, "method_info": {"method_name": "tfOps.gather", "method_params": "input,indices", "method_startline": "56", "method_endline": "58"}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-converter\\src\\operations\\executors\\slice_join_executor_test.ts", "file_new_name": "tfjs-converter\\src\\operations\\executors\\slice_join_executor_test.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "283,289", "deleted_lines": "282,284,290", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "278", "method_endline": "290"}}}}, "file_8": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-converter\\src\\operations\\op_list\\slice_join.ts", "file_new_name": "tfjs-converter\\src\\operations\\op_list\\slice_join.ts", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "48,49,50,51,52,53,54,63,64,65,66,67,68", "deleted_lines": "48,57,58,59,60,61,62,63,64"}}}, "file_9": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\backends\\backend.ts", "file_new_name": "tfjs-core\\src\\backends\\backend.ts", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "514,515", "deleted_lines": "514"}}}, "file_10": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "tfjs-core\\src\\kernel_names.ts", "file_new_name": "tfjs-core\\src\\kernel_names.ts", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "363", "deleted_lines": null}}}, "file_11": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tfjs-core\\src\\ops\\gather.ts", "file_new_name": "tfjs-core\\src\\ops\\gather.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "63,66", "deleted_lines": "62,63,64,65,66", "method_info": {"method_name": ">", "method_params": "", "method_startline": "62", "method_endline": "67"}}, "hunk_1": {"Ismethod": 1, "added_lines": "55,60,63,66", "deleted_lines": "54,59,62,63,64,65,66,69", "method_info": {"method_name": ">", "method_params": "TensorLike,TensorLike,axis,batchDims", "method_startline": "54", "method_endline": "72"}}, "hunk_2": {"Ismethod": 1, "added_lines": "55,60,63,66", "deleted_lines": "54,59,62,63,64,65,66,69", "method_info": {"method_name": ">", "method_params": "TensorLike,TensorLike,axis", "method_startline": "53", "method_endline": "75"}}}}, "file_12": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-core\\src\\ops\\gather_test.ts", "file_new_name": "tfjs-core\\src\\ops\\gather_test.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "83,84,85,86,87,88", "deleted_lines": null, "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "83", "method_endline": "88"}}}}, "file_13": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tfjs-core\\src\\ops\\segment_util.ts", "file_new_name": "tfjs-core\\src\\ops\\segment_util.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,109,111,112,117,118,119,120,121,122,131", "deleted_lines": "79,84,93", "method_info": {"method_name": "collectGatherOpShapeInfo", "method_params": "Tensor,Tensor,number,number", "method_startline": "74", "method_endline": "132"}}, "hunk_1": {"Ismethod": 1, "added_lines": "73,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94", "deleted_lines": "73,79,84,93", "method_info": {"method_name": "collectGatherOpShapeInfo", "method_params": "Tensor,Tensor,number", "method_startline": "72", "method_endline": "94"}}}}, "file_14": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-node\\src\\kernels\\GatherV2.ts", "file_new_name": "tfjs-node\\src\\kernels\\GatherV2.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "28,29,30,31,32,36", "deleted_lines": "28", "method_info": {"method_name": "kernelFunc", "method_params": "", "method_startline": "25", "method_endline": "46"}}}}}}}