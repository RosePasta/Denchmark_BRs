{"BR": {"BR_id": "3786", "BR_author": "KailiangGu", "BRopenT": "2020-08-13T08:35:24Z", "BRcloseT": "2020-09-02T05:44:24Z", "BR_text": {"BRsummary": "Error: Unknown layer: Functional. This may be due to one of the following reasons", "BRdescription": "\n I am new to the TensorFlow and JS.\n I was trying to convert the MobileNet V2 model from keras to tensorflow.js\n When I try to load model into JS, I get the following error:\n `errors.ts:48 Uncaught (in promise) Error: Unknown layer: Functional. This may be due to one of the following reasons:\n \n The layer is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n The custom layer is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().\n at new e (errors.ts:48)\n at Rp (generic_utils.ts:242)\n at cd (serialization.ts:31)\n at e.fromConfig (models.ts:942)\n at Rp (generic_utils.ts:277)\n at cd (serialization.ts:31)\n at models.ts:300\n at common.ts:14\n at Object.next (common.ts:14)\n at a (common.ts:14)`\n \n I construct my model with a MobileNet V2 pre-trained model and add two layers on top of it.  And I convert the model using tensorflowjs_converter with a saved h5 file of the model.\n Here is my model summary. The mobilenetv2_1.00_160 with a type of functional and I believed is the cause of the error.\n Model: \"sequential\"\n Layer (type)//                 Output Shape//              Param #\n #########################################################\n mobilenetv2_1.00_160 (Functi  (None, 5, 5, 1280)//        2257984\n #########################################################\n global_average_pooling2d (Gl  (None, 1280)              0\n #########################################################\n dense (Dense)                (None, 3755)              4810155\n #########################################################\n Total params: 7,068,139\n Trainable params: 7,034,027\n Non-trainable params: 34,112\n #########################################################\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "KailiangGu", "commentT": "2020-08-13T09:51:22Z", "comment_text": "\n \t\tI had an issue like this albeit im using MobileNet not v2. I don't have the specific link, but a stack overflow thread somewhere said to go into the public/model.json folder and ctrl+f \"Functional\" and replace the word with \"Model\". worked for me!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "KailiangGu", "commentT": "2020-08-14T07:36:09Z", "comment_text": "\n \t\tReplace the \"Functional\" with \"Model\" indeed solve this error. However, it also gives me the new error as following:\n Uncaught (in promise) Error: computeMask has not been implemented for Merge yet\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "KailiangGu", "commentT": "2020-08-19T19:18:24Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/KailiangGu>@KailiangGu</denchmark-link>\n  <denchmark-link:https://github.com/lospericos>@lospericos</denchmark-link>\n  I was able to reproduce the same for my model conversion, <denchmark-link:https://github.com/pyu10055>@pyu10055</denchmark-link>\n  can you please assist with this bug ?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "KailiangGu", "commentT": "2020-08-20T20:55:59Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/KailiangGu>@KailiangGu</denchmark-link>\n  have you tried to convert the HDF5 model to TFJS graph model?\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "KailiangGu", "commentT": "2020-08-23T10:34:50Z", "comment_text": "\n \t\tThe same issue with Keras MobileNet v1. Replacing the word with \"Model\" worked for me, thanks!\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "KailiangGu", "commentT": "2020-08-24T20:36:13Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/pyu10055>@pyu10055</denchmark-link>\n  i tried to convert with TFJS graph model and no issues , i used the command\n \n <denchmark-link:https://github.com/KailiangGu>@KailiangGu</denchmark-link>\n  <denchmark-link:https://github.com/starrabb1t>@starrabb1t</denchmark-link>\n  can you please try using TFJS Graph model\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "KailiangGu", "commentT": "2020-08-31T21:19:48Z", "comment_text": "\n \t\tThis issue has been automatically marked as stale because it has not had recent activity. It will be closed in 7 dyas if no further activity occurs. Thank you.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "KailiangGu", "commentT": "2020-09-02T05:44:25Z", "comment_text": "\n \t\tAre you satisfied with the resolution of your issue?\n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tfjs/issues/3786>Yes</denchmark-link>\n \n <denchmark-link:https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tfjs/issues/3786>No</denchmark-link>\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "KailiangGu", "commentT": "2020-11-12T19:07:46Z", "comment_text": "\n \t\t\n I had an issue like this albeit im using MobileNet not v2. I don't have the specific link, but a stack overflow thread somewhere said to go into the public/model.json folder and ctrl+f \"Functional\" and replace the word with \"Model\". worked for me!\n \n Where is this public/model.json folder located?\n \t\t"}}}, "commit": {"commit_id": "b54dfa92905db10086220baf3b7dc4005e7532e3", "commit_author": "Ping Yu", "commitT": "2020-09-01 22:44:23-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "e2e\\integration_tests\\constants.ts", "file_new_name": "e2e\\integration_tests\\constants.ts", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "35,36,37,38,39,40,41,42,43", "deleted_lines": "35,36,37,38,39,40"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "e2e\\integration_tests\\convert_predict.py", "file_new_name": "e2e\\integration_tests\\convert_predict.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395", "deleted_lines": null, "method_info": {"method_name": "_layers_mobilenet", "method_params": "", "method_startline": "375", "method_endline": "395"}}, "hunk_1": {"Ismethod": 1, "added_lines": "417,418", "deleted_lines": null, "method_info": {"method_name": "main", "method_params": "", "method_startline": "397", "method_endline": "418"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "e2e\\integration_tests\\convert_predict.ts", "file_new_name": "e2e\\integration_tests\\convert_predict.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,156", "deleted_lines": "40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,110,111,112,113,114,118", "method_info": {"method_name": "(anonymous)", "method_params": "", "method_startline": "40", "method_endline": "157"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tfjs-layers\\src\\engine\\training.ts", "file_new_name": "tfjs-layers\\src\\engine\\training.ts", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1896,1897,1898,1899,1900,1901,1902,1903,1904,1905,1906,1907", "deleted_lines": null, "method_info": {"method_name": "checkUserDefinedMetadata", "method_params": "userDefinedMetadata,name", "method_startline": "1876", "method_endline": "1907"}}}}}}}