{"BR": {"BR_id": "336", "BR_author": "pybokeh", "BRopenT": "2019-10-09T12:44:34Z", "BRcloseT": "2020-07-16T23:24:45Z", "BR_text": {"BRsummary": "Top Half of Seaborn Chart Title Gets Cut Off", "BRdescription": "\n <denchmark-h:h1>Summary</denchmark-h>\n \n When adding a title to a seaborn or perhaps MATPLOTLIB chart (have not tested with MATPLOTLIB yet) chart, the top half of the title is cut off or not displayed\n <denchmark-code># Steps to reproduce\n import matplotlib.pyplot as plt\n import seaborn as sns\n import streamlit as st\n \n mpg = sns.load_dataset(\"mpg\")\n option = st.sidebar.multiselect('Choose country of origin:', mpg.origin.unique()\n sns.relplot(x=\"horsepower\", y=\"mpg\", hue=\"origin\", size=\"weight\", sizes=(40, 400), alpha=0.5, palette=\"muted\", height=6, data=mpg.query(\"origin == @option\"))\n plt.title('MPG vs Weight by Country of Origin')\n st.pyplot()\n </denchmark-code>\n \n <denchmark-h:h2>Expected behavior:</denchmark-h>\n \n seaborn chart title to be fully visible\n <denchmark-h:h2>Actual behavior:</denchmark-h>\n \n Top half of seaborn chart title is cut off\n <denchmark-h:h2>Is this a regression?</denchmark-h>\n \n That is, did this use to work the way you expected in the past?  First time using streamlit, so not sure if worked in the past\n yes?  maybe?\n <denchmark-h:h1>Debug info</denchmark-h>\n \n \n Streamlit version: 0.47.4\n Python version: 3.7\n Using Conda\n OS version: Windows 10\n Browser version: Chrome version 77\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "pybokeh", "commentT": "2019-10-09T12:57:38Z", "comment_text": "\n \t\tI apologize, I left out a crucial line: st.write(mpg.query(\"origin == <denchmark-link:https://github.com/option>@option</denchmark-link>\n \"))  just before where the seaborn chart gets rendered and that appears to be the problem.  It appears when rendering the dataframe above the seaborn chart, it appears that the bottom portion of the rendered dataframe overlaps or covers the top portion of the seaborn chart.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "pybokeh", "commentT": "2019-10-09T13:02:08Z", "comment_text": "\n \t\tOut of curiosity, I removed the dataframe and added a markdown title above the seaborn chart, the seaborn chart title still gets cut off.  So perhaps anything rendered above the seaborn chart title will cut off or overlap over the chart title.  As a workaround, I guess users can remove the seaborn chart title and just use markdown title as the title for the seaborn chart.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "pybokeh", "commentT": "2020-02-13T23:59:13Z", "comment_text": "\n \t\tConfirmed still an issue.\n <denchmark-link:https://user-images.githubusercontent.com/98836/74489304-c5841b00-4e79-11ea-9adf-f89f3b147b0f.png></denchmark-link>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "pybokeh", "commentT": "2020-05-14T15:32:26Z", "comment_text": "\n \t\tThis looks to be a problem with Seaborn. Running this independently of streamlit produces the same issue.\n <denchmark-code>import matplotlib.pyplot as plt\n import seaborn as sns\n \n mpg = sns.load_dataset(\"mpg\")\n sns.relplot(\n     x=\"horsepower\", y=\"mpg\",\n     hue=\"origin\", size=\"weight\", sizes=(40, 400),\n     alpha=0.5, palette=\"muted\", height=6,\n     data=mpg.query(\"origin == 'usa'\"))\n plt.title('MPG vs Weight by Country of Origin')\n plt.show()\n </denchmark-code>\n \n <denchmark-link:https://user-images.githubusercontent.com/24946400/81953090-423ba800-95d5-11ea-8aab-fe6b7a708589.png></denchmark-link>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "pybokeh", "commentT": "2020-05-14T15:37:04Z", "comment_text": "\n \t\tDid we file an issue with Seaborn?\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "pybokeh", "commentT": "2020-05-14T15:48:22Z", "comment_text": "\n \t\tJust did! <denchmark-link:https://github.com/mwaskom/seaborn/issues/2072>Seaborn #2072</denchmark-link>\n \n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "pybokeh", "commentT": "2020-05-14T15:55:50Z", "comment_text": "\n \t\tCool! Gonna move this to the icebox for now. Let's re-visit if/when Seaborn fixes the bug.\n It's only a test dependency of ours but looks like the Cypress tests for Seaborn are currently flaky so we can revisit them after the fix.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "pybokeh", "commentT": "2020-05-14T22:12:15Z", "comment_text": "\n \t\tTurns out for matplotlib, you need to configure the chart appropriately to make room for the title. We're evaluating if this is something we'd like to manipulate as part of our library or return the output as is.\n In the meantime, <denchmark-link:https://github.com/pybokeh>@pybokeh</denchmark-link>\n  if this is still an issue, there are two ways to resolve this. For more details, please see <denchmark-link:https://github.com/mwaskom/seaborn/issues/2072>Seaborn #2072</denchmark-link>\n \n <denchmark-h:h3>Set the bbox to tight</denchmark-h>\n \n st.pyplot(bbox_inches=\"tight\")\n <denchmark-h:h3>Make room for the chart</denchmark-h>\n \n <denchmark-code>import seaborn as sns\n \n mpg = sns.load_dataset(\"mpg\")\n g = sns.relplot(\n     x=\"horsepower\",\n     y=\"mpg\",\n     hue=\"origin\",\n     size=\"weight\",\n     sizes=(40, 400),\n     alpha=0.5,\n     palette=\"muted\",\n     height=6,\n     data=mpg.query(\"origin == 'usa'\")\n )\n g.fig.subplots_adjust(top=.95)\n g.ax.set_title('MPG vs Weight by Country of Origin')\n st.pyplot()\n </denchmark-code>\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "pybokeh", "commentT": "2020-05-22T16:56:41Z", "comment_text": "\n \t\tLooks like this is fine in Jupyter. Exploring if there's a simple change we can apply to st.pyplot to inherit all the behavior from Jupyter\n Initial findings:\n \n Jupyter uses the Matplotlib backend called nbagg\n Jupyter used to have a special function that sets up Matplotlib, possibly matplotlib\n \n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "pybokeh", "commentT": "2020-05-27T16:53:32Z", "comment_text": "\n \t\tIt looks like Jupyter's backend only addresses charts displayed inline. In streamlit, we're sending over a saved image. While we could update our matplotlib backend to align with Juptyer's (module://ipykernel.pylab.backend_inline), it would not handle the necessary resizing of the chart to accommodate for a title.\n Sample code:\n <denchmark-code>import matplotlib.pyplot as plt\n import seaborn as sns\n \n mpg = sns.load_dataset(\"mpg\")\n sns.relplot(\n     x=\"horsepower\", y=\"mpg\",\n     hue=\"origin\", size=\"weight\", sizes=(40, 400),\n     alpha=0.5, palette=\"muted\", height=6,\n     data=mpg.query(\"origin == 'usa'\"))\n plt.title('MPG vs Weight by Country of Origin')\n plt.savefig('jupyter')\n </denchmark-code>\n \n Revisiting with the team to determine if our library should handle it.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "pybokeh", "commentT": "2020-07-15T18:43:03Z", "comment_text": "\n \t\tAdded the docs label here...since this is a quirk of matplotlib, best solution in the interim is probably just to highlight that it happens and the solution is usually st.pyplot(bbox_inches=\"tight\")\n \t\t"}}}, "commit": {"commit_id": "d7d9c649089b86d02205bcad69c5d62f4d825999", "commit_author": "karrie", "commitT": "2020-07-16 19:24:44-04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "frontend\\cypress\\snapshots\\linux\\2x\\st_pyplot.spec.ts\\pyplot-check-if-cleared.snap.png", "file_new_name": "frontend\\cypress\\snapshots\\linux\\2x\\st_pyplot.spec.ts\\pyplot-check-if-cleared.snap.png", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": null, "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "lib\\streamlit\\elements\\pyplot.py", "file_new_name": "lib\\streamlit\\elements\\pyplot.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "49", "deleted_lines": "49", "method_info": {"method_name": "marshall", "method_params": "coordinates,new_element_proto,fig,clear_figure,kwargs", "method_startline": "34", "method_endline": "73"}}}}}}}