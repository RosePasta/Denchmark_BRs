{"BR": {"BR_id": "1733", "BR_author": "SimonBiggs", "BRopenT": "2020-07-20T00:49:35Z", "BRcloseT": "2020-09-08T19:26:39Z", "BR_text": {"BRsummary": "Undocumented breaking change in multiselect default parameter", "BRdescription": "\n <denchmark-h:h1>Summary</denchmark-h>\n \n In the most recent streamlit version the default parameter in multiselect now expects a list instead of a string. I couldn't find this breaking change documented within the changelog\n Happy to give more info if needed, just let me know.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "SimonBiggs", "commentT": "2020-07-25T09:44:59Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/SimonBiggs>@SimonBiggs</denchmark-link>\n  ,\n Do you know what version of streamlit you were using when st.multiselect was working the way you saw it work before?\n According to git, this section of code (or at least, its docstring) was written back in Sept 2019:\n <denchmark-code>5bd586469 lib/streamlit/DeltaGenerator.py                (Matteo                        2019-09-27 17:37:50 -0700 1856)         default: [str] or None\n </denchmark-code>\n \n Let me know any other information you might have that could help here...\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "SimonBiggs", "commentT": "2020-07-25T14:55:33Z", "comment_text": "\n \t\tYup, running the following\n <denchmark-code>pip install streamlit==0.59.0; python -c \"import streamlit as st; print(st.multiselect('boo', [1,2], 1))\"\n </denchmark-code>\n \n Gives:\n <denchmark-code>...\n Successfully installed streamlit-0.59.0\n [1]\n </denchmark-code>\n \n Running\n <denchmark-code>pip install streamlit==0.60.0; python -c \"import streamlit as st; print(st.multiselect('boo', [1,2], 1))\"\n </denchmark-code>\n \n Gives:\n <denchmark-code>...\n Successfully installed streamlit-0.60.0\n Traceback (most recent call last):\n   File \"<string>\", line 1, in <module>\n   File \"/home/simon/.pyenv/versions/3.7.8/lib/python3.7/site-packages/streamlit/DeltaGenerator.py\", line 122, in wrapped_method\n     return dg._enqueue_new_element_delta(marshall_element, delta_type, last_index)\n   File \"/home/simon/.pyenv/versions/3.7.8/lib/python3.7/site-packages/streamlit/DeltaGenerator.py\", line 367, in _enqueue_new_element_delta\n     rv = marshall_element(msg.delta.new_element)\n   File \"/home/simon/.pyenv/versions/3.7.8/lib/python3.7/site-packages/streamlit/DeltaGenerator.py\", line 120, in marshall_element\n     return method(dg, element, *args, **kwargs)\n   File \"/home/simon/.pyenv/versions/3.7.8/lib/python3.7/site-packages/streamlit/DeltaGenerator.py\", line 1744, in multiselect\n     indices = _check_and_convert_to_indices(options, default)\n   File \"/home/simon/.pyenv/versions/3.7.8/lib/python3.7/site-packages/streamlit/DeltaGenerator.py\", line 1734, in _check_and_convert_to_indices\n     default_values = list(default_values)\n TypeError: 'int' object is not iterable\n </denchmark-code>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "SimonBiggs", "commentT": "2020-07-25T23:15:39Z", "comment_text": "\n \t\tSimilar bug reported <denchmark-link:https://discuss.streamlit.io/t/streamlit-0-58-0-to-0-63-0-multiselect/4513/2>on the forum</denchmark-link>\n  so we can come back to the user on resolution :\n \n I upgrade my streamlit app from 0.58.0 to 0.63.0,\n and I noticed that the default parameter for the multiselect() has changed.\n With streamlit 0.63.0, the default parmeter need to be an list (and not a string like in 0.58.0).\n If you update your app, don\u2019t be surprised if you read :\n TypeError: 'int' object is not iterable\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "SimonBiggs", "commentT": "2020-07-25T23:28:54Z", "comment_text": "\n \t\tAlso, more confusingly:\n <denchmark-h:hr></denchmark-h>\n \n <denchmark-code>pip install streamlit==0.59.0; python -c \"import streamlit as st; print(st.multiselect('boo', ['simon', 's', 'i', 'm', 'o', 'n'], 'simon'))\"\n </denchmark-code>\n \n gives:\n <denchmark-code>Successfully installed streamlit-0.59.0\n ['simon']\n </denchmark-code>\n \n <denchmark-h:hr></denchmark-h>\n \n and\n <denchmark-code>pip install streamlit==0.60.0; python -c \"import streamlit as st; print(st.multiselect('boo', ['simon', 's', 'i', 'm', 'o', 'n'], 'simon'))\"\n </denchmark-code>\n \n gives:\n <denchmark-code>Successfully installed streamlit-0.60.0\n ['s', 'i', 'm', 'o', 'n']\n </denchmark-code>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "SimonBiggs", "commentT": "2020-07-26T10:08:33Z", "comment_text": "\n \t\tThere was indeed a change between 0.59.0 and 0.60.0 on multiselect. Here's the related PR <denchmark-link:https://github.com/streamlit/streamlit/pull/1401>#1401</denchmark-link>\n .\n Before the change, if the default parameter was just a value like an int or a string, it was put inside a new list internally: [default_options]. After the change the function tries to cast it to a list list(default_options). This explains why you have an error when you pass a single int, and why your string is splitted in letters.\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "SimonBiggs", "commentT": "2020-07-26T11:02:03Z", "comment_text": "\n \t\t\n Before the change, if the default parameter was just a value like an int or a string, it was put inside a new list internally: [default_options]. After the change the function tries to cast it to a list list(default_options). This explains why you have an error when you pass a single int, and why your string is splitted in letters.\n \n Yeah, that does. I would certainly vote for adjusting it so that default=\"simon\" is considered to be the same as default=[\"simon\"] as opposed to default=[\"s\", \"i\", \"m\", \"o\", \"n\"]\n Likely also worth writing this as a test case to make sure this doesn't slip through again...\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "SimonBiggs", "commentT": "2020-07-30T18:34:32Z", "comment_text": "\n \t\tThanks for all of the detailed information <denchmark-link:https://github.com/SimonBiggs>@SimonBiggs</denchmark-link>\n  -- I agree we should have a test around this.  Sorry for the bother!  Really appreciate all your time and attention on this one.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "SimonBiggs", "commentT": "2020-07-30T22:04:27Z", "comment_text": "\n \t\tNo need to be sorry :). Thanks for the brilliant tool. That's one of the\n benefits of an open source community. People can look at the code and\n provide explicit actionable feedback.\n <denchmark-link:#>\u2026</denchmark-link>\n \n \n On Fri, 31 Jul 2020, 4:34 am Naomi Most, ***@***.***> wrote:\n  Thanks for all of the detailed information @SimonBiggs\n  <https://github.com/SimonBiggs> -- I agree we should have a test around\n  this. Sorry for the bother! Really appreciate all your time and attention\n  on this one.\n \n  \u2014\n  You are receiving this because you were mentioned.\n  Reply to this email directly, view it on GitHub\n  <#1733 (comment)>,\n  or unsubscribe\n  <https://github.com/notifications/unsubscribe-auth/ABSBK62N73MEMEF52CPDEGDR6G4MPANCNFSM4PBWOVSA>\n  .\n \n \n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "SimonBiggs", "commentT": "2020-07-31T05:39:03Z", "comment_text": "\n \t\tMarked as \"bughancement\" because this could be fixed in one of two ways:\n \n \n put a test around the behavior as @SimonBiggs suggested, and ensure it works as expected per Simon's example cases.\n \n \n nudge the API so that it is possible to use either a string or a list as the default parameter.  (And of course, the tests.)\n \n \n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "SimonBiggs", "commentT": "2020-09-08T19:26:39Z", "comment_text": "\n \t\tWe've fixed this now to work successfully with a test to hopefully avoid the issue in the future. Thanks to everyone who pointed this out!\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "SimonBiggs", "commentT": "2020-09-08T21:19:26Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/kmcgrady>@kmcgrady</denchmark-link>\n  :)\n \t\t"}}}, "commit": {"commit_id": "fb09655d7db1406c550cc76f14c16800a5fd343f", "commit_author": "Ken McGrady", "commitT": "2020-09-08 12:25:53-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "lib\\streamlit\\elements\\multiselect.py", "file_new_name": "lib\\streamlit\\elements\\multiselect.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "69", "deleted_lines": "69", "method_info": {"method_name": "multiselect._check_and_convert_to_indices", "method_params": "options,default_values", "method_startline": "57", "method_endline": "80"}}, "hunk_1": {"Ismethod": 1, "added_lines": "69", "deleted_lines": "69", "method_info": {"method_name": "multiselect", "method_params": "dg,label,options,default,format_func,key", "method_startline": "8", "method_endline": "92"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "lib\\tests\\streamlit\\multiselect_test.py", "file_new_name": "lib\\tests\\streamlit\\multiselect_test.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "117", "deleted_lines": null}}}}}}