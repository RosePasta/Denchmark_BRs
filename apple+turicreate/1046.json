{"BR": {"BR_id": "1046", "BR_author": "henrytkirk", "BRopenT": "2018-08-27T16:14:45Z", "BRcloseT": "2018-11-16T19:55:10Z", "BR_text": {"BRsummary": "Check failed: l == 1 || r == 1 operands could not be broadcast together with shapes [416,416,4] [1,1,3]", "BRdescription": "\n Hi,\n I'm having the following issue when I run this command:\n model = tc.object_detector.create(data, feature='image', annotations='annotations', max_iterations=5)\n <denchmark-code>Downloading https://docs-assets.developer.apple.com/turicreate/models/darknet.params\n Download completed: /var/folders/k5/x_hplcg9495b5sqj_rvxym540000gn/T/model_cache/darknet.params\n Setting 'batch_size' to 16\n Using GPU to create model (NVIDIA GeForce GT 750M)\n Exception in thread Thread-5:\n Traceback (most recent call last):\n   File \"/anaconda2/lib/python2.7/threading.py\", line 801, in __bootstrap_inner\n     self.run()\n   File \"/anaconda2/lib/python2.7/threading.py\", line 754, in run\n     self.__target(*self.__args, **self.__kwargs)\n   File \"/anaconda2/lib/python2.7/site-packages/turicreate/toolkits/object_detector/object_detector.py\", line 482, in sframe_worker\n     for batch in loader:\n   File \"/anaconda2/lib/python2.7/site-packages/turicreate/toolkits/object_detector/_sframe_loader.py\", line 333, in next\n     return self._next()\n   File \"/anaconda2/lib/python2.7/site-packages/turicreate/toolkits/object_detector/_sframe_loader.py\", line 405, in _next\n     image, bbox = aug(image, bbox)\n   File \"/anaconda2/lib/python2.7/site-packages/mxnet/image/detection.py\", line 86, in __call__\n     src = self.augmenter(src)\n   File \"/anaconda2/lib/python2.7/site-packages/mxnet/image/image.py\", line 659, in __call__\n     src = t(src)\n   File \"/anaconda2/lib/python2.7/site-packages/mxnet/image/image.py\", line 698, in __call__\n     gray = src * self.coef\n   File \"/anaconda2/lib/python2.7/site-packages/mxnet/ndarray/ndarray.py\", line 235, in __mul__\n     return multiply(self, other)\n   File \"/anaconda2/lib/python2.7/site-packages/mxnet/ndarray/ndarray.py\", line 2566, in multiply\n     None)\n   File \"/anaconda2/lib/python2.7/site-packages/mxnet/ndarray/ndarray.py\", line 2379, in _ufunc_helper\n     return fn_array(lhs, rhs)\n   File \"<string>\", line 46, in broadcast_mul\n   File \"/anaconda2/lib/python2.7/site-packages/mxnet/_ctypes/ndarray.py\", line 92, in _imperative_invoke\n     ctypes.byref(out_stypes)))\n   File \"/anaconda2/lib/python2.7/site-packages/mxnet/base.py\", line 146, in check_call\n     raise MXNetError(py_str(_LIB.MXGetLastError()))\n MXNetError: [09:11:17] src/operator/tensor/./elemwise_binary_broadcast_op.h:67: Check failed: l == 1 || r == 1 operands could not be broadcast together with shapes [416,416,4] [1,1,3]\n \n Stack trace returned 8 entries:\n [bt] (0) 0   libmxnet.so                         0x0000000a0da942cf libmxnet.so + 58063\n [bt] (1) 1   libmxnet.so                         0x0000000a0da9406f libmxnet.so + 57455\n [bt] (2) 2   libmxnet.so                         0x0000000a0de3a7f8 libmxnet.so + 3885048\n [bt] (3) 3   libmxnet.so                         0x0000000a0ea9b427 MXNDListFree + 420935\n [bt] (4) 4   libmxnet.so                         0x0000000a0ea9a029 MXNDListFree + 415817\n [bt] (5) 5   libmxnet.so                         0x0000000a0ea1c277 MXCustomFunctionRecord + 16119\n [bt] (6) 6   libmxnet.so                         0x0000000a0ea1d444 MXImperativeInvokeEx + 164\n [bt] (7) 7   libffi.6.dylib                      0x00000001031e7884 ffi_call_unix64 + 76\n </denchmark-code>\n \n I have OSX Mojave Beta, MacBook Pro (Retina, 15-inch, Late 2013). Sometimes the processing works, sometimes not. Can you point me to what might be wrong? Did I install anything incorrectly? I'm using the mxnet v1.1.0 as mentioned in another post.\n Thanks for the help.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "henrytkirk", "commentT": "2018-08-27T20:30:21Z", "comment_text": "\n \t\tThat's not expected. Can you share a sample of your dataset and annotations with us for us to be able to reproduce it?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "henrytkirk", "commentT": "2018-08-27T20:48:16Z", "comment_text": "\n \t\tSure, where can I securely send them to?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "henrytkirk", "commentT": "2018-08-28T15:46:51Z", "comment_text": "\n \t\tI think it's something to do with the JPEG images. I converted them to PNG's and I did not get the error.\n Anything special with how JPEGs need to be created/compressed? Color profiles?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "henrytkirk", "commentT": "2018-08-31T07:59:33Z", "comment_text": "\n \t\tHello, I'm getting something similar to this using 5.0b3\n I can package up my env and jupyter notebook to send over. Just let me know where to send it.\n From the command model = tc.object_detector.create(train, \"annotations\", max_iterations=5000) I'm getting...\n <denchmark-code>Using 'image' as feature column\n Setting 'batch_size' to 32\n Using CPU to create model\n ---------------------------------------------------------------------------\n MXNetError                                Traceback (most recent call last)\n <ipython-input-6-d1599f5a5b12> in <module>()\n       1 train, test = data.random_split(0.8)\n ----> 2 model = tc.object_detector.create(train, \"annotations\", max_iterations=5000)\n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/turicreate/toolkits/object_detector/object_detector.pyc in create(dataset, annotations, feature, model, classes, batch_size, max_iterations, verbose, **kwargs)\n     570         trainer = _mx.gluon.Trainer(net.collect_params(), 'sgd', options)\n     571 \n --> 572         for batch in loader:\n     573             data = _mx.gluon.utils.split_and_load(batch.data[0], ctx_list=ctx, batch_axis=0)\n     574             label = _mx.gluon.utils.split_and_load(batch.label[0], ctx_list=ctx, batch_axis=0)\n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/turicreate/toolkits/object_detector/_sframe_loader.pyc in next(self)\n     331 \n     332     def next(self):\n --> 333         return self._next()\n     334 \n     335     @property\n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/turicreate/toolkits/object_detector/_sframe_loader.pyc in _next(self)\n     403             for aug in self.augmentations:\n     404                 try:\n --> 405                     image, bbox = aug(image, bbox)\n     406                 except ValueError:\n     407                     # It is extremely rare, but mxnet can fail for some reason.\n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/mxnet/image/detection.pyc in __call__(self, src, label)\n      84     def __call__(self, src, label):\n      85         \"\"\"Augmenter implementation body\"\"\"\n ---> 86         src = self.augmenter(src)\n      87         return (src, label)\n      88 \n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/mxnet/image/image.pyc in __call__(self, src)\n     657         random.shuffle(self.ts)\n     658         for t in self.ts:\n --> 659             src = t(src)\n     660         return src\n     661 \n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/mxnet/image/image.pyc in __call__(self, src)\n     696         \"\"\"Augmenter body\"\"\"\n     697         alpha = 1.0 + random.uniform(-self.contrast, self.contrast)\n --> 698         gray = src * self.coef\n     699         gray = (3.0 * (1.0 - alpha) / gray.size) * nd.sum(gray)\n     700         src *= alpha\n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/mxnet/ndarray/ndarray.pyc in __mul__(self, other)\n     233     def __mul__(self, other):\n     234         \"\"\"x.__mul__(y) <=> x*y <=> mx.nd.multiply(x, y) \"\"\"\n --> 235         return multiply(self, other)\n     236 \n     237     def __neg__(self):\n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/mxnet/ndarray/ndarray.pyc in multiply(lhs, rhs)\n    2564         operator.mul,\n    2565         _internal._mul_scalar,\n -> 2566         None)\n    2567     # pylint: enable= no-member, protected-access\n    2568 \n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/mxnet/ndarray/ndarray.pyc in _ufunc_helper(lhs, rhs, fn_array, fn_scalar, lfn_scalar, rfn_scalar)\n    2377         return lfn_scalar(lhs, float(rhs))\n    2378     elif isinstance(rhs, NDArray):\n -> 2379         return fn_array(lhs, rhs)\n    2380     else:\n    2381         raise TypeError('type %s not supported' % str(type(rhs)))\n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/mxnet/ndarray/register.pyc in broadcast_mul(lhs, rhs, out, name, **kwargs)\n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/mxnet/_ctypes/ndarray.pyc in _imperative_invoke(handle, ndargs, keys, vals, out)\n      90         c_str_array(keys),\n      91         c_str_array([str(s) for s in vals]),\n ---> 92         ctypes.byref(out_stypes)))\n      93 \n      94     if original_output is not None:\n \n /Users/editing/Desktop/aux-phase5/Prototypes/object-recognition/lib/python2.7/site-packages/mxnet/base.pyc in check_call(ret)\n     144     \"\"\"\n     145     if ret != 0:\n --> 146         raise MXNetError(py_str(_LIB.MXGetLastError()))\n     147 \n     148 \n \n MXNetError: [08:52:55] src/operator/tensor/./elemwise_binary_broadcast_op.h:67: Check failed: l == 1 || r == 1 operands could not be broadcast together with shapes [416,416,4] [1,1,3]\n \n Stack trace returned 8 entries:\n [bt] (0) 0   libmxnet.so                         0x00000001176ec7cf libmxnet.so + 59343\n [bt] (1) 1   libmxnet.so                         0x00000001176ec56f libmxnet.so + 58735\n [bt] (2) 2   libmxnet.so                         0x0000000117a92cf8 libmxnet.so + 3886328\n [bt] (3) 3   libmxnet.so                         0x00000001186f6e37 MXNDListFree + 434551\n [bt] (4) 4   libmxnet.so                         0x00000001186f5a39 MXNDListFree + 429433\n [bt] (5) 5   libmxnet.so                         0x0000000118674757 MXCustomFunctionRecord + 16119\n [bt] (6) 6   libmxnet.so                         0x0000000118675924 MXImperativeInvokeEx + 164\n [bt] (7) 7   libffi.dylib                        0x00007fff6584ef64 ffi_call_unix64 + 76\n </denchmark-code>\n \n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "henrytkirk", "commentT": "2018-08-31T21:42:11Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/henrytkirk>@henrytkirk</denchmark-link>\n  You can send your JPEGs that consistently repro this issue to the email address in <denchmark-link:https://github.com/znation>my profile</denchmark-link>\n . We can investigate from there, thanks!\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "henrytkirk", "commentT": "2018-09-11T12:58:36Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/znation>@znation</denchmark-link>\n  Can I send you my set? I've got a lot of images and it's been really hard trying to figure out which ones might be causing the issue. My zipped set is about 125MB so email won't work too well for that.\n \t\t"}, "comments_6": {"comment_id": 7, "comment_author": "henrytkirk", "commentT": "2018-09-12T11:45:33Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/znation>@znation</denchmark-link>\n  Apologies for the comment spam but I was able to get a smaller replication set and I have emailed it to you. Please let me know if there is more information you need.\n \t\t"}, "comments_7": {"comment_id": 8, "comment_author": "henrytkirk", "commentT": "2018-09-19T00:31:41Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/henrytkirk>@henrytkirk</denchmark-link>\n  <denchmark-link:https://github.com/concertman>@concertman</denchmark-link>\n  ran into the same problem today. Converting the images from RGBA (4 channels) to RGB (3 channels) solved my issue. Hope this helps: <denchmark-link:https://github.com/apple/turicreate/issues/114>#114</denchmark-link>\n \n \t\t"}, "comments_8": {"comment_id": 9, "comment_author": "henrytkirk", "commentT": "2018-09-29T16:45:14Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/znation>@znation</denchmark-link>\n  I am also running into this issue and am not sure why <denchmark-link:https://github.com/apple/turicreate/issues/114>#114</denchmark-link>\n  was closed. It repros with pretty much every set of images I throw at it.\n \t\t"}, "comments_9": {"comment_id": 10, "comment_author": "henrytkirk", "commentT": "2018-09-29T17:05:28Z", "comment_text": "\n \t\tI stopped getting this bug when I downgraded by 2015 iMac to high Sierra. This bug must have something to do with the GPU support in Mojave. I hope this helps.\n \t\t"}, "comments_10": {"comment_id": 11, "comment_author": "henrytkirk", "commentT": "2018-10-01T09:12:19Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/yousifKashef>@yousifKashef</denchmark-link>\n  I was getting this on High Sierra as well so the Mojave thing might be a red herring.\n \t\t"}}}, "commit": {"commit_id": "2754bc7094ab28ecb2c67382a32c0071c34e9dfe", "commit_author": "fareeha", "commitT": "2018-11-16 11:55:09-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\image\\jpeg_io.cpp", "file_new_name": "src\\image\\jpeg_io.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "85,86,87,88", "deleted_lines": null, "method_info": {"method_name": "turi::decode_jpeg", "method_params": "data,length,out_data,out_length", "method_startline": "63", "method_endline": "114"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\unity\\python\\turicreate\\test\\test_image_type.py", "file_new_name": "src\\unity\\python\\turicreate\\test\\test_image_type.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "124,125,126,127,128,129,130,131,132,133,134", "deleted_lines": null, "method_info": {"method_name": "test_cmyk_not_supported", "method_params": "self", "method_startline": "124", "method_endline": "134"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "src\\unity\\python\\turicreate\\toolkits\\object_detector\\_sframe_loader.py", "file_new_name": "src\\unity\\python\\turicreate\\toolkits\\object_detector\\_sframe_loader.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "20,21,22", "deleted_lines": null, "method_info": {"method_name": "_convert_image_to_raw", "method_params": "image", "method_startline": "20", "method_endline": "22"}}, "hunk_1": {"Ismethod": 1, "added_lines": "84,85,86,87,88", "deleted_lines": "80", "method_info": {"method_name": "_next", "method_params": "self", "method_startline": "71", "method_endline": "100"}}}}}}}