{"BR": {"BR_id": "227", "BR_author": "KeyboardNerd", "BRopenT": "2018-01-30T22:41:58Z", "BRcloseT": "2018-03-02T10:01:19Z", "BR_text": {"BRsummary": "csv header parsing problem with BOM UTF8", "BRdescription": "\n I'm using Python 2.7.13 with turicreate version 4.0 shown by \"pip show turicreate\".\n To recreate the bug,\n \n \n Write character 'a' to \"buggy.csv\" in UTF-8 encoding.\n \n \n Run the following code:\n import turicreate as tc data1 = tc.SFrame('buggy.csv') print data1['a'] \n \n \n Expected output:\n []\n Actual output:\n RuntimeError: Column name a does not exist.\n I used a debugger and found that the corresponding column in data1 for 'a' is '\\xef\\xbb\\xbfa', which means that the BOM is incorrectly parsed as header.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "KeyboardNerd", "commentT": "2018-01-30T22:55:03Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/KeyboardNerd>@KeyboardNerd</denchmark-link>\n  - Does it work if you do: ? This is the intended way to read CSV files.\n What you're doing should probably give an error. I'll take a look at that. Please attach buggy.csv to this issue.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "KeyboardNerd", "commentT": "2018-01-30T23:08:55Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/TobyRoseman>@TobyRoseman</denchmark-link>\n  result is the same\n You can remove the \".txt\" for the csv file.\n <denchmark-link:https://github.com/apple/turicreate/files/1679773/buggy.csv.txt>buggy.csv.txt</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "KeyboardNerd", "commentT": "2018-02-06T17:44:13Z", "comment_text": "\n \t\tGood find. Interestingly, the column name is parsed incorrectly\n <denchmark-code>In [13]: data1\n Out[13]:\n Columns:\n \ta\tstr\n \n Rows: 0\n \n Data:\n \t[]\n \n In [14]: data1.column_names()\n Out[14]: ['\\xef\\xbb\\xbfa']\n </denchmark-code>\n \n We'll investigate\n \t\t"}}}, "commit": {"commit_id": "56640a3f938bbb4790f414a2256c2c25157e1b36", "commit_author": "Krishna Sridhar", "commitT": "2018-03-02 02:01:18-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 17, "file_old_name": "src\\sframe\\parallel_csv_parser.cpp", "file_new_name": "src\\sframe\\parallel_csv_parser.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "419,448", "deleted_lines": "432,451", "method_info": {"method_name": "turi::parallel_csv_parser::advance_past_newline", "method_params": "c,cend,newline_was_matched", "method_startline": "411", "method_endline": "451"}}, "hunk_1": {"Ismethod": 1, "added_lines": "467,470,473,492,497,501,502", "deleted_lines": "454,457,476,481,485,486,503", "method_info": {"method_name": "turi::parallel_csv_parser::parse_line", "method_params": "pstart,pnext,threadid", "method_startline": "454", "method_endline": "503"}}, "hunk_2": {"Ismethod": 1, "added_lines": "742,757", "deleted_lines": "741", "method_info": {"method_name": "turi::make_unique_column_names", "method_params": "column_names", "method_startline": "741", "method_endline": "769"}}, "hunk_3": {"Ismethod": 1, "added_lines": "849,858", "deleted_lines": "881,883,886,888", "method_info": {"method_name": "turi::get_column_types", "method_params": "info,column_type_hints", "method_startline": "849", "method_endline": "890"}}, "hunk_4": {"Ismethod": 1, "added_lines": "928,936,946,948,955,972,973", "deleted_lines": "917,927,929,936,953,954,983,985", "method_info": {"method_name": "turi::parse_csv_to_sframe", "method_params": "path,tokenizer,options,frame,frame_sidx_file,parser,errors", "method_startline": "909", "method_endline": "986"}}, "hunk_5": {"Ismethod": 1, "added_lines": "621,622,625", "deleted_lines": null, "method_info": {"method_name": "turi::parallel_csv_parser::add_line_terminator_to_buffer", "method_params": "", "method_startline": "620", "method_endline": "630"}}, "hunk_6": {"Ismethod": 1, "added_lines": "204,205,212,213,253,254,256,271,294,295,296", "deleted_lines": "237,238,240,255,278,279,280,295", "method_info": {"method_name": "turi::parallel_csv_parser::parse", "method_params": "fin,output_frame,errors", "method_startline": "204", "method_endline": "300"}}, "hunk_7": {"Ismethod": 1, "added_lines": "519,534,537,550,551,552,553,555,558,566,574,577,591", "deleted_lines": "518,521,534,535,536,537,539,542,550,558,561,575,599,600,602,605,606,609", "method_info": {"method_name": "turi::parallel_csv_parser::parse_thread", "method_params": "threadid", "method_startline": "509", "method_endline": "612"}}, "hunk_8": {"Ismethod": 1, "added_lines": "692,693,707,711,717", "deleted_lines": "695,701", "method_info": {"method_name": "turi::parallel_csv_parser::start_background_write", "method_params": "output_frame,errors_array,output_segment", "method_startline": "692", "method_endline": "720"}}, "hunk_9": {"Ismethod": 1, "added_lines": "802,814,815", "deleted_lines": "797,798,832", "method_info": {"method_name": "turi::read_csv_header", "method_params": "info,path,tokenizer,use_header,skip_rows", "method_startline": "790", "method_endline": "833"}}, "hunk_10": {"Ismethod": 1, "added_lines": "34,35,36,37,38,39,40,41,42,43,44,45", "deleted_lines": null, "method_info": {"method_name": "turi::skip_BOM", "method_params": "fin", "method_startline": "34", "method_endline": "45"}}, "hunk_11": {"Ismethod": 1, "added_lines": "1002,1004,1009,1029,1038,1078,1082,1119,1120,1131,1132,1133,1137,1141,1143", "deleted_lines": "990,1010,1019,1059,1063,1100,1101,1112,1113,1114,1118,1122,1124", "method_info": {"method_name": "turi::parse_csvs_to_sframe", "method_params": "url,tokenizer,options,frame,frame_sidx_file", "method_startline": "988", "method_endline": "1145"}}, "hunk_12": {"Ismethod": 1, "added_lines": "172,179,180,181,183,184,187,188", "deleted_lines": "172,177,188,189", "method_info": {"method_name": "turi::parallel_csv_parser::parallel_csv_parser", "method_params": "column_types,tokenizer,continue_on_failure,store_errors,row_limit,column_output_order,num_threads", "method_startline": "172", "method_endline": "192"}}, "hunk_13": {"Ismethod": 1, "added_lines": "391", "deleted_lines": null, "method_info": {"method_name": "turi::parallel_csv_parser::is_end_line_str", "method_params": "c,cend", "method_startline": "389", "method_endline": "400"}}, "hunk_14": {"Ismethod": 1, "added_lines": "89,90,95", "deleted_lines": "111,115,116", "method_info": {"method_name": "turi::custom_eol_getline", "method_params": "is,t,eol", "method_startline": "89", "method_endline": "124"}}, "hunk_15": {"Ismethod": 1, "added_lines": "131,132", "deleted_lines": null, "method_info": {"method_name": "turi::eol_getline", "method_params": "is,t,eol", "method_startline": "131", "method_endline": "139"}}, "hunk_16": {"Ismethod": 1, "added_lines": "668", "deleted_lines": "671,672,676,677", "method_info": {"method_name": "turi::parallel_csv_parser::parallel_parse", "method_params": "", "method_startline": "662", "method_endline": "684"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "src\\unity\\python\\turicreate\\test\\test_sframe.py", "file_new_name": "src\\unity\\python\\turicreate\\test\\test_sframe.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216", "deleted_lines": "212", "method_info": {"method_name": "test_auto_parse_csv_with_bom", "method_params": "self", "method_startline": "199", "method_endline": "216"}}}}}}}