{"BR": {"BR_id": "2037", "BR_author": "EnricoMi", "BRopenT": "2020-06-19T07:20:23Z", "BRcloseT": "2020-06-19T17:23:09Z", "BR_text": {"BRsummary": "Running horovod.spark.run with env=os.environ fails", "BRdescription": "\n Example:\n <denchmark-code>horovod.spark.run(fn, num_proc=2, env=os.environ)\n </denchmark-code>\n \n That env is an object, not a dictionary. It cannot be pickled:\n <denchmark-code>Traceback (most recent call last):\n   File \"horovod/run/common/util/tiny_shell_exec.py\", line 32, in execute\n     exit_code = safe_shell_exec.execute(command, env=env, stdout=output, stderr=output)\n   File \"horovod/run/common/util/safe_shell_exec.py\", line 183, in execute\n     middleman.start()\n   File \"multiprocessing/process.py\", line 105, in start\n     self._popen = self._Popen(self)\n   File \"multiprocessing/context.py\", line 284, in _Popen\n     return Popen(process_obj)\n   File \"multiprocessing/popen_spawn_posix.py\", line 32, in __init__\n     super().__init__(process_obj)\n   File \"multiprocessing/popen_fork.py\", line 19, in __init__\n     self._launch(process_obj)\n   File \"multiprocessing/popen_spawn_posix.py\", line 47, in _launch\n     reduction.dump(process_obj, fp)\n   File \"multiprocessing/reduction.py\", line 60, in dump\n     ForkingPickler(file, protocol).dump(obj)\n AttributeError: Can't pickle local object '_createenviron.<locals>.encode'\n </denchmark-code>\n \n It works with\n <denchmark-code>horovod.spark.run(fn, num_proc=2, env=os.environ.copy())\n </denchmark-code>\n \n The run function needs to copy env itself first.\n \t"}, "comments": {}}, "commit": {"commit_id": "dd553f35eeb65dcc9d59daeb9ffbdcf609d835da", "commit_author": "Enrico Minack", "commitT": "2020-06-19 10:23:08-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "horovod\\run\\mpi_run.py", "file_new_name": "horovod\\run\\mpi_run.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "137,138,139,140", "deleted_lines": null, "method_info": {"method_name": "mpi_run", "method_params": "settings,nics,env,command,stdout,stderr", "method_startline": "122", "method_endline": "206"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 6, "file_old_name": "test\\test_run.py", "file_new_name": "test\\test_run.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "707,708,709,710,711,712,713", "deleted_lines": null, "method_info": {"method_name": "test_gloo_run_with_os_environ", "method_params": "self", "method_startline": "707", "method_endline": "713"}}, "hunk_1": {"Ismethod": 1, "added_lines": "696,697,698,699,700,701,702", "deleted_lines": null, "method_info": {"method_name": "test_gloo_run_minimal", "method_params": "self", "method_startline": "696", "method_endline": "702"}}, "hunk_2": {"Ismethod": 1, "added_lines": "685,686", "deleted_lines": null, "method_info": {"method_name": "test_mpi_run_with_os_environ.mpi_impl_flags", "method_params": "tcp,env", "method_startline": "685", "method_endline": "686"}}, "hunk_3": {"Ismethod": 1, "added_lines": "567", "deleted_lines": "566", "method_info": {"method_name": "test_mpi_run_minimal", "method_params": "self", "method_startline": "548", "method_endline": "572"}}, "hunk_4": {"Ismethod": 1, "added_lines": "678,679,680,681,682,683,684,685,686,687,688,689,690,691", "deleted_lines": null, "method_info": {"method_name": "test_mpi_run_with_os_environ", "method_params": "self", "method_startline": "678", "method_endline": "691"}}, "hunk_5": {"Ismethod": 1, "added_lines": "599", "deleted_lines": "598", "method_info": {"method_name": "test_mpi_run_on_large_cluster", "method_params": "self", "method_startline": "577", "method_endline": "604"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "test\\test_spark.py", "file_new_name": "test\\test_spark.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "479,480,481,482,483,484", "deleted_lines": null, "method_info": {"method_name": "test_spark_run_with_os_environ_with_mpi", "method_params": "self", "method_startline": "479", "method_endline": "484"}}}}}}}