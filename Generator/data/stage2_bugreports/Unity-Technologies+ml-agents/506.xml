<bug id='506' author='NiloFreitas' open_date='2018-03-18T21:08:38Z' closed_time='2018-03-28T21:19:56Z'>
	<summary>Internal Brain with Visual Obs Error</summary>
	<description>
Hi, I am trying to run an Internal Brain with the .bytes file generated by my python implementation and the input placeholder receives a camera image that has shape [None,width,height, 1] (black and white). The vector obs size is 0.
However, I am getting the following errors:
&lt;denchmark-code&gt;&gt; IndexOutOfRangeException: Index was outside the bounds of the array.
&gt; (wrapper managed-to-managed) System.Object.ElementAddr_4(object,int,int,int,int)
&gt; CoreBrainInternal.BatchVisualObservations (System.Collections.Generic.List`1[T] textures, System.Boolean BlackAndWhite) (at Assets/ML-Agents/Scripts/CoreBrainInternal.cs:535)
&gt; CoreBrainInternal.DecideAction (System.Collections.Generic.Dictionary`2[TKey,TValue] agentInfo) (at Assets/ML-Agents/Scripts/CoreBrainInternal.cs:222)
&gt; Brain.DecideAction () (at Assets/ML-Agents/Scripts/Brain.cs:241)
&gt; Academy.EnvironmentStep () (at Assets/ML-Agents/Scripts/Academy.cs:477)
&gt; Academy.FixedUpdate () (at Assets/ML-Agents/Scripts/Academy.cs:507)

&lt;/denchmark-code&gt;

and
&lt;denchmark-code&gt;&gt; ArgumentException: An item with the same key has already been added. Key: IAgent (IAgent)
&gt; System.Collections.Generic.Dictionary`2[TKey,TValue].TryInsert (TKey key, TValue value, System.Collections.Generic.InsertionBehavior behavior) (at /Users/builduser/buildslave/mono/build/external/corert/src/System.Private.CoreLib/src/System/Collections/Generic/Dictionary.cs:451)
&gt; System.Collections.Generic.Dictionary`2[TKey,TValue].Add (TKey key, TValue value) (at /Users/builduser/buildslave/mono/build/external/corert/src/System.Private.CoreLib/src/System/Collections/Generic/Dictionary.cs:234)
&gt; Brain.SendState (Agent agent, AgentInfo info) (at Assets/ML-Agents/Scripts/Brain.cs:234)
&gt; Agent.SendInfoToBrain () (at Assets/ML-Agents/Scripts/Agent.cs:566)
&gt; Agent.SendInfo () (at Assets/ML-Agents/Scripts/Agent.cs:829)
&gt; Academy.EnvironmentStep () (at Assets/ML-Agents/Scripts/Academy.cs:475)
&gt; Academy.FixedUpdate () (at Assets/ML-Agents/Scripts/Academy.cs:507)
&lt;/denchmark-code&gt;

Here is a print of the inspector:
&lt;denchmark-link:https://user-images.githubusercontent.com/26013740/37571107-f9e91b20-2ad6-11e8-88b9-f4b1b793023c.png&gt;&lt;/denchmark-link&gt;

Thank you for any help
	</description>
	<comments>
		<comment id='1' author='NiloFreitas' date='2018-03-19T17:27:06Z'>
		I think you have found a bug. Could you try an see if this &lt;denchmark-link:https://github.com/Unity-Technologies/ml-agents/pull/509&gt;PR&lt;/denchmark-link&gt;
 solves your problem ?
		</comment>
		<comment id='2' author='NiloFreitas' date='2018-03-19T23:44:22Z'>
		Hi,
That solved the errors, that now no longer appear.
However, the trained model when executed (play with the internal brain) does not behave as expected.
I'll be following the PR.
Thanks.
		</comment>
		<comment id='3' author='NiloFreitas' date='2018-03-20T00:32:38Z'>
		Hi &lt;denchmark-link:https://github.com/NiloFreitas&gt;@NiloFreitas&lt;/denchmark-link&gt;
,
One possibility for the decrease in performance from training to inference is that the visual quality settings in Unity may mean that the image the CNN receives changes. One quick way to test this is to set "Quality Settings" to the same number for both training and inference from within the Unity Academy component. A second way to test whether there is a bug in the Internal brain is to try running learn.py with --load --slow instead of --train.
		</comment>
		<comment id='4' author='NiloFreitas' date='2018-03-21T14:42:42Z'>
		Hi,
Of course! Thank you!
		</comment>
		<comment id='5' author='NiloFreitas' date='2020-01-03T15:38:16Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>