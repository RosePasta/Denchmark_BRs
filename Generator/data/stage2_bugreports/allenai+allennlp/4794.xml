<bug id='4794' author='vikigenius' open_date='2020-11-14T03:18:13Z' closed_time='2020-12-21T17:22:09Z'>
	<summary>Multi GPU training deadlocks when using patience</summary>
	<description>
&lt;denchmark-h:h2&gt;Checklist&lt;/denchmark-h&gt;


[*] I have verified that the issue exists against the master branch of AllenNLP.
[*] I have read the relevant section in the contribution guide on reporting bugs.
[*] I have checked the issues list for similar or identical bug reports.
[*] I have checked the pull requests list for existing proposed fixes.
[*] I have checked the CHANGELOG and the commit log to find out if the bug was already fixed in the master branch.
[*] I have included in the "Description" section below a traceback from any exceptions related to this bug.
[*] I have included in the "Related issues or possible duplicates" section beloew all related issues and possible duplicate issues (If there are none, check this box anyway).
[*] I have included in the "Environment" section below the name of the operating system and Python version that I was using when I discovered this bug.
[*] I have included in the "Environment" section below the output of pip freeze.
[*] I have included in the "Steps to reproduce" section below a minimally reproducible example.

&lt;denchmark-h:h2&gt;Description&lt;/denchmark-h&gt;

In my config I set patience to 3 and am using 8 GPUs. I notice that Worker 5 ran out of patience according to out_worker5.log and it says it was going to load the best weights. But the master said it was the best validation metric yet and was saving the weights to best.th ?
This causes a deadlock and the whole thing hangs.
&lt;denchmark-h:h2&gt;Related issues or possible duplicates&lt;/denchmark-h&gt;


None

&lt;denchmark-h:h2&gt;Environment&lt;/denchmark-h&gt;

OS: linux
Python version: 3.8

Output of pip freeze:

alabaster @ file:///home/void/.cache/pypoetry/artifacts/01/50/a4/e8f66b1cc7b3896e348a7976ec6390f61a7ed3cc0583b406c9a737955a/alabaster-0.7.12-py2.py3-none-any.whl
alembic @ file:///home/void/.cache/pypoetry/artifacts/0e/1c/e4/ac76b5bee931060d4168f965e85b4348bd828c3c2058657c87632dd955/alembic-1.4.3-py2.py3-none-any.whl
allennlp @ file:///home/void/.cache/pypoetry/artifacts/c8/b7/56/941c7cd1328bf83c98ebc9cbc49a69faf3bf13c67b7b84c0783ca82747/allennlp-1.2.0-py3-none-any.whl
allennlp-optuna @ file:///home/void/.cache/pypoetry/artifacts/f8/e9/9e/6a38853efc3077da4d9b19b4d30d110f196142c142b04392112e7ee71f/allennlp_optuna-0.1.3-py3-none-any.whl
argon2-cffi @ file:///home/void/.cache/pypoetry/artifacts/ed/b1/79/070afdded6990696180ad5ca5dc36c165047414604d3b43d51b546c2a3/argon2_cffi-20.1.0-cp35-abi3-manylinux1_x86_64.whl
astor @ file:///home/void/.cache/pypoetry/artifacts/00/68/e3/b2c93c6b1eabbb453b7a288336d64a2bb9f32b6821173440843f97f64b/astor-0.8.1-py2.py3-none-any.whl
async-generator @ file:///home/void/.cache/pypoetry/artifacts/60/d6/35/e25389ca9cdf584a7a41be4eab45a490150210296ca82c7eb696a7e21b/async_generator-1.10-py3-none-any.whl
attrs @ file:///home/void/.cache/pypoetry/artifacts/b7/28/6f/acdd2c0e759f1cda97abf00db7723a0ffb3a151696d8d96398aea16171/attrs-20.3.0-py2.py3-none-any.whl
Babel @ file:///home/void/.cache/pypoetry/artifacts/ff/50/c8/59488715be6e53024188713fe5f553c3c5cb8cf90d5cb67d99a4537a1d/Babel-2.8.0-py2.py3-none-any.whl
backcall @ file:///home/void/.cache/pypoetry/artifacts/62/2c/f2/bf9c43ca0bcfca41150901227b0d023dc854851b710f82a72f5beaa09b/backcall-0.2.0-py2.py3-none-any.whl
bandit @ file:///home/void/.cache/pypoetry/artifacts/47/cd/d3/5a6d0033a8180d54f1386733bfc852e9af38065a6ac17167ef1d419519/bandit-1.6.2-py2.py3-none-any.whl
bleach @ file:///home/void/.cache/pypoetry/artifacts/50/10/08/2418e45f83f9f6538283b4889dfe95f638b059a3b1171361964a942443/bleach-3.2.1-py2.py3-none-any.whl
blis @ file:///home/void/.cache/pypoetry/artifacts/80/ff/ca/24796c31aec948caac3c34282feaad98a28e3f33a02f6d508d1b3ecce0/blis-0.4.1-cp38-cp38-manylinux1_x86_64.whl
boto3 @ file:///home/void/.cache/pypoetry/artifacts/f1/0d/ca/969ea797ea9937193dce47efea279576d05bf299a640572acb3d2bcb52/boto3-1.16.15-py2.py3-none-any.whl
botocore @ file:///home/void/.cache/pypoetry/artifacts/fd/2f/cc/cb42383caa85c75496e64acc5b2ae3802293f35c36e783d6ddd1eaf594/botocore-1.19.15-py2.py3-none-any.whl
catalogue @ file:///home/void/.cache/pypoetry/artifacts/66/0c/9f/6e9dcd1587b0eb24a7c0c5a7209d9d3329db000eccd099aba006ce8c42/catalogue-1.0.0-py2.py3-none-any.whl
certifi @ file:///home/void/.cache/pypoetry/artifacts/8d/cd/09/57a024ed8656c6768f725b42dee14ac65c94684f2896a5831cdff33338/certifi-2020.11.8-py2.py3-none-any.whl
cffi @ file:///home/void/.cache/pypoetry/artifacts/67/3e/bf/ce28c804d7c4471104482a78ebbdb727dd2fc2d2e051e8cbd010528cc5/cffi-1.14.3-cp38-cp38-manylinux1_x86_64.whl
chardet @ file:///home/void/.cache/pypoetry/artifacts/c2/02/35/0d93b80c730b360c5e3d9bdc1b8d1929dbd784ffa8e3db025c14c045e4/chardet-3.0.4-py2.py3-none-any.whl
click @ file:///home/void/.cache/pypoetry/artifacts/30/bc/bf/e00ffd8f0edf0294942e70e80e42a839bd2649d2c5b864e6389e526d2a/click-7.1.2-py2.py3-none-any.whl
cliff @ file:///home/void/.cache/pypoetry/artifacts/fb/21/92/915d48b852194d9ce982d585b0285fb54b4f9cedeadf7dc562a07eecf0/cliff-3.5.0-py3-none-any.whl
cmaes @ file:///home/void/.cache/pypoetry/artifacts/6c/56/15/8e79d028097c737756c60c374563860146e0f7df08aa1db65c016029fc/cmaes-0.7.0-py3-none-any.whl
cmd2 @ file:///home/void/.cache/pypoetry/artifacts/78/14/5d/905559dbc4645b2f4dee7e7fc2e6c173b916be3571da97a3fcefb08296/cmd2-1.4.0-py3-none-any.whl
colorama @ file:///home/void/.cache/pypoetry/artifacts/b0/f3/a3/cf94f06cbe1d286a25116cfe54d5a75cb1c4b54d15b2b1b4fc03a7f657/colorama-0.4.4-py2.py3-none-any.whl
colorlog @ file:///home/void/.cache/pypoetry/artifacts/27/6e/0a/5fbde594aaa2a559f7a0eb38e2516470b4fca329664c3cf201300e282c/colorlog-4.6.2-py2.py3-none-any.whl
coverage @ file:///home/void/.cache/pypoetry/artifacts/3a/91/54/2cf1dc70616c58be152f7d5c8a2d4e5a73c30c07a3dee33242ebf0bf2a/coverage-5.3-cp38-cp38-manylinux1_x86_64.whl
cymem @ file:///home/void/.cache/pypoetry/artifacts/23/51/99/2761ff165e0524dee6b93e63eb65d28172174fe38bcf938d002bbb3b7d/cymem-2.0.4-cp38-cp38-manylinux2014_x86_64.whl
darglint @ file:///home/void/.cache/pypoetry/artifacts/75/d3/fa/7f69c452fedb144eba1f91f7d8a347871b1b088288b7162abf65603901/darglint-1.5.5-py3-none-any.whl
decorator @ file:///home/void/.cache/pypoetry/artifacts/e8/56/46/038f0f95c2eb2a2792092491cba740226306e663708d5062754d1cb91f/decorator-4.4.2-py2.py3-none-any.whl
defusedxml @ file:///home/void/.cache/pypoetry/artifacts/8b/b9/f6/56ba9b58f3a759ce345d18bad38edfc12a9f60420962a17a2084202e0e/defusedxml-0.6.0-py2.py3-none-any.whl
dictdiffer @ file:///home/void/.cache/pypoetry/artifacts/eb/97/47/75d6a828e2d9ef1962485d485975c13ff4d8935bb03440f802941f5df2/dictdiffer-0.8.1-py2.py3-none-any.whl
doc8 @ file:///home/void/.cache/pypoetry/artifacts/15/14/54/c10d16daae42bacb0d561fbf93d68019c90d273d773c79cdb447cb9111/doc8-0.8.1-py2.py3-none-any.whl
docutils @ file:///home/void/.cache/pypoetry/artifacts/9e/78/f1/81f20d21f3ed304c86fa5394fadbb173e75ad363029a8fefa635dadf2e/docutils-0.16-py2.py3-none-any.whl
dparse @ file:///home/void/.cache/pypoetry/artifacts/45/f0/d9/1a980d82905c06a7365c6227aac29281c69dce4021fafe2a199de092e8/dparse-0.5.1-py3-none-any.whl
entrypoints @ file:///home/void/.cache/pypoetry/artifacts/27/67/42/5ca7438658f76c8700ff6c44ea1cf9dc128cf0862adb7de53d3a35266c/entrypoints-0.3-py2.py3-none-any.whl
eradicate @ file:///home/void/.cache/pypoetry/artifacts/d7/9d/a9/4eb3af3b79f810cc0b1b6f09395d9ee84772b603a8e8978e12b12717d2/eradicate-1.0.tar.gz
filelock @ file:///home/void/.cache/pypoetry/artifacts/f4/78/c1/69555c3867649a2a5dac43f12a078830700480a49be273fb2de82be2ab/filelock-3.0.12-py3-none-any.whl
flake8 @ file:///home/void/.cache/pypoetry/artifacts/5c/5b/91/23d9fee55905e042e829a14e2fa56ffd39c81246aba659e2840bab728b/flake8-3.8.4-py2.py3-none-any.whl
flake8-bandit @ file:///home/void/.cache/pypoetry/artifacts/cc/6d/cf/94dc0d884687c0e10baebe95be53977448e1b59d7ad05e41a0f046cd7e/flake8_bandit-2.1.2.tar.gz
flake8-broken-line @ file:///home/void/.cache/pypoetry/artifacts/b6/72/5f/b138cf8858a3bb7411d5443831c6a3d9c2170f1a4fb01b07a96a33b801/flake8_broken_line-0.2.1-py3-none-any.whl
flake8-bugbear @ file:///home/void/.cache/pypoetry/artifacts/2d/c4/51/6e0f2c02d3e6a846fd30eded9b747688cecf8e55e1c9280ab30a793c04/flake8_bugbear-19.8.0-py35.py36.py37-none-any.whl
flake8-commas @ file:///home/void/.cache/pypoetry/artifacts/b7/aa/76/e620a68b0be70f4132be94bfbfdacb20b16c060174b33dc856818db92d/flake8_commas-2.0.0-py2.py3-none-any.whl
flake8-comprehensions @ file:///home/void/.cache/pypoetry/artifacts/22/08/cf/e2489bbc8810faf889c7d3b805e312583d8ad4992dc695e97dfa258126/flake8_comprehensions-3.3.0-py3-none-any.whl
flake8-debugger @ file:///home/void/.cache/pypoetry/artifacts/da/2c/e3/d62fd2fc55b1f63fccb2997d98af07223eae27b3216cdb75fa9975b398/flake8-debugger-3.2.1.tar.gz
flake8-docstrings @ file:///home/void/.cache/pypoetry/artifacts/14/46/f1/42800107fb2815121aebf831e269f0af48a45c669a24dbcec60fbbac9f/flake8_docstrings-1.5.0-py2.py3-none-any.whl
flake8-eradicate @ file:///home/void/.cache/pypoetry/artifacts/ad/cc/3b/7c679e5a37dbe9e9d3b056d2e5ee8e3dceac70460c3edcb852b0c650f4/flake8_eradicate-0.3.0-py3-none-any.whl
flake8-isort @ file:///home/void/.cache/pypoetry/artifacts/56/70/ee/b8f0228abc9e3e9ff24faa6cf960fe806dc20e1a9d327835b90545585a/flake8_isort-3.0.1-py2.py3-none-any.whl
flake8-plugin-utils @ file:///home/void/.cache/pypoetry/artifacts/99/73/fc/1fd22f303405c472d0dd047300335cdbbcc598f106b402ce1176be733b/flake8_plugin_utils-1.3.1-py3-none-any.whl
flake8-polyfill @ file:///home/void/.cache/pypoetry/artifacts/37/d4/b9/446f3fe801eea4de2fdff2cd1e0be3fa836d08c04d62174d4ec65113f3/flake8_polyfill-1.0.2-py2.py3-none-any.whl
flake8-pytest-style @ file:///home/void/.cache/pypoetry/artifacts/b9/91/aa/24d42f27861d7e5a75ff711270a98440f637f704a85bc7e67fbaa683c9/flake8_pytest_style-1.3.0-py3-none-any.whl
flake8-quotes @ file:///home/void/.cache/pypoetry/artifacts/fb/94/4e/57a6dae12a87b982e4d35a28f9336ab761e0333a4be207d2d9f3ff5c99/flake8-quotes-2.1.2.tar.gz
flake8-rst-docstrings @ file:///home/void/.cache/pypoetry/artifacts/a2/a0/d5/c25770b5624cb722839214583bf7156c6716d34aeb62ff9ee9d96ed7e6/flake8-rst-docstrings-0.0.12.tar.gz
flake8-string-format @ file:///home/void/.cache/pypoetry/artifacts/54/fe/a4/42804621e559c82bc460b782340c42d279633fb413fe8911e1c45707fc/flake8_string_format-0.2.3-py2.py3-none-any.whl
future @ file:///home/void/.cache/pypoetry/artifacts/d9/62/dc/809bb3ddfe360ddc60ebb287ad6b0eaf71aef98937f0ea0c466d44aa19/future-0.18.2.tar.gz
gitdb @ file:///home/void/.cache/pypoetry/artifacts/45/a9/94/d73ced00c6cf302a2e08bedd4f10d3424342b7a8a2fae6e4ccb7276641/gitdb-4.0.5-py3-none-any.whl
GitPython @ file:///home/void/.cache/pypoetry/artifacts/bb/7d/e3/03ce0e77da368e61f7ddc587b791b0272880265992f05053a40cb306e3/GitPython-3.1.11-py3-none-any.whl
h5py @ file:///home/void/.cache/pypoetry/artifacts/7f/72/5d/4e83293f7117dc8b4bdebb63cefc313bdc02268760f020ed7817f38500/h5py-3.1.0-cp38-cp38-manylinux1_x86_64.whl
identify @ file:///home/void/.cache/pypoetry/artifacts/c2/72/f0/e25a22eddff10e4ae2266e784139047f4109caec463c4b65abd49ee4b4/identify-1.5.9-py2.py3-none-any.whl
idna @ file:///home/void/.cache/pypoetry/artifacts/9e/f9/03/6066b92d35486e7f0d4f310126e3c60a6619726e43ef98e32e105b5c52/idna-2.10-py2.py3-none-any.whl
imagesize @ file:///home/void/.cache/pypoetry/artifacts/0b/69/4e/8e64ed37efc2f5438fce870c94736b2e1a21bc4cb0c286f936de14357b/imagesize-1.2.0-py2.py3-none-any.whl
importlib-metadata @ file:///home/void/.cache/pypoetry/artifacts/d9/e3/e4/ca2146a4dcbada8cbfc004ed50b62d7b3ba48592b3e3fb551a226072bd/importlib_metadata-2.0.0-py2.py3-none-any.whl
ipykernel @ file:///home/void/.cache/pypoetry/artifacts/b6/f1/35/0d377d3057b4a92f8c1c3080fc6e4edeae65ce62153393fe9f9fcb8c98/ipykernel-5.3.4-py3-none-any.whl
ipython @ file:///home/void/.cache/pypoetry/artifacts/86/9e/ba/5c31b7289babe78ae856682b4ff7efab7f6fcc59c8820d0c1c7fdc3495/ipython-7.19.0-py3-none-any.whl
ipython-genutils @ file:///home/void/.cache/pypoetry/artifacts/e6/8e/a3/8f37e14310c0072b3fcc4240490bcb42630aa695d069aee89953ebd9f8/ipython_genutils-0.2.0-py2.py3-none-any.whl
ipywidgets @ file:///home/void/.cache/pypoetry/artifacts/3c/b0/1a/37aa8262e80401dbdc4471dcb1950d538b572da46d9a0dfa578bcacc57/ipywidgets-7.5.1-py2.py3-none-any.whl
isort @ file:///home/void/.cache/pypoetry/artifacts/6e/4e/fa/c1a31b7a066920f2d2cebcdf14f804e3f48fc87e5d4c85ae4805b246b2/isort-4.3.21-py2.py3-none-any.whl
jedi @ file:///home/void/.cache/pypoetry/artifacts/ce/2e/ee/4ef6ff749cd3e9580ef93bd301cece06bf4d86072c8695b60e5fccf93b/jedi-0.17.2-py2.py3-none-any.whl
Jinja2 @ file:///home/void/.cache/pypoetry/artifacts/a0/8d/d0/dce9f8c04cdcf457adcd58424bdacab8a7a2c3c42854fd3c0d2135046e/Jinja2-2.11.2-py2.py3-none-any.whl
jmespath @ file:///home/void/.cache/pypoetry/artifacts/43/d5/a2/f83573231324de7f5b61f5c607fbbe82ca535359a452de4852d2e25e8d/jmespath-0.10.0-py2.py3-none-any.whl
joblib @ file:///home/void/.cache/pypoetry/artifacts/10/13/81/235e8fe20e06fb00513a93800e192a123d6460ba954647f191cd40dfe4/joblib-0.17.0-py3-none-any.whl
jsonnet @ file:///home/void/.cache/pypoetry/artifacts/97/25/a0/259a8cca23e7f52729440ecc27d09b25485d2ad214755673efa01bd6c7/jsonnet-0.16.0.tar.gz
jsonpickle @ file:///home/void/.cache/pypoetry/artifacts/f7/ca/3a/c9e8a5a4f75785143bacc85f4531e21e0ee322f147b2b665c1d7cf79d2/jsonpickle-1.4.1-py2.py3-none-any.whl
jsonschema @ file:///home/void/.cache/pypoetry/artifacts/8a/0f/f1/4a51263f4c7019004d5abd49f41d94c0eb4618233008d82a629134c337/jsonschema-3.2.0-py2.py3-none-any.whl
jupyter @ file:///home/void/.cache/pypoetry/artifacts/2e/44/a0/764f7d3907f220eb94db0e2bce1f8f3e50dcb48aca15a625dd210cb114/jupyter-1.0.0-py2.py3-none-any.whl
jupyter-client @ file:///home/void/.cache/pypoetry/artifacts/ed/8f/6b/34e54eebe94bd8de806a24eba8ffa40cce2b70ee935ffc814149087e04/jupyter_client-6.1.7-py3-none-any.whl
jupyter-console @ file:///home/void/.cache/pypoetry/artifacts/f9/ff/81/0dd86dc0829e56f6031db9604a9e65b360496a4fdfb6ccd866328c4bd8/jupyter_console-6.2.0-py3-none-any.whl
jupyter-core @ file:///home/void/.cache/pypoetry/artifacts/2d/be/09/4ec704f627ac1b4d9755240dea59f977424b48cd82994baf006f35fc9f/jupyter_core-4.6.3-py2.py3-none-any.whl
jupyterlab-pygments @ file:///home/void/.cache/pypoetry/artifacts/c8/b0/10/ad75ecf240424057a12f5b4320da2c9f380541cdf830a39e7e8437c2c0/jupyterlab_pygments-0.1.2-py2.py3-none-any.whl
m2r @ file:///home/void/.cache/pypoetry/artifacts/4f/27/1c/8c4108008bcf8c4bb68f981912836a9bdefd1e6b91408a2291566af273/m2r-0.2.1.tar.gz
Mako @ file:///home/void/.cache/pypoetry/artifacts/9b/af/a3/2e37b4b97ccbbc5fecf69d31154f2c2ee3fc4a34809cb4a1daf5ed72e1/Mako-1.1.3-py2.py3-none-any.whl
MarkupSafe @ file:///home/void/.cache/pypoetry/artifacts/11/bd/ad/5012ca1b0f41b786ac09ee7c185c0383d54f89f9d6f87e13a22b085a4f/MarkupSafe-1.1.1-cp38-cp38-manylinux1_x86_64.whl
marshmallow @ file:///home/void/.cache/pypoetry/artifacts/5b/8d/70/bc83a7f80e1c5cd994f8bdd90731d058c433cd03d2c5e0647194620bd9/marshmallow-3.9.1-py2.py3-none-any.whl
marshmallow-polyfield @ file:///home/void/.cache/pypoetry/artifacts/d1/50/95/b389132f11c645bf60b00b2a724eafd5a0191c62606e50e0c9ef69a505/marshmallow-polyfield-5.9.tar.gz
mccabe @ file:///home/void/.cache/pypoetry/artifacts/37/6e/69/4a33a4d6c80c775b1ee205face2c6e07b762c8602bb0f0d236ebe790c5/mccabe-0.6.1-py2.py3-none-any.whl
mistune @ file:///home/void/.cache/pypoetry/artifacts/d9/d8/5c/8eac14aaa95c3aa81409d56b7423ff6dd88eb398f551c1bf0b8c05b916/mistune-0.8.4-py2.py3-none-any.whl
more-itertools @ file:///home/void/.cache/pypoetry/artifacts/b7/39/2d/8628adfd013f3bf1658dafd470eef925f88b584f61666e69578a88b3b0/more_itertools-8.6.0-py3-none-any.whl
murmurhash @ file:///home/void/.cache/pypoetry/artifacts/ba/67/cb/b8b15a73b18cb43797cb5becfd0c8ba9162bed0da57b22bd32bea801c8/murmurhash-1.0.4-cp38-cp38-manylinux2014_x86_64.whl
mypy @ file:///home/void/.cache/pypoetry/artifacts/c4/0d/91/abaaf7d6878463da63ac45235c6eeaa23c95ebe7b60a2aed71224b6394/mypy-0.790-cp38-cp38-manylinux1_x86_64.whl
mypy-extensions @ file:///home/void/.cache/pypoetry/artifacts/b6/a0/b0/a5dc9acd6fd12aba308634f21bb7cf0571448f20848797d7ecb327aa12/mypy_extensions-0.4.3-py2.py3-none-any.whl
nbclient @ file:///home/void/.cache/pypoetry/artifacts/ca/75/28/4f846efe867484804f4e1e3ed8735ab8c75a0a186cf3742fc5381a08fc/nbclient-0.5.1-py3-none-any.whl
nbconvert @ file:///home/void/.cache/pypoetry/artifacts/6d/04/d2/6f698739d85cec6503abcfed57a421b113f6f66af399a25bf9994a1a87/nbconvert-6.0.7-py3-none-any.whl
nbformat @ file:///home/void/.cache/pypoetry/artifacts/08/a0/7e/bf15ec9700d71d6abb3cf0279bb861c9e9fd74edc3e7d3ec9a18605ee5/nbformat-5.0.8-py3-none-any.whl
nest-asyncio @ file:///home/void/.cache/pypoetry/artifacts/ca/11/7c/18e3746fa2c8f3359f9d84a671e4ee45f673b59a0a0c81ba68a5345ca9/nest_asyncio-1.4.2-py3-none-any.whl
nitpick @ file:///home/void/.cache/pypoetry/artifacts/28/98/16/5682d5116b7b7060227becef96a14e31c189a936800abb96b0c0dfc7b9/nitpick-0.23.1-py3-none-any.whl
nltk @ file:///home/void/.cache/pypoetry/artifacts/4e/a8/c9/3b9dad78f26601cae847a376b6c3342fc0f0e5d6bf78e56a12ac16dfbd/nltk-3.5.zip
notebook @ file:///home/void/.cache/pypoetry/artifacts/b9/b4/5b/c03c39ceee9407c9f0623ff14549ca199c7bb86df87d5a029e652ba8ea/notebook-6.1.5-py3-none-any.whl
numpy @ file:///home/void/.cache/pypoetry/artifacts/34/b2/b2/d3c8437d5f488bbd58ff83c4a586ff06cd34fe60aad95d0d662034be5b/numpy-1.19.4-cp38-cp38-manylinux2010_x86_64.whl
optuna @ file:///home/void/.cache/pypoetry/artifacts/b4/27/fc/f57667b8bf2a132732ddebf7bcf93e3fe3939e462072fdcf64d5d8e2d2/optuna-2.3.0.tar.gz
overrides @ file:///home/void/.cache/pypoetry/artifacts/2e/a1/58/bef997b290151ed8dc40c8873f5a581732643e73c41da963ab65b75838/overrides-3.1.0.tar.gz
packaging @ file:///home/void/.cache/pypoetry/artifacts/09/cd/29/a435224f3203dfba4af491065632910aadb6f3ddd87ce3c6590ac29e7a/packaging-20.4-py2.py3-none-any.whl
pandocfilters @ file:///home/void/.cache/pypoetry/artifacts/a0/de/ee/57ddb36e87aac56bbe9fe7c7bee8049805d79bcc280239a9fc1e913a69/pandocfilters-1.4.3.tar.gz
parso @ file:///home/void/.cache/pypoetry/artifacts/68/b7/ab/104272f01420d39035467c3910fd1e927d05b020948799cbfebd116405/parso-0.7.1-py2.py3-none-any.whl
pbr @ file:///home/void/.cache/pypoetry/artifacts/85/81/cf/9255f6df466921f8291c85ab33df01caeda1916c2745a5071ce06a963f/pbr-5.5.1-py2.py3-none-any.whl
pep8-naming @ file:///home/void/.cache/pypoetry/artifacts/ce/6c/45/d883218e7ee597f1796a1593478f89443587aea185b8a63a863060d473/pep8_naming-0.9.1-py2.py3-none-any.whl
pexpect @ file:///home/void/.cache/pypoetry/artifacts/c0/05/08/f23ddb8e3d5b19e7cf01eb434220310be2aaf69226bdec78bc53589024/pexpect-4.8.0-py2.py3-none-any.whl
pickleshare @ file:///home/void/.cache/pypoetry/artifacts/27/b2/0a/93a92c700a1993b2923519262ddf76a629bd459a0597c0ae28bf80c7a6/pickleshare-0.7.5-py2.py3-none-any.whl
plac @ file:///home/void/.cache/pypoetry/artifacts/80/ac/29/737762264fecacc0a2e9b9e3b000ce340249e75dd163f5eeb09521a1b4/plac-1.1.3-py2.py3-none-any.whl
pluggy @ file:///home/void/.cache/pypoetry/artifacts/9c/e5/0b/2d64d03361a081edeb5d2ec5f286ccf9719587781fbf6822e1b6384c27/pluggy-0.13.1-py2.py3-none-any.whl
preshed @ file:///home/void/.cache/pypoetry/artifacts/86/8a/ba/30556be82374ba7060bcaa318f3ca78781c79f55ff1d7641ace59490a2/preshed-3.0.4-cp38-cp38-manylinux2014_x86_64.whl
prettytable @ file:///home/void/.cache/pypoetry/artifacts/74/22/23/b5629ff30d2c0b82c55f90d3dfbb6c2d40ec8f6b7d63b99677b8bfc43f/prettytable-0.7.2.tar.bz2
prometheus-client @ file:///home/void/.cache/pypoetry/artifacts/d0/c3/47/75f3e2e1a613c920838a5c3f03bb72429c418b191fcd0f5f030f913e5d/prometheus_client-0.8.0-py2.py3-none-any.whl
prompt-toolkit @ file:///home/void/.cache/pypoetry/artifacts/b1/31/5d/6662f0325b5535bca04f9072b21522c4b3b6f2f14a8be144a8e7d51830/prompt_toolkit-3.0.8-py3-none-any.whl
protobuf @ file:///home/void/.cache/pypoetry/artifacts/f4/03/e2/297d499fdbac329cb0b33be3098be366a799735835fd81b8482aa2bb12/protobuf-3.13.0-cp38-cp38-manylinux1_x86_64.whl
ptyprocess @ file:///home/void/.cache/pypoetry/artifacts/2c/6a/98/a555fa30b04faf75866656b49dfd32457704fbd3811c6ae29eecfc2715/ptyprocess-0.6.0-py2.py3-none-any.whl
py @ file:///home/void/.cache/pypoetry/artifacts/f5/51/7d/d8aec03f59299351465053794c7b1f0e0e7a918e4a67911664f83929af/py-1.9.0-py2.py3-none-any.whl
pycodestyle @ file:///home/void/.cache/pypoetry/artifacts/01/f4/cf/c7e34cb76e03e95d9eff28af16fe09ee8edd01cc985fc2b88453b6d311/pycodestyle-2.6.0-py2.py3-none-any.whl
pycparser @ file:///home/void/.cache/pypoetry/artifacts/f1/03/25/40eb46f7bede64f78ba073e2141b8216e611cbcde72e3117c326560101/pycparser-2.20-py2.py3-none-any.whl
pydocstyle @ file:///home/void/.cache/pypoetry/artifacts/a4/ef/58/498033174cb8c68875036ec5d8a3d9d2e169c51bec9d35866bd62ff5ac/pydocstyle-5.1.1-py3-none-any.whl
pyflakes @ file:///home/void/.cache/pypoetry/artifacts/da/83/11/1e9a80c39638c6967e9b1117b17d8ec5f723ddd0a88251cc08dc0807b0/pyflakes-2.2.0-py2.py3-none-any.whl
Pygments @ file:///home/void/.cache/pypoetry/artifacts/d0/37/a5/bdd862c4f6538fafaf79d37ec67fd2337ac277eef4817a8ecd525570c9/Pygments-2.7.2-py3-none-any.whl
pyparsing @ file:///home/void/.cache/pypoetry/artifacts/da/e7/3d/1780282f558e5fd157bf708b28b8ba0d08323ef6bc5b6396139ce38a0b/pyparsing-2.4.7-py2.py3-none-any.whl
pyperclip @ file:///home/void/.cache/pypoetry/artifacts/3b/76/d9/aca188073af784ee724f422bdad1dee18c9438ca556e10b955ad3498ee/pyperclip-1.8.1.tar.gz
pyrsistent @ file:///home/void/.cache/pypoetry/artifacts/d8/37/43/5ceed6677fc301784b0e62604a431e293d12c402f4ca588304e916a04d/pyrsistent-0.17.3.tar.gz
pytest @ file:///home/void/.cache/pypoetry/artifacts/9d/40/6b/50d2cb06df545acea43c65379c5456f4fbc703115a703bc7cd433ddf70/pytest-5.4.3-py3-none-any.whl
pytest-cov @ file:///home/void/.cache/pypoetry/artifacts/b9/58/55/db0439b8e3e9c6ad7790a801ddb71803fd3791b5d6fd7f65efe27016f5/pytest_cov-2.10.1-py2.py3-none-any.whl
pytest-randomly @ file:///home/void/.cache/pypoetry/artifacts/10/85/3e/d5c0ccbc022ddb857a1401198a620cb6ce5e06ca6a8a8efb75953cd558/pytest_randomly-3.4.1-py3-none-any.whl
python-dateutil @ file:///home/void/.cache/pypoetry/artifacts/1e/2c/dc/0e811c2299b40168ee1da03bc13c11762ce9fa96eb867ad22280db11fc/python_dateutil-2.8.1-py2.py3-none-any.whl
python-editor @ file:///home/void/.cache/pypoetry/artifacts/88/e4/9a/6a3b58d3811aabb356fe1af49b223e67e18505daf666e0dca62c12f260/python_editor-1.0.4-py3-none-any.whl
python-slugify @ file:///home/void/.cache/pypoetry/artifacts/fb/48/0c/b3d105b241e71968321b5a90e86893953d66bded05418da96166cd7d7f/python-slugify-4.0.1.tar.gz
pytz @ file:///home/void/.cache/pypoetry/artifacts/7a/8e/a2/e796ae4d320aded38d3d61817b158184888dcd18c6a4f6d6ab011a6cda/pytz-2020.4-py2.py3-none-any.whl
PyYAML @ file:///home/void/.cache/pypoetry/artifacts/28/fe/c8/ee41918e776a0a8fea86e3b4d45d54620381726103e666941e1218c099/PyYAML-5.3.1.tar.gz
pyzmq @ file:///home/void/.cache/pypoetry/artifacts/37/29/30/1d0ad12da5a691de9d7c68bd116cc0a81bdb8c3fd4ddd8abe767606373/pyzmq-19.0.2-cp38-cp38-manylinux1_x86_64.whl
qtconsole @ file:///home/void/.cache/pypoetry/artifacts/a4/da/87/61dddc98b433ed2b87477ca19c06d3c03d7b1f8f31111a2fb042bf6ff6/qtconsole-4.7.7-py2.py3-none-any.whl
QtPy @ file:///home/void/.cache/pypoetry/artifacts/68/e6/b3/652e75104edbe2a4b47170036550f3c8df1bf6f4f9ae6be442ef16c336/QtPy-1.9.0-py2.py3-none-any.whl
regex @ file:///home/void/.cache/pypoetry/artifacts/7b/ae/3c/12683960145c5f53e6dd03567a3ee58d3ec0e1d3d9b31430ad96ec85ff/regex-2020.10.28-cp38-cp38-manylinux2014_x86_64.whl
requests @ file:///home/void/.cache/pypoetry/artifacts/1e/9a/75/03520154e60eb952530469162a6d43cd95ece92de272e2c3392058401c/requests-2.24.0-py2.py3-none-any.whl
restructuredtext-lint @ file:///home/void/.cache/pypoetry/artifacts/b7/45/71/382cdebdbfe4603f3ff0494bfd4460f84940c634dd95f1e1ce1a023a82/restructuredtext_lint-1.3.1.tar.gz
ruamel.yaml @ file:///home/void/.cache/pypoetry/artifacts/fa/10/2b/409b73cb7fd78317ea1094d48cb62274d1ceb83475047162e073699ec5/ruamel.yaml-0.16.12-py2.py3-none-any.whl
ruamel.yaml.clib @ file:///home/void/.cache/pypoetry/artifacts/97/f1/f1/1e2842d208a1b2fb98118062b928f0534297168decb2e8006fb82d3d20/ruamel.yaml.clib-0.2.2-cp38-cp38-manylinux1_x86_64.whl
s3transfer @ file:///home/void/.cache/pypoetry/artifacts/6b/c7/58/1aed9dbe74f228d78b9584e09cfb29b03cb2428d9c7a0c2e4d204b9faf/s3transfer-0.3.3-py2.py3-none-any.whl
sacremoses @ file:///home/void/.cache/pypoetry/artifacts/94/85/15/980a84215423e23c131132e651f13e7cfbda060563ddf4699c72417524/sacremoses-0.0.43.tar.gz
safety @ file:///home/void/.cache/pypoetry/artifacts/d5/1e/9c/fcd40e725914ec495de4d13790d3dbdeccdbdf1761cf5c42943c4ee4f8/safety-1.9.0-py2.py3-none-any.whl
scikit-learn @ file:///home/void/.cache/pypoetry/artifacts/f1/b0/0f/fc8f3775e8a01ee194030bf0e6600c96fd091442f1c9b978fac7f647ec/scikit_learn-0.23.2-cp38-cp38-manylinux1_x86_64.whl
scipy @ file:///home/void/.cache/pypoetry/artifacts/9a/85/e7/b422d8294ea40767b1b0a79a28397709cf7def94b3fa0f122656a096da/scipy-1.5.4-cp38-cp38-manylinux1_x86_64.whl
Send2Trash @ file:///home/void/.cache/pypoetry/artifacts/40/97/0a/f421bca5e8da2c4a13d0c5abe9f2309550d5ebc2067b67c3929997663c/Send2Trash-1.5.0-py3-none-any.whl
sentencepiece @ file:///home/void/.cache/pypoetry/artifacts/31/43/b7/1e712bf610a890a65f96e39eee41e72ac9341d7292deb8c9e976c234b0/sentencepiece-0.1.94-cp38-cp38-manylinux2014_x86_64.whl
six @ file:///home/void/.cache/pypoetry/artifacts/be/98/c7/69fe6fea7a59659af1c6260899226129565330b1e07c9c5b3769be76bf/six-1.15.0-py2.py3-none-any.whl
smmap @ file:///home/void/.cache/pypoetry/artifacts/39/8f/16/e7986b1d62635c17d6635e446732dd98686c7b0f663445a0cd6e59dcdf/smmap-3.0.4-py2.py3-none-any.whl
snowballstemmer @ file:///home/void/.cache/pypoetry/artifacts/00/58/78/ad3aa1f5e8e5da623c9a205c7cdb41811fb480646c3e79278fc2aec1ad/snowballstemmer-2.0.0-py2.py3-none-any.whl
sortedcontainers @ file:///home/void/.cache/pypoetry/artifacts/b3/bf/a2/83677c4175a4561da36b5ec625e33e1cdd6d78137304a914eb5d6fdcdd/sortedcontainers-2.3.0-py2.py3-none-any.whl
spacy @ file:///home/void/.cache/pypoetry/artifacts/37/86/ad/fb5633e5431a9469b9dfa81e4a465ee37c67c2eda1d5e1f7138b6825f7/spacy-2.3.2-cp38-cp38-manylinux1_x86_64.whl
Sphinx @ file:///home/void/.cache/pypoetry/artifacts/1d/ed/5b/1be39c6e21184601c628545a74a3116019d3382e5a453a6c6bfd52449b/Sphinx-2.4.4-py3-none-any.whl
sphinx-autodoc-typehints @ file:///home/void/.cache/pypoetry/artifacts/e7/ce/18/148b1186b401fd894226b0f906b3ed753597fdfc66383cd617f7540fce/sphinx_autodoc_typehints-1.10.3-py3-none-any.whl
sphinxcontrib-applehelp @ file:///home/void/.cache/pypoetry/artifacts/06/55/7c/cf28d2c944f7fc7cba94678d0ca98b77947cae69b6c801ffd04601cc8c/sphinxcontrib_applehelp-1.0.2-py2.py3-none-any.whl
sphinxcontrib-devhelp @ file:///home/void/.cache/pypoetry/artifacts/95/e9/af/55ffd1a6f2b03f2bc460172ec6a9ee4a9353404fc6b9026b0fd4776f84/sphinxcontrib_devhelp-1.0.2-py2.py3-none-any.whl
sphinxcontrib-htmlhelp @ file:///home/void/.cache/pypoetry/artifacts/a0/ad/8e/a970be3040e06e0264ff5263c1c64053370852e5711ebce0169f50d4c0/sphinxcontrib_htmlhelp-1.0.3-py2.py3-none-any.whl
sphinxcontrib-jsmath @ file:///home/void/.cache/pypoetry/artifacts/5f/c9/8c/2bf04b76e3b07f85857acb15a02dec77db17eb7069ef7e3e8200580fa0/sphinxcontrib_jsmath-1.0.1-py2.py3-none-any.whl
sphinxcontrib-qthelp @ file:///home/void/.cache/pypoetry/artifacts/bd/a5/cb/8f6c168f27ca463b2c09d5dfbaabea32b6bb9ebff80556a11bc2b1152f/sphinxcontrib_qthelp-1.0.3-py2.py3-none-any.whl
sphinxcontrib-serializinghtml @ file:///home/void/.cache/pypoetry/artifacts/83/d2/78/3f17c9e1fa5ed17cb815a8d897bf2003c1197b16a36d4e9c6ffa0e8592/sphinxcontrib_serializinghtml-1.1.4-py2.py3-none-any.whl
SQLAlchemy @ file:///home/void/.cache/pypoetry/artifacts/05/26/db/d7d70d2f2a385bdac6d40e4da10a09ae7196ea5c849f56adf88ac4f3b3/SQLAlchemy-1.3.20-cp38-cp38-manylinux2010_x86_64.whl
srsly @ file:///home/void/.cache/pypoetry/artifacts/ed/9f/73/6d1c2c47ab56d3049b1f004778a8351e4694403c1e6e620206c4b47e2c/srsly-1.0.4-cp38-cp38-manylinux2014_x86_64.whl
stevedore @ file:///home/void/.cache/pypoetry/artifacts/82/a9/1a/89ccf2529a0533a62894da67e9660c47190abdfacf1f9d96eb7a17df85/stevedore-3.2.2-py3-none-any.whl
tensorboardX @ file:///home/void/.cache/pypoetry/artifacts/5c/f4/0c/18de8e039c6894db1eff82340d262b49639d8e0b820d4ad2b193085f7c/tensorboardX-2.1-py2.py3-none-any.whl
terminado @ file:///home/void/.cache/pypoetry/artifacts/16/26/98/8a096ebe53cf81cf3b1d1c57cd613f3c8195d48c42d45aa07df7a3bdb5/terminado-0.9.1-py3-none-any.whl
testfixtures @ file:///home/void/.cache/pypoetry/artifacts/a7/32/a6/0fc95c70fae6ebc94fe74576a34cb054ee50832a4cfd380ca3754c2bc6/testfixtures-6.15.0-py2.py3-none-any.whl
testpath @ file:///home/void/.cache/pypoetry/artifacts/71/31/06/e1366905608d747ada47997b3406776c1f88e2628e47674e40b9ae2b0b/testpath-0.4.4-py2.py3-none-any.whl
text-unidecode @ file:///home/void/.cache/pypoetry/artifacts/9b/cc/f2/c615087594418f3b86c03fb83c56a1d3b673e89924d4bd0cece68a7615/text_unidecode-1.3-py2.py3-none-any.whl
thinc @ file:///home/void/.cache/pypoetry/artifacts/3a/51/eb/46e64cb71bab30ab2fdca32ebc4aa86d43df9f622a1373ad7aa36a9287/thinc-7.4.1-cp38-cp38-manylinux1_x86_64.whl
threadpoolctl @ file:///home/void/.cache/pypoetry/artifacts/51/cf/f3/45cf01a8bc970a364ec52ad5b3efb73b5796bed51e1aef77f8f1127009/threadpoolctl-2.1.0-py3-none-any.whl
tokenizers @ file:///home/void/.cache/pypoetry/artifacts/53/0b/88/4ea2dfa30a87710972809e690deb5e137107c3f73927cdc38ae0d4eb92/tokenizers-0.9.2-cp38-cp38-manylinux1_x86_64.whl
toml @ file:///home/void/.cache/pypoetry/artifacts/fb/01/94/0219377a74b149d8ffe3b6f96c113b460850ec2846a86a302d6156dfef/toml-0.10.0-py2.py3-none-any.whl
tomlkit @ file:///home/void/.cache/pypoetry/artifacts/db/c3/df/baf014ce3b04caffe7ac34bde699f5be82c4acbaf43f49db1ce681a500/tomlkit-0.7.0-py2.py3-none-any.whl
torch @ file:///home/void/.cache/pypoetry/artifacts/8f/0b/9a/52152cc1a51f13d2081ec3c41b5b16c0b37a819ea651c6130c24d7f3f0/torch-1.7.0-cp38-cp38-manylinux1_x86_64.whl
tornado @ file:///home/void/.cache/pypoetry/artifacts/ec/fb/c8/e022dee175b03afe90ae806e12ec894741303dfc5a6debe95d80154754/tornado-6.1-cp38-cp38-manylinux2010_x86_64.whl
tqdm @ file:///home/void/.cache/pypoetry/artifacts/ee/76/9f/005e71b2c85a47268f2e08a034446e11a8237cdb7f058f365b9e79803c/tqdm-4.51.0-py2.py3-none-any.whl
traitlets @ file:///home/void/.cache/pypoetry/artifacts/8a/f4/fd/48c1725dcdd56393737bb0696379f91042dae8fbe51d06801caadfb12b/traitlets-5.0.5-py3-none-any.whl
transform==0.1.0
transformers @ file:///home/void/.cache/pypoetry/artifacts/1f/3d/6b/7de60a0442e2d3a267065391505319b367922bbe6a5271fc8ff7155706/transformers-3.4.0-py3-none-any.whl
typed-ast @ file:///home/void/.cache/pypoetry/artifacts/18/1f/94/6f7cab4b91b697a39bde0b9dad925b0717b2f4b410a070d2cae0e44f7b/typed_ast-1.4.1-cp38-cp38-manylinux1_x86_64.whl
typing-extensions @ file:///home/void/.cache/pypoetry/artifacts/ac/8f/3a/97dfae6ca13a6e156f19a5e8aa95fc250129d7e5e6cd0f7c76a1d45b4f/typing_extensions-3.7.4.3-py3-none-any.whl
urllib3 @ file:///home/void/.cache/pypoetry/artifacts/b0/87/9a/1a8e2a4a36c962a03a9c1a35c9c0634febb4353159f230d7e9a76957a7/urllib3-1.25.11-py2.py3-none-any.whl
wasabi @ file:///home/void/.cache/pypoetry/artifacts/47/69/94/73ff8ee90be80c4184a0cedff1c90b8c08e298e4296fc7eba7345ff79f/wasabi-0.8.0-py3-none-any.whl
wcwidth @ file:///home/void/.cache/pypoetry/artifacts/36/68/e2/7232f431072d5e8aeec124120b9a1d095d45da10311d271fac10982473/wcwidth-0.2.5-py2.py3-none-any.whl
webencodings @ file:///home/void/.cache/pypoetry/artifacts/60/1e/b4/eff9915b6506bb01a5ad61dfae3fa4f0302be9e2ad45eaccc833925b95/webencodings-0.5.1-py2.py3-none-any.whl
wemake-python-styleguide @ file:///home/void/.cache/pypoetry/artifacts/c6/77/cd/c271dd6015ac40fc5bd5444626301783611963034f5c3a0c2a621106ea/wemake_python_styleguide-0.14.1-py3-none-any.whl
widgetsnbextension @ file:///home/void/.cache/pypoetry/artifacts/4f/c4/8c/95c9c932a9649e98240304b336a4c725419ee2fd517897c94b817722d6/widgetsnbextension-3.5.1-py2.py3-none-any.whl
zipp @ file:///home/void/.cache/pypoetry/artifacts/6d/a4/76/c77b47779fc6e06dbaaa25fa3e031007bf3e05bb7ba887d03a5900a89a/zipp-3.4.0-py3-none-any.whl



&lt;denchmark-h:h2&gt;Steps to reproduce&lt;/denchmark-h&gt;


Example source:

local model_name = "models/distilroberta-base-msmarco-v1/0_Transformer";
local num_gpus = 8;
local data_base_url = "data/mydata/processed/";
local model = "my_model";
local dataset_reader = "my_reader";

{
  "train_data_path": data_base_url + "train.tsv.part*",
  "validation_data_path": data_base_url + "valid.tsv.part*",
  "dataset_reader": {
    "type": "sharded",
    "base_reader": {
      "type": dataset_reader,
      "query_tokenizer": {
        "type": "pretrained_transformer",
        "model_name": model_name,
        "max_length": 500,
      },
      "query_token_indexers": {
        "tokens": {
          "type": "pretrained_transformer",
          "model_name": model_name,
          "namespace": "tokens"
        }
      },
    }
  },
  'model': {
    'type': model,
    'transformer_model': model_name,
  },
  "data_loader": {
    "batch_size": 28,
    "shuffle": true
  },
  "distributed": {
    "cuda_devices": if num_gpus &gt; 1 then std.range(0, num_gpus - 1) else 0,
  },
  "trainer": {
    "num_epochs": 10,
    "optimizer": {
      "type": "huggingface_adamw",
      "lr": 3e-5,
      "betas": [0.9, 0.999],
      "eps": 1e-8,
      "correct_bias": true
    },
    "learning_rate_scheduler": {
      "type": "polynomial_decay",
    },
    "use_amp": true,
    "grad_norm": 1.0,
    "validation_metric": "+rec5",
    "patience": 3,
  }
}



	</description>
	<comments>
		<comment id='1' author='vikigenius' date='2020-11-14T19:01:22Z'>
		Hi &lt;denchmark-link:https://github.com/vikigenius&gt;@vikigenius&lt;/denchmark-link&gt;
, thanks for bringing this up. Would be able to include the logs from  and the main process as well to help me debug?
		</comment>
		<comment id='2' author='vikigenius' date='2020-11-14T22:18:51Z'>
		&lt;denchmark-link:https://github.com/epwalsh&gt;@epwalsh&lt;/denchmark-link&gt;
 PFA the logs from worker 0 and worker 5. Goto EOF for both you can see almost at the exact same time worker 0 says best validation performance and worker 5 says ran out of patience.
&lt;denchmark-link:https://github.com/allenai/allennlp/files/5541521/out_worker0.log&gt;out_worker0.log&lt;/denchmark-link&gt;

&lt;denchmark-link:https://github.com/allenai/allennlp/files/5541522/out_worker5.log&gt;out_worker5.log&lt;/denchmark-link&gt;

		</comment>
		<comment id='3' author='vikigenius' date='2020-11-16T16:38:07Z'>
		&lt;denchmark-link:https://github.com/epwalsh&gt;@epwalsh&lt;/denchmark-link&gt;
 , were you able to reproduce this? This might be tough to reproduce across datasets and metrics because it might not always happen that one worker runs out of patience while the other thinks it's the best one yet. But for my dataset, I have managed to reliably reproduce this.
Also, I am not too familiar with the metric tracking mechanism, but why are multiple workers tracking patience? Shouldn't it only be worker 0's responsibility ?
		</comment>
		<comment id='4' author='vikigenius' date='2020-11-16T23:54:21Z'>
		&lt;denchmark-link:https://github.com/vikigenius&gt;@vikigenius&lt;/denchmark-link&gt;
 what metric are you using? Is that one you've implemented yourself?
		</comment>
		<comment id='5' author='vikigenius' date='2020-11-17T01:07:10Z'>
		&lt;denchmark-link:https://github.com/epwalsh&gt;@epwalsh&lt;/denchmark-link&gt;

Hmm, I am using a custom metric, could that be the issue. It's pretty simple. I am computing pairwise similarities and then getting the top 1 closest for each row and see if that matches the gold.
&lt;denchmark-code&gt;# -*- coding: utf-8 -*-
from typing import Dict, List

import numpy as np
import torch
from allennlp.training.metrics import Metric
from overrides import overrides
from sklearn.metrics.pairwise import cosine_similarity


@Metric.register('retrieval')
class Retrieval(Metric):
    """Metrics for retrieval."""

    def __init__(self) -&gt; None:
        """Initialize the metrics and arrays."""
        super().__init__()
        self.q_embs: List[np.ndarray] = []
        self.d_embs: List[np.ndarray] = []

    def __call__(self, t1: torch.Tensor, t2: torch.Tensor) -&gt; None:  # type: ignore
        """The metric call."""
        self.q_embs.append(t1.cpu().numpy())
        self.d_embs.append(t2.cpu().numpy())

    @overrides
    def reset(self):
        """Reset the metric."""
        self.q_embs = []
        self.d_embs = []

    @overrides
    def get_metric(self, reset: bool = False) -&gt; Dict[str, float]:
        """Retrieve the metric."""
        if not self.q_embs:
            return {
                'rec1': 0.0,
                'rec5': 0.0,
            }

        csarray = cosine_similarity(
            np.concatenate(self.q_embs, axis=0),
            np.concatenate(self.d_embs, axis=0),
        )
        gold = np.arange(csarray.shape[0])[:, None]
        csarraypred = np.nonzero(
            np.argsort(-csarray, axis=1) == gold,
        )[1]

        if reset:
            self.reset()

        return {
            'rec1': (csarraypred &lt; 1).mean(),
            'rec5': (csarraypred &lt; 5).mean(),
        }
&lt;/denchmark-code&gt;

		</comment>
		<comment id='6' author='vikigenius' date='2020-11-17T01:10:50Z'>
		Ah, yes. The issue is that each worker computes the value of your metric independently.
So, to fix this, you need to have distributed communication within the metric. For example, see 


allennlp/allennlp/training/metrics/average.py


         Line 33
      in
      3cad5b4






 if is_distributed(): 





That said, I think we should do a much better job of detecting these kinds of errors. If you have any ideas on how to catch things like this, we'd love a contribution.
		</comment>
		<comment id='7' author='vikigenius' date='2020-11-17T01:27:03Z'>
		Ok, maybe I am missing the logic but does that mean all workers are supposed to report the same value for the metrics ? Does that mean the user is responsible for synchronizing the final metric value across all workers by doing something like the averaging you linked ?
How is that handled for loss computation for eg: ? Potentially each worker would also have a different loss value right ? Does allennlp do the averaging like you described ?
		</comment>
		<comment id='8' author='vikigenius' date='2020-11-17T16:04:32Z'>
		
Does that mean the user is responsible for synchronizing the final metric value across all workers by doing something like the averaging you linked ?

Yes

How is that handled for loss computation for eg: ?

Synchronizing the loss in handled automatically, because we just have to average it across workers. We can't do that for arbitrary metrics though because different metrics require different ways of aggregating / reducing the metric value across workers.
For example, with F1 score, you can't just take the average F1 across workers. That would not give you the correct value. Instead you have to sum up true/false positive/negatives across the workers before calculating F1.
		</comment>
		<comment id='9' author='vikigenius' date='2020-11-17T16:05:08Z'>
		We should definitely have better documentation around this.
		</comment>
		<comment id='10' author='vikigenius' date='2020-12-01T16:48:42Z'>
		&lt;denchmark-link:https://github.com/epwalsh&gt;@epwalsh&lt;/denchmark-link&gt;
 this is just a friendly ping to make sure you haven't forgotten about this issue 
		</comment>
		<comment id='11' author='vikigenius' date='2020-12-15T16:50:48Z'>
		&lt;denchmark-link:https://github.com/epwalsh&gt;@epwalsh&lt;/denchmark-link&gt;
 this is just a friendly ping to make sure you haven't forgotten about this issue 
		</comment>
		<comment id='12' author='vikigenius' date='2020-12-21T17:22:09Z'>
		I'm going to close this since we have &lt;denchmark-link:https://github.com/allenai/allennlp/issues/4806&gt;#4806&lt;/denchmark-link&gt;
, which, when implemented, should prevent users from accidentally using a non-distributed metric in the distributing setting.
		</comment>
	</comments>
</bug>