<bug id='103' author='CarloLucibello' open_date='2018-12-10T13:29:43Z' closed_time='2019-01-05T02:17:41Z'>
	<summary>bug in gradient with broadcast</summary>
	<description>
I was trying to port some of my knet code to julia 1.0, and incurred in the following very serious bug/
Here is a MWE:
julia&gt; grad(x -&gt; sum(exp.(x)))(1.)
2.718281828459045

julia&gt; grad(x -&gt; sum(exp.(x)))([1.])
1-element Array{Float64,1}:
 2.718281828459045

# Everything fine till now.
# The problem is with user defined functions

julia&gt; f(x)=exp(x)
f (generic function with 1 method)

# this is fine
julia&gt; grad(x -&gt; f(x))(1.)
2.718281828459045

# THIS RETURNS NOTHING!!!
julia&gt; grad(x -&gt; sum(f.(x)))([1.])
	</description>
	<comments>
		<comment id='1' author='CarloLucibello' date='2018-12-12T06:53:01Z'>
		I see this issue has also been reported in &lt;denchmark-link:https://github.com/denizyuret/AutoGrad.jl/issues/101&gt;#101&lt;/denchmark-link&gt;
. This is big impairment for me, because I use a lot of complicated custom operators in my research code. &lt;denchmark-link:https://github.com/denizyuret&gt;@denizyuret&lt;/denchmark-link&gt;
 do you have a solution for this or any hint on the problem (what's wrong in the broadcasting pipeline)?
		</comment>
		<comment id='2' author='CarloLucibello' date='2018-12-12T19:14:58Z'>
		The problem is I haven't figured out how to define gradients for arbitrary broadcast operations for AutoGrad or Knet. For primitives (e.g. sin/cos), I define both the scalar and broadcasted gradients with the &lt;denchmark-link:https://github.com/primitive&gt;@primitive&lt;/denchmark-link&gt;
 macro in AutoGrad and call specific kernels for KnetArray.  &lt;denchmark-link:https://github.com/ekinakyurek&gt;@ekinakyurek&lt;/denchmark-link&gt;
 thinks this used to work in Julia 0.6 but we need to figure out how to make it work in Julia 1.0.
		</comment>
		<comment id='3' author='CarloLucibello' date='2019-01-05T02:17:41Z'>
		Solved in latest master, submitted in v1.1.2.
		</comment>
	</comments>
</bug>