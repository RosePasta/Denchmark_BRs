<bug id='8' author='wentaozhu' open_date='2019-12-11T21:05:13Z' closed_time='2019-12-13T09:25:25Z'>
	<summary>KeyError in Stash</summary>
	<description>
Thank you so much for the awesome repository!
I use stash and find there is an error in PoPCat().isolate(ns)
I have checked the stash is fine and have run successfully.
Thanks again for your help!
&lt;denchmark-code&gt;Traceback (most recent call last):
  File "/opt/conda/lib/python3.6/site-packages/torchgpipe/skip/skippable.py", line 173, in forward
    poppable_tensors[name] = skip_tracker.load(batch, ns, name)
  File "/opt/conda/lib/python3.6/site-packages/torchgpipe/skip/tracker.py", line 38, in load
    return self.tensors.pop((ns, name))
KeyError: (&lt;Namespace 'bfb2fb79-66d2-4437-abf9-ef62cfb17836'&gt;, 'k')
&lt;/denchmark-code&gt;

&lt;denchmark-code&gt;  File "/opt/conda/lib/python3.6/site-packages/torch/nn/modules/module.py", line 541, in __call__
    result = self.forward(*input, **kwargs)
  File "/opt/conda/lib/python3.6/site-packages/torch/nn/modules/container.py", line 92, in forward
    input = module(input)
  File "/opt/conda/lib/python3.6/site-packages/torch/nn/modules/module.py", line 541, in __call__
    result = self.forward(*input, **kwargs)
  File "/opt/conda/lib/python3.6/site-packages/torchgpipe/skip/skippable.py", line 175, in forward
    raise RuntimeError(f"'{name}' has not been stashed")
RuntimeError: 'k' has not been stashed
&lt;/denchmark-code&gt;

	</description>
	<comments>
		<comment id='1' author='wentaozhu' date='2019-12-11T21:25:38Z'>
		I find the name of (RuntimeError(f"'{name}' has not been stashed")) is changed randomly with 's', 'k', 'i', 'p'.
		</comment>
		<comment id='2' author='wentaozhu' date='2019-12-11T21:37:54Z'>
		Hi &lt;denchmark-link:https://github.com/wentaozhu&gt;@wentaozhu&lt;/denchmark-link&gt;
, thanks for reporting a potential bug. As your second comment, I guess you specified a string at  or  like . Both options take multiple skip names rather than a single skip name. If my guess is correct, try  instead.
		</comment>
		<comment id='3' author='wentaozhu' date='2019-12-11T21:40:09Z'>
		Yes. I forgot the []. Thank you so much!
		</comment>
		<comment id='4' author='wentaozhu' date='2019-12-12T06:12:01Z'>
		Actually, it would be better if an exception occurs at stash, not pop. I reopen this issue to make a better experience.
		</comment>
		<comment id='5' author='wentaozhu' date='2019-12-12T15:06:16Z'>
		Thank you so much!
		</comment>
		<comment id='6' author='wentaozhu' date='2019-12-13T00:37:12Z'>
		&lt;denchmark-link:https://github.com/wentaozhu&gt;@wentaozhu&lt;/denchmark-link&gt;
 I could not reproduce your exception message. Here's my testing module:
@skippable(stash='skip')                  
class Layer1(Layer):                      
    def forward(self, input):             
        yield stash('skip', input)        
        return input
                                          
@skippable(pop='skip')                    
class Layer2(Layer):                      
    def forward(self, input):             
        skip = yield pop('skip')          
        return input + skip
Here is the exception message and it is what I expected:
&lt;denchmark-code&gt;RuntimeError: 'skip' has not been declared as stashable
&lt;/denchmark-code&gt;

How did your module look like?
		</comment>
		<comment id='7' author='wentaozhu' date='2019-12-13T01:46:16Z'>
		If you use
skippable(stash=［'skip'］)
and
skippable(pop='skip'),
You can reproduce the error. Thank you so much!
		</comment>
		<comment id='8' author='wentaozhu' date='2019-12-13T09:25:25Z'>
		&lt;denchmark-link:https://github.com/wentaozhu&gt;@wentaozhu&lt;/denchmark-link&gt;
 Thank you for making it reproducible. I got it. If you use  and  without , I highly recommend &lt;denchmark-link:https://torchgpipe.readthedocs.io/en/stable/api.html#torchgpipe.skip.verify_skippables&gt;verify_skippables()&lt;/denchmark-link&gt;
 to check skip connection errors before training your module. You will get an exception like this before training:
&lt;denchmark-code&gt;TypeError: one or more pairs of stash and pop do not match:

* '1' declared 'p' as poppable but it was not stashed
* '1' declared 's' as poppable but it was not stashed
* '1' declared 'i' as poppable but it was not stashed
* '1' declared 'k' as poppable but it was not stashed
* no module declared 'skip' as poppable but stashed
&lt;/denchmark-code&gt;

I didn't find a point to improve. I close this issue.
		</comment>
	</comments>
</bug>