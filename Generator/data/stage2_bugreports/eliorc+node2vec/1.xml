<bug id='1' author='pranavdogra7' open_date='2018-04-26T09:27:31Z' closed_time='2018-05-06T14:21:40Z'>
	<summary>np.random.choice doesn't want a to be empty</summary>
	<description>
while len(walk) &lt; walk_length:
                    walk_options = d_graph[walk[-1]][neighbors_key]
                    
                    if len(walk) == 1:  # For the first step
                        walk_to = np.random.choice(walk_options, size=1)[0]
                    else:
                        probabilities = d_graph[walk[-1]][probabilities_key][walk[-2]]
                        walk_to = np.random.choice(walk_options, size=1, p=probabilities)[0]
This is giving error. Can you please look into it ?
In some cases, walk_options is an empty list and hence the error. Is there any way around? I tried putting if conditions for empty case but it's not working.
	</description>
	<comments>
		<comment id='1' author='pranavdogra7' date='2018-04-27T06:17:34Z'>
		Thanks, I will look into it, could you supply my code to reproduce the error?
		</comment>
		<comment id='2' author='pranavdogra7' date='2018-04-27T07:31:05Z'>
		Here's the error I'm getting
/Users/rambo/anaconda3/lib/python3.6/site-packages/node2vec/node2vec.py in parallel_generate_walks(d_graph=defaultdict(&lt;class 'dict'&gt;, {'0': {'probabilitie...7': array([], dtype=float64)}, 'neighbors': []}}), global_walk_length=30, num_walks=50, cpu_num=1, sampling_strategy={}, num_walks_key='num_walks', walk_length_key='walk_length', neighbors_key='neighbors', probabilities_key='probabilities')
     48                     walk_options = d_graph[walk[-1]][neighbors_key]
     49                     if len(walk) == 1:  # For the first step
     50                         walk_to = np.random.choice(walk_options, size=1)[0]
     51                     else:
     52                         probabilities = d_graph[walk[-1]][probabilities_key][walk[-2]]
---&gt; 53                         walk_to = np.random.choice(walk_options, size=1, p=probabilities)[0]
        walk_to = '224'
        walk_options = []
        probabilities = array([], dtype=float64)
     54                     walk.append(walk_to)
     55 
     56                 walk = list(map(str, walk))  # Convert all to strings
     57                 walks.append(walk)

...........................................................................
/Users/rambo/anaconda3/lib/python3.6/site-packages/numpy/random/mtrand.cpython-36m-darwin.so in mtrand.RandomState.choice()

ValueError: a must be non-empty
		</comment>
		<comment id='3' author='pranavdogra7' date='2018-04-27T07:45:38Z'>
		Can you try to switch
This:
&lt;denchmark-code&gt;walk_options = d_graph[walk[-1]][neighbors_key]
&lt;/denchmark-code&gt;

With this:
&lt;denchmark-code&gt;# Skip nodes without neighbors
if neighbors_key not in d_graph[walk[-1]]:
    break

walk_options = d_graph[walk[-1]][neighbors_key]
&lt;/denchmark-code&gt;

And report the result?
		</comment>
		<comment id='4' author='pranavdogra7' date='2018-04-27T07:52:07Z'>
		Still the same error
/Users/rambo/anaconda3/lib/python3.6/site-packages/node2vec/node2vec.py in parallel_generate_walks(d_graph=defaultdict(&lt;class 'dict'&gt;, {'0': {'probabilitie...7': array([], dtype=float64)}, 'neighbors': []}}), global_walk_length=30, num_walks=50, cpu_num=1, sampling_strategy={}, num_walks_key='num_walks', walk_length_key='walk_length', neighbors_key='neighbors', probabilities_key='probabilities')
     48                     if neighbors_key not in d_graph[walk[-1]]:
     49                         break
     50                     else:
     51                         walk_options = d_graph[walk[-1]][neighbors_key]
     52                     if len(walk) == 1:  # For the first step
---&gt; 53                         walk_to = np.random.choice(walk_options, size=1)[0]
        walk_to = '187'
        walk_options = []
     54                     else:
     55                         probabilities = d_graph[walk[-1]][probabilities_key][walk[-2]]
     56                         walk_to = np.random.choice(walk_options, size=1, p=probabilities)[0]
     57                     walk.append(walk_to)

...........................................................................
/Users/rambo/anaconda3/lib/python3.6/site-packages/numpy/random/mtrand.cpython-36m-darwin.so in mtrand.RandomState.choice()

ValueError: a must be non-empty
		</comment>
		<comment id='5' author='pranavdogra7' date='2018-04-27T07:53:41Z'>
		The extra thing you should know is I had a neo4j graph database, and I converted that to networkx and then after I proceeded with your code.
		</comment>
		<comment id='6' author='pranavdogra7' date='2018-04-27T08:07:49Z'>
		I'll work on it soon
		</comment>
		<comment id='7' author='pranavdogra7' date='2018-04-27T09:12:09Z'>
		Ok, thanks for the help
		</comment>
		<comment id='8' author='pranavdogra7' date='2018-04-27T09:17:02Z'>
		Can you change
&lt;denchmark-code&gt;walk_options = d_graph[walk[-1]][neighbors_key]
&lt;/denchmark-code&gt;

to this
&lt;denchmark-code&gt;walk_options = d_graph[walk[-1]][neighbors_key]

# Skip dead end nodes
if not walk_options:
    break
&lt;/denchmark-code&gt;

And report results?
		</comment>
		<comment id='9' author='pranavdogra7' date='2018-04-27T09:26:20Z'>
		Still the same issue. I have tried basic checks, with length and exception handling, it's still giving the same error
		</comment>
		<comment id='10' author='pranavdogra7' date='2018-04-27T10:13:52Z'>
		To debug this correctly I'll need you to give me a way to reproduce the nx.Graph, and the calling code to the node2vec functions
		</comment>
		<comment id='11' author='pranavdogra7' date='2018-04-27T10:55:59Z'>
		&lt;denchmark-link:https://github.com/eliorc/node2vec/files/1954808/export.txt&gt;export.txt&lt;/denchmark-link&gt;

I exported my graph as json and have attached the file(just change the extension to json), and here's how you can &lt;denchmark-link:https://stackoverflow.com/questions/34665042/read-json-graph-networkx-file&gt;reproduce&lt;/denchmark-link&gt;
 it. For calling node2vec, I just followed your methods.
		</comment>
		<comment id='12' author='pranavdogra7' date='2018-04-27T19:36:03Z'>
		Thanks, I'll look into it
		</comment>
		<comment id='13' author='pranavdogra7' date='2018-04-28T09:49:33Z'>
		&lt;denchmark-link:https://github.com/pranavdogra7&gt;@pranavdogra7&lt;/denchmark-link&gt;
 Given the file and the SO post, I run this code and it fails
&lt;denchmark-code&gt;def read_json_file(filename):
    with open(filename) as f:
        js_graph = json.load(f)
    return nx.readwrite.json_graph.node_link_graph(js_graph)

graph = read_json_file(JSON_FILE)
&lt;/denchmark-code&gt;

I get the following error:

Traceback (most recent call last):
File "/home/elior/Code/VirtualEnvs/node2vec/lib/python3.6/site-&gt;packages/IPython/core/interactiveshell.py", line 2910, in run_code
exec(code_obj, self.user_global_ns, self.user_ns)
File "", line 8, in 
graph = read_json_file(JSON_FILE)
File "", line 6, in read_json_file
return nx.readwrite.json_graph.node_link_graph(js_graph)
File "/home/elior/Code/VirtualEnvs/node2vec/lib/python3.6/site-&gt;packages/networkx/readwrite/json_graph/node_link.py", line 173, in node_link_graph
for d in data[links]:
KeyError: 'links'

Running networkx version 2.0
		</comment>
		<comment id='14' author='pranavdogra7' date='2018-04-29T00:29:06Z'>
		&lt;denchmark-link:https://github.com/eliorc/node2vec/files/1958311/export.-.Copy.txt&gt;export - Copy.txt&lt;/denchmark-link&gt;

Okay, try with this file.
Here's the code to load the graph
from networkx.readwrite import json_graph

with open("export - Copy.json") as file:
	g = json.load(file)

graph = json_graph.node_link_graph(g)
nx.draw(graph)
		</comment>
		<comment id='15' author='pranavdogra7' date='2018-04-29T00:43:34Z'>
		With the previous file (case 1), you can use the below-mentioned code
with open("export.json") as file:
	g = json.load(file)

graph = json_graph.adjacency_graph(g)
nx.draw(graph)
		</comment>
		<comment id='16' author='pranavdogra7' date='2018-05-05T10:29:10Z'>
		&lt;denchmark-link:https://github.com/pranavdogra7&gt;@pranavdogra7&lt;/denchmark-link&gt;
 , I believe this is fixed, please update your node2vec version to the lastest (0.1.2) and report if this was solved. Thanks
		</comment>
	</comments>
</bug>