<bug id='51' author='yevhen-m' open_date='2017-07-17T09:38:29Z' closed_time='2019-07-06T14:49:11Z'>
	<summary>ValueError when generating profile from dataframe</summary>
	<description>
I have  a pandas dataframe, when I try to generated report from df.head(), everything works fine. But when I try to generate report for the whole dataframe, I get this error:
&lt;denchmark-code&gt;ValueError                                Traceback (most recent call last)
&lt;ipython-input-54-b5ad826014b5&gt; in &lt;module&gt;()
----&gt; 1 pandas_profiling.ProfileReport(df)

./python3.5/site-packages/pandas_profiling/__init__.py in __init__(self, df, **kwargs)
     15         sample = kwargs.get('sample', df.head())
     16 
---&gt; 17         description_set = describe(df, **kwargs)
     18 
     19         self.html = to_html(sample,

./python3.5/site-packages/pandas_profiling/base.py in describe(df, bins, correlation_overrides, pool_size, **kwargs)
    307 
    308         confusion_matrix=pd.crosstab(data1,data2)
--&gt; 309         if confusion_matrix.values.diagonal().sum() == len(df):
    310             ldesc[name1] = pd.Series(['RECODED', name2], index=['type', 'correlation_var'])
    311 

ValueError: diag requires an array of at least two dimensions
&lt;/denchmark-code&gt;

	</description>
	<comments>
		<comment id='1' author='yevhen-m' date='2017-12-31T00:09:47Z'>
		Could you provide a dataset that I can reproduce this error?
Thanks
		</comment>
		<comment id='2' author='yevhen-m' date='2017-12-31T13:11:38Z'>
		&lt;denchmark-link:https://github.com/conradoqg&gt;@conradoqg&lt;/denchmark-link&gt;
 unfortunately I don't have it anymore. Context of this error has been lost.
		</comment>
		<comment id='3' author='yevhen-m' date='2018-01-29T22:43:05Z'>
		I have the same error. Unfortunately I cannot provide the data set :(
		</comment>
		<comment id='4' author='yevhen-m' date='2019-06-27T14:48:32Z'>
		I have been able to reproduce this error. And I can post data that reproduces it.
Describe the bug
Error output:
&lt;denchmark-code&gt;---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
&lt;ipython-input-3-d4e9ca79f757&gt; in &lt;module&gt;()
----&gt; 1 df3.profile_report()

/anaconda3/lib/python3.6/site-packages/pandas_profiling/controller/pandas_decorator.py in profile_report(df, **kwargs)
     14         A ProfileReport of the DataFrame.
     15     """
---&gt; 16     p = ProfileReport(df, **kwargs)
     17     return p
     18 

/anaconda3/lib/python3.6/site-packages/pandas_profiling/__init__.py in __init__(self, df, **kwargs)
     56 
     57         # Get dataset statistics
---&gt; 58         description_set = describe_df(df)
     59 
     60         # Get sample

/anaconda3/lib/python3.6/site-packages/pandas_profiling/model/describe.py in describe(df)
    454 
    455     # Get correlations
--&gt; 456     correlations = calculate_correlations(df, variables)
    457 
    458     # Check correlations between numerical variables

/anaconda3/lib/python3.6/site-packages/pandas_profiling/model/correlations.py in calculate_correlations(df, variables)
    187     for correlation_name, get_matrix in categorical_correlations.items():
    188         if config["correlations"][correlation_name].get(bool):
--&gt; 189             correlation = get_matrix(df, variables)
    190             if len(correlation) &gt; 0:
    191                 correlations[correlation_name] = correlation

/anaconda3/lib/python3.6/site-packages/pandas_profiling/model/correlations.py in recoded_matrix(df, variables)
     72         A recoded matrix for categorical variables.
     73     """
---&gt; 74     return categorical_matrix(df, variables, partial(check_recoded, count=len(df)))
     75 
     76 

/anaconda3/lib/python3.6/site-packages/pandas_profiling/model/correlations.py in categorical_matrix(df, variables, correlation_function)
    108         correlation_matrix.loc[name2, name1] = correlation_matrix.loc[
    109             name1, name2
--&gt; 110         ] = correlation_function(confusion_matrix)
    111 
    112     return correlation_matrix

/anaconda3/lib/python3.6/site-packages/pandas_profiling/model/correlations.py in check_recoded(confusion_matrix, count)
     44         Whether the variables are recoded.
     45     """
---&gt; 46     return int(confusion_matrix.values.diagonal().sum() == count)
     47 
     48 

ValueError: diag requires an array of at least two dimensions
&lt;/denchmark-code&gt;

To Reproduce
import pandas as pd
import pandas_profiling
import requests

response = requests.get(
    'https://raw.githubusercontent.com/adamrossnelson/HelloWorld/master/sparefiles/buggy1.pkl'
)
pkl_name = 'buggy1.pkl'
pkl_file = open(pkl_name, 'wb')
pkl_file.write(response.content)
pkl_file.close()

df = pd.read_pickle('buggy1.pkl')
df.profile_report()

See my version output on previous issue:
&lt;denchmark-link:https://github.com/pandas-profiling/pandas-profiling/issues/194&gt;#194&lt;/denchmark-link&gt;

Additional context
No error when... If you save the df to a csv, then read from csv and then attempt a profile report.
Otherwise I would have just saved the example data as a csv. I was only able to reproduce when I pickled the data.
Would be happy to resubmit as a new issue if that would be helpful.
		</comment>
		<comment id='5' author='yevhen-m' date='2019-07-04T18:06:23Z'>
		&lt;denchmark-link:https://github.com/adamrossnelson&gt;@adamrossnelson&lt;/denchmark-link&gt;
: The CSV conversion in your case effectively produces the same output as:
df.replace('', np.nan, inplace=True)
df.fillna(np.nan, inplace=True)
What were the values before converting the DataFrame to pickle? If the '' values are intentional, we will need a way for the package to work with them.
The use of None and '' are at least problematic, I'll have a look..
		</comment>
		<comment id='6' author='yevhen-m' date='2019-07-06T14:49:11Z'>
		Should be resolved in v2.1.0.
		</comment>
	</comments>
</bug>