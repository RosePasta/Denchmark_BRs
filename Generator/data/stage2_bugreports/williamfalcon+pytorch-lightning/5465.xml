<bug id='5465' author='adityabalu' open_date='2021-01-11T17:46:20Z' closed_time='2021-01-16T10:57:30Z'>
	<summary>model_to_device() missing 1 required positional argument 'process_idx'</summary>
	<description>
&lt;denchmark-h:h2&gt;üêõ Bug&lt;/denchmark-h&gt;

When running the code for ddp_cpu on SLURM based cluster, I get this error:

Traceback (most recent call last): File "image_classifier.py", line 99, in &lt;module&gt; cli_main() File "image_classifier.py", line 87, in cli_main trainer.fit(model, datamodule=dm) File "/pylon5/cis200022p/balu/softwares/pytorch/lib/python3.8/site-packages/pytorch_lightning/trainer/trainer.py", line 472, in fit results = self.accelerator_backend.train() File "/pylon5/cis200022p/balu/softwares/pytorch/lib/python3.8/site-packages/pytorch_lightning/accelerators/ddp_hpc_accelerator.py", line 64, in train self.ddp_train(process_idx=self.task_idx, model=model) File "/pylon5/cis200022p/balu/softwares/pytorch/lib/python3.8/site-packages/pytorch_lightning/accelerators/ddp_hpc_accelerator.py", line 172, in ddp_train self.model_to_device(model) TypeError: model_to_device() missing 1 required positional argument: 'process_idx'

When I look &lt;denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pytorch_lightning/accelerators/ddp_cpu_hpc_accelerator.py#L45&gt;here&lt;/denchmark-link&gt;
 the model_to_device function needs process_idx as an input, but is not sent &lt;denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pytorch_lightning/accelerators/ddp_hpc_accelerator.py#L172&gt;here&lt;/denchmark-link&gt;

&lt;denchmark-h:h2&gt;Please reproduce using the BoringModel&lt;/denchmark-h&gt;

I used this code :
&lt;denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pl_examples/basic_examples/simple_image_classifier.py&gt;https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pl_examples/basic_examples/simple_image_classifier.py&lt;/denchmark-link&gt;

Along with this slurm job script:
&lt;denchmark-code&gt;&gt; #!/bin/bash
&gt; #SBATCH --job-name='pl_dist'
&gt; #SBATCH --nodes=2
&gt; #SBATCH -p RM
&gt; #SBATCH --ntasks-per-node=1
&gt; #SBATCH -t 1:00:00
&gt; 
&gt; module load anaconda3
&gt; source activate /pylon5/softwares/pytorch
&gt; 
&gt; export NCCL_DEBUG=INFO
&gt; export PYTHONFAULTHANDLER=1
&gt; 
&gt; srun -n 2 --ntasks-per-node 1 python image_classifier.py --accelerator 'ddp_cpu' --num_nodes 2 --num_processes 1 --max_epochs 50
&lt;/denchmark-code&gt;

&lt;denchmark-h:h3&gt;Environment&lt;/denchmark-h&gt;


CUDA:
- GPU:
- available:         False
- version:           10.2
Packages:
- numpy:             1.19.2
- pyTorch_debug:     False
- pyTorch_version:   1.7.1
- pytorch-lightning: 1.1.3
- tqdm:              4.56.0
System:
- OS:                Linux
- architecture:
- 64bit
- ELF
- processor:         x86_64
- python:            3.8.5
- version:           #1 SMP Mon Jul 29 17:46:05 UTC 2019

	</description>
	<comments>
		<comment id='1' author='adityabalu' date='2021-01-11T17:47:03Z'>
		Hi! thanks for your contribution!, great first issue!
		</comment>
	</comments>
</bug>