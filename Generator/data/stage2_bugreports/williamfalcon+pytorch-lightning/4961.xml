<bug id='4961' author='carefree0910' open_date='2020-12-03T17:45:24Z' closed_time='2021-01-07T16:39:04Z'>
	<summary>manual_optimization does not work with dp</summary>
	<description>
&lt;denchmark-h:h2&gt;üêõ Bug&lt;/denchmark-h&gt;

We can run dp backend with manual optimization, but the gradients seem to be messed up hence the model can't learn anything.
&lt;denchmark-h:h3&gt;To Reproduce&lt;/denchmark-h&gt;


Change optimization to manual in basic gan bolt, then change the backend to dp.
Set batch_size = 2, compare experiments on 1 GPU vs 2 GPUs
When using 1 GPU everything is fine, but using 2 GPUs will fail the training.


I haven't really test it yet, but since I've done many experiments on my own implementations (which is too heavy to paste them here and hard to extract), I think it should be able to reproduce.

&lt;denchmark-h:h3&gt;Expected behavior&lt;/denchmark-h&gt;

Performance under 2 GPUs with dp backend should be identical to the 1 GPU one.
&lt;denchmark-h:h3&gt;Environment&lt;/denchmark-h&gt;

(Should be ) Any.
&lt;denchmark-h:h3&gt;Additional context&lt;/denchmark-h&gt;

This bug comes from my experiments on GANs but should be affecting other models as long as the manual optimization is utilized.
	</description>
	<comments>
		<comment id='1' author='carefree0910' date='2020-12-04T13:49:16Z'>
		Hey &lt;denchmark-link:https://github.com/carefree0910&gt;@carefree0910&lt;/denchmark-link&gt;
,
manual_optimization with more than 1 gpus is broken right now. We are working on fix.
We apologise for the inconvenience.
Best regards,
T.C
		</comment>
		<comment id='2' author='carefree0910' date='2020-12-08T16:03:38Z'>
		&lt;denchmark-link:https://github.com/carefree0910&gt;@carefree0910&lt;/denchmark-link&gt;
 mind trying master? this might have been fixed with &lt;denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/pull/4976&gt;#4976&lt;/denchmark-link&gt;

		</comment>
		<comment id='3' author='carefree0910' date='2020-12-08T16:08:35Z'>
		I'm quite busy these days so I hardly have time to test it üò≠
Since the problem should be a general problem, I think it should stand out on ordinary GANs if the issue remains. Anyway I'll try it out ASAP!
		</comment>
		<comment id='4' author='carefree0910' date='2021-01-07T16:39:14Z'>
		Feel free to reopen if needed!
		</comment>
	</comments>
</bug>