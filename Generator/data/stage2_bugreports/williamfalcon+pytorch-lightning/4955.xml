<bug id='4955' author='YannDubs' open_date='2020-12-03T00:28:10Z' closed_time='2021-01-07T16:39:27Z'>
	<summary>Optimizers not working in callbacks when multiple optimizers in training</summary>
	<description>
&lt;denchmark-h:h2&gt;üêõ Bug&lt;/denchmark-h&gt;

If the trainer uses multiple optimizers (e.g. GANs) then you cannot use optimizers in callbacks (e.g. pl_bolts.callbacks.ssl_online.SSLOnlineEvaluator) because when using multiple optimizers toggle_optimizer is called during training, but requires_grad are not set to True at the end of training (so gradients for callback optimizers are not computed).
&lt;denchmark-h:h2&gt;Please reproduce using the BoringModel and post here&lt;/denchmark-h&gt;

&lt;denchmark-link:https://colab.research.google.com/drive/1ryy-FwUhQmTvgBvjF9cC3zVmrGFIAcxr?usp=sharing&gt;https://colab.research.google.com/drive/1ryy-FwUhQmTvgBvjF9cC3zVmrGFIAcxr?usp=sharing&lt;/denchmark-link&gt;

&lt;denchmark-h:h3&gt;Expected behavior&lt;/denchmark-h&gt;

At the end of training (but before callbacks) all requires_grad should be set to true again, so that users can have optimizers in callbacks. If not pl_bolts.callbacks.ssl_online.SSLOnlineEvaluator does not work when using multiple optimizers.
&lt;denchmark-h:h3&gt;Environment&lt;/denchmark-h&gt;

pytorch-lightning master (same bug with pip install)
	</description>
	<comments>
		<comment id='1' author='YannDubs' date='2020-12-07T13:46:27Z'>
		Hey &lt;denchmark-link:https://github.com/YannDubs&gt;@YannDubs&lt;/denchmark-link&gt;
,
Could you provide reproduce this behaviour using &lt;denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pl_examples/bug_report_model.py&gt;https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pl_examples/bug_report_model.py&lt;/denchmark-link&gt;
.
I am not sure to fully understand what you are trying to do.
Best regards,
Thomas Chaton
		</comment>
		<comment id='2' author='YannDubs' date='2021-01-07T16:39:48Z'>
		Feel free to reopen with reproducible code!
		</comment>
	</comments>
</bug>