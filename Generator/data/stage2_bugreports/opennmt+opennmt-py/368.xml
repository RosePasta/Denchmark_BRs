<bug id='368' author='JianyuZhan' open_date='2017-10-30T08:38:36Z' closed_time='2017-12-27T19:22:11Z'>
	<summary>Upgrade to torchtext 0.2.0.</summary>
	<description>
I observed that several recent  pull requests fail the Travis integration test due to the same error - a seemly infinite loop in this test:
&lt;denchmark-code&gt;test_dataset_build_[('dynamic_dict',_True),_('share_vocab',_True)] (test.test_preprocess.TestData)
&lt;/denchmark-code&gt;

The trackback below points to the hang in the torchtext.data.Dataset constructor in this line:
&lt;denchmark-link:https://github.com/OpenNMT/OpenNMT-py/blob/master/onmt/IO.py#L196&gt;https://github.com/OpenNMT/OpenNMT-py/blob/master/onmt/IO.py#L196&lt;/denchmark-link&gt;

&lt;denchmark-code&gt;...

  File "/home/opennmt/anaconda2/lib/python2.7/unittest/case.py", line 329, in run
    testMethod()
  File "/home/opennmt/OpenNMT-py-jianyu/test/test_preprocess.py", line 72, in test_method
    getattr(self, methodname)(opt)
  File "/home/opennmt/OpenNMT-py-jianyu/test/test_preprocess.py", line 34, in dataset_build
    opt)
  File "/home/opennmt/OpenNMT-py-jianyu/onmt/IO.py", line 200, in __init__
    else None)
  File "/home/opennmt/anaconda2/lib/python2.7/site-packages/torchtext/data/dataset.py", line 40, in __init__
    examples = list(filter(filter_pred, examples))
  File "/home/opennmt/OpenNMT-py-jianyu/onmt/IO.py", line 187, in construct_final
    for i, ex in enumerate(examples):
  File "/home/opennmt/OpenNMT-py-jianyu/onmt/IO.py", line 164, in dynamic_dict
    src_vocab = torchtext.vocab.Vocab(Counter(src))
  File "/home/opennmt/anaconda2/lib/python2.7/site-packages/torchtext/vocab.py", line 60, in __init__
    words_and_frequencies = sorted(counter.items(), key=lambda tup: tup[0])
KeyboardInterrupt
&lt;/denchmark-code&gt;

I found this problem exist only on torchtext 0.2.0, I reinstalled the old 0.1.1 version and it then vanished.
We need to investigate whether it is our problem or torchtext's.  &lt;denchmark-link:https://github.com/jekbradbury&gt;@jekbradbury&lt;/denchmark-link&gt;
, would you please shed some light on this from the torchtext side ?
For you to easily reproduce this problem, after installing OpenNMT-py, run python -m unittest discover -v it will print where it gets stuck.
	</description>
	<comments>
		<comment id='1' author='JianyuZhan' date='2017-11-05T15:49:52Z'>
		Maybe we should fix this. But for now I'll accept the patch.
		</comment>
		<comment id='2' author='JianyuZhan' date='2017-11-06T04:46:39Z'>
		IO.pyhas changed since this issue was posted so I can't quite follow the original traceback. Can I reproduce it by running the test suite locally?
		</comment>
		<comment id='3' author='JianyuZhan' date='2017-11-06T05:29:14Z'>
		Hi, &lt;denchmark-link:https://github.com/jekbradbury&gt;@jekbradbury&lt;/denchmark-link&gt;
 , you can do like this:
install OpenNMT-py, run python -m unittest discover -v,  it will print where it gets stuck. The traceback above is generated by press Ctrl-C(because it is stuck).
		</comment>
	</comments>
</bug>