<bug id='1297' author='lvgeng' open_date='2019-11-03T21:36:11Z' closed_time='2020-08-20T17:37:37Z'>
	<summary>Colored point cloud registration fail to achieve local best solution and a possible solution.</summary>
	<description>
Colored point cloud registration is a really amazing feature of open3d...
&lt;denchmark-link:http://www.open3d.org/docs/release/tutorial/Advanced/colored_pointcloud_registration.html&gt;http://www.open3d.org/docs/release/tutorial/Advanced/colored_pointcloud_registration.html&lt;/denchmark-link&gt;

There is a similar problem. As mentioned, the point clouds fly away.
I checked the objective function and I think it is certainly a bug in this case.....
A wild guess is that the optimiser used in the registration have a larger step than expected.
When the first guess is made, there is a possibility that the two point cloud has zero corresponding  point pairs so that the objective function gives zero, which is considered to be a "better" solution than others. It might happen to a lot of situation, especially when the point clouds are relatively small and have few points.
&lt;denchmark-link:https://github.com/intel-isl/Open3D/issues/362&gt;#362&lt;/denchmark-link&gt;

However I have some issue while playing with my own data. The init transformation should be good enough I guess... The color difference is added in the visualization stage, it should not affect the colored point cloud registration.
My testing code and data
&lt;denchmark-link:https://github.com/intel-isl/Open3D/files/3752698/python_script_and_data.zip&gt;python_script_and_data.zip&lt;/denchmark-link&gt;

and results. (each one use the previous result as the initial pose)
original:
&lt;denchmark-link:https://user-images.githubusercontent.com/9252650/67239714-bb13c080-f447-11e9-9206-6b9611c42b23.png&gt;&lt;/denchmark-link&gt;

point to point
&lt;denchmark-link:https://user-images.githubusercontent.com/9252650/67239741-c830af80-f447-11e9-849d-acb8ff3f24a2.png&gt;&lt;/denchmark-link&gt;

point to plane
&lt;denchmark-link:https://user-images.githubusercontent.com/9252650/67239764-d4b50800-f447-11e9-8f8d-a6b9747ddde3.png&gt;&lt;/denchmark-link&gt;

registration_colored_icp
&lt;denchmark-link:https://user-images.githubusercontent.com/9252650/67239789-e696ab00-f447-11e9-8b4f-a6d5c2574f88.png&gt;&lt;/denchmark-link&gt;

I understand that it is possible to have a bad result if the data is not so good, but I cannot understand why it pushes the point cloud away after the registration. Is there any solution for that?
My data is here. They are point cloud I generated by other methods.
And the function
        result_icp = o3d.registration.registration_colored_icp( source_down, target_down, radius, current_transformation, o3d.registration.ICPConvergenceCriteria(relative_fitness=1e-6, relative_rmse=1e-6, max_iteration=iter))
should I change the relative_fitness or relative_rmse?
And ... what do they do exactly?
	</description>
	<comments>
		<comment id='1' author='lvgeng' date='2019-11-05T16:53:50Z'>
		Duplicate of &lt;denchmark-link:https://github.com/intel-isl/Open3D/issues/1261&gt;#1261&lt;/denchmark-link&gt;
. Please check out &lt;denchmark-link:https://github.com/intel-isl/Open3D/issues/1261#issuecomment-549909729&gt;this&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='lvgeng' date='2019-11-05T21:42:30Z'>
		Checked. Unfortunately I have already tried that... the details are in that issue.

Duplicate of #1261. Please check out this

		</comment>
		<comment id='3' author='lvgeng' date='2019-11-17T22:58:41Z'>
		yes.. without a working ransac or other icp registration, colored point cloud registration makes pointclouds flying away...
		</comment>
		<comment id='4' author='lvgeng' date='2019-11-25T16:22:24Z'>
		
yes.. without a working ransac or other icp registration, colored point cloud registration makes pointclouds flying away...

However... the problem is, when we are using  colored point cloud registration, it means the ICP does not work well.
		</comment>
		<comment id='5' author='lvgeng' date='2020-08-07T04:48:23Z'>
		&lt;denchmark-link:https://github.com/lvgeng&gt;@lvgeng&lt;/denchmark-link&gt;
 I agree. We definitely need to work on a new registration method/an upgrade of ICP. We will keep you posted
		</comment>
		<comment id='6' author='lvgeng' date='2020-08-12T17:14:23Z'>
		Colored ICP is a necessary step for many reconstruction applications where the geometric difference between RGBD frames are not significant, along walls, inside a tunnel. Under such cases, the color information is the major source to guide the registration.
I think the flying away issue arise when we keep reducing the scale for finer registration. My workaround is to break the registration at certain scale when the fitness/inlier_rmse is smaller/larger than the previous iteration. This can prevent the registration diverge but since we break the registration at larger scale,we may not able to get the expected level of accuracy.
I really appreciate if someone can work on this and further improve the current colored ICP implementation in open3d.
		</comment>
		<comment id='7' author='lvgeng' date='2020-08-20T17:37:37Z'>
		According to my experience, Colored ICP will face numerical issues when the structure is very simple, like this or planar cases. We need to investigate that part and eliminate unreliable color gradients.
		</comment>
	</comments>
</bug>