<bug id='9278' author='madanadit' open_date='2019-06-13T00:17:36Z' closed_time='2020-01-17T23:07:39Z'>
	<summary>In k8s worker does not resolve master hostname until killed</summary>
	<description>
Alluxio Version:
2.0.0-RC3
Describe the bug
If the worker is not able to resolve the master hostname on start (as the master service was not booted yet), it fails to connect to master even after the master is booted up. Worker retries keep failing until the worker dies and is restarted by k8s.
To Reproduce
start worker
start master
worker fails for a long time in an error loop and dies
Expected behavior
error loop should terminate and successfully connect to master once its up
Urgency
not urgent. workaround is to have a short worker retry timeout or wait for master to be up before starting the worker.
Additional context
Worker logs:
&lt;denchmark-code&gt;2019-06-12 21:32:45,544 WARN  RetryUtils - Failed to load cluster default configuration with master (attempt 687): alluxio.exception.status.UnavailableException: Failed to handshake with master alluxio-master:19998 to load cluster default configuration values: UNKNOWN
2019-06-12 21:32:50,606 WARN  RetryUtils - Failed to load cluster default configuration with master (attempt 688): alluxio.exception.status.UnavailableException: Failed to handshake with master alluxio-master:19998 to load cluster default configuration values: UNKNOWN
2019-06-12 21:32:55,943 WARN  RetryUtils - Failed to load cluster default configuration with master (attempt 689): alluxio.exception.status.UnavailableException: Failed to handshake with master alluxio-master:19998 to load cluster default configuration values: UNKNOWN
2019-06-12 21:32:58,069 WARN  RetryUtils - Failed to load cluster default configuration with master (attempt 690): alluxio.exception.status.UnavailableException: Failed to handshake with master alluxio-master:19998 to load cluster default configuration values: UNKNOWN
2019-06-12 21:32:58,070 ERROR AlluxioWorker - Fatal error: Failed to load cluster default configuration for worker: Failed to handshake with master alluxio-master:19998 to load cluster default configuration values: UNKNOWN
&lt;/denchmark-code&gt;

alluxio-master:19998 here is the unresolved address, the resolved address should look like : alluxio-master/172.31.1.114:19998
	</description>
	<comments>
		<comment id='1' author='madanadit' date='2019-06-13T11:58:02Z'>
		This can be fixed by adding an InitContainer to the worker daemonset
initContainers:
  - name: nc-master
    image: alluxio/alluxio:2.0.0-RC3
    command:
    - 'sh'
    - '-c'
    - 'until nc -w 3 alluxio-master 19998; do echo waiting for alluxio-master; sleep 2; done'
Edit:
I'm working on a Helm Chart for Alluxio 2.0.0-RC3, this was my workaround
		</comment>
		<comment id='2' author='madanadit' date='2019-06-13T20:22:32Z'>
		Fix: &lt;denchmark-link:https://github.com/Alluxio/alluxio/pull/9286&gt;#9286&lt;/denchmark-link&gt;

		</comment>
		<comment id='3' author='madanadit' date='2019-06-13T20:24:31Z'>
		Thanks for the workaround &lt;denchmark-link:https://github.com/rblaine95&gt;@rblaine95&lt;/denchmark-link&gt;
. We created a fix for this issue which should be included in RC4. Also it would be great if you could create issues for things you observe.
Thanks again for testing it out!
		</comment>
		<comment id='4' author='madanadit' date='2019-06-13T20:28:18Z'>
		&lt;denchmark-link:https://github.com/rblaine95&gt;@rblaine95&lt;/denchmark-link&gt;
 If you could contribute back the helm chart that will be awesome!
		</comment>
		<comment id='5' author='madanadit' date='2019-06-14T07:57:54Z'>
		&lt;denchmark-link:https://github.com/madanadit&gt;@madanadit&lt;/denchmark-link&gt;
, regarding the Helm Chart, I'll have to talk to the Architects here at zenAptix
		</comment>
		<comment id='6' author='madanadit' date='2019-06-14T20:05:40Z'>
		please do. thx
		</comment>
	</comments>
</bug>