<bug id='9925' author='apc999' open_date='2019-09-20T19:34:54Z' closed_time='2019-10-02T00:56:56Z'>
	<summary>Unnecessary retries to handle tmp files during async through when rename fails</summary>
	<description>
Alluxio Version:
2.0.1
Describe the bug
Repeated error pattern shows when it failed to rename a file on PersistChecker in FilesystemMaster
&lt;denchmark-code&gt;2019-09-19 00:39:12,785 ERROR ObjectUnderFileSystem - Unable to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate because source does not exist or is a directory.
2019-09-19 00:39:42,865 ERROR ObjectUnderFileSystem - Unable to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate because source does not exist or is a directory.
2019-09-19 00:40:12,912 ERROR ObjectUnderFileSystem - Unable to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate because source does not exist or is a directory.
2019-09-19 00:40:42,935 ERROR ObjectUnderFileSystem - Unable to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate because source does not exist or is a directory.
2019-09-19 00:40:42,936 WARN  DefaultFileSystemMaster - Unexpected exception encountered when trying to complete persistence of a file /alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate (id=134150619135) : Failed to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate.
2019-09-19 00:40:42,993 ERROR ObjectUnderFileSystem - Unable to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate because source does not exist or is a directory.
2019-09-19 00:40:43,151 ERROR ObjectUnderFileSystem - Unable to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate because source does not exist or is a directory.
2019-09-19 00:40:43,358 ERROR ObjectUnderFileSystem - Unable to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate because source does not exist or is a directory.
2019-09-19 00:40:44,128 ERROR ObjectUnderFileSystem - Unable to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate because source does not exist or is a directory.
2019-09-19 00:40:45,435 ERROR ObjectUnderFileSystem - Unable to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate because source does not exist or is a directory.
2019-09-19 00:40:47,393 ERROR ObjectUnderFileSystem - Unable to rename s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/_tmp.-ext-10002/000996_0.deflate.alluxio.0x0000016D4552AA6D.tmp to s3://test-alluxio-poc/Dev_Ocean/alluxio_performance/.hive-staging_hive_2019-09-18_16-46-07_516_2010346955788472376-1/-ext-10002/000996_0.deflate because source does not exist or is a directory.
&lt;/denchmark-code&gt;

This may eventually cause too many threads on master to compete for persist the same file.
&lt;denchmark-code&gt;"Persist-Checker-1128" #2194 daemon prio=5 os_prio=0 tid=0x00007f450c137000 nid=0x4a9e waiting on condition [0x00007f44b1625000]
   java.lang.Thread.State: WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait for  &lt;0x00000005c1ff7ae0&gt; (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)
        at java.util.concurrent.locks.LockSupport.park(Unknown Source)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(Unknown Source)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireShared(Unknown Source)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireShared(Unknown Source)
        at java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.lock(Unknown Source)
        at alluxio.resource.LockResource.&lt;init&gt;(LockResource.java:50)
        at alluxio.resource.RefCountLockResource.&lt;init&gt;(RefCountLockResource.java:36)
        at alluxio.collections.LockPool.get(LockPool.java:180)
        at alluxio.master.file.meta.InodeLockManager.lockEdge(InodeLockManager.java:170)
        at alluxio.master.file.meta.SimpleInodeLockList.lockAndAddEdge(SimpleInodeLockList.java:249)
        at alluxio.master.file.meta.SimpleInodeLockList.lockEdge(SimpleInodeLockList.java:102)
        at alluxio.master.file.meta.LockedInodePath.traverse(LockedInodePath.java:429)
        at alluxio.master.file.meta.InodeTree.lockInodePath(InodeTree.java:351)
        at alluxio.master.file.meta.InodeTree.lockInodePathById(InodeTree.java:431)
        at alluxio.master.file.meta.InodeTree.lockFullInodePath(InodeTree.java:397)
        at alluxio.master.file.DefaultFileSystemMaster$PersistenceChecker.handleSuccess(DefaultFileSystemMaster.java:4081)
        at alluxio.master.file.DefaultFileSystemMaster$PersistenceChecker.lambda$heartbeat$0(DefaultFileSystemMaster.java:4227)
        at alluxio.master.file.DefaultFileSystemMaster$PersistenceChecker$$Lambda$326/1961684398.run(Unknown Source)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
        at java.lang.Thread.run(Unknown Source)
&lt;/denchmark-code&gt;

To Reproduce
Expected behavior
Once the rename fails, the persist job should fail and trigger a different job
Urgency
High
Additional context
	</description>
	<comments>
	</comments>
</bug>