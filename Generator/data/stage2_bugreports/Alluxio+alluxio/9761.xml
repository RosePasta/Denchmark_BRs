<bug id='9761' author='cheyang' open_date='2019-08-21T13:36:40Z' closed_time='2019-08-26T20:44:55Z'>
	<summary>Failed to use RocksDB in Kubernetes</summary>
	<description>
Alluxio Version:
2.1.0-SNAPSHOT
Describe the bug
Change HEAP to ROCKSDB in the Kubernetes cluster. I'm able to see the erros:
&lt;denchmark-code&gt;2019-08-21 12:07:57,238 ERROR AlluxioMaster - Fatal error: Failed to create master process
java.lang.RuntimeException: java.lang.RuntimeException: Failed to start masters
	at alluxio.master.AlluxioMasterProcess.&lt;init&gt;(AlluxioMasterProcess.java:121)
	at alluxio.master.AlluxioMasterProcess$Factory.create(AlluxioMasterProcess.java:389)
	at alluxio.master.AlluxioMaster.main(AlluxioMaster.java:45)
Caused by: java.lang.RuntimeException: Failed to start masters
	at alluxio.master.MasterUtils.createMasters(MasterUtils.java:57)
	at alluxio.master.AlluxioMasterProcess.&lt;init&gt;(AlluxioMasterProcess.java:119)
	... 2 more
Caused by: java.util.concurrent.ExecutionException: java.lang.UnsatisfiedLinkError: /tmp/librocksdbjni8198214604534869932.so: Error loading shared library ld-linux-x86-64.so.2: No such file or directory (needed by /tmp/librocksdbjni8198214604534869932.so)
	at java.util.concurrent.FutureTask.report(FutureTask.java:122)
	at java.util.concurrent.FutureTask.get(FutureTask.java:192)
	at alluxio.util.CommonUtils.invokeAll(CommonUtils.java:529)
	at alluxio.master.MasterUtils.createMasters(MasterUtils.java:55)
	... 3 more
Caused by: java.lang.UnsatisfiedLinkError: /tmp/librocksdbjni8198214604534869932.so: Error loading shared library ld-linux-x86-64.so.2: No such file or directory (needed by /tmp/librocksdbjni8198214604534869932.so)
	at java.lang.ClassLoader$NativeLibrary.load(Native Method)
	at java.lang.ClassLoader.loadLibrary0(ClassLoader.java:1941)
	at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1824)
	at java.lang.Runtime.load0(Runtime.java:809)
	at java.lang.System.load(System.java:1086)
	at org.rocksdb.NativeLibraryLoader.loadLibraryFromJar(NativeLibraryLoader.java:78)
	at org.rocksdb.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:56)
	at org.rocksdb.RocksDB.loadLibrary(RocksDB.java:64)
	at org.rocksdb.RocksDB.&lt;clinit&gt;(RocksDB.java:35)
	at alluxio.master.metastore.rocks.RocksBlockStore.&lt;init&gt;(RocksBlockStore.java:68)
	at alluxio.master.MasterUtils.lambda$getBlockStoreFactory$1(MasterUtils.java:72)
	at alluxio.master.block.DefaultBlockMaster.&lt;init&gt;(DefaultBlockMaster.java:252)
	at alluxio.master.block.DefaultBlockMaster.&lt;init&gt;(DefaultBlockMaster.java:235)
	at alluxio.master.block.BlockMasterFactory.create(BlockMasterFactory.java:51)
	at alluxio.master.block.BlockMasterFactory.create(BlockMasterFactory.java:28)
	at alluxio.master.MasterUtils.lambda$createMasters$0(MasterUtils.java:49)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
&lt;/denchmark-code&gt;

To Reproduce
Steps to reproduce the behavior (as minimally and precisely as possible)
Expected behavior
A clear and concise description of what you expected to happen.
Urgency
Describe the impact and urgency of the bug.
Additional context
Add any other context about the problem here.
	</description>
	<comments>
		<comment id='1' author='cheyang' date='2019-08-21T22:27:03Z'>
		Please provide details on how to reproduce and give details on your K8s environment.
		</comment>
		<comment id='2' author='cheyang' date='2019-08-22T00:01:10Z'>
		Follow the guide &lt;denchmark-link:https://github.com/Alluxio/alluxio/tree/master/integration/kubernetes&gt;https://github.com/Alluxio/alluxio/tree/master/integration/kubernetes&lt;/denchmark-link&gt;
, the only change is
&lt;denchmark-code&gt;cat &lt;&lt; EOF &gt; config.yaml
properties:
   alluxio.master.metastore: ROCKS
   alluxio.master.metastore.dir: /opt/alluxio/metastore
EOF

helm install -f config.yaml alluxio-repo/alluxio --version 2.1.0-SNAPSHOT
&lt;/denchmark-code&gt;

		</comment>
		<comment id='3' author='cheyang' date='2019-08-22T00:17:09Z'>
		Related PR: &lt;denchmark-link:https://github.com/Alluxio/alluxio/pull/8515/files&gt;https://github.com/Alluxio/alluxio/pull/8515/files&lt;/denchmark-link&gt;

		</comment>
		<comment id='4' author='cheyang' date='2019-08-22T11:49:06Z'>
		I'm trying to run with docker, still no luck.
&lt;denchmark-code&gt;docker run -d --user root   -p 19999:19999   \
--net=alluxio_nw   --name=alluxio-master   --hostname=alluxio-master   \
-e ALLUXIO_JAVA_OPTS="-Dalluxio.master.hostname=alluxio-master -Dalluxio.master.metastore=ROCKS "   \
-v journal:/opt/alluxio/journal   -v ufs:/opt/alluxio/underFSStorage  \
 alluxio/alluxio:2.1.0-SNAPSHOT master
&lt;/denchmark-code&gt;

The error is
&lt;denchmark-code&gt;019-08-22 11:46:23,070 ERROR AlluxioMaster - Fatal error: Failed to create master process
java.lang.RuntimeException: java.lang.RuntimeException: Failed to start masters
	at alluxio.master.AlluxioMasterProcess.&lt;init&gt;(AlluxioMasterProcess.java:121)
	at alluxio.master.FaultTolerantAlluxioMasterProcess.&lt;init&gt;(FaultTolerantAlluxioMasterProcess.java:58)
	at alluxio.master.AlluxioMasterProcess$Factory.create(AlluxioMasterProcess.java:387)
	at alluxio.master.AlluxioMaster.main(AlluxioMaster.java:45)
Caused by: java.lang.RuntimeException: Failed to start masters
	at alluxio.master.MasterUtils.createMasters(MasterUtils.java:57)
	at alluxio.master.AlluxioMasterProcess.&lt;init&gt;(AlluxioMasterProcess.java:119)
	... 3 more
Caused by: java.util.concurrent.ExecutionException: java.lang.UnsatisfiedLinkError: /tmp/librocksdbjni7409597473179416834.so: Error loading shared library ld-linux-x86-64.so.2: No such file or directory (needed by /tmp/librocksdbjni7409597473179416834.so)
	at java.util.concurrent.FutureTask.report(FutureTask.java:122)
	at java.util.concurrent.FutureTask.get(FutureTask.java:192)
	at alluxio.util.CommonUtils.invokeAll(CommonUtils.java:529)
	at alluxio.master.MasterUtils.createMasters(MasterUtils.java:55)
	... 4 more
Caused by: java.lang.UnsatisfiedLinkError: /tmp/librocksdbjni7409597473179416834.so: Error loading shared library ld-linux-x86-64.so.2: No such file or directory (needed by /tmp/librocksdbjni7409597473179416834.so)
	at java.lang.ClassLoader$NativeLibrary.load(Native Method)
	at java.lang.ClassLoader.loadLibrary0(ClassLoader.java:1941)
	at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1824)
	at java.lang.Runtime.load0(Runtime.java:809)
	at java.lang.System.load(System.java:1086)
	at org.rocksdb.NativeLibraryLoader.loadLibraryFromJar(NativeLibraryLoader.java:78)
	at org.rocksdb.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:56)
	at org.rocksdb.RocksDB.loadLibrary(RocksDB.java:64)
	at org.rocksdb.RocksDB.&lt;clinit&gt;(RocksDB.java:35)
	at alluxio.master.metastore.rocks.RocksBlockStore.&lt;init&gt;(RocksBlockStore.java:68)
	at alluxio.master.MasterUtils.lambda$getBlockStoreFactory$1(MasterUtils.java:72)
	at alluxio.master.block.DefaultBlockMaster.&lt;init&gt;(DefaultBlockMaster.java:252)
	at alluxio.master.block.DefaultBlockMaster.&lt;init&gt;(DefaultBlockMaster.java:235)
	at alluxio.master.block.BlockMasterFactory.create(BlockMasterFactory.java:51)
	at alluxio.master.block.BlockMasterFactory.create(BlockMasterFactory.java:28)
	at alluxio.master.MasterUtils.lambda$createMasters$0(MasterUtils.java:49)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
&lt;/denchmark-code&gt;

		</comment>
		<comment id='5' author='cheyang' date='2019-08-22T11:59:16Z'>
		And I find that adding export LD_LIBRARY_PATH=/lib64:$LD_LIBRARY_PATH can fix this issue.
For example:
&lt;denchmark-code&gt;docker run -d   -p 19999:19999 --user root   --net=alluxio_nw   \
--name=alluxio-master   --hostname=alluxio-master \
-e LD_LIBRARY_PATH=/lib64/ \
 -e ALLUXIO_JAVA_OPTS="-Dalluxio.master.hostname=alluxio-master -Dalluxio.master.metastore=ROCKS "  \
 -v journal:/opt/alluxio/journal   \
-v ufs:/opt/alluxio/underFSStorage  \
 alluxio/alluxio:2.1.0-SNAPSHOT master
&lt;/denchmark-code&gt;

I think it's better fix this in Dockerfile.
		</comment>
		<comment id='6' author='cheyang' date='2019-08-22T21:50:42Z'>
		/assign &lt;denchmark-link:https://github.com/madanadit&gt;@madanadit&lt;/denchmark-link&gt;

		</comment>
	</comments>
</bug>