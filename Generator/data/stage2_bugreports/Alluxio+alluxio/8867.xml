<bug id='8867' author='perrywang' open_date='2019-04-19T07:53:35Z' closed_time='2020-01-18T01:14:34Z'>
	<summary>No way to proactively sync alluxio data to underFS when MUST_CACHE used</summary>
	<description>
Alluxio Version:
1.8.1
Describe the bug
When CACHE_THROUGH used the performance is experiencing terribly situations. And all kinds of random application errors happen. When MUST_CACHE used all things works fine but we lost capability to sync alluxio local new added file to sync with underFS. Also there is no any approach exposed to proactively sync alluxio data to remote underFS.
To Reproduce
as described above
Expected behavior
provide command interface to sync alluxio data to underFS
Urgency
Urgent
Additional context
N/A
	</description>
	<comments>
		<comment id='1' author='perrywang' date='2019-04-23T17:31:42Z'>
		&lt;denchmark-link:https://github.com/perrywang&gt;@perrywang&lt;/denchmark-link&gt;
 We currently have two ways

Use ASYNC_THROUGH mode (much more mature in Alluxio 2) which will write data into Alluxio and then asynchronously write it to the underFS.
Use the persist command to explicitly flush files only in Alluxio to the underFS.

Would either of these ways work for you? If not, could you detail what kind of behavior you are looking for?
		</comment>
		<comment id='2' author='perrywang' date='2019-04-24T10:32:38Z'>
		&lt;denchmark-link:https://github.com/calvinjia&gt;@calvinjia&lt;/denchmark-link&gt;
 Hello, If I Use ASYNC_THROUGH , is there something wrong leading to data loss?
		</comment>
		<comment id='3' author='perrywang' date='2019-04-24T10:51:33Z'>
		&lt;denchmark-link:https://github.com/perrywang&gt;@perrywang&lt;/denchmark-link&gt;
 What about writetype is THROUGH?
		</comment>
		<comment id='4' author='perrywang' date='2019-04-24T18:33:50Z'>
		&lt;denchmark-link:https://github.com/liuzx32&gt;@liuzx32&lt;/denchmark-link&gt;
 Good questions!
For the async through write type, you can specify the number of replicas you want to write into Alluxio space to prevent data loss. For example, if you have only 1 copy, you will lose data if that machine crashes, with 3 replicas, you will get similar durability as other distributed storages. Keep in mind only 1 replica needs to be intact within the time of completing the write to Alluxio and the async persist to the underFS.
Write type THROUGH writes synchronously to the underFS, so there is no chance of data loss unless the underFS has data loss.
		</comment>
		<comment id='5' author='perrywang' date='2019-04-25T06:57:10Z'>
		&lt;denchmark-link:https://github.com/calvinjia&gt;@calvinjia&lt;/denchmark-link&gt;
 Thanks for your answer.
&lt;denchmark-h:h1&gt;&lt;/denchmark-h&gt;

Now the write performance of  THROUGH is better then CACHE_THROUGH and ASYSNC_THROUGH.
And the cmd persist -p n is also slower then others.
		</comment>
		<comment id='6' author='perrywang' date='2019-04-25T17:43:39Z'>
		&lt;denchmark-link:https://github.com/liuzx32&gt;@liuzx32&lt;/denchmark-link&gt;

I would expect THROUGH and CACHE_THROUGH to have similar performance (Alluxio overhead should be small). ASYNC_THROUGH should have better performance (similar to your MUST_CACHE performance). What is your environment like (underFS, # nodes, network)?
		</comment>
		<comment id='7' author='perrywang' date='2019-04-26T07:18:06Z'>
		&lt;denchmark-link:https://github.com/calvinjia&gt;@calvinjia&lt;/denchmark-link&gt;
 underFS is oss of aliyun.
&lt;denchmark-h:h1&gt;&lt;/denchmark-h&gt;

Writing to alluxio is good performance for AYSNC_THROUGH and CACHE_THROUGH, but much slower for sync to oss.
And THROUGH is is good performance for sync to oss, but no cache.
		</comment>
		<comment id='8' author='perrywang' date='2020-01-18T01:14:34Z'>
		Closing this issue. Please reopen if there are further questions.
		</comment>
	</comments>
</bug>