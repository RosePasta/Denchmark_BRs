<bug id='9210' author='ZacBlanco' open_date='2019-06-04T23:23:54Z' closed_time='2019-07-02T01:39:12Z'>
	<summary>Alluxio Metrics Don't Report Bytes Written</summary>
	<description>
Alluxio Version:
1.8.1, 2.0.0-RC2
Describe the bug
When we perform write operations using the CLI (or any other means), the Alluxio metrics for Bytes Written and Bytes Written UFS never get incremented in the master at /api/v1/master, /metrics/json as well as ./bin/alluxio fsadmin report metrics
To Reproduce
using MUST_CACHE as the write type:
./bin/alluxio-start.sh local
./bin/alluxio fs copyFromLocal LICENSE /LICENSE
./bin/alluxio fs persist /LICENSE
./bin/alluxio fsadmin report metrics
The metrics report will report no bytes written to Alluxio or the UFS
Expected behavior
The command-line metrics report and the REST endpoints should be reporting the bytes written to Alluxio and/or the UFS. Currently, it always seems to be 0.
Urgency
minor
Additional context
Reported via slack community
	</description>
	<comments>
		<comment id='1' author='ZacBlanco' date='2019-06-05T23:06:32Z'>
		This is because persist is implemented through the job service which write the data through the job worker (as if it were a separate client) and not the Alluxio worker.
To fix this I think we would need to have metrics for job worker tasks and is more of a feature-request than a bug-fix.
If a user runs copyFromLocal with write type CACHE_THROUGH, the UFS metrics will be correctly updated.
		</comment>
		<comment id='2' author='ZacBlanco' date='2019-06-06T01:12:29Z'>
		Thanks for looking into this!
I would disagree in that as it stands, the metric name implies all bytes written to the UFS. It doesn't have any caveats saying it is worker-only vs job worker. I think this is misleading to the user. Under the current definition of the metric it seems like more of a bug.
Either way, thanks for clarifying this. To reiterate in my own words, in order for bytes written to the UFS to be reported, the user must use CACHE_THROUGH or THROUGH write types in order for the metrics to show up?
I'm not sure exactly how you tested either, but my "Bytes written to Alluxio" (not the UFS) also always remained at 0. Were you able to get that number to change?
		</comment>
		<comment id='3' author='ZacBlanco' date='2019-06-06T11:57:22Z'>
		Also, another note I forgot- when I tested I used the v1.8.1 tag that doesn't include the job service. Persist operations were still not incrementing the counter.
		</comment>
		<comment id='4' author='ZacBlanco' date='2019-06-06T13:23:47Z'>
		I can confirm that using write with CACHE_THROUGH updates metrics correctly for the UFSs (v 1.8.1).
		</comment>
		<comment id='5' author='ZacBlanco' date='2019-06-06T18:28:07Z'>
		I think we both agree the metrics should be tracked, the question is whether there should be a separate set of metrics for the job service or if the job service should report metrics back to the master.
Yes, currently the metrics only track data that is written through the Alluxio worker.
I didn't have any Alluxio write metrics because all my writes to Alluxio were short circuit.
In terms of 1.8.1, the persist job is done through the CLI (still a direct write to the UFS). In 1.8.1 you might be able to get both the short circuit and client to ufs write metrics if client metrics are enabled. It is a best effort attempt though.
		</comment>
		<comment id='6' author='ZacBlanco' date='2019-07-02T01:39:12Z'>
		Closing the issue - &lt;denchmark-link:https://github.com/calvinjia&gt;@calvinjia&lt;/denchmark-link&gt;
 please open another issue to provide job service metrics.
		</comment>
	</comments>
</bug>