<bug id='9970' author='gpang' open_date='2019-09-25T18:57:22Z' closed_time='2019-09-25T21:48:30Z'>
	<summary>The Job master has locking inconsistencies which can cause deadlock</summary>
	<description>
Alluxio Version:
This is in the master branch, 2.1.0-SNAPSHOT
Describe the bug
A deadlock can happen in the job master, because of the wrong locking order. Here are the stacks for 2 deadlocked threads.
&lt;denchmark-code&gt;"grpc-default-executor-12":
	at alluxio.master.job.JobCoordinator.updateStatus(JobCoordinator.java:228)
	- waiting to lock &lt;0x00000006ccf6bdb8&gt; (a alluxio.master.job.JobCoordinator)
	at alluxio.master.job.JobCoordinator.updateTasks(JobCoordinator.java:161)
	- locked &lt;0x00000006ccf6bde0&gt; (a alluxio.job.meta.JobInfo)
	at alluxio.master.job.JobMaster.workerHeartbeat(JobMaster.java:322)
"grpc-default-executor-7":
	at alluxio.job.meta.JobInfo.getId(JobInfo.java:92)
	- waiting to lock &lt;0x00000006ccf6bde0&gt; (a alluxio.job.meta.JobInfo)
	at alluxio.job.wire.JobInfo.&lt;init&gt;(JobInfo.java:50)
	at alluxio.master.job.JobCoordinator.getJobInfoWire(JobCoordinator.java:220)
	- locked &lt;0x00000006ccf6bdb8&gt; (a alluxio.master.job.JobCoordinator)
	at alluxio.master.job.JobMaster.getStatus(JobMaster.java:242)
&lt;/denchmark-code&gt;

To Reproduce
Unfortunately, the deadlock is difficult to reliably reproduce. I hit it randomly by running the PersistCommandTest.
Expected behavior
Avoid deadlock.
Urgency
Deadlocks can stall getStatus calls and worker heartbeats, which can stall persist jobs or replication jobs. Deadlocks must be avoid.
	</description>
	<comments>
	</comments>
</bug>