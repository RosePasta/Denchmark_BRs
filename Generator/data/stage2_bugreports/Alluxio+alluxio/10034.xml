<bug id='10034' author='apc999' open_date='2019-10-03T17:58:03Z' closed_time='2020-01-29T22:03:41Z'>
	<summary>PersistJob fails before Hive rename all partitions</summary>
	<description>
Alluxio Version:
2.0.1
Describe the bug
I have a table with a single partition to write with ASYNC_THROUGH. Note that, alluxio.user.file.persist.on.rename=false in this case.
Jobmaster receives the request to persist this partition:
&lt;denchmark-code&gt;2019-10-03 17:48:56,085 INFO  job.JobCoordinator (JobCoordinator.java:start) - Starting job PersistConfig{filePath=/output/.hive-staging_hive_2019-10-03_17-47-48_399_1699906638721347161-1/_tmp.-ext-10000/dt=2019-08-14/step_check=false/000000_0, mountId=8801998891598281230, overwrite=false, ufsPath=s3://apc999/emr/output/.hive-staging_hive_2019-10-03_17-47-48_399_1699906638721347161-1/_tmp.-ext-10000/dt=2019-08-14/step_check=false/000000_0}
&lt;/denchmark-code&gt;

FileSystemMaster fails to rename
&lt;denchmark-code&gt;2019-10-03 17:48:58,931 WARN  DefaultFileSystemMaster - The persist job (id=1570124813327) for file /output/.hive-staging_hive_2019-10-03_17-47-48_399_1699906638721347161-1/_tmp.-ext-10000/dt=2019-08-14/step_check=false/000000_0 (id=16810770431) failed: Task execution failed: Path "/output/.hive-staging_hive_2019-10-03_17-47-48_399_1699906638721347161-1/_tmp.-ext-10000" does not exist.
&lt;/denchmark-code&gt;

Job master receives the updated PersistJob as a retry and this time it works (no more error on Master side)
&lt;denchmark-code&gt;2019-10-03 17:48:56,360 INFO  job.JobCoordinator (JobCoordinator.java:start) - Starting job PersistConfig{filePath=/output/.hive-staging_hive_2019-10-03_17-47-48_399_1699906638721347161-1/-ext-10001/tmpstats-0, mountId=8801998891598281230, overwrite=false, ufsPath=s3://apc999/emr/output/.hive-staging_hive_2019-10-03_17-47-48_399_1699906638721347161-1/-ext-10001/tmpstats-0}
2019-10-03 17:48:59,950 INFO  job.JobCoordinator (JobCoordinator.java:start) - Starting job PersistConfig{filePath=/output/dt=2019-08-14/step_check=false/000000_0, mountId=8801998891598281230, overwrite=false, ufsPath=s3://apc999/emr/output/dt=2019-08-14/step_check=false/000000_0}
&lt;/denchmark-code&gt;

To Reproduce
&lt;denchmark-code&gt;INSERT OVERWRITE TABLE mid_output_alluxio_alluxio PARTITION (dt, step_check)
SELECT * from mid_input_alluxio;
&lt;/denchmark-code&gt;

Expected behavior
Urgency
Additional context
	</description>
	<comments>
		<comment id='1' author='apc999' date='2019-10-09T20:35:25Z'>
		&lt;denchmark-link:https://github.com/calvinjia&gt;@calvinjia&lt;/denchmark-link&gt;
 &lt;denchmark-link:https://github.com/bradyoo&gt;@bradyoo&lt;/denchmark-link&gt;
  - will this be addressed by the cleanup being done for job service?
		</comment>
		<comment id='2' author='apc999' date='2019-10-10T18:44:20Z'>
		&lt;denchmark-link:https://github.com/apc999&gt;@apc999&lt;/denchmark-link&gt;
 What is the expected behavior, should we look into the initial error and avoid failing the first time?
		</comment>
		<comment id='3' author='apc999' date='2020-01-17T21:49:06Z'>
		&lt;denchmark-link:https://github.com/bradyoo&gt;@bradyoo&lt;/denchmark-link&gt;

&lt;denchmark-link:https://github.com/apc999&gt;@apc999&lt;/denchmark-link&gt;
 has this been addressed by the cleanup for the job service?
		</comment>
		<comment id='4' author='apc999' date='2020-01-20T17:10:42Z'>
		This likely has nothing to do with the cleanup of the job service.
&lt;denchmark-link:#&gt;…&lt;/denchmark-link&gt;


On Fri, Jan 17, 2020 at 1:49 PM David Zhu ***@***.***&gt; wrote:
 @bradyoo &lt;https://github.com/bradyoo&gt;
 @apc999 &lt;https://github.com/apc999&gt; has this been addressed by the
 cleanup for the job service?

 —
 You are receiving this because you were mentioned.
 Reply to this email directly, view it on GitHub
 &lt;#10034?email_source=notifications&amp;email_token=AAC4S6OLJWLRE6MZX3WBMVLQ6IRVHA5CNFSM4I5GJ7LKYY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOEJJCFOQ#issuecomment-575808186&gt;,
 or unsubscribe
 &lt;https://github.com/notifications/unsubscribe-auth/AAC4S6MAMBW5UIOEXDUL57DQ6IRVHANCNFSM4I5GJ7LA&gt;
 .



		</comment>
		<comment id='5' author='apc999' date='2020-01-29T22:03:41Z'>
		&lt;denchmark-link:https://github.com/apc999&gt;@apc999&lt;/denchmark-link&gt;
  - if this is still an issue, please re-open.
		</comment>
	</comments>
</bug>