<bug id='9331' author='cheyang' open_date='2019-06-19T01:08:07Z' closed_time='2019-06-19T13:08:26Z'>
	<summary>Failed to deploy alluxio 2.0 snapshot in kubernetes</summary>
	<description>
Alluxio Version:
docker image: 2.0.0-SNAPSHOT/52655300b53a
Describe the bug
A clear and concise description of what the bug is.
I'm trying to deploy latest alluxio version in kubernetes. But it's failed, and master reported
&lt;denchmark-code&gt;2019-06-19 00:52:55,091 ERROR ProcessUtils - Uncaught exception while running Alluxio master @alluxio-master:19998, stopping it and exiting.
java.io.IOException: Failed to bootstrap raft cluster with addresses [alluxio-master:19200]: java.nio.channels.UnresolvedAddressException
	at alluxio.master.journal.raft.RaftJournalSystem.startInternal(RaftJournalSystem.java:490)
	at alluxio.master.journal.AbstractJournalSystem.start(AbstractJournalSystem.java:50)
	at alluxio.master.FaultTolerantAlluxioMasterProcess.start(FaultTolerantAlluxioMasterProcess.java:72)
	at alluxio.ProcessUtils.run(ProcessUtils.java:35)
	at alluxio.master.AlluxioMaster.main(AlluxioMaster.java:55)
Caused by: java.nio.channels.UnresolvedAddressException
	at sun.nio.ch.Net.checkAddress(Net.java:101)
	at sun.nio.ch.ServerSocketChannelImpl.bind(ServerSocketChannelImpl.java:218)
	at io.netty.channel.socket.nio.NioServerSocketChannel.doBind(NioServerSocketChannel.java:130)
	at io.netty.channel.AbstractChannel$AbstractUnsafe.bind(AbstractChannel.java:558)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.bind(DefaultChannelPipeline.java:1358)
	at io.netty.channel.AbstractChannelHandlerContext.invokeBind(AbstractChannelHandlerContext.java:501)
	at io.netty.channel.AbstractChannelHandlerContext.bind(AbstractChannelHandlerContext.java:486)
	at io.netty.handler.logging.LoggingHandler.bind(LoggingHandler.java:191)
	at io.netty.channel.AbstractChannelHandlerContext.invokeBind(AbstractChannelHandlerContext.java:501)
	at io.netty.channel.AbstractChannelHandlerContext.bind(AbstractChannelHandlerContext.java:486)
	at io.netty.channel.DefaultChannelPipeline.bind(DefaultChannelPipeline.java:1019)
	at io.netty.channel.AbstractChannel.bind(AbstractChannel.java:254)
&lt;/denchmark-code&gt;

I suspect somewhere should configure to address 0.0.0.0.
To Reproduce
I will attach the yaml to upload.
Expected behavior
A clear and concise description of what you expected to happen.
Urgency
Describe the impact and urgency of the bug.
Additional context
Add any other context about the problem here.
	</description>
	<comments>
		<comment id='1' author='cheyang' date='2019-06-19T01:10:24Z'>
		The yaml I'm using to deploy here:
&lt;denchmark-link:https://github.com/Alluxio/alluxio/files/3303989/master-format.txt&gt;master-format.txt&lt;/denchmark-link&gt;

&lt;denchmark-link:https://github.com/Alluxio/alluxio/files/3303992/worker-format.txt&gt;worker-format.txt&lt;/denchmark-link&gt;

&lt;denchmark-link:https://github.com/Alluxio/alluxio/files/3303993/alluxio.txt&gt;alluxio.txt&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='cheyang' date='2019-06-19T01:11:33Z'>
		/assign &lt;denchmark-link:https://github.com/madanadit&gt;@madanadit&lt;/denchmark-link&gt;

		</comment>
		<comment id='3' author='cheyang' date='2019-06-19T02:58:44Z'>
		The interesting thing is that I'm able to set environment variables successfully, but looks like it's not consumed by alluxio master.
&lt;denchmark-code&gt;bash-4.4# /opt/alluxio/bin/alluxio  getConf | grep master| grep jou| grep type

alluxio.master.journal.type=EMBEDDED
bash-4.4#
bash-4.4# env | grep MASTER
ALLUXIO_MASTER_JOURNAL_FOLDER=/journal
ALLUXIO_MASTER_JOURNAL_TYPE=UFS
ALLUXIO_MASTER_PORT=19998
ALLUXIO_MASTER_WEB_PORT=19999
ALLUXIO_MASTER_HOSTNAME=alluxio-master
&lt;/denchmark-code&gt;

		</comment>
		<comment id='4' author='cheyang' date='2019-06-19T12:09:41Z'>
		The master can start successfully. but the workers are still not able to start. I can see the environment variables ALLUXIO_JAVA_OPT are set successfully, but the alluxio worker seems not able to load it.
&lt;denchmark-code&gt;bash-4.4# env | grep -i master
ALLUXIO_JAVA_OPT=-Dalluxio.master.hostname=alluxio-master -Dalluxio.master.journal.type=UFS -Dalluxio.master.journal.folder=/journal -Dalluxio.worker.data.server.domain.socket.address=/opt/domain -Dalluxio.worker.data.server.domain.socket.as.uuid=true -Dalluxio.master.port=19998 -Dalluxio.master.web.port=19999 -Dalluxio.worker.port=29998 -Dalluxio.worker.data.port=29999 -Dalluxio.worker.web.port=29996 -Dalluxio.worker.memory.size=16GB -Dalluxio.security.stale.channel.purge.interval=365d -Dalluxio.worker.tieredstore.level0.alias=SSD -Dalluxio.worker.tieredstore.level0.dirs.path=/var/lib/docker/alluxio -Dalluxio.worker.tieredstore.level0.dirs.quota=500GB -Dalluxio.worker.tieredstore.level0.watermark.high.ratio=0.9 -Dalluxio.worker.tieredstore.level0.watermark.low.ratio=0.7
bash-4.4# /entrypoint.sh worker-only
Formatting Alluxio Worker @ iZhp3i15msyqpeqtzv9h0wZ
2019-06-19 11:57:31,405 INFO  Format - Formatting worker data folder: /alluxioworker/
2019-06-19 11:57:31,406 INFO  Format - Formatting Data path for tier 0:/dev/shm/alluxioworker
2019-06-19 11:57:31,491 INFO  Format - Formatting complete
2019-06-19 11:57:32,416 ERROR AlluxioWorker - Fatal error: Cannot run Alluxio worker; Unable to determine master address. Please modify alluxio-site.properties to either set alluxio.master.hostname, configure zookeeper with alluxio.zookeeper.enabled=true and alluxio.zookeeper.address=[comma-separated zookeeper master addresses], or utilize internal HA by setting alluxio.master.embedded.journal.addresses=[comma-separated alluxio master addresses]
&lt;/denchmark-code&gt;

		</comment>
		<comment id='5' author='cheyang' date='2019-06-19T13:09:26Z'>
		Thanks &lt;denchmark-link:https://github.com/mingfang&gt;@mingfang&lt;/denchmark-link&gt;
,  I'm able to get it work now.
		</comment>
		<comment id='6' author='cheyang' date='2019-09-05T04:38:39Z'>
		Hi &lt;denchmark-link:https://github.com/cheyang&gt;@cheyang&lt;/denchmark-link&gt;
 ,
I am getting the same deployment error on kubernetes. How did you work it around? Thanks.
		</comment>
	</comments>
</bug>