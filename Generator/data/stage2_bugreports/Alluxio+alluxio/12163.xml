<bug id='12163' author='TrafalgarZZZ' open_date='2020-09-29T09:40:24Z' closed_time='2020-11-16T16:38:31Z'>
	<summary>WorkerOutOfSpaceException when setting max_readahead=0 with Alluxio JNI Fuse</summary>
	<description>

What version of Alluxio are you using?
&lt;denchmark-link:https://github.com/cheyang/alluxio/tree/branch-2.3-fuse-pod-for-non-root&gt;https://github.com/cheyang/alluxio/tree/branch-2.3-fuse-pod-for-non-root&lt;/denchmark-link&gt;

Describe the bug
A clear and concise description of what the bug is.
I started Alluxio with Alluxio JNI fuse on a 4-node k8s cluster. And my fuse opts are:
&lt;denchmark-code&gt;2020-09-29 05:46:31,172 INFO  AlluxioFuse - Mounting AlluxioJniFuseFileSystem: mount point="/alluxio-mnt/default/imagenet/alluxio-fuse", OPTIONS="[-obig_writes, -okernel_cache, -oro, -omax_read=131072, -omax_readahead=0, -oattr_timeout=7200, -oentry_timeout=7200, -ononempty, -oallow_other, -omax_write=131072]"
&lt;/denchmark-code&gt;

When I run my ResNet50 job reading ImageNet dataset through Alluxio JNI Fuse, I got the following exceptions:
In alluxio-fuse pod:
&lt;denchmark-code&gt;....
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
2020-09-29 05:55:32,450 INFO  AlluxioJniFuseFileSystem - read: cached 0 bytes, missed 0 bytes, ratio 0.0
2020-09-29 05:55:34,264 WARN  AlluxioFileInStream - Failed to close input stream for block 3875536896: Timeout waiting for response after 30000ms. (Zero Copy GrpcDataReader)
2020-09-29 05:55:35,241 WARN  AlluxioJniFuseFileSystem - read(path=/imagenet/imagenet/train/train-00835-of-01024,buf=java.nio.DirectByteBuffer[pos=4096 lim=4096 cap=4096],size=4096,offset=0) returned 4096 in 112442 ms (&gt;=1000 ms)
2020-09-29 05:55:36,297 WARN  AlluxioJniFuseFileSystem - read(path=/imagenet/imagenet/train/train-00368-of-01024,buf=java.nio.DirectByteBuffer[pos=4096 lim=4096 cap=4096],size=4096,offset=16777216) returned 4096 in 3940 ms (&gt;=1000 ms)
2020-09-29 05:55:40,438 ERROR ResourceLeakDetector - LEAK: ByteBuf.release() was not called before it's garbage-collected. See https://netty.io/wiki/reference-counted-objects.html for more information.
Recent access records: 
Created at:
	io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:349)
	io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:187)
	io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:178)
	io.netty.buffer.AbstractByteBufAllocator.buffer(AbstractByteBufAllocator.java:115)
	io.netty.handler.codec.ByteToMessageDecoder.expandCumulation(ByteToMessageDecoder.java:529)
	io.netty.handler.codec.ByteToMessageDecoder$1.cumulate(ByteToMessageDecoder.java:97)
	io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:274)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:377)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:363)
	io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:355)
	io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:377)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:363)
	io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:792)
	io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe$1.run(AbstractEpollChannel.java:387)
	io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:164)
	io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:472)
	io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:384)
	io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)
	io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	java.lang.Thread.run(Thread.java:748)
2020-09-29 05:55:40,439 ERROR ResourceLeakDetector - LEAK: ByteBuf.release() was not called before it's garbage-collected. See https://netty.io/wiki/reference-counted-objects.html for more information.
Recent access records: 
Created at:
	io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:349)
	io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:187)
	io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:178)
	io.netty.buffer.AbstractByteBufAllocator.buffer(AbstractByteBufAllocator.java:115)
	io.netty.handler.codec.ByteToMessageDecoder.expandCumulation(ByteToMessageDecoder.java:529)
	io.netty.handler.codec.ByteToMessageDecoder$1.cumulate(ByteToMessageDecoder.java:97)
	io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:274)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:377)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:363)
	io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:355)
	io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:377)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:363)
	io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:792)
	io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:475)
	io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378)
	io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)
	io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	java.lang.Thread.run(Thread.java:748)
2020-09-29 05:55:41,777 WARN  AlluxioFileInStream - Failed to close input stream for block 6979321856: Timeout waiting for response after 30000ms. (Zero Copy GrpcDataReader)
2020-09-29 05:55:41,779 ERROR AlluxioJniFuseFileSystem - Failed to read /imagenet/imagenet/train/train-00981-of-01024,4096,0: 
alluxio.exception.status.DeadlineExceededException: Timeout waiting for response after 30000ms. (Zero Copy GrpcDataReader)
	at alluxio.client.block.stream.GrpcBlockingStream.receive(GrpcBlockingStream.java:159)
	at alluxio.client.block.stream.GrpcDataMessageBlockingStream.receiveDataMessage(GrpcDataMessageBlockingStream.java:84)
	at alluxio.client.block.stream.GrpcDataReader.readChunk(GrpcDataReader.java:129)
	at alluxio.client.block.stream.BlockInStream.readChunk(BlockInStream.java:392)
	at alluxio.client.block.stream.BlockInStream.readInternal(BlockInStream.java:268)
	at alluxio.client.block.stream.BlockInStream.read(BlockInStream.java:264)
	at alluxio.client.file.AlluxioFileInStream.read(AlluxioFileInStream.java:187)
	at alluxio.fuse.AlluxioJniFuseFileSystem.readInternal(AlluxioJniFuseFileSystem.java:350)
	at alluxio.fuse.AlluxioJniFuseFileSystem.lambda$read$4(AlluxioJniFuseFileSystem.java:322)
	at alluxio.fuse.AlluxioFuseUtils.call(AlluxioFuseUtils.java:276)
	at alluxio.fuse.AlluxioJniFuseFileSystem.read(AlluxioJniFuseFileSystem.java:322)
	at alluxio.jnifuse.AbstractFuseFileSystem.readCallback(AbstractFuseFileSystem.java:150)
2020-09-29 05:55:41,784 WARN  AlluxioJniFuseFileSystem - read(path=/imagenet/imagenet/train/train-00981-of-01024,buf=java.nio.DirectByteBuffer[pos=0 lim=4096 cap=4096],size=4096,offset=0) returned -5 in 120068 ms (&gt;=1000 ms)
2020-09-29 05:55:41,786 INFO  AlluxioJniFuseFileSystem - release(fd=43,entries=240)
2020-09-29 05:55:41,799 WARN  AlluxioFileInStream - Failed to close input stream for block 9193914368: Timeout waiting for response after 30000ms. (Zero Copy GrpcDataReader)
2020-09-29 05:55:41,800 ERROR AlluxioJniFuseFileSystem - Failed to read /imagenet/imagenet/train/train-00572-of-01024,4096,0: 
alluxio.exception.status.DeadlineExceededException: Timeout waiting for response after 30000ms. (Zero Copy GrpcDataReader)
	at alluxio.client.block.stream.GrpcBlockingStream.receive(GrpcBlockingStream.java:159)
	at alluxio.client.block.stream.GrpcDataMessageBlockingStream.receiveDataMessage(GrpcDataMessageBlockingStream.java:84)
	at alluxio.client.block.stream.GrpcDataReader.readChunk(GrpcDataReader.java:129)
	at alluxio.client.block.stream.BlockInStream.readChunk(BlockInStream.java:392)
	at alluxio.client.block.stream.BlockInStream.readInternal(BlockInStream.java:268)
	at alluxio.client.block.stream.BlockInStream.read(BlockInStream.java:264)
	at alluxio.client.file.AlluxioFileInStream.read(AlluxioFileInStream.java:187)
	at alluxio.fuse.AlluxioJniFuseFileSystem.readInternal(AlluxioJniFuseFileSystem.java:350)
	at alluxio.fuse.AlluxioJniFuseFileSystem.lambda$read$4(AlluxioJniFuseFileSystem.java:322)
	at alluxio.fuse.AlluxioFuseUtils.call(AlluxioFuseUtils.java:276)
	at alluxio.fuse.AlluxioJniFuseFileSystem.read(AlluxioJniFuseFileSystem.java:322)
	at alluxio.jnifuse.AbstractFuseFileSystem.readCallback(AbstractFuseFileSystem.java:150)
2020-09-29 05:55:41,800 WARN  AlluxioFileInStream - Failed to close input stream for block 13404995584: Timeout waiting for response after 30000ms. (Zero Copy GrpcDataReader)
2020-09-29 05:55:41,800 WARN  AlluxioJniFuseFileSystem - read(path=/imagenet/imagenet/train/train-00572-of-01024,buf=java.nio.DirectByteBuffer[pos=0 lim=4096 cap=4096],size=4096,offset=0) returned -5 in 120067 ms (&gt;=1000 ms)
2020-09-29 05:55:41,800 ERROR AlluxioJniFuseFileSystem - Failed to read /imagenet/imagenet/train/train-00840-of-01024,4096,0: 
alluxio.exception.status.DeadlineExceededException: Timeout waiting for response after 30000ms. (Zero Copy GrpcDataReader)
	at alluxio.client.block.stream.GrpcBlockingStream.receive(GrpcBlockingStream.java:159)
	at alluxio.client.block.stream.GrpcDataMessageBlockingStream.receiveDataMessage(GrpcDataMessageBlockingStream.java:84)
	at alluxio.client.block.stream.GrpcDataReader.readChunk(GrpcDataReader.java:129)
	at alluxio.client.block.stream.BlockInStream.readChunk(BlockInStream.java:392)
	at alluxio.client.block.stream.BlockInStream.readInternal(BlockInStream.java:268)
	at alluxio.client.block.stream.BlockInStream.read(BlockInStream.java:264)
	at alluxio.client.file.AlluxioFileInStream.read(AlluxioFileInStream.java:187)
	at alluxio.fuse.AlluxioJniFuseFileSystem.readInternal(AlluxioJniFuseFileSystem.java:350)
	at alluxio.fuse.AlluxioJniFuseFileSystem.lambda$read$4(AlluxioJniFuseFileSystem.java:322)
	at alluxio.fuse.AlluxioFuseUtils.call(AlluxioFuseUtils.java:276)
	at alluxio.fuse.AlluxioJniFuseFileSystem.read(AlluxioJniFuseFileSystem.java:322)
	at alluxio.jnifuse.AbstractFuseFileSystem.readCallback(AbstractFuseFileSystem.java:150)
2020-09-29 05:55:41,800 WARN  AlluxioJniFuseFileSystem - read(path=/imagenet/imagenet/train/train-00840-of-01024,buf=java.nio.DirectByteBuffer[pos=0 lim=4096 cap=4096],size=4096,offset=0) returned -5 in 120073 ms (&gt;=1000 ms)
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
2020-09-29 05:55:41,838 INFO  AlluxioJniFuseFileSystem - read: cached 0 bytes, missed 0 bytes, ratio 0.0
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
fuse: max_idle_threads: 10
2020-09-29 05:55:41,909 INFO  AlluxioJniFuseFileSystem - read: cached 0 bytes, missed 0 bytes, ratio 0.0
....
&lt;/denchmark-code&gt;

In alluxio-worker pod, I got so many WorkerOutOfSpaceException:
&lt;denchmark-code&gt;2020-09-29 05:53:57,114 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,123 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,124 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 16055795712, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00035-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 16055795712
2020-09-29 05:53:57,124 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,127 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,130 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 14831058944, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00843-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 14831058944
2020-09-29 05:53:57,131 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,131 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,131 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 8975810560, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00074-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 8975810560
2020-09-29 05:53:57,131 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,131 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,132 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 4378853376, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00323-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 4378853376
2020-09-29 05:53:57,132 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,132 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,132 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 8959033344, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00674-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 8959033344
2020-09-29 05:53:57,132 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,132 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,132 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 10301210624, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00828-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 10301210624
2020-09-29 05:53:57,132 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,132 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,133 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 6694109184, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00469-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 6694109184
2020-09-29 05:53:57,133 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,133 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,133 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 6509559808, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00324-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 6509559808
2020-09-29 05:53:57,133 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,133 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,133 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 4546625536, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00530-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 4546625536
2020-09-29 05:53:57,133 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,133 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,133 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 1610612736, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00958-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 1610612736
2020-09-29 05:53:57,134 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,134 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,134 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 2113929216, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00321-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 2113929216
2020-09-29 05:53:57,134 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0
2020-09-29 05:53:57,134 ERROR TieredBlockStore - Allocation failure. Options: AllocateOptions{Location=BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;}, Size=335544320, ForceLocation=false, EvictionAllowed=true, UseReservedSpace=false}. Error: alluxio.exception.WorkerOutOfSpaceException: Failed to free 335544320 bytes space at location 
2020-09-29 05:53:57,134 WARN  UnderFileSystemBlockReader - Failed to update block writer for UFS block [blockId: 3472883712, ufsPath: /underFSStorage/imagenet/imagenet/train/train-00659-of-01024, offset: 0]: Failed to allocate 335544320 bytes on BlockStoreLocation{TierAlias=MEM, DirIndex=&lt;Any&gt;, MediumType=&lt;Any&gt;} to create blockId 3472883712
&lt;/denchmark-code&gt;

However, when I check my tierstore capacity, it seems far from full:
&lt;denchmark-code&gt;$ alluxio fsadmin report capacity
Worker Name      Last Heartbeat   Storage       MEM
192.168.1.15     0                capacity      50.00GB
                                  used          10.07GB (20%)
192.168.1.17     0                capacity      50.00GB
                                  used          6.25GB (12%)
192.168.1.11     0                capacity      50.00GB
                                  used          9.98GB (19%)
192.168.1.16     0                capacity      50.00GB
                                  used          4896.00MB (9%)
&lt;/denchmark-code&gt;

All the logs are here:
&lt;denchmark-link:https://github.com/Alluxio/alluxio/files/5297939/diagnose_fluid_1601359323.tar.gz&gt;diagnose_fluid_1601359323.tar.gz&lt;/denchmark-link&gt;

To Reproduce
Steps to reproduce the behavior (as minimally and precisely as possible)
Setup a UFS with large dataset like ImageNet, mount it onto Alluxio, and setup Alluxio JNI Fuse with the options mentioned above. This may reproduce the problem.
Expected behavior
A clear and concise description of what you expected to happen.
Everything works fine and no WorkerOutOfSpaceException
Urgency
Describe the impact and urgency of the bug.
Additional context
Add any other context about the problem here.
	</description>
	<comments>
		<comment id='1' author='TrafalgarZZZ' date='2020-09-29T16:53:11Z'>
		&lt;denchmark-link:https://github.com/calvinjia&gt;@calvinjia&lt;/denchmark-link&gt;
 it seems related to eviction failure in the new tiered storage. any insights?
		</comment>
		<comment id='2' author='TrafalgarZZZ' date='2020-10-06T02:03:30Z'>
		&lt;denchmark-link:https://github.com/TrafalgarZZZ&gt;@TrafalgarZZZ&lt;/denchmark-link&gt;
 &lt;denchmark-link:https://github.com/cheyang&gt;@cheyang&lt;/denchmark-link&gt;
  is this issue happening deterministic?
		</comment>
		<comment id='3' author='TrafalgarZZZ' date='2020-10-06T04:26:45Z'>
		&lt;denchmark-link:https://github.com/apc999&gt;@apc999&lt;/denchmark-link&gt;
 Yes, in our case it is.
		</comment>
		<comment id='4' author='TrafalgarZZZ' date='2020-11-11T00:42:30Z'>
		A summary for the given log
Fuse - Failed to read block, Timeout waiting for response
Main problem is on worker side:
&lt;denchmark-code&gt;UnderFileSystemBlockReader.updateBlockWriter
-- TierBlockStore.createBlock()
  --  TierBlockStore.createBlockMetaIntenral
     -- TieredBlockStore.allocateSpace -- Allocation failure
	   -- call freeSpace -- freeSpaceInternal 
          !contiguousSpaceFound || !availableBytesFound -- failed to free space
&lt;/denchmark-code&gt;

Worker A and B:
&lt;denchmark-code&gt;A bunch of 
TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 0, Blocks removed: 0, Space freed: 0  * 83   Blocks iterated all equal to 0

2020-09-29 05:53:58,869 WARN  UnderFileSystemBlockReader - Failed to cache data read from UFS (on transferTo()): Can't reserve more space for block: 5016387584 under session: 3285915866849351556.
Sep 29, 2020 5:56:12 AM io.grpc.netty.NettyServerHandler onStreamError
WARNING: Stream Error
io.netty.handler.codec.http2.Http2Exception$StreamException: Received DATA frame for an unknown stream 17
2020-09-29 05:56:25,674 ERROR TieredBlockStore - Failed to free space. Min contiguous requested: 335544320, Min available requested: 335544320, Blocks iterated: 15, Blocks removed: 15, Space freed: 251658240

and then a bunch of TieredBlockStore - Failed to free space. Blocks iterated: 0

Sep 29, 2020 5:56:32 AM io.grpc.netty.NettyServerHandler onStreamError
WARNING: Stream Error
io.netty.handler.codec.http2.Http2Exception$StreamException: Received DATA frame for an unknown stream 5
A bunch of onStreamError at the end of logs
&lt;/denchmark-code&gt;

Worker C and D
&lt;denchmark-code&gt; a bunch of TieredBlockStore - Failed to free space. Blocks iterated: 0

Sep 29, 2020 5:55:43 AM io.grpc.netty.NettyServerHandler onStreamError
WARNING: Stream Error
io.netty.handler.codec.http2.Http2Exception$StreamException: Received DATA frame for an unknown stream 5
Sep 29, 2020 5:58:54 AM io.grpc.netty.NettyServerHandler onStreamError
WARNING: Stream Error
io.netty.handler.codec.http2.Http2Exception$StreamException: Received DATA frame for an unknown stream 15

and end of log.
&lt;/denchmark-code&gt;

no much info found in the logs
		</comment>
		<comment id='5' author='TrafalgarZZZ' date='2020-11-13T05:13:49Z'>
		Update:
logs collected from latest Alluxio on branch (commit id &lt;denchmark-link:https://github.com/Alluxio/alluxio/commit/238b7eb3ec58270aabf7004ac01cc89e6034b93e&gt;238b7eb&lt;/denchmark-link&gt;
)
&lt;denchmark-link:https://github.com/Alluxio/alluxio/files/5534869/diagnose_fluid_1605149361.tar.gz&gt;diagnose_fluid_1605149361.tar.gz&lt;/denchmark-link&gt;

		</comment>
		<comment id='6' author='TrafalgarZZZ' date='2020-11-13T22:32:57Z'>
		with more analysis, I believe this is due to the value of  set too high
Fixed by a commit in branch-2.3-fuse
&lt;denchmark-link:https://github.com/Alluxio/alluxio/commit/2c412267e0e749ced63262d53043cf753cc11927&gt;2c41226&lt;/denchmark-link&gt;

&lt;denchmark-link:https://github.com/TrafalgarZZZ&gt;@TrafalgarZZZ&lt;/denchmark-link&gt;
  and &lt;denchmark-link:https://github.com/LuQQiu&gt;@LuQQiu&lt;/denchmark-link&gt;
  please give it a try and update it here.
		</comment>
		<comment id='7' author='TrafalgarZZZ' date='2020-11-16T16:38:31Z'>
		The commit &lt;denchmark-link:https://github.com/Alluxio/alluxio/commit/2c412267e0e749ced63262d53043cf753cc11927&gt;2c41226&lt;/denchmark-link&gt;
 fixed this problem. I'll close this issue.
&lt;denchmark-link:https://github.com/apc999&gt;@apc999&lt;/denchmark-link&gt;
 &lt;denchmark-link:https://github.com/LuQQiu&gt;@LuQQiu&lt;/denchmark-link&gt;
 Thanks for your help!
		</comment>
	</comments>
</bug>