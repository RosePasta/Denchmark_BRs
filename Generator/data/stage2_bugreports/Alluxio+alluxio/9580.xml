<bug id='9580' author='zrss' open_date='2019-07-29T10:24:16Z' closed_time='2019-07-30T14:30:33Z'>
	<summary>Can Alluxio 2.0.0 works well in k8s ?</summary>
	<description>
Alluxio Version:
What version of Alluxio are you using?
tag v2.0.0
Describe the bug
A clear and concise description of what the bug is.
we can define the env in configmap in alluxio 1.8 but how can we do it in alluxio 2.0 ?
i don't suppose this can work ...



alluxio/integration/kubernetes/conf/alluxio.properties.template


         Line 12
      in
      29a7c86






 ALLUXIO_JAVA_OPTS=-Dalluxio.master.hostname=alluxio-master -Dalluxio.master.journal.type=UFS -Dalluxio.master.journal.folder=/journal -Dalluxio.master.mount.table.root.ufs=&lt;under_storage_address&gt; -Dalluxio.worker.data.server.domain.socket.address=/opt/domain -Dalluxio.worker.data.server.domain.socket.as.uuid=true -Dalluxio.worker.memory.size=1GB -Dalluxio.master.rpc.port=19998 -Dalluxio.master.web.port=19999 -Dalluxio.worker.rpc.port=29999 -Dalluxio.worker.web.port=29996 -Daws.accessKeyId=&lt;s3a_access_key&gt; -Daws.secretKey=&lt;s3a_secret_key&gt; 





	</description>
	<comments>
		<comment id='1' author='zrss' date='2019-07-29T17:19:21Z'>
		Hi &lt;denchmark-link:https://github.com/zrss&gt;@zrss&lt;/denchmark-link&gt;
 Have you read our doc on deploying on K8s?
&lt;denchmark-link:https://docs.alluxio.io/os/user/stable/en/deploy/Running-Alluxio-On-Kubernetes.html#configure-alluxio-properties&gt;https://docs.alluxio.io/os/user/stable/en/deploy/Running-Alluxio-On-Kubernetes.html#configure-alluxio-properties&lt;/denchmark-link&gt;

Is there something with this solution that doesn't allow you to configure Alluxio properly in your given use case? Any extra context helps
		</comment>
		<comment id='2' author='zrss' date='2019-07-29T18:43:13Z'>
		thx zac. i have read this doc, and it turns out that it's very hard to understand these words. finally i make it work by define properties directly in alluxio-site.properties rather than env in alluxio-site.properties
&lt;denchmark-code&gt;alluxio.master.mount.table.root.ufs=&lt;under_storage_address&gt;
&lt;/denchmark-code&gt;

and obviously, the default value of alluxio-site.properties in integration/docker doesn't work due to the entrypoint impl



alluxio/integration/docker/entrypoint.sh


        Lines 49 to 75
      in
      29a7c86






 # List of environment variables which go in alluxio-env.sh instead of 



 # alluxio-site.properties 



 alluxio_env_vars=( 



   ALLUXIO_CLASSPATH 



   ALLUXIO_HOSTNAME 



   ALLUXIO_JARS 



   ALLUXIO_JAVA_OPTS 



   ALLUXIO_MASTER_JAVA_OPTS 



   ALLUXIO_PROXY_JAVA_OPTS 



   ALLUXIO_RAM_FOLDER 



   ALLUXIO_USER_JAVA_OPTS 



   ALLUXIO_WORKER_JAVA_OPTS 



   ALLUXIO_JOB_MASTER_JAVA_OPTS 



   ALLUXIO_JOB_WORKER_JAVA_OPTS 



 ) 



 



 function writeConf { 



 local IFS=$'\n' # split by line instead of space 



 for keyvaluepair in $(env); do 



 # split around the first "=" 



     key=$(echo ${keyvaluepair} | cut -d= -f1) 



     value=$(echo ${keyvaluepair} | cut -d= -f2-) 



 if [[ "${alluxio_env_vars[*]}" =~ "${key}" ]]; then 



 echo "export ${key}=\"${value}\"" &gt;&gt; conf/alluxio-env.sh 



 fi 



 done 



 } 





it won't generate the alluxio-site.properties file and neither do a effective alluxio-env.sh, if u create the configmap by
&lt;denchmark-code&gt;kubectl create configmap alluxio-config --from-env-file=conf/alluxio.properties
&lt;/denchmark-code&gt;

		</comment>
		<comment id='3' author='zrss' date='2019-07-29T21:36:46Z'>
		Is there a specific sentence(s) that are hard to understand or that you would like to see changed?
Setting values directly in site properties can work, but using the master/worker templates along with the configmap command should be easier to use than defining site properties across many containers.
Also, the documentation for k8s has been recently updated as we've added a helm chart in master branch. The instructions for non-helm deployment with kubectl has also been updated. Could you take a look at the latest version and let us know if it is more helpful?
&lt;denchmark-link:https://docs.alluxio.io/os/user/edge/en/deploy/Running-Alluxio-On-Kubernetes.html#using-kubectl&gt;https://docs.alluxio.io/os/user/edge/en/deploy/Running-Alluxio-On-Kubernetes.html#using-kubectl&lt;/denchmark-link&gt;

		</comment>
	</comments>
</bug>