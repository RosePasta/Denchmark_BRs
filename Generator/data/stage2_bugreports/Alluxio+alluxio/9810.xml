<bug id='9810' author='thereisnospoon' open_date='2019-08-30T14:58:12Z' closed_time='2019-12-19T19:44:56Z'>
	<summary>Alluxio worker fails to start when using multiple storage media in single tier on EMR</summary>
	<description>
Alluxio Version:
2.0
Describe the bug
When using alluxio-emr.sh script and trying to configure Alluxio to use both ramdisk and hard drive workers fail to start.
To Reproduce
I'm using the following properties to configure Alluxio to use both ramdisk and hard disk for storage:
&lt;denchmark-code&gt;alluxio.worker.memory.size=20GB
alluxio.worker.tieredstore.level0.alias=MEM
alluxio.worker.tieredstore.level0.dirs.path=/mnt/ramdisk,/mnt
alluxio.worker.tieredstore.level0.dirs.quota=16GB,350GB
alluxio.worker.tieredstore.levels=1
&lt;/denchmark-code&gt;

The ramdisk is being mounted using: /opt/alluxio/bin/alluxio-mount.sh SudoMount local
After that when I try starting a worker using sudo runuser -l alluxio -c "/opt/alluxio/bin/alluxio-start.sh -a worker" it gives an error:
ERROR: Ramdisk /mnt/ramdisk,/mnt is not mounted with mount option NoMount. Use alluxio-mount.sh to mount ramdisk.
Expected behavior
It should be possible to configure Alluxio to use several storage types in a single tier on EMR.
Urgency
Normal
	</description>
	<comments>
		<comment id='1' author='thereisnospoon' date='2019-08-31T00:23:58Z'>
		&lt;denchmark-link:https://github.com/ns1123&gt;@ns1123&lt;/denchmark-link&gt;
 can you please ask for more info required to debug this?
		</comment>
		<comment id='2' author='thereisnospoon' date='2019-09-02T09:46:22Z'>
		I think the problem might be here 


alluxio/bin/alluxio-start.sh


         Line 80
      in
      603c6fc






 is_ram_folder_mounted() { 





The argument passed to is_ram_folder_mounted is comma-delimited string containing mount paths with the first mount path being ramdisk mount path.
Extracting ramdisk_mount_path=$(cut -d ',' -f1 &lt;&lt;&lt;  ${1}) and using it in validation loop:
&lt;denchmark-code&gt;for fs in ${mounted_fs}; do
    if [[ "${ramdisk_mount_path}" == "${fs}" || "${ramdisk_mount_path}" =~ ^"${fs}"\/.* ]]; then
      return 0
    fi
  done
&lt;/denchmark-code&gt;

might help.
		</comment>
		<comment id='3' author='thereisnospoon' date='2019-10-09T21:33:55Z'>
		&lt;denchmark-link:https://github.com/ns1123&gt;@ns1123&lt;/denchmark-link&gt;
 can you take a look?
		</comment>
		<comment id='4' author='thereisnospoon' date='2019-12-19T19:44:56Z'>
		&lt;denchmark-link:https://github.com/thereisnospoon&gt;@thereisnospoon&lt;/denchmark-link&gt;
 this issue is resolved by &lt;denchmark-link:https://github.com/Alluxio/alluxio/pull/10152&gt;#10152&lt;/denchmark-link&gt;

It should be in 2.1.X and later.
Based on the initial configuration provided, the only additional line of configuration you should add is
alluxio.worker.tieredstore.level0.dirs.mediumtype=MEM,MEM
Using this configuration scripts should determine which paths are ramdisks and mount them appropriately. Starting the workers afterwards should also succeed. Please re-open this issue if you think there is still a problem. Thanks!
		</comment>
	</comments>
</bug>