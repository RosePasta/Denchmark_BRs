<bug id='9018' author='cheyang' open_date='2019-05-07T22:59:52Z' closed_time='2019-05-25T01:51:48Z'>
	<summary>Why need to set `hostPID: true` in kubernetes/alluxio-master.yaml.template</summary>
	<description>
Alluxio Version:
v2.0.0-preview

It's just a question. Why need to set  in &lt;denchmark-link:https://github.com/Alluxio/alluxio/blob/master/integration/kubernetes/alluxio-master.yaml.template#L56&gt;kubernetes/alluxio-master.yaml.template&lt;/denchmark-link&gt;
 ?
To Reproduce
Steps to reproduce the behavior (as minimally and precisely as possible)
Expected behavior
A clear and concise description of what you expected to happen.
Urgency
Describe the impact and urgency of the bug.
Additional context
Add any other context about the problem here.
	</description>
	<comments>
		<comment id='1' author='cheyang' date='2019-05-07T23:04:48Z'>
		&lt;denchmark-link:https://github.com/madanadit&gt;@madanadit&lt;/denchmark-link&gt;
 , can you help answering this question?
		</comment>
		<comment id='2' author='cheyang' date='2019-05-07T23:14:12Z'>
		Hi &lt;denchmark-link:https://github.com/cheyang&gt;@cheyang&lt;/denchmark-link&gt;
, good catch.  should not be required.
		</comment>
		<comment id='3' author='cheyang' date='2019-05-24T23:28:32Z'>
		Fix: &lt;denchmark-link:https://github.com/Alluxio/alluxio/pull/9133&gt;#9133&lt;/denchmark-link&gt;

		</comment>
		<comment id='4' author='cheyang' date='2019-06-14T16:28:59Z'>
		If Host network is set to false Alluxio is Starting the master process with the master service defined in MASTER_HOSTNAME but Worker node is not able to resolve the worker service at port 29999.
Alluxio is failing to run in POD network only runs in host network.
		</comment>
		<comment id='5' author='cheyang' date='2019-06-14T20:13:05Z'>
		&lt;denchmark-link:https://github.com/MATRIX4284&gt;@MATRIX4284&lt;/denchmark-link&gt;
 this issue was talking about hostPID but not hostNetwork.
for your issue, this might help. we have updated the worker spec so that worker hostName is the physical IP of the host. this is resolvable from other containers which are not using host networking.
&lt;denchmark-code&gt;          env:
          - name: ALLUXIO_WORKER_HOSTNAME
            valueFrom:
              fieldRef:
                fieldPath: status.hostIP
          - name: ALLUXIO_WORKER_JAVA_OPTS
            value: -Dalluxio.worker.hostname=$(ALLUXIO_WORKER_HOSTNAME)
&lt;/denchmark-code&gt;

let us know how it goes.
		</comment>
		<comment id='6' author='cheyang' date='2019-06-14T20:52:15Z'>
		It worked but it needed one more change
env:
- name: ALLUXIO_WORKER_HOSTNAME
valueFrom:
fieldRef:
fieldPath: status.podIP
		</comment>
		<comment id='7' author='cheyang' date='2019-06-14T20:54:34Z'>
		In fact now i am able to run a stateful of workers with 3 replicas
		</comment>
		<comment id='8' author='cheyang' date='2019-06-19T20:37:49Z'>
		Spark Workers are getting lost while trying query alluxio deployed in Kubernetes.
I tested the same spark pods with HDFS all ok,CRAIL in Kubernetes that too fine but whenever it is querying using alluxio url  the executors ae getting lost.The master url can be accessed though.
Thanks for your previous solution by the way
		</comment>
		<comment id='9' author='cheyang' date='2019-06-19T20:44:44Z'>
		&lt;denchmark-link:https://github.com/MATRIX4284&gt;@MATRIX4284&lt;/denchmark-link&gt;
 do you have anything from the executor logs to share? it is recommended to run Alluxio workers with host networking so that the alluxio client part of the spark executor is able to resolve the worker hostname. are you running with host or pod networking?
		</comment>
		<comment id='10' author='cheyang' date='2019-06-19T20:49:39Z'>
		&lt;denchmark-link:https://github.com/madanadit&gt;@madanadit&lt;/denchmark-link&gt;
 it is being run with pod networking ..the master node ip resolution is working fine.i can see the Alluxio Bootstrap client is getting connected to the alluxio master then master places some bytes in spark worker memory.After that the executors getting lost.But the same Alluxio K8 deployment if I connect to Alluxio master using kubectl exec -it i can both read and write files which is also getting reflected in my UFS HDFS as well
		</comment>
		<comment id='11' author='cheyang' date='2019-06-19T20:53:30Z'>
		&lt;denchmark-link:https://github.com/MATRIX4284&gt;@MATRIX4284&lt;/denchmark-link&gt;
 remote access from spark executors to an alluxio worker needs host networking for the alluxio worker.
master does not need host networking as the hostname is resolved by service dns.
		</comment>
		<comment id='12' author='cheyang' date='2019-06-19T20:55:35Z'>
		you mean spark can bypass the master and directly connect to worker
My code url is
alluxio://alluxio-master:19998/2008.csv [alluxio-master is the service of the master]
can i replace it by worker node ip if i use alluxio host networking
		</comment>
		<comment id='13' author='cheyang' date='2019-06-19T20:58:49Z'>
		no. after the client connects to the alluxio master (for metadata) it also connects to the alluxio worker (for data). so the client needs to resolve both the master and worker. also, the spark driver knows how to schedule for locality only if the alluxio worker hostname maps to physical host ip.
		</comment>
		<comment id='14' author='cheyang' date='2019-06-19T21:02:16Z'>
		Thanks a ton for your help ..I will set my master to use pod networking and workers to use host net ..
and spark will point to master
		</comment>
		<comment id='15' author='cheyang' date='2019-06-19T21:02:41Z'>
		I will test and let you know the result soon
		</comment>
		<comment id='16' author='cheyang' date='2019-06-19T21:05:46Z'>
		&lt;denchmark-link:https://github.com/MATRIX4284&gt;@MATRIX4284&lt;/denchmark-link&gt;
 thanks for testing
		</comment>
		<comment id='17' author='cheyang' date='2019-06-19T22:18:00Z'>
		I tested with Alluxio running in host network , when a spark kubernetes submit tries to access to access Alluxio the executors are getting lost still
		</comment>
		<comment id='18' author='cheyang' date='2019-06-19T22:19:19Z'>
		The spark master can connect to alluxio master but after that the executor are getting lost the same phenomenon when using pod network.
		</comment>
		<comment id='19' author='cheyang' date='2019-06-19T22:26:47Z'>
		&lt;denchmark-link:https://github.com/MATRIX4284&gt;@MATRIX4284&lt;/denchmark-link&gt;
 can you tail your executor pods to collect the logs before it is lost?
		</comment>
	</comments>
</bug>