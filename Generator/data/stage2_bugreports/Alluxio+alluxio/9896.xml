<bug id='9896' author='cheyang' open_date='2019-09-16T10:29:48Z' closed_time='2019-10-08T18:11:56Z'>
	<summary>the size of Alluxio docker image is too large due to changing owner</summary>
	<description>
Alluxio Version:
2.1.0-SNAPSHOT
Describe the bug
The docker image of allxuio/alluxio:2.1.0-SNAPSHOT is 1.09 GB. It's too large. I notice the 2.0.1 version is only 597.73 MB
To Reproduce
Steps to reproduce the behavior (as minimally and precisely as possible)
Expected behavior
A clear and concise description of what you expected to happen.
Urgency
Describe the impact and urgency of the bug.
Additional context
Add any other context about the problem here.
	</description>
	<comments>
		<comment id='1' author='cheyang' date='2019-09-18T09:09:41Z'>
		/ping &lt;denchmark-link:https://github.com/madanadit&gt;@madanadit&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='cheyang' date='2019-10-01T16:17:31Z'>
		This operation increases disk size from 740MB to 1.3GB
&lt;denchmark-code&gt;# if Alluxio user, group, gid, and uid aren't root|0
# then create the alluxio user and set file permissions accordingly
RUN if [ ${ALLUXIO_USERNAME} != "root" ] \
    &amp;&amp; [ ${ALLUXIO_GROUP} != "root" ] \
    &amp;&amp; [ ${ALLUXIO_UID} -ne 0 ] \
    &amp;&amp; [ ${ALLUXIO_GID} -ne 0 ]; then \
      addgroup -g ${ALLUXIO_GID} -S ${ALLUXIO_GROUP} &amp;&amp; \
      adduser -u ${ALLUXIO_UID} -S ${ALLUXIO_USERNAME} -G ${ALLUXIO_GROUP} &amp;&amp; \
      usermod -a -G root ${ALLUXIO_USERNAME} &amp;&amp; \
      mkdir -p /journal &amp;&amp; \
      chown -R ${ALLUXIO_UID}:${ALLUXIO_GID} /opt/* /journal &amp;&amp; \
      chmod -R g=u /opt/* /journal; \
    fi
&lt;/denchmark-code&gt;

		</comment>
		<comment id='3' author='cheyang' date='2019-10-01T16:20:38Z'>
		Seems the operation above doubles the size of docker images.
&lt;denchmark-code&gt;docker history alluxio/alluxio:test
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
f493109eb43b        4 minutes ago       |5 ALLUXIO_GID=1000 ALLUXIO_GROUP=alluxio AL…   628MB
bb616ecb5075        4 minutes ago       /bin/sh -c #(nop) COPY file:ce5b6a28ee56de07…   6.18kB
aa38d0d87dbf        4 minutes ago       /bin/sh -c #(nop) COPY dir:07e9f97965b1e71a2…   83B
0a229b64821a        4 minutes ago       |5 ALLUXIO_GID=1000 ALLUXIO_GROUP=alluxio AL…   22B
7d36e7f82818        4 minutes ago       /bin/sh -c #(nop) ADD file:eba0045cd7db83531…   628MB
a87758d5b735        5 minutes ago       |5 ALLUXIO_GID=1000 ALLUXIO_GROUP=alluxio AL…   7.12MB
6c43ed8c07ad        5 minutes ago       /bin/sh -c #(nop)  ARG ALLUXIO_GID=1000         0B
&lt;/denchmark-code&gt;

		</comment>
		<comment id='4' author='cheyang' date='2019-10-01T16:29:11Z'>
		I think it's due to chown: &lt;denchmark-link:https://stackoverflow.com/questions/30085621/why-does-chown-increase-size-of-docker-image&gt;https://stackoverflow.com/questions/30085621/why-does-chown-increase-size-of-docker-image&lt;/denchmark-link&gt;

		</comment>
	</comments>
</bug>