<bug id='2924' author='daquexian' open_date='2020-01-28T16:38:15Z' closed_time='2020-01-29T17:08:28Z'>
	<summary>ONNX Runtime crashes when inferring this model</summary>
	<description>

ONNX Runtime crashes when inferring this model: &lt;denchmark-link:https://drive.google.com/open?id=1Ln9xXIN0A7jWzOHMVCzZnOegBryCgxZy&gt;https://drive.google.com/open?id=1Ln9xXIN0A7jWzOHMVCzZnOegBryCgxZy&lt;/denchmark-link&gt;


click to expand stacktrace
0   libc++.1.dylib                	0x00007fff7281e5b7 std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt;::basic_string(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;) + 27
1   onnxruntime_pybind11_state.so 	0x000000010d71aa11 onnx::Utils::DataTypeUtils::ToDataTypeString(int) + 273
2   onnxruntime_pybind11_state.so 	0x000000010d718d2e onnx::Utils::DataTypeUtils::ToString(onnx::TypeProto const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;) + 542
3   onnxruntime_pybind11_state.so 	0x000000010d718749 onnx::Utils::DataTypeUtils::ToType(onnx::TypeProto const&amp;) + 73
4   onnxruntime_pybind11_state.so 	0x000000010d664727 onnxruntime::NodeArg::NodeArg(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, onnx::TypeProto const*) + 503
5   onnxruntime_pybind11_state.so 	0x000000010d66b0be onnxruntime::Graph::GetOrCreateNodeArg(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, onnx::TypeProto const*) + 94
6   onnxruntime_pybind11_state.so 	0x000000010d669bef onnxruntime::Graph::Graph(onnx::GraphProto*, std::__1::unordered_map&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt;, int, std::__1::hash&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::equal_to&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::allocator&lt;std::__1::pair&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const, int&gt; &gt; &gt; const&amp;, long long, std::__1::shared_ptr&lt;onnxruntime::IOnnxRuntimeOpSchemaCollection&gt;, onnxruntime::Graph*, onnxruntime::Node const*, onnxruntime::logging::Logger const&amp;, std::__1::unordered_map&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt;, onnx::FunctionProto const*, std::__1::hash&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::equal_to&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::allocator&lt;std::__1::pair&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const, onnx::FunctionProto const*&gt; &gt; &gt; const&amp;) + 3039
7   onnxruntime_pybind11_state.so 	0x000000010d666b68 onnxruntime::Graph::Graph(onnxruntime::Graph&amp;, onnxruntime::Node const&amp;, onnx::GraphProto&amp;) + 136
8   onnxruntime_pybind11_state.so 	0x000000010d666460 onnxruntime::Node::CreateSubgraph(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;) + 144
9   onnxruntime_pybind11_state.so 	0x000000010d66639d onnxruntime::Node::Init(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::vector&lt;onnxruntime::NodeArg*, std::__1::allocator&lt;onnxruntime::NodeArg*&gt; &gt; const&amp;, std::__1::vector&lt;onnxruntime::NodeArg*, std::__1::allocator&lt;onnxruntime::NodeArg*&gt; &gt; const&amp;, std::__1::unordered_map&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt;, onnx::AttributeProto, std::__1::hash&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::equal_to&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::allocator&lt;std::__1::pair&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const, onnx::AttributeProto&gt; &gt; &gt; const*, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;) + 349
10  onnxruntime_pybind11_state.so 	0x000000010d682f8b onnxruntime::Graph::AddNode(std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;, std::__1::vector&lt;onnxruntime::NodeArg*, std::__1::allocator&lt;onnxruntime::NodeArg*&gt; &gt; const&amp;, std::__1::vector&lt;onnxruntime::NodeArg*, std::__1::allocator&lt;onnxruntime::NodeArg*&gt; &gt; const&amp;, std::__1::unordered_map&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt;, onnx::AttributeProto, std::__1::hash&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::equal_to&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::allocator&lt;std::__1::pair&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const, onnx::AttributeProto&gt; &gt; &gt; const*, std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const&amp;) + 427
11  onnxruntime_pybind11_state.so 	0x000000010d66bc8f onnxruntime::Graph::AddNode(onnx::NodeProto const&amp;, std::__1::unordered_map&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt;, onnx::TypeProto, std::__1::hash&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::equal_to&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::allocator&lt;std::__1::pair&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const, onnx::TypeProto&gt; &gt; &gt; const&amp;) + 335
12  onnxruntime_pybind11_state.so 	0x000000010d669cbe onnxruntime::Graph::Graph(onnx::GraphProto*, std::__1::unordered_map&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt;, int, std::__1::hash&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::equal_to&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::allocator&lt;std::__1::pair&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const, int&gt; &gt; &gt; const&amp;, long long, std::__1::shared_ptr&lt;onnxruntime::IOnnxRuntimeOpSchemaCollection&gt;, onnxruntime::Graph*, onnxruntime::Node const*, onnxruntime::logging::Logger const&amp;, std::__1::unordered_map&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt;, onnx::FunctionProto const*, std::__1::hash&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::equal_to&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::allocator&lt;std::__1::pair&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const, onnx::FunctionProto const*&gt; &gt; &gt; const&amp;) + 3246
13  onnxruntime_pybind11_state.so 	0x000000010d66aac4 onnxruntime::Graph::Graph(onnx::GraphProto*, std::__1::unordered_map&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt;, int, std::__1::hash&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::equal_to&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::allocator&lt;std::__1::pair&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const, int&gt; &gt; &gt; const&amp;, long long, std::__1::shared_ptr&lt;onnxruntime::IOnnxRuntimeOpSchemaCollection&gt;, onnxruntime::logging::Logger const&amp;, std::__1::unordered_map&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt;, onnx::FunctionProto const*, std::__1::hash&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::equal_to&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; &gt;, std::__1::allocator&lt;std::__1::pair&lt;std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;, std::__1::allocator&lt;char&gt; &gt; const, onnx::FunctionProto const*&gt; &gt; &gt; const&amp;) + 84
14  onnxruntime_pybind11_state.so 	0x000000010d6a1aa1 onnxruntime::Model::Model(std::__1::unique_ptr&lt;onnx::ModelProto, std::__1::default_delete&lt;onnx::ModelProto&gt; &gt;, std::__1::list&lt;std::__1::shared_ptr&lt;onnxruntime::IOnnxRuntimeOpSchemaCollection&gt;, std::__1::allocator&lt;std::__1::shared_ptr&lt;onnxruntime::IOnnxRuntimeOpSchemaCollection&gt; &gt; &gt; const*, onnxruntime::logging::Logger const&amp;) + 1873
15  onnxruntime_pybind11_state.so 	0x000000010d6a2bbf onnxruntime::Model::Load(onnx::ModelProto const&amp;, std::__1::shared_ptr&lt;onnxruntime::Model&gt;&amp;, std::__1::list&lt;std::__1::shared_ptr&lt;onnxruntime::IOnnxRuntimeOpSchemaCollection&gt;, std::__1::allocator&lt;std::__1::shared_ptr&lt;onnxruntime::IOnnxRuntimeOpSchemaCollection&gt; &gt; &gt; const*, onnxruntime::logging::Logger const&amp;) + 175


After adding some log I found the node named  had the data type  so &lt;denchmark-link:https://github.com/onnx/onnx/blob/master/onnx/defs/data_type_utils.cc#L172&gt;this assert&lt;/denchmark-link&gt;
 failed.
System information

ONNX Runtime installed from (source or binary): both source and binary
ONNX Runtime version: master
Python version: 3.7


Related comment: &lt;denchmark-link:https://github.com/onnx/onnx-tensorrt/issues/383#issuecomment-579027388&gt;onnx/onnx-tensorrt#383 (comment)&lt;/denchmark-link&gt;

	</description>
	<comments>
		<comment id='1' author='daquexian' date='2020-01-28T21:59:06Z'>
		Is this for tensorrt? I tried with CPU and the session was successfully initialized.
		</comment>
		<comment id='2' author='daquexian' date='2020-01-29T17:08:28Z'>
		&lt;denchmark-link:https://github.com/pranavsharma&gt;@pranavsharma&lt;/denchmark-link&gt;
 Sorry. I found the model got broken after running onnx optimizers in onnx-simplifier. It is not related to onnx runtime.
		</comment>
	</comments>
</bug>