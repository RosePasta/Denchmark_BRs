<bug id='23' author='asanakoy' open_date='2016-10-26T01:35:08Z' closed_time='2016-11-15T20:33:33Z'>
	<summary>dd.io.save crashes while saving np.array of objects</summary>
	<description>
dd.io.save crashes when you try to save np.array with dtype=object
Ubuntu 14.04 x64
Python 2.7.11 (default, Dec 15 2015, 16:46:19)
[GCC 4.8.4]
&lt;denchmark-code&gt;In [1]: np.__version__
Out[2]: '1.11.2'
In [2]: dd.__version__
Out[2]: '0.3.4'
In [3]: tables.__version__
Out[3]: '3.2.2'


In [10]: x = np.array(['123', 567, 'hjjjk'], dtype='O')

In [11]: x
Out[11]: array(['123', 567, 'hjjjk'], dtype=object)

In [12]: dd.io.save('t.h5', x)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
&lt;ipython-input-12-dc094ba588e4&gt; in &lt;module&gt;()
----&gt; 1 dd.io.save('t.h5', x)

/export/home/asanakoy/.local/lib/python2.7/site-packages/deepdish/io/hdf5io.pyc in save(path, data, compression)
    579         else:
    580             _save_level(h5file, group, data, name='data',
--&gt; 581                         filters=filters, idtable=idtable)
    582             # Mark this to automatically unpack when loaded
    583             group._v_attrs[DEEPDISH_IO_UNPACK] = True

/export/home/asanakoy/.local/lib/python2.7/site-packages/deepdish/io/hdf5io.pyc in _save_level(handler, group, level, name, filters, idtable)
    242 
    243     elif isinstance(level, np.ndarray):
--&gt; 244         _save_ndarray(handler, group, name, level, filters=filters)
    245 
    246     elif _pandas and isinstance(level, (pd.DataFrame, pd.Series, pd.Panel)):

/export/home/asanakoy/.local/lib/python2.7/site-packages/deepdish/io/hdf5io.pyc in _save_ndarray(handler, group, name, x, filters)
    123         atom = tables.StringAtom(itemsize)
    124     else:
--&gt; 125         atom = tables.Atom.from_dtype(x.dtype)
    126         strtype = None
    127         itemsize = None

/export/home/asanakoy/.local/lib/python2.7/site-packages/tables/atom.pyc in from_dtype(class_, dtype, dflt)
    377             return class_.from_kind('string', itemsize, dtype.shape, dflt)
    378         # Most NumPy types have direct correspondence with PyTables types.
--&gt; 379         return class_.from_type(basedtype.name, dtype.shape, dflt)
    380 
    381     @classmethod

/export/home/asanakoy/.local/lib/python2.7/site-packages/tables/atom.pyc in from_type(class_, type, shape, dflt)
    402 
    403         if type not in all_types:
--&gt; 404             raise ValueError("unknown type: %r" % (type,))
    405         kind, itemsize = split_type(type)
    406         return class_.from_kind(kind, itemsize, shape, dflt)

ValueError: unknown type: 'object'
&lt;/denchmark-code&gt;

	</description>
	<comments>
		<comment id='1' author='asanakoy' date='2016-10-26T15:01:58Z'>
		Thanks for this bug report! This should definitely be handled better. Heterogenous arrays are not natively supported by HDF5, so I think the only option here is to automatically pickle it.
Before I have pushed a fix out, force pickling seems to be a work-around:
&lt;denchmark-code&gt;dd.io.save('t.h5', dd.io.ForcePickle(x))
&lt;/denchmark-code&gt;

		</comment>
		<comment id='2' author='asanakoy' date='2016-10-26T15:04:49Z'>
		Do you know how are they handled in np.save?  Pickling too?
		</comment>
		<comment id='3' author='asanakoy' date='2016-10-26T15:07:39Z'>
		Yes, it is pickled by np.save. I just confirmed this by saving x to t.npy and then trying:
&lt;denchmark-code&gt;&gt;&gt;&gt; np.load('t.npy', allow_pickle=False)
[...]
ValueError: Object arrays cannot be loaded when allow_pickle=False
&lt;/denchmark-code&gt;

		</comment>
	</comments>
</bug>