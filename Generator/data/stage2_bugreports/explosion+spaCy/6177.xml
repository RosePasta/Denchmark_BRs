<bug id='6177' author='themrmax' open_date='2020-10-01T22:21:53Z' closed_time='2020-10-07T22:43:47Z'>
	<summary>textcat model weights are not deterministic even with random.seed</summary>
	<description>
I'm trying to write some unit tests for my code and am struggling to make them deterministic. Consider the following example:
import spacy
import random

for _ in range(2):
    spacy.util.fix_random_seed(0)

    model = spacy.load('en_core_web_sm')

    model.add_pipe(model.create_pipe('textcat'))
    model.remove_pipe('parser')
    model.remove_pipe('tagger')

    cat = model.get_pipe('textcat')
    cat.add_label("dog")
    cat.add_label("donut")

    model.begin_training()
    print(model("What even is?").cats)

# output:
# {'dog': 0.527805507183075, 'donut': 0.8244330286979675}
# {'dog': 0.6659842729568481, 'donut': 0.19725579023361206}
Looks like maybe a duplicate/regression of &lt;denchmark-link:https://github.com/explosion/spaCy/issues/3182&gt;#3182&lt;/denchmark-link&gt;

&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


Operating System: Mac OS 10.15.7
Python Version Used: 3.7.4
spaCy Version Used: 2.3.0
Environment Information: anaconda3

	</description>
	<comments>
		<comment id='1' author='themrmax' date='2020-10-02T07:22:25Z'>
		Yes, this is a known (and frustrating!) issue, see &lt;denchmark-link:https://github.com/explosion/spaCy/issues/5551&gt;#5551&lt;/denchmark-link&gt;
. I think this will be fixed in spacy v3. The relevant PR is &lt;denchmark-link:https://github.com/explosion/spaCy/pull/5735&gt;#5735&lt;/denchmark-link&gt;
.
At first glance, I think this wouldn't be too hard to backport to spacy v2, but this hasn't been done yet.
		</comment>
		<comment id='2' author='themrmax' date='2020-10-07T18:17:44Z'>
		PR &lt;denchmark-link:https://github.com/explosion/spaCy/pull/6218&gt;#6218&lt;/denchmark-link&gt;
 should fix it for v2. When I run your code, I get:
&lt;denchmark-code&gt;{'dog': 0.5329195857048035, 'donut': 0.5502294301986694}
{'dog': 0.5329195857048035, 'donut': 0.5502294301986694}
&lt;/denchmark-code&gt;

		</comment>
	</comments>
</bug>