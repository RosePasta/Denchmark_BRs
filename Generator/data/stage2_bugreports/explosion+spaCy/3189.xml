<bug id='3189' author='nyejon' open_date='2019-01-23T15:30:16Z' closed_time='2019-02-24T15:49:20Z'>
	<summary>NER training with new entity array shape error</summary>
	<description>
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

Run the standard new entity training example on &lt;denchmark-link:https://spacy.io/usage/training#section-ner&gt;https://spacy.io/usage/training#section-ner&lt;/denchmark-link&gt;

&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;

&lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;


spaCy version: 2.1.0a6
Platform: Darwin-18.2.0-x86_64-i386-64bit
Python version: 3.7.1

I get a "ValueError: could not broadcast input array from shape (77,64) into shape (73,64)"
I have tried both the english md and lg models iwth the same results
	</description>
	<comments>
		<comment id='1' author='nyejon' date='2019-01-23T15:39:32Z'>
		Could you check the output of python -m spacy validate to make sure you're using the correct compatible models (especially since you're on spacy-nightly)?
		</comment>
		<comment id='2' author='nyejon' date='2019-01-23T15:40:42Z'>
		===================== Installed models (spaCy v2.1.0a6) =====================
ℹ spaCy installation:
/.local/share/virtualenvs/machine-learning-mJ7mbo3c/lib/python3.7/site-packages/spacy
TYPE      NAME              MODEL             VERSION
package   en-core-web-md    en_core_web_md    2.1.0a5   ✔
package   en-core-web-lg    en_core_web_lg    2.1.0a5   ✔
package   de-core-news-md   de_core_news_md   2.1.0a5   ✔
		</comment>
		<comment id='3' author='nyejon' date='2019-02-18T14:11:35Z'>
		Hi, to extend this issue - If I change the ner config after training I get:
{
"beam_width":1,
"beam_density":0.0,
"cnn_maxout_pieces":3,
"deprecation_fixes":{
"vectors_name":"en_model.vectors"
},
"nr_class":89,  &lt;----- This was incorrectly written out as 73
"hidden_depth":1,
"token_vector_width":96,
"hidden_width":64,
"maxout_pieces":2,
"pretrained_vectors":"en_model.vectors",
"bilstm_depth":0
}
If I change the value of NR class to 89 as the new model expects it loads but everything is labelled as a NORP
		</comment>
		<comment id='4' author='nyejon' date='2019-02-18T15:30:46Z'>
		&lt;denchmark-link:https://github.com/nyejon&gt;@nyejon&lt;/denchmark-link&gt;
 Are you using the latest nightly, ? We definitely fixed a bug that might have caused problems like "everything is labelled XY", so if you're still using a6, try again with the new nightly and see if the problem is resolved.
		</comment>
		<comment id='5' author='nyejon' date='2019-02-18T18:17:13Z'>
		Yes I am. This was tested again because I had upgraded to see if it works now.  The NER config file seems to also get incorrectly created, so the model does not load unless that value is changed manually.
		</comment>
		<comment id='6' author='nyejon' date='2019-02-24T15:44:21Z'>
		Found the bug, and fixed a number of other issues associated with adding labels to a pre-trained model. It's definitely a hard workflow to support correctly, but we're really committed to making it work, as it's super valuable.
		</comment>
		<comment id='7' author='nyejon' date='2019-03-26T16:40:01Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>