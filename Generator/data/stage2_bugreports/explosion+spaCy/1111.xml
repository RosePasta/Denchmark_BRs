<bug id='1111' author='MaxPowerWasTaken' open_date='2017-06-07T18:03:10Z' closed_time='2017-10-17T16:44:20Z'>
	<summary>Spacy Parser Returning Blank Columns with Pandas &amp; Multiprocessing</summary>
	<description>
Question posted yesterday with fully reproduceable code example at &lt;denchmark-link:https://stackoverflow.com/questions/44395656/applying-spacy-parser-to-pandas-dataframe-w-multiprocessing&gt;https://stackoverflow.com/questions/44395656/applying-spacy-parser-to-pandas-dataframe-w-multiprocessing&lt;/denchmark-link&gt;

Summary:
I have a short python wrapper function which accepts a  pandas dataframe &amp; a function, and applies the function to the dataframe in parallel. If I parse a text with Spacy (using my_pandas_series.apply(nlp)) without parallelizing, I get expected results. When I do it using the multiprocessing wrapper function, I get back a blank column.
Is this expected behavior?
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


Operating System: Linux Mint 18 Sarah
Python Version Used: 3.5
spaCy Version Used: 1.8.2
Environment Information:

	</description>
	<comments>
		<comment id='1' author='MaxPowerWasTaken' date='2017-06-07T21:13:10Z'>
		Thanks for the detailed report.
I haven't dug into this properly, but at a glance I suspect that the multiprocessing code is expecting to pickle/unpickle the spaCy nlp object. One of the major features of spaCy 2 is improved serialization, including full support for the Pickle protocol. But in spaCy 1.x, Pickle isn't expected to work.
What's interesting is that there's no error -- so maybe my analysis is wrong, and a different problem is being encountered? If so, I still think the lack of pickle support will block what you're trying to do here.
		</comment>
		<comment id='2' author='MaxPowerWasTaken' date='2017-06-09T04:56:45Z'>
		Thanks for the reply Honnibal. I just tried the same code example in a new environment with Spacy 2 and en_core_web_sm-2.0.0-alpha and got the same result, in case that's helpful to understanding this.
Also, in case it means anything, after running my dataframe through the multiprocessing-wrapped-function to add a parsed column, not just the new parsed column is blank, but also the old previously-parsed column becomes newly blank after being run through multiprocessing.
And of course, thanks a ton for such an awesome library!
		</comment>
		<comment id='3' author='MaxPowerWasTaken' date='2017-06-17T23:37:41Z'>
		Hey Honnibal, I have some availability to look into this this week if that would be helpful. I'm not very familiar with spacy's code base though, would you have a hunch on where I might start looking?
		</comment>
		<comment id='4' author='MaxPowerWasTaken' date='2017-10-17T16:44:19Z'>
		Pickle is now fixed on develop, for both the Language class and the Doc. ðŸŽ‰
Pickling should be quite fast, with no redundant copies of the Vocab --- so you can pickle a list of Doc objects, and it'll do the right thing and only have one copy of all the shared data.
		</comment>
		<comment id='5' author='MaxPowerWasTaken' date='2018-04-26T09:52:54Z'>
		&lt;denchmark-link:https://github.com/honnibal&gt;@honnibal&lt;/denchmark-link&gt;
 Is this issue fixed in master as well or do I have to build the library from develop?
I am on spacy version 2.0.11
		</comment>
		<comment id='6' author='MaxPowerWasTaken' date='2018-05-26T10:52:39Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>