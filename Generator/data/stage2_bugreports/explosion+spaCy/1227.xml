<bug id='1227' author='irfan-zoefit' open_date='2017-07-26T05:21:07Z' closed_time='2017-07-31T23:12:29Z'>
	<summary>AssertionError: Status must be a string</summary>
	<description>
Displacy throws error while running the server and checking the dependencies in the browser on 0.0.0.0:5000.
from __future__ import unicode_literals, print_function
import spacy
from spacy import displacy

text = 'But Google is starting from behind.'

nlp = spacy.load('en_core_web_sm')
doc = nlp(text)
for word in doc:
    print(word.text, word.tag_, word.dep_)
displacy.serve(doc, style='dep')
Here is the error:
Traceback (most recent call last):
  File "/usr/lib/python2.7/wsgiref/handlers.py", line 85, in run
    self.result = application(self.environ, self.start_response)
  File "/home/irfan/PycharmProjects/nightly/.night/local/lib/python2.7/site-packages/spacy/displacy/__init__.py", line 68, in app
    start_response('200 OK', [('Content-type', 'text/html; charset=utf-8')])
  File "/usr/lib/python2.7/wsgiref/handlers.py", line 173, in start_response
    assert type(status) is StringType,"Status must be a string"
AssertionError: Status must be a string
127.0.0.1 - - [26/Jul/2017 10:15:57] "GET /favicon.ico HTTP/1.1" 500 59
&lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;


Python version: 2.7.12
Platform: Linux-4.4.0-87-generic-x86_64-with-Ubuntu-16.04-xenial
spaCy version: 2.0.0a6

	</description>
	<comments>
		<comment id='1' author='irfan-zoefit' date='2017-07-26T10:28:19Z'>
		Hmm, interesting! Thanks for the report – haven't seen this error before. This seems to be related to wsgiref (which we used to avoid additional dependencies just for the simple displaCy server – but maybe we should re-think that decision).
It's a bit confusing, though, because the &lt;denchmark-link:https://github.com/explosion/spaCy/blob/develop/spacy/displacy/__init__.py#L43&gt;displaCy server implementation&lt;/denchmark-link&gt;
 is pretty much identical to the &lt;denchmark-link:https://docs.python.org/2/library/wsgiref.html#wsgiref.util.setup_testing_defaults&gt;wsgiref example app&lt;/denchmark-link&gt;
, and  should definitely be a string... Will look into this!
 Might be a Python 2/3 issue – that  should be encoded in Python 2, and a string in Python 3. Since we have unicode literals set on the file, the string has a different type. If you have a second and want to quickly test it locally, try changing &lt;denchmark-link:https://github.com/explosion/spaCy/blob/develop/spacy/displacy/__init__.py#L68&gt;line 68&lt;/denchmark-link&gt;
 to:
start_response(b'200 OK', [('Content-type', 'text/html; charset=utf-8')]) 
(This will obviously only work on Python 2. So in spaCy, we'll use our compat module to write Python 2/3-specific rules here.)
		</comment>
		<comment id='2' author='irfan-zoefit' date='2017-07-31T08:56:35Z'>
		Well, it does not solve the problem either.
it shows following error after using
start_response(b'200 OK', [('Content-type', 'text/html; charset=utf-8')]) 
Error:
Traceback (most recent call last):
  File "/usr/lib/python2.7/wsgiref/handlers.py", line 85, in run
    self.result = application(self.environ, self.start_response)
  File "/home/irfan/PycharmProjects/nightly/.night/local/lib/python2.7/site-packages/spacy/displacy/__init__.py", line 68, in app
    start_response(b'200 OK', [('Content-type', 'text/html; charset=utf-8')])
  File "/usr/lib/python2.7/wsgiref/handlers.py", line 179, in start_response
    assert type(name) is StringType,"Header names must be strings"
AssertionError: Header names must be strings
127.0.0.1 - - [31/Jul/2017 13:54:04] "GET / HTTP/1.1" 500 59
Traceback (most recent call last):
  File "/usr/lib/python2.7/wsgiref/handlers.py", line 85, in run
    self.result = application(self.environ, self.start_response)
  File "/home/irfan/PycharmProjects/nightly/.night/local/lib/python2.7/site-packages/spacy/displacy/__init__.py", line 68, in app
    start_response(b'200 OK', [('Content-type', 'text/html; charset=utf-8')])
  File "/usr/lib/python2.7/wsgiref/handlers.py", line 179, in start_response
    assert type(name) is StringType,"Header names must be strings"
AssertionError: Header names must be strings
127.0.0.1 - - [31/Jul/2017 13:54:04] "GET /favicon.ico HTTP/1.1" 500 59
I've changed the line to
start_response(b'200 OK', [(b'Content-type', b'text/html; charset=utf-8')])
Now it's working fine.
		</comment>
		<comment id='3' author='irfan-zoefit' date='2017-07-31T22:46:24Z'>
		Ahhh, sorry – damn strings in Python 2/3. Thanks for getting to the bottom of this. Will be fixed!
		</comment>
		<comment id='4' author='irfan-zoefit' date='2018-05-08T18:27:39Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>