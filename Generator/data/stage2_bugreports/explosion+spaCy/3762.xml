<bug id='3762' author='gauravnbcu' open_date='2019-05-20T14:39:47Z' closed_time='2019-07-11T11:25:01Z'>
	<summary>Spacy convert CLI fails to convert jsonl to json.</summary>
	<description>
spaCy cli convert fails to convert jsonl to json. Due to sentencizer component failure.
Just run  below command
$ spacy convert eval.jsonl --lang en
JSONL has about 35k lines.
Example:
&lt;denchmark-code&gt;{"text":"Tyson Foods sold its minority stake in Beyond because it wants to sell its own plant-based proteins, according to Axios.","spans":[{"start":0,"end":11,"label":"ORG"}]}
{"text":"So far, Disney has confirmed sequels to \"Black Panther\" and \"Doctor Strange\" as well as a third installment of \"The Guardians of the Galaxy\" franchise.","spans":[{"start":8,"end":14,"label":"ORG"}]} 
&lt;/denchmark-code&gt;

Stack trace
Traceback (most recent call last): File "/usr/lib64/python3.6/runpy.py", line 193, in _run_module_as_main "__main__", mod_spec) File "/usr/lib64/python3.6/runpy.py", line 85, in _run_code exec(code, run_globals) File "/efs/nn_based_nlp_stuff/venv_spacy_2_1_2/lib/python3.6/site-packages/spacy/__main__.py", line 35, in &lt;module&gt; plac.call(commands[command], sys.argv[1:]) File "/efs/nn_based_nlp_stuff/venv_spacy_2_1_2/lib/python3.6/site-packages/plac_core.py", line 328, in call cmd, result = parser.consume(arglist) File "/efs/nn_based_nlp_stuff/venv_spacy_2_1_2/lib/python3.6/site-packages/plac_core.py", line 207, in consume return cmd, self.func(*(args + varargs + extraopts), **kwargs) File "/efs/nn_based_nlp_stuff/venv_spacy_2_1_2/lib/python3.6/site-packages/spacy/cli/convert.py", line 80, in convert data = func(input_data, n_sents=n_sents, use_morphology=morphology, lang=lang) File "/efs/nn_based_nlp_stuff/venv_spacy_2_1_2/lib/python3.6/site-packages/spacy/cli/converters/jsonl2json.py", line 31, in ner_jsonl2json json_docs.append(docs_to_json(docs, id=i)) File "gold.pyx", line 616, in spacy.gold.docs_to_json File "doc.pyx", line 595, in sents ValueError: [E030] Sentence boundaries unset. You can add the 'sentencizer' component to the pipeline with: nlp.add_pipe(nlp.create_pipe('sentencizer')) Alternatively, add the dependency parser, or set sentence boundaries by setting doc[i].is_sent_start.
&lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;


spaCy version: 2.1.4
Platform: Linux-3.10.0-957.1.3.el7.x86_64-x86_64-with-centos-7.6.1810-Core
Python version: 3.6.7
Models: en

	</description>
	<comments>
		<comment id='1' author='gauravnbcu' date='2019-05-22T07:38:48Z'>
		I can't reproduce this issue an Windows with spaCy 2.1.4 and Python 3.7.3. Tried with around 36k JSON lines
		</comment>
		<comment id='2' author='gauravnbcu' date='2019-05-22T14:32:25Z'>
		I even made a fresh setup with spaCy 2.1.4, python 3.6  on linux . Still same issue
Command
$ spacy convert dataset.jsonl --lang en
&lt;denchmark-code&gt;Traceback (most recent call last):
  File "/usr/lib64/python3.6/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/usr/lib64/python3.6/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/efs/nn_based_nlp_stuff/venv_spacy_2_1_4/lib/python3.6/site-packages/spacy/__main__.py", line 35, in &lt;module&gt;
    plac.call(commands[command], sys.argv[1:])
  File "/efs/nn_based_nlp_stuff/venv_spacy_2_1_4/lib/python3.6/site-packages/plac_core.py", line 328, in call
    cmd, result = parser.consume(arglist)
  File "/efs/nn_based_nlp_stuff/venv_spacy_2_1_4/lib/python3.6/site-packages/plac_core.py", line 207, in consume
    return cmd, self.func(*(args + varargs + extraopts), **kwargs)
  File "/efs/nn_based_nlp_stuff/venv_spacy_2_1_4/lib/python3.6/site-packages/spacy/cli/convert.py", line 80, in convert
    data = func(input_data, n_sents=n_sents, use_morphology=morphology, lang=lang)
  File "/efs/nn_based_nlp_stuff/venv_spacy_2_1_4/lib/python3.6/site-packages/spacy/cli/converters/jsonl2json.py", line 31, in ner_jsonl2json
    json_docs.append(docs_to_json(docs, id=i))
  File "gold.pyx", line 616, in spacy.gold.docs_to_json
  File "doc.pyx", line 595, in sents
ValueError: [E030] Sentence boundaries unset. You can add the 'sentencizer' component to the pipeline with: nlp.add_pipe(nlp.create_pipe('sentencizer')) Alternatively, add the dependency parser, or set sentence boundaries by setting doc[i].is_sent_start.
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;


spaCy version: 2.1.4
Platform: Linux-3.10.0-957.1.3.el7.x86_64-x86_64-with-centos-7.6.1810-Core
Python version: 3.6.7
Models: en

		</comment>
		<comment id='3' author='gauravnbcu' date='2019-05-22T15:02:56Z'>
		To narrow down the problem I tried to convert few sample sentences instead.
Conversion fails when jsonl has sentence like following:
{"text":"DirecTV","spans":[{"start":0,"end":7,"label":"ORG"}]}
So, I created a jsonl file with just one sentence mentioned above.
And it fails in conversion. Stack-trace and environment is same as in previous comment.
&lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;


spaCy version: 2.1.4
Platform: Linux-3.10.0-957.1.3.el7.x86_64-x86_64-with-centos-7.6.1810-Core
Python version: 3.6.7
Models: en

However, conversion works with spacy version 2.1.2
spaCy 2.1.2 output
spacy convert slim.jsonl --lang en -t json
&lt;denchmark-code&gt;[
  {
    "id":0,
    "paragraphs":[
      {
        "raw":"DirecTV",
        "sentences":[
          {
            "tokens":[
              {
                "id":0,
                "orth":"DirecTV",
                "ner":"U-ORG"
              }
            ],
            "brackets":[

            ]
          }
        ]
      }
    ]
  }
]
&lt;/denchmark-code&gt;

Hope this helps in reproducing the issue.
		</comment>
		<comment id='4' author='gauravnbcu' date='2019-05-23T08:17:58Z'>
		Okay with {"text":"DirecTV","spans":[{"start":0,"end":7,"label":"ORG"}]} I can reproduce your error and the problem is that it is just one word.
This issue was introduced with &lt;denchmark-link:https://github.com/explosion/spaCy/pull/3419&gt;this PR&lt;/denchmark-link&gt;
 and since &lt;denchmark-link:https://github.com/explosion/spaCy/blob/4d550a3055587cd8a440e6dcd6d52b351efb6103/spacy/gold.pyx#L616&gt;here&lt;/denchmark-link&gt;
  is called, but for the parsed document  is  your error gets raised.
Not sure how to fix this though. If is_sentence should be True for single word texts as well or if docs_to_json should check if the doc is just one word.
		</comment>
		<comment id='5' author='gauravnbcu' date='2019-05-23T14:23:07Z'>
		I think  should be  for single word. As there could be valid sentences with just one words.
&lt;denchmark-link:https://github.com/explosion/spaCy/blob/4d550a3055587cd8a440e6dcd6d52b351efb6103/spacy/tokens/doc.pyx#L241&gt;Here&lt;/denchmark-link&gt;
  first token always marks  but it's being ignored when determining is_sentence.
Anyhow when we use parser for sentence segmentation is_sentence is True for sentences with one word ?
		</comment>
		<comment id='6' author='gauravnbcu' date='2019-07-11T11:24:58Z'>
		In v2.1.5, we've changed doc.is_sentenced to be True for single-word Doc objects. I think that should resolve this. Thanks for the report!
		</comment>
		<comment id='7' author='gauravnbcu' date='2019-08-10T11:42:36Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>