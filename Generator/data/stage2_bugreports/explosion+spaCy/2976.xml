<bug id='2976' author='ALSchwalm' open_date='2018-11-28T16:46:28Z' closed_time='2018-11-28T18:49:34Z'>
	<summary>MemoryError when pruning vectors with small batch size</summary>
	<description>
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;import spacy
nlp = spacy.load('en_core_web_lg')
nlp.vocab.prune_vectors(500000, 100)
&lt;/denchmark-code&gt;

The usage of the 'batch_size' parameter in the above code should avoid the memory constraints. However, a bug in &lt;denchmark-link:https://github.com/explosion/spaCy/blob/58757c5684426d8ea1453a9a041915ddbad60359/spacy/vocab.pyx#L300&gt;vocab.pyx&lt;/denchmark-link&gt;
 where the  parameter is not passed on to the  call (indeed, it is not used at all),  causes the batch matrix to be very large when  is large.
I can submit a PR to fix this, but I am not clear what an appropriate test would look like. I could create a large vocabulary and prune it to a slightly smaller size using a small batch size, but it would take a very long time to run, and would not necessarily fail even without the fix (if the machine running the test had lots of RAM, for example). Any advice there would be appreciated.
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


spaCy version: 2.0.16
Platform: Linux-4.18.16-arch1-1-ARCH-x86_64-with-arch
Python version: 3.7.1
Models: en_core_web_lg

	</description>
	<comments>
		<comment id='1' author='ALSchwalm' date='2018-11-28T17:07:56Z'>
		Thanks for a great report!
I think in this case it's fine to get by without a test case. If the modules weren't compiled, I think it would be possible to use mock to check that the argument was passed in...But we'd literally be checking only that, which seems pretty low value.
A pull request would be very welcome :)
		</comment>
		<comment id='2' author='ALSchwalm' date='2018-12-28T19:35:23Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>