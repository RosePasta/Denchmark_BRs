<bug id='5799' author='fcggamou' open_date='2020-07-22T14:30:08Z' closed_time='2020-07-24T07:26:27Z'>
	<summary>"cudaErrorInvalidDevice: invalid device ordinal" when attempting to pretrain</summary>
	<description>
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

When trying to pretrain a model using the CLI pretrain command, I'm getting the following error:
cupy.cuda.runtime.CUDARuntimeError: cudaErrorInvalidDevice: invalid device ordinal
The command I'm running is:
!python -m spacy pretrain "train.jsonl" 'es_core_news_md' 'pre_trained' -i=1
I think it's totally unrelated to my data.
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;

I'm working on Google Colab.

spaCy version: 2.3.2
Platform: Linux-4.19.104+-x86_64-with-Ubuntu-18.04-bionic
Python version: 3.6.9

	</description>
	<comments>
		<comment id='1' author='fcggamou' date='2020-07-23T11:46:41Z'>
		Thanks for the report! I think this accidentally got hard-coded in some of the experimental updates for v2.3.2. We'll fix it for the next patch release of spacy v2.3.
In the meanwhile, you can find this line in spacy/cli/pretrain.py and edit it to take out gpu_id=1 or provide the right ID:



spaCy/spacy/cli/pretrain.py


         Line 128
      in
      6d4d5c0






 has_gpu = prefer_gpu(gpu_id=1) 





		</comment>
		<comment id='2' author='fcggamou' date='2020-08-19T12:19:30Z'>
		For others stuck on this, until the v2.3.3 patch is released, this solved my problem:
pip install -U spacy==2.3.1
		</comment>
	</comments>
</bug>