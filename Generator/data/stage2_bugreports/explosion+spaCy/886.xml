<bug id='886' author='gartentrio(ghost)' open_date='2017-03-13T10:06:16Z' closed_time='2017-03-13T10:49:09Z'>
	<summary>token.idx doesn't always match original text index</summary>
	<description>
When there are newline characters in a text, the idx of a token in a spacy doc sometimes doesn't return the correct index into the original text.
Here's an example:
nlp = spacy.load('de')
input_text = "Datum:2014-06-02\nDokument:76467"
doc = nlp(text)
for token in doc:
    print("%s (text len: %d, text_with_ws len: %d)" % (repr(token.text), len(token.text), len(token.text_with_ws)))
    assert(input_text[token.idx] == token.text[0]), ('expected: ', input_text[token.idx], 'actual: ', token.text[0])
&lt;denchmark-code&gt;'Datum:2014-06-02' (text len: 16, text_with_ws len: 17)
'\n' (text len: 1, text_with_ws len: 1)
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
&lt;ipython-input-115-083d5fc58a69&gt; in &lt;module&gt;()
      4 for token in doc:
      5     print("%s (text len: %d, text_with_ws len: %d)" % (repr(token.text), len(token.text), len(token.text_with_ws)))
----&gt; 6     assert(input_text[token.idx] == token.text[0]), ('expected: ', input_text[token.idx], 'actual: ', token.text[0])

AssertionError: ('expected: ', 'D', 'actual: ', '\n')
&lt;/denchmark-code&gt;

It seems the newline character is counted twice, once as the last char of the the first token, and then as a token of its own.
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


Operating System: Linux
Python Version Used: 3.5
spaCy Version Used: 1.6.0
Environment Information:

	</description>
	<comments>
		<comment id='1' author='gartentrio(ghost)' date='2017-03-13T10:49:09Z'>
		Thanks for the report! It looks like this is related to &lt;denchmark-link:https://github.com/explosion/spaCy/issues/859&gt;#859&lt;/denchmark-link&gt;
. Just added a regression test and it works for me using the version on master (which already includes the fix for that issue).
We're just finishing off the last fixes for v1.7 and training the models â€“ the new update will be available very soon.
		</comment>
		<comment id='2' author='gartentrio(ghost)' date='2018-05-09T02:38:29Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>