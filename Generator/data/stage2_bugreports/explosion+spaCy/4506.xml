<bug id='4506' author='ines' open_date='2019-10-22T16:20:18Z' closed_time='2019-10-22T18:10:45Z'>
	<summary>Vectors.most_similar should always return 1.0 for identical vectors</summary>
	<description>
We should probably hard-code the workaround for the imprecision, just like we do for the built-in similarity methods.
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;




spaCy/spacy/tests/vocab_vectors/test_vectors.py


        Lines 144 to 154
      in
      74a19ae






 @pytest.mark.xfail 



 def test_vectors_most_similar_identical(): 



 """Test that most similar identical vectors are assigned a score of 1.0.""" 



 data = numpy.asarray([[4, 2, 2, 2], [4, 2, 2, 2], [1, 1, 1, 1]], dtype="f") 



 v = Vectors(data=data, keys=["A", "B", "C"]) 



 keys, _, scores = v.most_similar(numpy.asarray([[4, 2, 2, 2]], dtype="f")) 



 assert scores[0][0] == 1.0 # not 1.0000002 



 data = numpy.asarray([[1, 2, 3], [1, 2, 3], [1, 1, 1]], dtype="f") 



 v = Vectors(data=data, keys=["A", "B", "C"]) 



 keys, _, scores = v.most_similar(numpy.asarray([[1, 2, 3]], dtype="f")) 



 assert scores[0][0] == 1.0 # not 0.9999999 





	</description>
	<comments>
		<comment id='1' author='ines' date='2019-10-22T17:25:56Z'>
		Just out of curiosity - why is this a requirement? Shouldn't equality on real values always be tested with some margin?
		</comment>
		<comment id='2' author='ines' date='2019-10-22T18:03:06Z'>
		&lt;denchmark-link:https://github.com/svlandeg&gt;@svlandeg&lt;/denchmark-link&gt;
 It's not really a requirement, but when we didn't clip the values for the  methods, people found this pretty confusing (e.g. when  wasn't ). And since we're doing it this way for other similarity comparisons, we might as well do it for the .
		</comment>
		<comment id='3' author='ines' date='2019-11-21T18:54:50Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>