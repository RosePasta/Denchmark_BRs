<bug id='2231' author='marekmodry' open_date='2018-04-17T21:12:29Z' closed_time='2018-07-06T12:33:41Z'>
	<summary>Broken tqdm progress bar in built-in train method</summary>
	<description>
The tqdm progress bar in train method of spacy.cli.train does not work correctly when the training dataset contains documents that get filtered out by max_doc_len parameter.
total parameter of tqdm is set to the total number of tokens in the dataset (including those exceeding max_doc_len limit) even though only documents shorter than max_doc_len contributes to the updates of the progress bar pbar.
This causes the progress bar to stop before reaching 100%.
I am willing to contribute by fixing this.
Can you just help me understand the idea behind max_doc_len parameter so I can suggest a solution? Why is it needed? And why it is not applied also on the dev dataset?
Two ideas from the top of my head:

Move filtering before 


spaCy/spacy/cli/train.py


         Line 124
      in
      3141e04






 for i in range(n_iter): 




 (this way we would also avoid repeating the filtering in each iteration) and set tqdm's total to the actual number of tokens after filtering train_docs.
Filter documents when loading the corpus

Thank you for your suggestions.
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


spaCy version: 2.0.9
Platform: Darwin-16.7.0-x86_64-i386-64bit
Python version: 3.6.2
Models: en, en_core_web_lg, en_vectors_web_lg

	</description>
	<comments>
		<comment id='1' author='marekmodry' date='2018-05-02T08:02:43Z'>
		&lt;denchmark-link:https://github.com/marekmodry&gt;@marekmodry&lt;/denchmark-link&gt;
 You're right! That had confused me for some time, but I've got it fixed on develop.
The max_doc_len is no longer needed. The reason we needed it was that the previous alignment code was quite inefficient, and ran in O(n**2) time. I finally got around to fixing this. The faster alignment code will be rolled out in spaCy 2.1.
		</comment>
		<comment id='2' author='marekmodry' date='2018-05-02T13:49:31Z'>
		Thanks for the clarification and for fixing it. I guess we can close this issue then?
		</comment>
		<comment id='3' author='marekmodry' date='2018-08-05T12:52:29Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>