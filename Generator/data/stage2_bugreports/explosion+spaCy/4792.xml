<bug id='4792' author='karzmei' open_date='2019-12-11T09:24:53Z' closed_time='2020-04-15T21:45:02Z'>
	<summary>newline \n is captured as part of named entities?</summary>
	<description>
Hello there :)
I ran the following code:
&lt;denchmark-code&gt;import spacy
text = """"This is about Alice
who visited Wonderland. Alice?"""

nlp = spacy.load("en_core_web_sm", disable=["tagger", "parser"]) #  want NER only
doc = nlp(text)
NE = set()
for ent in doc.ents:
	print(ent.text, ent.label_)
	NE.add(ent.text)
print("The named entities are:", NE)
&lt;/denchmark-code&gt;

The result is:
&lt;denchmark-code&gt;Alice
 PERSON
Wonderland GPE
Alice PERSON
The named entities are: {'Alice\n', 'Wonderland', 'Alice'}
&lt;/denchmark-code&gt;

As you see, it includes "\n" as part of an entity found, and as a result treats "Alice" before line brake as different from a regular "Alice".
This bug seems to me similar to &lt;denchmark-link:https://github.com/explosion/spaCy/issues/2870&gt;#2870&lt;/denchmark-link&gt;
, which was claimed to be solved. So was it?
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


Operating System: Windows 7
Python Version Used: 3.7.3
spaCy Version Used: 2.2.3
Environment Information: ?

	</description>
	<comments>
		<comment id='1' author='karzmei' date='2019-12-11T11:08:40Z'>
		Hmm, I can't reproduce this. (Could it be related to Windows somehow?)
		</comment>
		<comment id='2' author='karzmei' date='2019-12-11T12:56:58Z'>
		Testing the original snippet on Windows:
&lt;denchmark-code&gt;text = """"This is about Alice
who visited Wonderland. Alice?"""
&lt;/denchmark-code&gt;

gives me the correct
&lt;denchmark-code&gt;Alice PERSON
Wonderland GPE
Alice PERSON
The named entities are: {'Wonderland', 'Alice'}
&lt;/denchmark-code&gt;

But if I alter the string to be
&lt;denchmark-code&gt;text = """"This is about Alice\n
who visited Wonderland. Alice?"""
&lt;/denchmark-code&gt;

I get
&lt;denchmark-code&gt;Alice

     PERSON
Wonderland GPE
Alice PERSON
The named entities are: {'Wonderland', 'Alice\n\n    ', 'Alice'}
&lt;/denchmark-code&gt;

And if I do
&lt;denchmark-code&gt;text = """"This is about Alice\n who visited Wonderland. Alice?"""
&lt;/denchmark-code&gt;

it does strip it:
&lt;denchmark-code&gt;Alice PERSON
Wonderland GPE
Alice PERSON
The named entities are: {'Alice', 'Wonderland'}
&lt;/denchmark-code&gt;

So not exactly the same behaviour - but something seems to be going on indeed ...
		</comment>
		<comment id='3' author='karzmei' date='2019-12-11T13:26:35Z'>
		Thank you both! So not on windows it works fine?
If I do text = """"This is about Alice\n who visited Wonderland. Alice?"""
it gives the correct output, otherwise it doesn't (I tries the options svlandeg tested and some more, e.g. inserting a space before the \n).
		</comment>
		<comment id='4' author='karzmei' date='2019-12-11T13:38:32Z'>
		I can get whitespace within the entity with two newlines followed by a space:
&lt;denchmark-code&gt;text = """This is about Alice\n\n who visited Wonderland. Alice?"""
&lt;/denchmark-code&gt;

Very strange!
		</comment>
		<comment id='5' author='karzmei' date='2019-12-11T13:55:04Z'>
		The option
&lt;denchmark-code&gt;text = """"This is about Alice\n\n
who visited Wonderland. Alice?"""
&lt;/denchmark-code&gt;

gives me (on windows) the correct output. While with just one \n there (Alice\n), it gives "Alice\n\n".
		</comment>
		<comment id='6' author='karzmei' date='2019-12-11T15:43:07Z'>
		I dug into the code a little and noticed that indeed this has been addressed before by &lt;denchmark-link:https://github.com/explosion/spaCy/commit/1e6725e9b734862e61081a916baf440697b9971e&gt;these edits&lt;/denchmark-link&gt;
, but partly &lt;denchmark-link:https://github.com/explosion/spaCy/commit/16c5861d29ba9bd82476171289cce86a79e1ec2d&gt;reverted&lt;/denchmark-link&gt;
 shortly after to specifically allow entities to end on white space again. So maybe this is not truely a bug but rather a model prediction error ?
		</comment>
		<comment id='7' author='karzmei' date='2020-04-15T21:45:02Z'>
		Sorry for the late follow-up. We discussed this internally, and in the end I don't really think this is a bug. At some point (as linked in my previous post) we did try to prevent whitespace in entities, but this would have resulted in some unwanted side-effects during training. Which meant that the whitespace had to be allowed again for some edge cases to work properly.
Anyway, I think your best option here is to preprocess your texts and clean them up slightly if you can, before you run them through the spaCy nlp pipeline. Sorry we don't really have a more satisfying answer :(
		</comment>
		<comment id='8' author='karzmei' date='2020-05-20T21:24:37Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>