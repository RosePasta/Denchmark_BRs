<bug id='1452' author='aoodham' open_date='2017-10-23T17:53:08Z' closed_time='2017-10-24T09:22:00Z'>
	<summary>Spanish tokenizer mutates the supplied text, but appears to keep no record of changes made</summary>
	<description>
Hi,
I'm using the spanish es_core_web_md and am finding that it mutates the supplied text such at the phrase 'al' gets transformed into 'ael'. I'm relatively new to the world of spacy, but there seems to be no record made of this transformation. This is a feature request to record these substitutions made so it's possible to map back from the spacy token.idx parameter to an index in the raw text supplied to the spacy pipeline. The cumulative effect of these extra 'e's means that tokens towards the end of large documents can have their index in spacy shifted quite dramatically from the original one supplied.
Currently we can by-pass this issue by suppling a special_case to the tokenizer to transform 'al' to 'al'. This however ignores the fact that normally this gets tokenized into two tokens, 'a' and 'el'.
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;

&lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;


spaCy version: 1.8.2
Platform: Linux-4.10.0-37-generic-x86_64-with-debian-stretch-sid
Python version: 3.6.1
Installed models:

	</description>
	<comments>
		<comment id='1' author='aoodham' date='2017-10-23T19:19:47Z'>
		If I'm understanding correctly, that's definitely a bug. The following should be true for any unicode string:
    text == nlp(text).text
Any case that breaks this invariant is a bug.
On the current v2 the problem seems to be solved:
    &gt;&gt;&gt; import spacy
    &gt;&gt;&gt; nlp =spacy.blank('es')
    &gt;&gt;&gt; nlp(u'al')
    al
The v2 model also performs quite a bit better on Spanish than the v1 model. You can get it with . Docs are available at &lt;denchmark-link:https://alpha.spacy.io&gt;https://alpha.spacy.io&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='aoodham' date='2017-10-24T08:21:28Z'>
		Thanks very much honnibal. I had suspected that the text == nlp(text).text should hold as an axiom of spacy.
I'll look into upgrading our system.
		</comment>
		<comment id='3' author='aoodham' date='2018-05-08T13:27:27Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>