<bug id='2871' author='jason-stein' open_date='2018-10-22T14:59:22Z' closed_time='2018-12-10T15:11:15Z'>
	<summary>Mismatch between token rank and vocab vector find.</summary>
	<description>
I have found a discrepancy between a token's rank and the lookup using tokenizer.vocab.vectors.find(), with the word "SUFFIX" (all caps). Furthermore, the index returned by .rank is causing range error in a tensorflow model trained on spaCy word vectors.
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;&gt;&gt;&gt; import spacy
&gt;&gt;&gt; nlp = spacy.load('en_core_web_lg')
&gt;&gt;&gt; nlp('SUFFIX')[0].rank
684829
&gt;&gt;&gt; nlp.tokenizer.vocab.vectors.find(key='SUFFIX')
-1
&gt;&gt;&gt; nlp('suffix')[0].rank
31698
&gt;&gt;&gt; nlp.tokenizer.vocab.vectors.find(key='suffix')
31698
&gt;&gt;&gt; spacy.__version__
'2.0.12'
&gt;&gt;&gt; en_core_web_lg.__version__
'2.0.0'
&gt;&gt;&gt; 
&lt;/denchmark-code&gt;

The bug is in lines 3 and 4. The lowercase version matches, as expected. This was discovered when a tensorflow model threw the following error, indicating that this is an invalid rank:
&lt;denchmark-code&gt;StatusCode.INVALID_ARGUMENT, indices[0,6] = 684829 is not in [0, 684824)
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


Operating System: OSX 10.13.6
Python Version Used: 3.6.6
spaCy Version Used: 2.0.12
spaCy Model Version: en_core_web_lg 2.0.0

	</description>
	<comments>
		<comment id='1' author='jason-stein' date='2018-10-22T15:02:40Z'>
		This appears to be an issue around certain spaCy keywords. Similar discrepancies exist for ORTH and PREFIX.
		</comment>
		<comment id='2' author='jason-stein' date='2018-10-28T14:38:17Z'>
		Thanks, I think I understand the problem here.
		</comment>
		<comment id='3' author='jason-stein' date='2019-01-09T15:12:37Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>