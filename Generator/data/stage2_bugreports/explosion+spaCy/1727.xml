<bug id='1727' author='bellatrics' open_date='2017-12-15T17:05:15Z' closed_time='2018-01-23T18:12:10Z'>
	<summary>AttributeError: 'FunctionLayer' object has no attribute 'vectors'</summary>
	<description>
First of all, many thanks for such a nice package.
The task I am solving is to have german model (with parser, ner) with fastText vectors.
There are many different ways that cause the AttributeError: 'FunctionLayer' object has no attribute 'vectors'. This one is the most concise one:
&lt;denchmark-code&gt;data = np.ones((3, 300), dtype='f')
keys = [u'ich', u'bin', u'haha']
vectors = Vectors(data=data, keys=keys)

nlp_de = spacy.load('de')
nlp_de.vocab.vectors = vectors

nlp_de.to_disk('./model_de')

nlp = spacy.load('./model_d')
&lt;/denchmark-code&gt;

All good and working, but before loading. Then it raises the error
Many different things I tried: creating vocabulary, assembling a pipeline... link_vectors_to_models ...
all lead to the same thing.
What works is creating a blank model, adding a tagger. But when adding a parser or ner then it is back to the problem.
Please, explain me if it is a bug or I do something bad. Also, what is the right way to add vectors to existing model and also map the keys in the vocab?
Thanks!
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


spaCy version: 2.0.3
Platform: Darwin-16.0.0-x86_64-i386-64bit
Python version: 3.6.0
Models: _de, de, en, en_core_web_lg, en_core_web_md

	</description>
	<comments>
		<comment id='1' author='bellatrics' date='2017-12-17T22:36:09Z'>
		same issue, see also &lt;denchmark-link:https://github.com/explosion/spaCy/issues/1661&gt;#1661&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='bellatrics' date='2017-12-17T22:39:26Z'>
		for a workaround, you can load load your model without vectors:
nlp = spacy.load("lang")
and then load your vectors with
nlp.vocab.vectors.from_disk("../spacy_vectors")
		</comment>
		<comment id='3' author='bellatrics' date='2017-12-29T00:29:43Z'>
		I'm getting the same error message when loading a packaged custom language model to which I added vectors.
If I import the version without vectors, I can load the vectors with &lt;denchmark-link:https://github.com/PricelessRabbit&gt;@PricelessRabbit&lt;/denchmark-link&gt;
's workaround and all is well (thanks!).
If I try and load the unpackaged version with vectors it fails to load in the pipeline from meta.json, leaving it empty.
		</comment>
		<comment id='4' author='bellatrics' date='2018-01-17T14:58:26Z'>
		I am evaluating your product Prodigy right now and I get the same error
		</comment>
		<comment id='5' author='bellatrics' date='2018-01-22T09:47:18Z'>
		Any updates? :)
		</comment>
		<comment id='6' author='bellatrics' date='2018-01-23T18:14:10Z'>
		Thanks for your patience on this.
The error is occurring because the tagger model was trained when no vectors were available, and then vectors are added later. When the model is saved, the tagger is checking whether the vectors exist, and writing the wrong attribute into its config file. When the model is reloaded, it consults its config and tries to deserialise the model with the has-vectors architecture. Specifically, it follows this branch of the conditional when creating the architecture: &lt;denchmark-link:https://github.com/explosion/spaCy/blob/v2.0.5/spacy/_ml.py#L271&gt;https://github.com/explosion/spaCy/blob/v2.0.5/spacy/_ml.py#L271&lt;/denchmark-link&gt;
 . After this function exits, we next try to deserialise the weights --- which were saved when no vectors were available. This causes the error we're seeing here.
The fix I've implemented is to simply avoid overwriting this pretrained_dims cfg setting when writing out the model. To workaround the bug in your current models, you might load back in the cfg file and fix the value of that entry. Alternatively, you could drop the vectors before serializing your model, and then only add them after you've loaded your model back from disk.
Thanks again for the report!
		</comment>
		<comment id='7' author='bellatrics' date='2018-01-23T18:18:32Z'>
		&lt;denchmark-link:https://github.com/honnibal&gt;@honnibal&lt;/denchmark-link&gt;
 thanks for the support, spacy is great! :)
		</comment>
		<comment id='8' author='bellatrics' date='2018-03-15T18:14:41Z'>
		To be clear @honnibol is saying change the cfg files so that every entry in pretrained_dims is 0 for every pipe (including the ner) in the model.
		</comment>
		<comment id='9' author='bellatrics' date='2018-05-07T21:52:47Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>