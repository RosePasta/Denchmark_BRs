<bug id='3962' author='JohnStuartRutledge' open_date='2019-07-13T22:43:59Z' closed_time='2019-07-23T21:08:39Z'>
	<summary>Doc.to_json() method fails when called on doc generated via `Span.as_doc()`</summary>
	<description>
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

It would appear that calling  on a Doc that was created via the  method is prone to failure. This may very well be connected to other issues with with  like the that mentioned in &lt;denchmark-link:https://github.com/explosion/spaCy/issues/3669&gt;issue #3669 &lt;/denchmark-link&gt;

import spacy

nlp = spacy.load('en')
doc = nlp('He jests at scars, that never felt a wound.')
span = doc[0:3]      # "He jests at"
doc2 = span.as_doc()
doc2.to_json()
# IndexError: [E040] Attempt to access token at 7, max length 3.
The above error seems to trigger when second token of the span (), calls &lt;denchmark-link:https://github.com/explosion/spaCy/blob/master/spacy/tokens/token.pyx#L609&gt;spacy.tokens.Token.head.__get__()&lt;/denchmark-link&gt;
 and hits the 
&lt;denchmark-h:h2&gt;Environment&lt;/denchmark-h&gt;


spaCy version: 2.1.6
Platform: Darwin-18.6.0-x86_64-i386-64bit
Python version: 3.6.4
Models: en

	</description>
	<comments>
		<comment id='1' author='JohnStuartRutledge' date='2019-07-15T17:58:37Z'>
		Yep, I can replicate this bug with en_core_web_md (not with en_core_web_lg) - looks like it's definitely connected to the trouble caused by the dependency parsing, as discussed in that other issue...
		</comment>
		<comment id='2' author='JohnStuartRutledge' date='2019-07-15T22:28:47Z'>
		&lt;denchmark-link:https://github.com/JohnStuartRutledge&gt;@JohnStuartRutledge&lt;/denchmark-link&gt;
 : I think we can fix this, cf. &lt;denchmark-link:https://github.com/explosion/spaCy/pull/3969&gt;#3969&lt;/denchmark-link&gt;
. Basically what happens in your example, is that the second word  refers to  (index: 7) as its head word in the dependency graph, but after the  operation that index is out of bounds. So we need to prevent copying that kind of out-of-span information ...
		</comment>
		<comment id='3' author='JohnStuartRutledge' date='2019-08-22T21:42:31Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>