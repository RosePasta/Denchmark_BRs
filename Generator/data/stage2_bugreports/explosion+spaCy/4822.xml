<bug id='4822' author='geektoni' open_date='2019-12-19T15:36:35Z' closed_time='2019-12-20T09:57:32Z'>
	<summary>spacy-lookups-data conda package creates spacy_lookups entry points as console scripts</summary>
	<description>
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

I have installed spaCy inside my conda environment by following the instructions provided by the official website &lt;denchmark-link:https://spacy.io/usage&gt;https://spacy.io/usage&lt;/denchmark-link&gt;
. I obviously selected the instructions for conda. However, I have noticed that the spaCy package causes a conflict with the bash command . Below the error that appears:
(spacy) geektoni@uriel:~/Github/spacy$ tr
Traceback (most recent call last):
  File "/home/geektoni/miniconda3/envs/spacy/bin/tr", line 10, in &lt;module&gt;
    sys.exit(tr())
TypeError: 'dict' object is not callable
This happens because spaCy install inside the bin directory of the conda environment an executable called tr and this will be called instead of the "standard" tr (calling which tr results in /home/geektoni/miniconda3/envs/spacy/bin/tr instead of /usr/bin/tr)
The following steps can be used to reproduce the error:
conda create -n spacy python=3.6
conda activate spacy
conda install -c conda-forge spacy
conda install -c conda-forge spacy-lookups-data
python -m spacy download en_core_web_sm
tr # This will cause the error
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


Operating System: Ubuntu 18.04
spaCy version: 2.2.3
Platform: Linux-5.0.0-37-generic-x86_64-with-debian-buster-sid
Python version: 3.6.9

	</description>
	<comments>
		<comment id='1' author='geektoni' date='2019-12-19T16:18:27Z'>
		I'm confused where the  executable comes from... the only executable included with spaCy is  (&lt;denchmark-link:https://github.com/explosion/spaCy/blob/master/MANIFEST.in&gt;see here&lt;/denchmark-link&gt;
). We don't have a  in the repo either (&lt;denchmark-link:https://github.com/explosion/spaCy/tree/master/bin&gt;see here&lt;/denchmark-link&gt;
).
Can you share the contents of that file?
Edit: Ah, maybe this is caused by entry points in your conda environment? The spacy-lookups-data package exposes an entry point tr (for the Turkish language data) that spaCy can read from. But those are under our own namespace, spacy_lookups. As far as I know, entry points are only installed as Python executables if they're defined as console_scripts...  but maybe this is somehow related to how the conda-forge build is set up?
 Okay, pretty sure this is related to the conda package setup â€“ see the conda-forge &lt;denchmark-link:https://github.com/conda-forge/spacy-lookups-data-feedstock/blob/master/recipe/meta.yaml#L16&gt;meta.yaml&lt;/denchmark-link&gt;
. It's not defining the entry point group correctly, so the entry point is interpreted as a console script. Whereas the package's  correctly defines the entry points as part of the group  (&lt;denchmark-link:https://github.com/explosion/spacy-lookups-data/blob/master/setup.cfg#L37&gt;see here&lt;/denchmark-link&gt;
).
 Now we only need to find out how to define non-console scripts entry points for conda  The &lt;denchmark-link:https://conda.io/projects/conda-build/en/latest/resources/define-metadata.html#python-entry-points&gt;examples&lt;/denchmark-link&gt;
 only show top-level entry points for console scripts...
		</comment>
		<comment id='2' author='geektoni' date='2019-12-19T16:51:27Z'>
		This was a nasty problem! So apparently the  block in Conda is somewhat misnamed. When the schema was first defined, the developer wasn't really thinking about non-script entry-points as a feature, because it didn't work very well at the time: &lt;denchmark-link:https://github.com/conda/conda/issues/404&gt;conda/conda#404&lt;/denchmark-link&gt;

The entry-points block has kept the confusing name ever since. So that's how I fell into the trap: we advertise those entry-points, but when I added them under the entry-points group, they were installed as console scripts by conda :(.
We should have a new build up soon: &lt;denchmark-link:https://github.com/conda-forge/spacy-lookups-data-feedstock/pull/5&gt;conda-forge/spacy-lookups-data-feedstock#5&lt;/denchmark-link&gt;

I use tr quite often myself, but I don't really use Conda...I guess it's lucky that there's no ls country code.
		</comment>
		<comment id='3' author='geektoni' date='2019-12-20T09:57:31Z'>
		&lt;denchmark-link:https://github.com/conda-forge/spacy-lookups-data-feedstock/pull/5&gt;conda-forge/spacy-lookups-data-feedstock#5&lt;/denchmark-link&gt;
 managed to fix the issue!  works again now. Thank you for the quick reply and support! 
		</comment>
		<comment id='4' author='geektoni' date='2020-01-19T11:44:25Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>