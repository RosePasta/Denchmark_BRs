<bug id='4650' author='lhyleo' open_date='2019-11-14T18:33:37Z' closed_time='2020-02-13T16:29:29Z'>
	<summary>AssertionError when running beam_parse</summary>
	<description>
It might be related to &lt;denchmark-link:url&gt;https://github.com/explosion/spaCy/issues/4313&lt;/denchmark-link&gt;
, but I cannot figure out how to reopen an issue
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

import spacy

nlp = spacy.load('en_core_web_lg')
doc = nlp("Our principal executive office is located at 333 South Grand Avenue, 28th Floor, Los Angeles, CA 90071 and our telephone number is (213) 830-6300.") 
docs = [doc]
ner = nlp.get_pipe('ner')
beams = ner.beam_parse(docs, beam_width=5)
I got the following traceback:
&lt;denchmark-code&gt;AssertionError                            Traceback (most recent call last)
&lt;ipython-input-4-7f0219500ddb&gt; in &lt;module&gt;
      2 docs = [doc]
      3 ner = nlp.get_pipe('ner')
----&gt; 4 beams = ner.beam_parse(docs, beam_width=5)

nn_parser.pyx in spacy.syntax.nn_parser.Parser.beam_parse()

nn_parser.pyx in spacy.syntax.nn_parser.Parser.transition_beams()

search.pyx in thinc.extra.search.Beam.advance()

AssertionError: 
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


Operating System: macOS 14.10.6
Python Version Used: 3.7.4
spaCy Version Used: 2.1.9

	</description>
	<comments>
		<comment id='1' author='lhyleo' date='2019-11-14T19:27:49Z'>
		This is indeed a duplicate of &lt;denchmark-link:https://github.com/explosion/spaCy/issues/4313&gt;#4313&lt;/denchmark-link&gt;
. It was fixed recently and should work in spacy v2.2.0+.
		</comment>
		<comment id='2' author='lhyleo' date='2019-11-14T19:55:23Z'>
		Is there a work around for spacy 2.1.x?
		</comment>
		<comment id='3' author='lhyleo' date='2019-11-14T20:50:35Z'>
		Have you tried the suggested workaround from &lt;denchmark-link:https://github.com/explosion/spaCy/issues/4313#issuecomment-536022028&gt;#4313 (comment)&lt;/denchmark-link&gt;
?
		</comment>
		<comment id='4' author='lhyleo' date='2019-11-15T17:27:01Z'>
		Yes, in fact, I am not adding any new labels to the model and only using the original model. I tried to do nlp.entity.add_label() for every labels appear in the doc but it is still throwing the assertion error
		</comment>
		<comment id='5' author='lhyleo' date='2020-02-13T16:29:29Z'>
		Closing this as the bug was fixed in PR &lt;denchmark-link:https://github.com/explosion/spaCy/pull/4330&gt;#4330&lt;/denchmark-link&gt;
.
		</comment>
		<comment id='6' author='lhyleo' date='2020-03-17T13:27:47Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>