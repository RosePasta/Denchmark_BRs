<bug id='188' author='andreasgrv' open_date='2015-11-23T16:42:13Z' closed_time='2016-01-19T22:18:41Z'>
	<summary>Merging spans in noisy text can affect sentence splitting and subtree property</summary>
	<description>
After merging named entities in noisy text most of the times everything works fine, however sometimes unexpected things happen! ^_^
doc = nlp(u'A popcorn named John Spik added a weird url after a question mark? http://www.what-why.com\n')
for sent in doc.sents:
    print('%s : [%s, %s]' % (sent, sent.start, sent.end))
out:
&lt;denchmark-code&gt;A popcorn named John Spik added a weird url after a question mark? : [0, 14]
http://www.what-why.com
 : [14, 18]
&lt;/denchmark-code&gt;

for ent in doc.ents:                                                                                                                        
    ent.merge(ent.root.tag_ , ent.text, ent.label_)

for sent in doc.sents:
    print('%s : [%s, %s]' % (sent, sent.start, sent.end))
out:
&lt;denchmark-code&gt;A popcorn named John Spik added a weird url after a question mark? : [0, 13]
http://www.what : [13, 14]
-why.com : [14, 16]
  : [16, 17]   # this is the \n
&lt;/denchmark-code&gt;

doc = nlp(u'RT 136 children killed in Peshawar Everyone Outraged 3000 Yezidi kids killed by ISIS - every 1 Silent? http://‚Ä¶\n')
for sent in doc.sents:
    print(list(sent.root.subtree))
&lt;denchmark-code&gt;[RT , 136 , children , killed , in , Peshawar , Everyone , Outraged , 3000 , Yezidi , kids , killed , by , ISIS , - , every , 1 , Silent, ? ]
[http://‚Ä¶]
&lt;/denchmark-code&gt;

for ent in doc.ents:                                                                                                                        
    ent.merge(ent.root.tag_ , ent.text, ent.label_)

for sent in doc.sents:
    print(list(sent.root.subtree))
state:
&lt;denchmark-code&gt;Infinite recursion
&lt;/denchmark-code&gt;

	</description>
	<comments>
		<comment id='1' author='andreasgrv' date='2015-11-27T09:42:21Z'>
		Thanks. I made a change that was supposed to prevent the NER from tagging entities across sentence boundaries. It looks like I introduced this bug from that change. I'll have a look at this.
(Sorry I've been a bit slow on the bug fixes the last week or two. I've had my head down trying to finish the neural network code, to update the model. According to published results this should improve accuracy, and cut memory usage substantially.)
		</comment>
		<comment id='2' author='andreasgrv' date='2015-11-27T09:47:54Z'>
		Nice üëç
No worries, I've currently just commented out the merging part of the code
		</comment>
		<comment id='3' author='andreasgrv' date='2016-01-19T13:22:14Z'>
		This was caused by the same problem as Issue &lt;denchmark-link:https://github.com/explosion/spaCy/issues/214&gt;#214&lt;/denchmark-link&gt;
 , so I think my fix there applies. Your example is working on master for me now, and should be fixed in v100, which will be out shortly.
Thanks for your patience!
		</comment>
		<comment id='4' author='andreasgrv' date='2016-01-19T13:32:49Z'>
		Nice üëç
Thanks for the fix, will check it out!
		</comment>
		<comment id='5' author='andreasgrv' date='2016-01-19T22:18:41Z'>
		Just pushed v0.100, which should have this fixed. If you have any problems, please reopen this and let us know.
		</comment>
		<comment id='6' author='andreasgrv' date='2018-05-09T15:31:44Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>