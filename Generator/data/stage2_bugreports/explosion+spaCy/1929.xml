<bug id='1929' author='joelb-git' open_date='2018-02-03T13:24:53Z' closed_time='2018-02-08T14:26:06Z'>
	<summary>Mention extraction issue with external sentence boundaries</summary>
	<description>
&lt;denchmark-h:h2&gt;Mention extraction issue with external sentence boundaries&lt;/denchmark-h&gt;

We're trying to make spacy respect sentence boundaries provided
externally using this method:
&lt;denchmark-link:https://github.com/explosion/spaCy/pull/1400&gt;#1400&lt;/denchmark-link&gt;

We found that this affects the mention extraction.  We then tried to
pass each sentence individually, using this trick to prevent spacy
adding more sentence breaks:
&lt;denchmark-link:https://github.com/explosion/spaCy/issues/1032#issuecomment-343233390&gt;#1032 (comment)&lt;/denchmark-link&gt;

But this also seems to affect mention extraction in a similar way.
The test below runs a single sentence through spacy showing the
before/after behavior when changing is_sent_start.
&lt;denchmark-code&gt;$ cat foo.py
import spacy


nlp = spacy.load('en')
doc = nlp('Bill Clinton was president.')
print([t.is_sent_start for t in doc])
print([m for m in doc.ents])

def manual_sentence_segmentation(doc):
    for i, token in enumerate(doc):
        token.is_sent_start = i == 0
    return doc

nlp.add_pipe(manual_sentence_segmentation, name='manual-sbd', before='parser')
doc = nlp('Bill Clinton was president.')
print([t.is_sent_start for t in doc])
print([m for m in doc.ents])
&lt;/denchmark-code&gt;

Output:
&lt;denchmark-code&gt;$ python foo.py
[None, None, None, None, None]
[Bill Clinton]
[True, False, False, False, False]
[Clinton]  &lt;-- expected this to be [Bill Clinton]
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;


spaCy version: 2.0.4
Platform: Darwin-16.7.0-x86_64-i386-64bit
Python version: 3.6.0
Models: en

	</description>
	<comments>
		<comment id='1' author='joelb-git' date='2018-02-08T11:35:21Z'>
		This seems to be a bug related to the is_sent_start value on the first word of the document. Try not setting the first token --- it seems to work without it?
		</comment>
		<comment id='2' author='joelb-git' date='2018-02-08T12:48:27Z'>
		Setting is_sent_start to False on the first token (and others) results in the same behavior:
&lt;denchmark-code&gt;[None, None, None, None, None]
[Bill Clinton]
[False, False, False, False, False]
[Clinton]
&lt;/denchmark-code&gt;

		</comment>
		<comment id='3' author='joelb-git' date='2018-02-08T14:21:36Z'>
		Hmm I made a mistake in the example I tried. I'm not sure what's going on here -- seems like there might be a bug in the NER transition system.
Edit: Yes, definitely. The sent_start attribute was changed to take ternary values, and there's code in the NER transition system that's checking it as a boolean. This means the -1 value is evaluating to True. Thanks for the report --- will have this fixed in the next version.
		</comment>
		<comment id='4' author='joelb-git' date='2018-05-07T23:55:37Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>