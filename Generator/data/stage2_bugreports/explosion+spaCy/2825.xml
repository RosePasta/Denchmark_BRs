<bug id='2825' author='ines' open_date='2018-10-05T19:22:17Z' closed_time='2018-12-19T01:15:20Z'>
	<summary>ðŸ’« Segfault if doc.ents includes previously set entities with unknown label</summary>
	<description>
Potentially related: &lt;denchmark-link:https://github.com/explosion/spaCy/issues/2779&gt;#2779&lt;/denchmark-link&gt;

&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

The entity recognizer should respect previously set entities, both with unknown labels (not added to the model) and known labels (added to the model). The following causes a segmentation fault:
from spacy.lang.en import English
from spacy.tokens import Span

nlp = English()
ner = nlp.create_pipe('ner')
nlp.add_pipe(ner)
nlp.begin_training()

def test_component(doc):
    doc.ents = [Span(doc, 0, 1, label=doc.vocab.strings['YOLO'])]
    return doc

nlp.add_pipe(test_component, before='ner')
doc = nlp("Hello world")
Adding ner.add_label('YOLO') makes the code run as expected (but also adds a label to the model, which shouldn't be the default case).
The same problem occurs if no label is specified on the span:
from spacy.lang.en import English

nlp = English()
nlp.add_pipe(nlp.create_pipe('ner'))
nlp.begin_training()

def test_component(doc):
    doc.ents = [doc[0:1]]
    return doc

nlp.add_pipe(test_component, before='ner')
doc = nlp("Hello world")
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


spaCy version: 2.1.0a1 (spacy-nightly)
Platform: Darwin-18.0.0-x86_64-i386-64bit (macOS 10.14)
Python version: 3.6.0

	</description>
	<comments>
		<comment id='1' author='ines' date='2018-12-19T01:15:20Z'>
		Fixed by &lt;denchmark-link:https://github.com/explosion/spaCy/commit/e24f94ce3942f4055514b30df8e05095cd8b5fb6&gt;e24f94c&lt;/denchmark-link&gt;
 
		</comment>
		<comment id='2' author='ines' date='2019-01-18T01:57:27Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>