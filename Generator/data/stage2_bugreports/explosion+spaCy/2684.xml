<bug id='2684' author='thomasopsomer' open_date='2018-08-19T20:23:45Z' closed_time='2018-12-10T13:42:49Z'>
	<summary>[v2.1] TextCategorizer fails at inference time because of 'drop' being None</summary>
	<description>
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

Hi,
I just tried the new pre release of spacy 2.1, and there is an issue with the TextCategorizer at inference time. The problem is that the drop parameter being None in the forward pass break the concatenate_lists function. To reproduce:
import spacy
from spacy.pipeline import TextCategorizer
from spacy.gold import GoldParse

nlp = spacy.load("en_core_web_md")
textcat = TextCategorizer(nlp.vocab, pretrained_dims=300)

for label in ["cat_1", "cat_2", "cat_3"]:
    textcat.add_label(label)

nlp.add_pipe(textcat)

doc = nlp.tokenizer("Apple builds Iphones.")
cats = {"cat_1": True, "cat_2": False, "cat_3": True}
gold = GoldParse(doc, cats=cats)
with nlp.disable_pipes(*["ner", "tagger", "parser"]):
    optimizer = nlp.begin_training()
    losses = {}
    nlp.update([doc], [gold], sgd=optimizer, drop=0.2, losses=losses)

# inference
nlp("Apple builds Iphones.").cats
it results in:
&lt;denchmark-code&gt;  File "/Users/thomasopsomer/Envs/spacy-nightly/lib/python3.6/site-packages/thinc/api.py", line 61, in begin_update
    X, inc_layer_grad = layer.begin_update(X, drop=drop)
  File "&lt;stdin&gt;", line 15, in concatenate_lists_fwd
TypeError: unsupported operand type(s) for *=: 'NoneType' and 'float'
&lt;/denchmark-code&gt;

And just a comment on the textcat, it's a bit strange that the pretrained vectors are not used by default when available.
btw speed improvement in v2.1 are awesome :) about 30% !
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


spaCy version: 2.1.0a1
Platform: Darwin-16.7.0-x86_64-i386-64bit
Python version: 3.6.2
Models: en, en_core_web_md

	</description>
	<comments>
		<comment id='1' author='thomasopsomer' date='2018-08-22T12:34:03Z'>
		Thanks. That's two bugs, really --- we should be using the vectors if they're available by default.
		</comment>
		<comment id='2' author='thomasopsomer' date='2018-12-10T13:42:49Z'>
		Both should be fixed now.
		</comment>
		<comment id='3' author='thomasopsomer' date='2019-01-09T14:12:39Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>