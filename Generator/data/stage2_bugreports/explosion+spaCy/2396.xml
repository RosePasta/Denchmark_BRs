<bug id='2396' author='slavi' open_date='2018-05-30T14:38:25Z' closed_time='2018-12-29T17:02:28Z'>
	<summary>get_lca_matrix is incorrect</summary>
	<description>
&lt;denchmark-link:https://github.com/ramananbalakrishnan&gt;@ramananbalakrishnan&lt;/denchmark-link&gt;

In spacy version 2.0.11

s = u"He created a test for spacy"
doc = nlp(s)
doc.get_lca_matrix()[3][5]

Expected: 3
Actual: 1
This branch of the recursion is incorrect:
&lt;denchmark-link:https://github.com/explosion/spaCy/blob/master/spacy/tokens/doc.pyx#L732&gt;https://github.com/explosion/spaCy/blob/master/spacy/tokens/doc.pyx#L732&lt;/denchmark-link&gt;

It assumes that if n1 and n2 are not adjacent, then LCA(n1, n2) = LCA(n1.head, n2.head).
This is generally not true: there are many counterexamples, the above one with 3 nodes in a chain is the simplest.
	</description>
	<comments>
		<comment id='1' author='slavi' date='2018-05-30T15:04:01Z'>
		Hi &lt;denchmark-link:https://github.com/slavi&gt;@slavi&lt;/denchmark-link&gt;
 , thanks for catching that.
I had ported this section of the code during the transition from v1 to v2 (relevant PR &lt;denchmark-link:https://github.com/explosion/spaCy/pull/1443&gt;#1443&lt;/denchmark-link&gt;
)
Would you be able to make the required change and send a pull request?
		</comment>
		<comment id='2' author='slavi' date='2018-06-04T22:30:42Z'>
		Thanks for the report, and yes -- a pull request would be much appreciated!
		</comment>
		<comment id='3' author='slavi' date='2018-12-22T16:55:24Z'>
		I reimplemented the function to solve this issue, PR &lt;denchmark-link:https://github.com/explosion/spaCy/pull/3089&gt;here&lt;/denchmark-link&gt;
.
		</comment>
		<comment id='4' author='slavi' date='2019-01-28T17:05:22Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>