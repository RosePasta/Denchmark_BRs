<bug id='3431' author='emiguevara' open_date='2019-03-19T15:17:29Z' closed_time='2019-03-20T11:10:00Z'>
	<summary>Doc.vector and Doc.vector_norm not working with GPU</summary>
	<description>
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;virtualenv --python=python3.6 env
source env/bin/activate
pip install --no-cache-dir spacy[cuda90] jupyter
python -m spacy download en_core_web_lg
&lt;/denchmark-code&gt;

&lt;denchmark-code&gt;import spacy
spacy.require_gpu()
import en_core_web_lg
nlp = en_core_web_lg.load()

txt = (
    'A deadly cyclone that struck Mozambique and other countries in southern Africa '
    'has nearly obliterated the worst-affected areas, flooding vast stretches of land, '
    'destroying roads and dams, and cutting off victims from help. '
    'The cyclone, called Idai, has affected more than 1.5 million people, '
    'with a death toll now in the dozens but feared to be far higher. '
    'The storm destroyed “90 percent” of Beira, a city of about a half-million '
    'people that is Mozambique’s fourth largest and faces the Indian Ocean, the '
    'International Federation of Red Cross and Red Crescent Societies said on Monday.'
)
doc = nlp(txt)

print(doc.has_vector)
print(doc.vector)

True
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
&lt;ipython-input-20-93c3a0ab48a5&gt; in &lt;module&gt;
      1 print(doc.has_vector)
----&gt; 2 print(doc.vector)

doc.pyx in __iter__()
cupy/core/core.pyx in cupy.core.core.ndarray.__add__()
cupy/core/_kernel.pyx in cupy.core._kernel.ufunc.__call__()
cupy/core/_kernel.pyx in cupy.core._kernel._preprocess_args()
TypeError: Unsupported type &lt;class 'numpy.ndarray'&gt;
&lt;/denchmark-code&gt;

&lt;denchmark-code&gt;print(doc.vector_norm)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
&lt;ipython-input-21-1ca711652528&gt; in &lt;module&gt;
----&gt; 1 print(doc.vector_norm)
doc.pyx in spacy.tokens.doc.Doc.vector_norm.__get__()
doc.pyx in __iter__()
cupy/core/core.pyx in cupy.core.core.ndarray.__add__()
cupy/core/_kernel.pyx in cupy.core._kernel.ufunc.__call__()
cupy/core/_kernel.pyx in cupy.core._kernel._preprocess_args()
TypeError: Unsupported type &lt;class 'numpy.ndarray'&gt;
&lt;/denchmark-code&gt;

This is most probably related to &lt;denchmark-link:https://github.com/explosion/spaCy/issues/3348&gt;#3348&lt;/denchmark-link&gt;
 and &lt;denchmark-link:https://github.com/explosion/spaCy/issues/3412&gt;#3412&lt;/denchmark-link&gt;
. Maybe the fix in &lt;denchmark-link:https://github.com/explosion/spaCy/pull/3362&gt;#3362&lt;/denchmark-link&gt;
 was not enough.
NB: other instances of .vector seem to be working fine: for example, Token.vector and Ent.vector
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


spaCy version: 2.1.0
Platform: Linux-4.15.0-46-generic-x86_64-with-Ubuntu-18.04-bionic
Python version: 3.6.7
Environment Information: Cuda 9.0, Cudnn 7.5.0

	</description>
	<comments>
		<comment id='1' author='emiguevara' date='2019-04-19T11:59:02Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>