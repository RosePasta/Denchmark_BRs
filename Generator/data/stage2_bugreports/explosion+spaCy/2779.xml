<bug id='2779' author='imaurer' open_date='2018-09-20T11:39:07Z' closed_time='2018-12-19T01:15:06Z'>
	<summary>EntityRuler throws Segmentation Fault in complex pattern case</summary>
	<description>
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

import spacy
nlp = spacy.load("en_core_web_lg")
ruler = nlp.create_pipe('entity_ruler')
nlp.add_pipe(ruler, before="ner")
ruler.add_patterns([{"label": "PRODUCT", "pattern": [{"lower": "arial"}, {"lower": "("}, {"lower": "ab987"}, {"lower": ")"}, {"lower": "foo"}, {"lower": "bar"}, {"lower": "baz"}, {"lower": "boo"}]}])
nlp("Arial (ab987) foo bar baz boo")
Results in:Segmentation fault: 11
&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


Operating System: Mac OS X (10.13.6)
Python Version Used: 3.6.6
spaCy Version Used: 2.1.0a1
Environment Information: built from commit 1759abf on develop branch

Related to Issue &lt;denchmark-link:https://github.com/explosion/spaCy/pull/2513&gt;#2513&lt;/denchmark-link&gt;

	</description>
	<comments>
		<comment id='1' author='imaurer' date='2018-09-20T11:50:39Z'>
		Thanks a lot â€“ also for testing the entity ruler with a real-world use case! This is really helpful. I suspect this case might have something to do with how the entity recognizer handles existing entities in this particular case.
		</comment>
		<comment id='2' author='imaurer' date='2018-10-03T18:47:47Z'>
		Hi,
I too am getting a segmentation fault on this example (which is a common pattern we are using). (I just installed the nightly build using pip install spacy-nightly)
&lt;denchmark-code&gt;import spacy
nlp = spacy.load("en_core_web_lg")
ruler = nlp.create_pipe('entity_ruler')
nlp.add_pipe(ruler, before="ner")
ruler.add_patterns([{"label": "Age", "pattern":[{"IS_DIGIT":True},{"LOWER":"years"}]}])
nlp("10 years")
&lt;/denchmark-code&gt;

		</comment>
		<comment id='3' author='imaurer' date='2018-12-19T01:15:06Z'>
		Thanks for the report! Fixed on develop now. Will be out in the next nightly.
		</comment>
		<comment id='4' author='imaurer' date='2019-01-18T01:57:33Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>