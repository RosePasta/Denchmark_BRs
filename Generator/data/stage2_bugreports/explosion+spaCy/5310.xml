<bug id='5310' author='jsekamane' open_date='2020-04-15T10:57:55Z' closed_time='2020-04-29T11:04:36Z'>
	<summary>Bug in `is_new_osx()` â€“ specifically returning the current minor version of macOS / Mac OS X</summary>
	<description>
Orginal function:



spaCy/setup.py


        Lines 15 to 27
      in
      3d2c308






 def is_new_osx(): 



 """Check whether we're on OSX &gt;= 10.10""" 



 name = distutils.util.get_platform() 



 if sys.platform != "darwin": 



 return False 



 elif name.startswith("macosx-10"): 



 minor_version = int(name.split("-")[1].split(".")[1]) 



 if minor_version &gt;= 7: 



 return True 



 else: 



 return False 



 else: 



 return False 





Tests on macOS Catalina version 10.15.4 (19E287):
$ python3
&gt;&gt; import sys
&gt;&gt; sys.platform
'darwin'

&gt;&gt; import distutils.util
&gt;&gt; distutils.util.get_platform()
'macosx-10.6-intel'

&gt;&gt; import platform
&gt;&gt; platform.platform()
'Darwin-19.4.0-x86_64-i386-64bit'

&gt;&gt; platform.mac_ver()
('10.15.4', ('', '', ''), 'x86_64')
A closer look at the &lt;denchmark-link:https://docs.python.org/3/library/sysconfig.html#sysconfig.get_platform&gt;documentation&lt;/denchmark-link&gt;
 of  shows that Mac OS X can return:

macosx-10.6-ppc
macosx-10.4-ppc64
macosx-10.3-i386
macosx-10.4-fat

So clearly minor_version will never equal or exceed 7 in the original function.
Proposed function:
import sys
import platform
def is_new_osx():
    """Check whether we're on OSX &gt;= 10.10"""
    if sys.platform != 'darwin':
        return False
    else:
        minor_version = int(platform.mac_ver()[0].split('.')[1])
        if minor_version &gt;= 7:
            return True
        else:
            return False
There is also a mismatch between the comment saying  and the code saying . Perhaps &lt;denchmark-link:https://github.com/honnibal&gt;@honnibal&lt;/denchmark-link&gt;
 knows the rational for this?
	</description>
	<comments>
		<comment id='1' author='jsekamane' date='2020-04-15T11:16:42Z'>
		Note that  behaves differently in Python3 and Python2.7: &lt;denchmark-link:https://stackoverflow.com/a/27204111/1053612&gt;https://stackoverflow.com/a/27204111/1053612&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='jsekamane' date='2020-04-29T09:27:07Z'>
		Thanks so much for the detailed report, &lt;denchmark-link:https://github.com/jsekamane&gt;@jsekamane&lt;/denchmark-link&gt;
 !
I created a PR here: &lt;denchmark-link:https://github.com/explosion/spaCy/pull/5376&gt;#5376&lt;/denchmark-link&gt;
 - could you please review?
I changed your proposed solution a bit, as it wasn't checking on the "10" bit anymore, so I think it would be returning True for e.g. "9.8" ?
I also think that the comment should have read OSX &gt;= 10.7 instead of 10.10. Also requested a review from Matt to get his 2 cents on the issue.
		</comment>
		<comment id='3' author='jsekamane' date='2020-04-29T11:04:35Z'>
		PR &lt;denchmark-link:https://github.com/explosion/spaCy/pull/5376&gt;#5376&lt;/denchmark-link&gt;
 has been merged so tentavily closing this - let me know if you do run into issues though, &lt;denchmark-link:https://github.com/jsekamane&gt;@jsekamane&lt;/denchmark-link&gt;
 . This will be live from spacy 3.0 onwards.
		</comment>
	</comments>
</bug>