<bug id='3170' author='f11r' open_date='2019-01-18T15:58:37Z' closed_time='2019-02-25T20:25:53Z'>
	<summary>Parser assigns head from different sentence</summary>
	<description>
The expectation is that every assigned token.head is present in the same sentence span, correct?
The following code raises an exception, as the head of Trotz is anheizen, even though the sentence is split into the two parts Trotz [...] Teuerungsrate and ist [...] dürfte..
&lt;denchmark-code&gt;import de_core_news_sm

nlp = de_core_news_sm.load()
doc = nlp('''Trotz der beschleunigten
Teuerungsrate ist die Stimmung in der Wirtschaft
so gut, dass die Löhne in vielen Branchen steigen,
was die Inflation weiter anheizen dürfte.
''')
for sent in doc.sents:
    for token in sent:
        assert token.head in sent, (token, token.head, sent)
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


spaCy version: 2.1.0a5
Platform: Linux-4.14.89-x86_64-with-glibc2.9
Python version: 3.6.7

	</description>
	<comments>
		<comment id='1' author='f11r' date='2019-01-21T11:42:54Z'>
		This looks to be a bug in the way the sentences are calculated, thanks. It looks like somewhere the code is assuming the parse is projective, when in fact it can be non-projective. I thought I had fixed this bug, but apparently not!
		</comment>
		<comment id='2' author='f11r' date='2019-02-21T09:39:06Z'>
		The specific example is working in v2.1.0a7. I'm worried that a small model change makes this particular example work, and the underlying bug is still there...But lacking a specific example I'll close this anyway. Hopefully if there's really an issue here we can get to the bottom of it soon.
		</comment>
		<comment id='3' author='f11r' date='2019-02-22T09:30:38Z'>
		&lt;denchmark-link:https://github.com/honnibal&gt;@honnibal&lt;/denchmark-link&gt;
 Here are some examples that are still broken in :
&lt;denchmark-code&gt;import de_core_news_sm

nlp = de_core_news_sm.load()
texts = [
'Diesmal hatte zwar der Freistaat die finanzielle Regie, aber die Gemeinde beteiligte sich in erheblichem Umfang an der Infrastruktur und nahm die Gelegenheit wahr, selbst eine Umgehungsstraße zu bauen, was auch Voraussetzung für eine Dorferneuerung war, die noch 2012 eingeleitet werden sollte.'
'''
1823 wurde Martin von Samuel Prowett, einem amerikanischen Verleger, damit beauftragt, John Milton Paradise Lost zu illustrieren, wofür ihm 2000 Pfund gezahlt wurden. Noch bevor die ersten 24 Stiche fertiggestellt waren, wurden ihm weitere 1500 Pfund für einen zweiten Satz von 24 kleineren Stichen gezahlt.''',
'''
Über diese Zurückweisung und die Transformation von Liliput in das Land von Gulliver ist Edward so verärgert, dass er ins feindliche Königreich Blefuscu überläuft und deren Truppen einen Bauplan für einen Roboter übergibt, den er in einem Magazin gefunden hat, das Gulliver mitbrachte.
''',
]

for text in texts:
    doc = nlp(text)
    for sent in doc.sents:
        for token in sent:
            if token.head not in sent:
                print(token, token.head, sent)
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;


spaCy version: 2.1.0a8
Platform: Linux-4.14.98-x86_64-with-glibc2.10
Python version: 3.7.2
Models: en, de

		</comment>
		<comment id='4' author='f11r' date='2019-02-22T13:21:42Z'>
		Thanks! Will investigate.
		</comment>
		<comment id='5' author='f11r' date='2019-02-25T20:25:23Z'>
		I see my previous fix wasn't enough for the tree shapes in these examples. The change I've made isn't very satisfying -- just looping again to fix things -- but I think it should work.
		</comment>
		<comment id='6' author='f11r' date='2019-03-27T20:31:54Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>