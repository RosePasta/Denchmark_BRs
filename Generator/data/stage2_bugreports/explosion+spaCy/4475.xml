<bug id='4475' author='jack-rory-staunton' open_date='2019-10-18T20:46:24Z' closed_time='2019-10-23T12:41:22Z'>
	<summary>Bug in example</summary>
	<description>
There is a slight error in the logic that causes incorrect deletion of entities which should be kept.
&lt;denchmark-h:h2&gt;Which page or section is this issue related to?&lt;/denchmark-h&gt;

&lt;denchmark-link:https://spacy.io/usage/rule-based-matching&gt;https://spacy.io/usage/rule-based-matching&lt;/denchmark-link&gt;

in the section Models and Rules,
in the example code snippet below,
&lt;denchmark-code&gt;from spacy.tokens import Span


def expand_person_entities(doc):
    new_ents = []
    for ent in doc.ents:
        # Only check for title if it's a person and not the first token
        if ent.label_ == "PERSON" and ent.start != 0:
            prev_token = doc[ent.start - 1]
            if prev_token.text in ("Dr", "Dr.", "Mr", "Mr.", "Ms", "Ms."):
                new_ent = Span(doc, ent.start - 1, ent.end, label=ent.label)
                new_ents.append(new_ent)
        else:
            new_ents.append(ent)
    doc.ents = new_ents
    return doc
&lt;/denchmark-code&gt;

One quick way to fix this would be:
&lt;denchmark-code&gt;from spacy.tokens import Span

def expand_person_entities(doc):
    new_ents = []
    for ent in doc.ents:
        # Only check for title if it's a person and not the first token
        if ent.label_ == "PERSON" and ent.start != 0:
            prev_token = doc[ent.start - 1]
            if prev_token.text in ("Dr", "Dr.", "Mr", "Mr.", "Ms", "Ms."):
                new_ent = Span(doc, ent.start - 1, ent.end, label=ent.label)
                new_ents.append(new_ent)
           else:
              new_ents.append(ent)
        else:
            new_ents.append(ent)
    doc.ents = new_ents
    return doc
&lt;/denchmark-code&gt;

	</description>
	<comments>
		<comment id='1' author='jack-rory-staunton' date='2019-10-19T08:50:10Z'>
		That does look like a bug. Would you like to submit a PR to fix it?
		</comment>
		<comment id='2' author='jack-rory-staunton' date='2019-11-22T12:55:09Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>