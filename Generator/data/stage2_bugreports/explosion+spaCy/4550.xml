<bug id='4550' author='svlandeg' open_date='2019-10-29T11:00:25Z' closed_time='2020-02-03T13:00:02Z'>
	<summary>CharacterEmbed broken in architecture refactor</summary>
	<description>
With respect to current code on master branch.
&lt;denchmark-link:https://github.com/explosion/spaCy/blob/master/spacy/ml/tok2vec.py#L88&gt;https://github.com/explosion/spaCy/blob/master/spacy/ml/tok2vec.py#L88&lt;/denchmark-link&gt;
 doesn't work because it needs to refer to &lt;denchmark-link:https://github.com/explosion/spaCy/blob/master/spacy/_ml.py#L913&gt;https://github.com/explosion/spaCy/blob/master/spacy/_ml.py#L913&lt;/denchmark-link&gt;
 instead of to its own constructor (the one in  then probably needs to be moved or you'd get a circular dependency from  to  and back?)
Further issues: &lt;denchmark-link:https://github.com/explosion/spaCy/blob/master/spacy/ml/tok2vec.py#L20&gt;https://github.com/explosion/spaCy/blob/master/spacy/ml/tok2vec.py#L20&lt;/denchmark-link&gt;
:

tok2vec = chain(doc2feats, with_flatten(chain(embed, encode), pad=field_size))

This works when embed is MultiHashEmbed, but doesn't work if it's CharacterEmbed because the latter needs access to the original Doc, and thus perhaps doc2feats and embed need to be concatenate_lists()'d in this case?
Stumbled upon all this when running ud_train.py, which uses build_morphologizer_model() which sets

char_embed = cfg.get("char_embed", True)

Setting that to False, makes the script run again.
&lt;denchmark-link:https://github.com/honnibal&gt;@honnibal&lt;/denchmark-link&gt;
 : considering this is new code and I assume you're still working on this, let me know if you'd rather fix this yourself or if you'd like me to have a stab at a PR.
	</description>
	<comments>
		<comment id='1' author='svlandeg' date='2019-10-29T13:44:45Z'>
		&lt;denchmark-link:https://github.com/svlandeg&gt;@svlandeg&lt;/denchmark-link&gt;
 Ah, good catch. Yeah I'll fix it, thanks!
		</comment>
		<comment id='2' author='svlandeg' date='2020-03-10T19:07:04Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>