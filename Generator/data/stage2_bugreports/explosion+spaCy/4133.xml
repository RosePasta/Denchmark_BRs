<bug id='4133' author='tomnaumann' open_date='2019-08-16T15:56:47Z' closed_time='2019-08-16T18:05:56Z'>
	<summary>Vocab serialization/deserialization leads to incomplete document</summary>
	<description>
It seems that Spacy has an issue with transforming a document to a byte-array and the other way around - because when I do so, some information e.g. part-of-speech data is missing.
I already figured out that it works when I load the document directly with the model vocab - which means that the bug is most likely happening during the serialization resp. deserialization of vocab.
doc = Doc(nlp.vocab).from_bytes(doc_bytes)
&lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;from spacy import load
from spacy.tokens import Doc
from spacy.vocab import Vocab

class SpacySaveLoadTest(unittest.TestCase):

    def test_foo(self):
        nlp = load('en_core_web_sm')
        vocab_bytes = nlp.vocab.to_bytes()
        doc = nlp(u'Apple is looking at buying U.K. startup for $1 billion')
        doc_bytes = doc.to_bytes()

        expected = []
        for token in doc:
            expected.append(token.pos_)

        vocab = Vocab()
        vocab.from_bytes(vocab_bytes)
        doc = Doc(vocab).from_bytes(doc_bytes)

        actual = []
        for token in doc:
            actual.append(token.pos_)

        print(actual)
        print(expected)
        self.assertEqual(actual, expected)
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;


spaCy version: 2.1.8
Platform: Windows-10-10.0.17134-SP0
Python version: 3.7.4

	</description>
	<comments>
		<comment id='1' author='tomnaumann' date='2019-08-16T17:17:00Z'>
		Thanks for the report! You're right, this looks like a bug in Vocab.to_bytes(). Will investigate :-)
		</comment>
		<comment id='2' author='tomnaumann' date='2019-08-16T18:05:30Z'>
		It looks like this is another manifestation of the same bug we identified recently around serialization of  attributes, cf Issue &lt;denchmark-link:https://github.com/explosion/spaCy/issues/3959&gt;#3959&lt;/denchmark-link&gt;
 and the currently open pull request  &lt;denchmark-link:https://github.com/explosion/spaCy/pull/4092&gt;#4092&lt;/denchmark-link&gt;
. I added a &lt;denchmark-link:https://github.com/explosion/spaCy/pull/4092/commits/cc9f7d57ce7c0babc590c0e28a31cd8d4c79226c&gt;unit test&lt;/denchmark-link&gt;
 for this particular example - merging it with the other cases and closing this one.
(FYI @Criffle12 : until the PR is merged, perhaps you can use token.tag_ instead of token.pos_, because  the tags are serialized correctly)
		</comment>
		<comment id='3' author='tomnaumann' date='2019-09-15T18:42:48Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>