<bug id='288' author='michael135' open_date='2016-03-13T14:29:33Z' closed_time='2016-10-22T15:14:04Z'>
	<summary>use of NER after update fails</summary>
	<description>
&lt;denchmark-h:h3&gt;I'm trying to to train NER at it's succeed, with following code:&lt;/denchmark-h&gt;

code for NER update is taken from &lt;denchmark-link:url&gt;https://github.com/spacy-io/spaCy/issues/187&lt;/denchmark-link&gt;

import plac
from spacy.en import English
from spacy.gold import GoldParse
import os
fname = 'mmmm'
nlp = English(parser=False) # Avoid loading the parser, for quick load times
doc = nlp.tokenizer(u'Lions and tigers and grizzly bears!')
nlp.tagger(doc)
nlp.entity.add_label('ANIMAL') # &lt;-- New in v0.100
indices = tuple(range(len(doc)))
words = [w.text for w in doc]
tags = [w.tag_ for w in doc]
heads = [0 for _ in doc]
deps = ['' for _ in doc]
ner = ['U-ANIMAL', 'O', 'U-ANIMAL', 'O', 'B-ANIMAL', 'L-ANIMAL', 'O']
annot = GoldParse(doc, (indices, words, tags, heads, deps, ner))
loss = nlp.entity.train(doc, annot)
i = 0
while loss != 0 and i &lt; 1000:
loss = nlp.entity.train(doc, annot)
i += 1
print("Used %d iterations" % i)
nlp.entity(doc)
for ent in doc.ents:
print(ent.text, ent.label_)
nlp.entity.model.dump(os.getcwd())
&lt;denchmark-h:h3&gt;Than I load the saved model it also succeed. Than after loading I'm trying to apply the model on the sentence -&gt; this part is failed&lt;/denchmark-h&gt;

here is the code:
from spacy.en import English
import os
path = os.getcwd() + '/dic/mmmm'   # path to the model
path = path.decode('utf-8')
nlp = English(parser=False)
nlp.entity.model.load(path)
doc = nlp(u'Lions and tigers and grizzly bears!')
ents = list(doc.ents)
print ents
	</description>
	<comments>
		<comment id='1' author='michael135' date='2016-03-21T02:39:04Z'>
		michael135, did you manage to get this solved? I'm having the same difficulties and would love to know if it's a bug or if I'm missing something somewhere.
Just as a test, I dumped out the entity model without making any changes to it and then trained my new entities and dumped out the new entity model. I then used cmp to verify that the two dumps were different and they in fact were. So it appears as though my newly trained entities are in fact getting dumped but don't seem to be available after loading.
		</comment>
		<comment id='2' author='michael135' date='2016-03-21T03:20:14Z'>
		michael135, I dug into the source code a bit and may have figured out a solution to our problem. This may not be a correct solution as I'm far from experienced with spacy, but it seems as though you have to tell spacy about your custom entity labels along with loading the model you dumped. So before you call:
nlp.entity.model.load(path)
call:
nlp.entity.add_label('ANIMAL')
This does the trick for me but again, I have no idea if it's the correct solution, hannibal will probably have to weigh in on that one.
		</comment>
		<comment id='3' author='michael135' date='2016-03-21T04:20:32Z'>
		Hey,
Sorry for the delay getting to this.
It seems that spaCy isn't saving the labelling properly. Re-dding the label before loading is the correct workaround for now, until we fix this.
		</comment>
		<comment id='4' author='michael135' date='2016-03-21T09:27:09Z'>
		That means, that the label should be added twice before saving pickle and after loading it?
		</comment>
		<comment id='5' author='michael135' date='2018-05-09T08:12:33Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>