<bug id='1371' author='mattmcclean' open_date='2020-03-21T16:17:34Z' closed_time='2020-04-06T17:55:06Z'>
	<summary>PyTorch training container v1.4.0 not recognizing requirements.txt file</summary>
	<description>
Describe the bug
I tried to launch a local and remote training job using the PyTorch container v1.4.0 and provided the source_dir with a requirements.txt file to install extra packages. When running the training job it does not recognise the file and thus does not install the required packages. I tried it with the framework version 1.3.1 and it installs it fine.
To reproduce
Code to create the problem:
&lt;denchmark-code&gt;from sagemaker import get_execution_role
role = get_execution_role()
from sagemaker.pytorch import PyTorch 
hyperparameters = {'epochs': 2}
estimator = PyTorch(source_dir='container/oxford-pets',
                    entry_point='oxford-pets.py',
                    role=role,
                    train_instance_count=1,
                    train_instance_type='local_gpu',
                    framework_version='1.4.0',
                    py_version='py3',
                    hyperparameters=hyperparameters)
&lt;/denchmark-code&gt;

I tried both local and remote training on SageMaker with a ml.p3.2xlarge instance and had the same issue.
Expected behavior
I expected the training job to install the packages described in the requirements.txt file.
Screenshots or logs
If applicable, add screenshots or logs to help explain your problem.
Log output from training job:
&lt;denchmark-code&gt;-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   timestamp   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                message                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1584806924672 | bash: cannot set terminal process group (-1): Inappropriate ioctl for device                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 1584806924672 | bash: no job control in this shell                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 1584806924672 | 2020-03-21 16:08:42,231 sagemaker-containers INFO     Imported framework sagemaker_pytorch_container.training                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 1584806924672 | 2020-03-21 16:08:42,254 sagemaker_pytorch_container.training INFO     Block until all host DNS lookups succeed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 1584806924672 | 2020-03-21 16:08:42,256 sagemaker_pytorch_container.training INFO     Invoking user training script.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 1584806924672 | 2020-03-21 16:08:42,756 sagemaker-containers INFO     Module default_user_module_name does not provide a setup.py.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 1584806924672 | Generating setup.py                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 1584806924672 | 2020-03-21 16:08:42,756 sagemaker-containers INFO     Generating setup.cfg                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 1584806924673 | 2020-03-21 16:08:42,757 sagemaker-containers INFO     Generating MANIFEST.in                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 1584806924673 | 2020-03-21 16:08:42,757 sagemaker-containers INFO     Installing module with the following command:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 1584806924673 | /opt/conda/bin/python -m pip install .                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 1584806924673 | Processing /tmp/tmpt2wmv0lh/module_dir                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 1584806924673 | Building wheels for collected packages: default-user-module-name   Building wheel for default-user-module-name (setup.py): started   Building wheel for default-user-module-name (setup.py): finished with status 'done'   Created wheel for default-user-module-name: filename=default_user_module_name-1.0.0-py2.py3-none-any.whl size=4367 sha256=abce39aca5032c7ccc38c600aaef52bf6fd51d8e4ffd52638fcc278d6b0fba11   Stored in directory: /tmp/pip-ephem-wheel-cache-0snmgkoe/wheels/0c/23/bf/49d9b9675d4918970abec256eaa8ffc91ab60b231c72288ea8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 1584806924673 | Successfully built default-user-module-name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 1584806925673 | Installing collected packages: default-user-module-name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 1584806925673 | Successfully installed default-user-module-name-1.0.0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 1584806925673 | 2020-03-21 16:08:45,292 sagemaker-containers INFO     Invoking user script                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 1584806925674 | Training Env:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 1584806925674 | {     "additional_framework_parameters": {},     "channel_input_dirs": {         "training": "/opt/ml/input/data/training"     },     "current_host": "algo-1",     "framework_module": "sagemaker_pytorch_container.training:main",     "hosts": [         "algo-1"     ],     "hyperparameters": {         "epochs": 2     },     "input_config_dir": "/opt/ml/input/config",     "input_data_config": {         "training": {             "TrainingInputMode": "File",             "S3DistributionType": "FullyReplicated",             "RecordWrapperType": "None"         }     },     "input_dir": "/opt/ml/input",     "is_master": true,     "job_name": "pytorch-training-2020-03-21-16-03-13-971",     "log_level": 20,     "master_hostname": "algo-1",     "model_dir": "/opt/ml/model",     "module_dir": "s3://sagemaker-eu-west-1-934676248949/pytorch-training-2020-03-21-16-03-13-971/source/sourcedir.tar.gz",     "module_name": "oxford-pets",     "network_interface_name": "eth0",     "num_cpus": 8,     "num_gpus": 1,     "output_data_dir": "/opt/ml/output/data",     "output_dir": "/opt/ml/output",     "output_intermediate_dir": "/opt/ml/output/intermediate",     "resource_config": {         "current_host": "algo-1",         "hosts": [             "algo-1"         ],         "network_interface_name": "eth0"     },     "user_entry_point": "oxford-pets.py" |
| 1584806925674 | }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 1584806925674 | Environment variables:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 1584806925674 | SM_HOSTS=["algo-1"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 1584806925674 | SM_NETWORK_INTERFACE_NAME=eth0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 1584806925674 | SM_HPS={"epochs":2}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 1584806925674 | SM_USER_ENTRY_POINT=oxford-pets.py                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 1584806925674 | SM_FRAMEWORK_PARAMS={}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 1584806925675 | SM_RESOURCE_CONFIG={"current_host":"algo-1","hosts":["algo-1"],"network_interface_name":"eth0"}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 1584806925675 | SM_INPUT_DATA_CONFIG={"training":{"RecordWrapperType":"None","S3DistributionType":"FullyReplicated","TrainingInputMode":"File"}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 1584806925675 | SM_OUTPUT_DATA_DIR=/opt/ml/output/data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 1584806925675 | SM_CHANNELS=["training"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 1584806925675 | SM_CURRENT_HOST=algo-1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 1584806925675 | SM_MODULE_NAME=oxford-pets                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 1584806925675 | SM_LOG_LEVEL=20                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 1584806925675 | SM_FRAMEWORK_MODULE=sagemaker_pytorch_container.training:main                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 1584806925675 | SM_INPUT_DIR=/opt/ml/input                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 1584806925675 | SM_INPUT_CONFIG_DIR=/opt/ml/input/config                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 1584806925675 | SM_OUTPUT_DIR=/opt/ml/output                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 1584806925675 | SM_NUM_CPUS=8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 1584806925675 | SM_NUM_GPUS=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 1584806925675 | SM_MODEL_DIR=/opt/ml/model                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 1584806925675 | SM_MODULE_DIR=s3://sagemaker-eu-west-1-934676248949/pytorch-training-2020-03-21-16-03-13-971/source/sourcedir.tar.gz                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 1584806925675 | SM_TRAINING_ENV={"additional_framework_parameters":{},"channel_input_dirs":{"training":"/opt/ml/input/data/training"},"current_host":"algo-1","framework_module":"sagemaker_pytorch_container.training:main","hosts":["algo-1"],"hyperparameters":{"epochs":2},"input_config_dir":"/opt/ml/input/config","input_data_config":{"training":{"RecordWrapperType":"None","S3DistributionType":"FullyReplicated","TrainingInputMode":"File"}},"input_dir":"/opt/ml/input","is_master":true,"job_name":"pytorch-training-2020-03-21-16-03-13-971","log_level":20,"master_hostname":"algo-1","model_dir":"/opt/ml/model","module_dir":"s3://sagemaker-eu-west-1-934676248949/pytorch-training-2020-03-21-16-03-13-971/source/sourcedir.tar.gz","module_name":"oxford-pets","network_interface_name":"eth0","num_cpus":8,"num_gpus":1,"output_data_dir":"/opt/ml/output/data","output_dir":"/opt/ml/output","output_intermediate_dir":"/opt/ml/output/intermediate","resource_config":{"current_host":"algo-1","hosts":["algo-1"],"network_interface_name":"eth0"},"user_entry_point":"oxford-pets.py"}                                                                                                                                                                                                                                                                                                       |
| 1584806925675 | SM_USER_ARGS=["--epochs","2"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 1584806925675 | SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 1584806925675 | SM_CHANNEL_TRAINING=/opt/ml/input/data/training                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 1584806925675 | SM_HP_EPOCHS=2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 1584806925675 | PYTHONPATH=/opt/ml/code:/opt/conda/bin:/opt/conda/lib/python36.zip:/opt/conda/lib/python3.6:/opt/conda/lib/python3.6/lib-dynload:/opt/conda/lib/python3.6/site-packages                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 1584806925675 | Invoking script with the following command:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 1584806925675 | /opt/conda/bin/python oxford-pets.py --epochs 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 1584806925675 | Traceback (most recent call last):   File "oxford-pets.py", line 23, in &lt;module&gt;     from fastai2.vision.all import *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 1584806925675 | ModuleNotFoundError: No module named 'fastai2'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 1584806925675 | 2020-03-21 16:08:45,350 sagemaker-containers ERROR    ExecuteUserScriptError:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 1584806925675 | Command "/opt/conda/bin/python oxford-pets.py --epochs 2"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 1584806925676 | Traceback (most recent call last):   File "oxford-pets.py", line 23, in &lt;module&gt;     from fastai2.vision.all import *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 1584806925676 | ModuleNotFoundError: No module named 'fastai2'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
&lt;/denchmark-code&gt;

System information
A description of your system. Please provide:

SageMaker Python SDK version: 1.51.3
Framework name (eg. PyTorch) or algorithm (eg. KMeans): PyTorch
Framework version: 1.4.0
Python version: 3.6
CPU or GPU: GPU
Custom Docker image (Y/N): N

Additional context
Add any other context about the problem here.
	</description>
	<comments>
		<comment id='1' author='mattmcclean' date='2020-03-21T17:37:42Z'>
		I have the same issue with 1.4.0, as well.  The requirements.txt support is a bit shakey.
I just added the following right before the import:
&lt;denchmark-code&gt;import subprocess
import sys
subprocess.check_call([sys.executable, '-m', 'pip', 'install', 'simpletransformers'])
&lt;/denchmark-code&gt;

Not ideal, but hopefully gets you passed this for now.
		</comment>
		<comment id='2' author='mattmcclean' date='2020-03-23T15:57:23Z'>
		thanks, Chris, for posting your workaround.
this is indeed a bug. I have merged PRs to address it (&lt;denchmark-link:https://github.com/aws/sagemaker-containers/pull/261&gt;aws/sagemaker-containers#261&lt;/denchmark-link&gt;
, &lt;denchmark-link:https://github.com/aws/sagemaker-pytorch-training-toolkit/pull/187&gt;aws/sagemaker-pytorch-training-toolkit#187&lt;/denchmark-link&gt;
). Thank you for your patience.
		</comment>
		<comment id='3' author='mattmcclean' date='2020-04-06T17:55:06Z'>
		The fix has been released. (I verified locally when writing &lt;denchmark-link:https://github.com/aws/sagemaker-pytorch-training-toolkit/pull/194&gt;aws/sagemaker-pytorch-training-toolkit#194&lt;/denchmark-link&gt;
.) Thank you for your patience!
		</comment>
	</comments>
</bug>