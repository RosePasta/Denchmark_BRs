<bug id='13380' author='muhyun' open_date='2018-11-23T08:47:13Z' closed_time='2018-12-26T22:15:37Z'>
	<summary>mxnet bind fails in nvidia jetson tx2 (jetpack 3.3, cuda 9.0) in aws greengrass env.</summary>
	<description>
A python code to load an mxnet model fail in bind() function on Nvidia Jetson TX2 (JetPack 3.3), where mxnet is installed using AWS Greengrass's pre-built binary. The model is resnet-50 based transfer learning one.

nvidia jetson tx2 with jetpack 3.3
ubuntu 16.04
python 2.7
mxnet 1.2.1

&lt;denchmark-code&gt;sym, arg_params, aux_params = mx.model.load_checkpoint(model_dir + 'image-classification', 20)
    mod = mx.mod.Module(symbol=sym, context=ctx, label_names=None)
    mod.bind(for_training=False, data_shapes=[('data', (1,3,128,128))], label_shapes=mod._label_shapes)
    mod.set_params(arg_params, aux_params, allow_missing=True)
    print('Model loaded successfully')
&lt;/denchmark-code&gt;

The error message is;
[2018-11-22T10:21:41.559Z][FATAL]-[10:21:41] src/storage/storage.cc:119: Check failed: e == cudaSuccess || e == cudaErrorCudartUnloading CUDA: no CUDA-capable device is detected
, and the full message is;
&lt;denchmark-code&gt;[2018-11-22T10:21:41.559Z][FATAL]-lambda_runtime.py:108,Failed to import handler function "greengrassHelloWorldCounter.function_handler" due to exception: simple_bind error. Arguments:
[2018-11-22T10:21:41.559Z][FATAL]-data: (1, 3, 128, 128)
[2018-11-22T10:21:41.559Z][FATAL]-[10:21:41] src/storage/storage.cc:119: Check failed: e == cudaSuccess || e == cudaErrorCudartUnloading CUDA: no CUDA-capable device is detected
[2018-11-22T10:21:41.559Z][FATAL]-Stack trace returned 10 entries:
[2018-11-22T10:21:41.559Z][FATAL]-[bt] (0) /usr/local/lib/python2.7/dist-packages/mxnet/libmxnet.so(dmlc::StackTrace[abi:cxx11]()+0x58) [0x7f786c6280]
[2018-11-22T10:21:41.559Z][FATAL]-[bt] (1) /usr/local/lib/python2.7/dist-packages/mxnet/libmxnet.so(dmlc::LogMessageFatal::~LogMessageFatal()+0x44) [0x7f786c6bdc]
[2018-11-22T10:21:41.559Z][FATAL]-[bt] (2) /usr/local/lib/python2.7/dist-packages/mxnet/libmxnet.so(+0x2ce60c8) [0x7f7a8480c8]
[2018-11-22T10:21:41.559Z][FATAL]-[bt] (3) /usr/local/lib/python2.7/dist-packages/mxnet/libmxnet.so(+0x2ce73a4) [0x7f7a8493a4]
[2018-11-22T10:21:41.559Z][FATAL]-[bt] (4) /usr/local/lib/python2.7/dist-packages/mxnet/libmxnet.so(mxnet::StorageImpl::Alloc(mxnet::Storage::Handle*)+0x64) [0x7f7a84a58c]
[2018-11-22T10:21:41.559Z][FATAL]-[bt] (5) /usr/local/lib/python2.7/dist-packages/mxnet/libmxnet.so(mxnet::exec::InitZeros(mxnet::NDArrayStorageType, nnvm::TShape const&amp;, mxnet::Context const&amp;, int)+0x3cc) [0x7f7a36db5c]
[2018-11-22T10:21:41.559Z][FATAL]-[bt] (6) /usr/local/lib/python2.7/dist-packages/mxnet/libmxnet.so(+0x27fab9c) [0x7f7a35cb9c]
[2018-11-22T10:21:41.559Z][FATAL]-[bt] (7) /usr/local/lib/python2.7/dist-packages/mxnet/libmxnet.so(mxnet::exec::GraphExecutor::InitArguments(nnvm::IndexedGraph const&amp;, std::vector&lt;nnvm::TShape, std::allocator&lt;nnvm::TShape&gt; &gt; const&amp;, std::vector&lt;int, std::allocator&lt;int&gt; &gt; const&amp;, std::vector&lt;int, std::allocator&lt;int&gt; &gt; const&amp;, std::vector&lt;mxnet::Context, std::allocator&lt;mxnet::Context&gt; &gt; const&amp;, std::vector&lt;mxnet::Context, std::allocator&lt;mxnet::Context&gt; &gt; const&amp;, std::vector&lt;mxnet::Context, std::allocator&lt;mxnet::Context&gt; &gt; const&amp;, std::vector&lt;mxnet::OpReqType, std::allocator&lt;mxnet::OpReqType&gt; &gt; const&amp;, std::unordered_set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; const&amp;, mxnet::Executor const*, std::unordered_map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, mxnet::NDArray, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, mxnet::NDArray&gt; &gt; &gt;*, std::vector&lt;mxnet::NDArray, std::allocator&lt;mxnet::NDArray&gt; &gt;*, std::vector&lt;mxnet::NDArray, std::allocator&lt;mxnet::NDArray&gt; &gt;*, std::vector&lt;mxnet::NDArray, std::allocator&lt;mxnet::NDArray&gt; &gt;*)+0xaa0) [0x7f7a3601c8]
[2018-11-22T10:21:41.559Z][FATAL]-[bt] (8) /usr/local/lib/python2.7/dist-packages/mxnet/libmxnet.so(mxnet::exec::GraphExecutor::Init(nnvm::Symbol, mxnet::Context const&amp;, std::map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, mxnet::Context, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, mxnet::Context&gt; &gt; &gt; const&amp;, std::vector&lt;mxnet::Context, std::allocator&lt;mxnet::Context&gt; &gt; const&amp;, std::vector&lt;mxnet::Context, std::allocator&lt;mxnet::Context&gt; &gt; const&amp;, std::vector&lt;mxnet::Context, std::allocator&lt;mxnet::Context&gt; &gt; const&amp;, std::unordered_map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, nnvm::TShape, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, nnvm::TShape&gt; &gt; &gt; const&amp;, std::unordered_map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, int, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, int&gt; &gt; &gt; const&amp;, std::unordered_map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, int, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, int&gt; &gt; &gt; const&amp;, std::vector&lt;mxnet::OpReqType, std::allocator&lt;mxnet::OpReqType&gt; &gt; const&amp;, std::unordered_set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; const&amp;, std::vector&lt;mxnet::NDArray, std::allocator&lt;mxnet::NDArray&gt; &gt;*, std::vector&lt;mxnet::NDArray, std::allocator&lt;mxnet::NDArray&gt; &gt;*, std::vector&lt;mxnet::NDArray, std::allocator&lt;mxnet::NDArray&gt; &gt;*, std::unordered_map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, mxnet::NDArray, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, mxnet::NDArray&gt; &gt; &gt;*, mxnet::Executor*, std::unordered_map&lt;nnvm::NodeEntry, mxnet::NDArray, nnvm::NodeEntryHash, nnvm::NodeEntryEqual, std::allocator&lt;std::pair&lt;nnvm::NodeEntry const, mxnet::NDArray&gt; &gt; &gt; const&amp;)+0x748) [0x7f7a366b90]
[2018-11-22T10:21:41.559Z][FATAL]-[bt] (9) /usr/local/lib/python2.7/dist-packages/mxnet/libmxnet.so(mxnet::Executor::SimpleBind(nnvm::Symbol, mxnet::Context const&amp;, std::map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, mxnet::Context, std::less&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, mxnet::Context&gt; &gt; &gt; const&amp;, std::vector&lt;mxnet::Context, std::allocator&lt;mxnet::Context&gt; &gt; const&amp;, std::vector&lt;mxnet::Context, std::allocator&lt;mxnet::Context&gt; &gt; const&amp;, std::vector&lt;mxnet::Context, std::allocator&lt;mxnet::Context&gt; &gt; const&amp;, std::unordered_map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, nnvm::TShape, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, nnvm::TShape&gt; &gt; &gt; const&amp;, std::unordered_map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, int, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, int&gt; &gt; &gt; const&amp;, std::unordered_map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, int, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, int&gt; &gt; &gt; const&amp;, std::vector&lt;mxnet::OpReqType, std::allocator&lt;mxnet::OpReqType&gt; &gt; const&amp;, std::unordered_set&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; const&amp;, std::vector&lt;mxnet::NDArray, std::allocator&lt;mxnet::NDArray&gt; &gt;*, std::vector&lt;mxnet::NDArray, std::allocator&lt;mxnet::NDArray&gt; &gt;*, std::vector&lt;mxnet::NDArray, std::allocator&lt;mxnet::NDArray&gt; &gt;*, std::unordered_map&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, mxnet::NDArray, std::hash&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::equal_to&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;, std::allocator&lt;std::pair&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, mxnet::NDArray&gt; &gt; &gt;*, mxnet::Executor*)+0x10c) [0x7f7a367314]
&lt;/denchmark-code&gt;

Simple MNIST MLP training script runs fine and it uses GPU correctly.
	</description>
	<comments>
		<comment id='1' author='muhyun' date='2018-11-23T12:28:06Z'>
		Hello,
thanks for your issue. Could you elaborate how you run the example and could you paste it here?
Generally we can't offer support for third party distributions (AWS Greengrass), but I'll still try my best (alternatively please contact AWS).
From what i can tell here is that you seem to our be either missing a dependency or you are launching the example in a fashion that doesn't have GPU access - e.g. within docker
P.s. we also distribute Jetson pip packages ourselves. Check the website for instructions
		</comment>
		<comment id='2' author='muhyun' date='2018-11-23T20:10:33Z'>
		Would you be able to share the model with us?  Does it bind properly if you use the CPU as your context?
		</comment>
		<comment id='3' author='muhyun' date='2018-11-24T15:24:04Z'>
		I found that it is caused by mis-configured JetPack. So, this can be closed as resolved.
		</comment>
		<comment id='4' author='muhyun' date='2018-11-24T17:17:19Z'>
		Great news. Would you mind explaining what you had to change so other users who face the same issue know how to approach the problem? Thank you!
		</comment>
		<comment id='5' author='muhyun' date='2018-11-26T18:14:56Z'>
		&lt;denchmark-link:https://github.com/muhyun&gt;@muhyun&lt;/denchmark-link&gt;
 Requesting details on the steps you followed to resolve the issue, This would help other users, when they run into similar problems.
		</comment>
		<comment id='6' author='muhyun' date='2018-11-27T01:06:41Z'>
		I'm guessing you'd just have to re-run the Jetpack installation wizard and ensure you select the correct packages for drivers, cudnn, cuda and tensorrt. &lt;denchmark-link:https://github.com/muhyun&gt;@muhyun&lt;/denchmark-link&gt;
, correct me if I'm wrong.
		</comment>
		<comment id='7' author='muhyun' date='2018-12-04T06:48:19Z'>
		With a fresh installation of jetpack, the standalone inference code runs fine outside of greengrass while the inference throws error from bind() when it is executed in greengrass environment. The standalone runs without error on other tx2.
		</comment>
		<comment id='8' author='muhyun' date='2018-12-26T22:13:12Z'>
		&lt;denchmark-link:https://github.com/muhyun&gt;@muhyun&lt;/denchmark-link&gt;
 Since this issue is green grass specific, we will close this. Thanks for the update
		</comment>
	</comments>
</bug>