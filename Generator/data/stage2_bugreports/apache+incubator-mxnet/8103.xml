<bug id='8103' author='caiqi' open_date='2017-09-29T18:38:32Z' closed_time='2017-10-08T03:15:11Z'>
	<summary>rec generated by im2rec.py has same value for different key in idx</summary>
	<description>
I generate a large rec file (over 1M files) using im2rec with MXIndexedRecordIO and observe that in data.idx file, after specific lines, the first number in each line keeps increasing while the second one keeps unchanged, like this:

32989	18446744073709551615
32990	18446744073709551615
32991	18446744073709551615
32992	18446744073709551615
32993	18446744073709551615
32994	18446744073709551615
32995	18446744073709551615
32997	18446744073709551615
32998	18446744073709551615

From this line 


incubator-mxnet/python/mxnet/recordio.py


         Line 226
      in
      22b2897






 pos = ctypes.c_size_t(self.idx[idx]) 




, it seems that the second number determines the position for a specific key. So different key should have a different position. I have tried read through the full rec file and found that the last few items are not the same and their position should be different. So what does the second column in idx file mean and is it normal to have same values in second columns? Is there any documentation? Thanks.
	</description>
	<comments>
		<comment id='1' author='caiqi' date='2017-09-29T19:01:31Z'>
		I suspect it's overflown.  &lt;denchmark-link:https://github.com/piiswrong&gt;@piiswrong&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='caiqi' date='2017-09-29T20:23:33Z'>
		It would mean that the rec file has exabytes of data in it. For some reason tell errored out with -1. I will look into reproing it just in case there is some bug in mxnet, but I would suspect problems with filesystem. What was the filesystem where you were saving your .rec file?
		</comment>
		<comment id='3' author='caiqi' date='2017-09-30T02:10:48Z'>
		The file system is NTFS. I will try on another machine to check whether it's due to hardware reasons.
		</comment>
		<comment id='4' author='caiqi' date='2017-09-30T03:07:33Z'>
		I have tried on another machine, it still has the problem.  When I use read_idx() to read the rec, it will throw an error, however, when I use read() I checked that the unpacked label is correct with the *.lst file.
		</comment>
		<comment id='5' author='caiqi' date='2017-09-30T03:15:51Z'>
		Thanks for checking. I did not yet have time to try reproducing it, will do that next week. Could you tell me how big is the file by the way? Also, what is the version of MxNet you use (commit if compiled from source)?
		</comment>
		<comment id='6' author='caiqi' date='2017-09-30T03:54:25Z'>
		The file size is about 55GB. I create the rec for Imagenet VID dataset following this &lt;denchmark-link:https://github.com/apache/incubator-mxnet/tree/master/example/ssd&gt;https://github.com/apache/incubator-mxnet/tree/master/example/ssd&lt;/denchmark-link&gt;
. The mxnet version is 0.11.0, installed with  on windows. Thanks.
		</comment>
		<comment id='7' author='caiqi' date='2017-10-04T09:56:14Z'>
		I found that the problem occurs when the file size reaches 2GB.  The pos in this line &lt;denchmark-link:https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/recordio.py#L248&gt;https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/recordio.py#L248&lt;/denchmark-link&gt;
 becomes 18446744073709551615(-1). I have checked the system is x64 based and tested with python2/python3 and the latest build of mxnet. The problem still exists. However, the *.rec looks fine.
		</comment>
		<comment id='8' author='caiqi' date='2017-10-04T13:04:38Z'>
		Ok, I looked it up and it turns out that on Windows long is 32 bit vs 64
bit on linux, and ftell returns long. I will make a PR to dmlc-core today
with the fix.

Thanks for reporting the bug!
&lt;denchmark-link:#&gt;…&lt;/denchmark-link&gt;


On Wed, Oct 4, 2017, 02:56 Qi Cai ***@***.***&gt; wrote:
 I found that the problem occurs when the file size reaches 2GB. The pos in
 this line
 https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/recordio.py#L248
 becomes 18446744073709551615(-1). I have checked the system is x64 based
 and tested with python2/python3 and the latest build of mxnet. The problem
 still exists. However, the *.rec looks fine.

 —
 You are receiving this because you are subscribed to this thread.
 Reply to this email directly, view it on GitHub
 &lt;#8103 (comment)&gt;,
 or mute the thread
 &lt;https://github.com/notifications/unsubscribe-auth/AIAohCfqc6l4_-MRQpW9vlnQWNgu-bKTks5so1ZmgaJpZM4PpDZx&gt;
 .



		</comment>
		<comment id='9' author='caiqi' date='2017-10-04T13:23:17Z'>
		Thank you very much!
		</comment>
		<comment id='10' author='caiqi' date='2017-10-05T23:36:58Z'>
		Hi &lt;denchmark-link:https://github.com/caiqi&gt;@caiqi&lt;/denchmark-link&gt;
 - could you check that applying this PR &lt;denchmark-link:https://github.com/dmlc/dmlc-core/pull/318&gt;dmlc/dmlc-core#318&lt;/denchmark-link&gt;
 fixes your issue?
		</comment>
		<comment id='11' author='caiqi' date='2017-10-06T08:59:51Z'>
		It fixes the problem. But there is a typo here: &lt;denchmark-link:https://github.com/dmlc/dmlc-core/pull/318/files#diff-1f6c080379cd78f60fe204c6c9a1eb44R46&gt;https://github.com/dmlc/dmlc-core/pull/318/files#diff-1f6c080379cd78f60fe204c6c9a1eb44R46&lt;/denchmark-link&gt;
. It misses a ')'. Thank you very much!
		</comment>
	</comments>
</bug>