<bug id='767' author='chiehpower' open_date='2020-01-08T01:43:16Z' closed_time='2020-02-19T03:50:51Z'>
	<summary>Error of converting Mask RCNN .pb to onnx</summary>
	<description>
&lt;denchmark-h:h2&gt;Describe the situation&lt;/denchmark-h&gt;

I wonder to convert .pb model of Mask RCNN which was trained by Keras to .onnx model.
Let me describe my situation. I was trying to do a Mask RCNN sample of TensorRT for python API.
My strategy is to download the pre-trained Keras .h5 model then converting it to .pb format.
Next, I wanna use the tensorflow-onnx to convert the model from .pb to .onnx format.
(Don't worry. Until now, it is irrelevant with the TensorRT part.)

Their Mask R-CNN training framework can be found in the Mask R-CNN Github repository : https://github.com/matterport/Mask_RCNN
Download the pre-trained Keras model : https://github.com/matterport/Mask_RCNN/releases/download/v2.0/mask_rcnn_coco.h5
Basically I used this sample to produce the .pb file, and then I take it to convert the model from .pb to .onnx format.  https://github.com/NVIDIA/TensorRT/tree/master/samples/opensource/sampleUffMaskRCNN

&lt;denchmark-h:h2&gt;Implement the command&lt;/denchmark-h&gt;

This is my command.
&lt;denchmark-code&gt;python3 -m tf2onnx.convert --graphdef ./mask_rcnn_coco.pb --output ./mask_rcnn_coco.onnx \
    --fold_const --opset 10 \
    --inputs input_image:0\
    --outputs mrcnn_mask/Sigmoid:0 
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Error Message&lt;/denchmark-h&gt;

When I converted the model, I got this error below.
&lt;denchmark-code&gt;/home/chieh/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/chieh/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING:tensorflow:From /home/chieh/.local/lib/python3.6/site-packages/tf2onnx/verbose_logging.py:72: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

2020-01-08 09:04:56,183 - WARNING - From /home/chieh/.local/lib/python3.6/site-packages/tf2onnx/verbose_logging.py:72: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

2020-01-08 09:04:58.613282: E tensorflow/tools/graph_transforms/transform_graph.cc:332] fold_constants: Ignoring error You must feed a value for placeholder tensor 'input_image_meta' with dtype float and shape [?,93]
         [[{{node input_image_meta}}]]
2020-01-08 09:04:59,893 - INFO - Using tensorflow=1.14.0, onnx=1.6.0, tf2onnx=1.5.3/7b598d
2020-01-08 09:04:59,893 - INFO - Using opset &lt;onnx, 10&gt;
2020-01-08 09:05:10,771 - ERROR - Failed to convert node ROI/Pad
OP=Pad
Name=ROI/Pad
Inputs:
        ROI/GatherV2_3:0=Gather, [-1, 4], 1
        ROI/Pad/paddings_Concat__2376:0=Concat, [2, 2], 6
Outpus:
        ROI/Pad:0=[-1, -1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 352, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/nn.py", line 401, in version_1
    paddings = np.array(node.inputs[1].get_tensor_value()).transpose().flatten()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/graph.py", line 256, in get_tensor_value
    raise ValueError("get tensor value: {} must be Const".format(self.name))
ValueError: get tensor value: ROI/Pad/paddings_Concat__2376 must be Const
2020-01-08 09:05:10,779 - ERROR - Tensorflow op [roi_align_classifier/Round: Round] is not supported
2020-01-08 09:05:10,981 - ERROR - Tensorflow op [roi_align_classifier/CropAndResize_3: CropAndResize] is not supported
2020-01-08 09:05:10,989 - ERROR - Tensorflow op [roi_align_classifier/CropAndResize_2: CropAndResize] is not supported
2020-01-08 09:05:10,997 - ERROR - Tensorflow op [roi_align_classifier/CropAndResize_1: CropAndResize] is not supported
2020-01-08 09:05:11,005 - ERROR - Tensorflow op [roi_align_classifier/CropAndResize: CropAndResize] is not supported
2020-01-08 09:05:11,556 - ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation: DenseToDenseSetOperation] is not supported
2020-01-08 09:05:11,556 - ERROR - Tensorflow op [mrcnn_detection/SparseToDense: SparseToDense] is not supported
2020-01-08 09:05:11,576 - ERROR - Tensorflow op [mrcnn_detection/Unique: Unique] is not supported
2020-01-08 09:05:11,748 - ERROR - Failed to convert node mrcnn_detection/map/while/PadV2
OP=Pad
Name=mrcnn_detection/map/while/PadV2
Inputs:
        mrcnn_detection/map/while/GatherV2_3:0=Gather, [-1], 7
        mrcnn_detection/map/while/PadV2/paddings_Concat__3110:0=Concat, [1, 2], 6
        mrcnn_detection/map/while/PadV2/constant_values:0=Const, [], 7
Outpus:
        mrcnn_detection/map/while/PadV2:0=[-1], 7
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 352, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/nn.py", line 401, in version_1
    paddings = np.array(node.inputs[1].get_tensor_value()).transpose().flatten()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/graph.py", line 256, in get_tensor_value
    raise ValueError("get tensor value: {} must be Const".format(self.name))
ValueError: get tensor value: mrcnn_detection/map/while/PadV2/paddings_Concat__3110 must be Const
2020-01-08 09:05:11,775 - ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation_1: DenseToDenseSetOperation] is not supported
2020-01-08 09:05:11,775 - ERROR - Tensorflow op [mrcnn_detection/SparseToDense_1: SparseToDense] is not supported
2020-01-08 09:05:11,828 - ERROR - Failed to convert node mrcnn_detection/strided_slice_29
OP=StridedSlice
Name=mrcnn_detection/strided_slice_29
Inputs:
        mrcnn_detection/GatherV2_8:0=Gather, [-1], 1
        mrcnn_detection/strided_slice_29/stack:0=Const, [2], 6
        mrcnn_detection/strided_slice_29/stack_1:0=Const, [2], 6
        mrcnn_detection/strided_slice_29/stack_2:0=Const, [2], 6
Outpus:
        mrcnn_detection/strided_slice_29:0=[-1, 1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 352, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 686, in version_10
    cls.version_1(ctx, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 569, in version_1
    raise ValueError("StridedSlice: attribute " + attr_name + " not supported")
ValueError: StridedSlice: attribute new_axis_mask not supported
2020-01-08 09:05:11,828 - ERROR - Failed to convert node mrcnn_detection/strided_slice_28
OP=StridedSlice
Name=mrcnn_detection/strided_slice_28
Inputs:
        mrcnn_detection/ToFloat:0=Cast, [-1], 1
        mrcnn_detection/strided_slice_28/stack:0=Const, [2], 6
        mrcnn_detection/strided_slice_28/stack_1:0=Const, [2], 6
        mrcnn_detection/strided_slice_28/stack_2:0=Const, [2], 6
Outpus:
        mrcnn_detection/strided_slice_28:0=[-1, 1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 352, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 686, in version_10
    cls.version_1(ctx, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 569, in version_1
    raise ValueError("StridedSlice: attribute " + attr_name + " not supported")
ValueError: StridedSlice: attribute new_axis_mask not supported
2020-01-08 09:05:11,873 - ERROR - Failed to convert node mrcnn_detection/Pad
OP=Pad
Name=mrcnn_detection/Pad
Inputs:
        mrcnn_detection/concat_1:0=Concat, [-1, 6], 1
        mrcnn_detection/Pad/paddings_Concat__3161:0=Concat, [2, 2], 6
Outpus:
        mrcnn_detection/Pad:0=[-1, -1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 352, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/nn.py", line 401, in version_1
    paddings = np.array(node.inputs[1].get_tensor_value()).transpose().flatten()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/graph.py", line 256, in get_tensor_value
    raise ValueError("get tensor value: {} must be Const".format(self.name))
ValueError: get tensor value: mrcnn_detection/Pad/paddings_Concat__3161 must be Const
2020-01-08 09:05:11,881 - ERROR - Tensorflow op [roi_align_mask/Round: Round] is not supported
2020-01-08 09:05:12,085 - ERROR - Tensorflow op [roi_align_mask/CropAndResize_3: CropAndResize] is not supported
2020-01-08 09:05:12,093 - ERROR - Tensorflow op [roi_align_mask/CropAndResize_2: CropAndResize] is not supported
2020-01-08 09:05:12,100 - ERROR - Tensorflow op [roi_align_mask/CropAndResize_1: CropAndResize] is not supported
2020-01-08 09:05:12,108 - ERROR - Tensorflow op [roi_align_mask/CropAndResize: CropAndResize] is not supported
2020-01-08 09:05:12,350 - ERROR - Unsupported ops: Counter({'CropAndResize': 8, 'Round': 2, 'DenseToDenseSetOperation': 2, 'SparseToDense': 2, 'Unique': 1})
Traceback (most recent call last):
  File "/usr/lib/python3.6/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/usr/lib/python3.6/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/convert.py", line 161, in &lt;module&gt;
    main()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/convert.py", line 145, in main
    inputs_as_nchw=args.inputs_as_nchw)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 575, in process_tf_graph
    raise exceptions[0]
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 352, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/nn.py", line 401, in version_1
    paddings = np.array(node.inputs[1].get_tensor_value()).transpose().flatten()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/graph.py", line 256, in get_tensor_value
    raise ValueError("get tensor value: {} must be Const".format(self.name))
ValueError: get tensor value: ROI/Pad/paddings_Concat__2376 must be Const
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;System information&lt;/denchmark-h&gt;


Ubuntu 18.04
Tensorflow Version: 1.14
Python version: 3.6
Onnx version: 1.16
Keras version: 2.3.1

&lt;denchmark-h:h2&gt;To Reproduce&lt;/denchmark-h&gt;


Download the file from github
https://github.com/NVIDIA/TensorRT/tree/master/samples/opensource/sampleUffMaskRCNN/converted/mrcnn_to_trt_single.py
Follow the step 6 of prerequisites to get the model.
wget https://github.com/matterport/Mask_RCNN/releases/download/v2.0/mask_rcnn_coco.h5
Modify the code of mrcnn_to_trt_single.py. We just need to get rid of this function uff.from_tensorflow_frozen_model from line 150 to line 160. In addition, modify the output .pb path, here.
Then we can implement this command.

&lt;denchmark-code&gt;python3 mrcnn_to_trt_single.py -w ./mask_rcnn_coco.h5 -o ./mask_rcnn_coco.uff
&lt;/denchmark-code&gt;

Dont worry. It just requests users to provide an output .uff path, but it will not be used in the end.
We can get a .pb file.
BTW if you didn't have the uff package, please remove it. &lt;denchmark-link:https://github.com/NVIDIA/TensorRT/blob/5e289e919eabdc563208b82e88ac298ac50ffbfb/samples/opensource/sampleUffMaskRCNN/converted/mrcnn_to_trt_single.py#L33&gt;here&lt;/denchmark-link&gt;


Type this command on our terminal line.

&lt;denchmark-code&gt;python3 -m tf2onnx.convert --graphdef ./mask_rcnn_coco.pb --output ./mask_rcnn_coco.onnx \
    --fold_const --opset 10 \
    --inputs input_image:0\
    --outputs mrcnn_mask/Sigmoid:0 
&lt;/denchmark-code&gt;

Be careful of your .pb path.
Here, I was not completely sure whether it was caused by the input and output nodes.
However, it looks like an operation problem from error messages.
&lt;denchmark-h:h2&gt;Expected behavior&lt;/denchmark-h&gt;

Successfully get the onnx model of Mask RCNN.
Is there any idea about this situation?
Your comments and suggestions are welcome!
Thank you!
	</description>
	<comments>
		<comment id='1' author='chiehpower' date='2020-01-08T16:56:44Z'>
		tf2onnx=1.5.3 ... upgrade to the latest version 1.5.4:
&lt;denchmark-code&gt;pip install tf2onnx -U
&lt;/denchmark-code&gt;

it should be fixed there.
		</comment>
		<comment id='2' author='chiehpower' date='2020-01-09T00:37:03Z'>
		
tf2onnx=1.5.3 ... upgrade to the latest version 1.5.4:
pip install tf2onnx -U

it should be fixed there.

Hi guschmue,
Thanks for your response.
&lt;denchmark-code&gt;$ pip3 install --user tf2onnx -U                                                                                                               
Collecting tf2onnx
  Downloading https://files.pythonhosted.org/packages/97/13/3ff442b0080ab9c1271e615e3bb9a1f39c89c9345b9aa897e33f4d21183e/tf2onnx-1.5.4-py3-none-any.whl (154kB)
     |████████████████████████████████| 163kB 825kB/s 
Requirement already satisfied, skipping upgrade: numpy&gt;=1.14.1 in /home/chieh/.local/lib/python3.6/site-packages (from tf2onnx) (1.16.0)
Requirement already satisfied, skipping upgrade: requests in /usr/lib/python3/dist-packages (from tf2onnx) (2.18.4)
Requirement already satisfied, skipping upgrade: six in /home/chieh/.local/lib/python3.6/site-packages (from tf2onnx) (1.13.0)
Requirement already satisfied, skipping upgrade: onnx&gt;=1.4.1 in /home/chieh/.local/lib/python3.6/site-packages (from tf2onnx) (1.6.0)
Requirement already satisfied, skipping upgrade: protobuf in /home/chieh/.local/lib/python3.6/site-packages (from onnx&gt;=1.4.1-&gt;tf2onnx) (3.11.1)
Requirement already satisfied, skipping upgrade: typing-extensions&gt;=3.6.2.1 in /home/chieh/.local/lib/python3.6/site-packages (from onnx&gt;=1.4.1-&gt;tf2onnx) (3.7.4.1)
Requirement already satisfied, skipping upgrade: setuptools in /home/chieh/.local/lib/python3.6/site-packages (from protobuf-&gt;onnx&gt;=1.4.1-&gt;tf2onnx) (42.0.2)
Installing collected packages: tf2onnx
  Found existing installation: tf2onnx 1.5.3
    Uninstalling tf2onnx-1.5.3:
      Successfully uninstalled tf2onnx-1.5.3
Successfully installed tf2onnx-1.5.4
&lt;/denchmark-code&gt;

However, when I tried it again.
I still got this similar error.
&lt;denchmark-code&gt;WARNING:tensorflow:From /home/chieh/.local/lib/python3.6/site-packages/tf2onnx/verbose_logging.py:72: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

2020-01-09 08:32:26,632 - WARNING - From /home/chieh/.local/lib/python3.6/site-packages/tf2onnx/verbose_logging.py:72: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

2020-01-09 08:32:30,744 - INFO - Using tensorflow=1.14.0, onnx=1.6.0, tf2onnx=1.5.4/ee756a
2020-01-09 08:32:30,745 - INFO - Using opset &lt;onnx, 10&gt;
2020-01-09 08:32:35,127 - ERROR - Failed to convert node ROI/Pad
OP=Pad
Name=ROI/Pad
Inputs:
	ROI/GatherV2_3:0=Gather, [-1, 4], 1
	ROI/Pad/paddings_Concat__690:0=Concat, [2, 2], 6
Outpus:
	ROI/Pad:0=[-1, -1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/nn.py", line 440, in version_1
    paddings = np.array(node.inputs[1].get_tensor_value()).transpose().flatten()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/graph.py", line 260, in get_tensor_value
    raise ValueError("get tensor value: {} must be Const".format(self.name))
ValueError: get tensor value: ROI/Pad/paddings_Concat__690 must be Const
2020-01-09 08:32:35,133 - ERROR - Tensorflow op [roi_align_classifier/Round: Round] is not supported
2020-01-09 08:32:35,237 - ERROR - Tensorflow op [roi_align_classifier/CropAndResize_3: CropAndResize] is not supported
2020-01-09 08:32:35,245 - ERROR - Tensorflow op [roi_align_classifier/CropAndResize_2: CropAndResize] is not supported
2020-01-09 08:32:35,252 - ERROR - Tensorflow op [roi_align_classifier/CropAndResize_1: CropAndResize] is not supported
2020-01-09 08:32:35,260 - ERROR - Tensorflow op [roi_align_classifier/CropAndResize: CropAndResize] is not supported
2020-01-09 08:32:35,660 - ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation: DenseToDenseSetOperation] is not supported
2020-01-09 08:32:35,660 - ERROR - Tensorflow op [mrcnn_detection/SparseToDense: SparseToDense] is not supported
2020-01-09 08:32:35,668 - ERROR - Tensorflow op [mrcnn_detection/Unique: Unique] is not supported
2020-01-09 08:32:35,784 - ERROR - Failed to convert node mrcnn_detection/map/while/PadV2
OP=Pad
Name=mrcnn_detection/map/while/PadV2
Inputs:
	mrcnn_detection/map/while/GatherV2_3:0=Gather, [-1], 7
	mrcnn_detection/map/while/PadV2/paddings_Concat__1358:0=Concat, [1, 2], 6
	mrcnn_detection/map/while/PadV2/constant_values:0=Const, [], 7
Outpus:
	mrcnn_detection/map/while/PadV2:0=[-1], 7
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/nn.py", line 440, in version_1
    paddings = np.array(node.inputs[1].get_tensor_value()).transpose().flatten()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/graph.py", line 260, in get_tensor_value
    raise ValueError("get tensor value: {} must be Const".format(self.name))
ValueError: get tensor value: mrcnn_detection/map/while/PadV2/paddings_Concat__1358 must be Const
2020-01-09 08:32:35,801 - ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation_1: DenseToDenseSetOperation] is not supported
2020-01-09 08:32:35,801 - ERROR - Tensorflow op [mrcnn_detection/SparseToDense_1: SparseToDense] is not supported
2020-01-09 08:32:35,834 - ERROR - Failed to convert node mrcnn_detection/strided_slice_29
OP=StridedSlice
Name=mrcnn_detection/strided_slice_29
Inputs:
	mrcnn_detection/GatherV2_8:0=Gather, [-1], 1
	mrcnn_detection/strided_slice_29/stack:0=Const, [2], 6
	mrcnn_detection/strided_slice_29/stack_1:0=Const, [2], 6
	mrcnn_detection/strided_slice_29/stack_2:0=Const, [2], 6
Outpus:
	mrcnn_detection/strided_slice_29:0=[-1, 1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 746, in version_10
    cls.version_1(ctx, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 628, in version_1
    raise ValueError("StridedSlice: attribute " + attr_name + " not supported")
ValueError: StridedSlice: attribute new_axis_mask not supported
2020-01-09 08:32:35,835 - ERROR - Failed to convert node mrcnn_detection/strided_slice_28
OP=StridedSlice
Name=mrcnn_detection/strided_slice_28
Inputs:
	mrcnn_detection/ToFloat:0=Cast, [-1], 1
	mrcnn_detection/strided_slice_28/stack:0=Const, [2], 6
	mrcnn_detection/strided_slice_28/stack_1:0=Const, [2], 6
	mrcnn_detection/strided_slice_28/stack_2:0=Const, [2], 6
Outpus:
	mrcnn_detection/strided_slice_28:0=[-1, 1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 746, in version_10
    cls.version_1(ctx, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 628, in version_1
    raise ValueError("StridedSlice: attribute " + attr_name + " not supported")
ValueError: StridedSlice: attribute new_axis_mask not supported
2020-01-09 08:32:35,858 - ERROR - Failed to convert node mrcnn_detection/Pad
OP=Pad
Name=mrcnn_detection/Pad
Inputs:
	mrcnn_detection/concat_1:0=Concat, [-1, 6], 1
	mrcnn_detection/Pad/paddings_Concat__1399:0=Concat, [2, 2], 6
Outpus:
	mrcnn_detection/Pad:0=[-1, -1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/nn.py", line 440, in version_1
    paddings = np.array(node.inputs[1].get_tensor_value()).transpose().flatten()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/graph.py", line 260, in get_tensor_value
    raise ValueError("get tensor value: {} must be Const".format(self.name))
ValueError: get tensor value: mrcnn_detection/Pad/paddings_Concat__1399 must be Const
2020-01-09 08:32:35,865 - ERROR - Tensorflow op [roi_align_mask/Round: Round] is not supported
2020-01-09 08:32:35,979 - ERROR - Tensorflow op [roi_align_mask/CropAndResize_3: CropAndResize] is not supported
2020-01-09 08:32:35,986 - ERROR - Tensorflow op [roi_align_mask/CropAndResize_2: CropAndResize] is not supported
2020-01-09 08:32:35,993 - ERROR - Tensorflow op [roi_align_mask/CropAndResize_1: CropAndResize] is not supported
2020-01-09 08:32:36,000 - ERROR - Tensorflow op [roi_align_mask/CropAndResize: CropAndResize] is not supported
2020-01-09 08:32:36,070 - ERROR - Unsupported ops: Counter({'CropAndResize': 8, 'Round': 2, 'DenseToDenseSetOperation': 2, 'SparseToDense': 2, 'Unique': 1})
Traceback (most recent call last):
  File "/usr/lib/python3.6/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/usr/lib/python3.6/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/convert.py", line 161, in &lt;module&gt;
    main()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/convert.py", line 145, in main
    inputs_as_nchw=args.inputs_as_nchw)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 577, in process_tf_graph
    raise exceptions[0]
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/nn.py", line 440, in version_1
    paddings = np.array(node.inputs[1].get_tensor_value()).transpose().flatten()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/graph.py", line 260, in get_tensor_value
    raise ValueError("get tensor value: {} must be Const".format(self.name))
ValueError: get tensor value: ROI/Pad/paddings_Concat__690 must be Const
&lt;/denchmark-code&gt;

I usually saw the error about ROI/Pad/paddings.
Does Tensorflow-onnx not support Mask RCNN?
		</comment>
		<comment id='3' author='chiehpower' date='2020-01-09T16:28:50Z'>
		mask rcnn from the tensorflow model zoo should work.
Try adding --opset 11 to the command line.
But for this specific one DenseToDenseSetOperation and SparseToDense might be an issue.
		</comment>
		<comment id='4' author='chiehpower' date='2020-01-10T06:23:46Z'>
		
mask rcnn from the tensorflow model zoo should work.
Try adding --opset 11 to the command line.
But for this specific one DenseToDenseSetOperation and SparseToDense might be an issue.

I already did some different tests by opset 11 again.
&lt;denchmark-h:hr&gt;&lt;/denchmark-h&gt;

&lt;denchmark-h:h1&gt;Original Case&lt;/denchmark-h&gt;

&lt;denchmark-h:h2&gt;Command&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;python3 -m tf2onnx.convert --graphdef ./mask_rcnn_coco.pb --output ./mask_rcnn_coco.onnx \
    --fold_const --opset 11 \
    --inputs input_image:0,input_image_meta:0,input_anchors:0\
    --outputs mrcnn_mask/Reshape_2:0 
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Output error message&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;WARNING:tensorflow:From /home/chieh/.local/lib/python3.6/site-packages/tf2onnx/verbose_logging.py:72: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

2020-01-10 14:04:07,444 - WARNING - From /home/chieh/.local/lib/python3.6/site-packages/tf2onnx/verbose_logging.py:72: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

2020-01-10 14:04:12,125 - INFO - Using tensorflow=1.14.0, onnx=1.6.0, tf2onnx=1.5.4/ee756a
2020-01-10 14:04:12,125 - INFO - Using opset &lt;onnx, 11&gt;
2020-01-10 14:04:18,154 - ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation: DenseToDenseSetOperation] is not supported
2020-01-10 14:04:18,154 - ERROR - Tensorflow op [mrcnn_detection/SparseToDense: SparseToDense] is not supported
2020-01-10 14:04:18,335 - ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation_1: DenseToDenseSetOperation] is not supported
2020-01-10 14:04:18,335 - ERROR - Tensorflow op [mrcnn_detection/SparseToDense_1: SparseToDense] is not supported
2020-01-10 14:04:18,374 - ERROR - Failed to convert node mrcnn_detection/strided_slice_29
OP=StridedSlice
Name=mrcnn_detection/strided_slice_29
Inputs:
        mrcnn_detection/GatherV2_8:0=Gather, [-1], 1
        mrcnn_detection/strided_slice_29/stack:0=Const, [2], 6
        mrcnn_detection/strided_slice_29/stack_1:0=Const, [2], 6
        mrcnn_detection/strided_slice_29/stack_2:0=Const, [2], 6
Outpus:
        mrcnn_detection/strided_slice_29:0=[-1, 1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 746, in version_10
    cls.version_1(ctx, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 628, in version_1
    raise ValueError("StridedSlice: attribute " + attr_name + " not supported")
ValueError: StridedSlice: attribute new_axis_mask not supported
2020-01-10 14:04:18,375 - ERROR - Failed to convert node mrcnn_detection/strided_slice_28
OP=StridedSlice
Name=mrcnn_detection/strided_slice_28
Inputs:
        mrcnn_detection/ToFloat:0=Cast, [-1], 1
        mrcnn_detection/strided_slice_28/stack:0=Const, [2], 6
        mrcnn_detection/strided_slice_28/stack_1:0=Const, [2], 6
        mrcnn_detection/strided_slice_28/stack_2:0=Const, [2], 6
Outpus:
        mrcnn_detection/strided_slice_28:0=[-1, 1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 746, in version_10
    cls.version_1(ctx, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 628, in version_1
    raise ValueError("StridedSlice: attribute " + attr_name + " not supported")
ValueError: StridedSlice: attribute new_axis_mask not supported
2020-01-10 14:04:18,720 - ERROR - Unsupported ops: Counter({'DenseToDenseSetOperation': 2, 'SparseToDense': 2})
Traceback (most recent call last):
  File "/usr/lib/python3.6/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/usr/lib/python3.6/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/convert.py", line 161, in &lt;module&gt;
    main()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/convert.py", line 145, in main
    inputs_as_nchw=args.inputs_as_nchw)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 577, in process_tf_graph
    raise exceptions[0]
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 746, in version_10
    cls.version_1(ctx, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 628, in version_1
    raise ValueError("StridedSlice: attribute " + attr_name + " not supported")
ValueError: StridedSlice: attribute new_axis_mask not supported
&lt;/denchmark-code&gt;

&lt;denchmark-h:hr&gt;&lt;/denchmark-h&gt;

&lt;denchmark-h:h1&gt;mask_rcnn_inception_v2_coco_2018_01_28&lt;/denchmark-h&gt;

Download from : &lt;denchmark-link:https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md&gt;https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md&lt;/denchmark-link&gt;

&lt;denchmark-h:h2&gt;Analysis of mask_rcnn_inception_v2_coco_2018_01_28 about input and output names&lt;/denchmark-h&gt;

Command:
&lt;denchmark-code&gt;bazel-bin/tensorflow/tools/graph_transforms/summarize_graph --in_graph=./mask_rcnn_inception_v2_coco_2018_01_28/frozen_inference_graph.pb
&lt;/denchmark-code&gt;

Output:
&lt;denchmark-code&gt;Found 1 possible inputs: (name=image_tensor, type=uint8(4), shape=[?,?,?,3]) 
No variables spotted.
Found 5 possible outputs: (name=detection_boxes, op=Identity) (name=detection_scores, op=Identity) (name=detection_classes, op=Identity) (name=num_detections, op=Identity) (name=detection_masks, op=Identity) 
Found 15908904 (15.91M) const parameters, 0 (0) variable parameters, and 4170 control_edges
Op types used: 4976 Const, 902 StridedSlice, 560 Gather, 492 Mul, 486 Sub, 462 Minimum, 410 Identity, 369 Maximum, 323 Reshape, 276 Split, 219 ConcatV2, 209 Pack, 206 RealDiv, 205 Cast, 192 Greater, 183 Where, 159 Shape, 114 Slice, 113 Add, 99 Unpack, 98 Squeeze, 94 ZerosLike, 93 Conv2D, 91 NonMaxSuppressionV2, 89 Relu, 88 FusedBatchNorm, 55 Enter, 45 Switch, 39 Range, 27 ExpandDims, 24 Merge, 22 TensorArrayV3, 15 NextIteration, 15 Fill, 12 TensorArrayScatterV3, 12 Tile, 12 TensorArrayReadV3, 10 TensorArraySizeV3, 10 TensorArrayWriteV3, 10 Exit, 10 TensorArrayGatherV3, 9 MaxPool, 8 AvgPool, 7 BiasAdd, 7 Transpose, 6 Rank, 6 Assert, 5 LoopCond, 5 Equal, 5 Less, 4 Exp, 4 Round, 2 Softmax, 2 Size, 2 CropAndResize, 2 ResizeBilinear, 2 TopKV2, 2 GreaterEqual, 2 MatMul, 1 All, 1 DepthwiseConv2dNative, 1 Sqrt, 1 Sigmoid, 1 Relu6, 1 Placeholder, 1 Mean, 1 LogicalAnd, 1 Max
To use with tensorflow/tools/benchmark:benchmark_model try these arguments:
bazel run tensorflow/tools/benchmark:benchmark_model -- --graph=/home/chieh/Downloads/TensorRT-7.0.0.11/samples/python/mrcnn/mask_rcnn_inception_v2_coco_2018_01_28/frozen_inference_graph.pb --show_flops --input_layer=image_tensor --input_layer_type=uint8 --input_layer_shape=-1,-1,-1,3 --output_layer=detection_boxes,detection_scores,detection_classes,num_detections,detection_masks
&lt;/denchmark-code&gt;

So we knew the input is image_tensor and output is detection_boxes, detection_scores, detection_classes, num_detections, detection_masks.
&lt;denchmark-h:h2&gt;Command&lt;/denchmark-h&gt;

First time, I used this command.
&lt;denchmark-code&gt;python3 -m tf2onnx.convert --graphdef ../mask_rcnn_inception_v2_coco_2018_01_28/frozen_inference_graph.pb --output ../mask_rcnn_inception_v2_coco_2018_01_28/mask_rcnn_coco.onnx \
     --fold_const --opset 11 \
     --inputs image_tensor:0\
     --outputs detection_boxes:0, detection_scores:0, detection_classes:0, num_detections:0, detection_masks:0
&lt;/denchmark-code&gt;

Then I got the error.
&lt;denchmark-code&gt;convert.py: error: unrecognized arguments: detection_scores:0, detection_classes:0, num_detections:0, detection_masks:0
&lt;/denchmark-code&gt;

So I got rid of them.
Do again.
&lt;denchmark-h:h2&gt;Command&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;python3 -m tf2onnx.convert --graphdef ../mask_rcnn_inception_v2_coco_2018_01_28/frozen_inference_graph.pb --output ../mask_rcnn_inception_v2_coco_2018_01_28/mask_rcnn_coco.onnx \
    --fold_const --opset 11 \
    --inputs image_tensor:0\
    --outputs detection_boxes:0
&lt;/denchmark-code&gt;

Finally I can convert it.
&lt;denchmark-h:h2&gt;Output&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;2020-01-10 13:48:08,635 - INFO - Using tensorflow=1.14.0, onnx=1.6.0, tf2onnx=1.5.4/ee756a
2020-01-10 13:48:08,635 - INFO - Using opset &lt;onnx, 11&gt;
2020-01-10 13:48:15,790 - WARNING - Cannot infer shape for BatchMultiClassNonMaxSuppression/map/while/PadOrClipBoxList/cond/zeros: BatchMultiClassNonMaxSuppression/map/while/PadOrClipBoxList/cond/zeros:0
2020-01-10 13:48:15,790 - WARNING - Cannot infer shape for BatchMultiClassNonMaxSuppression_1/map/while/PadOrClipBoxList/cond/zeros: BatchMultiClassNonMaxSuppression_1/map/while/PadOrClipBoxList/cond/zeros:0
2020-01-10 13:49:05,276 - INFO - Optimizing ONNX model
2020-01-10 13:52:18,094 - INFO - After optimization: Add -72 (286-&gt;214), Cast -406 (1230-&gt;824), Const -3728 (7474-&gt;3746), Div -4 (206-&gt;202), Gather +3 (565-&gt;568), Identity -878 (881-&gt;3), Mul -5 (583-&gt;578), Reshape +1 (305-&gt;306), Shape -7 (128-&gt;121), Slice -4 (1064-&gt;1060), Squeeze -380 (1533-&gt;1153), Transpose -170 (366-&gt;196), Unsqueeze -492 (815-&gt;323)
2020-01-10 13:52:19,157 - INFO - 
2020-01-10 13:52:19,158 - INFO - Successfully converted TensorFlow model ../mask_rcnn_inception_v2_coco_2018_01_28/frozen_inference_graph.pb to ONNX
2020-01-10 13:52:19,230 - INFO 
&lt;/denchmark-code&gt;

However, I have not idea that why cannot I pass the first time? The output should be used detection_boxes, detection_scores, detection_classes, num_detections, detection_masks, no? (If you know why, could you give me some sense? Thank you!)
&lt;denchmark-h:h1&gt;Conclusion&lt;/denchmark-h&gt;


Even I used opset 11, it still happen error about something not supported.
How to define the output name? Or how to decide the output nodes? I used the tool of summarize_graph to see output names, but it looks not helpful to me.

		</comment>
		<comment id='5' author='chiehpower' date='2020-01-10T16:16:12Z'>
		Cool, thanks for not giving up!
The outputs - if it is coming from the tf object detection model zoo
num_detections:0,detection_boxes:0,detection_scores:0,detection_classes:0 should work. but I think you had a space behind the comma which the python.
		</comment>
		<comment id='6' author='chiehpower' date='2020-01-13T01:58:01Z'>
		
Cool, thanks for not giving up!
The outputs - if it is coming from the tf object detection model zoo
num_detections:0,detection_boxes:0,detection_scores:0,detection_classes:0 should work. but I think you had a space behind the comma which the python.

Thanks for your reminding! It helps me a lot!
However, after I amended it, it got stuck for a long time (Over 30 mins). I don't know how was it going.
&lt;denchmark-link:https://user-images.githubusercontent.com/32332200/72229625-0246c300-35eb-11ea-96c4-d539711588cf.png&gt;&lt;/denchmark-link&gt;

And then I cannot wait for any results or advanced progress....
		</comment>
		<comment id='7' author='chiehpower' date='2020-01-15T16:56:43Z'>
		Hi, I faced same problem that "ValueError: StridedSlice: attribute new_axis_mask not supported", and reported at issue &lt;denchmark-link:https://github.com/onnx/tensorflow-onnx/issues/763&gt;#763&lt;/denchmark-link&gt;
.
I also tried opset 10, opset 11, new version of tf2onnx, frozen input and other attempts like you. Now I have no idea how to fix the bug.
I hope you successfully solve it, and share the solution.
		</comment>
		<comment id='8' author='chiehpower' date='2020-02-18T08:57:45Z'>
		Hello, I ran this exact command on a model of the TF Zoo

python3 -m tf2onnx.convert --graphdef mask_rcnn_inception_v2_coco_2018_01_28/frozen_inference_graph.pb --output mask_rcnn_coco.onnx 
    --fold_const --opset 11 
    --inputs image_tensor:0
    --outputs detection_boxes:0,detection_scores:0,num_detections:0,detection_classes:0

I let the program run overnight because it took a really long time, but it did end up converting the Mask-RCNN into an ONNX network so I think you just really need to wait.
		</comment>
		<comment id='9' author='chiehpower' date='2020-02-19T03:50:51Z'>
		It looks like this model takes a while to convert, but eventually succeeds.
I'll close this for now. Please reopen if needed.
		</comment>
		<comment id='10' author='chiehpower' date='2020-03-05T06:29:45Z'>
		
It looks like this model takes a while to convert, but eventually succeeds.
I'll close this for now. Please reopen if needed.

Before it only solved the case of  which was downloaded from the &lt;denchmark-link:https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md&gt;Tensorflow detection model zoo&lt;/denchmark-link&gt;
. I am sorry about that I still have this issue for the  part of my initial description. &lt;denchmark-link:https://github.com/jignparm&gt;@jignparm&lt;/denchmark-link&gt;
 Could you reopen this issue please? Thank you.
After previously discussion, I updated my optional command from opset 10 to opset 11 and input/ output nodes. Let me describe my reproduced steps again.
&lt;denchmark-h:h1&gt;To Reproduce&lt;/denchmark-h&gt;


Download the file from github
https://github.com/NVIDIA/TensorRT/tree/master/samples/opensource/sampleUffMaskRCNN/converted/mrcnn_to_trt_single.py
Follow the step 6 of prerequisites to get the model.
wget https://github.com/matterport/Mask_RCNN/releases/download/v2.0/mask_rcnn_coco.h5
Modify the code of mrcnn_to_trt_single.py. We just need to get rid of this function uff.from_tensorflow_frozen_model from line 150 to line 160. In addition, modify the output .pb path, here.
Then we can implement this command.

&lt;denchmark-code&gt;python3 mrcnn_to_trt_single.py -w ./mask_rcnn_coco.h5 -o ./mask_rcnn_coco.uff
&lt;/denchmark-code&gt;

Dont worry. It just requests users to provide an output .uff path, but it will not be used in the end.
We can get a .pb file.
BTW if you didn't have the uff package, please remove it from &lt;denchmark-link:https://github.com/NVIDIA/TensorRT/blob/5e289e919eabdc563208b82e88ac298ac50ffbfb/samples/opensource/sampleUffMaskRCNN/converted/mrcnn_to_trt_single.py#L33&gt;here&lt;/denchmark-link&gt;

Also, I used the TF tool, summarize_graph, to confirm the input and output names.
&lt;denchmark-code&gt;Found 3 possible inputs: (name=input_image, type=float(1), shape=[?,3,1024,1024]) (name=input_image_meta, type=float(1), shape=[?,93]) (name=input_anchors, type=float(1), shape=[?,?,4]) 
No variables spotted.
Found 1 possible outputs: (name=mrcnn_mask/Reshape_1, op=Reshape) 
&lt;/denchmark-code&gt;

In brief, we took the MaskRCNN of matterport which is used by Keras, and we need to convert the .h5 model to .pb model first.
Next step, I hope that I can convert this .pb to .onnx.
Eventually, type this command on our terminal line.
&lt;denchmark-code&gt;python3 -m tf2onnx.convert --graphdef ./mask_rcnn_coco.pb --output ./mask_rcnn_coco.onnx \
    --fold_const --opset 11 \
    --inputs input_image:0,input_image_meta:0,input_anchors:0\
    --outputs mrcnn_mask/Reshape_1:0
&lt;/denchmark-code&gt;

Be careful of your .pb path.
&lt;denchmark-h:h1&gt;Output Information&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;WARNING:tensorflow:From /home/chieh/.local/lib/python3.6/site-packages/tf2onnx/verbose_logging.py:72: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

2020-03-05 14:12:32,638 - WARNING - From /home/chieh/.local/lib/python3.6/site-packages/tf2onnx/verbose_logging.py:72: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

2020-03-05 14:12:36,686 - INFO - Using tensorflow=1.14.0, onnx=1.6.0, tf2onnx=1.5.4/ee756a
2020-03-05 14:12:36,686 - INFO - Using opset &lt;onnx, 11&gt;
2020-03-05 14:12:41,545 - ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation: DenseToDenseSetOperation] is not supported
2020-03-05 14:12:41,545 - ERROR - Tensorflow op [mrcnn_detection/SparseToDense: SparseToDense] is not supported
2020-03-05 14:12:41,686 - ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation_1: DenseToDenseSetOperation] is not supported
2020-03-05 14:12:41,686 - ERROR - Tensorflow op [mrcnn_detection/SparseToDense_1: SparseToDense] is not supported
2020-03-05 14:12:41,717 - ERROR - Failed to convert node mrcnn_detection/strided_slice_29
OP=StridedSlice
Name=mrcnn_detection/strided_slice_29
Inputs:
	mrcnn_detection/GatherV2_8:0=Gather, [-1], 1
	mrcnn_detection/strided_slice_29/stack:0=Const, [2], 6
	mrcnn_detection/strided_slice_29/stack_1:0=Const, [2], 6
	mrcnn_detection/strided_slice_29/stack_2:0=Const, [2], 6
Outpus:
	mrcnn_detection/strided_slice_29:0=[-1, 1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 746, in version_10
    cls.version_1(ctx, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 628, in version_1
    raise ValueError("StridedSlice: attribute " + attr_name + " not supported")
ValueError: StridedSlice: attribute new_axis_mask not supported
2020-03-05 14:12:41,718 - ERROR - Failed to convert node mrcnn_detection/strided_slice_28
OP=StridedSlice
Name=mrcnn_detection/strided_slice_28
Inputs:
	mrcnn_detection/ToFloat:0=Cast, [-1], 1
	mrcnn_detection/strided_slice_28/stack:0=Const, [2], 6
	mrcnn_detection/strided_slice_28/stack_1:0=Const, [2], 6
	mrcnn_detection/strided_slice_28/stack_2:0=Const, [2], 6
Outpus:
	mrcnn_detection/strided_slice_28:0=[-1, 1], 1
Traceback (most recent call last):
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 746, in version_10
    cls.version_1(ctx, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 628, in version_1
    raise ValueError("StridedSlice: attribute " + attr_name + " not supported")
ValueError: StridedSlice: attribute new_axis_mask not supported
2020-03-05 14:12:41,964 - ERROR - Unsupported ops: Counter({'DenseToDenseSetOperation': 2, 'SparseToDense': 2})
Traceback (most recent call last):
  File "/usr/lib/python3.6/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/usr/lib/python3.6/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/convert.py", line 161, in &lt;module&gt;
    main()
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/convert.py", line 145, in main
    inputs_as_nchw=args.inputs_as_nchw)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 577, in process_tf_graph
    raise exceptions[0]
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/tfonnx.py", line 354, in tensorflow_onnx_mapping
    func(g, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 746, in version_10
    cls.version_1(ctx, node, **kwargs)
  File "/home/chieh/.local/lib/python3.6/site-packages/tf2onnx/onnx_opset/tensor.py", line 628, in version_1
    raise ValueError("StridedSlice: attribute " + attr_name + " not supported")
ValueError: StridedSlice: attribute new_axis_mask not supported
&lt;/denchmark-code&gt;

Is there any solution about this issue?
		</comment>
		<comment id='11' author='chiehpower' date='2020-03-05T07:28:27Z'>
		
ValueError: StridedSlice: attribute new_axis_mask not supported

&lt;denchmark-link:https://github.com/chiehpower&gt;@chiehpower&lt;/denchmark-link&gt;
 , you should not see the error message above if you use the master branch of tf2onnx (or latest python package). This should be fixed as of mid January (see &lt;denchmark-link:https://github.com/onnx/tensorflow-onnx/pull/774&gt;#774&lt;/denchmark-link&gt;
).
Can you update your tf2onnx converter and retry?
		</comment>
		<comment id='12' author='chiehpower' date='2020-03-06T00:41:09Z'>
		Hi &lt;denchmark-link:https://github.com/jignparm&gt;@jignparm&lt;/denchmark-link&gt;
,
Thanks for your information and reply.
I re-pull again and reinstall it. (My present version is 1.6.0), I still meet the same issue.
Moreover, I also tried it on my Jetson AGX device. Although it looked like successful, it showed some warnings and some errors of not supported operations. I am worry about whether it is complete converting to onnx or not.
&lt;denchmark-h:h3&gt;Output of AGX&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;2020-03-05 18:03:41.436614: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
/home/nvidia/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/nvidia/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING:tensorflow:From /home/nvidia/github/tensorflow-onnx/tf2onnx/verbose_logging.py:76: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

2020-03-05 18:03:47,254 - WARNING - From /home/nvidia/github/tensorflow-onnx/tf2onnx/verbose_logging.py:76: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

2020-03-05 18:03:47.290579: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-03-05 18:03:47.297576: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:03:47.297868: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Xavier major: 7 minor: 2 memoryClockRate(GHz): 1.377
pciBusID: 0000:00:00.0
2020-03-05 18:03:47.297958: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-03-05 18:03:47.300071: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-03-05 18:03:47.326106: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-03-05 18:03:47.363038: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-03-05 18:03:47.403694: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-03-05 18:03:47.427831: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-03-05 18:03:47.436103: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-03-05 18:03:47.436387: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:03:47.436759: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:03:47.436902: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-03-05 18:03:47.457066: W tensorflow/core/platform/profile_utils/cpu_utils.cc:98] Failed to find bogomips in /proc/cpuinfo; cannot determine CPU frequency
2020-03-05 18:03:47.458472: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x306644a0 executing computations on platform Host. Devices:
2020-03-05 18:03:47.458599: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): &lt;undefined&gt;, &lt;undefined&gt;
2020-03-05 18:03:47.545429: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:03:47.545887: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x32bfd290 executing computations on platform CUDA. Devices:
2020-03-05 18:03:47.545979: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Xavier, Compute Capability 7.2
2020-03-05 18:03:47.546596: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:03:47.546818: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Xavier major: 7 minor: 2 memoryClockRate(GHz): 1.377
pciBusID: 0000:00:00.0
2020-03-05 18:03:47.546929: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-03-05 18:03:47.547008: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-03-05 18:03:47.547101: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-03-05 18:03:47.547158: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-03-05 18:03:47.547205: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-03-05 18:03:47.547253: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-03-05 18:03:47.547301: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-03-05 18:03:47.547495: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:03:47.547670: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:03:47.547758: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-03-05 18:03:47.547896: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-03-05 18:03:49.898004: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-03-05 18:03:49.898099: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-03-05 18:03:49.898176: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-03-05 18:03:49.898651: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:03:49.898952: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:03:49.899092: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 19026 MB memory) -&gt; physical GPU (device: 0, name: Xavier, pci bus id: 0000:00:00.0, compute capability: 7.2)
2020-03-05 18:04:05.123628: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:04:05.123845: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Xavier major: 7 minor: 2 memoryClockRate(GHz): 1.377
pciBusID: 0000:00:00.0
2020-03-05 18:04:05.123937: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-03-05 18:04:05.123987: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-03-05 18:04:05.124040: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-03-05 18:04:05.124104: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-03-05 18:04:05.124195: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-03-05 18:04:05.124263: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-03-05 18:04:05.124324: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-03-05 18:04:05.124550: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:04:05.124700: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:04:05.124771: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-03-05 18:04:05.124836: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-03-05 18:04:05.124869: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-03-05 18:04:05.124892: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-03-05 18:04:05.125018: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:04:05.125206: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:04:05.125492: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 19026 MB memory) -&gt; physical GPU (device: 0, name: Xavier, pci bus id: 0000:00:00.0, compute capability: 7.2)
2020-03-05 18:04:10.747293: I tensorflow/tools/graph_transforms/transform_graph.cc:317] Applying fold_constants
2020-03-05 18:04:12.727186: I tensorflow/tools/graph_transforms/transform_graph.cc:317] Applying remove_attribute
2020-03-05 18:04:12.811766: I tensorflow/tools/graph_transforms/transform_graph.cc:317] Applying fold_batch_norms
2020-03-05 18:04:12.992873: I tensorflow/tools/graph_transforms/transform_graph.cc:317] Applying fold_old_batch_norms
2020-03-05 18:04:16.792814: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:04:16.793012: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Xavier major: 7 minor: 2 memoryClockRate(GHz): 1.377
pciBusID: 0000:00:00.0
2020-03-05 18:04:16.793089: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-03-05 18:04:16.793156: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-03-05 18:04:16.793259: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-03-05 18:04:16.793300: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-03-05 18:04:16.793340: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-03-05 18:04:16.793379: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-03-05 18:04:16.793415: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-03-05 18:04:16.793540: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:04:16.793683: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:04:16.793754: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-03-05 18:04:16.793828: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-03-05 18:04:16.793858: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-03-05 18:04:16.793884: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-03-05 18:04:16.793998: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:04:16.794151: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:972] ARM64 does not support NUMA - returning NUMA node zero
2020-03-05 18:04:16.794337: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 19026 MB memory) -&gt; physical GPU (device: 0, name: Xavier, pci bus id: 0000:00:00.0, compute capability: 7.2)
2020-03-05 18:04:16,794 - INFO - Using tensorflow=1.14.0, onnx=1.6.0, tf2onnx=1.6.0/c5e560
2020-03-05 18:04:16,795 - INFO - Using opset &lt;onnx, 11&gt;
2020-03-05 18:04:38,024 - ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation: DenseToDenseSetOperation] is not supported
2020-03-05 18:04:38,025 - ERROR - Tensorflow op [mrcnn_detection/SparseToDense: SparseToDense] is not supported
2020-03-05 18:04:38,516 - ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation_1: DenseToDenseSetOperation] is not supported
2020-03-05 18:04:38,517 - ERROR - Tensorflow op [mrcnn_detection/SparseToDense_1: SparseToDense] is not supported
2020-03-05 18:04:39,519 - ERROR - Unsupported ops: Counter({'DenseToDenseSetOperation': 2, 'SparseToDense': 2})
2020-03-05 18:04:40,391 - INFO - Optimizing ONNX model
2020-03-05 18:04:40,918 - WARNING - Failed to apply optimize_transpose
Traceback (most recent call last):
  File "/home/nvidia/github/tensorflow-onnx/tf2onnx/optimizer/__init__.py", line 50, in optimize_graph
    current = copy.deepcopy(graph)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 220, in _deepcopy_tuple
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 220, in &lt;listcomp&gt;
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 159, in deepcopy
    copier = getattr(x, "__deepcopy__", None)
ReferenceError: weakly-referenced object no longer exists
2020-03-05 18:04:41,884 - WARNING - Failed to apply fold_constants
Traceback (most recent call last):
  File "/home/nvidia/github/tensorflow-onnx/tf2onnx/optimizer/__init__.py", line 50, in optimize_graph
    current = copy.deepcopy(graph)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 220, in _deepcopy_tuple
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 220, in &lt;listcomp&gt;
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 159, in deepcopy
    copier = getattr(x, "__deepcopy__", None)
ReferenceError: weakly-referenced object no longer exists
2020-03-05 18:04:42,801 - WARNING - Failed to apply loop_optimizer
Traceback (most recent call last):
  File "/home/nvidia/github/tensorflow-onnx/tf2onnx/optimizer/__init__.py", line 50, in optimize_graph
    current = copy.deepcopy(graph)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 220, in _deepcopy_tuple
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 220, in &lt;listcomp&gt;
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 159, in deepcopy
    copier = getattr(x, "__deepcopy__", None)
ReferenceError: weakly-referenced object no longer exists
2020-03-05 18:04:43,292 - WARNING - Failed to apply merge_duplication
Traceback (most recent call last):
  File "/home/nvidia/github/tensorflow-onnx/tf2onnx/optimizer/__init__.py", line 50, in optimize_graph
    current = copy.deepcopy(graph)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 220, in _deepcopy_tuple
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 220, in &lt;listcomp&gt;
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 159, in deepcopy
    copier = getattr(x, "__deepcopy__", None)
ReferenceError: weakly-referenced object no longer exists
2020-03-05 18:04:44,201 - WARNING - Failed to apply remove_identity
Traceback (most recent call last):
  File "/home/nvidia/github/tensorflow-onnx/tf2onnx/optimizer/__init__.py", line 50, in optimize_graph
    current = copy.deepcopy(graph)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 220, in _deepcopy_tuple
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 220, in &lt;listcomp&gt;
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 159, in deepcopy
    copier = getattr(x, "__deepcopy__", None)
ReferenceError: weakly-referenced object no longer exists
2020-03-05 18:04:44,688 - WARNING - Failed to apply remove_back_to_back
Traceback (most recent call last):
  File "/home/nvidia/github/tensorflow-onnx/tf2onnx/optimizer/__init__.py", line 50, in optimize_graph
    current = copy.deepcopy(graph)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 220, in _deepcopy_tuple
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 220, in &lt;listcomp&gt;
    y = [deepcopy(a, memo) for a in x]
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 180, in deepcopy
    y = _reconstruct(x, memo, *rv)
  File "/usr/lib/python3.6/copy.py", line 280, in _reconstruct
    state = deepcopy(state, memo)
  File "/usr/lib/python3.6/copy.py", line 150, in deepcopy
    y = copier(x, memo)
  File "/usr/lib/python3.6/copy.py", line 240, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "/usr/lib/python3.6/copy.py", line 159, in deepcopy
    copier = getattr(x, "__deepcopy__", None)
ReferenceError: weakly-referenced object no longer exists
2020-03-05 18:04:44,905 - INFO - After optimization: no change
2020-03-05 18:04:46,038 - INFO - 
2020-03-05 18:04:46,039 - INFO - Successfully converted TensorFlow model ./temp.pb to ONNX
2020-03-05 18:04:46,556 - INFO - ONNX model is saved at ./mask_rcnn.onnx
&lt;/denchmark-code&gt;

Would you mind to test it? Here is &lt;denchmark-link:https://drive.google.com/file/d/1TRjMRyEMIEH82nlaPY3qigMI1y7MFlPs/view?usp=sharing&gt;my model&lt;/denchmark-link&gt;
.
We can notice that there are some unsupported ops. When we meet this kind of cases, how to properly deal with this situation? Is there any good method?
&lt;denchmark-code&gt;ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation: DenseToDenseSetOperation] is not supported
ERROR - Tensorflow op [mrcnn_detection/SparseToDense: SparseToDense] is not supported
ERROR - Tensorflow op [mrcnn_detection/DenseToDenseSetOperation_1: DenseToDenseSetOperation] is not supported
ERROR - Tensorflow op [mrcnn_detection/SparseToDense_1: SparseToDense] is not supported
ERROR - Unsupported ops: Counter({'DenseToDenseSetOperation': 2, 'SparseToDense': 2})
&lt;/denchmark-code&gt;

Thank you in advanced!!
		</comment>
		<comment id='13' author='chiehpower' date='2020-06-13T06:40:26Z'>
		&lt;denchmark-link:https://github.com/chiehpower&gt;@chiehpower&lt;/denchmark-link&gt;
,  PR &lt;denchmark-link:https://github.com/onnx/tensorflow-onnx/pull/972&gt;#972&lt;/denchmark-link&gt;
 should resolve this issue. Let me know if you see any errors. Sorry the delay -- it took a while before we got a model to reproduce the error systematically.
		</comment>
	</comments>
</bug>