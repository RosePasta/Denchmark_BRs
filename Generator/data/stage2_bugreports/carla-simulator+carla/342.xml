<bug id='342' author='wzhAptiv' open_date='2018-04-10T16:22:15Z' closed_time='2018-04-25T07:52:09Z'>
	<summary>Wrong agent transformation location</summary>
	<description>
New issue content in the comment below, which is located and solved in &lt;denchmark-link:https://github.com/carla-simulator/carla/issues/345&gt;#345&lt;/denchmark-link&gt;
.
'I followed #314 to plot bbox on my camera. '
'Using box_extend &amp; location &amp; rotation, I can get the 3d coordinate for vertices in all 3D bbox in the world space. Then I transform all vertices to my camera coordinate, then draw a box covering all eight vertices for each object. '
'Following the code in the issue above, I found I the transformation is wrong because of '
'get_unreal_transform() in carla.sensor.Sensor '
'the 'to_unreal_transform' will make unexpected transformation that the shape and size of the car will change in this space. '
'Other transformation will keep the shape and size of a car stable in its space. '
'I don't really understand why we need do this unreal_transform, with roll=-90, yaw=90, scale_x=-1. '
'Also, the wrong transformation only affects turning cars, significant when world_yaw is [+-45, +-135].
'
'Thank you!'
	</description>
	<comments>
		<comment id='1' author='wzhAptiv' date='2018-04-11T10:55:02Z'>
		'@marcgpuig screenshot added. '
'The car in the red circle shows the wrong vertices, normally, it should be like in the yellow circle. '
'The problem only occurs when it's turning. But the car in the space of 'to_unreal_transform' will have different shape &amp; size according to its yaw. '
&lt;denchmark-link:https://user-images.githubusercontent.com/37740387/38612504-31ae97fc-3d87-11e8-9ba2-41c74ab5b63d.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='wzhAptiv' date='2018-04-11T13:56:25Z'>
		'@marcgpuig Hello, after some more experiment, I found that the box_extent from agent is not stable,  and may contains negative value. '
'Could you please explain what's the actual meaning of this measurement? '
'I thought it was the metrics from 3D-model, and won't be affected by its location/orientation.  '
'I think it may be only the vector to one of the vertex, based on world space, which may reach possibility that a box extent is zero if the vertex rotate to [0, 90, 180, 270] degrees. '
		</comment>
		<comment id='3' author='wzhAptiv' date='2018-04-12T08:24:36Z'>
		&lt;denchmark-link:https://github.com/marcgpuig&gt;@marcgpuig&lt;/denchmark-link&gt;
 Sorry for this issue, I've finally found that it's because of some bug in my script.
But another problem is for this as well. I feel the z-axis in 'location' is not at the center but at the chassis of the car, when calculating the 3D-bbox for each object, I need to use location.z + 2*box_extend.z. And also need to minus the wheel height.
Is this intended to be like this?
Thank you!
		</comment>
		<comment id='4' author='wzhAptiv' date='2018-04-12T10:49:43Z'>
		Hi &lt;denchmark-link:https://github.com/marcgpuig&gt;@marcgpuig&lt;/denchmark-link&gt;
 , thank you for your reply. I made some mistake and is explained in the last comment. But I got some other question on the transform.location for each agent. Could you please check it?
		</comment>
		<comment id='5' author='wzhAptiv' date='2018-04-12T10:55:25Z'>
		Well &lt;denchmark-link:https://github.com/wzhAptiv&gt;@wzhAptiv&lt;/denchmark-link&gt;

I send a message that I wrote yesterday but wanted to check a few things this morning. I sended it without reloading this page so I didn't read your last message, sorry for that, I just delete it.
Let me check this new information and I'll reply you soon :)
		</comment>
		<comment id='6' author='wzhAptiv' date='2018-04-12T13:30:05Z'>
		Hi &lt;denchmark-link:https://github.com/wzhAptiv&gt;@wzhAptiv&lt;/denchmark-link&gt;

Thanks for your feedback!
We localized the problem, look at &lt;denchmark-link:https://github.com/carla-simulator/carla/issues/345&gt;#345&lt;/denchmark-link&gt;
.
		</comment>
		<comment id='7' author='wzhAptiv' date='2018-04-12T13:57:24Z'>
		&lt;denchmark-link:https://github.com/marcgpuig&gt;@marcgpuig&lt;/denchmark-link&gt;
 Thank you for your help!
		</comment>
		<comment id='8' author='wzhAptiv' date='2018-06-08T06:19:29Z'>
		&lt;denchmark-link:https://github.com/wzhAptiv&gt;@wzhAptiv&lt;/denchmark-link&gt;
  I am currently working on drawing 2d bounding box. May i know how u find the vertex of the 3d bounding box and transfer them to camera coordinates? thanks a lot!!!
		</comment>
		<comment id='9' author='wzhAptiv' date='2018-06-08T08:25:38Z'>
		Hi &lt;denchmark-link:https://github.com/lxtttt&gt;@lxtttt&lt;/denchmark-link&gt;
 , try &lt;denchmark-link:https://github.com/carla-simulator/carla/issues/314&gt;#314&lt;/denchmark-link&gt;
 and this &lt;denchmark-link:http://carla.readthedocs.io/en/latest/measurements/&gt;documentation&lt;/denchmark-link&gt;

		</comment>
		<comment id='10' author='wzhAptiv' date='2018-06-20T02:20:57Z'>
		&lt;denchmark-link:https://github.com/wzhAptiv&gt;@wzhAptiv&lt;/denchmark-link&gt;
  sorry to disturb again, Iâ€™m using the same method as yours and met the same problem: the bounding box cannot cover the whole vehicle when the vehicle is turning. do you know what the problem is? thanks a lot!
&lt;denchmark-link:https://user-images.githubusercontent.com/39181638/41633841-6d077e0e-7473-11e8-9243-c4dc8f70c63b.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='11' author='wzhAptiv' date='2018-06-20T07:31:22Z'>
		Hi &lt;denchmark-link:https://github.com/lxtttt&gt;@lxtttt&lt;/denchmark-link&gt;
 , you need to convert the eight vertices of the 3D bounding box of the object vehicle into world coordinate, then apply the projection to camera. According to your screenshot, maybe you only consider four front vertices, not the complete eight ones.
		</comment>
	</comments>
</bug>