<bug id='2716' author='a-boinet' open_date='2020-04-10T10:30:10Z' closed_time='2020-07-01T17:37:52Z'>
	<summary>Wheels lagging behind car body using LiDAR (CARLA_0.9.8)</summary>
	<description>
Wheels seem to move with at least a one frame delay after the car body, as shown below :
&lt;denchmark-link:https://user-images.githubusercontent.com/30056175/78982705-fe133e80-7b22-11ea-9d4d-e756d87a72e6.png&gt;&lt;/denchmark-link&gt;

During acceleration, the shift is even more important :
&lt;denchmark-link:https://user-images.githubusercontent.com/30056175/78982166-d4a5e300-7b21-11ea-96b4-6a90d1d5dc9e.png&gt;&lt;/denchmark-link&gt;

When the car first starts, its wheels are at the back of the body.
If the car accelerates, the wheels start lagging behind the body.
And when the car stops, the wheels eventually catch up after a few frames.
I'm running on carla 0.9.8, in synchronous mode at 10 fps.
LiDAR attributes are :
lidar_attributes = {
        "channels": 128,
        "range": 75,  # In carla 0.9.7 This is meters !!!!
        "points_per_second": 4800000,  # 100000
        "rotation_frequency": 20,
        "upper_fov": 15.0,
        "lower_fov": -25.0,
        "sensor_tick": 0.0,
    }
# The position of the LiDAR sensor in the host vehicle reference frame is
x=0, y=0, z=2.5
My guess is that the wheels collision boxes and the body collision box aren't updated at the same time, but that's anyone's guess
	</description>
	<comments>
		<comment id='1' author='a-boinet' date='2020-04-28T15:33:14Z'>
		Hi &lt;denchmark-link:https://github.com/a-boinet&gt;@a-boinet&lt;/denchmark-link&gt;

Thanks for your feedback, we will look into that, this could be caused because of how UE4 handles the ray cast. Maybe using different flags for ray casting could solve it. It is UE 4.22 right?
		</comment>
		<comment id='2' author='a-boinet' date='2020-04-28T15:43:39Z'>
		Hi &lt;denchmark-link:https://github.com/marcgpuig&gt;@marcgpuig&lt;/denchmark-link&gt;

Thanks for your reply. It is UE 4.22 indeed.
I'll test this on CARLA 0.9.9 asap to see if it makes any difference.
		</comment>
		<comment id='3' author='a-boinet' date='2020-04-30T14:39:11Z'>
		It looks exactly the same on CARLA 0.9.9 (UE 4.24) :
&lt;denchmark-link:https://user-images.githubusercontent.com/30056175/80722986-4c9f7180-8b00-11ea-93fc-88bb359ff2ec.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='4' author='a-boinet' date='2020-04-30T18:21:41Z'>
		&lt;denchmark-link:https://github.com/a-boinet&gt;@a-boinet&lt;/denchmark-link&gt;
 Thanks for your quick testing.
This has been also commented in &lt;denchmark-link:https://github.com/carla-simulator/carla/issues/1670&gt;#1670&lt;/denchmark-link&gt;
 and may be slightly related to &lt;denchmark-link:https://github.com/carla-simulator/carla/issues/423&gt;#423&lt;/denchmark-link&gt;
.
We need to investigate why the wheels are behind the car collision box, whether it's how the physics engine tick works or if we can really do something about it. This search could also be extended to find a suitable ray cast emission that can correctly detect UE4's SkeletalMeshe and not just the car's bounding box, so it can detect the shape of the car correctly.
We definitely need to find some time to address it.
This could also be happening with the radar sensor as it uses the same physics parameters, but I haven't tested it yet.
		</comment>
		<comment id='5' author='a-boinet' date='2020-06-23T13:50:11Z'>
		Hi &lt;denchmark-link:https://github.com/a-boinet&gt;@a-boinet&lt;/denchmark-link&gt;
 sorry for the late update.
We're improving the vehicle collision meshes and now looks way better, with these changes this wheel problem should be fixed too!
&lt;denchmark-link:https://user-images.githubusercontent.com/15848712/85411390-9472d000-b568-11ea-9e4e-130e6df4dec6.png&gt;&lt;/denchmark-link&gt;

&lt;denchmark-link:https://user-images.githubusercontent.com/15848712/85411831-27ac0580-b569-11ea-9337-c7b2bc10c04e.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='6' author='a-boinet' date='2020-06-23T13:58:38Z'>
		Looks great! Thanks for the update, I'm looking forward to testing this
		</comment>
		<comment id='7' author='a-boinet' date='2020-06-30T03:44:05Z'>
		
Hi @a-boinet sorry for the late update.
We're improving the vehicle collision meshes and now looks way better, with these changes this wheel problem should be fixed too!



I had this issue too. If in the new version lidar-captured cars look like real cars instead of boxes, that would be a big progress. Thank you for the update.
		</comment>
	</comments>
</bug>