<bug id='3212' author='SUNGWOOKYOO' open_date='2020-08-21T17:08:27Z' closed_time='2020-11-14T09:33:21Z'>
	<summary>how to destroy client</summary>
	<description>
I have to connect and disconnect client with carla server many times.
However, previous connection keep continuously, As a result the running process continuously increase.
my carla version is 0.9.9.4
If I used the below code, previous connection disappeared.
It ends properly in the following situations
&lt;denchmark-code&gt;host = '127.0.0.1'
port = 2000
carla_client = carla.Client(host=host, port=port)
del carla_client
carla_client = carla.Client(host=host, port=port)
del carla_client
&lt;/denchmark-code&gt;

Check the number of process
&lt;denchmark-code&gt;lsof -i TCP:2000
&lt;/denchmark-code&gt;

However, In the following situations, it does not finish properly.
&lt;denchmark-code&gt;host = '127.0.0.1'
port = 2000
carla_client = carla.Client(host=host, port=port)
carla_client.set_timeout(5)
carla_world = carla_client.get_world()

del carla_world
del carla_client

carla_client = carla.Client(host=host, port=port)
carla_client.set_timeout(5)
carla_world = carla_client.get_world()

del carla_world
del carla_client

&lt;/denchmark-code&gt;

If you check the process,
&lt;denchmark-code&gt;lsof -i TCP:2000
&lt;/denchmark-code&gt;

the process is accumulated as follows.
&lt;denchmark-code&gt;COMMAND     PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
CarlaUE4- 11347 usaywook   39u  IPv4 106243      0t0  TCP *:cisco-sccp (LISTEN)
CarlaUE4- 11347 usaywook   44u  IPv4 121001      0t0  TCP localhost:cisco-sccp-&gt;localhost:51010 (ESTABLISHED)
CarlaUE4- 11347 usaywook   46u  IPv4 112391      0t0  TCP localhost:cisco-sccp-&gt;localhost:51016 (ESTABLISHED)
python    11569 usaywook   20u  IPv4 106268      0t0  TCP localhost:51010-&gt;localhost:cisco-sccp (ESTABLISHED)
python    11569 usaywook   42u  IPv4 114065      0t0  TCP localhost:51016-&gt;localhost:cisco-sccp (ESTABLISHED)
&lt;/denchmark-code&gt;

How do we destroy the client and close client connection properly while maintaining server???
	</description>
	<comments>
		<comment id='1' author='SUNGWOOKYOO' date='2020-08-29T01:30:01Z'>
		&lt;denchmark-link:https://github.com/bernatx&gt;@bernatx&lt;/denchmark-link&gt;
 could you take a look?
		</comment>
		<comment id='2' author='SUNGWOOKYOO' date='2020-09-03T19:43:02Z'>
		I stumbled upon this issue, thinking this might be related to a problem that I'm having with the simulator hanging after starting a new episode. In my case I thought some "dangling" synchronous clients might be preventing the simulator from continuing. But I was not able to reproduce this behavior with your code snippets on master...
For me lssof -i TCP:2000 just gives the following output for the second snippet you have provided:
COMMAND  PID   USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME
CarlaUE4 561 baurst   50u  IPv4 ...      0t0  TCP *:cisco-sccp (LISTEN)
...which is fine I guess.
		</comment>
		<comment id='3' author='SUNGWOOKYOO' date='2020-09-04T07:47:39Z'>
		So despite being unable to reproduce this issue with the snippet you have provided, I was able to reproduce it using my own use case. I end up with dangling TCP connections. (lsof -i TCP:2000 says "CLOSE_WAIT" for my python client PID, while the same PID has one connection that is "ESTABLISHED").
My "dirty" workaround - using a seperate Process will kill all child TCP connections...
from multiprocessing import Process
import carla

def do_stuff(x):
    host = '127.0.0.1'
    port = 2000
    carla_client = carla.Client(host=host, port=port)
    carla_client.set_timeout(5)
    carla_world = carla_client.get_world()
    # etc

p = Process(target=do_stuff, args=(some_args,))
p.start()
p.join()
if p.is_alive():
    p.kill()
		</comment>
		<comment id='4' author='SUNGWOOKYOO' date='2020-11-05T02:30:24Z'>
		This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.
		</comment>
	</comments>
</bug>