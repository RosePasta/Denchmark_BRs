<bug id='2939' author='GabiShahmayster' open_date='2020-06-10T09:33:12Z' closed_time='2020-07-02T10:22:53Z'>
	<summary>IMUMeasurement gyroscope values in world-frame instead of body-frame</summary>
	<description>
Hello,
First of all, thank you very much for this great simulator, I've been using it extensively for the last few days and so far it's been a great experience.
I'm currently focused on retrieving IMU data and feeding it into a GNSS/INS fusion algorithm, so the first thing is to ensure that I'm passing valid IMU data to the INS.
I'm using pre-built binaries, of version 0.9.9.1, on Ubuntu 18.04.04 LTS.
I'm encountering an issue related to the gyroscopes measurements. They seem to be output in the world frame, instead of the vehicle body frame.
The accelerometers look ok.
This issue can be easily reproduced by driving a vehicle in a straight line (I'm using VehiclePIDController to drive the vehicle for a few tens of meters).
During the drive, the vehicle pitch fluctuates. This should be reflected in a corresponding Y axis rotation-rate, in the vehicle-frame. The vehicle experiences acceleration, which should be reflected mostly in X-axis acceleration, in the vehicle-frame.
We can now drive the vehicle, in a straight line, in two different orientations:

Vehicle is east-bound (UE world yaw = 0[deg]). IMU-frame should be aligned with UE-frame.
Vehicle is south-bound (UE world yaw = 90[deg]). IMU-frame X should be UE-frame Y, IMU-frame Y is UE-frame (-X).

In both scenarios, we would expect similar vehicle pitch profile and body-frame IMU measurements.
The actual results show a similar vehicle pitch profile and accurately reported body-frame IMU accelerometers values.
However it seems as though the gyroscopes report world-frame rotation-rates...
We can see the issue in the following figures:
East-bound scenario has similar world/imu accelerations/rotation-rates, as expected.
South-bound scenario has different world/imu accelerations, as expected BUT similar rotation-rates, which shouldn't be the case, because the vehicle is rotated w.r.t the world.
I've retrieved the world-frame accelerations and rotation-rates using Actor's get_acceleration and get_angular_velocity() methods.
p.s I'm sorry if this is too much information for a very simple issue to describe...
Thank you very much!
Gabi Shahmayster
&lt;denchmark-link:https://user-images.githubusercontent.com/66723225/84250470-c457b780-ab14-11ea-9ce0-a47f55909a01.png&gt;&lt;/denchmark-link&gt;

&lt;denchmark-link:https://user-images.githubusercontent.com/66723225/84250473-c588e480-ab14-11ea-9c2d-25624eebb3b0.png&gt;&lt;/denchmark-link&gt;

&lt;denchmark-link:https://user-images.githubusercontent.com/66723225/84250475-c588e480-ab14-11ea-8af1-db542d7640b7.png&gt;&lt;/denchmark-link&gt;

&lt;denchmark-link:https://user-images.githubusercontent.com/66723225/84250477-c6217b00-ab14-11ea-8d10-b7228a1f69d1.png&gt;&lt;/denchmark-link&gt;

&lt;denchmark-link:https://user-images.githubusercontent.com/66723225/84250480-c6217b00-ab14-11ea-9bcb-1cd210ce6e21.png&gt;&lt;/denchmark-link&gt;

&lt;denchmark-link:https://user-images.githubusercontent.com/66723225/84250482-c6ba1180-ab14-11ea-9de3-d8c6f773d44e.png&gt;&lt;/denchmark-link&gt;

	</description>
	<comments>
		<comment id='1' author='GabiShahmayster' date='2020-06-22T15:52:40Z'>
		Anyone from the Carla team? &lt;denchmark-link:https://github.com/ItsTimmy&gt;@ItsTimmy&lt;/denchmark-link&gt;
 could you please take a look?
Maybe I'm missing something fundamental regarding Carla or there's any non-standard IMU modelling going on...
		</comment>
		<comment id='2' author='GabiShahmayster' date='2020-06-23T12:51:24Z'>
		I'm not actually part of the Carla team, but I can still take a look. But I don't have a lot of free time, so I probably will not get to it soon.
So if anyone else comes across this issue, don't wait for me to fix it!
		</comment>
		<comment id='3' author='GabiShahmayster' date='2020-06-23T20:18:32Z'>
		
I'm not actually part of the Carla team, but I can still take a look. But I don't have a lot of free time, so I probably will not get to it soon.
So if anyone else comes across this issue, don't wait for me to fix it!

&lt;denchmark-link:https://github.com/ItsTimmy&gt;@ItsTimmy&lt;/denchmark-link&gt;
 Thank you very much. Unfortunately, I am not familiar with the official Carla team or the most effective ways of reporting such an issue... If you think that I should contact someone from the team, via Discord chat perhaps, or try to fix the issue and submit a PR, please tell me so...
		</comment>
		<comment id='4' author='GabiShahmayster' date='2020-06-25T22:05:55Z'>
		&lt;denchmark-link:https://github.com/marcgpuig&gt;@marcgpuig&lt;/denchmark-link&gt;
 and &lt;denchmark-link:https://github.com/DSantosO&gt;@DSantosO&lt;/denchmark-link&gt;
 could you take a look? I know it's a busy time... but this was supposed to be solved. It's not the first time we find similar problems.
		</comment>
		<comment id='5' author='GabiShahmayster' date='2020-06-26T12:42:46Z'>
		I have a fix in &lt;denchmark-link:https://github.com/carla-simulator/carla/pull/2998&gt;#2998&lt;/denchmark-link&gt;
 . Still needs some testing though.
		</comment>
		<comment id='6' author='GabiShahmayster' date='2020-06-26T15:42:28Z'>
		Thank you &lt;denchmark-link:https://github.com/GabiShahmayster&gt;@GabiShahmayster&lt;/denchmark-link&gt;
 for bringing the issue and also &lt;denchmark-link:https://github.com/ItsTimmy&gt;@ItsTimmy&lt;/denchmark-link&gt;
, thanks for the fix. When you have it ready, we will also test it and hopefully we can have it soon. Thanks again!!
		</comment>
	</comments>
</bug>