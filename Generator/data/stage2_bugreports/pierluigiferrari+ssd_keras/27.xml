<bug id='27' author='JeremyBYU' open_date='2017-12-08T20:02:35Z' closed_time='2017-12-10T16:17:41Z'>
	<summary>Bug in ssd_batch_generator module, parse_csv function</summary>
	<description>
Hey I think I found a bug in ssd_batch_geneartor.parse_csv.  The issue comes from an example file as so:
&lt;denchmark-code&gt;fname, xmin, xmax, ymin,ymax,class_id
a.jpg,1,2,3,4,1,
b.jpg,1,2,3,4,1,
c.jpg,1,2,3,4,1
&lt;/denchmark-code&gt;

The last c.jpg will not be added to filenames and labels.  It is skipped.
Notice that the last row is a new file (important because your logic looks at this condition).
The error appears &lt;denchmark-link:https://github.com/pierluigiferrari/ssd_keras/blob/master/ssd_batch_generator.py#L287&gt;here&lt;/denchmark-link&gt;
.
&lt;denchmark-code&gt;                else: # If this box belongs to a new image file
                    self.labels.append(np.stack(current_labels, axis=0)) # appending the PREVIOUS labels
                    self.filenames.append(os.path.join(self.images_path, current_file)) # appending the PREVIOUS filenames
                    current_labels = []
                    current_file = i[0] # This will never be added, we are on the last line/iteration of loop
                    current_labels.append(i[1:]) # This will never be added, we are on the last line/iteration of loop
&lt;/denchmark-code&gt;

Proposal to fix (which I'm using and worked okay:
&lt;denchmark-code&gt;                else: # If this box belongs to a new image file
                    self.labels.append(np.stack(current_labels, axis=0))
                    self.filenames.append(os.path.join(self.images_path, current_file))
                    current_labels = []
                    current_file = i[0]
                    current_labels.append(i[1:])
                    if idx == len(data)-1: # If this is the last line of the CSV file
                        self.labels.append(np.stack(current_labels, axis=0))
                        self.filenames.append(os.path.join(self.images_path, current_file))
&lt;/denchmark-code&gt;

Hope it helps!
	</description>
	<comments>
		<comment id='1' author='JeremyBYU' date='2017-12-10T16:05:30Z'>
		You're right, thank you for catching that, and thanks for the precise description.
It might be worthwhile mentioning that this bug only occurred if the last image of the dataset contains only one box.
Fixed now, and while I was at it I did a tiny bit of refactoring of parse_csv(), too. Two if-statements in there were unnecessary, and i is a terrible name for anything that is not an index.
		</comment>
		<comment id='2' author='JeremyBYU' date='2017-12-10T16:17:41Z'>
		Great! Closing because acknowledged and fixed.
		</comment>
	</comments>
</bug>