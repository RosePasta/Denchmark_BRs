<bug id='108' author='loic001' open_date='2018-03-20T08:51:30Z' closed_time='2020-02-26T16:07:52Z'>
	<summary>writer is never closed</summary>
	<description>
Hi,
&lt;denchmark-link:RecordWriter&gt;https://github.com/lanpa/tensorboard-pytorch/blob/master/tensorboardX/record_writer.py&lt;/denchmark-link&gt;

 is never closed
	</description>
	<comments>
		<comment id='1' author='loic001' date='2018-04-07T00:55:39Z'>
		&lt;denchmark-link:https://github.com/loic001&gt;@loic001&lt;/denchmark-link&gt;
 It is being flushed every time something is being written though:
&lt;denchmark-link:https://github.com/lanpa/tensorboard-pytorch/blob/8a296a17e35217f9f9632ca0fe2ab6e6c5ded02d/tensorboardX/record_writer.py#L31&gt;https://github.com/lanpa/tensorboard-pytorch/blob/8a296a17e35217f9f9632ca0fe2ab6e6c5ded02d/tensorboardX/record_writer.py#L31&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='loic001' date='2018-04-08T09:18:15Z'>
		Yes but...
&lt;denchmark-code&gt;from tensorboardX import SummaryWriter
for i in range(10000):
  writer = SummaryWriter()
  writer.close()
----
OSError: [Errno 24] Too many open files...
&lt;/denchmark-code&gt;

It depends on the limit of the maximum number of opened files on the linux system but there shouldn't be this error anyway. That's why I said you should close it when SummaryWriter is closed.
		</comment>
		<comment id='3' author='loic001' date='2018-04-09T09:55:05Z'>
		&lt;denchmark-link:https://github.com/loic001&gt;@loic001&lt;/denchmark-link&gt;
 Ah, you are indeed right. I've proposed a fix that should deal with this.
		</comment>
		<comment id='4' author='loic001' date='2018-04-28T09:55:37Z'>
		the test fails on mac.
		</comment>
		<comment id='5' author='loic001' date='2018-04-30T06:59:37Z'>
		&lt;denchmark-link:https://github.com/lanpa&gt;@lanpa&lt;/denchmark-link&gt;
 interesting. Does it fail with ? I sadly do not have a way of easily testing it so more information would be very helpful.
Thanks!
		</comment>
		<comment id='6' author='loic001' date='2018-04-30T07:29:41Z'>
		&lt;denchmark-link:https://github.com/mrshu&gt;@mrshu&lt;/denchmark-link&gt;
 It's . I also confirmed that it fails on ubuntu if we use:  (a bigger number). Should be other issue than this one.
		</comment>
		<comment id='7' author='loic001' date='2018-04-30T08:39:10Z'>
		&lt;denchmark-link:https://github.com/lanpa&gt;@lanpa&lt;/denchmark-link&gt;
 Thanks. Looking at this (&lt;denchmark-link:http://python.6.x6.nabble.com/maximum-number-of-threads-td1124579.html&gt;http://python.6.x6.nabble.com/maximum-number-of-threads-td1124579.html&lt;/denchmark-link&gt;
) it seems that the number is very much dependent on the memory address space of the box you run the test on. In other words, it is not related to the  but rather .
In other words, I'd say that the test is working, but using such a high number does not make too much sense. Using something like a 100 would probably be sufficient.
		</comment>
		<comment id='8' author='loic001' date='2018-05-09T11:43:11Z'>
		&lt;denchmark-link:https://github.com/lanpa&gt;@lanpa&lt;/denchmark-link&gt;

IMHO this should be fixed asap. . Opening 10 SummaryWriter creates close to 3k open files. Even after updating to tensorboardX==1.2.
def test_summary_writer_close():
    # Opening and closing SummaryWriter a lot should not run into
    # OSError: [Errno 24] Too many open files
    passed = True
    try:
        for i in range(10):
            writer = SummaryWriter()
            writer.file_writer.flush()
            writer.file_writer.close()
            writer._record_writer
            del writer
            gc.collect()
    except OSError:
        passed = False

    assert passed
test_summary_writer_close()
lsof | grep ' yourusername ' | awk '{print $NF}' | sort | wc -l
the .close() method has no effect.
		</comment>
		<comment id='9' author='loic001' date='2018-08-08T21:48:21Z'>
		I also find myself in a situation where I need to have many summary writers and hence run into
RuntimeError: can't start new thread even though I close the summary writers.
What about adding a flag terminate to the close method as a quick fix: When set to True the _EventLoggerThread gets killed.
Ideally close would kill the thread and reopen would create a new one.
		</comment>
		<comment id='10' author='loic001' date='2018-08-10T07:15:50Z'>
		Any updates on this?
		</comment>
		<comment id='11' author='loic001' date='2019-08-24T21:44:48Z'>
		An additional problem is that the  doesn't close the file at program exit and actually hangs. This can make some events not flush, if the flusher thread hasn't yet drained the queue when it hangs upon having its  method called. Proposing a fix in &lt;denchmark-link:https://github.com/lanpa/tensorboardX/pull/498&gt;#498&lt;/denchmark-link&gt;

		</comment>
		<comment id='12' author='loic001' date='2019-10-15T12:33:14Z'>
		Would love to have a fix for this issue ! Can we get &lt;denchmark-link:https://github.com/lanpa/tensorboardX/pull/498&gt;#498&lt;/denchmark-link&gt;
 accepted now that it passes tests ?
		</comment>
	</comments>
</bug>