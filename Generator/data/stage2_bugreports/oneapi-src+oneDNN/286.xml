<bug id='286' author='cdluminate' open_date='2018-07-23T11:11:38Z' closed_time='2018-08-09T00:19:19Z'>
	<summary>[0.15] Linear layer forward pass test failure</summary>
	<description>
&lt;denchmark-code&gt;[omitted thousands of similar lines]

/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.023707572370767593, which exceeds (data_t)1e-4, where
e evaluates to 0.023707572370767593,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2279 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.022045603021979332, which exceeds (data_t)1e-4, where
e evaluates to 0.022045603021979332,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2280 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.019951799884438515, which exceeds (data_t)1e-4, where
e evaluates to 0.019951799884438515,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2281 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.026514049619436264, which exceeds (data_t)1e-4, where
e evaluates to 0.026514049619436264,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2282 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.037213917821645737, which exceeds (data_t)1e-4, where
e evaluates to 0.037213917821645737,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2283 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.042022138833999634, which exceeds (data_t)1e-4, where
e evaluates to 0.042022138833999634,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2284 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.035237651318311691, which exceeds (data_t)1e-4, where
e evaluates to 0.035237651318311691,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2285 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.024854600429534912, which exceeds (data_t)1e-4, where
e evaluates to 0.024854600429534912,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2286 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.019924346357584, which exceeds (data_t)1e-4, where
e evaluates to 0.019924346357584,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2287 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.031862847506999969, which exceeds (data_t)1e-4, where
e evaluates to 0.031862847506999969,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2288 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.03866557776927948, which exceeds (data_t)1e-4, where
e evaluates to 0.03866557776927948,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2289 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.036993518471717834, which exceeds (data_t)1e-4, where
e evaluates to 0.036993518471717834,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2290 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.029014814645051956, which exceeds (data_t)1e-4, where
e evaluates to 0.029014814645051956,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2291 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.022624928504228592, which exceeds (data_t)1e-4, where
e evaluates to 0.022624928504228592,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2292 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.022495003417134285, which exceeds (data_t)1e-4, where
e evaluates to 0.022495003417134285,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2293 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.032777775079011917, which exceeds (data_t)1e-4, where
e evaluates to 0.032777775079011917,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2294 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.040749654173851013, which exceeds (data_t)1e-4, where
e evaluates to 0.040749654173851013,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2295 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.040420260280370712, which exceeds (data_t)1e-4, where
e evaluates to 0.040420260280370712,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2296 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.037572182714939117, which exceeds (data_t)1e-4, where
e evaluates to 0.037572182714939117,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2297 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.027566490694880486, which exceeds (data_t)1e-4, where
e evaluates to 0.027566490694880486,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2298 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.020948128774762154, which exceeds (data_t)1e-4, where
e evaluates to 0.020948128774762154,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2299 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.022054107859730721, which exceeds (data_t)1e-4, where
e evaluates to 0.022054107859730721,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2300 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.030547486618161201, which exceeds (data_t)1e-4, where
e evaluates to 0.030547486618161201,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2301 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.040352270007133484, which exceeds (data_t)1e-4, where
e evaluates to 0.040352270007133484,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2302 Total: 2304
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.040073569864034653, which exceeds (data_t)1e-4, where
e evaluates to 0.040073569864034653,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2303 Total: 2304
[  FAILED  ] TestInnerProductForward/inner_product_test_float.TestsInnerProduct/5, where GetParam() = 60-byte object &lt;40-00 00-00 01-00 00-00 04-00 00-00 0D-00 00-00 03-00 00-00 04-00 00-00 04-00 00-00 02-00 00-00 20-00 00-00 80-04 00-00 01-00 00-00 01-00 00-00 01-00 00-00 00-00 00-00 00-00 00-00&gt; (256 ms)
[ RUN      ] TestInnerProductForward/inner_product_test_float.TestsInnerProduct/6
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.29718458652496338, which exceeds (data_t)1e-4, where
e evaluates to 0.29718458652496338,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 0 Total: 8
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.38432812690734863, which exceeds (data_t)1e-4, where
e evaluates to 0.38432812690734863,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 1 Total: 8
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.46955221891403198, which exceeds (data_t)1e-4, where
e evaluates to 0.46955221891403198,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 2 Total: 8
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.32094648480415344, which exceeds (data_t)1e-4, where
e evaluates to 0.32094648480415344,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 3 Total: 8
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.25084465742111206, which exceeds (data_t)1e-4, where
e evaluates to 0.25084465742111206,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 4 Total: 8
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.260670006275177, which exceeds (data_t)1e-4, where
e evaluates to 0.260670006275177,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 5 Total: 8
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.36998206377029419, which exceeds (data_t)1e-4, where
e evaluates to 0.36998206377029419,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 6 Total: 8
/home/lumin/packages/mkldnn.pkg/mkl-dnn.orig/tests/gtests/mkldnn_test_common.hpp:352: Failure
The difference between e and (data_t)0.0 is 0.35173898935317993, which exceeds (data_t)1e-4, where
e evaluates to 0.35173898935317993,
(data_t)0.0 evaluates to 0, and
(data_t)1e-4 evaluates to 9.9999997473787516e-05.
Index: 7 Total: 8
[  FAILED  ] TestInnerProductForward/inner_product_test_float.TestsInnerProduct/6, where GetParam() = 60-byte object &lt;40-00 00-00 01-00 00-00 04-00 00-00 0D-00 00-00 03-00 00-00 04-00 00-00 04-00 00-00 02-00 00-00 02-00 00-00 04-00 00-00 01-00 00-00 01-00 00-00 01-00 00-00 00-00 00-00 00-00 00-00&gt; (1 ms)
[----------] 7 tests from TestInnerProductForward/inner_product_test_float (476 ms total)

[----------] Global test environment tear-down
[==========] 20 tests from 5 test cases ran. (1271 ms total)
[  PASSED  ] 13 tests.
[  FAILED  ] 7 tests, listed below:
[  FAILED  ] TestInnerProductForward/inner_product_test_float.TestsInnerProduct/0, where GetParam() = 60-byte object &lt;40-00 00-00 01-00 00-00 01-00 00-00 01-00 00-00 01-00 00-00 01-00 00-00 04-00 00-00 02-00 00-00 20-00 00-00 30-00 00-00 01-00 00-00 06-00 00-00 06-00 00-00 00-00 00-00 00-00 00-00&gt;
[  FAILED  ] TestInnerProductForward/inner_product_test_float.TestsInnerProduct/1, where GetParam() = 60-byte object &lt;40-00 00-00 01-00 00-00 01-00 00-00 01-00 00-00 01-00 00-00 01-00 00-00 04-00 00-00 02-00 00-00 00-02 00-00 30-00 00-00 01-00 00-00 02-00 00-00 02-00 00-00 00-00 00-00 00-00 00-00&gt;
[  FAILED  ] TestInnerProductForward/inner_product_test_float.TestsInnerProduct/2, where GetParam() = 60-byte object &lt;40-00 00-00 01-00 00-00 05-00 00-00 0F-00 00-00 03-00 00-00 04-00 00-00 04-00 00-00 02-00 00-00 20-00 00-00 30-00 00-00 01-00 00-00 06-00 00-00 06-00 00-00 00-00 00-00 00-00 00-00&gt;
[  FAILED  ] TestInnerProductForward/inner_product_test_float.TestsInnerProduct/3, where GetParam() = 60-byte object &lt;40-00 00-00 01-00 00-00 08-00 00-00 08-00 00-00 03-00 00-00 04-00 00-00 04-00 00-00 02-00 00-00 20-00 00-00 30-00 00-00 01-00 00-00 06-00 00-00 06-00 00-00 00-00 00-00 00-00 00-00&gt;
[  FAILED  ] TestInnerProductForward/inner_product_test_float.TestsInnerProduct/4, where GetParam() = 60-byte object &lt;40-00 00-00 01-00 00-00 09-00 00-00 09-00 00-00 03-00 00-00 04-00 00-00 04-00 00-00 02-00 00-00 20-00 00-00 30-00 00-00 01-00 00-00 06-00 00-00 06-00 00-00 00-00 00-00 00-00 00-00&gt;
[  FAILED  ] TestInnerProductForward/inner_product_test_float.TestsInnerProduct/5, where GetParam() = 60-byte object &lt;40-00 00-00 01-00 00-00 04-00 00-00 0D-00 00-00 03-00 00-00 04-00 00-00 04-00 00-00 02-00 00-00 20-00 00-00 80-04 00-00 01-00 00-00 01-00 00-00 01-00 00-00 00-00 00-00 00-00 00-00&gt;
[  FAILED  ] TestInnerProductForward/inner_product_test_float.TestsInnerProduct/6, where GetParam() = 60-byte object &lt;40-00 00-00 01-00 00-00 04-00 00-00 0D-00 00-00 03-00 00-00 04-00 00-00 04-00 00-00 02-00 00-00 02-00 00-00 04-00 00-00 01-00 00-00 01-00 00-00 01-00 00-00 00-00 00-00 00-00 00-00&gt;

 7 FAILED TESTS

&lt;/denchmark-code&gt;

&lt;denchmark-h:h3&gt;Environment&lt;/denchmark-h&gt;

Intel MKL-DNN includes hardware-specific optimizations and may behave
differently on depending on the compiler and build environment. Include
the following information to help reproduce the issue:

CPU make and model (try lscpu; if your lscpu does not list CPU flags,
try running cat /proc/cpuinfo | grep flags | sort -u)

7440HQ

OS version (uname -a)

Debian unstable

Compiler version (gcc --version)

gcc (Debian 8.1.0-9) 8.1.0

MKLROOT value (echo MKLROOT=$MKLROOT)

none

git hash (git log -1 --format=%H)

&lt;denchmark-link:https://github.com/oneapi-src/oneDNN/commit/a46b870cce30fdef186be4105ab1566fa902c499&gt;a46b870&lt;/denchmark-link&gt;
 + batch_norm patch.
the command line is
&lt;denchmark-code&gt; OMP_NUM_THREADS=1 ./test_inner_product_forward
&lt;/denchmark-code&gt;

	</description>
	<comments>
		<comment id='1' author='cdluminate' date='2018-07-23T12:12:29Z'>
		Note that, this is found by using 1 thread. So it's not caused by race condition between threads.
		</comment>
		<comment id='2' author='cdluminate' date='2018-07-25T21:39:31Z'>
		Reproduced on a different configuration. So I'm labeling this as a bug.
		</comment>
		<comment id='3' author='cdluminate' date='2018-08-09T00:19:19Z'>
		The issue does not reproduce with the latest update.
		</comment>
		<comment id='4' author='cdluminate' date='2018-08-09T09:35:26Z'>
		Confirm that I cannot repro this bug with the fix.
		</comment>
	</comments>
</bug>