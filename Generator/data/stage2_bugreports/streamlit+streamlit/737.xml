<bug id='737' author='AmitMY' open_date='2019-11-22T19:18:17Z' closed_time='2019-11-27T18:47:35Z'>
	<summary>Serving doesn't work when routing under directory</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

When using .htaccess to route streamlit via a subdirectory, it doesn't work.
&lt;denchmark-link:https://user-images.githubusercontent.com/5757359/69453376-7479f480-0d6c-11ea-8d56-c393426dc143.png&gt;&lt;/denchmark-link&gt;


WebSocket connection to 'ws://MY-SERVER/viewer/stream' failed: Error during WebSocket handshake: Unexpected response code: 400


main.0d1d19c2.chunk.js:1 Uncaught Error: Unsupported state transition.
State: PINGING_SERVER
Event: CONNECTION_TIMED_OUT

&lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;


Run a streamlit instance on a server
Rather than using ssh tunneling, like ssh -N -f -L localhost:8501:localhost:8501 server, open .htaccess and write:

&lt;denchmark-code&gt;RewriteEngine on
RewriteBase /

RewriteRule ^viewer/(.*)$ http://localhost:8501/$1 [P]
&lt;/denchmark-code&gt;

Go to your server's public domain (or IP adress) /viewer
&lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;

Should work. When using tunneling it works fine.
&lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;

Errors
&lt;denchmark-h:h2&gt;Is this a regression?&lt;/denchmark-h&gt;

That is, did this use to work the way you expected in the past?
yes / no
&lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;


Streamlit version:  0.50.2
Python version: 3.8.0
Using Conda
Browser version: Chrome 78.0.3904.108

	</description>
	<comments>
		<comment id='1' author='AmitMY' date='2019-11-27T18:43:12Z'>
		Hey &lt;denchmark-link:https://github.com/AmitMY&gt;@AmitMY&lt;/denchmark-link&gt;
 - I don't have experience with Apache, so take this with a grain of salt, but this looks like Apache is not proxying to Streamlit's WebSocket connection.
You may need to change your configuration to explicitly handle WebSockets. Streamlit's WebSocket data is served over the /stream endpoint.
Here's a Stack Overflow post that might help: &lt;denchmark-link:https://stackoverflow.com/questions/27526281/websockets-and-apache-proxy-how-to-configure-mod-proxy-wstunnel&gt;https://stackoverflow.com/questions/27526281/websockets-and-apache-proxy-how-to-configure-mod-proxy-wstunnel&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='AmitMY' date='2019-11-27T18:47:35Z'>
		Closing for now since this doesn't look like a Streamlit bug. Feel free to reopen if you have reason to believe this is not right!
		</comment>
	</comments>
</bug>