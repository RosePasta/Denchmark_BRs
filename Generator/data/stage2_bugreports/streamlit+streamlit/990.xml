<bug id='990' author='julianmukaj' open_date='2020-01-17T14:55:59Z' closed_time='2020-05-26T16:17:15Z'>
	<summary>No such file found 'credentials.toml' on 'streamlit hello'</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

Type here a clear and concise description of the bug. Aim for 2-3 sentences.
&lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;

What are the steps we should take to reproduce the bug:
Run 'streamlit hello' after installing via pip
Enter blank on the email step (same behaviour if you enter one)
&lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;

Streamlit hello world applications run on localhost..
&lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;

Get this error when I try to run it:
[Errno 2] No such file or directory: 'O:\.streamlit\credentials.toml'
&lt;denchmark-h:h2&gt;Is this a regression?&lt;/denchmark-h&gt;

Has worked for other team members on laptops
&lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;


Streamlit version: latest and 0.49.0
Python version: 3.7
Using Conda? PipEnv? PyEnv? Pex? Tried Conda and PyEnv
OS version: Windows
Browser version:

&lt;denchmark-h:h1&gt;Additional information&lt;/denchmark-h&gt;

I am using a VM if that matters. This happens if I try to run a sample streamlit app also. I do not have an 'O:' drive mounted so not sure why its looking for credentials.toml file there.
	</description>
	<comments>
		<comment id='1' author='julianmukaj' date='2020-01-21T22:26:52Z'>
		Hi &lt;denchmark-link:https://github.com/julianmukaj&gt;@julianmukaj&lt;/denchmark-link&gt;
 ,
The "O" drive is commonly used to mount network drives (e.g. on a VPN or a local university network).  Is it possible your laptop had an "O:" drive when you installed conda and/or your streamlit environment within conda?
I'm wondering if reinstalling your streamlit environment and/or your Conda installation (making sure you don't have any network drives showing up when you do) would resolve the issue.
		</comment>
		<comment id='2' author='julianmukaj' date='2020-01-21T22:42:03Z'>
		I am working on a VM (Azure VM) so cannot see any Network drives directly, I have tried re-installing Streamlit and trying an earlier version too (0.49), but still same issue.
If I had to guess, issue is by using os.getcwd(), line 116 on file_util.py, just going to assume Azure runs the processes on a hidden network drive, something like os.path.abspath(os.path.dirname(file)) might be more appropriate?
		</comment>
		<comment id='3' author='julianmukaj' date='2020-01-21T23:16:12Z'>
		
If I had to guess, issue is by using os.getcwd(), line 116 on file_util.py, just going to assume Azure runs the processes on a hidden network drive, something like os.path.abspath(os.path.dirname(file)) might be more appropriate?

Ohh, that's interesting.  You might be on to something there.
Would you do us a favor and pop into your conda environment, run the python interpreter, and paste the output of os.getcwd()?
And if possible, could you plant that line in a file that could be run by Azure the way it would run your streamlit app and get that output?
		</comment>
		<comment id='4' author='julianmukaj' date='2020-01-21T23:50:29Z'>
		Okay done some more debugging, the actual issue is file_util.py, line 104: home = os.path.expanduser("~")
Using os.path.expanduser on the VM resolves to O:/ drive.
os.getcwd() returned the expected directory when I tested.
Error is caused because my environment variables for HOME and HOMEDRIVE result in O:/, whereas the environment variable USERPROFILE resolves to my correct windows home.
I believe the HOME and HOMEDRIVE and forced by the Azure VM as I just tried to change them and it didn't work.
		</comment>
		<comment id='5' author='julianmukaj' date='2020-01-22T00:35:22Z'>
		
Using os.path.expanduser on the VM resolves to O:/ drive.

Oh, gosh.  That's a nasty problem.  Thanks for sticking with this to help us understand it.
I don't know enough about Azure to know what's going on -- is O:/ a complete nonsense drive in this case, or is it a dynamic virtual drive that's being spun up in response to activity?  (I.e. does it ever exist?)
Regardless, it sounds like the solution probably involves changing those environment variables.
I'm tempted to also think about a try-except around the os.path.expanduser line to accommodate situations like yours, but I'd like to explore other options first.
		</comment>
		<comment id='6' author='julianmukaj' date='2020-01-22T11:28:29Z'>
		So the problem isn't specific to Azure at all because I tried other Az VMs and they resolve the $HOME correctly. Is isolated to my VM at the moment, was probably configured wrong when created..
From googling, it is also a known issue with Windows Remote Desktop Service, where home directory ends up as a network drive the admin set up but the user doesn't have access to or was removed at some point (probably same in this case).
&lt;denchmark-h:hr&gt;&lt;/denchmark-h&gt;

I would suggest using the $USERPROFILE environment variable only, see: &lt;denchmark-link:https://bugs.python.org/issue36264&gt;https://bugs.python.org/issue36264&lt;/denchmark-link&gt;
 and &lt;denchmark-link:https://docs.python.org/3.8/library/os.path.html&gt;https://docs.python.org/3.8/library/os.path.html&lt;/denchmark-link&gt;
 for Py3.8 they have decided to not use $HOME on windows anymore and use $USERPROFILE.
So this would not be an issue for people running on 3.8
I assume others who have had a corporate windows machine set up with no rights to change those variables could also see this issue also those Python versions under 3.8
		</comment>
		<comment id='7' author='julianmukaj' date='2020-01-28T16:55:25Z'>
		I have the same issue (well, pointing at H:\.streamlit\credentials.toml in my case)
Additional info:

it is happening also locally (no VM) in my conda environment
a previously working app is not running (no change on the source), this is seems to be a regression
the same app works perfectly from the windows linux subsystem
I tried downgrading to 0.52.2 with no results
Per-project configurations are also not effective: I get the same error message independently from what I try to launch (hello or my apps) and where

EDIT: somehow after a conda upgrade --all all is working fie now
		</comment>
		<comment id='8' author='julianmukaj' date='2020-05-13T21:11:38Z'>
		OK, so, this bug is so hard to reproduce that I cannot recommend we pursue changing anything here.  Situations in which the bug was not seen include:
Test Scenario 1
Azure VM, OS windows, python 3.8
Test Scenario 2
Azure VM, OS windows, python 3.7, conda
Test Scenario 3
local machine, windows OS, python 3.8, attached a network drive as O:\ -- placed a python script and ran streamlit run &lt;script&gt;.py
Test Scenario 4
local machine, windows OS, python 3.7, conda, attached a network drive as O:\ placed a python script and ran streamlit run &lt;script&gt;.py
Ran os.getcwd() and os.path.expanduser('~') in all the scenarios -- cannot reproduce.
I have to conclude that this bug can only be seen when Windows is set up in a particular way (as &lt;denchmark-link:https://github.com/julianmukaj&gt;@julianmukaj&lt;/denchmark-link&gt;
 alluded).
I am marking this one Unreproducible, also due to the relative age of this bug.
We should open a new ticket if something similar is seen.
		</comment>
		<comment id='9' author='julianmukaj' date='2020-05-26T16:17:15Z'>
		IMHO there's no easy fix -- since I don't see this bug in action (even in Python 3.7 and even when I've mapped network drives as the home dir), i don't feel confident that changing how we assess how we map .streamlit is going to result in positive consequences, and we may cause harm in the process.
		</comment>
	</comments>
</bug>