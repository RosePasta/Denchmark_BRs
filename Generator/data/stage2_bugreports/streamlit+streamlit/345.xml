<bug id='345' author='monchier' open_date='2019-10-09T18:47:20Z' closed_time='2020-03-04T01:42:53Z'>
	<summary>streamlit hello raises exception</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

Type here a clear and concise description of the bug. Aim for 2-3 sentences.
&lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;docker run -it -p 8501:8501 ubuntu:19.04 bash
&lt;/denchmark-code&gt;

Then in the container, run:
&lt;denchmark-code&gt;apt-get update
apt-get install python python-pip build-essential
pip install streamlit
streamlit hello
&lt;/denchmark-code&gt;

then pick the 2nd demo
&lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;

No exception raised
&lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;

Exception raised
&lt;denchmark-h:h2&gt;Is this a regression?&lt;/denchmark-h&gt;

not sure
&lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;


Streamlit version: (get it with $ streamlit version)
Python version: python2.7
Using Conda? no
OS version: Ubuntu Linux
Browser version:

&lt;denchmark-h:h1&gt;Additional information&lt;/denchmark-h&gt;

If needed, add any other context about the problem here.
	</description>
	<comments>
		<comment id='1' author='monchier' date='2019-10-09T18:47:41Z'>
		&lt;denchmark-code&gt;ImportError: cannot import name ConverterMapping
File "/usr/local/lib/python2.7/dist-packages/streamlit/ScriptRunner.py", line 306, in _run_script exec(code, module.__dict__)
File "/usr/local/lib/python2.7/dist-packages/streamlit/hello.py", line 334, in &lt;module&gt; run()
File "/usr/local/lib/python2.7/dist-packages/streamlit/hello.py", line 308, in run demo()
File "/usr/local/lib/python2.7/dist-packages/streamlit/hello.py", line 202, in plotting_demo chart = st.line_chart(last_rows)
File "/usr/local/lib/python2.7/dist-packages/streamlit/__init__.py", line 126, in wrapped_method return method(dg, *args, **kwargs)
File "/usr/local/lib/python2.7/dist-packages/streamlit/DeltaGenerator.py", line 122, in wrapped_method marshall_element, delta_type, last_index)
File "/usr/local/lib/python2.7/dist-packages/streamlit/DeltaGenerator.py", line 317, in _enqueue_new_element_delta rv = marshall_element(msg.delta.new_element)
File "/usr/local/lib/python2.7/dist-packages/streamlit/DeltaGenerator.py", line 119, in marshall_element return method(dg, element, *args, **kwargs)
File "/usr/local/lib/python2.7/dist-packages/streamlit/DeltaGenerator.py", line 822, in line_chart import streamlit.elements.altair as altair
File "/usr/local/lib/python2.7/dist-packages/streamlit/elements/altair.py", line 24, in &lt;module&gt; import altair as alt
File "/usr/local/lib/python2.7/dist-packages/altair/__init__.py", line 4, in &lt;module&gt; from .vegalite import *
File "/usr/local/lib/python2.7/dist-packages/altair/vegalite/__init__.py", line 2, in &lt;module&gt; from .v3 import *
File "/usr/local/lib/python2.7/dist-packages/altair/vegalite/v3/__init__.py", line 2, in &lt;module&gt; from .schema import *
File "/usr/local/lib/python2.7/dist-packages/altair/vegalite/v3/schema/__init__.py", line 2, in &lt;module&gt; from .core import *
File "/usr/local/lib/python2.7/dist-packages/altair/vegalite/v3/schema/core.py", line 6, in &lt;module&gt; from altair.utils.schemapi import SchemaBase, Undefined
File "/usr/local/lib/python2.7/dist-packages/altair/utils/__init__.py", line 14, in &lt;module&gt; from .plugin_registry import PluginRegistry
File "/usr/local/lib/python2.7/dist-packages/altair/utils/plugin_registry.py", line 3, in &lt;module&gt; import entrypoints
File "/usr/lib/python2.7/dist-packages/entrypoints.py", line 16, in &lt;module&gt; import configparser
File "/usr/local/lib/python2.7/dist-packages/configparser.py", line 11, in &lt;module&gt; from backports.configparser import (
&lt;/denchmark-code&gt;

		</comment>
		<comment id='2' author='monchier' date='2019-10-15T21:43:03Z'>
		Complete stack trace:
&lt;denchmark-code&gt;ImportError: cannot import name ConverterMapping
File "/usr/local/lib/python2.7/dist-packages/streamlit/ScriptRunner.py", line 310, in _run_script exec(code, module.__dict__)
File "/usr/local/lib/python2.7/dist-packages/streamlit/hello/hello.py", line 110, in &lt;module&gt; run()
File "/usr/local/lib/python2.7/dist-packages/streamlit/hello/hello.py", line 101, in run demo()
File "/usr/local/lib/python2.7/dist-packages/streamlit/hello/demos.py", line 183, in plotting_demo chart = st.line_chart(last_rows)
File "/usr/local/lib/python2.7/dist-packages/streamlit/__init__.py", line 126, in wrapped_method return method(dg, *args, **kwargs)
File "/usr/local/lib/python2.7/dist-packages/streamlit/DeltaGenerator.py", line 121, in wrapped_method return dg._enqueue_new_element_delta(marshall_element, delta_type, last_index)
File "/usr/local/lib/python2.7/dist-packages/streamlit/DeltaGenerator.py", line 316, in _enqueue_new_element_delta rv = marshall_element(msg.delta.new_element)
File "/usr/local/lib/python2.7/dist-packages/streamlit/DeltaGenerator.py", line 119, in marshall_element return method(dg, element, *args, **kwargs)
File "/usr/local/lib/python2.7/dist-packages/streamlit/DeltaGenerator.py", line 821, in line_chart import streamlit.elements.altair as altair
File "/usr/local/lib/python2.7/dist-packages/streamlit/elements/altair.py", line 24, in &lt;module&gt; import altair as alt
File "/usr/local/lib/python2.7/dist-packages/altair/__init__.py", line 4, in &lt;module&gt; from .vegalite import *
File "/usr/local/lib/python2.7/dist-packages/altair/vegalite/__init__.py", line 2, in &lt;module&gt; from .v3 import *
File "/usr/local/lib/python2.7/dist-packages/altair/vegalite/v3/__init__.py", line 2, in &lt;module&gt; from .schema import *
File "/usr/local/lib/python2.7/dist-packages/altair/vegalite/v3/schema/__init__.py", line 2, in &lt;module&gt; from .core import *
File "/usr/local/lib/python2.7/dist-packages/altair/vegalite/v3/schema/core.py", line 6, in &lt;module&gt; from altair.utils.schemapi import SchemaBase, Undefined
File "/usr/local/lib/python2.7/dist-packages/altair/utils/__init__.py", line 14, in &lt;module&gt; from .plugin_registry import PluginRegistry
File "/usr/local/lib/python2.7/dist-packages/altair/utils/plugin_registry.py", line 3, in &lt;module&gt; import entrypoints
File "/usr/lib/python2.7/dist-packages/entrypoints.py", line 16, in &lt;module&gt; import configparser
File "/usr/local/lib/python2.7/dist-packages/configparser.py", line 11, in &lt;module&gt; from backports.configparser import (
&lt;/denchmark-code&gt;

		</comment>
		<comment id='3' author='monchier' date='2019-10-15T21:46:41Z'>
		This seems to be an altair problem. This snippet raises the same exception:
&lt;denchmark-code&gt;import altair as alt
import pandas as pd

source = pd.DataFrame({
    'a': ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'],
    'b': [28, 55, 43, 91, 81, 53, 19, 87, 52]
})

alt.Chart(source).mark_bar().encode(
    x='a',
    y='b'
)
&lt;/denchmark-code&gt;

Do: python test.py in the container
		</comment>
		<comment id='4' author='monchier' date='2019-10-16T00:55:01Z'>
		Should we file an altair bug?
		</comment>
		<comment id='5' author='monchier' date='2019-10-16T17:31:02Z'>
		This only happens in Python 2, right?
		</comment>
		<comment id='6' author='monchier' date='2019-10-16T17:31:54Z'>
		Altair is tested against Python 2: &lt;denchmark-link:https://github.com/altair-viz/altair/blob/master/.travis.yml&gt;https://github.com/altair-viz/altair/blob/master/.travis.yml&lt;/denchmark-link&gt;
.
		</comment>
		<comment id='7' author='monchier' date='2019-10-16T17:39:38Z'>
		Yeah, it shows up with the specific ubuntu-19.04 and above steps. It won't show up for example, with python:2.7-slim. Not sure which version of Linux altair tests use.
		</comment>
		<comment id='8' author='monchier' date='2019-10-17T04:47:52Z'>
		Filed: &lt;denchmark-link:https://github.com/altair-viz/altair/issues/1733&gt;altair-viz/altair#1733&lt;/denchmark-link&gt;

		</comment>
		<comment id='9' author='monchier' date='2019-10-17T14:59:15Z'>
		This appears to be an issue with the entrypoints package – I've closed the Altair issue. Reproduce by doing pip install entrypoints and then import entrypoints
		</comment>
		<comment id='10' author='monchier' date='2019-10-17T21:26:41Z'>
		It seems there is an issue with configparser that is installed by apt-get. This only happen for Python 2.7.
A possible workaround is to remove configparser via apt-get before pip install streamlit:
&lt;denchmark-code&gt;apt-get update
apt-get install python python-pip 
apt-get remove python-configparser
pip install streamlit
streamlit hello
&lt;/denchmark-code&gt;

This will take care of the bug.
Another solution is to use a different python image. For example for Python-2.7: python:2.7-slim does not have this problem, likely because python is preinstalled and the apt-get does not conflict with pip.
&lt;denchmark-link:https://github.com/jakevdp&gt;@jakevdp&lt;/denchmark-link&gt;
 this will probably work for  as well.
&lt;denchmark-h:hr&gt;&lt;/denchmark-h&gt;

At this point, we're at a loss how to automatically fix this for users. But it seems very localized to the specific Docker image, and specifically on Python 2.x — and we have the work-around above. So we'll stop work on this at the moment.
If anyone has a solution, please let us know. We'll be happy to merge it in!
		</comment>
		<comment id='11' author='monchier' date='2019-10-18T20:49:26Z'>
		Reopening to make this easier for users to find.
		</comment>
		<comment id='12' author='monchier' date='2020-03-03T22:57:01Z'>
		This is a Python2 only bug. I think we should close it.
		</comment>
	</comments>
</bug>