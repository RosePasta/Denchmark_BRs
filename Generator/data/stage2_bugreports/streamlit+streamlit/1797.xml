<bug id='1797' author='nthmost' open_date='2020-07-31T22:11:58Z' closed_time='2020-09-04T18:18:24Z'>
	<summary>Streamlit doesn't notice code changes in cached functions in CWD</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

When running a script that uses Streamlit's caching from the current working directory, hashes of Python functions don't respond to code changes. What happens is that _get_main_script_directory() returns '.'. filepath is always an absolute path, so the subdirectory check file_util.file_is_in_folder_glob() always fails. This causes the hashing code to silently fall back on the codepath for library functions, which only considers their name and module. As a result, user functions hashed in this situation always have the same hash value, regardless of their content.
&lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;

Start with this script in eg. fn_hashing_test.py:
&lt;denchmark-code&gt;#!/usr/bin/env python

import hashlib, streamlit

def fn():
    pass

func_hasher = hashlib.md5()
streamlit.hashing.update_hash(
    fn,
    hasher=func_hasher,
    hash_reason=streamlit.hashing.HashReason.CACHING_FUNC_BODY,
    hash_source=fn,
)
print(func_hasher.hexdigest())
&lt;/denchmark-code&gt;

Run it like
&lt;denchmark-code&gt;$ ./fn_hashing_test.py
147a4f7a8619dcccbb4e040b8dfb4ec2
$ md5 fn_hashing_test.py
MD5 (fn_hashing_test.py) = b9e87b45ef13eb5593babce9c4dcddef
Then change the function body so that its hash value should change:

#!/usr/bin/env python

import hashlib, streamlit

def fn():
    print('a')

func_hasher = hashlib.md5()
streamlit.hashing.update_hash(
    fn,
    hasher=func_hasher,
    hash_reason=streamlit.hashing.HashReason.CACHING_FUNC_BODY,
    hash_source=fn,
)
print(func_hasher.hexdigest())
&lt;/denchmark-code&gt;

But it doesn't:
&lt;denchmark-code&gt;$ ./fn_hashing_test.py
147a4f7a8619dcccbb4e040b8dfb4ec2
$ md5 fn_hashing_test.py
MD5 (fn_hashing_test.py) = 4849ddefb37b6d8bbf310797ca64d009
&lt;/denchmark-code&gt;

&lt;denchmark-h:h1&gt;Additional information&lt;/denchmark-h&gt;

Point of record:  &lt;denchmark-link:https://github.com/streamlit/streamlit/pull/1793&gt;#1793&lt;/denchmark-link&gt;

	</description>
	<comments>
		<comment id='1' author='nthmost' date='2020-09-04T18:18:24Z'>
		Closing this as it references a very niche use case.  Can reopen if there is more user interest.
		</comment>
	</comments>
</bug>