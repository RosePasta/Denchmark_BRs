<bug id='592' author='matthiasgoergens' open_date='2019-11-01T07:26:33Z' closed_time='2020-02-18T21:58:31Z'>
	<summary>`make build-circleci` fails: e2e/Dockerfile is broken</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

Circleci doesn't run make build-circleci nor build e2e/Dockerfile, thus they have bitrotten and ceased to be useful.
&lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;

make build-circleci on a fresh clone of the repo.
&lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;

Command given above succeeds.
&lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;

Command fails with
&lt;denchmark-code&gt;[... snip ...]
Step 23/30 : RUN make react-init
 ---&gt; Running in 9b5491d8ea87
cd frontend/ ; yarn install --frozen-lockfile
/bin/bash: yarn: command not found
make: *** [react-init] Error 127
Makefile:241: recipe for target 'react-init' failed
The command '/bin/bash -c make react-init' returned a non-zero code: 2
gmake: *** [Makefile:354: build-circleci] Error 2
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Is this a regression?&lt;/denchmark-h&gt;

I suspect this used to work in the past.
&lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;


Streamlit version: current develop
Python version: current develop, 3.7.4
OS version: I'm starting docker from MacOS 10.15.1, but what's broken is the Dockerfile and that specifies circleci/python:3.7.4-stretch
Browser version: N/A

&lt;denchmark-h:h1&gt;Additional information&lt;/denchmark-h&gt;

I'm working on a fix, PR incoming.
	</description>
	<comments>
		<comment id='1' author='matthiasgoergens' date='2019-11-01T10:04:50Z'>
		&lt;denchmark-link:https://github.com/streamlit/streamlit/pull/593&gt;#593&lt;/denchmark-link&gt;
 has a dockerfile that works, exercises most of the dev functionality and builds a release.  I'm mostly thinking about how to integrate it with circleci config to make sure we don't lose that capability again.
		</comment>
		<comment id='2' author='matthiasgoergens' date='2019-11-01T12:03:11Z'>
		Hi Matthias,
e2e/Dockerfile is not used by CircleCI. It's used by developers to run our e2e tests locally in a linux environment that matches our CircleCI environment. In particular we use it to generate our Cypress snapshots since there are differences in the snapshots when running on a linux vs mac, or on different linux distros.
The image is built with make build-circleci and the container launched with make run-circleci.
You'll see we use docker-compose to mount local volumes so we can make changes to our code and easily re-run the tests without re-building the image. Certain things are expected to be built on the host instead of in the container, for ex the protos, which is why we don't run make protobuf in the container.
If make build-circleci and make run-circleci aren't working for you, please re-open.
		</comment>
		<comment id='3' author='matthiasgoergens' date='2019-11-06T06:51:58Z'>
		Hi Jonathan,
make build-circleci just runs docker build -t streamlit_circleci -f e2e/Dockerfile . which is essentially the same as docker build -f e2e/Dockerfile -t streamlit-e2e-test-image ..  So it fails with exactly the same problems.
I updated the issue to reflect that make build-circleci is also broken.
		</comment>
		<comment id='4' author='matthiasgoergens' date='2019-11-06T06:52:23Z'>
		&lt;denchmark-link:https://github.com/jrhone&gt;@jrhone&lt;/denchmark-link&gt;
 I'd love to re-open, but it's disabled.
		</comment>
		<comment id='5' author='matthiasgoergens' date='2019-11-06T15:00:03Z'>
		&lt;denchmark-link:https://github.com/jrhone&gt;@jrhone&lt;/denchmark-link&gt;
 Thanks!
		</comment>
		<comment id='6' author='matthiasgoergens' date='2019-11-07T01:28:05Z'>
		&lt;denchmark-link:https://github.com/matthiasgoergens&gt;@matthiasgoergens&lt;/denchmark-link&gt;
 fix on the way via &lt;denchmark-link:https://github.com/streamlit/streamlit/pull/639&gt;#639&lt;/denchmark-link&gt;
 :)
		</comment>
		<comment id='7' author='matthiasgoergens' date='2020-02-18T21:58:30Z'>
		Fix was merged, so closing.
		</comment>
	</comments>
</bug>