<bug id='1440' author='asemic-horizon' open_date='2020-05-12T12:52:20Z' closed_time='2020-06-20T00:59:21Z'>
	<summary>Many (maybe most) images generated by st.pyplot() break in version 0.59</summary>
	<description>
I'm sorry I didn't document this well / can't generate a good bug report right now.
From time to time Streamlit (v 0.58) will fail to generate an image. This manifests itself in the browser as a broken image reference and in the console as a "Missing image" error. This is very occasional and workable for my team's purposes.
I upgraded to 0.59 and this became very frequent. My main viz page has 6 charts generated via st.pyplot() and always one or two are breaking. We're kind of a rinky operation with poor test tooling etc. but I can report that in v 0.58 this problem happened every 25-50 pageloads where as now it happens in pretty much every pageload.
On my side I dis-upgraded to 0.58 and everything works to satisfaction again. I'm sorry I have too much on my plate and can't help more. Streamlit is surprisingly good at enabling non-"front-end engineers" to make data entry interfaces. Thanks for the great work.
	</description>
	<comments>
		<comment id='1' author='asemic-horizon' date='2020-05-13T13:08:49Z'>
		We're running into this as well, maybe 70% of matplotlib-generated images are not rendering, just showing up as "broken" images.
Screenshot:
&lt;denchmark-link:https://user-images.githubusercontent.com/18459252/81816457-a1dd7900-952b-11ea-9749-78f7f186fc57.png&gt;&lt;/denchmark-link&gt;

Edit: Looks like this is a duplicate of &lt;denchmark-link:https://github.com/streamlit/streamlit/issues/1294&gt;#1294&lt;/denchmark-link&gt;

		</comment>
		<comment id='2' author='asemic-horizon' date='2020-05-17T08:19:51Z'>
		Hi &lt;denchmark-link:https://github.com/JohnPaton&gt;@JohnPaton&lt;/denchmark-link&gt;
, &lt;denchmark-link:https://github.com/asemic-horizon&gt;@asemic-horizon&lt;/denchmark-link&gt;
 -- i'm working on this bug, is there any chance y'all could share a snippet of a script that helps reproduce this effect?
		</comment>
		<comment id='3' author='asemic-horizon' date='2020-05-18T08:05:32Z'>
		Sure, here you go:
# bug.py
import numpy as np
import streamlit as st
import matplotlib.pyplot as plt


seed = st.slider(
    value=1234, min_value=1, max_value=9999, format="%i", label="Random seed",
)
np.random.seed(seed)

for _ in range(10):
    plt.scatter(*np.random.random(size=(2, 100)))
    st.pyplot()
Note that it's inconsistent but just try a few values on the slider and you'll see the "missing image/0 icon" pretty quick (or at least I do), along with the  log lines mentioned in &lt;denchmark-link:https://github.com/streamlit/streamlit/issues/1294&gt;#1294&lt;/denchmark-link&gt;
.
I've checked 0.59.0 and 0.59.1.dev20200517, the effect is there in both.
Update: Also in 0.61.0
$ streamlit version
Streamlit, version 0.59.1.dev20200517 
$ streamlit run bug.py

  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:8501
  Network URL: http://192.168.1.106:8501

MediaFileManager: Missing file 396c0caecd98be2b709ed89996bfadc6d95abb9de9cc791bcfc24202
MediaFileManager: Missing file 975c7d649f46a7f3ce9f84b4ac66b9eecd615b1e52302c0bbbb4fad9
MediaFileManager: Missing file f6603cfa18aa900f2b429e8b42410b521eed2c987c3709abf0584e5c
MediaFileManager: Missing file b53af504973ad7bfe8811185b695c214ad94fe1a7b71361d707b3798
&lt;denchmark-link:https://user-images.githubusercontent.com/18459252/82189232-593d0b80-98ef-11ea-9751-8c4a654ed112.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='4' author='asemic-horizon' date='2020-05-18T18:18:28Z'>
		Thanks!  I have been able to repro this effect myself, but since it's a bit stochastic, it's really useful to have more examples to try.
		</comment>
		<comment id='5' author='asemic-horizon' date='2020-06-04T06:15:39Z'>
		I can't repro on v0.61.0. Can someone else try to repro and let us know the result?
		</comment>
		<comment id='6' author='asemic-horizon' date='2020-06-04T08:42:36Z'>
		Nothing has changed for me
$ streamlit version
Streamlit, version 0.61.0
$ streamlit run bug.py  # from my previous comment

  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:8501
  Network URL: http://192.168.1.106:8501

MediaFileManager: Missing file 396c0caecd98be2b709ed89996bfadc6d95abb9de9cc791bcfc24202
MediaFileManager: Missing file 1962ba8d864b56ed648e21fba4a7d6072105e270ed720635f21ac39d
MediaFileManager: Missing file b9811f93d47f81324bc50d5a503d8ecbd38dcc4caa82146c21419d65
MediaFileManager: Missing file ca4064d25e9bed998abb8c525ec4d12b40d9932188a0a2465f22bd04
MediaFileManager: Missing file 7787038e02c50267be1b37609c52d4c949e304a0855a4affca751852
		</comment>
		<comment id='7' author='asemic-horizon' date='2020-06-04T12:47:36Z'>
		Using streamlit 0.61, getting missing images. My current workaround is to save an image and show that:
fig = shap.summary_plot(shap_values, X, plot_type="bar")
fname = "shap_summary.png"
plt.savefig(fname, bbox_inches="tight")
img = plt.imread(fname)
st.image(img, use_column_width=True)
One thing I've noted is that it quite reliably works or doesn't work, seems that some of the stuff above st.pyplot can effect it.
Another mpl bug is that I almost always have to do: st.pyplot(fig, bbox_inches="tight")else it clips the image in streamlit.
		</comment>
		<comment id='8' author='asemic-horizon' date='2020-06-18T12:59:31Z'>
		
Another mpl bug is that I almost always have to do: st.pyplot(fig, bbox_inches="tight")else it clips the image in streamlit.

Thanks for letting us know &lt;denchmark-link:https://github.com/khalido&gt;@khalido&lt;/denchmark-link&gt;
. In that case, since you're passing that argument on the matplotlib size, I think that's their issue. Meaning, once  happens, the picture is printed; we just display the picture as it was printed.
		</comment>
		<comment id='9' author='asemic-horizon' date='2020-06-18T14:48:32Z'>
		A partial fix that would ameliorate the issue significantly would be to focus on the first page load situation. My main screen has a dropdown menu with a default value and an image should be generated from that default value. The very first view in an app shouldn't break. To have working interactivity could be step 2.
My project doesn't have expectations of charts reacting quickly to sliders (where, I don't know, maybe the "back-end" outpaces the front-end in some obscure way); I have dropdowns that trigger DB queries and calculations that are time-consuming (but also not in such a way that computer resources are completely blocked -- asynchronous IO should work).
This is part of a larger reliability story here that exceeds the scope of the issue, the amount of time-effort I can afford for this hobby project and also what an open source teams owes me after all. I'm mentioning this because Streamlit staff reached out to me on HN and I pointed to the issue as a glaring example of said larger reliability story.
(I know I'm not helping much by not providing minimal reproducible examples. I could share my code -- it's actually on github -- but that wouldn't help.)
		</comment>
	</comments>
</bug>