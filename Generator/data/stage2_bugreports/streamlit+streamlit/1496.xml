<bug id='1496' author='beasteers' open_date='2020-05-25T05:02:01Z' closed_time='2020-07-08T00:46:25Z'>
	<summary>Error during exception handling in st.write - TypeError: exception() takes 3 positional arguments but 4 were given</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

I'm trying to display a dataframe with st.write and it fails with a streamlit error while trying to handle an error from rendering the object.
TypeError: exception() takes 3 positional arguments but 4 were given
Traceback:
File "/home/bs3639/.conda/envs/bosch/lib/python3.6/site-packages/streamlit/ScriptRunner.py", line 322, in _run_script
    exec(code, module.__dict__)
File "/scratch/bs3639/bosch-urban-sound/boschurbansnd/app.py", line 256, in &lt;module&gt;
    data_summary(dflabels, dffiles)
File "/scratch/bs3639/bosch-urban-sound/boschurbansnd/app.py", line 130, in data_summary
    st.write(dffiles.reset_index(drop=True).head())
File "/home/bs3639/.conda/envs/bosch/lib/python3.6/site-packages/streamlit/__init__.py", line 411, in write
    exception(exc, exc_tb)  # noqa: F821
File "/home/bs3639/.conda/envs/bosch/lib/python3.6/site-packages/streamlit/DeltaGenerator.py", line 122, in wrapped_method
    return dg._enqueue_new_element_delta(marshall_element, delta_type, last_index)
File "/home/bs3639/.conda/envs/bosch/lib/python3.6/site-packages/streamlit/DeltaGenerator.py", line 367, in _enqueue_new_element_delta
    rv = marshall_element(msg.delta.new_element)
File "/home/bs3639/.conda/envs/bosch/lib/python3.6/site-packages/streamlit/DeltaGenerator.py", line 120, in marshall_element
    return method(dg, element, *args, **kwargs)
&lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;

It happens when you raise an exception during type conversion in st.write.
Here's the simplest example I could think of that throws the same error.
import streamlit as st

class breakstuff:
    def __str__(self):
        raise ValueError

st.write(breakstuff())
&lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;

It should display the ValueError
&lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;

Instead it throws a streamlit internal TypeError error (see above traceback).
It means that I can't actually debug the exception that is throwing that code.
&lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;


Streamlit version: Streamlit, version 0.60.0 (get it with $ streamlit version)
Python version: Python 3.6.10 :: Anaconda, Inc. (get it with $ python --version)
Using Conda? PipEnv? PyEnv? Pex?  -  Conda
OS version:
Browser version:

&lt;denchmark-h:h1&gt;Additional information&lt;/denchmark-h&gt;

From a quick spin following the traceback, I believe I can see the issue.
The traceback says that the error originates here:



streamlit/lib/streamlit/DeltaGenerator.py


         Line 120
      in
      a9be677






 return method(dg, element, *args, **kwargs) 





The wrapper provides 2 args and it says it's receiving 4 while expecting 3, so that means that the wrapped method is being called with 2 instead of an expected 1 argument.
Earlier in the traceback, it says that it's being raised in st.write by exception (notice it's being called with 2 arguments):



streamlit/lib/streamlit/__init__.py


        Lines 409 to 411
      in
      a9be677






 except Exception: 



 _, exc, exc_tb = _sys.exc_info() 



 exception(exc, exc_tb)  # noqa: F821 





Looking at its definition, exception is wrapped with _with_element and takes 3 arguments, 2 of which are provided by the wrapper.



streamlit/lib/streamlit/DeltaGenerator.py


        Lines 788 to 789
      in
      a9be677






 @_with_element 



 def exception(self, element, exception): 





tl;dr - you probably shouldn't be passing the traceback into the exception function (or perhaps you meant to and you haven't finished implementing it on the other side.) Either way, it's broken rn.
&lt;denchmark-h:h1&gt;Possible Solution?&lt;/denchmark-h&gt;

From a cursory glance, it looks like you should just simplify to this and this issue will go away:
# change here: https://github.com/streamlit/streamlit/blob/a9be6773eceba186c4094908c5403575810d760a/lib/streamlit/__init__.py#L409-L411
try:
    ...
except Exception as exc:
    exception(exc)
	</description>
	<comments>
		<comment id='1' author='beasteers' date='2020-06-13T21:20:27Z'>
		I have the exact same problem. I think that the dataframe is too big. By just not printing it out the problem went await
		</comment>
		<comment id='2' author='beasteers' date='2020-07-07T23:31:24Z'>
		Thanks &lt;denchmark-link:https://github.com/beasteers&gt;@beasteers&lt;/denchmark-link&gt;
 for the excellent and thorough bug report! This is fixed in &lt;denchmark-link:https://github.com/streamlit/streamlit/pull/1682&gt;#1682&lt;/denchmark-link&gt;
, which should go out in the next release.
		</comment>
	</comments>
</bug>