<bug id='336' author='pybokeh' open_date='2019-10-09T12:44:34Z' closed_time='2020-07-16T23:24:45Z'>
	<summary>Top Half of Seaborn Chart Title Gets Cut Off</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

When adding a title to a seaborn or perhaps MATPLOTLIB chart (have not tested with MATPLOTLIB yet) chart, the top half of the title is cut off or not displayed
&lt;denchmark-code&gt;# Steps to reproduce
import matplotlib.pyplot as plt
import seaborn as sns
import streamlit as st

mpg = sns.load_dataset("mpg")
option = st.sidebar.multiselect('Choose country of origin:', mpg.origin.unique()
sns.relplot(x="horsepower", y="mpg", hue="origin", size="weight", sizes=(40, 400), alpha=0.5, palette="muted", height=6, data=mpg.query("origin == @option"))
plt.title('MPG vs Weight by Country of Origin')
st.pyplot()
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;

seaborn chart title to be fully visible
&lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;

Top half of seaborn chart title is cut off
&lt;denchmark-h:h2&gt;Is this a regression?&lt;/denchmark-h&gt;

That is, did this use to work the way you expected in the past?  First time using streamlit, so not sure if worked in the past
yes?  maybe?
&lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;


Streamlit version: 0.47.4
Python version: 3.7
Using Conda
OS version: Windows 10
Browser version: Chrome version 77

	</description>
	<comments>
		<comment id='1' author='pybokeh' date='2019-10-09T12:57:38Z'>
		I apologize, I left out a crucial line: st.write(mpg.query("origin == &lt;denchmark-link:https://github.com/option&gt;@option&lt;/denchmark-link&gt;
"))  just before where the seaborn chart gets rendered and that appears to be the problem.  It appears when rendering the dataframe above the seaborn chart, it appears that the bottom portion of the rendered dataframe overlaps or covers the top portion of the seaborn chart.
		</comment>
		<comment id='2' author='pybokeh' date='2019-10-09T13:02:08Z'>
		Out of curiosity, I removed the dataframe and added a markdown title above the seaborn chart, the seaborn chart title still gets cut off.  So perhaps anything rendered above the seaborn chart title will cut off or overlap over the chart title.  As a workaround, I guess users can remove the seaborn chart title and just use markdown title as the title for the seaborn chart.
		</comment>
		<comment id='3' author='pybokeh' date='2020-02-13T23:59:13Z'>
		Confirmed still an issue.
&lt;denchmark-link:https://user-images.githubusercontent.com/98836/74489304-c5841b00-4e79-11ea-9adf-f89f3b147b0f.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='4' author='pybokeh' date='2020-05-14T15:32:26Z'>
		This looks to be a problem with Seaborn. Running this independently of streamlit produces the same issue.
&lt;denchmark-code&gt;import matplotlib.pyplot as plt
import seaborn as sns

mpg = sns.load_dataset("mpg")
sns.relplot(
    x="horsepower", y="mpg",
    hue="origin", size="weight", sizes=(40, 400),
    alpha=0.5, palette="muted", height=6,
    data=mpg.query("origin == 'usa'"))
plt.title('MPG vs Weight by Country of Origin')
plt.show()
&lt;/denchmark-code&gt;

&lt;denchmark-link:https://user-images.githubusercontent.com/24946400/81953090-423ba800-95d5-11ea-8aab-fe6b7a708589.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='5' author='pybokeh' date='2020-05-14T15:37:04Z'>
		Did we file an issue with Seaborn?
		</comment>
		<comment id='6' author='pybokeh' date='2020-05-14T15:48:22Z'>
		Just did! &lt;denchmark-link:https://github.com/mwaskom/seaborn/issues/2072&gt;Seaborn #2072&lt;/denchmark-link&gt;

		</comment>
		<comment id='7' author='pybokeh' date='2020-05-14T15:55:50Z'>
		Cool! Gonna move this to the icebox for now. Let's re-visit if/when Seaborn fixes the bug.
It's only a test dependency of ours but looks like the Cypress tests for Seaborn are currently flaky so we can revisit them after the fix.
		</comment>
		<comment id='8' author='pybokeh' date='2020-05-14T22:12:15Z'>
		Turns out for matplotlib, you need to configure the chart appropriately to make room for the title. We're evaluating if this is something we'd like to manipulate as part of our library or return the output as is.
In the meantime, &lt;denchmark-link:https://github.com/pybokeh&gt;@pybokeh&lt;/denchmark-link&gt;
 if this is still an issue, there are two ways to resolve this. For more details, please see &lt;denchmark-link:https://github.com/mwaskom/seaborn/issues/2072&gt;Seaborn #2072&lt;/denchmark-link&gt;

&lt;denchmark-h:h3&gt;Set the bbox to tight&lt;/denchmark-h&gt;

st.pyplot(bbox_inches="tight")
&lt;denchmark-h:h3&gt;Make room for the chart&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;import seaborn as sns

mpg = sns.load_dataset("mpg")
g = sns.relplot(
    x="horsepower",
    y="mpg",
    hue="origin",
    size="weight",
    sizes=(40, 400),
    alpha=0.5,
    palette="muted",
    height=6,
    data=mpg.query("origin == 'usa'")
)
g.fig.subplots_adjust(top=.95)
g.ax.set_title('MPG vs Weight by Country of Origin')
st.pyplot()
&lt;/denchmark-code&gt;

		</comment>
		<comment id='9' author='pybokeh' date='2020-05-22T16:56:41Z'>
		Looks like this is fine in Jupyter. Exploring if there's a simple change we can apply to st.pyplot to inherit all the behavior from Jupyter
Initial findings:

Jupyter uses the Matplotlib backend called nbagg
Jupyter used to have a special function that sets up Matplotlib, possibly matplotlib

		</comment>
		<comment id='10' author='pybokeh' date='2020-05-27T16:53:32Z'>
		It looks like Jupyter's backend only addresses charts displayed inline. In streamlit, we're sending over a saved image. While we could update our matplotlib backend to align with Juptyer's (module://ipykernel.pylab.backend_inline), it would not handle the necessary resizing of the chart to accommodate for a title.
Sample code:
&lt;denchmark-code&gt;import matplotlib.pyplot as plt
import seaborn as sns

mpg = sns.load_dataset("mpg")
sns.relplot(
    x="horsepower", y="mpg",
    hue="origin", size="weight", sizes=(40, 400),
    alpha=0.5, palette="muted", height=6,
    data=mpg.query("origin == 'usa'"))
plt.title('MPG vs Weight by Country of Origin')
plt.savefig('jupyter')
&lt;/denchmark-code&gt;

Revisiting with the team to determine if our library should handle it.
		</comment>
		<comment id='11' author='pybokeh' date='2020-07-15T18:43:03Z'>
		Added the docs label here...since this is a quirk of matplotlib, best solution in the interim is probably just to highlight that it happens and the solution is usually st.pyplot(bbox_inches="tight")
		</comment>
	</comments>
</bug>