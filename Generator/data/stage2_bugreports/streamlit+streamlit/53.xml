<bug id='53' author='treuille' open_date='2019-09-05T20:26:12Z' closed_time='2019-10-09T18:13:15Z'>
	<summary>Persistent bug with caching</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

This bug happens every time I run this uber.py script. I think it has to do with caching.
&lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;

Run this uber.py file:
import streamlit as st
import pandas as pd
import numpy as np

DATE_TIME = 'date/time'
DATA_URL = 'https://s3-us-west-2.amazonaws.com/streamlit-demo-data/uber-raw-data-sep14.csv.gz'

lowercase = lambda x: str(x).lower()

@st.cache
def load_data(nrows):
    data = pd.read_csv(DATA_URL, nrows=nrows)
    data.rename(lowercase, axis='columns', inplace=True)
    data[DATE_TIME] = pd.to_datetime(data[DATE_TIME])
    data['hour'] = (data[DATE_TIME].dt.hour + 17) % 24
    return data

data = load_data(100000)
hour = st.slider('hour', 0, 23, 11)
data = data[data[DATE_TIME].dt.hour == hour]

st.write('### Geo Data at %sh' % hour)
midpoint = (np.average(data['lat']), np.average(data['lon']))
st.deck_gl_chart(
    viewport={
        'latitude': midpoint[0],
        'longitude': midpoint[1],
        'zoom': 11,
        'pitch': 50,
    },
    layers=[{
        'type': 'HexagonLayer',
        'data': data,
        'radius': 100,
        'elevationScale': 4,
        'elevationRange': [0, 1000],
        'pickable': True,
        'extruded': True,
    }])

st.write('### Data by Minute at %sh' % hour)
st.bar_chart(np.histogram(data[DATE_TIME].dt.minute, bins=60)[0])

if st.checkbox("Show Raw Data"):
    st.write('### Raw Data at %sh' % hour)
    st.write(data)
&lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;

In  you will get this:
&lt;denchmark-link:https://user-images.githubusercontent.com/1673013/64377966-7d1a2480-cfe0-11e9-8fa8-e62b62af04c2.png&gt;&lt;/denchmark-link&gt;

&lt;denchmark-h:h3&gt;Note&lt;/denchmark-h&gt;

If you hit R to rerun, you will see the right answer.
&lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;

It should run properly the first time.
&lt;denchmark-h:h2&gt;Is this a regression?&lt;/denchmark-h&gt;

yes
&lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;$ streamlit version &amp;&amp; python --version &amp;&amp; pyenv --version &amp;&amp; sw_vers &amp;&amp; "/Applications/Google Chrome.app/Contents/MacOS/Google Chrome" --version
Streamlit, version 0.45.0
Python 3.6.3
pyenv 1.2.3
ProductName:    Mac OS X
ProductVersion: 10.14.6
BuildVersion:   18G95
Google Chrome 76.0.3809.132 
&lt;/denchmark-code&gt;

	</description>
	<comments>
		<comment id='1' author='treuille' date='2019-09-06T00:10:08Z'>
		Can't repro.
Also, Adrien can't repro anymore either.
		</comment>
		<comment id='2' author='treuille' date='2019-09-06T16:16:19Z'>
		It just happened again.
		</comment>
		<comment id='3' author='treuille' date='2019-09-09T22:42:59Z'>
		Looks like 


streamlit/lib/streamlit/__init__.py


         Line 457
      in
      455ae61






 message.empty() 




 should not access the message variable, because it is defined inside the try. Or you move the definition outside the try. What makes you think this is an issue with caching?
		</comment>
	</comments>
</bug>