<bug id='921' author='amin-nejad' open_date='2020-01-05T22:08:39Z' closed_time='2020-02-25T22:40:19Z'>
	<summary>Double Newline Messes with HTML Rendering</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

Two consecutive newline characters prevents HTML from rendering properly when using st.markdown() or st.write(). Obviously only with unsafe_allow_html=True, otherwise HTML won't render anyway. Style is incorrectly applied to the empty line preceding the correct one.
Furthermore, if the HTML contains linebreaks using &lt;/br&gt; in a certain way, the HTML doesn't render at all, instead returning an error: TypeError: Cannot read property 'props' of undefined
&lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;

Run the following app:
&lt;denchmark-code&gt;import streamlit as st

st.subheader('Test')

html = """
&lt;div class="entities" style="line-height: 2.5"&gt;
&lt;mark class="entity" style="background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em; box-decoration-break: clone; -webkit-box-decoration-break: clone"&gt;

Lorem Ipsum
    &lt;span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem"&gt;ORG&lt;/span&gt;
&lt;/mark&gt;
Testing&lt;/br&gt;Testing&lt;/br&gt;Testing
&lt;/div&gt;
"""

st.write(html,unsafe_allow_html=True) 
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;

HTML should just render normally as below:
&lt;denchmark-link:https://user-images.githubusercontent.com/44096034/71786739-f4031080-3006-11ea-9789-d52c305c452b.png&gt;&lt;/denchmark-link&gt;

&lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;

The code snippet instead returns the result below:
&lt;denchmark-link:https://user-images.githubusercontent.com/44096034/71786512-13e50500-3004-11ea-9afb-6159a37ac8f9.png&gt;&lt;/denchmark-link&gt;

If the &lt;/br&gt; instances are replaced with &lt;br&gt;, the HTML renders but with incorrect styling:
&lt;denchmark-link:https://user-images.githubusercontent.com/44096034/71786752-0ed58500-3007-11ea-9155-a21fc9cb7962.png&gt;&lt;/denchmark-link&gt;

&lt;denchmark-h:h2&gt;Is this a regression?&lt;/denchmark-h&gt;

Don't know, I'm relatively new to streamlit.
&lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;


Streamlit version: 0.52.2
Python version: 3.7.3
Using Conda
OS version: Ubuntu 18.04.1 LTS (WSL)
Browser version: Chrome Version 79.0.3945.79 (Official Build) (64-bit)

&lt;denchmark-h:h1&gt;Additional information&lt;/denchmark-h&gt;

Removing the empty line before "Lorem Ipsum" will fix the issue.
Until a fix is put in place, this can be dealt with by using the following snipped prior to st.write()
&lt;denchmark-code&gt;import re
html = re.sub(r'\n\s*\n', '\n\n', html)
html = html.replace("\n\n", "\n")
&lt;/denchmark-code&gt;

Came across this problem by trying to use streamlit to render the HTML returned from displacy from the spacy library.
	</description>
	<comments>
		<comment id='1' author='amin-nejad' date='2020-01-07T18:55:46Z'>
		Hi &lt;denchmark-link:https://github.com/amin-nejad&gt;@amin-nejad&lt;/denchmark-link&gt;
 ! Looks like you found an actual bug. Thanks for letting us know!
		</comment>
		<comment id='2' author='amin-nejad' date='2020-01-07T19:10:34Z'>
		No worries!
		</comment>
		<comment id='3' author='amin-nejad' date='2020-01-09T13:01:13Z'>
		Hi there, just wanted to confirm that I have had the same issue trying to render the HTML output of eli5.formatters.html.format_as_html(). In that case, using the workaround above was not enough to get the right output (although it was enough to remove the TypeError). I also had to enclose the html inside a div block:
&lt;denchmark-code&gt;html = "&lt;div&gt;" + html + "&lt;/div&gt;"
&lt;/denchmark-code&gt;

Thanks for the workaround in any case, I can carry one working on my app without having to wait for a fix.
		</comment>
		<comment id='4' author='amin-nejad' date='2020-01-12T21:20:40Z'>
		I am not convinced this is a bug:  I obtained the desired output using either &lt;/br&gt; or  &lt;br&gt;.
&lt;denchmark-code&gt;Steamlit: 0.49.0
Python:   3.6.7 (default, Feb 28 2019, 07:28:18) [MSC v.1900 64 bit (AMD64)]
OS:        Windows 10
Browser:  Chrome, 79.0.3945.117 (64-bit)
&lt;/denchmark-code&gt;

There was an odd behavior, though: on the very first run of the given code (containing the invalid end-tag &lt;/br&gt;), st.write displayed the raw html string; subsequent reruns yielded the expected output.
		</comment>
		<comment id='5' author='amin-nejad' date='2020-01-14T21:01:12Z'>
		Probably the same issue as &lt;denchmark-link:https://github.com/streamlit/streamlit/issues/859&gt;#859&lt;/denchmark-link&gt;

		</comment>
		<comment id='6' author='amin-nejad' date='2020-01-14T21:01:46Z'>
		Also &lt;denchmark-link:https://github.com/streamlit/streamlit/issues/586&gt;#586&lt;/denchmark-link&gt;

		</comment>
		<comment id='7' author='amin-nejad' date='2020-01-23T21:10:03Z'>
		Hey &lt;denchmark-link:https://github.com/amin-nejad&gt;@amin-nejad&lt;/denchmark-link&gt;

Looks like a bug with React Markdown. I've filled it &lt;denchmark-link:https://github.com/rexxars/react-markdown/issues/385&gt;here&lt;/denchmark-link&gt;
 for you but I will be sending a PR in order to improve the error catching from Streamlit.
In general, this unsafe_allow_html feature is a temporary "patch". We are actually working on real solutions right now that should allow you to do much more.
So stay tuned for news in the next few weeks.
		</comment>
		<comment id='8' author='amin-nejad' date='2020-01-23T22:14:34Z'>
		Thanks &lt;denchmark-link:https://github.com/arraydude&gt;@arraydude&lt;/denchmark-link&gt;
 !
		</comment>
		<comment id='9' author='amin-nejad' date='2020-02-12T22:50:49Z'>
		In seeing if we could close this issue, I just reproduced the error (latest code from develop).
So this is still a problem.
&lt;denchmark-link:https://user-images.githubusercontent.com/98836/74384855-0828f300-4da7-11ea-82be-25f116c8a7a4.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='10' author='amin-nejad' date='2020-02-25T22:40:19Z'>
		After re-checking it with the production build it seems to be working correctly, maybe you tried it with the development mode .
&lt;denchmark-link:https://user-images.githubusercontent.com/631997/75294213-95883080-5806-11ea-82aa-1e596475285e.png&gt;&lt;/denchmark-link&gt;

		</comment>
	</comments>
</bug>