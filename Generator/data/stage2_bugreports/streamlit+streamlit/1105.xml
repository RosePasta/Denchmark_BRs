<bug id='1105' author='erik-hasse' open_date='2020-02-16T16:55:27Z' closed_time='2020-10-28T06:45:26Z'>
	<summary>Bad sortColumnIdx error after a dataframe is changed</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

When a dataframe is loaded, sorted on a column at the end, and then the number of columns is reduced, a "Bad sortColumnIdx" error is thrown.
&lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;

Minimal, Reproducible Example:
&lt;denchmark-code&gt;import numpy as np
import pandas as pd
import streamlit as st

n = st.sidebar.number_input('Number of columns', value=5)
df = pd.DataFrame(np.random.randint(0, 10, size=(10, n)))
st.dataframe(df)
&lt;/denchmark-code&gt;


Run the app
Sort the dataframe on the last column
Reduce the number of columns

&lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;

The dataframe should revert to unsorted or be sorted by its last column.
&lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;

The dataframe is not displayed and a Bad sortColumnIdx error is shown.
&lt;denchmark-h:h2&gt;Is this a regression?&lt;/denchmark-h&gt;

No
&lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;


Streamlit version: 0.56.0
Python version: 3.8.1
Conda environment
OS version: macOS 10.14.6
Browser version: Firefox 72.0.1, Chrome 79.0.3945.130

	</description>
	<comments>
		<comment id='1' author='erik-hasse' date='2020-02-20T00:17:33Z'>
		Thanks &lt;denchmark-link:https://github.com/erik-hasse&gt;@erik-hasse&lt;/denchmark-link&gt;
! We're currently overhauling our dataframe logic (see &lt;denchmark-link:https://github.com/streamlit/streamlit/pull/1021&gt;#1021&lt;/denchmark-link&gt;
), which will hopefully fix this.
I've moved this bug to our internal triage board, and we'll take another look at it after the above PR lands.
		</comment>
		<comment id='2' author='erik-hasse' date='2020-10-15T18:57:02Z'>
		Quick note, &lt;denchmark-link:https://github.com/kellyamanda&gt;@kellyamanda&lt;/denchmark-link&gt;
 just saw this bug pop up in our metrics dashboard, so i'm bumping it up in priority as it clearly didn't get washed away by any PRs over the year.
		</comment>
	</comments>
</bug>