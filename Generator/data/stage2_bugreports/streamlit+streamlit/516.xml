<bug id='516' author='YashaPushak' open_date='2019-10-23T22:46:35Z' closed_time='2020-02-14T23:21:38Z'>
	<summary>Bad error messages with nested st.cache calls</summary>
	<description>
&lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;

You can get very unclear and unhelpful error messages if you nest your st.cache calls and then have a bug within the inner-nested call.
&lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;

What are the steps we should take to reproduce the bug:

Create a streamlit app called "remakeBug.py"
Paste in the text:

&lt;denchmark-code&gt;import streamlit as st
import pandas as pd
import copy as cp
import numpy as np

def read_csv(f):
    return cp.deep_copy(read_csv_helper(f))

@st.cache
def read_csv_helper(f):
    return pd.read_csv(f)

@st.cache
def load_and_mutate(f):
    df = read_csv(f)

    df[2] = df[0]*df[1]

    return df

st.write("Creating a dataframe")
df = pd.DataFrame(np.random.randn(10,3))

st.write(df)

st.write("Saving the dataframe to a csv file")
df.to_csv("data.csv")

st.write("Reading and mutating the dataframe from the file")
df2 = load_and_mutate("data.csv")

st.write(df2)

&lt;/denchmark-code&gt;


Run the app
streamlit run remakeBug.py
Go to your browser and view the warning message.

&lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;

AttributeError: module 'copy' has no attribute 'deep_copy'
&lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;Streamlit failed to hash an object of type &lt;class 'function'&gt;.,

More information: to prevent unexpected behavior, Streamlit tries to detect mutations in cached objects defined in your local files so it can alert you when the cache is used incorrectly. However, something went wrong while performing this check.

This error can occur when your virtual environment lives in the same folder as your project, since that makes it hard for Streamlit to understand which files it should check. If you think that's what caused this, please add the following to ~/.streamlit/config.toml:


[server]
folderWatchBlacklist = ['foldername']
...where foldername is the relative or absolute path to the folder where you put your virtual environment.

Otherwise, please file a bug here.

To stop this warning from showing in the meantime, try one of the following:

Preferred: modify your code to avoid using this type of object.
Or add the argument ignore_hash=True to the st.cache decorator.
&lt;/denchmark-code&gt;

&lt;denchmark-h:h2&gt;Is this a regression?&lt;/denchmark-h&gt;

I don't know.
&lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;


Streamlit version: Version 0.48.1
Python version: 3.7.3
Using Conda and PipEnv
OS version: Oracle Linux Server Version 7.1
Browser version: Google Chrome Version 77.0.3865.120 (Official Build) (64-bit)

	</description>
	<comments>
		<comment id='1' author='YashaPushak' date='2020-02-14T23:21:38Z'>
		Closing since this behavior has now been greatly improved.  Here's what happens when I run the sample code now (thanks for that code!):
&lt;denchmark-link:https://user-images.githubusercontent.com/98836/74575912-ad75cf80-4f3d-11ea-984a-7b8573438c59.png&gt;&lt;/denchmark-link&gt;

		</comment>
	</comments>
</bug>