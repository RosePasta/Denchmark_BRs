<bug id='1903' author='myungjoo' open_date='2019-11-29T01:44:24Z' closed_time='2019-12-16T04:54:07Z'>
	<summary>[Regression?] NNFW Unit Test Fails</summary>
	<description>
Note that NNFW is built for armv7l and aarch64 only while TAOS-CI unit test is enabled for x86 only.
&lt;denchmark-code&gt;[  272s] + ./tests/tizen_nnfw_runtime/unittest_nnfw_runtime_raw --gst-plugin-path=. --gtest_output=xml:unittest_nnfw_runtime_raw.xml
[  272s] [==========] Running 5 tests from 1 test case.
[  272s] [----------] Global test environment set-up.
[  272s] [----------] 5 tests from nnstreamer_nnfw_runtime_raw_functions
[  272s] [ RUN      ] nnstreamer_nnfw_runtime_raw_functions.check_existence
[  273s] [       OK ] nnstreamer_nnfw_runtime_raw_functions.check_existence (39 ms)
[  273s] [ RUN      ] nnstreamer_nnfw_runtime_raw_functions.open_close_00_n
[  273s] invalid nnpackge directory: null.nnfw
[  273s] Cannot load the model file: null.nnfw[       OK ] nnstreamer_nnfw_runtime_raw_functions.open_close_00_n (2 ms)
[  273s] [ RUN      ] nnstreamer_nnfw_runtime_raw_functions.open_close_01_n
[  273s] nnfw_close called without proper nnfw_openCan't load libOpenCL.so: libOpenCL.so: cannot open shared object file: No such file or directory
[  273s] Can't load libGLES_mali.so: libGLES_mali.so: cannot open shared object file: No such file or directory
[  273s] Can't load libmali.so: libmali.so: cannot open shared object file: No such file or directory
[  273s] Couldn't find any OpenCL library.
[  273s] Error during model prepare
[  273s] nnfw-runtime cannot prepare the session for /home/abuild/rpmbuild/BUILD/nnstreamer-1.0.0/tests/test_models/models../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:82: Failure
[  273s]       Expected: ret
[  273s]       Which is: -22
[  273s] To be equal to: 0
[  273s] nnfw_close called without proper nnfw_opennnfw_close called without proper nnfw_open[  FAILED  ] nnstreamer_nnfw_runtime_raw_functions.open_close_01_n (120 ms)
[  273s] [ RUN      ] nnstreamer_nnfw_runtime_raw_functions.get_dimension
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensors_info_get: assertion 'pdata != NULL' failed
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensors_info_get: assertion 'pdata != NULL' failed
[  273s] Error during model prepare
[  273s] nnfw-runtime cannot prepare the session for /home/abuild/rpmbuild/BUILD/nnstreamer-1.0.0/tests/test_models/models../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:130: Failure
[  273s]       Expected: ret
[  273s]       Which is: -22
[  273s] To be equal to: 0
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensors_info_get: assertion 'info != NULL' failed
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensors_info_get: assertion 'pdata != NULL' failed
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:143: Failure
[  273s]       Expected: ret
[  273s]       Which is: -22
[  273s] To be equal to: 0
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:146: Failure
[  273s]       Expected: res.info[0].type
[  273s]       Which is: 1
[  273s] To be equal to: info.info[0].type
[  273s]       Which is: 7
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:147: Failure
[  273s]       Expected: res.info[0].dimension[0]
[  273s]       Which is: 0
[  273s] To be equal to: info.info[0].dimension[0]
[  273s]       Which is: 1
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:148: Failure
[  273s]       Expected: res.info[0].dimension[1]
[  273s]       Which is: 19897488
[  273s] To be equal to: info.info[0].dimension[1]
[  273s]       Which is: 1
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:149: Failure
[  273s]       Expected: res.info[0].dimension[2]
[  273s]       Which is: 64
[  273s] To be equal to: info.info[0].dimension[2]
[  273s]       Which is: 1
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:150: Failure
[  273s]       Expected: res.info[0].dimension[3]
[  273s]       Which is: 10488744
[  273s] To be equal to: info.info[0].dimension[3]
[  273s]       Which is: 1
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensors_info_get: assertion 'info != NULL' failed
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensors_info_get: assertion 'pdata != NULL' failed
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:155: Failure
[  273s]       Expected: ret
[  273s]       Which is: -22
[  273s] To be equal to: 0
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:158: Failure
[  273s]       Expected: res.info[0].type
[  273s]       Which is: 1
[  273s] To be equal to: info.info[0].type
[  273s]       Which is: 7
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:159: Failure
[  273s]       Expected: res.info[0].dimension[0]
[  273s]       Which is: 0
[  273s] To be equal to: info.info[0].dimension[0]
[  273s]       Which is: 1
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:160: Failure
[  273s]       Expected: res.info[0].dimension[1]
[  273s]       Which is: 19897488
[  273s] To be equal to: info.info[0].dimension[1]
[  273s]       Which is: 1
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:161: Failure
[  273s]       Expected: res.info[0].dimension[2]
[  273s]       Which is: 64
[  273s] To be equal to: info.info[0].dimension[2]
[  273s]       Which is: 1
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:162: Failure
[  273s]       Expected: res.info[0].dimension[3]
[  273s]       Which is: 10488744
[  273s] To be equal to: info.info[0].dimension[3]
[  273s]       Which is: 1
[  273s] nnfw_close called without proper nnfw_open[  FAILED  ] nnstreamer_nnfw_runtime_raw_functions.get_dimension (10 ms)
[  273s] [ RUN      ] nnstreamer_nnfw_runtime_raw_functions.invoke
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensor_memory_set: assertion 'pdata != NULL' failed
[  273s] Error during model prepare
[  273s] nnfw-runtime cannot prepare the session for /home/abuild/rpmbuild/BUILD/nnstreamer-1.0.0/tests/test_models/models../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:213: Failure
[  273s]       Expected: ret
[  273s]       Which is: -22
[  273s] To be equal to: 0
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensor_memory_set: assertion 'mem != NULL' failed
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensor_memory_set: assertion 'pdata != NULL' failed
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensor_memory_set: assertion 'mem != NULL' failed
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensor_memory_set: assertion 'pdata != NULL' failed
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:225: Failure
[  273s]       Expected: ret
[  273s]       Which is: -22
[  273s] To be equal to: 0
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:226: Failure
[  273s]       Expected: *((float *)output.data)
[  273s]       Which is: 1.93637e-38
[  273s] To be equal to: 12.0
[  273s]       Which is: 12
[  273s] 
[  273s] ** (process:36102): CRITICAL **: nnfw_tensor_memory_set: assertion 'pdata != NULL' failed
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:230: Failure
[  273s]       Expected: ret
[  273s]       Which is: -22
[  273s] To be equal to: 0
[  273s] ../tests/tizen_nnfw_runtime/unittest_tizen_nnfw_runtime_raw.cpp:231: Failure
[  273s]       Expected: *((float *)output.data)
[  273s]       Which is: 1.93637e-38
[  273s] To be equal to: 3.0
[  273s]       Which is: 3
[  273s] nnfw_close called without proper nnfw_open[  FAILED  ] nnstreamer_nnfw_runtime_raw_functions.invoke (7 ms)
[  273s] [----------] 5 tests from nnstreamer_nnfw_runtime_raw_functions (179 ms total)
[  273s] 
[  273s] [----------] Global test environment tear-down
[  273s] [==========] 5 tests from 1 test case ran. (182 ms total)
[  273s] [  PASSED  ] 2 tests.
[  273s] [  FAILED  ] 3 tests, listed below:
[  273s] [  FAILED  ] nnstreamer_nnfw_runtime_raw_functions.open_close_01_n
[  273s] [  FAILED  ] nnstreamer_nnfw_runtime_raw_functions.get_dimension
[  273s] [  FAILED  ] nnstreamer_nnfw_runtime_raw_functions.invoke
[  273s] 
[  273s]  3 FAILED TESTS
&lt;/denchmark-code&gt;

	</description>
	<comments>
		<comment id='1' author='myungjoo' date='2019-11-29T01:44:26Z'>
		 : Thank you for posting issue &lt;denchmark-link:https://github.com/nnstreamer/nnstreamer/issues/1903&gt;#1903&lt;/denchmark-link&gt;
. The person in charge will reply soon.
		</comment>
		<comment id='2' author='myungjoo' date='2019-12-11T04:54:26Z'>
		&lt;denchmark-code&gt;[  273s] Can't load libOpenCL.so: libOpenCL.so: cannot open shared object file: No such file or directory
[  273s] Can't load libGLES_mali.so: libGLES_mali.so: cannot open shared object file: No such file or directory
[  273s] Can't load libmali.so: libmali.so: cannot open shared object file: No such file or directory
[  273s] Couldn't find any OpenCL library.
&lt;/denchmark-code&gt;

This error happens because nnfw package installs libbackend_acl_cl.so in /usr/lib in emulator. I think this file makes the package think that opencl exists, and use opencl as backend, while opencl does not exist. Removing this file manually makes the testcases pass in armv7l and aarch64 builds. (check the comment from #1819 for more details).
I think nnfw developers can help with this.
Also #1911 has the same issue I think.
		</comment>
	</comments>
</bug>