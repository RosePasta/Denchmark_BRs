<bug id='2959' author='dongju-chae' open_date='2020-12-17T01:11:04Z' closed_time='2021-01-14T05:53:11Z'>
	<summary>[CAPI] intermittent unittest failures (segmentation fault)</summary>
	<description>

Problematic testcase: nnstreamer_capi_singleshot.parallel_runs in unittest_tizen_capi
Testing environment: Tizen i586 with gbs build

&lt;denchmark-code&gt;[  278s] [ RUN      ] nnstreamer_capi_singleshot.unavailable_fw_tf_n
[  278s] [       OK ] nnstreamer_capi_singleshot.unavailable_fw_tf_n (1 ms)
[  278s] [ RUN      ] nnstreamer_capi_singleshot.open_fail_01_n
[  278s] ** Message: 01:03:27.227: accl = cpu
[  278s] [       OK ] nnstreamer_capi_singleshot.open_fail_01_n (1 ms)
[  278s] [ RUN      ] nnstreamer_capi_singleshot.open_fail_02_n
[  278s] ** Message: 01:03:27.228: accl = cpu
[  278s] ERROR: tensorflow/lite/kernels/squeeze.cc:62 current &gt;= 0 &amp;&amp; current &lt; input_num_dims &amp;&amp; input_dims-&gt;data[current] == 1 was not true.
[  278s] ERROR: Node number 29 (SQUEEZE) failed to prepare.
[  278s] 
[  278s] ** Message: 01:03:27.231: accl = cpu
[  278s] ** Message: 01:03:27.232: accl = cpu
[  278s] ** Message: 01:03:27.233: accl = cpu
[  278s] ** Message: 01:03:27.234: accl = cpu
[  278s] [       OK ] nnstreamer_capi_singleshot.open_fail_02_n (7 ms)
[  278s] [ RUN      ] nnstreamer_capi_singleshot.open_dynamic
[  278s] ** Message: 01:03:27.235: accl = cpu
[  278s] [       OK ] nnstreamer_capi_singleshot.open_dynamic (1 ms)
[  278s] [ RUN      ] nnstreamer_capi_singleshot.invoke_timeout
[  278s] ** Message: 01:03:27.236: accl = cpu
[  288s] [       OK ] nnstreamer_capi_singleshot.invoke_timeout (10112 ms)
[  288s] [ RUN      ] nnstreamer_capi_singleshot.parallel_runs
[  288s] ** Message: 01:03:37.348: accl = cpu
[  288s] ** Message: 01:03:37.350: accl = cpu
[  288s] ** Message: 01:03:37.348: accl = cpu
[  288s] ** Message: 01:03:37.351: accl = cpu
[  288s] ** Message: 01:03:37.352: accl = cpu
[  288s] ** Message: 01:03:37.352: accl = cpu
[  288s] ** Message: 01:03:37.352: accl = cpu
[  288s] ** Message: 01:03:37.353: accl = cpu
[  288s] ** Message: 01:03:37.367: accl = cpu
[  288s] /home/abuild/rpmbuild/BUILD/nnstreamer-1.7.1/packaging/run_unittests_binaries.sh: line 20: 43916 Segmentation fault      (core dumped) ${entry} --gtest_output="xml:${entry##*/}.xml"
[  288s] ~/rpmbuild/BUILD/nnstreamer-1.7.1
[  288s] error: Bad exit status from /var/tmp/rpm-tmp.AZB6vD (%build)
[  288s] 
[  288s] 
[  288s] RPM build errors:
[  288s]     Bad exit status from /var/tmp/rpm-tmp.AZB6vD (%build)
[  288s] 
[  288s] ip-172-31-27-164 failed "build nnstreamer.spec" at Thu Dec 17 01:03:37 UTC 2020.
[  288s] 
&lt;/denchmark-code&gt;

	</description>
	<comments>
		<comment id='1' author='dongju-chae' date='2020-12-17T01:11:06Z'>
		 : Thank you for posting issue &lt;denchmark-link:https://github.com/nnstreamer/nnstreamer/issues/2959&gt;#2959&lt;/denchmark-link&gt;
. The person in charge will reply soon.
		</comment>
		<comment id='2' author='dongju-chae' date='2020-12-18T03:50:54Z'>
		Uh.. I think this is related to timed out and we may have to wait until invoke_thread is finished.
		</comment>
		<comment id='3' author='dongju-chae' date='2020-12-18T03:56:08Z'>
		Here is the callstack reported by valgrind
&lt;denchmark-code&gt;[  112s] [ RUN      ] nnstreamer_capi_singleshot.parallel_runs
[  113s] ** Message: 03:12:57.030: accl = cpu
[  113s] ** Message: 03:12:57.400: accl = cpu
[  117s] ** Message: 03:13:01.341: accl = cpu
[  119s] ** Message: 03:13:03.533: accl = cpu
[  128s] ** Message: 03:13:12.872: accl = cpu
[  128s] ** Message: 03:13:12.931: accl = cpu
[  132s] ** Message: 03:13:16.742: accl = cpu
[  138s] ** Message: 03:13:22.528: accl = cpu
[  143s] ** Message: 03:13:27.506: accl = cpu
[  155s] ==23565== Thread 3:
[  155s] ==23565== Invalid read of size 8
[  155s] ==23565==    at 0x8B24D27: TFLiteInterpreter::invoke(GstTensorMemory const*, GstTensorMemory*) (tensor_filter_tensorflow_lite.cc:263)
[  155s] ==23565==    by 0x8B24E2D: TFLiteCore::invoke(GstTensorMemory const*, GstTensorMemory*) (tensor_filter_tensorflow_lite.cc:881)
[  155s] ==23565==    by 0x4A3C22: g_tensor_filter_single_invoke (tensor_filter_single.c:333)
[  155s] ==23565==    by 0x4A201F: __invoke (nnstreamer-capi-single.c:240)
[  155s] ==23565==    by 0x4A201F: invoke_thread (nnstreamer-capi-single.c:316)
[  155s] ==23565==    by 0x492E1D4: ??? (in /usr/lib64/libglib-2.0.so.0.6200.3)
[  155s] ==23565==    by 0x4C5FE53: start_thread (pthread_create.c:479)
[  155s] ==23565==    by 0x4FEB7BE: clone (clone.S:95)
[  155s] ==23565==  Address 0x87d3118 is 8 bytes inside a block of size 272 free'd
[  155s] ==23565==    at 0x48379AB: free (in /usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)
[  155s] ==23565==    by 0x4A018D: ml_tensors_data_destroy (nnstreamer-capi-util.c:584)
[  155s] ==23565==    by 0x45C282: single_shot_loop_test(void*) (unittest_tizen_capi.cc:147)
[  155s] ==23565==    by 0x4C5FE53: start_thread (pthread_create.c:479)
[  155s] ==23565==    by 0x4FEB7BE: clone (clone.S:95)
[  155s] ==23565==  Block was alloc'd at
[  155s] ==23565==    at 0x4838B65: calloc (in /usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)
[  155s] ==23565==    by 0x490A0C8: g_malloc0 (in /usr/lib64/libglib-2.0.so.0.6200.3)
[  155s] ==23565==    by 0x4A0220: ml_tensors_data_create_no_alloc (nnstreamer-capi-util.c:608)
[  155s] ==23565==    by 0x4A03E9: ml_tensors_data_create (nnstreamer-capi-util.c:682)
[  155s] ==23565==    by 0x45C017: single_shot_loop_test(void*) (unittest_tizen_capi.cc:124)
[  155s] ==23565==    by 0x4C5FE53: start_thread (pthread_create.c:479)
[  155s] ==23565==    by 0x4FEB7BE: clone (clone.S:95)
&lt;/denchmark-code&gt;

		</comment>
	</comments>
</bug>