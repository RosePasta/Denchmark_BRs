<bug id='6990' author='Jazzinghen' open_date='2016-07-26T07:47:22Z' closed_time='2019-09-26T18:33:03Z'>
	<summary>No Intel SIMD extensions guards</summary>
	<description>
&lt;denchmark-h:h5&gt;System information (version)&lt;/denchmark-h&gt;


OpenCV =&gt; 3.1.0
Operating System / Platform =&gt; Ubuntu Linux 16.04 - 64bit
Compiler =&gt; gcc 5.4
Processors used =&gt; Intel i3-2120 and Intel i7-6700

&lt;denchmark-h:h5&gt;Detailed description&lt;/denchmark-h&gt;

It is not possible to build OpenCV with multiple Intel SIMD instructions and run it on machines that do not support the latest SIMD set enabled.
This requires multiple versions of OpenCV shared libraries to be built and provided with projects that uses them.
&lt;denchmark-h:h5&gt;Steps to reproduce&lt;/denchmark-h&gt;

Build OpenCV enabling AVX2 or SSE4.2 and then run it on a machine that does not have these SIMD extensions.
	</description>
	<comments>
		<comment id='1' author='Jazzinghen' date='2016-07-26T09:12:41Z'>
		As far as I know, there are many SIMD guards, but not all SIMD.
I honestly like to know which module/function was causing the trouble by SIMD that you experienced.
I know there are still some unguarded SIMD part, but it's difficult to search for me, since my laptop supports AVX and SSE4.2.
		</comment>
		<comment id='2' author='Jazzinghen' date='2016-07-26T09:38:24Z'>
		The first problem I have encountered (I did not check further due to my application throwing a ) was in cv::initInterTab2D. &lt;denchmark-link:https://gist.github.com/Jazzinghen/049f5c3ca01b7035e1b135c0088b4020&gt;Here is the disassembly dump&lt;/denchmark-link&gt;
 of the function (sorry for the "press enter to continue" lines). If you check around line 203 you can see a  operation, which should be AVX2 or AVX-512.
		</comment>
		<comment id='3' author='Jazzinghen' date='2016-08-02T11:54:32Z'>
		Looks like this instruction is generated by compiler.
Current guard pattern for optimization blocks doesn't work. Using of SIMD instructions should be disabled outside of optimization blocks.
Related &lt;denchmark-link:https://github.com/opencv/opencv/issues/6466&gt;#6466&lt;/denchmark-link&gt;

		</comment>
		<comment id='4' author='Jazzinghen' date='2016-08-11T09:05:07Z'>
		The proper way of doing things is to split optimizations into several source files:

AVX - compiled with AVX flags
SSE - compiled with SSE flags
Common implementation - compiled with "default" flags. This translation unit checks whether the processor has AVX, SSE support and invokes functions from AVX / SSE sources accordingly.

		</comment>
		<comment id='5' author='Jazzinghen' date='2019-09-26T17:59:15Z'>
		is that still actual?
		</comment>
		<comment id='6' author='Jazzinghen' date='2019-09-26T18:33:02Z'>
		resolved by &lt;denchmark-link:https://github.com/opencv/opencv/pull/7462&gt;#7462&lt;/denchmark-link&gt;
 and corresponding patches (OpenCV 3.2+)
Wiki page: &lt;denchmark-link:https://github.com/opencv/opencv/wiki/CPU-optimizations-build-options&gt;https://github.com/opencv/opencv/wiki/CPU-optimizations-build-options&lt;/denchmark-link&gt;

		</comment>
	</comments>
</bug>