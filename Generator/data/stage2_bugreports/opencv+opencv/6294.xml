<bug id='6294' author='mvukad' open_date='2016-03-17T22:03:16Z' closed_time='2016-04-12T13:26:38Z'>
	<summary>StatModel objects not written to file correctly</summary>
	<description>
StatModel objects can't be properly written to file using write() method. This applies to all of the machine learning objects inherited from StatModel: RTrees, Boost, etc.
&lt;denchmark-h:h3&gt;Please state the information for your system&lt;/denchmark-h&gt;


OpenCV version: 3.1
Host OS: Windows 7
Compiler: VS2015

&lt;denchmark-h:h3&gt;In which part of the OpenCV library you got the issue?&lt;/denchmark-h&gt;


ml
load/save of objects derived from StatModel (RTrees, Boost, etc.)

&lt;denchmark-h:h3&gt;Expected behaviour&lt;/denchmark-h&gt;

One should be able to save an object derived from StatModel to file using either the save() or write() method and then read the file to recover the same object.
&lt;denchmark-h:h3&gt;Actual behaviour&lt;/denchmark-h&gt;

The save() method adds a field named "format" to the saved file whereas write() does not. When loading the object from file, if the "format" field is not present, the file will be assumed to be in legacy format and the object will not be properly loaded.
When comparing XML files generated by save() and write() one will see a line containing &lt;format&gt;3&lt;/format&gt; in the former but not the latter.
&lt;denchmark-h:h3&gt;Additional description&lt;/denchmark-h&gt;

The problem lies in the Algorithm::save() method. The 3rd line adds the "format" field to the file however this line really needs to go in the write() method so that a user can call write() directly.
&lt;denchmark-code&gt;void Algorithm::save(const String&amp; filename) const
{
    FileStorage fs(filename, FileStorage::WRITE);
    fs &lt;&lt; getDefaultName() &lt;&lt; "{";
    fs &lt;&lt; "format" &lt;&lt; (int)3; // This line needs to go in write()
    write(fs);
    fs &lt;&lt; "}";
}
&lt;/denchmark-code&gt;

&lt;denchmark-h:h3&gt;Code example to reproduce the issue / Steps to reproduce the issue&lt;/denchmark-h&gt;

&lt;denchmark-code&gt;#include "opencv2/opencv.hpp"

using namespace cv;
using namespace cv::ml;

int main()
{
    Ptr&lt;RTrees&gt; rtrees = RTrees::create();

    ... // initialize and train

    rtrees-&gt;save("RTrees1.xml");

    FileStorage fs("Rtrees2.xml", FileStorage::WRITE);
    fs &lt;&lt; "opencv_ml_rtrees" &lt;&lt; "{";
    rtrees-&gt;write(fs);
    fs &lt;&lt; "}";

    return 0;
}
&lt;/denchmark-code&gt;

	</description>
	<comments>
	</comments>
</bug>