<bug id='369' author='jinggaizi' open_date='2020-12-25T10:39:45Z' closed_time='2021-01-05T15:37:59Z'>
	<summary>installing with vcpkg failed</summary>
	<description>
&lt;denchmark-h:h3&gt;Question&lt;/denchmark-h&gt;

i install flashlight-cuda with vcpkg successfully, but intall flashlight-cuda[asr] failed in step [180/183]
&lt;denchmark-h:h4&gt;Additional Context&lt;/denchmark-h&gt;

[180/183] : &amp;&amp; /opt/rh/devtoolset-6/root/usr/bin/g++  -std=gnu++0x -fPIC -g  CMakeFiles/fl_asr_test.dir/flashlight/app/asr/Test.cpp.o -o bin/asr/fl_asr_test -L/opt/intel/mkl/lib/intel64   -L/usr/local/cuda-10.1/targets/x86_64-linux/lib/stubs   -L/usr/local/cuda-10.1/targets/x86_64-linux/lib -Wl,-rpath,/opt/intel/mkl/lib/intel64:/search/odin/jingbojun/exp/vcpkg/packages/arrayfire_x64-linux/lib:/search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib:/search/odin/jingbojun/exp/vcpkg/installed/x64-linux/lib:  libflashlight-app-asr.a  -ldl  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/lib/libgflags.a  libflashlight.a  libfl-libraries.a  -lmkl_gf_lp64  -lmkl_sequential  -lmkl_core  /usr/lib64/libm.so  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libfftw3.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libkenlm.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libkenlm_util.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/liblzmad.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libbz2d.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libz.a  /search/odin/jingbojun/exp/vcpkg/packages/arrayfire_x64-linux/lib/libafcuda.so.3.7.3  -pthread  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/lib/libcudnn.so  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libmpi.so  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/lib/libnccl.so  /usr/local/cuda-10.1/lib64/libcudart_static.a  -ldl  -lpthread  /usr/lib64/librt.so  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libsndfile.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libvorbisenc.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libvorbis.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libFLAC.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libogg.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libopus.a  -lm  -lcudadevrt  -lcudart_static  -lrt  -lpthread  -ldl &amp;&amp; :
FAILED: bin/asr/fl_asr_test
: &amp;&amp; /opt/rh/devtoolset-6/root/usr/bin/g++  -std=gnu++0x -fPIC -g  CMakeFiles/fl_asr_test.dir/flashlight/app/asr/Test.cpp.o -o bin/asr/fl_asr_test -L/opt/intel/mkl/lib/intel64   -L/usr/local/cuda-10.1/targets/x86_64-linux/lib/stubs   -L/usr/local/cuda-10.1/targets/x86_64-linux/lib -Wl,-rpath,/opt/intel/mkl/lib/intel64:/search/odin/jingbojun/exp/vcpkg/packages/arrayfire_x64-linux/lib:/search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib:/search/odin/jingbojun/exp/vcpkg/installed/x64-linux/lib:  libflashlight-app-asr.a  -ldl  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/lib/libgflags.a  libflashlight.a  libfl-libraries.a  -lmkl_gf_lp64  -lmkl_sequential  -lmkl_core  /usr/lib64/libm.so  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libfftw3.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libkenlm.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libkenlm_util.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/liblzmad.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libbz2d.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libz.a  /search/odin/jingbojun/exp/vcpkg/packages/arrayfire_x64-linux/lib/libafcuda.so.3.7.3  -pthread  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/lib/libcudnn.so  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libmpi.so  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/lib/libnccl.so  /usr/local/cuda-10.1/lib64/libcudart_static.a  -ldl  -lpthread  /usr/lib64/librt.so  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libsndfile.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libvorbisenc.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libvorbis.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libFLAC.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libogg.a  /search/odin/jingbojun/exp/vcpkg/installed/x64-linux/debug/lib/libopus.a  -lm  -lcudadevrt  -lcudart_static  -lrt  -lpthread  -ldl &amp;&amp; :
CMakeFiles/fl_asr_test.dir/flashlight/app/asr/Test.cpp.o: In function main': /search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/Test.cpp:42: undefined reference to google::SetUsageMessage(std::string const&amp;)'
/search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/Test.cpp:53: undefined reference to google::ReadFromFlagsFile(std::string const&amp;, char const*, bool)' /search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/Test.cpp:85: undefined reference to google::ReadFlagsFromString(std::string const&amp;, char const*, bool)'
/search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/Test.cpp:90: undefined reference to google::ReadFromFlagsFile(std::string const&amp;, char const*, bool)' libflashlight-app-asr.a(Defines.cpp.o): In function fl::app::asr::handleDeprecatedFlags()':
/search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/common/Defines.cpp:426: undefined reference to google::GetCommandLineOption(char const*, std::string*)' /search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/common/Defines.cpp:446: undefined reference to google::SetCommandLineOption(char const*, char const*)'
libflashlight-app-asr.a(Defines.cpp.o): In function __static_initialization_and_destruction_0(int, int)': /search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/common/Defines.cpp:21: undefined reference to google::FlagRegisterer::FlagRegistererstd::string(char const*, char const*, char const*, std::string*, std::string*)'
/search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/common/Defines.cpp:22: undefined reference to google::FlagRegisterer::FlagRegisterer&lt;std::string&gt;(char const*, char const*, char const*, std::string*, std::string*)' /search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/common/Defines.cpp:23: undefined reference to google::FlagRegisterer::FlagRegistererstd::string(char const*, char const*, char const*, std::string*, std::string*)'
/search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/common/Defines.cpp:29: undefined reference to google::FlagRegisterer::FlagRegisterer&lt;std::string&gt;(char const*, char const*, char const*, std::string*, std::string*)' /search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/common/Defines.cpp:32: undefined reference to google::FlagRegisterer::FlagRegistererstd::string(char const*, char const*, char const*, std::string*, std::string*)'
libflashlight-app-asr.a(Defines.cpp.o):/search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/common/Defines.cpp:38: more undefined references to google::FlagRegisterer::FlagRegisterer&lt;std::string&gt;(char const*, char const*, char const*, std::string*, std::string*)' follow libflashlight-app-asr.a(Helpers.cpp.o): In function fl::app::asr::serializeGflags(std::string const&amp;)':
/search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/runtime/Helpers.cpp:94: undefined reference to google::GetCommandLineOption(char const*, std::string*)' libflashlight-app-asr.a(ctc_entrypoint.cu.o): In function CpuCTC::CpuCTC(int, int, void*, int, int)':
/search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/third_party/warpctc/include/detail/cpu_ctc.h:28: undefined reference to omp_set_num_threads' /search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/app/asr/third_party/warpctc/include/detail/cpu_ctc.h:30: undefined reference to omp_get_max_threads'
libfl-libraries.a(PowerSpectrum.cpp.o): In function fl::lib::audio::PowerSpectrum::batchApply(std::vector&lt;float, std::allocator&lt;float&gt; &gt; const&amp;, int)': /search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/lib/audio/feature/PowerSpectrum.cpp:101: undefined reference to GOMP_parallel'
libfl-libraries.a(PowerSpectrum.cpp.o): In function fl::lib::audio::PowerSpectrum::batchApply(std::vector&lt;float, std::allocator&lt;float&gt; &gt; const&amp;, int) [clone ._omp_fn.0]': /search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/lib/audio/feature/PowerSpectrum.cpp:102: undefined reference to omp_get_num_threads'
/search/odin/jingbojun/exp/vcpkg/buildtrees/flashlight-cuda/src/4bc14022f7-7b8557c63e.clean/flashlight/lib/audio/feature/PowerSpectrum.cpp:102: undefined reference to omp_get_thread_num' /search/odin/jingbojun/exp/vcpkg/packages/arrayfire_x64-linux/lib/libafcuda.so.3.7.3: undefined reference to spdlog::logger::err_handler_(std::string const&amp;)'
/search/odin/jingbojun/exp/vcpkg/packages/arrayfire_x64-linux/lib/libafcuda.so.3.7.3: undefined reference to spdlog::get(std::string const&amp;)' /search/odin/jingbojun/exp/vcpkg/packages/arrayfire_x64-linux/lib/libafcuda.so.3.7.3: undefined reference to std::shared_ptrspdlog::logger spdlog::stdout_logger_mtspdlog::synchronous_factory(std::string const&amp;)'
/search/odin/jingbojun/exp/vcpkg/packages/arrayfire_x64-linux/lib/libafcuda.so.3.7.3: undefined reference to spdlog::logger::set_pattern(std::string, spdlog::pattern_time_type)' /search/odin/jingbojun/exp/vcpkg/packages/arrayfire_x64-linux/lib/libafcuda.so.3.7.3: undefined reference to fmt::v7::detail::vformat(fmt::v7::basic_string_view, fmt::v7::format_args)'
collect2: error: ld returned 1 exit status
other failed steps is similar ,how can i solve it?
	</description>
	<comments>
		<comment id='1' author='jinggaizi' date='2020-12-28T17:09:00Z'>
		&lt;denchmark-link:https://github.com/jinggaizi&gt;@jinggaizi&lt;/denchmark-link&gt;
 — can you give me some more information about your platform (CMake version, compiler, and OS?)
		</comment>
		<comment id='2' author='jinggaizi' date='2020-12-28T21:02:36Z'>
		&lt;denchmark-link:https://github.com/jacobkahn&gt;@jacobkahn&lt;/denchmark-link&gt;
 I am facing similar issue.  I tried installing imgclass and asr, separately. But, only imgclass can be installed without error. My OS is linux mint 20.04. The cmake version is 3.16.3. I have both g++9 and g++8 in my system. And g++8 is the default compiler sat by command . Following is an error example from dbg-out.log.

		</comment>
		<comment id='3' author='jinggaizi' date='2020-12-28T21:07:05Z'>
		&lt;denchmark-link:https://github.com/SamChen&gt;@SamChen&lt;/denchmark-link&gt;
 &lt;denchmark-link:https://github.com/jinggaizi&gt;@jinggaizi&lt;/denchmark-link&gt;
 — thanks for reporting - I'll send a PR today to update the port. I've seen these  linker issues before, and I sent a fix in master a few days ago. Sorry about this.
I'm not sure exactly what &lt;denchmark-link:https://github.com/SamChen&gt;@SamChen&lt;/denchmark-link&gt;
's issue is given that the compiler dies so quickly, but I suspect it's similar given the failure is also around . Hopefully it's not a problem with a downstream dependency — let me do some digging with a repro of your environment.
		</comment>
		<comment id='4' author='jinggaizi' date='2020-12-29T17:47:28Z'>
		&lt;denchmark-link:https://github.com/SamChen&gt;@SamChen&lt;/denchmark-link&gt;
 / &lt;denchmark-link:https://github.com/jinggaizi&gt;@jinggaizi&lt;/denchmark-link&gt;
: I'm actually unable to repro because I don't have a machine with new-enough CUDA drivers on it to install a version of  that supports compiling with  
Drivers should be updated in the next week or two. I'll be sending updated port PRs to vcpkg shortly which might fix these issues in the mean time -- otherwise, I'll try to repro again next week.
		</comment>
		<comment id='5' author='jinggaizi' date='2020-12-31T03:08:29Z'>
		thanks for your reply, my os is Centos 7, The cmake version is 3.18.2, gcc=7.3.0. finally i install flashlight in docker
		</comment>
		<comment id='6' author='jinggaizi' date='2020-12-31T13:50:58Z'>
		&lt;denchmark-link:https://github.com/SamChen&gt;@SamChen&lt;/denchmark-link&gt;
 were you able to give the updated vcpkg port another try?
		</comment>
		<comment id='7' author='jinggaizi' date='2021-01-05T15:37:59Z'>
		Closing due to inactivity -- these issues should be resolved as per the most recent Flashlight vcpkg port update.
		</comment>
	</comments>
</bug>