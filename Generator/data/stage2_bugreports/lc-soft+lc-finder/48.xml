<bug id='48' author='Yana-Hangabina' open_date='2017-04-22T04:49:39Z' closed_time='2019-03-10T12:53:07Z'>
	<summary>图片太多扫描崩溃</summary>
	<description>
先崩溃后闪退
	</description>
	<comments>
		<comment id='1' author='Yana-Hangabina' date='2017-04-22T04:52:51Z'>
		大约有多少张？
		</comment>
		<comment id='2' author='Yana-Hangabina' date='2017-04-22T06:47:36Z'>
		116,484 个文件，1,210 个文件夹
		</comment>
		<comment id='3' author='Yana-Hangabina' date='2017-04-22T06:57:49Z'>
		扫描时的内存占用情况如何？
		</comment>
		<comment id='4' author='Yana-Hangabina' date='2017-04-22T07:01:44Z'>
		我最多只能测试 3W 多张图片。
&lt;denchmark-link:https://cloud.githubusercontent.com/assets/1730073/25302242/8a0aad78-276c-11e7-96bf-8e6861ef2e9f.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='5' author='Yana-Hangabina' date='2017-04-22T11:04:21Z'>
		最好能提供程序崩溃时的函数调用栈和相关变量的信息。
		</comment>
		<comment id='6' author='Yana-Hangabina' date='2017-04-22T13:08:56Z'>
		崩溃时内存占用1880MB, 最好提供64位的二进制文件.
		</comment>
		<comment id='7' author='Yana-Hangabina' date='2017-04-22T13:32:52Z'>
		&lt;denchmark-link:https://github.com/ReinForce-II&gt;@ReinForce-II&lt;/denchmark-link&gt;
 这是内存泄漏问题，崩溃前都做了哪些操作？
		</comment>
		<comment id='8' author='Yana-Hangabina' date='2017-04-22T13:34:32Z'>
		添加图片目录 刷新 崩了
		</comment>
		<comment id='9' author='Yana-Hangabina' date='2017-04-22T13:35:32Z'>
		&lt;denchmark-link:https://github.com/ReinForce-II&gt;@ReinForce-II&lt;/denchmark-link&gt;
 如果有 VisualStudio 的话，试试调试模式运行它，看它在哪段代码崩溃的。
		</comment>
		<comment id='10' author='Yana-Hangabina' date='2017-04-22T13:40:02Z'>
		Access violation reading location 0x00000014
我这没法生成调试符号没法确定是哪行代码崩的
具体而言是向下滚动查看缩略图的时候内存占用急剧上升（每行缩略图上升约100MB  直到接近2GB上限崩溃
		</comment>
		<comment id='11' author='Yana-Hangabina' date='2017-04-22T13:50:05Z'>
		&lt;denchmark-link:https://github.com/ReinForce-II&gt;@ReinForce-II&lt;/denchmark-link&gt;

对于这个内存泄漏问题，你可以试试用性能探查器，每隔一段时间点击生成快照，等差不多的时候关闭程序，然后生成报告。
&lt;denchmark-link:https://cloud.githubusercontent.com/assets/1730073/25304979/3035189a-27a5-11e7-8749-ccc044c15ad2.png&gt;&lt;/denchmark-link&gt;

&lt;denchmark-link:https://cloud.githubusercontent.com/assets/1730073/25304984/3edbe590-27a5-11e7-84b4-948e8ea934fe.png&gt;&lt;/denchmark-link&gt;

把内存占用最多的那一块截图贴上来，类似于这样：
&lt;denchmark-link:https://cloud.githubusercontent.com/assets/1730073/25305001/867c15d2-27a5-11e7-8f75-beddede8e238.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='12' author='Yana-Hangabina' date='2017-04-22T13:52:43Z'>
		用 Debug 配置编译后应该会生成用于调试的符号文件 pdb 才对。
		</comment>
		<comment id='13' author='Yana-Hangabina' date='2017-04-22T13:56:05Z'>
		每行缩略图上升约100MB，这内存占用速度，即使生成缩略图后不释放原图也占用不了这么多内存。
		</comment>
		<comment id='14' author='Yana-Hangabina' date='2017-04-22T14:00:50Z'>
		&lt;denchmark-link:https://cloud.githubusercontent.com/assets/20750215/25305060/221fc3d4-27a7-11e7-912a-94323c8b076e.png&gt;&lt;/denchmark-link&gt;

		</comment>
		<comment id='15' author='Yana-Hangabina' date='2017-04-22T14:48:34Z'>
		&lt;denchmark-link:https://github.com/ReinForce-II&gt;@ReinForce-II&lt;/denchmark-link&gt;
 你这居然一点符号信息都没有，而且剩下的 1G 多的内存都未追踪到。
		</comment>
		<comment id='16' author='Yana-Hangabina' date='2017-04-22T15:08:45Z'>
		我这边环境的关系很难生成调试符号去搞
表面上能看出问题的地方就是 引起内存占用急剧上升的那些行都含有生成缩略图失败(?)  缩略图被显示为问号的图片  需要对应的原图吗
		</comment>
		<comment id='17' author='Yana-Hangabina' date='2017-04-23T02:48:12Z'>
		未扫描占用内存13MB，扫描过程中显示已扫描20多万，内存429.1MB，然后已扫描又掉到11万涨到140727，内存429.1然后就卡住不动了
		</comment>
		<comment id='18' author='Yana-Hangabina' date='2017-04-23T03:02:48Z'>
		还有一个问题就是我删掉了图片总文件夹，然后在私密里添加了一个子文件夹，同步成功后，关掉重新打开：第一次，我还没解锁私密文件夹，集锦里面就全部都是私密文件夹里的图片，内存占用1.2G，设置里面源文件选项神奇消失，缓存占用2.7MB；第二次，关掉重开，集锦里仍然有私密里的照片，上面的绿条还没跑完内存占用就一路飙到了1.8G，然后崩溃
		</comment>
		<comment id='19' author='Yana-Hangabina' date='2017-04-23T03:04:44Z'>
		&lt;denchmark-link:https://github.com/ReinForce-II&gt;@ReinForce-II&lt;/denchmark-link&gt;
 是 jpg 格式的吗？jpg 图片有些无法正常读取，之前我也处理过类似问题，图片读取失败后没释放资源，导致内存飙升。
		</comment>
		<comment id='20' author='Yana-Hangabina' date='2017-04-23T03:08:42Z'>
		@yyyyyyyhb 好吧，到时候我先用 3W 多图片测试几遍。
		</comment>
		<comment id='21' author='Yana-Hangabina' date='2017-04-23T03:39:25Z'>
		&lt;denchmark-link:https://github.com/lc-soft&gt;@lc-soft&lt;/denchmark-link&gt;
 那就是这个问题没错了
		</comment>
		<comment id='22' author='Yana-Hangabina' date='2017-04-23T10:23:30Z'>
		是jpg没错，文件夹里也的确有问号的
		</comment>
		<comment id='23' author='Yana-Hangabina' date='2019-03-10T12:53:07Z'>
		稍微做了点优化，测试显示四万张图片，内存占用 493.6MB，界面帧数较低，但运行正常。
&lt;denchmark-link:https://user-images.githubusercontent.com/1730073/54085210-5901c180-4376-11e9-8504-c43673bf084b.png&gt;&lt;/denchmark-link&gt;

		</comment>
	</comments>
</bug>