<bug id='4061' author='iRazvan' open_date='2017-09-13T12:34:10Z' closed_time='2017-12-31T10:40:54Z'>
	<summary>Predict on new image on Android error</summary>
	<description>
Hi, following my older issue (&lt;denchmark-link:https://github.com/deeplearning4j/deeplearning4j/issues/4005&gt;https://github.com/deeplearning4j/deeplearning4j/issues/4005&lt;/denchmark-link&gt;
) I have successfully loaded my saved model on Android. The input for my model is a 160x48 pixels, 3 channel image and I am having issues predicting on new images.
I use DL4J version: 0.9.1 on Android.
The code I have tried for predictions is the following:
&lt;denchmark-code&gt;    Bitmap bmp = getBitmapFromAsset("test.png");
    imageView.setImageBitmap(bmp);
    float[] data = rgbValuesFromBitmap2(bmp);

    INDArray input = new NDArray(data);
    INDArray output = network.output(input);  
    for (int i = 0; i &lt; output.lengthLong(); i++) {
        Log.e("aaaa", "predict: " + output.getDouble(i));
    }
&lt;/denchmark-code&gt;

RGB method simply copies the pixel values from the bitmap into an array (the method is similar to this one: &lt;denchmark-link:https://stackoverflow.com/questions/5669501/how-do-you-get-the-rgb-values-from-a-bitmap-on-an-android-device&gt;https://stackoverflow.com/questions/5669501/how-do-you-get-the-rgb-values-from-a-bitmap-on-an-android-device&lt;/denchmark-link&gt;
, but it returns a float array).
Crashes at network.output:
&lt;denchmark-code&gt;09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65] JNI DETECTED ERROR IN APPLICATION: negative buffer capacity: -4
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]     in call to NewDirectByteBuffer
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]     from java.nio.ByteBuffer org.bytedeco.javacpp.Pointer.asDirectBuffer()
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65] "main" prio=5 tid=1 Runnable
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | group="main" sCount=0 dsCount=0 obj=0x7766de98 self=0xf4c28000
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | sysTid=10764 nice=0 cgrp=default sched=0/0 handle=0xf76a5bec
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | state=R schedstat=( 0 0 0 ) utm=6796 stm=56 core=6 HZ=100
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | stack=0xff296000-0xff298000 stackSize=8MB
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | held mutexes= "mutator lock"(shared held)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #00 pc 00004e64  /system/lib/libbacktrace_libc++.so (UnwindCurrent::Unwind(unsigned int, ucontext*)+23)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #01 pc 00003665  /system/lib/libbacktrace_libc++.so (Backtrace::Unwind(unsigned int, ucontext*)+8)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #02 pc 00271451  /system/lib/libart.so (art::DumpNativeStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;, int, char const*, art::mirror::ArtMethod*)+84)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #03 pc 002534c7  /system/lib/libart.so (art::Thread::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;) const+158)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #04 pc 000b7f5b  /system/lib/libart.so (art::JniAbort(char const*, char const*)+610)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #05 pc 000b8681  /system/lib/libart.so (art::JniAbortF(char const*, char const*, ...)+68)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #06 pc 001b4ba5  /system/lib/libart.so (art::JNI::NewDirectByteBuffer(_JNIEnv*, void*, long long)+164)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #07 pc 000c72b7  /system/lib/libart.so (art::CheckJNI::NewDirectByteBuffer(_JNIEnv*, void*, long long)+90)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #08 pc 000a93d1  /system/lib/libart.so (art_quick_generic_jni_trampoline+32)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #09 pc 001ffa45  /system/lib/libart.so (art::mirror::ArtMethod::Invoke(art::Thread*, unsigned int*, unsigned int, art::JValue*, char const*)+152)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.Pointer.asDirectBuffer(Native method)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.Pointer.asByteBuffer(Pointer.java:667)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.FloatPointer.asBuffer(FloatPointer.java:140)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:76)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:64)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:51)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.api.buffer.BaseDataBuffer.&lt;init&gt;(BaseDataBuffer.java:588)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.api.buffer.FloatBuffer.&lt;init&gt;(FloatBuffer.java:65)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.api.buffer.factory.DefaultDataBufferFactory.createFloat(DefaultDataBufferFactory.java:260)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.factory.Nd4j.createBuffer(Nd4j.java:1468)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.api.ndarray.BaseNDArray.&lt;init&gt;(BaseNDArray.java:260)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.cpu.nativecpu.NDArray.&lt;init&gt;(NDArray.java:122)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.cpu.nativecpu.CpuNDArrayFactory.createUninitialized(CpuNDArrayFactory.java:267)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.factory.Nd4j.createUninitialized(Nd4j.java:5054)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.api.shape.Shape.toOffsetZeroCopyHelper(Shape.java:247)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.api.shape.Shape.toOffsetZeroCopy(Shape.java:204)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.api.ndarray.BaseNDArray.dup(BaseNDArray.java:1702)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.nd4j.linalg.ops.transforms.Transforms.sqrt(Transforms.java:928)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.layers.normalization.BatchNormalization.preOutput(BatchNormalization.java:285)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.layers.normalization.BatchNormalization.activate(BatchNormalization.java:232)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.layers.AbstractLayer.activate(AbstractLayer.java:309)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.activationFromPrevLayer(MultiLayerNetwork.java:789)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForwardToLayer(MultiLayerNetwork.java:929)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:870)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:861)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.silentOutput(MultiLayerNetwork.java:1906)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1898)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1871)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1952)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at al.omid.tfdroid.MainActivity.onCreate(MainActivity.java:128)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.Activity.performCreate(Activity.java:6500)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1120)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3072)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3218)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.access$1000(ActivityThread.java:198)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1676)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.os.Handler.dispatchMessage(Handler.java:102)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.os.Looper.loop(Looper.java:145)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.main(ActivityThread.java:6837)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at java.lang.reflect.Method.invoke!(Native method)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at java.lang.reflect.Method.invoke(Method.java:372)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:1404)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1199)
09-13 15:25:21.842 10764-10764/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65] 
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292] Runtime aborting...
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292] Aborting thread:
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292] "main" prio=5 tid=1 Native
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   | group="" sCount=0 dsCount=0 obj=0x7766de98 self=0xf4c28000
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   | sysTid=10764 nice=0 cgrp=default sched=0/0 handle=0xf76a5bec
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   | state=R schedstat=( 0 0 0 ) utm=6797 stm=56 core=6 HZ=100
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   | stack=0xff296000-0xff298000 stackSize=8MB
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   | held mutexes= "abort lock" "mutator lock"(shared held)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #00 pc 00004e64  /system/lib/libbacktrace_libc++.so (UnwindCurrent::Unwind(unsigned int, ucontext*)+23)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #01 pc 00003665  /system/lib/libbacktrace_libc++.so (Backtrace::Unwind(unsigned int, ucontext*)+8)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #02 pc 00271451  /system/lib/libart.so (art::DumpNativeStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;, int, char const*, art::mirror::ArtMethod*)+84)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #03 pc 002534c7  /system/lib/libart.so (art::Thread::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;) const+158)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #04 pc 00241951  /system/lib/libart.so (art::AbortState::DumpThread(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;, art::Thread*)+32)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #05 pc 00242337  /system/lib/libart.so (art::AbortState::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;)+410)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #06 pc 002424f7  /system/lib/libart.so (art::Runtime::Abort()+82)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #07 pc 000ad891  /system/lib/libart.so (art::LogMessage::~LogMessage()+1360)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #08 pc 000b8147  /system/lib/libart.so (art::JniAbort(char const*, char const*)+1102)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #09 pc 000b8681  /system/lib/libart.so (art::JniAbortF(char const*, char const*, ...)+68)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #10 pc 001b4ba5  /system/lib/libart.so (art::JNI::NewDirectByteBuffer(_JNIEnv*, void*, long long)+164)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #11 pc 000c72b7  /system/lib/libart.so (art::CheckJNI::NewDirectByteBuffer(_JNIEnv*, void*, long long)+90)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #12 pc 000a93d1  /system/lib/libart.so (art_quick_generic_jni_trampoline+32)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #13 pc 001ffa45  /system/lib/libart.so (art::mirror::ArtMethod::Invoke(art::Thread*, unsigned int*, unsigned int, art::JValue*, char const*)+152)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.Pointer.asDirectBuffer(Native method)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.Pointer.asByteBuffer(Pointer.java:667)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.FloatPointer.asBuffer(FloatPointer.java:140)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:76)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:64)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:51)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.buffer.BaseDataBuffer.&lt;init&gt;(BaseDataBuffer.java:588)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.buffer.FloatBuffer.&lt;init&gt;(FloatBuffer.java:65)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.buffer.factory.DefaultDataBufferFactory.createFloat(DefaultDataBufferFactory.java:260)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.factory.Nd4j.createBuffer(Nd4j.java:1468)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.ndarray.BaseNDArray.&lt;init&gt;(BaseNDArray.java:260)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.cpu.nativecpu.NDArray.&lt;init&gt;(NDArray.java:122)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.cpu.nativecpu.CpuNDArrayFactory.createUninitialized(CpuNDArrayFactory.java:267)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.factory.Nd4j.createUninitialized(Nd4j.java:5054)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.shape.Shape.toOffsetZeroCopyHelper(Shape.java:247)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.shape.Shape.toOffsetZeroCopy(Shape.java:204)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.ndarray.BaseNDArray.dup(BaseNDArray.java:1702)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.ops.transforms.Transforms.sqrt(Transforms.java:928)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.layers.normalization.BatchNormalization.preOutput(BatchNormalization.java:285)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.layers.normalization.BatchNormalization.activate(BatchNormalization.java:232)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.layers.AbstractLayer.activate(AbstractLayer.java:309)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.activationFromPrevLayer(MultiLayerNetwork.java:789)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForwardToLayer(MultiLayerNetwork.java:929)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:870)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:861)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.silentOutput(MultiLayerNetwork.java:1906)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1898)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1871)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1952)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at al.omid.tfdroid.MainActivity.onCreate(MainActivity.java:128)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.Activity.performCreate(Activity.java:6500)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1120)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3072)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3218)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.ActivityThread.access$1000(ActivityThread.java:198)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1676)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.os.Handler.dispatchMessage(Handler.java:102)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.os.Looper.loop(Looper.java:145)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.ActivityThread.main(ActivityThread.java:6837)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at java.lang.reflect.Method.invoke!(Native method)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at java.lang.reflect.Method.invoke(Method.java:372)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:1404)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1199)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292] Dumping all threads without appropriate locks held: thread list lock mutator lock
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292] All threads:
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292] DALVIK THREADS (13):
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292] "main" prio=5 tid=1 Native
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   | group="" sCount=0 dsCount=0 obj=0x7766de98 self=0xf4c28000
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   | sysTid=10764 nice=0 cgrp=default sched=0/0 handle=0xf76a5bec
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   | state=R schedstat=( 0 0 0 ) utm=6797 stm=57 core=6 HZ=100
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   | stack=0xff296000-0xff298000 stackSize=8MB
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   | held mutexes= "abort lock"
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #00 pc 00004e64  /system/lib/libbacktrace_libc++.so (UnwindCurrent::Unwind(unsigned int, ucontext*)+23)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #01 pc 00003665  /system/lib/libbacktrace_libc++.so (Backtrace::Unwind(unsigned int, ucontext*)+8)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #02 pc 00271451  /system/lib/libart.so (art::DumpNativeStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;, int, char const*, art::mirror::ArtMethod*)+84)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #03 pc 002534c7  /system/lib/libart.so (art::Thread::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;) const+158)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #04 pc 0025cbbd  /system/lib/libart.so (art::ThreadList::DumpLocked(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;)+120)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #05 pc 002422ad  /system/lib/libart.so (art::AbortState::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;)+272)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #06 pc 002424f7  /system/lib/libart.so (art::Runtime::Abort()+82)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #07 pc 000ad891  /system/lib/libart.so (art::LogMessage::~LogMessage()+1360)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #08 pc 000b8147  /system/lib/libart.so (art::JniAbort(char const*, char const*)+1102)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #09 pc 000b8681  /system/lib/libart.so (art::JniAbortF(char const*, char const*, ...)+68)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #10 pc 001b4ba5  /system/lib/libart.so (art::JNI::NewDirectByteBuffer(_JNIEnv*, void*, long long)+164)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #11 pc 000c72b7  /system/lib/libart.so (art::CheckJNI::NewDirectByteBuffer(_JNIEnv*, void*, long long)+90)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #12 pc 000a93d1  /system/lib/libart.so (art_quick_generic_jni_trampoline+32)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   native: #13 pc 001ffa45  /system/lib/libart.so (art::mirror::ArtMethod::Invoke(art::Thread*, unsigned int*, unsigned int, art::JValue*, char const*)+152)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.Pointer.asDirectBuffer(Native method)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.Pointer.asByteBuffer(Pointer.java:667)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.FloatPointer.asBuffer(FloatPointer.java:140)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:76)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:64)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:51)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.buffer.BaseDataBuffer.&lt;init&gt;(BaseDataBuffer.java:588)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.buffer.FloatBuffer.&lt;init&gt;(FloatBuffer.java:65)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.buffer.factory.DefaultDataBufferFactory.createFloat(DefaultDataBufferFactory.java:260)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.factory.Nd4j.createBuffer(Nd4j.java:1468)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.ndarray.BaseNDArray.&lt;init&gt;(BaseNDArray.java:260)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.cpu.nativecpu.NDArray.&lt;init&gt;(NDArray.java:122)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.cpu.nativecpu.CpuNDArrayFactory.createUninitialized(CpuNDArrayFactory.java:267)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.factory.Nd4j.createUninitialized(Nd4j.java:5054)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.shape.Shape.toOffsetZeroCopyHelper(Shape.java:247)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.shape.Shape.toOffsetZeroCopy(Shape.java:204)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.api.ndarray.BaseNDArray.dup(BaseNDArray.java:1702)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.nd4j.linalg.ops.transforms.Transforms.sqrt(Transforms.java:928)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.layers.normalization.BatchNormalization.preOutput(BatchNormalization.java:285)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.layers.normalization.BatchNormalization.activate(BatchNormalization.java:232)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.layers.AbstractLayer.activate(AbstractLayer.java:309)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.activationFromPrevLayer(MultiLayerNetwork.java:789)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForwardToLayer(MultiLayerNetwork.java:929)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:870)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:861)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.silentOutput(MultiLayerNetwork.java:1906)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1898)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1871)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1952)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at al.omid.tfdroid.MainActivity.onCreate(MainActivity.java:128)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.Activity.performCreate(Activity.java:6500)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1120)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3072)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3218)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.ActivityThread.access$1000(ActivityThread.java:198)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1676)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.os.Handler.dispatchMessage(Handler.java:102)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.os.Looper.loop(Looper.java:145)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at android.app.ActivityThread.main(ActivityThread.java:6837)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at java.lang.reflect.Method.invoke!(Native method)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at java.lang.reflect.Method.invoke(Method.java:372)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:1404)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292]   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1199)
09-13 15:25:21.942 10764-10764/al.omid.tfdroid A/art: sart/runtime/runtime.cc:292] 
&lt;/denchmark-code&gt;

Thanks!
	</description>
	<comments>
		<comment id='1' author='iRazvan' date='2017-09-13T12:37:48Z'>
		
negative buffer capacity: -4

Just 1 image, of 160x48 pixels, 3 channel?
		</comment>
		<comment id='2' author='iRazvan' date='2017-09-13T12:42:15Z'>
		The network is as follows (if I print network.summary()):
&lt;denchmark-code&gt;=====================================
LayerName (LayerType)                   nIn,nOut       TotalParams    ParamsShape                   
=====================================
0 (BatchNormalization)                  3,3            12             mean:{1,3}, var:{1,3}, gamma:{1,3}, beta:{1,3}
1 (ConvolutionLayer)                    3,16           448            b:{1,16}, W:{16,3,3,3}        
2 (ConvolutionLayer)                    16,24          3480           b:{1,24}, W:{24,16,3,3}       
3 (ConvolutionLayer)                    24,36          7812           b:{1,36}, W:{36,24,3,3}       
4 (ConvolutionLayer)                    36,48          6960           b:{1,48}, W:{48,36,2,2}       
5 (ConvolutionLayer)                    48,48          9264           b:{1,48}, W:{48,48,2,2}       
6 (DenseLayer)                          28560,512      14623232       b:{1,512}, W:{28560,512}      
7 (DropoutLayer)                        -,-            0              -                             
8 (ActivationLayer)                     -,-            0              -                             
9 (DenseLayer)                          512,10         5130           b:{1,10}, W:{512,10}          
10 (ActivationLayer)                    -,-            0              -                             
11 (DenseLayer)                         10,2           22             b:{1,2}, W:{10,2}             
12 (LossLayer)                          -,-            0              -                             
------------------------------------------------------------
           Total Parameters:  14656360
       Trainable Parameters:  14656360
          Frozen Parameters:  0
===================================
&lt;/denchmark-code&gt;

The network structure in keras (python): &lt;denchmark-link:https://gist.github.com/iRazvan/3cd24dc5b6e5f49e0d928b3b7ad2d237&gt;https://gist.github.com/iRazvan/3cd24dc5b6e5f49e0d928b3b7ad2d237&lt;/denchmark-link&gt;

I had a version working fine in Keras using Python, my end goal is to make some predictions using the same network on Android.
First I want to feed it a single image, then my end goal would be to make live predictions from the camera feed.
		</comment>
		<comment id='3' author='iRazvan' date='2017-09-13T22:12:56Z'>
		Does the same thing happen on some other platform with Java SE? Or just on Android?
		</comment>
		<comment id='4' author='iRazvan' date='2017-09-14T06:43:07Z'>
		&lt;denchmark-link:https://github.com/iRazvan&gt;@iRazvan&lt;/denchmark-link&gt;
 thanks for reporting this. I'm curious if this has really anything to do with keras model import. What you could do as well, just a suggestion, is to load the keras model on your regular machine and then serialise it with dl4j's serialiser. I wonder what happens if you load that version on Android.
The reason I'm asking for this is that once you import a keras model successfully (which seems to be the case), it's just a good old dl4j model. The issue you're reporting may very well hint at a more general issue with out models on android (sorry, can't test this myself).
		</comment>
		<comment id='5' author='iRazvan' date='2017-09-14T07:00:03Z'>
		&lt;denchmark-link:https://github.com/maxpumperla&gt;@maxpumperla&lt;/denchmark-link&gt;
 My model was imported on desktop then serialized. I already successfully load the dl4j serialized model on Android. The problem is how to feed it new images and predict on them..
&lt;denchmark-link:https://github.com/saudet&gt;@saudet&lt;/denchmark-link&gt;
 I will try later some tests on the desktop version.
		</comment>
		<comment id='6' author='iRazvan' date='2017-09-14T12:34:52Z'>
		On Android I keep getting this error when creating the INDArray:
&lt;denchmark-code&gt;09-14 15:07:14.783 29429-29429/al.omid.tfdroid W/System.err: java.io.StreamCorruptedException
09-14 15:07:14.783 29429-29429/al.omid.tfdroid W/System.err:     at java.io.ObjectInputStream.readStreamHeader(ObjectInputStream.java:2068)
09-14 15:07:14.783 29429-29429/al.omid.tfdroid W/System.err:     at java.io.ObjectInputStream.&lt;init&gt;(ObjectInputStream.java:371)
09-14 15:07:14.783 29429-29429/al.omid.tfdroid W/System.err:     at al.omid.tfdroid.MainActivity.getInput(MainActivity.java:375)
09-14 15:07:14.783 29429-29429/al.omid.tfdroid W/System.err:     at al.omid.tfdroid.MainActivity.onCreate(MainActivity.java:121)
&lt;/denchmark-code&gt;

On the desktop version it's similar:
&lt;denchmark-code&gt;java.io.StreamCorruptedException: invalid stream header: 89504E47
	at java.io.ObjectInputStream.readStreamHeader(ObjectInputStream.java:857)
	at java.io.ObjectInputStream.&lt;init&gt;(ObjectInputStream.java:349)
	at org.deeplearning4j.examples.multigpu.TestImportKeras.main(TestImportKeras.java:96)
java.lang.NullPointerException
	at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForwardToLayer(MultiLayerNetwork.java:913)
	at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:870)
	at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:861)
	at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.silentOutput(MultiLayerNetwork.java:1906)
	at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1898)
	at org.deeplearning4j.examples.multigpu.TestImportKeras.main(TestImportKeras.java:110)
&lt;/denchmark-code&gt;

Reading the file is done like this (similar on both platforms):
&lt;denchmark-code&gt; final File ff = new File("/media/razvan/", "test.png");
        FileInputStream fis;
        INDArray inArray = null;
        try {
            fis = new FileInputStream(mainPath);
            ObjectInputStream oij = new ObjectInputStream(fis);
            inArray = (INDArray) oij.readObject();
        } catch (FileNotFoundException e) {
            log.info("AAAA", "fis FileNotFoundException error");
            e.printStackTrace();
        } catch (IOException e) {
            log.info("AAAA", "fis IOException error");
            e.printStackTrace();
        } catch (ClassNotFoundException e) {
            log.info("AAAA", "fis ClassNotFoundException error");
            e.printStackTrace();
        }
        log.info("AAAA", "path: " + epath + " file: " + mainPath.exists());
        try {
            log.info("AAAA", "predict: " + restored.output(inArray, false));
        } catch(Exception e) {
            e.printStackTrace();
            log.info("AAAA", "new predict error!");
        }
&lt;/denchmark-code&gt;

So basically it's: "invalid stream header" - dekstop /  "StreamCorruptedException" - android
Any ideas how to feed my 3 channel image to the network?
EDIT:
I finally did it on desktop! :)
&lt;denchmark-code&gt;String epath = "/media/razvan/test.png";
File mainPath = new File(epath);
NativeImageLoader loader = new NativeImageLoader(48, 160, 3);
INDArray image = loader.asMatrix(mainPath);

log.info("path: " + epath + " file: " + mainPath.exists());
 try {
       log.info("Output: " + restored.output(image, false));
} catch(Exception e) {
       e.printStackTrace();
       log.info("new predict error!");
}
&lt;/denchmark-code&gt;

Using the code above produces this error on Android:
&lt;denchmark-code&gt;09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65] JNI DETECTED ERROR IN APPLICATION: negative buffer capacity: -23040
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]     in call to NewDirectByteBuffer
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]     from java.nio.ByteBuffer org.bytedeco.javacpp.Pointer.asDirectBuffer()
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65] "main" prio=5 tid=1 Runnable
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | group="main" sCount=0 dsCount=0 obj=0x7766d000 self=0xf4828000
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | sysTid=8777 nice=0 cgrp=default sched=0/0 handle=0xf73cdbec
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | state=R schedstat=( 0 0 0 ) utm=7673 stm=55 core=7 HZ=100
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | stack=0xff4f7000-0xff4f9000 stackSize=8MB
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | held mutexes= "mutator lock"(shared held)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #00 pc 00004e64  /system/lib/libbacktrace_libc++.so (UnwindCurrent::Unwind(unsigned int, ucontext*)+23)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #01 pc 00003665  /system/lib/libbacktrace_libc++.so (Backtrace::Unwind(unsigned int, ucontext*)+8)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #02 pc 00271451  /system/lib/libart.so (art::DumpNativeStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;, int, char const*, art::mirror::ArtMethod*)+84)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #03 pc 002534c7  /system/lib/libart.so (art::Thread::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;) const+158)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #04 pc 000b7f5b  /system/lib/libart.so (art::JniAbort(char const*, char const*)+610)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #05 pc 000b8681  /system/lib/libart.so (art::JniAbortF(char const*, char const*, ...)+68)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #06 pc 001b4ba5  /system/lib/libart.so (art::JNI::NewDirectByteBuffer(_JNIEnv*, void*, long long)+164)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #07 pc 000c72b7  /system/lib/libart.so (art::CheckJNI::NewDirectByteBuffer(_JNIEnv*, void*, long long)+90)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #08 pc 000a93d1  /system/lib/libart.so (art_quick_generic_jni_trampoline+32)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #09 pc 001ffa45  /system/lib/libart.so (art::mirror::ArtMethod::Invoke(art::Thread*, unsigned int*, unsigned int, art::JValue*, char const*)+152)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.Pointer.asDirectBuffer(Native method)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.Pointer.asByteBuffer(Pointer.java:667)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.FloatPointer.asBuffer(FloatPointer.java:140)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:76)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:64)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.datavec.image.loader.NativeImageLoader.fillNDArray(NativeImageLoader.java:261)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.datavec.image.loader.NativeImageLoader.transformImage(NativeImageLoader.java:472)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.datavec.image.loader.NativeImageLoader.asMatrix(NativeImageLoader.java:397)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.datavec.image.loader.NativeImageLoader.asMatrix(NativeImageLoader.java:211)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.datavec.image.loader.NativeImageLoader.asMatrix(NativeImageLoader.java:195)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at al.omid.tfdroid.MainActivity.onCreate(MainActivity.java:120)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.Activity.performCreate(Activity.java:6500)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1120)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3072)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3218)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.access$1000(ActivityThread.java:198)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1676)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.os.Handler.dispatchMessage(Handler.java:102)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.os.Looper.loop(Looper.java:145)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.main(ActivityThread.java:6837)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at java.lang.reflect.Method.invoke!(Native method)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at java.lang.reflect.Method.invoke(Method.java:372)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:1404)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1199)
09-14 16:13:18.393 8777-8777/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65] 
&lt;/denchmark-code&gt;

Any ideas??
		</comment>
		<comment id='7' author='iRazvan' date='2017-09-14T18:26:44Z'>
		On Android and imported model from Keras, I used below Kotlin code and got no error.
&lt;denchmark-code&gt;// btimap is android.graphics.Bitmap.
var input = AndroidNativeImageLoader(128, 128, 3).asMatrix(bitmap).div(255)
&lt;/denchmark-code&gt;

I used &lt;denchmark-link:https://github.com/deeplearning4j/DataVec/blob/master/datavec-data/datavec-data-image/src/main/java/org/datavec/image/loader/AndroidNativeImageLoader.java&gt;AndroidImageLoader&lt;/denchmark-link&gt;
. It's easy to use and very fast.
And div(255) is because Keras image channel is 0.0 - 1.0 float, not 0 - 255 byte.
		</comment>
		<comment id='8' author='iRazvan' date='2017-09-14T18:48:36Z'>
		One more. My neural-network uses Conv2D and Dense only, no BatchNormalization.
And I use default Keras image shape [batch-size, height, width, channel].  In DL4J, shape will be converted to [batch-size, channel, height, width], but TensorFlowCnnToFeedForwardPreProcessor and AndroidNativeImageLoader solve this difference.
		</comment>
		<comment id='9' author='iRazvan' date='2017-09-15T10:25:36Z'>
		&lt;denchmark-link:https://github.com/tail-island&gt;@tail-island&lt;/denchmark-link&gt;
  Thanks for the reply, unfortunately I get the same error:
&lt;denchmark-code&gt;09-15 13:22:12.375 25336-25336/al.omid.tfdroid E/AAAA: bitmap width: 160 height: 48
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65] JNI DETECTED ERROR IN APPLICATION: negative buffer capacity: -23040
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]     in call to NewDirectByteBuffer
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]     from java.nio.ByteBuffer org.bytedeco.javacpp.Pointer.asDirectBuffer()
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65] "main" prio=5 tid=1 Runnable
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | group="main" sCount=0 dsCount=0 obj=0x7766de28 self=0xf4828000
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | sysTid=25336 nice=0 cgrp=default sched=0/0 handle=0xf7129bec
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | state=R schedstat=( 0 0 0 ) utm=7650 stm=72 core=4 HZ=100
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | stack=0xff78b000-0xff78d000 stackSize=8MB
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   | held mutexes= "mutator lock"(shared held)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #00 pc 00004e64  /system/lib/libbacktrace_libc++.so (UnwindCurrent::Unwind(unsigned int, ucontext*)+23)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #01 pc 00003665  /system/lib/libbacktrace_libc++.so (Backtrace::Unwind(unsigned int, ucontext*)+8)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #02 pc 00271451  /system/lib/libart.so (art::DumpNativeStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;, int, char const*, art::mirror::ArtMethod*)+84)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #03 pc 002534c7  /system/lib/libart.so (art::Thread::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt; &gt;&amp;) const+158)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #04 pc 000b7f5b  /system/lib/libart.so (art::JniAbort(char const*, char const*)+610)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #05 pc 000b8681  /system/lib/libart.so (art::JniAbortF(char const*, char const*, ...)+68)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #06 pc 001b4ba5  /system/lib/libart.so (art::JNI::NewDirectByteBuffer(_JNIEnv*, void*, long long)+164)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #07 pc 000c72b7  /system/lib/libart.so (art::CheckJNI::NewDirectByteBuffer(_JNIEnv*, void*, long long)+90)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #08 pc 000a93d1  /system/lib/libart.so (art_quick_generic_jni_trampoline+32)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   native: #09 pc 0005b5ae  /dev/ashmem/dalvik-classes75.dex extracted in memory from /data/app/al.omid.tfdroid-2/split_lib_dependencies_apk.apk:classes75.dex (deleted) (???)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.Pointer.asDirectBuffer(Native method)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.Pointer.asByteBuffer(Pointer.java:667)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.FloatPointer.asBuffer(FloatPointer.java:140)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:76)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.bytedeco.javacpp.indexer.FloatIndexer.create(FloatIndexer.java:64)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.datavec.image.loader.NativeImageLoader.fillNDArray(NativeImageLoader.java:261)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.datavec.image.loader.NativeImageLoader.transformImage(NativeImageLoader.java:472)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.datavec.image.loader.NativeImageLoader.asMatrix(NativeImageLoader.java:397)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at org.datavec.image.loader.AndroidNativeImageLoader.asMatrix(AndroidNativeImageLoader.java:65)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at al.omid.tfdroid.MainActivity.onCreate(MainActivity.java:139)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.Activity.performCreate(Activity.java:6500)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1120)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3072)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3218)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.access$1000(ActivityThread.java:198)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1676)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.os.Handler.dispatchMessage(Handler.java:102)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.os.Looper.loop(Looper.java:145)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at android.app.ActivityThread.main(ActivityThread.java:6837)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at java.lang.reflect.Method.invoke!(Native method)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at java.lang.reflect.Method.invoke(Method.java:372)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:1404)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65]   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1199)
09-15 13:22:12.615 25336-25336/al.omid.tfdroid A/art: sart/runtime/check_jni.cc:65] 
&lt;/denchmark-code&gt;

I used this code:
&lt;denchmark-code&gt;        AndroidNativeImageLoader imgLoader = new AndroidNativeImageLoader(height, width, channels);
        try {
            Log.e("AAAA", "Output: " + network.output(imgLoader.asMatrix(bmp).div(255), false));
        } catch (IOException e) {
            Log.e("AAAA", "loader error!");
            e.printStackTrace();
        }
&lt;/denchmark-code&gt;

JNI DETECTED ERROR IN APPLICATION: negative buffer capacity: -23040  =&gt;  this is exactly my image size: 48 * 160 * 3. Is there anything else that I need to init, am I missing something? The bitmap is not null, because I display it in an ImageView.
EDIT: I tried with a modified network that doesn't have batch norm (only conv2d, flatten and dense) and I still get the same errors..
		</comment>
		<comment id='10' author='iRazvan' date='2017-09-15T13:37:16Z'>
		&lt;denchmark-link:https://github.com/iRazvan&gt;@iRazvan&lt;/denchmark-link&gt;
 Sorry my useless comment...
I wrote a &lt;denchmark-link:https://github.com/tail-island/try-keras-dl4j-on-android&gt;simple sample&lt;/denchmark-link&gt;
 (creating model with Python and Keras, convert model with Clojure, consume model on Android). My sample does not show errors. I can't guess where is different from your code...
...I add some max-pooling layers because I have to reduce model size. Is it the difference?
		</comment>
		<comment id='11' author='iRazvan' date='2017-09-15T14:16:37Z'>
		Thanks for the sample! But running your project also crashes for me.
Tested on 2 devices: samsung s6 (with the same crash as before) and a htc one m9 which gives the following:
&lt;denchmark-code&gt;il_island.consume_model E/AndroidRuntime: FATAL EXCEPTION: AsyncTask #1
Process: com.tail_island.consume_model, PID: 23162
java.lang.UnsatisfiedLinkError: dlopen failed: cannot locate symbol "_ZTIN2cv16MinProblemSolver8FunctionE" referenced by "/data/app/com.tail_island.consume_model-1/lib/arm/libjniopencv_core.so"...
   at java.lang.Runtime.loadLibrary(Runtime.java:372)
   at java.lang.System.loadLibrary(System.java:1076)
   at org.bytedeco.javacpp.Loader.loadLibrary(Loader.java:976)
   at org.bytedeco.javacpp.Loader.load(Loader.java:777)
   at org.bytedeco.javacpp.Loader.load(Loader.java:684)
   at org.bytedeco.javacpp.opencv_core.&lt;clinit&gt;(opencv_core.java:10)
   at java.lang.Class.classForName(Native Method)
   at java.lang.Class.forName(Class.java:324)
   at org.bytedeco.javacpp.Loader.load(Loader.java:739)
   at org.bytedeco.javacpp.Loader.load(Loader.java:684)
   at org.bytedeco.javacpp.helper.opencv_core$AbstractArray.&lt;clinit&gt;(opencv_core.java:109)
   at org.bytedeco.javacv.OpenCVFrameConverter.convertToMat(OpenCVFrameConverter.java:140)
   at org.bytedeco.javacv.OpenCVFrameConverter$ToMat.convert(OpenCVFrameConverter.java:49)
   at org.datavec.image.loader.AndroidNativeImageLoader.asMatrix(AndroidNativeImageLoader.java:65)
   at com.tail_island.consume_model.MainActivity.doIt(MainActivity.java:51)
   at com.tail_island.consume_model.MainActivity.access$000(MainActivity.java:22)
   at com.tail_island.consume_model.MainActivity$1.run(MainActivity.java:32)
   at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:234)
   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1113)
   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:588)
   at java.lang.Thread.run(Thread.java:818)
&lt;/denchmark-code&gt;

I have no idea what else to try..
		</comment>
		<comment id='12' author='iRazvan' date='2017-09-15T14:24:03Z'>
		&lt;denchmark-link:https://github.com/iRazvan&gt;@iRazvan&lt;/denchmark-link&gt;
 I tested it on Android emulator (Nexus 6P Android O) and ASUS ZenFone AR (Android 7.0), No errors on them. How about on Android emulator?
		</comment>
		<comment id='13' author='iRazvan' date='2017-09-15T14:38:21Z'>
		&lt;denchmark-link:https://github.com/tail-island&gt;@tail-island&lt;/denchmark-link&gt;
 Here's my model and some test images ( &lt;denchmark-link:https://drive.google.com/drive/folders/0B_Hdsrv9K7NDTjBVbkNFOE14WVU?usp=sharing&gt;https://drive.google.com/drive/folders/0B_Hdsrv9K7NDTjBVbkNFOE14WVU?usp=sharing&lt;/denchmark-link&gt;
 ), could you please try them? I am really curious.
		</comment>
		<comment id='14' author='iRazvan' date='2017-09-15T14:49:04Z'>
		&lt;denchmark-link:https://github.com/iRazvan&gt;@iRazvan&lt;/denchmark-link&gt;
  I got below error on Android emulator when using your data and my code.
&lt;denchmark-code&gt;09-15 14:46:50.892 6529-6569/com.tail_island.consume_model E/consume-model: exception
                                                                            org.deeplearning4j.exception.DL4JInvalidInputException: Input size (24528 columns; shape = [1, 24528]) is invalid: does not match layer input size (layer # inputs = 28560) (layer name: dense_1, layer index: 5)
                                                                                at org.deeplearning4j.nn.layers.BaseLayer.preOutput(BaseLayer.java:310)
                                                                                at org.deeplearning4j.nn.layers.BaseLayer.activate(BaseLayer.java:328)
                                                                                at org.deeplearning4j.nn.layers.AbstractLayer.activate(AbstractLayer.java:309)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.activationFromPrevLayer(MultiLayerNetwork.java:789)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForwardToLayer(MultiLayerNetwork.java:929)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:870)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:861)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.silentOutput(MultiLayerNetwork.java:1906)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1898)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1871)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1952)
                                                                                at com.tail_island.consume_model.MainActivity.doIt(MainActivity.java:53)
                                                                                at com.tail_island.consume_model.MainActivity.access$000(MainActivity.java:23)
                                                                                at com.tail_island.consume_model.MainActivity$1.run(MainActivity.java:33)
                                                                                at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:245)
                                                                                at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1162)
                                                                                at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:636)
                                                                                at java.lang.Thread.run(Thread.java:764)
&lt;/denchmark-code&gt;

		</comment>
		<comment id='15' author='iRazvan' date='2017-09-15T14:53:21Z'>
		&lt;denchmark-link:https://github.com/iRazvan&gt;@iRazvan&lt;/denchmark-link&gt;
 Same on ZenFone AR.
&lt;denchmark-code&gt;09-15 14:46:50.892 6529-6569/com.tail_island.consume_model E/consume-model: exception
                                                                            org.deeplearning4j.exception.DL4JInvalidInputException: Input size (24528 columns; shape = [1, 24528]) is invalid: does not match layer input size (layer # inputs = 28560) (layer name: dense_1, layer index: 5)
                                                                                at org.deeplearning4j.nn.layers.BaseLayer.preOutput(BaseLayer.java:310)
                                                                                at org.deeplearning4j.nn.layers.BaseLayer.activate(BaseLayer.java:328)
                                                                                at org.deeplearning4j.nn.layers.AbstractLayer.activate(AbstractLayer.java:309)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.activationFromPrevLayer(MultiLayerNetwork.java:789)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForwardToLayer(MultiLayerNetwork.java:929)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:870)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.feedForward(MultiLayerNetwork.java:861)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.silentOutput(MultiLayerNetwork.java:1906)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1898)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1871)
                                                                                at org.deeplearning4j.nn.multilayer.MultiLayerNetwork.output(MultiLayerNetwork.java:1952)
                                                                                at com.tail_island.consume_model.MainActivity.doIt(MainActivity.java:53)
                                                                                at com.tail_island.consume_model.MainActivity.access$000(MainActivity.java:23)
                                                                                at com.tail_island.consume_model.MainActivity$1.run(MainActivity.java:33)
                                                                                at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:245)
                                                                                at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1162)
                                                                                at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:636)
                                                                                at java.lang.Thread.run(Thread.java:764)
&lt;/denchmark-code&gt;

		</comment>
		<comment id='16' author='iRazvan' date='2017-09-15T14:55:37Z'>
		&lt;denchmark-link:https://github.com/iRazvan&gt;@iRazvan&lt;/denchmark-link&gt;
 And my Android Studio is 2.3.3 (Android Emulator 26.1.4, Android SDK Plargorm-Tools 26.0.0, Android SDK Tools 26.0.2).
		</comment>
		<comment id='17' author='iRazvan' date='2017-09-15T14:56:55Z'>
		&lt;denchmark-link:https://github.com/iRazvan&gt;@iRazvan&lt;/denchmark-link&gt;
 One more. I try this on Ubuntu 16.04.
		</comment>
		<comment id='18' author='iRazvan' date='2017-11-28T18:26:58Z'>
		&lt;denchmark-link:https://github.com/iRazvan&gt;@iRazvan&lt;/denchmark-link&gt;
 did you ever figure out a way around this?
		</comment>
		<comment id='19' author='iRazvan' date='2017-11-29T15:46:45Z'>
		Nope, I actually rewrote the keras (dl4j) code to tensorflow and exported it from there. Then I used the tensorflow example app on Android.
		</comment>
		<comment id='20' author='iRazvan' date='2017-11-29T20:10:14Z'>
		I was afraid you'd say that.
I've been having a similar issue this week. We've found two solutions, maybe they'll work for you if you still want to keep things in dl4j? Both solutions (downgrading to dl4j = 0.8.0 and changing the configurations.json file in the trained model zip file) are discussed in &lt;denchmark-link:https://github.com/eclipse/deeplearning4j/issues/4340&gt;#4340&lt;/denchmark-link&gt;
 .
At the very least this may help someone else who sees this issue.
		</comment>
		<comment id='21' author='iRazvan' date='2017-12-31T10:40:54Z'>
		Fixed in JavaCPP (commit above). Please try to use version 1.3.4-SNAPSHOT.
		</comment>
		<comment id='22' author='iRazvan' date='2018-09-23T20:26:24Z'>
		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
		</comment>
	</comments>
</bug>