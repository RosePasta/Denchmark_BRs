<bug_data>
<bug id='940' author='ytian' open_date='2020-02-02T07:07:07Z' closed_time='2020-02-13T05:44:45Z'>
 	<summary>tf.data.Dataset not support! [bug]</summary>
 	<description>
 &lt;denchmark-h:h3&gt;Bug Description&lt;/denchmark-h&gt;
 
 run with tensorflow_datasets 's mnist dataset, but show error message:
 AttributeError: 'TakeDataset' object has no attribute 'shape'
 &lt;denchmark-h:h3&gt;Reproducing Steps&lt;/denchmark-h&gt;
 
 &lt;denchmark-code&gt;# run codes:
 import tensorflow_datasets as tfds
 mnist_train = tfds.load('mnist', split="train", as_supervised=True)
 import autokeras as ak
 ak0 = ak.ImageClassifier(num_classes=10, max_trials=10)
 ak0.fit(mnist_train, epochs=10)
 &lt;/denchmark-code&gt;
 
 &lt;denchmark-h:h3&gt;Expected Behavior&lt;/denchmark-h&gt;
 
 &lt;denchmark-code&gt;---------------------------------------------------------------------------
 AttributeError                            Traceback (most recent call last)
 &lt;ipython-input-4-a90e48684d55&gt; in &lt;module&gt;
 ----&gt; 1 ak0.fit(mnist_train, epochs=10)
 
 ~/anaconda3/lib/python3.7/site-packages/autokeras/tasks/image.py in fit(self, x, y, epochs, callbacks, validation_split, validation_data, **kwargs)
     119                     validation_split=validation_split,
     120                     validation_data=validation_data,
 --&gt; 121                     **kwargs)
     122 
     123 
 
 ~/anaconda3/lib/python3.7/site-packages/autokeras/auto_model.py in fit(self, x, y, batch_size, epochs, callbacks, validation_split, validation_data, **kwargs)
     229             y=y,
     230             validation_data=validation_data,
 --&gt; 231             validation_split=validation_split)
     232 
     233         # Process the args.
 
 ~/anaconda3/lib/python3.7/site-packages/autokeras/auto_model.py in _prepare_data(self, x, y, validation_data, validation_split)
     303         # TODO: Handle other types of input, zip dataset, tensor, dict.
     304         # Prepare the dataset.
 --&gt; 305         dataset = self._process_xy(x, y, True)
     306         if validation_data:
     307             self._split_dataset = False
 
 ~/anaconda3/lib/python3.7/site-packages/autokeras/auto_model.py in _process_xy(self, x, y, fit)
     291 
     292         x = self._process_x(x, fit)
 --&gt; 293         y = self._process_y(y, fit)
     294 
     295         return tf.data.Dataset.zip((x, y))
 
 ~/anaconda3/lib/python3.7/site-packages/autokeras/auto_model.py in _process_y(self, y, fit)
     267         for data, head, adapter in zip(y, self._heads, self._output_adapters):
     268             if fit:
 --&gt; 269                 data = adapter.fit_transform(data)
     270             else:
     271                 data = adapter.transform(data)
 
 ~/anaconda3/lib/python3.7/site-packages/autokeras/engine/adapter.py in fit_transform(self, dataset)
      66     def fit_transform(self, dataset):
      67         self.check(dataset)
 ---&gt; 68         self.fit_before_convert(dataset)
      69         dataset = self.convert_to_dataset(dataset)
      70         self.fit(dataset)
 
 ~/anaconda3/lib/python3.7/site-packages/autokeras/adapters/output_adapter.py in fit_before_convert(self, dataset)
      65         if isinstance(dataset, tf.data.Dataset):
      66             if not self.num_classes:
 ---&gt; 67                 shape = dataset.take(1).shape[1]
      68                 if shape == 1:
      69                     self.num_classes = 2
 
 AttributeError: 'TakeDataset' object has no attribute 'shape'
 &lt;/denchmark-code&gt;
 
 &lt;denchmark-h:h3&gt;Setup Details&lt;/denchmark-h&gt;
 
 Include the details about the versions of:
 
 OS type and version:
 Python:
 autokeras: 1.0.1
 scikit-learn:
 numpy:
 keras:
 scipy:
 tensorflow: 2.1.0
 pytorch:
 
 &lt;denchmark-h:h3&gt;Additional context&lt;/denchmark-h&gt;
 
 TakeDataset doesn't have attribute 'shape', so the code may be wrong. You can also find I have set num_classes=10, so there are several bugs, not just one.
 	</description>
 	<comments>
 		<comment id='1' author='ytian' date='2020-02-02T07:50:40Z'>
 		&lt;denchmark-link:https://github.com/ytian&gt;@ytian&lt;/denchmark-link&gt;
  Thank you for the issue! We will look into it.
 		</comment>
 	</comments>
 </bug>
<commit id='907b13fb8b8d169256d930e1cb01a5f7b31d5430' author='Haifeng Jin' date='2020-02-12 23:44:44-06:00'>
 	<dmm_unit complexity='1.0' interfacing='1.0' size='1.0'></dmm_unit>
 	<modification change_type='MODIFY' old_name='autokeras\adapters\output_adapter.py' new_name='autokeras\adapters\output_adapter.py'>
 		<file_info nloc='86' complexity='28' token_count='630'></file_info>
 		<method name='fit_before_convert' parameters='self,dataset'>
 				<method_info nloc='28' complexity='11' token_count='211' nesting_level='1' start_line='64' end_line='94'></method_info>
 			<added_lines>68,69</added_lines>
 			<deleted_lines>67</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>6</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='UNKNOWN' old_name='shell\pre-commit.sh' new_name='shell\pre-commit.sh'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 	</modification>
 	<modification change_type='MODIFY' old_name='tests\autokeras\adapters\output_adapter_test.py' new_name='tests\autokeras\adapters\output_adapter_test.py'>
 		<file_info nloc='27' complexity='4' token_count='220'></file_info>
 		<method name='test_tf_dataset' parameters=''>
 				<method_info nloc='5' complexity='1' token_count='48' nesting_level='0' start_line='32' end_line='36'></method_info>
 			<added_lines>32,33,34,35,36</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>30,31</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
