<bug_data>
<bug id='1105' author='erik-hasse' open_date='2020-02-16T16:55:27Z' closed_time='2020-10-28T06:45:26Z'>
 	<summary>Bad sortColumnIdx error after a dataframe is changed</summary>
 	<description>
 &lt;denchmark-h:h1&gt;Summary&lt;/denchmark-h&gt;
 
 When a dataframe is loaded, sorted on a column at the end, and then the number of columns is reduced, a "Bad sortColumnIdx" error is thrown.
 &lt;denchmark-h:h1&gt;Steps to reproduce&lt;/denchmark-h&gt;
 
 Minimal, Reproducible Example:
 &lt;denchmark-code&gt;import numpy as np
 import pandas as pd
 import streamlit as st
 
 n = st.sidebar.number_input('Number of columns', value=5)
 df = pd.DataFrame(np.random.randint(0, 10, size=(10, n)))
 st.dataframe(df)
 &lt;/denchmark-code&gt;
 
 
 Run the app
 Sort the dataframe on the last column
 Reduce the number of columns
 
 &lt;denchmark-h:h2&gt;Expected behavior:&lt;/denchmark-h&gt;
 
 The dataframe should revert to unsorted or be sorted by its last column.
 &lt;denchmark-h:h2&gt;Actual behavior:&lt;/denchmark-h&gt;
 
 The dataframe is not displayed and a Bad sortColumnIdx error is shown.
 &lt;denchmark-h:h2&gt;Is this a regression?&lt;/denchmark-h&gt;
 
 No
 &lt;denchmark-h:h1&gt;Debug info&lt;/denchmark-h&gt;
 
 
 Streamlit version: 0.56.0
 Python version: 3.8.1
 Conda environment
 OS version: macOS 10.14.6
 Browser version: Firefox 72.0.1, Chrome 79.0.3945.130
 
 	</description>
 	<comments>
 		<comment id='1' author='erik-hasse' date='2020-02-20T00:17:33Z'>
 		Thanks &lt;denchmark-link:https://github.com/erik-hasse&gt;@erik-hasse&lt;/denchmark-link&gt;
 ! We're currently overhauling our dataframe logic (see &lt;denchmark-link:https://github.com/streamlit/streamlit/pull/1021&gt;#1021&lt;/denchmark-link&gt;
 ), which will hopefully fix this.
 I've moved this bug to our internal triage board, and we'll take another look at it after the above PR lands.
 		</comment>
 		<comment id='2' author='erik-hasse' date='2020-10-15T18:57:02Z'>
 		Quick note, &lt;denchmark-link:https://github.com/kellyamanda&gt;@kellyamanda&lt;/denchmark-link&gt;
  just saw this bug pop up in our metrics dashboard, so i'm bumping it up in priority as it clearly didn't get washed away by any PRs over the year.
 		</comment>
 	</comments>
 </bug>
<commit id='0b8505befef010abe3c5f9cf095f1a4af872ecbe' author='Henrikh Kantuni' date='2020-10-28 02:45:25-04:00'>
 	<dmm_unit complexity='1.0' interfacing='1.0' size='1.0'></dmm_unit>
 	<modification change_type='ADD' old_name='None' new_name='e2e\scripts\st_dataframe_sort_column.py'>
 		<file_info nloc='6' complexity='0' token_count='55'></file_info>
 	</modification>
 	<modification change_type='MODIFY' old_name='e2e\specs\st_dataframe.spec.js' new_name='e2e\specs\st_dataframe.spec.js'>
 		<file_info nloc='27' complexity='7' token_count='178'></file_info>
 		<method name='(anonymous)' parameters=''>
 				<method_info nloc='8' complexity='1' token_count='60' nesting_level='0' start_line='18' end_line='53'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>49,50,51,52</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='ADD' old_name='None' new_name='e2e\specs\st_dataframe_sort_column.spec.js'>
 		<file_info nloc='15' complexity='3' token_count='81'></file_info>
 	</modification>
 	<modification change_type='MODIFY' old_name='frontend\src\components\elements\DataFrame\DataFrame.tsx' new_name='frontend\src\components\elements\DataFrame\DataFrame.tsx'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines>18,25,40,59,65,69,70,71,72,73,74,75,76,77,78,86,115,118,141,146,153,181,207,208,209,210,211,212,213,214</added_lines>
 			<deleted_lines>18,39,73,130,137,165,166,167,168,169,170,171,172,173,174</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
