<bug_data>
<bug id='6129' author='erip' open_date='2020-09-23T15:17:54Z' closed_time='2020-09-30T11:26:07Z'>
 	<summary>Tags in TAG_MAP not being found in debug-data</summary>
 	<description>
 &lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;
 
 
 Add tags from Korean UD to spacy/lang/ko/tag_map.py
 Build spaCy from source
 debug data:
 
 (spacy-ko) [erip@blah spacy-ko]$ python -m spacy debug-data ko korean-json/train.json korean-json/dev.json --verbose | grep "not found" | head -n5
 ✘ Label 'ncpa+ncn' not found in tag map for language 'ko'
 ✘ Label 'ncpa+ncn+jcm' not found in tag map for language 'ko'
 ✘ Label 'ncpa+jxt' not found in tag map for language 'ko'
 ✘ Label 'mag' not found in tag map for language 'ko'
 ✘ Label 'ncn' not found in tag map for language 'ko'
 $
 $
 (spacy-ko) [erip@blah spacy-ko]$ python
 Python 3.6.12 |Anaconda, Inc.| (default, Sep  8 2020, 23:10:56)
 [GCC 7.3.0] on linux
 Type "help", "copyright", "credits" or "license" for more information.
 &gt;&gt;&gt; import spacy
 &gt;&gt;&gt; from spacy.lang.ko import tag_map
 &gt;&gt;&gt; all(tag in tag_map.TAG_MAP for tag in ['ncpa+ncn', 'ncpa+ncn+jcm', 'ncpa+jxt', 'mag', 'ncn'])
 True
 &lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;
 
 &lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;
 
 
 spaCy version: 2.3.2 (master)
 Platform: Linux-3.10.0-1127.8.2.el7.x86_64-x86_64-with-centos-7.8.2003-Core
 Python version: 3.6.12
 
 	</description>
 	<comments>
 		<comment id='1' author='erip' date='2020-09-23T15:28:26Z'>
 		And for posterity, my tag_map.py looks like...
 # encoding: utf8
 from __future__ import unicode_literals
 
 from ...symbols import POS, PUNCT, INTJ, X, SYM, ADJ, AUX, ADP, CONJ, NOUN, PRON
 from ...symbols import VERB, ADV, PROPN, NUM, DET, PART, CCONJ, SCONJ
 
 TAG_MAP = {
     # J.{1,2} 조사
     "JKS": {POS: ADP},
     "JKC": {POS: ADP},
     # There are a lot...
      "xsn" : {POS: PART},
     "xsv+ecc" : {POS: PART},
     "xsv+ecs" : {POS: PART},
     "XSV+EC" : {POS: VERB},
     "xsv+ecx+px+ep+ef" : {POS: PART},
     "xsv+ep+ecx" : {POS: PART},
     "XSV+EP+ETM" : {POS: VERB},
     "xsv+etm" : {POS: PART},
     "XSV+ETM" : {POS: VERB},
 }
 		</comment>
 		<comment id='2' author='erip' date='2020-09-23T15:43:56Z'>
 		Found the issue. In &lt;denchmark-link:https://github.com/explosion/spaCy/blob/597bcc629e173dfd87422188dc76a2f1053a9bba/spacy/cli/debug_data.py#L62-L74&gt;this code&lt;/denchmark-link&gt;
 , the tag map is being replaced with an empty dict because no tag-map is being provided. It seems like the fix is that L74 should happen in the if-statement after L64.
 		</comment>
 		<comment id='3' author='erip' date='2020-09-24T06:09:09Z'>
 		That does look like a bug, thanks for the report!
 We're trying to move away from having the tag maps specified within the library in the language data (since they're corpus-specific and not language-specific) so you don't need a custom spacy install, etc. to manage them, but the library tag map should be the default with spacy train, not an empty tag map.
 As a workaround, you can use the  option with your tag map in JSON format. Unfortunately JSON encoding restrictions make converting the tag map more of a hassle than you'd expect, but it's what we're using internally now for all the provided models. See the example at the very bottom here: &lt;denchmark-link:https://spacy.io/usage/v2-3&gt;https://spacy.io/usage/v2-3&lt;/denchmark-link&gt;
 . Just replace the model with  from your custom spacy install.
 		</comment>
 		<comment id='4' author='erip' date='2020-09-24T11:25:49Z'>
 		Thanks, &lt;denchmark-link:https://github.com/adrianeboyd&gt;@adrianeboyd&lt;/denchmark-link&gt;
 . I recalled that the there was some discussion about moving away from coupling corpus-specific tagmaps to langs, so this seems like a good solution. :-)
 In any case, I'm happy to submit a PR with the proposed fix outlined above (which worked for me) if you think it's worth it. I don't know how many 2.3.x releases you anticipate because cutting the 3.x release, so maybe moot - your call.
 		</comment>
 		<comment id='5' author='erip' date='2020-09-24T13:15:46Z'>
 		Hey &lt;denchmark-link:https://github.com/erip&gt;@erip&lt;/denchmark-link&gt;
 , we're definitely going to release at least one more bugfix release for 2.x, since we have a few fixes accumulated on  already. I haven't looked at the details of this issue, but if it's a quick fix we'd definitely appreciate the contribution!
 		</comment>
 		<comment id='6' author='erip' date='2020-09-29T11:40:38Z'>
 		Done, &lt;denchmark-link:https://github.com/svlandeg&gt;@svlandeg&lt;/denchmark-link&gt;
 . Hopefully nothing too controversial, but let me know if you would like me to make any changes. 
 		</comment>
 		<comment id='7' author='erip' date='2020-09-30T11:53:38Z'>
 		Thanks! :-)
 		</comment>
 	</comments>
 </bug>
<commit id='4cbb954281ad47148667de130e5c4eb23e579edf' author='Elijah Rippeth' date='2020-09-30 13:26:06+02:00'>
 	<dmm_unit complexity='None' interfacing='None' size='None'></dmm_unit>
 	<modification change_type='MODIFY' old_name='spacy\cli\debug_data.py' new_name='spacy\cli\debug_data.py'>
 		<file_info nloc='587' complexity='44' token_count='3298'></file_info>
 		<modified_lines>
 			<added_lines>69,70,71,72,73</added_lines>
 			<deleted_lines>62,63,64,65,73,74</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
