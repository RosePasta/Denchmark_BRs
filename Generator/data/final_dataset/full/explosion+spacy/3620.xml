<bug_data>
<bug id='3620' author='AlexisPister' open_date='2019-04-19T15:01:17Z' closed_time='2019-05-11T17:15:33Z'>
 	<summary>Convert command line on .iob Conll-2003 file not working</summary>
 	<description>
 &lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;
 
 Hello, I would like to convert the conll-2003 dataset from iob to json. I removed the 2 middle columns with python and my files look like this now :
 &lt;denchmark-code&gt;-DOCSTART- O
  
 CRICKET O
 - O
 LEICESTERSHIRE B-ORG
 TAKE O
 OVER O
 AT O
 TOP O
 AFTER O
 INNINGS O
 VICTORY O
 . O
 &lt;/denchmark-code&gt;
 
 I tried to convert them to the json format with the command line convert but I get the following message each time :
 âœ” Generated output file (0 documents)
 json_output/valid.msg
 An empty file is generated. Here is the command I used :
 python -m spacy convert valid.iob json_output/ -t msg -c iob
 I tried the three output format possible but it always give the same thing
 &lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;
 
 
 Operating System: Elementary OS 5.xx
 Python Version Used: 3.7.1
 spaCy Version Used: 2.1.1
 
 	</description>
 	<comments>
 		<comment id='1' author='AlexisPister' date='2019-04-22T13:19:30Z'>
 		Thanks, it looks like there's a bug in the &lt;denchmark-link:https://github.com/explosion/spaCy/tree/master/spacy/cli/converters/iob2json.py&gt;spacy/cli/converters/iob2json.py&lt;/denchmark-link&gt;
  file. The code really doesn't look right there --- possibly an append has ended up in the wrong block?
 		</comment>
 		<comment id='2' author='AlexisPister' date='2019-04-24T08:57:11Z'>
 		I would be glad to help, but I really don't understand how the script should be working. The read_iob function is not called anywhere and I don't get what the loop in the iob2json function is doing.
 		</comment>
 		<comment id='3' author='AlexisPister' date='2019-05-06T16:38:05Z'>
 		This has halted my exploration of spacy.io for Gate replacement.  I'm not enough of a pythonista to go through the framework and locate how and why, though I can confirm it simply writes out empty files even with something as simple as:
 Borg|B-ORG
 Inc|I-ORG
 is|O
 back|O
 !|O
 		</comment>
 		<comment id='4' author='AlexisPister' date='2019-05-06T21:21:01Z'>
 		&lt;denchmark-link:https://github.com/AlexisPister&gt;@AlexisPister&lt;/denchmark-link&gt;
  Damn, it looks like that's the problem, yes  I just briefly checked the history of that file and it seems like the converter possibly got messed up in a merge. So it's currently iterating over an empty list, which obviously produces another empty list.
 Here's the previous state of the file: &lt;denchmark-link:https://github.com/explosion/spaCy/blob/9a5003d5c8b03c9ae53f32d7b3fc987726cd5617/spacy/cli/converters/iob2json.py&gt;https://github.com/explosion/spaCy/blob/9a5003d5c8b03c9ae53f32d7b3fc987726cd5617/spacy/cli/converters/iob2json.py&lt;/denchmark-link&gt;
 
 The main thing that has changed in v2.1 is that the converters aren't opening and writing the files anymore (which created a lot of code duplication). Instead, they receive the opened file as the first argument  and no output path (&lt;denchmark-link:https://github.com/explosion/spaCy/blob/master/spacy/cli/convert.py#L80&gt;see here&lt;/denchmark-link&gt;
 ) and return the contents to write to the JSON file. So in theory, using the old converter and simplifying the main function to something like this should work:
 sentences = read_iob(input_data)
 docs = merge_sentences(sentences, n_sents)
 return docs
 		</comment>
 		<comment id='5' author='AlexisPister' date='2019-06-10T18:26:17Z'>
 		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
 		</comment>
 	</comments>
 </bug>
<commit id='0bf6441863433575aebcbd0b238d27d95830c015' author='Ines Montani' date='2019-05-11 19:15:26+02:00'>
 	<dmm_unit complexity='1.0' interfacing='1.0' size='1.0'></dmm_unit>
 	<modification change_type='MODIFY' old_name='spacy\cli\converters\iob2json.py' new_name='spacy\cli\converters\iob2json.py'>
 		<file_info nloc='44' complexity='13' token_count='324'></file_info>
 		<method name='merge_sentences' parameters='docs,n_sents'>
 				<method_info nloc='10' complexity='3' token_count='79' nesting_level='0' start_line='47' end_line='56'></method_info>
 			<added_lines>47,48,49,50,51,52,53,54,55,56</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='read_iob' parameters='raw_sents'>
 				<method_info nloc='26' complexity='9' token_count='190' nesting_level='0' start_line='25' end_line='51'></method_info>
 			<added_lines>45,46,47,48,49,50,51</added_lines>
 			<deleted_lines>30</deleted_lines>
 		</method>
 		<method name='iob2json' parameters='input_data,n_sents,args,kwargs'>
 				<method_info nloc='4' complexity='1' token_count='37' nesting_level='0' start_line='10' end_line='16'></method_info>
 			<added_lines>14,15</added_lines>
 			<deleted_lines>14,15,16</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>5</added_lines>
 			<deleted_lines>7,17,18,19,20,21</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
