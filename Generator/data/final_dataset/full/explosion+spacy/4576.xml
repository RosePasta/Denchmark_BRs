<bug_data>
<bug id='4576' author='rjknight' open_date='2019-11-02T13:49:40Z' closed_time='2020-11-23T09:26:48Z'>
 	<summary>Matcher breaks with "complex" patterns ppc64le</summary>
 	<description>
 Hello, I am seeing failures in the matcher unit tests, when complex patterns are involved.
 It seems very similar to this older issue Matcher breaks with "complex" patterns #3328
 &lt;denchmark-h:h2&gt;How to reproduce the behavior&lt;/denchmark-h&gt;
 
 run the following sample code from issue 3328:
 &lt;denchmark-code&gt;import spacy
 from spacy.tokens import Token, Doc, Span
 from spacy.matcher import Matcher, PhraseMatcher
 
 text = "Hello, how are you doing?"
 
 nlp = spacy.load('en_core_web_md')
 
 matcher = Matcher(nlp.vocab)
 patterns = [
     [{'LOWER': {'IN': ["hello", "how"]}}],
     [{'LOWER': {'IN': ["you", "doing"]}}],
 ]
 
 matcher.add('TEST', None, *patterns)
 
 doc = nlp(text)
 
 matches = matcher(doc)
 for match_id, start, end in matches:
     span = Span(doc, start, end, label=match_id)
     print(span.text)
 &lt;/denchmark-code&gt;
 
 &lt;denchmark-h:h2&gt;Exected results&lt;/denchmark-h&gt;
 
 running in an x86 container I see the following
 &lt;denchmark-code&gt;(wmlce) pwrai@8d94e9e4cbc2:~$ python ./testme.py 
 Hello
 how
 you
 doing
 (wmlce) pwrai@8d94e9e4cbc2:~$ python -m spacy info --markdown
 
 ## Info about spaCy
 
 * **spaCy version:** 2.2.1
 * **Platform:** Linux-3.10.0-957.5.1.el7.x86_64-x86_64-with-debian-buster-sid
 * **Python version:** 3.7.3
 &lt;/denchmark-code&gt;
 
 &lt;denchmark-h:h2&gt;Actual results&lt;/denchmark-h&gt;
 
 when running the same sample code in a ppc64le container I see the following:
 &lt;denchmark-code&gt;(wmlce) pwrai@ed647b42dde1:~$ python testme.py 
 Hello
 ,
 how
 are
 you
 doing
 ?
 (wmlce) pwrai@ed647b42dde1:~$ python -m spacy info --markdown
 
 ## Info about spaCy
 
 * **spaCy version:** 2.2.1
 * **Platform:** Linux-4.14.0-115.10.1.el7a.ppc64le-ppc64le-with-debian-buster-sid
 * **Python version:** 3.7.4
 * **Models:** en
 
 
 &lt;/denchmark-code&gt;
 
 	</description>
 	<comments>
 		<comment id='1' author='rjknight' date='2019-11-08T06:51:13Z'>
 		Thanks for the report! I'm curious about what might be going on, but I'm not sure we have the resources to debug this right now. It does sound like a bug, so I'll add that label so we'll know to come back to it in the future.
 		</comment>
 		<comment id='2' author='rjknight' date='2020-01-13T00:17:59Z'>
 		&lt;denchmark-link:https://github.com/rjknight&gt;@rjknight&lt;/denchmark-link&gt;
  Hi, May I know what channel you used to install the  package for ? I have searched several channels but could not find the . Thanks a lot!
 		</comment>
 		<comment id='3' author='rjknight' date='2020-01-14T17:37:56Z'>
 		
 @rjknight Hi, May I know what channel you used to install the spacy package for ppc64le? I have searched several channels but could not find the spacy &gt;= 2.1.0. Thanks a lot!
 
 &lt;denchmark-link:https://github.com/Xiaoming-Zhao&gt;@Xiaoming-Zhao&lt;/denchmark-link&gt;
  from here &lt;denchmark-link:https://anaconda.org/powerai/repo&gt;https://anaconda.org/powerai/repo&lt;/denchmark-link&gt;
 
 		</comment>
 		<comment id='4' author='rjknight' date='2020-04-15T22:40:30Z'>
 		If anyone working on this architecture feels like testing &amp; debugging this issue, all help is welcome!
 		</comment>
 		<comment id='5' author='rjknight' date='2020-11-17T19:42:04Z'>
 		I can confirm that I see the same type of test failure when attempting to build spacy v2.3.2 for ppc64le on conda-forge.
 		</comment>
 	</comments>
 </bug>
<commit id='3f61f5eb546c90aa483afbab8d91508f3d887acb' author='Adriane Boyd' date='2020-11-23 10:26:47+01:00'>
 	<dmm_unit complexity='None' interfacing='None' size='None'></dmm_unit>
 	<modification change_type='MODIFY' old_name='spacy\matcher\matcher.pyx' new_name='spacy\matcher\matcher.pyx'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines>6,282,323,395,433,491,543,545,560,571</added_lines>
 			<deleted_lines>6,282,323,395,433,491,543,545,560,571</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='spacy\typedefs.pxd' new_name='spacy\typedefs.pxd'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines>6</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='spacy\vocab.pxd' new_name='spacy\vocab.pxd'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines>8</added_lines>
 			<deleted_lines>8</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
