<bug_data>
<bug id='4506' author='ines' open_date='2019-10-22T16:20:18Z' closed_time='2019-10-22T18:10:45Z'>
 	<summary>Vectors.most_similar should always return 1.0 for identical vectors</summary>
 	<description>
 We should probably hard-code the workaround for the imprecision, just like we do for the built-in similarity methods.
 &lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;
 
 
 
 
 spaCy/spacy/tests/vocab_vectors/test_vectors.py
 
 
         Lines 144 to 154
       in
       74a19ae
 
 
 
 
 
 
  @pytest.mark.xfail 
 
 
 
  def test_vectors_most_similar_identical(): 
 
 
 
  """Test that most similar identical vectors are assigned a score of 1.0.""" 
 
 
 
  data = numpy.asarray([[4, 2, 2, 2], [4, 2, 2, 2], [1, 1, 1, 1]], dtype="f") 
 
 
 
  v = Vectors(data=data, keys=["A", "B", "C"]) 
 
 
 
  keys, _, scores = v.most_similar(numpy.asarray([[4, 2, 2, 2]], dtype="f")) 
 
 
 
  assert scores[0][0] == 1.0 # not 1.0000002 
 
 
 
  data = numpy.asarray([[1, 2, 3], [1, 2, 3], [1, 1, 1]], dtype="f") 
 
 
 
  v = Vectors(data=data, keys=["A", "B", "C"]) 
 
 
 
  keys, _, scores = v.most_similar(numpy.asarray([[1, 2, 3]], dtype="f")) 
 
 
 
  assert scores[0][0] == 1.0 # not 0.9999999 
 
 
 
 
 
 	</description>
 	<comments>
 		<comment id='1' author='ines' date='2019-10-22T17:25:56Z'>
 		Just out of curiosity - why is this a requirement? Shouldn't equality on real values always be tested with some margin?
 		</comment>
 		<comment id='2' author='ines' date='2019-10-22T18:03:06Z'>
 		&lt;denchmark-link:https://github.com/svlandeg&gt;@svlandeg&lt;/denchmark-link&gt;
  It's not really a requirement, but when we didn't clip the values for the  methods, people found this pretty confusing (e.g. when  wasn't ). And since we're doing it this way for other similarity comparisons, we might as well do it for the .
 		</comment>
 		<comment id='3' author='ines' date='2019-11-21T18:54:50Z'>
 		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
 		</comment>
 	</comments>
 </bug>
<commit id='9489c5f6b2e58f2de4f9ff463982b1b9430a5c7f' author='Matthew Honnibal' date='2019-10-22 20:10:42+02:00'>
 	<dmm_unit complexity='None' interfacing='None' size='None'></dmm_unit>
 	<modification change_type='MODIFY' old_name='spacy\tests\vocab_vectors\test_vectors.py' new_name='spacy\tests\vocab_vectors\test_vectors.py'>
 		<file_info nloc='239' complexity='46' token_count='2835'></file_info>
 		<method name='test_vocab_prune_vectors' parameters=''>
 				<method_info nloc='17' complexity='1' token_count='208' nesting_level='0' start_line='300' end_line='317'></method_info>
 			<added_lines>317</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines>144,318</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='spacy\vectors.pyx' new_name='spacy\vectors.pyx'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines>347,349,350,351,352</added_lines>
 			<deleted_lines>347</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
