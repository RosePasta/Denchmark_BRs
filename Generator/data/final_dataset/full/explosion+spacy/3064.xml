<bug_data>
<bug id='3064' author='dswah' open_date='2018-12-18T12:26:32Z' closed_time='2018-12-29T15:26:03Z'>
 	<summary>doc.to_array fails on singe string attribute</summary>
 	<description>
 &lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;
 
 Trying to export  by specifying a single STRING attribute (&lt;denchmark-link:https://spacy.io/api/doc#to_array&gt;as per the documentation&lt;/denchmark-link&gt;
 ) fails, giving a :
 from spacy.attrs import POS
 doc = nlp(u'the docs say i can use a string')
 np_array = doc.to_array("POS")
 results in :
 &lt;denchmark-code&gt;KeyError                                  Traceback (most recent call last)
 &lt;ipython-input-127-904e71626dc6&gt; in &lt;module&gt;
       1 from spacy.attrs import POS
       2 doc = nlp(u'the docs say i can use a string')
 ----&gt; 3 np_array = doc.to_array("POS")
 
 doc.pyx in spacy.tokens.doc.Doc.to_array()
 
 doc.pyx in spacy.tokens.doc.Doc.to_array()
 
 KeyError: 'P'
 &lt;/denchmark-code&gt;
 
 looks like spacy detects that the string is iterable and is treating the contents of the string as the attribute keys to be exported?
 &lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;
 
 
 spaCy version: 2.0.18
 Platform: Linux-4.14.67-coreos-x86_64-with-debian-buster-sid
 Python version: 3.6.6
 Models: en
 
 	</description>
 	<comments>
 		<comment id='1' author='dswah' date='2018-12-20T11:28:50Z'>
 		Thanks. Getting this stuff right in Python is often a struggle. Would you mind making a pull request? A test for it would also be very helpful.
 		</comment>
 		<comment id='2' author='dswah' date='2018-12-20T11:38:16Z'>
 		looks like 
 
 
 spaCy/spacy/tokens/doc.pyx
 
 
          Line 595
       in
       57f274b
 
 
 
 
 
 
  if not hasattr(py_attr_ids, '__iter__') \ 
 
 
 
 
 
 should be checking:
 if hasattr(py_attr_ids, '__iter__') \
         and isinstance(py_attr_ids, basestring_):
             py_attr_ids = [py_attr_ids]
 instead?
 		</comment>
 		<comment id='3' author='dswah' date='2018-12-20T11:51:04Z'>
 		&lt;denchmark-link:https://github.com/dswah&gt;@dswah&lt;/denchmark-link&gt;
  There are three cases:
 
 doc.to_array('ORTH') # String
 doc.to_array(ORTH) # Integer ID
 doc.to_array(['ORTH']) # List (might have string or integer entries)
 
 We need to detect that something's a container without catching strings in the condition. I've always hated that Python makes this a bit hard. Maybe this would work:
 &lt;denchmark-code&gt;if isinstance(py_attr_ids, basestring_):
     # Handle inputs like doc.to_array('ORTH')
     py_attr_ids = [py_attr_ids]
 elif not hasattr(py_attr_ids, '__iter__'):
     # Handle inputs like doc.to_array(ORTH)
     py_attr_ids = [py_attr_ids]
 &lt;/denchmark-code&gt;
 
 We could make it a single "or" condition but I think the cases are tricky enough to warrant the multiple lines. We don't currently have line coverage set up for Cython, but once we do, it makes sense to be checking our tests cover both branches.
 		</comment>
 		<comment id='4' author='dswah' date='2018-12-20T11:55:51Z'>
 		
 We could make it a single "or" condition but I think the cases are tricky enough to warrant the multiple lines. We don't currently have line coverage set up for Cython, but once we do, it makes sense to be checking our tests cover both branches.
 
 Agreed, this is easier to read and comprehend anyways.
 		</comment>
 		<comment id='5' author='dswah' date='2018-12-29T15:26:03Z'>
 		Done, thanks for your help!
 		</comment>
 		<comment id='6' author='dswah' date='2019-01-28T16:05:28Z'>
 		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
 		</comment>
 	</comments>
 </bug>
<commit id='76e3e695afe191f96416181c8905917652c0cde3' author='Matthew Honnibal' date='2018-12-29 16:24:40+01:00'>
 	<dmm_unit complexity='None' interfacing='None' size='None'></dmm_unit>
 	<modification change_type='MODIFY' old_name='spacy\tokens\doc.pyx' new_name='spacy\tokens\doc.pyx'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines>597,598,599,600,601,602</added_lines>
 			<deleted_lines>597,598,600</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
