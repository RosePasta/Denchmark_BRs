<bug_data>
<bug id='4770' author='EdwardJB' open_date='2019-12-05T14:27:12Z' closed_time='2019-12-06T13:07:40Z'>
 	<summary>Text classification results (Document.cat) missing when multiprocessing enabled</summary>
 	<description>
 &lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;
 
 On a model that contains some text classifiers, run this code with n_process=1. It works as expected; classifications are present:
 text='my test text'
 docs = self.model.pipe([text],n_process=1)
 response = []
 for i, (text, doc) in enumerate(zip(texts, docs), start=1):
     print(doc.to_json())
 {'text': 'my test text', 'sents': [{'start': 0, 'end': 12}], 'cats': {...all of my cats are here..}, 'tokens': [{'id': 0, 'start': 0, 'end': 2}, {'id': 1, 'start': 3, 'end': 7}, {'id': 2, 'start': 8, 'end': 12}]}
 Now run the same with n_process=-1, and they are missing:
 text='my test text'
 docs = self.model.pipe([text],n_process=-1)
 response = []
 for i, (text, doc) in enumerate(zip(texts, docs), start=1):
     print(doc.to_json())
     print(doc.cats)
 {'text': 'my test text', 'sents': [{'start': 0, 'end': 12}], 'tokens': [{'id': 0, 'start': 0, 'end': 2}, {'id': 1, 'start': 3, 'end': 7}, {'id': 2, 'start': 8, 'end': 12}]}
 {}
 &lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;
 
 &lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;
 
 
 spaCy version: 2.2.3
 Platform: Linux-4.4.0-18362-Microsoft-x86_64-with-glibc2.2.5
 Python version: 3.8.0
 
 	</description>
 	<comments>
 		<comment id='1' author='EdwardJB' date='2019-12-05T19:28:23Z'>
 		Thanks for the report! I can replicate this and it looks like the cats are going missing when the Doc is serialized. I'm surprised this bug wasn't noticed a lot earlier...
 		</comment>
 		<comment id='2' author='EdwardJB' date='2020-01-05T14:19:24Z'>
 		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
 		</comment>
 	</comments>
 </bug>
<commit id='676e75838f852246ac045837cd852b854b06d77e' author='adrianeboyd' date='2019-12-06 14:07:39+01:00'>
 	<dmm_unit complexity='0.9166666666666666' interfacing='0.9166666666666666' size='0.9166666666666666'></dmm_unit>
 	<modification change_type='MODIFY' old_name='spacy\tests\serialize\test_serialize_doc.py' new_name='spacy\tests\serialize\test_serialize_doc.py'>
 		<file_info nloc='64' complexity='9' token_count='556'></file_info>
 		<method name='test_serialize_doc_bin' parameters=''>
 				<method_info nloc='15' complexity='3' token_count='129' nesting_level='0' start_line='67' end_line='83'></method_info>
 			<added_lines>70,73,80,81,82,83</added_lines>
 			<deleted_lines>77</deleted_lines>
 		</method>
 		<method name='test_serialize_doc_roundtrip_bytes' parameters='en_vocab'>
 				<method_info nloc='6' complexity='1' token_count='56' nesting_level='0' start_line='25' end_line='30'></method_info>
 			<added_lines>27</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='spacy\tokens\_serialize.py' new_name='spacy\tokens\_serialize.py'>
 		<file_info nloc='141' complexity='34' token_count='1015'></file_info>
 		<method name='merge' parameters='self,other'>
 				<method_info nloc='9' complexity='3' token_count='94' nesting_level='1' start_line='113' end_line='129'></method_info>
 			<added_lines>127</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='get_docs' parameters='self,vocab'>
 				<method_info nloc='15' complexity='5' token_count='145' nesting_level='1' start_line='90' end_line='111'></method_info>
 			<added_lines>107</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='to_bytes' parameters='self'>
 				<method_info nloc='15' complexity='4' token_count='140' nesting_level='1' start_line='131' end_line='151'></method_info>
 			<added_lines>147</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='__init__' parameters='self,attrs,store_user_data'>
 				<method_info nloc='11' complexity='6' token_count='100' nesting_level='1' start_line='45' end_line='64'></method_info>
 			<added_lines>61</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='from_bytes' parameters='self,bytes_data'>
 				<method_info nloc='18' complexity='4' token_count='192' nesting_level='1' start_line='153' end_line='177'></method_info>
 			<added_lines>172</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='add' parameters='self,doc'>
 				<method_info nloc='13' complexity='4' token_count='153' nesting_level='1' start_line='70' end_line='88'></method_info>
 			<added_lines>86</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='spacy\tokens\doc.pyx' new_name='spacy\tokens\doc.pyx'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines>890,920,942,943</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
