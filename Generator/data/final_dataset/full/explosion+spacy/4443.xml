<bug_data>
<bug id='4443' author='danielkingai2' open_date='2019-10-14T23:29:46Z' closed_time='2019-10-16T21:18:55Z'>
 	<summary>Prune vectors error</summary>
 	<description>
 &lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;
 
 Same issue as &lt;denchmark-link:https://github.com/explosion/spaCy/issues/4386&gt;#4386&lt;/denchmark-link&gt;
 , &lt;denchmark-link:https://github.com/explosion/spaCy/pull/4388&gt;#4388&lt;/denchmark-link&gt;
  doesn't quite fix it, as the first element of the tuple here: 
  still has the shape of the full array instead of the batch. Pretty sure it just needs to be turned into this:
 sorted_index = xp.arange(scores.shape[0])[:,None][i:i+batch_size],xp.argsort(scores[i:i+batch_size], axis=1)[:,::-1]
 Will open a PR in case you agree. I would also suggest not sorting if n=1 since its not necessary so I'll also add that in the PR.
 &lt;denchmark-h:h2&gt;Your Environment&lt;/denchmark-h&gt;
 
 &lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;
 
 
 spaCy version: 2.2.1 (master)
 Platform: Linux-4.4.0-112-generic-x86_64-with-debian-stretch-sid
 Python version: 3.6.7
 
 	</description>
 	<comments>
 		<comment id='1' author='danielkingai2' date='2019-11-15T21:54:36Z'>
 		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
 		</comment>
 	</comments>
 </bug>
<commit id='e6469561763a732cf51e6757ecf571d5847f1c06' author='Daniel King' date='2019-10-16 23:18:55+02:00'>
 	<dmm_unit complexity='1.0' interfacing='1.0' size='1.0'></dmm_unit>
 	<modification change_type='MODIFY' old_name='spacy\tests\vocab_vectors\test_vectors.py' new_name='spacy\tests\vocab_vectors\test_vectors.py'>
 		<file_info nloc='230' complexity='45' token_count='2624'></file_info>
 		<method name='test_vocab_prune_vectors' parameters=''>
 				<method_info nloc='17' complexity='1' token_count='202' nesting_level='0' start_line='287' end_line='304'></method_info>
 			<added_lines>300</added_lines>
 			<deleted_lines>287</deleted_lines>
 		</method>
 		<method name='test_vectors_most_similar' parameters='most_similar_vectors_data'>
 				<method_info nloc='4' complexity='2' token_count='58' nesting_level='0' start_line='137' end_line='140'></method_info>
 			<added_lines>137,138,139,140</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='most_similar_vectors_data' parameters=''>
 				<method_info nloc='5' complexity='1' token_count='73' nesting_level='0' start_line='54' end_line='58'></method_info>
 			<added_lines>54,55,56,57,58</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>53,59,141,142</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='spacy\vectors.pyx' new_name='spacy\vectors.pyx'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines>339,340</added_lines>
 			<deleted_lines>339,340</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
