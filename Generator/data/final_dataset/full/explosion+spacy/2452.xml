<bug_data>
<bug id='2452' author='kaushikacharya' open_date='2018-06-14T09:54:51Z' closed_time='2018-07-04T12:12:11Z'>
 	<summary>dependency graph plot in displacy: all arcs are shown in forward direction</summary>
 	<description>
 &lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;
 
 Tried the same example as shown in &lt;denchmark-link:https://spacy.io/usage/linguistic-features#navigating&gt;Navigating the parse tree&lt;/denchmark-link&gt;
 
 i.e.
 
 Autonomous cars shift insurance liability toward manufacturers
 
 Dependency head for each of the tokens on printing is coming same as in the above link, but the dependency tree plot locally shows otherwise.
 All the arcs between the words and their corresponding heads are always going forward(i.e. from left to right) even when the head is on the right side(where we expect it go from right to left).
 This happens in both cases:
 a) rendering in jupyter
 displacy.render(doc, style='dep', jupyter=True)
 b) dumping into svg file.
 I can see that there's an issue &lt;denchmark-link:https://github.com/explosion/spaCy/issues/945&gt;#945&lt;/denchmark-link&gt;
  where people have faced issues for some particular versions of spaCy, but in my case its the same version as mentioned in the above link.
 &lt;denchmark-h:h2&gt;Info about spaCy&lt;/denchmark-h&gt;
 
 
 Python version: 2.7.13
 Platform: Windows-7-6.1.7601-SP1
 spaCy version: 2.0.11
 Models: en
 
 	</description>
 	<comments>
 		<comment id='1' author='kaushikacharya' date='2018-06-14T10:04:21Z'>
 		Do you have a more specific example or a screenshot? Here's the visualisation I get using the  module (also see the &lt;denchmark-link:https://explosion.ai/demos/displacy?text=Autonomous%20cars%20shift%20insurance%20liability%20toward%20manufacturers&amp;model=en_core_web_sm&amp;cpu=0&amp;cph=0&gt;online demo&lt;/denchmark-link&gt;
 ):
 &lt;denchmark-link:https://user-images.githubusercontent.com/13643239/41405459-14eee2c8-6fca-11e8-97aa-633b8948b33f.png&gt;&lt;/denchmark-link&gt;
 
 The head is always the root of the arrow, so "cars" points to "autonomous" and "shift" to "liability".
 		</comment>
 		<comment id='2' author='kaushikacharya' date='2018-06-14T13:08:51Z'>
 		&lt;denchmark-link:https://github.com/ines&gt;@ines&lt;/denchmark-link&gt;
 
 Attached: screenshot of the output in Windows 7 using python 2.7
 As you can see if I print the heads of dependency tree are correct but the plot is showing arcs in wrong direction (actually all in forward direction).
 Following are the commands used:
 &lt;denchmark-code&gt;import pandas as pd
 nlp = spacy.load('en_core_web_sm')
 doc = nlp(u"Autonomous cars shift insurance liability toward manufacturers")
 displacy.render(doc, style='dep', jupyter=True)
 &lt;/denchmark-code&gt;
 
 &lt;denchmark-link:https://user-images.githubusercontent.com/4562867/41413745-9d1c8f42-7001-11e8-9bec-e56c41a5e858.png&gt;&lt;/denchmark-link&gt;
 
 		</comment>
 		<comment id='3' author='kaushikacharya' date='2018-06-14T16:36:29Z'>
 		Thanks ‚Äì that's strange! ü§î There's definitely something wrong here ‚Äì it also seems like there's a problem with the dependency labels, because they're displayed underneath the arcs and not on top of them. I'll see if I can reproduce this result and get to the bottom of this.
 When you have a second, could you share the SVG markup that it generated for you and that has the same problem?
 		</comment>
 		<comment id='4' author='kaushikacharya' date='2018-06-15T05:12:51Z'>
 		Here's the svg it generated:
 u'&lt;svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="0" class="displacy" width="1275" height="398" style="max-width: none; height: 398px; color: #000000; background: #ffffff; font-family: Arial"&gt;\n&lt;text class="displacy-token" fill="currentColor" text-anchor="middle" y="308"&gt;\n    &lt;tspan class="displacy-word" fill="currentColor" x="50"&gt;Autonomous&lt;/tspan&gt;\n    &lt;tspan class="displacy-tag" dy="2em" fill="currentColor" x="50"&gt;ADJ&lt;/tspan&gt;\n&lt;/text&gt;\n\n&lt;text class="displacy-token" fill="currentColor" text-anchor="middle" y="308"&gt;\n    &lt;tspan class="displacy-word" fill="currentColor" x="225"&gt;cars&lt;/tspan&gt;\n    &lt;tspan class="displacy-tag" dy="2em" fill="currentColor" x="225"&gt;NOUN&lt;/tspan&gt;\n&lt;/text&gt;\n\n&lt;text class="displacy-token" fill="currentColor" text-anchor="middle" y="308"&gt;\n    &lt;tspan class="displacy-word" fill="currentColor" x="400"&gt;shift&lt;/tspan&gt;\n    &lt;tspan class="displacy-tag" dy="2em" fill="currentColor" x="400"&gt;VERB&lt;/tspan&gt;\n&lt;/text&gt;\n\n&lt;text class="displacy-token" fill="currentColor" text-anchor="middle" y="308"&gt;\n    &lt;tspan class="displacy-word" fill="currentColor" x="575"&gt;insurance&lt;/tspan&gt;\n    &lt;tspan class="displacy-tag" dy="2em" fill="currentColor" x="575"&gt;NOUN&lt;/tspan&gt;\n&lt;/text&gt;\n\n&lt;text class="displacy-token" fill="currentColor" text-anchor="middle" y="308"&gt;\n    &lt;tspan class="displacy-word" fill="currentColor" x="750"&gt;liability&lt;/tspan&gt;\n    &lt;tspan class="displacy-tag" dy="2em" fill="currentColor" x="750"&gt;NOUN&lt;/tspan&gt;\n&lt;/text&gt;\n\n&lt;text class="displacy-token" fill="currentColor" text-anchor="middle" y="308"&gt;\n    &lt;tspan class="displacy-word" fill="currentColor" x="925"&gt;toward&lt;/tspan&gt;\n    &lt;tspan class="displacy-tag" dy="2em" fill="currentColor" x="925"&gt;ADP&lt;/tspan&gt;\n&lt;/text&gt;\n\n&lt;text class="displacy-token" fill="currentColor" text-anchor="middle" y="308"&gt;\n    &lt;tspan class="displacy-word" fill="currentColor" x="1100"&gt;manufacturers&lt;/tspan&gt;\n    &lt;tspan class="displacy-tag" dy="2em" fill="currentColor" x="1100"&gt;NOUN&lt;/tspan&gt;\n&lt;/text&gt;\n\n&lt;g class="displacy-arrow"&gt;\n    &lt;path class="displacy-arc" id="arrow-0-0" stroke-width="2px" d="M70,263 C70,176 215,176 215,263" fill="none" stroke="currentColor"/&gt;\n    &lt;text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px"&gt;\n        &lt;textPath xlink:href="#arrow-0-0" class="displacy-label" startOffset="50%" fill="currentColor" text-anchor="middle"&gt;amod&lt;/textPath&gt;\n    &lt;/text&gt;\n    &lt;path class="displacy-arrowhead" d="M215,265 L223,253 207,253" fill="currentColor"/&gt;\n&lt;/g&gt;\n\n&lt;g class="displacy-arrow"&gt;\n    &lt;path class="displacy-arc" id="arrow-0-1" stroke-width="2px" d="M245,263 C245,176 390,176 390,263" fill="none" stroke="currentColor"/&gt;\n    &lt;text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px"&gt;\n        &lt;textPath xlink:href="#arrow-0-1" class="displacy-label" startOffset="50%" fill="currentColor" text-anchor="middle"&gt;nsubj&lt;/textPath&gt;\n    &lt;/text&gt;\n    &lt;path class="displacy-arrowhead" d="M390,265 L398,253 382,253" fill="currentColor"/&gt;\n&lt;/g&gt;\n\n&lt;g class="displacy-arrow"&gt;\n    &lt;path class="displacy-arc" id="arrow-0-2" stroke-width="2px" d="M595,263 C595,176 740,176 740,263" fill="none" stroke="currentColor"/&gt;\n    &lt;text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px"&gt;\n        &lt;textPath xlink:href="#arrow-0-2" class="displacy-label" startOffset="50%" fill="currentColor" text-anchor="middle"&gt;compound&lt;/textPath&gt;\n    &lt;/text&gt;\n    &lt;path class="displacy-arrowhead" d="M740,265 L748,253 732,253" fill="currentColor"/&gt;\n&lt;/g&gt;\n\n&lt;g class="displacy-arrow"&gt;\n    &lt;path class="displacy-arc" id="arrow-0-3" stroke-width="2px" d="M420,263 C420,88 745,88 745,263" fill="none" stroke="currentColor"/&gt;\n    &lt;text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px"&gt;\n        &lt;textPath xlink:href="#arrow-0-3" class="displacy-label" startOffset="50%" fill="currentColor" text-anchor="middle"&gt;dobj&lt;/textPath&gt;\n    &lt;/text&gt;\n    &lt;path class="displacy-arrowhead" d="M745,265 L753,253 737,253" fill="currentColor"/&gt;\n&lt;/g&gt;\n\n&lt;g class="displacy-arrow"&gt;\n    &lt;path class="displacy-arc" id="arrow-0-4" stroke-width="2px" d="M420,263 C420,1 925,1 925,263" fill="none" stroke="currentColor"/&gt;\n    &lt;text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px"&gt;\n        &lt;textPath xlink:href="#arrow-0-4" class="displacy-label" startOffset="50%" fill="currentColor" text-anchor="middle"&gt;prep&lt;/textPath&gt;\n    &lt;/text&gt;\n    &lt;path class="displacy-arrowhead" d="M925,265 L933,253 917,253" fill="currentColor"/&gt;\n&lt;/g&gt;\n\n&lt;g class="displacy-arrow"&gt;\n    &lt;path class="displacy-arc" id="arrow-0-5" stroke-width="2px" d="M945,263 C945,176 1090,176 1090,263" fill="none" stroke="currentColor"/&gt;\n    &lt;text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px"&gt;\n        &lt;textPath xlink:href="#arrow-0-5" class="displacy-label" startOffset="50%" fill="currentColor" text-anchor="middle"&gt;pobj&lt;/textPath&gt;\n    &lt;/text&gt;\n    &lt;path class="displacy-arrowhead" d="M1090,265 L1098,253 1082,253" fill="currentColor"/&gt;\n&lt;/g&gt;\n&lt;/svg&gt;'
 using the commands
 `
 
 
 
 doc = nlp(u"Autonomous cars shift insurance liability toward manufacturers")
 svg = spacy.displacy.render(doc, style="dep")
 from pathlib import Path
 import os
 output_path = Path(os.path.join("./", "sentence.svg"))
 output_path
 WindowsPath('sentence.svg')
 output_path.open('w', encoding="utf-8").write(svg)
 `
 
 
 
 &lt;denchmark-link:https://user-images.githubusercontent.com/4562867/41450988-5247fa42-7088-11e8-8a0f-977ebd92b17d.png&gt;&lt;/denchmark-link&gt;
 
 Here the dependency labels are displayed as in online demo i.e. just below the arcs. But the direction of arcs are not correct.
 		</comment>
 		<comment id='5' author='kaushikacharya' date='2018-07-04T06:58:48Z'>
 		I encounter the same problem. I'm trying to visualize my own graphs (manual=True), and also all the arcs are going to the right, without considering the 'dir' attribute in the JSON I give as input (the markup stays the same with 'left' and 'right' arcs).
 I managed to fix it on my local clone of spacy. I changed one line in /spacy/displacy/render.py (line 138, get_arrowhead function):
 instead of:
 if direction is 'left':
 I wrote:
 if direction == 'left':
 This way it will also be true if 'dir' value is a str (and not unicode, as it is expecting since it's importing unicode_literals). After this change, the arrows direction indeed was changed to left where it was supposed to, and the problem was fixed.
 If you can fix that, I think it might be the main source of the arc direction problem.
 		</comment>
 		<comment id='6' author='kaushikacharya' date='2018-07-04T10:35:03Z'>
 		&lt;denchmark-link:https://github.com/kleinay&gt;@kleinay&lt;/denchmark-link&gt;
 
 
 This way it will also be true if 'dir' value is a str (and not unicode, as it is expecting since it's importing unicode_literals). After this change, the arrows direction indeed was changed to left where it was supposed to, and the problem was fixed.
 
 Omg, yes, this makes lots of sense ü§¶‚Äç‚ôÄÔ∏è Thanks so much for getting to the bottom of this! (Can't believe I didn't catch that or even wrote this code in the first place, haha.)
 Would you like to submit a PR with your fix?
 		</comment>
 		<comment id='7' author='kaushikacharya' date='2018-08-03T12:15:35Z'>
 		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
 		</comment>
 	</comments>
 </bug>
<commit id='a82c3153ada16aeb9a3e34b9400084d1b5c3d546' author='kleinay' date='2018-07-04 14:12:08+02:00'>
 	<dmm_unit complexity='None' interfacing='None' size='None'></dmm_unit>
 	<modification change_type='MODIFY' old_name='spacy\displacy\render.py' new_name='spacy\displacy\render.py'>
 		<file_info nloc='136' complexity='36' token_count='1389'></file_info>
 		<method name='get_arrowhead' parameters='self,direction,x,y,end'>
 				<method_info nloc='9' complexity='2' token_count='104' nesting_level='1' start_line='130' end_line='146'></method_info>
 			<added_lines>139</added_lines>
 			<deleted_lines>139</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
