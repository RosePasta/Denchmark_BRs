<bug_data>
<bug id='4397' author='zrlaida' open_date='2019-10-08T07:48:16Z' closed_time='2019-10-08T10:07:03Z'>
 	<summary>PhraseMatcher does not execute callback function on matches</summary>
 	<description>
 &lt;denchmark-h:h2&gt;How to reproduce the behaviour&lt;/denchmark-h&gt;
 
 In the example from the documentation &lt;denchmark-link:https://spacy.io/api/phrasematcher&gt;https://spacy.io/api/phrasematcher&lt;/denchmark-link&gt;
 
 the callback function is not executed:
 &lt;denchmark-code&gt;import spacy
 
 nlp = spacy.load("en_core_web_sm")
 
 def on_match(matcher, doc, id, matches):
       print('Matched!', matches)
 
 matcher = spacy.matcher.PhraseMatcher(nlp.vocab)
 matcher.add("OBAMA", on_match, nlp("Barack Obama"))
 matcher.add("HEALTH", on_match, nlp("health care reform"),
                                   nlp("healthcare reform"))
 doc = nlp("Barack Obama urges Congress to find courage to defend his healthcare reforms")
 matches = matcher(doc)
 
 for match in matches:
     print("Match: ", match, nlp.vocab.strings[match[0]])
 &lt;/denchmark-code&gt;
 
 And another example:
 &lt;denchmark-code&gt;import spacy
 
 def on_match(matcher, doc, id, matches):
     print('Callback executes on matches!', matches)
 
 nlp = spacy.load("en_core_web_sm")
 matcher = spacy.matcher.PhraseMatcher(nlp.vocab)
 matcher.add("OBAMA", on_match, nlp("Barack Obama"))
 matcher.add("HEALTH", on_match, nlp("health care reform"), nlp("healthcare reform"))
 doc = nlp("Barack Obama urges Congress to find courage to defend his healthcare reform")
 print("Start matching. Print in on_match should come after this.")
 matches = matcher(doc)
 for match in matches:
     print("Match: ", match, nlp.vocab.strings[match[0]])
 &lt;/denchmark-code&gt;
 
 &lt;denchmark-h:h2&gt;My Environment&lt;/denchmark-h&gt;
 
 
 Operating System: MacOS 10.13.3
 Python Version Used: 3.7.0
 spaCy Version Used: 2.2.1
 Environment Information:
 
 	</description>
 	<comments>
 		<comment id='1' author='zrlaida' date='2019-10-08T07:56:32Z'>
 		Thanks for the report! This is a bug we should have caught before releasing 2.2. I'll fix it and update the test suite so similar issues are detected better in the future.
 (You can always edit the issue instead of opening a new one, it's no problem!)
 		</comment>
 		<comment id='2' author='zrlaida' date='2019-11-07T10:54:32Z'>
 		This thread has been automatically locked since there has not been any recent activity after it was closed. Please open a new issue for related bugs.
 		</comment>
 	</comments>
 </bug>
<commit id='14841d0aa63ccc48605757e5121cbb4170e7c7b2' author='adrianeboyd' date='2019-10-08 12:07:02+02:00'>
 	<dmm_unit complexity='1.0' interfacing='1.0' size='1.0'></dmm_unit>
 	<modification change_type='MODIFY' old_name='spacy\matcher\phrasematcher.pyx' new_name='spacy\matcher\phrasematcher.pyx'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines>228</added_lines>
 			<deleted_lines>228</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='spacy\tests\matcher\test_matcher_api.py' new_name='spacy\tests\matcher\test_matcher_api.py'>
 		<file_info nloc='345' complexity='38' token_count='3068'></file_info>
 		<method name='test_matcher_callback' parameters='en_vocab'>
 				<method_info nloc='8' complexity='1' token_count='73' nesting_level='0' start_line='424' end_line='431'></method_info>
 			<added_lines>424,425,426,427,428,429,430,431</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>6,422,423</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='spacy\tests\matcher\test_phrase_matcher.py' new_name='spacy\tests\matcher\test_phrase_matcher.py'>
 		<file_info nloc='187' complexity='14' token_count='1711'></file_info>
 		<method name='test_phrase_matcher_callback' parameters='en_vocab'>
 				<method_info nloc='8' complexity='1' token_count='78' nesting_level='0' start_line='221' end_line='228'></method_info>
 			<added_lines>221,222,223,224,225,226,227,228</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>5,219,220</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
