<bug_data>
<bug id='42' author='bamos' open_date='2015-10-29T12:53:58Z' closed_time='2016-02-17T19:05:02Z'>
 	<summary>Architecture issues with Torch.load</summary>
 	<description>
 From &lt;denchmark-link:https://github.com/ananghudaya&gt;@ananghudaya&lt;/denchmark-link&gt;
  in &lt;denchmark-link:https://github.com/cmusatyalab/openface/issues/26&gt;#26&lt;/denchmark-link&gt;
 :
 &lt;denchmark-code&gt;th&gt; net = torch.load('./models/openface/nn4.v1.t7')
 ...e/ananghudaya/torch/install/share/lua/5.1/torch/File.lua:289: table index is nil
 stack traceback:
     ...e/ananghudaya/torch/install/share/lua/5.1/torch/File.lua:289: in function 'readObject'
     ...e/ananghudaya/torch/install/share/lua/5.1/torch/File.lua:272: in function 'readObject'
     ...e/ananghudaya/torch/install/share/lua/5.1/torch/File.lua:311: in function 'load'
     [string "net = torch.load('./models/openface/nn4.v1.t7')"]:1: in main chunk
     [C]: in function 'xpcall'
     ...e/ananghudaya/torch/install/share/lua/5.1/trepl/init.lua:648: in function 'repl'
     ...daya/torch/install/lib/luarocks/rocks/trepl/scm-1/bin/th:185: in main chunk
     [C]: at 0x0804d6d0  
 &lt;/denchmark-code&gt;
 
 	</description>
 	<comments>
 		<comment id='1' author='bamos' date='2015-10-29T13:24:31Z'>
 		&lt;denchmark-link:https://github.com/ananghudaya&gt;@ananghudaya&lt;/denchmark-link&gt;
  - &lt;denchmark-link:https://github.com/teradeep/demo-apps/issues/4&gt;https://github.com/teradeep/demo-apps/issues/4&lt;/denchmark-link&gt;
  indicates this is an architecture issue, which is a problem with  I wasn't aware of, but is clearly in the documentation at &lt;denchmark-link:https://github.com/torch/torch7/blob/master/doc/serialization.md&gt;https://github.com/torch/torch7/blob/master/doc/serialization.md&lt;/denchmark-link&gt;
 . I saved the binary model in x86_64 and I think it's only compatible with x86_64. Are you using 32-bit x86 or ARM?
 I've saved the model in ASCII format. Can you download and  it from &lt;denchmark-link:http://openface-models.storage.cmusatyalab.org/nn4.v1.ascii.t7.xz&gt;here&lt;/denchmark-link&gt;
 .
 &lt;denchmark-code&gt;$ md5sum nn4.v1.ascii.t7
 735723e2c9cc4eefc00a7df34c9a4d3b  nn4.v1.ascii.t7
 &lt;/denchmark-code&gt;
 
 Try loading it with:
 &lt;denchmark-code&gt;$ th
 th&gt; require 'nn'
 th&gt; require 'dpnn'
 th&gt; net = torch.load('nn4.v1.ascii.t7', 'ascii')
 &lt;/denchmark-code&gt;
 
 If this works, I think you'll just need to replace  with  in the Python demos and make add  to   in &lt;denchmark-link:https://github.com/cmusatyalab/openface/blob/master/openface/openface_server.lua&gt;https://github.com/cmusatyalab/openface/blob/master/openface/openface_server.lua&lt;/denchmark-link&gt;
 .
 
  Even though the ascii model is larger, I'll use it in place of the binary one everywhere to avoid issues like this. Thanks for the useful info and for helping me improve the project. I'll make the changes over the next few days.
 
 		</comment>
 		<comment id='2' author='bamos' date='2015-10-30T06:49:06Z'>
 		Thanks &lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
 
 Still no luck in getting it right. I've downloaded and verified the ASCII model. Here is the output:
 &lt;denchmark-code&gt;th&gt; net = torch.load('nn4.v1.ascii.t7', 'ascii')
 cannot open &lt;nn4.v1.ascii.t7&gt; in mode r  at /home/ananghudaya/torch/pkg/torch/lib/TH/THDiskFile.c:484
 stack traceback:
     [C]: at 0xb720afc0
     [C]: in function 'DiskFile'
     ...e/ananghudaya/torch/install/share/lua/5.1/torch/File.lua:309: in function 'load'
     [string "net = torch.load('nn4.v1.ascii.t7', 'ascii')"]:1: in main chunk
     [C]: in function 'xpcall'
     ...e/ananghudaya/torch/install/share/lua/5.1/trepl/init.lua:648: in function 'repl'
     ...daya/torch/install/lib/luarocks/rocks/trepl/scm-1/bin/th:185: in main chunk
     [C]: at 0x0804d6d0  
 &lt;/denchmark-code&gt;
 
 I'm using a 32-bit machine.
 		</comment>
 		<comment id='3' author='bamos' date='2015-10-30T14:15:22Z'>
 		Hi Anang, this error looks like Torch can't find the file.
 Did you unxz it and check the md5sum?
 -Brandon.
 
 Anang Hudaya Muhamad Amin :: 2015-10-30 02:49 Fri:
 
 Thanks @bamos
 Still no luck in getting it right. Here is the output:
 th&gt; net = torch.load('nn4.v1.ascii.t7', 'ascii') cannot open &lt;nn4.v1.ascii.t7&gt; in mode r  at /home/ananghudaya/torch/pkg/torch/lib/TH/THDiskFile.c:484 stack traceback: [C]: at 0xb720afc0 [C]: in function 'DiskFile' ...e/ananghudaya/torch/install/share/lua/5.1/torch/File.lua:309: in function 'load' [string "net = torch.load('nn4.v1.ascii.t7', 'ascii')"]:1: in main chunk [C]: in function 'xpcall' ...e/ananghudaya/torch/install/share/lua/5.1/trepl/init.lua:648: in function 'repl' ...daya/torch/install/lib/luarocks/rocks/trepl/scm-1/bin/th:185: in main chunk [C]: at 0x0804d6d0
 I'm using a 32-bit machine.
 
 Reply to this email directly or view it on GitHub:
 #42 (comment)
 
 
 
 		</comment>
 		<comment id='4' author='bamos' date='2015-11-03T03:57:55Z'>
 		Hi &lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
 ,
 Yes I did. the md5 checksum is similar, and I have placed the file in the same folder as the other models.
 		</comment>
 		<comment id='5' author='bamos' date='2015-11-03T18:47:36Z'>
 		Please double check the path to the model.
 The error message you're getting is the same error message I get for incorrect paths.
 &lt;denchmark-code&gt;th&gt; model = torch.load('/tmp/does-not-exist.t7')
 cannot open &lt;/tmp/does-not-exist.t7&gt; in mode r  at /home/bamos/torch/pkg/torch/lib/TH/THDiskFile.c:484
 stack traceback:
     [C]: at 0x7f4389ef2a90
     [C]: in function 'DiskFile'
     /home/bamos/torch/install/share/lua/5.1/torch/File.lua:292: in function 'load'
     [string "model = torch.load('/tmp/does-not-exist.t7')"]:1: in main chunk
     [C]: in function 'xpcall'
     /home/bamos/torch/install/share/lua/5.1/trepl/init.lua:648: in function 'repl'
     ...amos/torch/install/lib/luarocks/rocks/trepl/scm-1/bin/th:185: in main chunk
     [C]: at 0x00406670
 &lt;/denchmark-code&gt;
 
 		</comment>
 		<comment id='6' author='bamos' date='2015-11-04T21:07:56Z'>
 		The ascii model loads in about 30-45 seconds for me and the x86 binary model loads in a few seconds. I'll add a fallback mechanism when we transition to a Lua server in &lt;denchmark-link:https://github.com/cmusatyalab/openface/issues/4&gt;#4&lt;/denchmark-link&gt;
  instead of a Lua subprocess so only non 64-bit x86 users will have the 30 second penalty, and it will only be for the first time they start the server, not every time they try to run a new Python program using OpenFace.
 		</comment>
 		<comment id='7' author='bamos' date='2015-11-17T14:20:59Z'>
 		i faced the same problem that torch cant load nn4.v1.ascii.t7. i downloaded nn4.v1.ascii.t7 and checked md5. as &lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
  sayed it caused by incorrect path,but i tried absolutely path.it still showed that
 cannot open &lt;nn4.v1.ascii.t7&gt; in mode r at /tmp/luarocks_torch-scm-1../torch7/lib/TH/THDiskFile.c :484
 		</comment>
 		<comment id='8' author='bamos' date='2015-11-17T19:40:14Z'>
 		Hi &lt;denchmark-link:https://github.com/snowlord&gt;@snowlord&lt;/denchmark-link&gt;
  - strange! Can you (or &lt;denchmark-link:https://github.com/ananghudaya&gt;@ananghudaya&lt;/denchmark-link&gt;
 ) try saving a small file in binary format, then loading it? Then doing the same with an ASCII-formatted file?
 &lt;denchmark-code&gt;/tmp$ th
 th&gt; t = torch.Tensor(10)
 th&gt; torch.save('test-binary.t7', t)
 th&gt; t2 = torch.load('test-binary.t7')
 th&gt; torch.save('test-ascii.t7', t, 'ascii')
 th&gt; t3 = torch.load('test-ascii.t7', 'ascii')
 th&gt; t:eq(t2):all()
 true
 th&gt; t:eq(t3):all()
 true
 &lt;/denchmark-code&gt;
 
 If this works, can you then try doing it in a different directory that's not your current working directory?
 		</comment>
 		<comment id='9' author='bamos' date='2015-11-24T08:42:49Z'>
 		hi,&lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
 ,i changed on the 64-bit x86,i have checked md5 of model file.it showed different problem.
 &lt;denchmark-code&gt;th&gt; torch.load('./models/openface/nn4.v1.t7')
 /usr/local/share/lua/5.1/torch/File.lua:294: unknown object
 stack traceback:
     [C]: in function 'error'
     /usr/local/share/lua/5.1/torch/File.lua:294: in function 'readObject'
     /usr/local/share/lua/5.1/torch/File.lua:240: in function 'readObject'
     /usr/local/share/lua/5.1/torch/File.lua:288: in function 'readObject'
     /usr/local/share/lua/5.1/torch/File.lua:272: in function 'readObject'
     /usr/local/share/lua/5.1/torch/File.lua:288: in function 'readObject'
     /usr/local/share/lua/5.1/torch/File.lua:288: in function 'readObject'
     /usr/local/share/lua/5.1/torch/File.lua:272: in function 'readObject'
     /usr/local/share/lua/5.1/torch/File.lua:319: in function 'load'
     [string "_RESULT={torch.load('./models/openface/nn4.v1..."]:1: in main chunk
     [C]: in function 'xpcall'
     /usr/local/share/lua/5.1/trepl/init.lua:650: in function 'repl'
     /usr/local/lib/luarocks/rocks/trepl/scm-1/bin/th:199: in main chunk
     [C]: at 0x00406260  
 &lt;/denchmark-code&gt;
 
 		</comment>
 		<comment id='10' author='bamos' date='2015-11-24T08:59:35Z'>
 		Hi &lt;denchmark-link:https://github.com/snowlord&gt;@snowlord&lt;/denchmark-link&gt;
  - interesting you're seeing that on 64-bit x86. Somebody in this thread on the torch mailing list got a similar  error and said it was an architecture issue: &lt;denchmark-link:https://groups.google.com/forum/#!msg/torch7/zNNdXATZxlA/z5A2HocVCgAJ&gt;https://groups.google.com/forum/#!msg/torch7/zNNdXATZxlA/z5A2HocVCgAJ&lt;/denchmark-link&gt;
 
 Does the ascii model work on your 64-bit x86 machine?
 		</comment>
 		<comment id='11' author='bamos' date='2015-12-06T14:29:55Z'>
 		Hi &lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
  ,
 I got the same problem:
 &lt;denchmark-code&gt;celeb-classifier.nn4.v1.pkl  cifar10-test.t7  cifar10torchsmall.zip  cifar10-train.t7  nn2.def.lua  nn4.def.lua  nn4.v1.ascii.t7  nn4.v1.t7
 -bash-4.1# th                                                                                                                              
 th&gt; require 'nn'
 {..........}
                                                                       [0.0143s]
 th&gt; require 'dpnn'                                                             
 true                                                                           
                                                                       [0.0113s]
 th&gt; net = torch.load('nn4.v1.t7')                               
 /usr/local/share/lua/5.1/torch/File.lua:241: Failed to load function from bytecode: (binary): cannot load incompatible bytecode
 stack traceback:
         [C]: in function 'error'
         /usr/local/share/lua/5.1/torch/File.lua:241: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:294: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:278: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:294: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:294: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:278: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:325: in function 'load'
         [string "net = torch.load('nn4.v1.t7')"]:1: in main chunk
         [C]: in function 'xpcall'
         /usr/local/share/lua/5.1/trepl/init.lua:668: in function 'repl'
         /usr/local/lib/luarocks/rocks/trepl/scm-1/bin/th:199: in main chunk
         [C]: at 0x004051e0
                                                                       [0.0005s]
 th&gt; net = torch.load('nn4.v1.ascii.t7', 'ascii')
 /usr/local/share/lua/5.1/torch/File.lua:241: Failed to load function from bytecode: (binary): cannot load incompatible bytecode
 stack traceback:
         [C]: in function 'error'
         /usr/local/share/lua/5.1/torch/File.lua:241: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:294: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:278: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:294: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:294: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:278: in function 'readObject'
         /usr/local/share/lua/5.1/torch/File.lua:325: in function 'load'
         [string "net = torch.load('nn4.v1.ascii.t7', 'ascii')"]:1: in main chunk
         [C]: in function 'xpcall'
         /usr/local/share/lua/5.1/trepl/init.lua:668: in function 'repl'
         /usr/local/lib/luarocks/rocks/trepl/scm-1/bin/th:199: in main chunk
         [C]: at 0x004051e0
                                                                       [0.0053s]
 th&gt; net = torch.load('cifar10-train.t7')
                                                                       [0.0134s]
 th&gt;
 &lt;/denchmark-code&gt;
 
 As you can see I had tried to load the model that you provided at this link:
 &lt;denchmark-link:https://groups.google.com/forum/#!msg/torch7/zNNdXATZxlA/z5A2HocVCgAJ&gt;https://groups.google.com/forum/#!msg/torch7/zNNdXATZxlA/z5A2HocVCgAJ&lt;/denchmark-link&gt;
 
 everything loads just fine.
 net = torch.load('cifar10-train.t7')
 when I tried to load the nn4.v1.t7 with no susses:
 net = torch.load('nn4.v1.t7')
 net = torch.load('nn4.v1.ascii.t7', 'ascii')
 I had done a md5sum test:
 &lt;denchmark-code&gt;md5sum models/{dlib/*.dat,openface/*.{pkl,t7}}
 73fde5e05226548677a050913eed4e04  models/dlib/shape_predictor_68_face_landmarks.dat
 c0675d57dc976df601b085f4af67ecb9  models/openface/celeb-classifier.nn4.v1.pkl
 735723e2c9cc4eefc00a7df34c9a4d3b  models/openface/nn4.v1.ascii.t7
 a59a5ec1938370cd401b257619848960  models/openface/nn4.v1.t7
 &lt;/denchmark-code&gt;
 
 I'm on x86_64 GNU/Linux.
 What seems to be the problem?
 Ilya
 		</comment>
 		<comment id='12' author='bamos' date='2015-12-06T15:00:28Z'>
 		It seems to be a problem of the  lua and luajit versions:
 -bash-4.1# lua -v
 Lua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio
 -bash-4.1# luajit -v
 LuaJIT 2.0.4 -- Copyright (C) 2005-2015 Mike Pall. &lt;denchmark-link:http://luajit.org/&gt;http://luajit.org/&lt;/denchmark-link&gt;
 
 I use these versions. Which version the model was complied with?
 Ilya
 		</comment>
 		<comment id='13' author='bamos' date='2015-12-06T20:30:21Z'>
 		 I use these versions. Which version the model was complied with?
 lua: Not installed on my system
 luajit: 2.1.0-alpha (from Torch)
 		</comment>
 		<comment id='14' author='bamos' date='2015-12-07T07:54:00Z'>
 		I had installed LuaJIT 2.1.0-beta1.
 now the command got no errors!!!
 net = torch.load('nn4.v1.t7')
 download from:
 &lt;denchmark-link:https://github.com/torch/luajit-rocks&gt;https://github.com/torch/luajit-rocks&lt;/denchmark-link&gt;
 
 make sure to add this option to the cmake "-DWITH_LUAJIT21=ON" !!!!!!!!!!!!!
 git clone &lt;denchmark-link:https://github.com/torch/luajit-rocks.git&gt;https://github.com/torch/luajit-rocks.git&lt;/denchmark-link&gt;
 
 cd luajit-rocks
 mkdir build
 cd build
 cmake .. -DWITH_LUAJIT21=ON
 		</comment>
 		<comment id='15' author='bamos' date='2015-12-20T10:04:29Z'>
 		Hi &lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
  ,
 I try to play with ARM 32 bit platform, and change the torch load model to
 net = torch.load('nn4.v1.ascii.t7', 'ascii')
 A strange thing is when I run the compare demo script I got following error message:
 Error getting result from Torch subprocess.
 Line read:
 Exception:
 could not convert string to float:
 &lt;denchmark-h:h1&gt;&lt;/denchmark-h&gt;
 
 stdout:
 &lt;denchmark-h:h1&gt;&lt;/denchmark-h&gt;
 
 stderr:
 I  tried to run the same code in X86_64 platform it's all OK since ascii version should be platform independent. Could you give some hint about this issue I had on ARM 32 bit platform? Thanks.
 		</comment>
 		<comment id='16' author='bamos' date='2015-12-20T23:10:07Z'>
 		Hi &lt;denchmark-link:https://github.com/lijian8&gt;@lijian8&lt;/denchmark-link&gt;
 ,
 
 stdout:
 
 stderr:
 
 Are these both empty? I would expect more content.
 
 I tried to run the same code in X86_64 platform it's all OK since
 ascii version should be platform indepedant. Could you give some
 hint about this issue I had on ARM 32 bit platform? Thanks.
 
 I don't have any experience executing on 32-bit ARM.
 Maybe the Torch community will be able to help if we can
 find a more informative error message.
 -Brandon.
 		</comment>
 		<comment id='17' author='bamos' date='2015-12-21T23:42:07Z'>
 		Hi &lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
 ,
 Yes these are empty. I'll try to run sunprocess directly on torch to see if I can catch up something.
 		</comment>
 		<comment id='18' author='bamos' date='2016-01-21T21:05:50Z'>
 		I had a very similar issue on Jetson TK1 board, here is a solution from another project that might help:
 &lt;denchmark-code&gt;git clone https://github.com/mvitez/torch7.git mvittorch7
 cd mvittorch7
 luarocks make rocks/torch-scm-1.rockspec
 &lt;/denchmark-code&gt;
 
 &lt;denchmark-code&gt;diff --git a/eval.lua b/eval.lua
 index 1814180..8cad5ba 100644
 --- a/eval.lua
 +++ b/eval.lua
 @@ -65,8 +65,21 @@ end
  -------------------------------------------------------------------------------
  -- Load the model checkpoint to evaluate
  -------------------------------------------------------------------------------
 +local function load(filename)
 +   local mode = 'binary'
 +   local referenced = true
 +   local file = torch.DiskFile(filename, 'r')
 +   file[mode](file)
 +   file:referenced(referenced)
 +   file:longSize(8)
 +   file:littleEndianEncoding()
 +   local object = file:readObject()
 +   file:close()
 +   return object
 +end
 +
  assert(string.len(opt.model) &gt; 0, 'must provide a model')
 -local checkpoint = torch.load(opt.model)
 +local checkpoint = load(opt.model)
  -- override and collect parameters
  if string.len(opt.input_h5) == 0 then opt.input_h5 = checkpoint.opt.input_h5 end
  if string.len(opt.input_json) == 0 then opt.input_json = checkpoint.opt.input_json end
 &lt;/denchmark-code&gt;
 
 		</comment>
 		<comment id='19' author='bamos' date='2016-02-02T01:41:16Z'>
 		I had the same issue. It was fixed by the comment from SyRenity:
 git clone &lt;denchmark-link:https://github.com/mvitez/torch7.git&gt;https://github.com/mvitez/torch7.git&lt;/denchmark-link&gt;
  mvittorch7
 cd mvittorch7
 luarocks make rocks/torch-scm-1.rockspec
 		</comment>
 		<comment id='20' author='bamos' date='2016-02-02T01:48:46Z'>
 		&lt;denchmark-link:https://github.com/jacklanchantin&gt;@jacklanchantin&lt;/denchmark-link&gt;
  glad it helped :)
 		</comment>
 		<comment id='21' author='bamos' date='2016-02-05T17:35:29Z'>
 		For information, &lt;denchmark-link:https://github.com/torch/torch7/pull/476&gt;torch/torch7#476&lt;/denchmark-link&gt;
  was merged into master some time ago, so all the changes in &lt;denchmark-link:https://github.com/mvitez&gt;@mvitez&lt;/denchmark-link&gt;
  branch were integrated to torch.
 		</comment>
 		<comment id='22' author='bamos' date='2016-02-10T08:46:54Z'>
 		Thanks &lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
  &lt;denchmark-link:https://github.com/SyRenity&gt;@SyRenity&lt;/denchmark-link&gt;
  &lt;denchmark-link:https://github.com/jacklanchantin&gt;@jacklanchantin&lt;/denchmark-link&gt;
 , this issue should be fixed with instruction from &lt;denchmark-link:https://github.com/SyRenity&gt;@SyRenity&lt;/denchmark-link&gt;
  .
 		</comment>
 		<comment id='23' author='bamos' date='2016-02-17T19:05:02Z'>
 		Great info, thanks all!
 		</comment>
 		<comment id='24' author='bamos' date='2016-03-18T14:55:44Z'>
 		&lt;denchmark-link:https://github.com/SyRenity&gt;@SyRenity&lt;/denchmark-link&gt;
  i am also working on TK1 but still get error when I load the binary model for openface. As mentioned before this issue should be fixed. Do you have any clue about my errors. Thanks:
 net = torch.load('/home/ubuntu/Downloads/face/openface/models/openface/nn4.small2.v1.t7')
 /home/ubuntu/torch/install/share/lua/5.1/torch/File.lua:370: table index is nil
 stack traceback:
 /home/ubuntu/torch/install/share/lua/5.1/torch/File.lua:370: in function 'readObject'
 /home/ubuntu/torch/install/share/lua/5.1/nn/Module.lua:158: in function 'read'
 /home/ubuntu/torch/install/share/lua/5.1/torch/File.lua:351: in function 'readObject'
 /home/ubuntu/torch/install/share/lua/5.1/torch/File.lua:409: in function 'load'
 [string "net = torch.load('/home/ubuntu/Downloads/face..."]:1: in main chunk
 [C]: in function 'xpcall'
 /home/ubuntu/torch/install/share/lua/5.1/trepl/init.lua:669: in function 'repl'
 ...untu/torch/install/lib/luarocks/rocks/trepl/scm-1/bin/th:199: in main chunk
 [C]: at 0x0000cff9
 		</comment>
 		<comment id='25' author='bamos' date='2016-03-18T15:18:23Z'>
 		Hi &lt;denchmark-link:https://github.com/ChrisYang&gt;@ChrisYang&lt;/denchmark-link&gt;
  - can you try using our ascii model from &lt;denchmark-link:http://openface-models.storage.cmusatyalab.org/nn4.small2.v1.ascii.t7.xz&gt;http://openface-models.storage.cmusatyalab.org/nn4.small2.v1.ascii.t7.xz&lt;/denchmark-link&gt;
 ? Unxz it and then use  mode in .
 		</comment>
 		<comment id='26' author='bamos' date='2016-03-19T02:54:38Z'>
 		&lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
  thanks for your prompt reply.
 Though I haven't found your ascii file, I managed to save a ascii version on a x86 machine and now I can load it from TK1.
 However I face some new issues. It runs ok using cpu mode but very slowly on TK1. When I tried to call net:forward in cuda mode i got cuda runtime error 'too many resources requested for launch at xxx'. Do you have any clue how to solve this?
 		</comment>
 		<comment id='27' author='bamos' date='2016-06-03T09:25:56Z'>
 		&lt;denchmark-link:https://github.com/shimen&gt;@shimen&lt;/denchmark-link&gt;
  Hi, I have the same problem as you, "File.lua failed to load function from bytecode binary string: not a precompiled chunk", and I also updated my luajit version to be 2.1 beta, but it still failed, I don't what to do now? Could anyone help? Thanks.
 		</comment>
 		<comment id='28' author='bamos' date='2016-06-05T11:01:48Z'>
 		&lt;denchmark-link:https://github.com/apeterswu&gt;@apeterswu&lt;/denchmark-link&gt;
  Hi, I'm not sure what is the problem. Since openFace version 0.2 I do not have to use this command.
 		</comment>
 		<comment id='29' author='bamos' date='2016-07-10T12:35:46Z'>
 		Subject: openface
 root@tegra-ubuntu:~/openface/openface# ./demos/compare.py images/examples/{lennon_,clapton_}
 /home/ubuntu/torch/install/bin/luajit: /home/ubuntu/torch/install/share/lua/5.1/torch/File.lua:370: table index is nil
 stack traceback:
 /home/ubuntu/torch/install/share/lua/5.1/torch/File.lua:370: in function 'readObject'
 /home/ubuntu/torch/install/share/lua/5.1/nn/Module.lua:158: in function 'read'
 /home/ubuntu/torch/install/share/lua/5.1/torch/File.lua:351: in function 'readObject'
 /home/ubuntu/torch/install/share/lua/5.1/torch/File.lua:409: in function 'load'
 ...lib/python2.7/dist-packages/openface/openface_server.lua:46: in main chunk
 [C]: in function 'dofile'
 ...untu/torch/install/lib/luarocks/rocks/trepl/scm-1/bin/th:145: in main chunk
 [C]: at 0x0000cff9
 Traceback (most recent call last):
 File "./demos/compare.py", line 101, in 
 d = getRep(img1) - getRep(img2)
 File "./demos/compare.py", line 92, in getRep
 rep = net.forward(alignedFace)
 File "/usr/local/lib/python2.7/dist-packages/openface/torch_neural_net.py", line 156, in forward
 rep = self.forwardPath(t)
 File "/usr/local/lib/python2.7/dist-packages/openface/torch_neural_net.py", line 113, in forwardPath
 """.format(self.cmd, self.p.stdout.read()))
 Exception:
 OpenFace: openface_server.lua subprocess has died.
 
 Is the Torch command th on your PATH? Check with which th.
 If th is on your PATH, try running ./util/profile-network.lua
 to see if Torch can correctly load and run the network.
 
 If this gives illegal instruction errors, see the section on
 this in our FAQ at http://cmusatyalab.github.io/openface/faq/
 In Docker, use a Bash login shell or source
 /root/torch/install/bin/torch-activate for the Torch environment.
 
 
 See this GitHub issue if you are running on a non-64-bit machine:
 #42
 
 Please post further issues to our mailing list at
 https://groups.google.com/forum/#!forum/cmu-openface
 Diagnostic information:
 cmd: ['/usr/bin/env', 'th', '/usr/local/lib/python2.7/dist-packages/openface/openface_server.lua', '-model', '/home/ubuntu/openface/openface/demos/../models/openface/nn4.small2.v1.t7', '-imgDim', '96']
 stdout:
 
 is anyone encountered such a problem?
 my email is &lt;denchmark-link:mailto:329410527@qq.com&gt;329410527@qq.com&lt;/denchmark-link&gt;
 
 Thank you very much.
 		</comment>
 		<comment id='30' author='bamos' date='2016-07-14T17:44:59Z'>
 		&lt;denchmark-link:http://openface-models.storage.cmusatyalab.org/nn4.small2.v1.ascii.t7.xz&gt;ASCII model for nn4.small2.v1&lt;/denchmark-link&gt;
 
 		</comment>
 		<comment id='31' author='bamos' date='2016-07-19T11:13:54Z'>
 		Some users following this issue may also be interested in helping improve dlib and its face detector's speed on ARM by adding NEON instructions. Contact &lt;denchmark-link:https://github.com/davisking&gt;@davisking&lt;/denchmark-link&gt;
  if interested. &lt;denchmark-link:https://github.com/cmusatyalab/openface/issues/157#issuecomment-233599719&gt;Here&lt;/denchmark-link&gt;
  is his comment from another thread:
 
 NEON instructions are similar enough in overall structure that you should
 be able to implement alternative versions of the simd classes in dlib (e.g.
 https://github.com/davisking/dlib/blob/master/dlib/simd/simd8f.h).  All the
 simd usage is through these classes, so if there were NEON versions of them
 then things would be much faster on ARM.  I've had this on my todo list for
 a long time but haven't gotten around to it yet.  You should give it a go :)
 
 		</comment>
 		<comment id='32' author='bamos' date='2016-08-02T18:13:06Z'>
 		&lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
  do you know of anyone successfully getting &lt;denchmark-link:http://cmusatyalab.github.io/openface/demo-2-comparison/&gt;this&lt;/denchmark-link&gt;
  to work on a raspberry pi? As it is driving me crazy. I have got &lt;denchmark-link:https://github.com/cmusatyalab/openface/issues/42#issuecomment-152177965&gt;this&lt;/denchmark-link&gt;
  working. (it takes 18 seconds?!). I change this &lt;denchmark-link:https://github.com/cmusatyalab/openface/blob/master/demos/compare.py#L46&gt;line&lt;/denchmark-link&gt;
  to the  file and then try run again but I get a  error. Any ideas?
 		</comment>
 		<comment id='33' author='bamos' date='2016-08-23T13:37:39Z'>
 		&lt;denchmark-link:https://github.com/maxisme&gt;@maxisme&lt;/denchmark-link&gt;
  : I got it solved. Refer &lt;denchmark-link:https://github.com/cmusatyalab/openface/issues/169&gt;issue&lt;/denchmark-link&gt;
 
 		</comment>
 		<comment id='34' author='bamos' date='2016-11-02T13:00:33Z'>
 		Hey &lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
 ,
 I've been trying to use the Docker container in Ubuntu 14.04 on 64 bit x86 architecture. I have switched to the ascii model and I'm getting the same error as weiqifa0 above. I'm not quite sure where to go from here other than performing a fresh by hand install of Openface, which I want to avoid. Any suggestions would be great!
 Exception in thread frame_process_thread_0:
 Traceback (most recent call last):
 File "/usr/lib/python2.7/threading.py", line 810, in __bootstrap_inner
 self.run()
 File "/usr/lib/python2.7/threading.py", line 763, in run
 self.__target(_self.__args, *_self.__kwargs)
 File "/host/system/SurveillanceSystem.py", line 534, in process_frame
 predictions, alignedFace =  self.recogniser.make_prediction(personimg,face_bb)
 File "/host/system/FaceRecogniser.py", line 111, in make_prediction
 persondict = self.recognize_face(alignedFace)
 File "/host/system/FaceRecogniser.py", line 121, in recognize_face
 if self.getRep(img) is None:
 File "/host/system/FaceRecogniser.py", line 145, in getRep
 rep = self.net.forward(alignedFace) # Gets embedding - 128 measurements
 File "/usr/local/lib/python2.7/dist-packages/openface/torch_neural_net.py", line 156, in forward
 rep = self.forwardPath(t)
 File "/usr/local/lib/python2.7/dist-packages/openface/torch_neural_net.py", line 113, in forwardPath
 """.format(self.cmd, self.p.stdout.read()))
 Exception:
 OpenFace: openface_server.lua subprocess has died.
 
 Is the Torch command th on your PATH? Check with which th.
 If th is on your PATH, try running ./util/profile-network.lua
 to see if Torch can correctly load and run the network.
 
 If this gives illegal instruction errors, see the section on
 this in our FAQ at http://cmusatyalab.github.io/openface/faq/
 In Docker, use a Bash login shell or source
 /root/torch/install/bin/torch-activate for the Torch environment.
 
 
 See this GitHub issue if you are running on a non-64-bit machine:
 #42
 Please post further issues to our mailing list at
 https://groups.google.com/forum/#!forum/cmu-openface
 
 Diagnostic information:
 cmd: ['/usr/bin/env', 'th', '/usr/local/lib/python2.7/dist-packages/openface/openface_server.lua', '-model', '/host/system/../models/openface/nn4.small2.v1.ascii.t7', '-imgDim', '96']
 &lt;denchmark-h:h1&gt;&lt;/denchmark-h&gt;
 
 		</comment>
 		<comment id='35' author='bamos' date='2016-11-02T13:26:45Z'>
 		Don't worry just tested with Docker in a Ubuntu VM and worked perfectly :) not sure what the issue was.
 		</comment>
 		<comment id='36' author='bamos' date='2017-04-02T13:54:52Z'>
 		hey &lt;denchmark-link:https://github.com/bamos&gt;@bamos&lt;/denchmark-link&gt;
 ,
 as you have said to save the model in ascii format i have saved it and i have tried these commands they are perfectly working
 $ th
 th&gt; require 'nn'
 th&gt; require 'dpnn'
 th&gt; net = torch.load('nn4.v1.ascii.t7', 'ascii')
 but again when i try this `command ./demos/classifier.py infer ./generated-embeddings/classifier.pkl your_test_image.jpg
 this is the error i am getting
 /home/pi/torch/install/share/lua/5.1/torch/File.lua:375: unknown object
 stack traceback:
 [C]: in function 'error'
 /home/pi/torch/install/share/lua/5.1/torch/File.lua:375: in function 'readObject'
 /home/pi/torch/install/share/lua/5.1/torch/File.lua:409: in function 'load'
 &lt;denchmark-code&gt;./batch-represent/main.lua:33: in main chunk
 [C]: in function 'dofile'
 ...e/pi/torch/install/lib/luarocks/rocks/trepl/scm-1/bin/th:150: in main chunk
 [C]: at 0x00014fa8
 &lt;/denchmark-code&gt;
 
 		</comment>
 		<comment id='37' author='bamos' date='2017-05-02T17:14:03Z'>
 		Had the same issue on ubuntu 16.04 | torch7. The ascii loading method worked with the provided ascii model download link. Just had to modify the ./batch-represent/opt.lua and main.lua file that the model gets loaded from in the example on the openface website for testing classification. However trying to run the ./demo/compare.py example that uses the openface python api suffers the same error. It seems if the torch_neural_net.py file's cmd could accept an ascii option it might be a way to curtail it?
 self.cmd = ['/usr/bin/env', 'th', os.path.join(myDir, 'openface_server.lua'), '-model', model, '-imgDim', str(imgDim)]
 --  update
 I also modified the torch_neural_net.py and openface_server.lua to include the ascii argument and it indeed works as well.
 		</comment>
 		<comment id='38' author='bamos' date='2019-05-21T17:09:33Z'>
 		is it CNN
 		</comment>
 		<comment id='39' author='bamos' date='2019-05-21T17:10:26Z'>
 		real time and web based...
 		</comment>
 	</comments>
 </bug>
<commit id='5adf826d9d9b9c275bba62e5b5c350e142781ab8' author='Brandon Amos' date='2015-11-04 16:05:33-05:00'>
 	<dmm_unit complexity='None' interfacing='None' size='None'></dmm_unit>
 	<modification change_type='MODIFY' old_name='docs\setup.md' new_name='docs\setup.md'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines>13,14,15</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
