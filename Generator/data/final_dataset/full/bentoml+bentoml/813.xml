<bug_data>
<bug id='813' author='alexnsfx' open_date='2020-06-17T18:07:24Z' closed_time='2020-06-24T03:34:20Z'>
 	<summary>TfTensorOutput casts floats as ints</summary>
 	<description>
 Describe the bug
 TfTensorOutput casts floats as ints in tensor output because of bentoml.adapters.utils.tf_tensor_2_serializable().
 To Reproduce
 Steps to reproduce the behavior:
 
 Define a Tensorflow 2.0 model that returns float output
 Define a BentoService that uses TfTensorOutput. TfTensorOutput is implicitly used by DefaultOutput when no output adapter is defined like below:
 
 @bentoml.env(pip_dependencies=["tensorflow==2.0", "numpy&gt;=1.18.2", "pandas&gt;=1.0.3"])
 @bentoml.artifacts([TensorflowSavedModelArtifact("model")])
 class MyModelService(bentoml.BentoService):
 
     @bentoml.api(input=TfTensorInput())
     def predict(self, inputs):
         return self.artifacts.model(inputs)
 
 pack() your model with the service
 Serve it with bentoml serve MyModelService:latest
 Send a request
 
 curl -X POST 'http://127.0.0.1:5000/predict' \
 --header 'Content-Type: application/json' \
 --data-raw '{"instances": [an-input-for-your-model]}'
 
 Observe output: [[0, 0, 0, 0]]
 
 Expected behavior
 Output should be floats.
 E.g. [[-0.05740901082754135, 0.012774493545293808, 0.021846788004040718, -0.07579610496759415]]
 Environment:
 
 OS: Ubuntu 18.04.4
 Python 3.7.7
 bentoml, version 0.8.1
 
 Additional context
 This is caused by the cast happening &lt;denchmark-link:https://github.com/bentoml/BentoML/blob/a134e3a/bentoml/adapters/utils.py#L41-L48&gt;here&lt;/denchmark-link&gt;
 .
 int-cast is tried first and will succeed on float data.
 Relying on &lt;denchmark-link:https://numpy.org/devdocs/reference/generated/numpy.ndarray.dtype.html&gt;numpy.ndarray.dtype&lt;/denchmark-link&gt;
  to know the cast destination is probably safer.
 	</description>
 	<comments>
 		<comment id='1' author='alexnsfx' date='2020-06-17T20:04:10Z'>
 		cc &lt;denchmark-link:https://github.com/bojiang&gt;@bojiang&lt;/denchmark-link&gt;
 
 		</comment>
 		<comment id='2' author='alexnsfx' date='2020-06-24T03:34:20Z'>
 		Addressed in &lt;denchmark-link:https://github.com/bentoml/BentoML/pull/823&gt;#823&lt;/denchmark-link&gt;
 , will be available in release 0.8.2
 		</comment>
 	</comments>
 </bug>
<commit id='818f648b2c36548a7731d4f01cf6f4b9040517fa' author='bojiang' date='2020-06-23 11:41:16-07:00'>
 	<dmm_unit complexity='1.0' interfacing='1.0' size='1.0'></dmm_unit>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\base_input.py' new_name='bentoml\adapters\base_input.py'>
 		<file_info nloc='51' complexity='13' token_count='264'></file_info>
 		<method name='is_batch_request' parameters='self,request'>
 				<method_info nloc='4' complexity='2' token_count='42' nesting_level='1' start_line='46' end_line='49'></method_info>
 			<added_lines>46,47,48,49</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>18,50</added_lines>
 			<deleted_lines>18,19,29</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\base_output.py' new_name='bentoml\adapters\base_output.py'>
 		<file_info nloc='39' complexity='7' token_count='178'></file_info>
 		<method name='to_response' parameters='self,result,Request'>
 				<method_info nloc='9' complexity='1' token_count='53' nesting_level='1' start_line='35' end_line='43'></method_info>
 			<added_lines>41,43</added_lines>
 			<deleted_lines>41,43</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines>44,45,46,47</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\dataframe_input.py' new_name='bentoml\adapters\dataframe_input.py'>
 		<file_info nloc='200' complexity='34' token_count='1005'></file_info>
 		<method name='handle_request' parameters='self,request,func'>
 				<method_info nloc='21' complexity='5' token_count='121' nesting_level='1' start_line='146' end_line='169'></method_info>
 			<added_lines>147,149,155</added_lines>
 			<deleted_lines>146,148,154</deleted_lines>
 		</method>
 		<method name='handle_request' parameters='self,Request,func'>
 				<method_info nloc='21' complexity='5' token_count='129' nesting_level='1' start_line='147' end_line='170'></method_info>
 			<added_lines>147,149,155</added_lines>
 			<deleted_lines>148,154</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>24</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\default_output.py' new_name='bentoml\adapters\default_output.py'>
 		<file_info nloc='65' complexity='15' token_count='315'></file_info>
 		<method name='detect_suitable_adapter' parameters='result,slices'>
 				<method_info nloc='23' complexity='9' token_count='118' nesting_level='0' start_line='21' end_line='51'></method_info>
 			<added_lines>42,43,44,45,46,47,48</added_lines>
 			<deleted_lines>22,23,24,25,26,27,28</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\image_input.py' new_name='bentoml\adapters\image_input.py'>
 		<file_info nloc='181' complexity='26' token_count='913'></file_info>
 		<modified_lines>
 			<added_lines>99</added_lines>
 			<deleted_lines>99</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\json_input.py' new_name='bentoml\adapters\json_input.py'>
 		<file_info nloc='75' complexity='8' token_count='486'></file_info>
 		<method name='handle_request' parameters='self,request,func'>
 				<method_info nloc='10' complexity='2' token_count='56' nesting_level='1' start_line='37' end_line='47'></method_info>
 			<added_lines>39,41</added_lines>
 			<deleted_lines>37,39</deleted_lines>
 		</method>
 		<method name='handle_request' parameters='self,Request,func'>
 				<method_info nloc='10' complexity='2' token_count='62' nesting_level='1' start_line='39' end_line='49'></method_info>
 			<added_lines>39,41</added_lines>
 			<deleted_lines>39</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>20,21,60</added_lines>
 			<deleted_lines>58,59,60,61,62,63,64</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\json_output.py' new_name='bentoml\adapters\json_output.py'>
 		<file_info nloc='60' complexity='5' token_count='366'></file_info>
 		<method name='jsonize' parameters='result'>
 				<method_info nloc='5' complexity='2' token_count='39' nesting_level='0' start_line='38' end_line='43'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>38,39,40,41,42,43</deleted_lines>
 		</method>
 		<method name='to_cli' parameters='self,result,args'>
 				<method_info nloc='9' complexity='2' token_count='76' nesting_level='1' start_line='68' end_line='83'></method_info>
 			<added_lines>80</added_lines>
 			<deleted_lines>79</deleted_lines>
 		</method>
 		<method name='default' parameters='self,o'>
 				<method_info nloc='6' complexity='3' token_count='50' nesting_level='1' start_line='28' end_line='35'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>28,29,30,31,32,33,34,35</deleted_lines>
 		</method>
 		<method name='to_aws_lambda_event' parameters='self,result,event'>
 				<method_info nloc='9' complexity='2' token_count='57' nesting_level='1' start_line='85' end_line='97'></method_info>
 			<added_lines>87</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>21,58</added_lines>
 			<deleted_lines>18,25,26,27,36,37,44,45,101,108</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\multi_image_input.py' new_name='bentoml\adapters\multi_image_input.py'>
 		<file_info nloc='58' complexity='4' token_count='136'></file_info>
 		<modified_lines>
 			<added_lines>62,63,64</added_lines>
 			<deleted_lines>62</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\tensorflow_tensor_input.py' new_name='bentoml\adapters\tensorflow_tensor_input.py'>
 		<file_info nloc='127' complexity='15' token_count='740'></file_info>
 		<method name='_handle_raw_str' parameters='self,raw_str,func'>
 				<method_info nloc='9' complexity='3' token_count='70' nesting_level='1' start_line='85' end_line='96'></method_info>
 			<added_lines>88</added_lines>
 			<deleted_lines>89,92</deleted_lines>
 		</method>
 		<method name='b64_hook' parameters='o'>
 				<method_info nloc='4' complexity='3' token_count='29' nesting_level='0' start_line='27' end_line='30'></method_info>
 			<added_lines>27,28,29,30</added_lines>
 			<deleted_lines>30</deleted_lines>
 		</method>
 		<method name='handle_request' parameters='self,request,func'>
 				<method_info nloc='4' complexity='1' token_count='39' nesting_level='1' start_line='144' end_line='156'></method_info>
 			<added_lines>154,155,156</added_lines>
 			<deleted_lines>147,149</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>15,18,20,21,23,102,115,116</added_lines>
 			<deleted_lines>16,19,20,21,22,23,24,26,31,104,106,118,119,120,121,122,123,124,125,130,166,167,168,169,170,171,172,173,174</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\tensorflow_tensor_output.py' new_name='bentoml\adapters\tensorflow_tensor_output.py'>
 		<file_info nloc='71' complexity='11' token_count='447'></file_info>
 		<method name='to_cli' parameters='self,result,args'>
 				<method_info nloc='9' complexity='2' token_count='80' nesting_level='1' start_line='82' end_line='97'></method_info>
 			<added_lines>83,84,91,94</added_lines>
 			<deleted_lines>83,89,90,91,92</deleted_lines>
 		</method>
 		<method name='tf_to_numpy' parameters='tensor'>
 				<method_info nloc='9' complexity='4' token_count='69' nesting_level='0' start_line='27' end_line='41'></method_info>
 			<added_lines>27,28,29,30,31,32,33,34,35,36,37,38,39,40,41</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='to_aws_lambda_event' parameters='self,result,event'>
 				<method_info nloc='9' complexity='2' token_count='57' nesting_level='1' start_line='99' end_line='108'></method_info>
 			<added_lines>100</added_lines>
 			<deleted_lines>100</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>15,16,19,23,65,66,68,70,77,78</added_lines>
 			<deleted_lines>21,22,25,49,50,51,52,54,56,57,64,65,67,71,78,80,81</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\adapters\utils.py' new_name='bentoml\adapters\utils.py'>
 		<file_info nloc='54' complexity='16' token_count='353'></file_info>
 		<method name='tf_b64_2_bytes' parameters='obj'>
 				<method_info nloc='6' complexity='3' token_count='33' nesting_level='0' start_line='4' end_line='10'></method_info>
 			<added_lines>7,8,10</added_lines>
 			<deleted_lines>4,5,7,8,9,10</deleted_lines>
 		</method>
 		<method name='concat_list' parameters='lst,batch_flags'>
 				<method_info nloc='19' complexity='6' token_count='123' nesting_level='0' start_line='57' end_line='85'></method_info>
 			<added_lines>83</added_lines>
 			<deleted_lines>57,58,59,60,61,62,63,65,68,69,70,71,72,74,75,77,78,79,80,82,83,84,85</deleted_lines>
 		</method>
 		<method name='__call__' parameters='self,obj'>
 				<method_info nloc='10' complexity='7' token_count='81' nesting_level='1' start_line='77' end_line='87'></method_info>
 			<added_lines>83</added_lines>
 			<deleted_lines>77,78,79,80,82,83,84,85,86,87</deleted_lines>
 		</method>
 		<method name='default' parameters='self,o'>
 				<method_info nloc='11' complexity='4' token_count='75' nesting_level='1' start_line='10' end_line='22'></method_info>
 			<added_lines>10,11,13,14,15,16,17,19,20,21,22</added_lines>
 			<deleted_lines>10,13,14,16,17,18,19,22</deleted_lines>
 		</method>
 		<method name='bytes_2_tf_b64' parameters='obj'>
 				<method_info nloc='6' complexity='2' token_count='35' nesting_level='0' start_line='13' end_line='19'></method_info>
 			<added_lines>13,14,15,16,17,19</added_lines>
 			<deleted_lines>13,14,16,17,18,19</deleted_lines>
 		</method>
 		<method name='tf_tensor_2_serializable' parameters='obj'>
 				<method_info nloc='29' complexity='9' token_count='161' nesting_level='0' start_line='22' end_line='65'></method_info>
 			<added_lines>22,25,26,28,29,31,32,34,35,37,40,41,43,44,45,46,47,48,49,50,51,52,53,54</added_lines>
 			<deleted_lines>22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,65</deleted_lines>
 		</method>
 		<method name='__init__' parameters='self,converter'>
 				<method_info nloc='2' complexity='1' token_count='12' nesting_level='1' start_line='74' end_line='75'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>74,75</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>1,2,3</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\marshal\marshal.py' new_name='bentoml\marshal\marshal.py'>
 		<file_info nloc='235' complexity='27' token_count='1476'></file_info>
 		<method name='request_dispatcher' parameters='self,request'>
 				<method_info nloc='27' complexity='4' token_count='162' nesting_level='1' start_line='194' end_line='221'></method_info>
 			<added_lines>205</added_lines>
 			<deleted_lines>205</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\marshal\utils.py' new_name='bentoml\marshal\utils.py'>
 		<file_info nloc='86' complexity='17' token_count='536'></file_info>
 		<method name='from_flask_request' parameters='cls,request'>
 				<method_info nloc='2' complexity='1' token_count='23' nesting_level='1' start_line='25' end_line='26'></method_info>
 			<added_lines>25,26</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='to_flask_response' parameters='self'>
 				<method_info nloc='5' complexity='1' token_count='30' nesting_level='1' start_line='34' end_line='39'></method_info>
 			<added_lines>34,35,36,37,38,39</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>5,6,7,8,24,27,40</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\server\bento_api_server.py' new_name='bentoml\server\bento_api_server.py'>
 		<file_info nloc='211' complexity='37' token_count='1243'></file_info>
 		<method name='feedback_view_func' parameters='bento_service'>
 				<method_info nloc='14' complexity='4' token_count='118' nesting_level='1' start_line='139' end_line='161'></method_info>
 			<added_lines>149</added_lines>
 			<deleted_lines>149</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='bentoml\service.py' new_name='bentoml\service.py'>
 		<file_info nloc='430' complexity='93' token_count='2163'></file_info>
 		<method name='handle_batch_request' parameters='self,request'>
 				<method_info nloc='9' complexity='1' token_count='58' nesting_level='1' start_line='126' end_line='134'></method_info>
 			<added_lines>128,129</added_lines>
 			<deleted_lines>126,127</deleted_lines>
 		</method>
 		<method name='handle_request' parameters='self,request'>
 				<method_info nloc='2' complexity='1' token_count='20' nesting_level='1' start_line='123' end_line='124'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>123</deleted_lines>
 		</method>
 		<method name='handle_batch_request' parameters='self,Request'>
 				<method_info nloc='9' complexity='1' token_count='64' nesting_level='1' start_line='128' end_line='136'></method_info>
 			<added_lines>128,129</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='handle_request' parameters='self,Request'>
 				<method_info nloc='2' complexity='1' token_count='24' nesting_level='1' start_line='125' end_line='126'></method_info>
 			<added_lines>125</added_lines>
 			<deleted_lines>126</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>23,24</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='tests\handlers\test_dataframe_handler.py' new_name='tests\handlers\test_dataframe_handler.py'>
 		<file_info nloc='203' complexity='31' token_count='1552'></file_info>
 		<method name='test_dataframe_handle_request_csv' parameters=''>
 				<method_info nloc='10' complexity='1' token_count='73' nesting_level='0' start_line='113' end_line='125'></method_info>
 			<added_lines>119,122</added_lines>
 			<deleted_lines>117,120</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>6,7,21,23</added_lines>
 			<deleted_lines>19,21</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='tests\handlers\test_image_handler.py' new_name='tests\handlers\test_image_handler.py'>
 		<file_info nloc='107' complexity='12' token_count='768'></file_info>
 		<method name='test_image_input_http_request_post_binary' parameters='img_file'>
 				<method_info nloc='14' complexity='1' token_count='124' nesting_level='0' start_line='56' end_line='73'></method_info>
 			<added_lines>69</added_lines>
 			<deleted_lines>69</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='tests\handlers\test_tf_tensor_handler.py' new_name='tests\handlers\test_tf_tensor_handler.py'>
 		<file_info nloc='97' complexity='14' token_count='769'></file_info>
 		<method name='test_tf_tensor_handle_request' parameters=''>
 				<method_info nloc='11' complexity='2' token_count='90' nesting_level='0' start_line='77' end_line='94'></method_info>
 			<added_lines>88,89,90,91,92</added_lines>
 			<deleted_lines>77,83,89,90,91,93,94</deleted_lines>
 		</method>
 		<method name='test_cases' parameters='request'>
 				<method_info nloc='2' complexity='1' token_count='9' nesting_level='0' start_line='89' end_line='90'></method_info>
 			<added_lines>89,90</added_lines>
 			<deleted_lines>89,90</deleted_lines>
 		</method>
 		<method name='test_tf_tensor_handle_request' parameters='test_cases'>
 				<method_info nloc='12' complexity='1' token_count='98' nesting_level='0' start_line='100' end_line='119'></method_info>
 			<added_lines>100,106,107,113,114,115,116,118,119</added_lines>
 			<deleted_lines>104,106,107,108,110,111,112</deleted_lines>
 		</method>
 		<method name='test_tf_tensor_handle_batch_request' parameters=''>
 				<method_info nloc='10' complexity='3' token_count='86' nesting_level='0' start_line='97' end_line='112'></method_info>
 			<added_lines>100,106,107</added_lines>
 			<deleted_lines>97,104,106,107,108,110,111,112</deleted_lines>
 		</method>
 		<method name='test_tf_tensor_handle_batch_request' parameters='test_cases'>
 				<method_info nloc='14' complexity='2' token_count='107' nesting_level='0' start_line='122' end_line='141'></method_info>
 			<added_lines>122,127,130,132,133,134,135,136,137,139,140,141</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>1,7,8,10,13,15,16,17,55,65,66,67,68,69,70,71,72,73,74,75,76</added_lines>
 			<deleted_lines>9,11,49</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='tests\handlers\test_utils.py' new_name='tests\handlers\test_utils.py'>
 		<file_info nloc='59' complexity='9' token_count='263'></file_info>
 		<method name='test_concat_lists_with_flags' parameters=''>
 				<method_info nloc='24' complexity='3' token_count='105' nesting_level='0' start_line='45' end_line='70'></method_info>
 			<added_lines>45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='test_concat' parameters=''>
 				<method_info nloc='14' complexity='3' token_count='69' nesting_level='0' start_line='4' end_line='18'></method_info>
 			<added_lines>6,7</added_lines>
 			<deleted_lines>8,10</deleted_lines>
 		</method>
 		<method name='test_concat_with_flags' parameters=''>
 				<method_info nloc='20' complexity='3' token_count='78' nesting_level='0' start_line='21' end_line='42'></method_info>
 			<added_lines>21,36,37,38,39,40,41,42</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>20,43,44</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
