<bug_data>
<bug id='497' author='thllwg' open_date='2020-08-14T09:06:14Z' closed_time='2020-08-14T10:55:41Z'>
 	<summary>Model evaluation fails when using external embeddings</summary>
 	<description>
 I'm currently trying to train a network with the current dev branch, using LibriTTS 360+100 with external embeddings. Training fails at the end of the first epoch, when the evaluation is conducted.
 &lt;denchmark-code&gt;--&gt; TRAIN PERFORMACE -- EPOCH TIME: 1426.36 sec -- GLOBAL_STEP: 1855
   | &gt; avg_decoder_loss: 1.14756
   | &gt; avg_postnet_loss: 1.27054
   | &gt; avg_stopnet_loss: 0.30356
   | &gt; avg_decoder_coarse_loss: 1.10275
   | &gt; avg_decoder_ddc_loss: 0.00487
   | &gt; avg_ga_loss: 0.04375
   | &gt; avg_loss: 3.56949
   | &gt; avg_align_error: 0.93601
   | &gt; avg_loader_time: 0.00657
   | &gt; avg_step_time: 0.76924
 
 &gt; EVALUATION
 
 ! Run is removed from /home/dobby/models/multi/LibriTTS/libritts_360_100-gst-ddc-bn-embeddings-August-14-2020_06+31AM-8b4eb25
 Traceback (most recent call last):
 File "mozilla_voice_tts/bin/train_tts.py", line 714, in &lt;module&gt;
  main(args)
 File "mozilla_voice_tts/bin/train_tts.py", line 627, in main
  eval_avg_loss_dict = evaluate(model, criterion, ap, global_step, epoch)
 File "/home/dobby/thllwgTTS_try/thllwgtts/lib/python3.6/site-packages/torch-1.6.0-py3.6-linux-x86_64.egg/torch/autograd/grad_mode.py", line 15, in decorate_context
  return func(*args, **kwargs)
 File "mozilla_voice_tts/bin/train_tts.py", line 342, in evaluate
  text_input, text_lengths, mel_input, speaker_ids=speaker_ids, speaker_embeddings=speaker_embeddings)
 File "/home/dobby/thllwgTTS_try/thllwgtts/lib/python3.6/site-packages/torch-1.6.0-py3.6-linux-x86_64.egg/torch/nn/modules/module.py", line 722, in _call_impl
  result = self.forward(*input, **kwargs)
 File "/home/dobby/thllwgTTS_try/TTS/mozilla_voice_tts/tts/models/tacotron2.py", line 112, in forward
  speaker_embeddings = torch.unsqueeze(speaker_embeddings, 1)
 TypeError: unsqueeze(): argument 'input' (position 1) must be Tensor, not NoneType
 &lt;/denchmark-code&gt;
 
 The reason is that the speaker_mapping passed to evaluate in train_tts.py.
 	</description>
 	<comments>
 		<comment id='1' author='thllwg' date='2020-08-14T10:08:40Z'>
 		interesting actually we run a sample training in tests, but it passes the testing.
 		</comment>
 	</comments>
 </bug>
<commit id='c90fce8d8c98fc58d9ab329a2ca95bc2539d4061' author='thllwg' date='2020-08-14 11:11:04+02:00'>
 	<dmm_unit complexity='None' interfacing='None' size='None'></dmm_unit>
 	<modification change_type='MODIFY' old_name='mozilla_voice_tts\bin\train_tts.py' new_name='mozilla_voice_tts\bin\train_tts.py'>
 		<file_info nloc='577' complexity='84' token_count='4310'></file_info>
 		<method name='main' parameters='args'>
 				<method_info nloc='122' complexity='36' token_count='928' nesting_level='0' start_line='480' end_line='633'></method_info>
 			<added_lines>627</added_lines>
 			<deleted_lines>627</deleted_lines>
 		</method>
 		<method name='format_data' parameters='data,speaker_mapping'>
 				<method_info nloc='41' complexity='12' token_count='330' nesting_level='0' start_line='86' end_line='135'></method_info>
 			<added_lines>103</added_lines>
 			<deleted_lines>103</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
