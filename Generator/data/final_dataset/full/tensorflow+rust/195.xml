<bug_data>
<bug id='195' author='nagisa' open_date='2019-03-26T16:51:49Z' closed_time='2019-03-30T01:24:06Z'>
 	<summary>tensorflow::Graph::import_graph_def_with_return_outputs sigsegvs</summary>
 	<description>
 Following trivial code:
 static GRAPH: &amp;'static [u8] = include_bytes!("../graph.pb");
 
 tf::Library::load("libtftrt.so").expect("loading tftrt.so");
 let mut options = tf::ImportGraphDefOptions::new();
 options.add_return_output("outputname", 0).expect("add return");
 let mut graph = tf::Graph::new();
 let outputs = graph.import_graph_def_with_return_outputs(GRAPH, &amp;options).expect("import graphdef");
 will result in SIGSEGV. This is the backtrace:
 &lt;denchmark-code&gt;#0  0x00007fffd567bce8 in __memmove_avx_unaligned_erms ()
    from /nix/store/d54amiggq6bw23jw6mdsgamvs6v1g3bh-glibc-2.25-123/lib/libc.so.6
 #1  0x00007fffd69e52ba in TF_GraphImportGraphDefWithReturnOutputs ()
    from /nix/store/0x57f1zqb8y91w8j0zpi17d1s8827xqh-libtensorflow-1.12.0/lib/libtensorflow.so
 #2  0x00005555555b30b0 in tensorflow::graph::Graph::import_graph_def_with_return_outputs (self=0x7fffab916440, 
     graph_def=..., options=0x7fffab916418)
     at /home/simonas/.cargo/registry/src/github.com-1ecc6299db9ec823/tensorflow-0.12.0/src/graph.rs:483
 #3  0x00005555555708e1 in new () at src/lib.rs:24
 #4  0x0000555555570ce1 in tests::new () at src/lib.rs:38
 #5  0x0000555555571e3a in tests::new::{{closure}} () at src/lib.rs:37
 #6  0x0000555555570e6e in core::ops::function::FnOnce::call_once ()
     at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libcore/ops/function.rs:231
 #7  0x000055555557a2bf in {{closure}} () at src/libtest/lib.rs:1497
 #8  call_once&lt;closure,()&gt; () at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libcore/ops/function.rs:231
 #9  call_box&lt;(),closure&gt; () at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/liballoc/boxed.rs:749
 #10 0x00005555555cb3da in __rust_maybe_catch_panic () at src/libpanic_unwind/lib.rs:87
 #11 0x0000555555597208 in try&lt;(),std::panic::AssertUnwindSafe&lt;alloc::boxed::Box&lt;FnBox&lt;()&gt;&gt;&gt;&gt; ()
     at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libstd/panicking.rs:276
 #12 catch_unwind&lt;std::panic::AssertUnwindSafe&lt;alloc::boxed::Box&lt;FnBox&lt;()&gt;&gt;&gt;,()&gt; ()
     at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libstd/panic.rs:388
 #13 {{closure}} () at src/libtest/lib.rs:1452
 #14 0x0000555555572945 in std::sys_common::backtrace::__rust_begin_short_backtrace ()
     at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libstd/sys_common/backtrace.rs:135
 #15 0x0000555555573085 in {{closure}}&lt;closure,()&gt; ()
     at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libstd/thread/mod.rs:469
 #16 call_once&lt;(),closure&gt; () at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libstd/panic.rs:309
 #17 do_call&lt;std::panic::AssertUnwindSafe&lt;closure&gt;,()&gt; ()
     at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libstd/panicking.rs:297
 #18 0x00005555555cb3da in __rust_maybe_catch_panic () at src/libpanic_unwind/lib.rs:87
 #19 0x000055555557a19d in try&lt;(),std::panic::AssertUnwindSafe&lt;closure&gt;&gt; ()
     at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libstd/panicking.rs:276
 #20 catch_unwind&lt;std::panic::AssertUnwindSafe&lt;closure&gt;,()&gt; ()
     at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libstd/panic.rs:388
 #21 {{closure}}&lt;closure,()&gt; () at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/libstd/thread/mod.rs:468
 #22 call_box&lt;(),closure&gt; () at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/liballoc/boxed.rs:749
 #23 0x00005555555cab1e in call_once&lt;(),()&gt; ()
     at /rustc/02c4c28920ddfdb43e68a363b7fe59ac4c92399c/src/liballoc/boxed.rs:759
 #24 start_thread () at src/libstd/sys_common/thread.rs:14
 #25 thread_start () at src/libstd/sys/unix/thread.rs:81
 #26 0x00007fffd5b11244 in start_thread ()
    from /nix/store/d54amiggq6bw23jw6mdsgamvs6v1g3bh-glibc-2.25-123/lib/libpthread.so.0
 #27 0x00007fffd563bccf in clone () from /nix/store/d54amiggq6bw23jw6mdsgamvs6v1g3bh-glibc-2.25-123/lib/libc.so.6
 &lt;/denchmark-code&gt;
 
 Just tensorflow::Graph::import_graph_def runs fine. Let me know if thereâ€™s extra info I could provide. I cannot provide the graph itself, but I could see if some guess is right or wrong.
 	</description>
 	<comments>
 		<comment id='1' author='nagisa' date='2019-03-26T17:56:35Z'>
 		An equivalent operation using Graph::import_graph_def_with_results also works fine.
 		</comment>
 	</comments>
 </bug>
<commit id='411acf0892e299d5626ab605553bde21e91f4419' author='Adam Crume' date='2019-03-28 21:26:37-07:00'>
 	<dmm_unit complexity='None' interfacing='None' size='None'></dmm_unit>
 	<modification change_type='MODIFY' old_name='src\graph.rs' new_name='src\graph.rs'>
 		<file_info nloc='2201' complexity='243' token_count='13785'></file_info>
 		<method name='import_graph_def_with_return_outputs' parameters=''>
 				<method_info nloc='13' complexity='1' token_count='129' nesting_level='0' start_line='2553' end_line='2565'></method_info>
 			<added_lines>2553,2554,2555,2556,2557,2558,2559,2560,2561,2562,2563,2564,2565</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='operation_iter' parameters='self'>
 				<method_info nloc='147' complexity='2' token_count='106' nesting_level='0' start_line='366' end_line='527'></method_info>
 			<added_lines>478</added_lines>
 			<deleted_lines>477</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>2552,2566</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
