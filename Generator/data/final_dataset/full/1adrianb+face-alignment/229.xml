<bug_data>
<bug id='229' author='JohanAR' open_date='2020-12-12T14:59:42Z' closed_time='2020-12-13T21:48:30Z'>
 	<summary>SFD detector crashes with certain inputs</summary>
 	<description>
 SFDDetector detect_from_image crashes on certain input. Noticed it when playing around with avatarify so I saved the current frame.
 It looks like batch_detect should not be able to return an empty bboxlists, but it can be [[]] which slips through the length check at the end and causes an IndexError in detect_from_image
 Here's the output when running facealignment_test.py with my image:
 &lt;denchmark-code&gt;docker run --gpus all -it --rm -v $PWD/.cache:/root/.cache:rw -v $PWD/test:/workspace/face-alignment/test face-alignment python3 test/facealignment_test.py
 E
 ======================================================================
 ERROR: test_predict_points (__main__.Tester)
 ----------------------------------------------------------------------
 Traceback (most recent call last):
   File "test/facealignment_test.py", line 11, in test_predict_points
     fa.get_landmarks('test/assets/crash.png')
   File "/opt/conda/lib/python3.8/site-packages/face_alignment-1.1.1-py3.8.egg/face_alignment/api.py", line 107, in get_landmarks
     return self.get_landmarks_from_image(image_or_path, detected_faces)
   File "/opt/conda/lib/python3.8/site-packages/torch/autograd/grad_mode.py", line 26, in decorate_context
     return func(*args, **kwargs)
   File "/opt/conda/lib/python3.8/site-packages/face_alignment-1.1.1-py3.8.egg/face_alignment/api.py", line 140, in get_landmarks_from_image
     detected_faces = self.face_detector.detect_from_image(image[..., ::-1].copy())
   File "/opt/conda/lib/python3.8/site-packages/face_alignment-1.1.1-py3.8.egg/face_alignment/detection/sfd/sfd_detector.py", line 36, in detect_from_image
     bboxlist = bboxlist[keep, :]
 IndexError: too many indices for array: array is 1-dimensional, but 2 were indexed
 
 ----------------------------------------------------------------------
 Ran 1 test in 3.986s
 
 FAILED (errors=1)
 &lt;/denchmark-code&gt;
 
 &lt;denchmark-link:https://user-images.githubusercontent.com/4918549/101987204-e3d1c780-3c92-11eb-94ee-319b7ca5e64e.png&gt;&lt;/denchmark-link&gt;
 
 	</description>
 	<comments>
 		<comment id='1' author='JohanAR' date='2020-12-13T21:50:27Z'>
 		Thanks a lot for you including a testing frame and proposing a potential solution!
 		</comment>
 	</comments>
 </bug>
<commit id='632481fc02b3e194aeacbedaf65b76cf5ad4d580' author='Adrian Bulat' date='2020-12-13 21:48:13+00:00'>
 	<dmm_unit complexity='1.0' interfacing='0.0' size='1.0'></dmm_unit>
 	<modification change_type='MODIFY' old_name='face_alignment\detection\sfd\sfd_detector.py' new_name='face_alignment\detection\sfd\sfd_detector.py'>
 		<file_info nloc='48' complexity='12' token_count='329'></file_info>
 		<method name='detect_from_image' parameters='self,tensor_or_path'>
 				<method_info nloc='5' complexity='1' token_count='44' nesting_level='1' start_line='38' end_line='44'></method_info>
 			<added_lines>42</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='detect_from_batch' parameters='self,tensor'>
 				<method_info nloc='8' complexity='2' token_count='62' nesting_level='1' start_line='46' end_line='55'></method_info>
 			<added_lines>52</added_lines>
 			<deleted_lines>47,48,49</deleted_lines>
 		</method>
 		<method name='_filter_bboxes' parameters='self,bboxlist,threshold'>
 				<method_info nloc='6' complexity='4' token_count='60' nesting_level='1' start_line='30' end_line='36'></method_info>
 			<added_lines>30,31,32,33,34,35,36</added_lines>
 			<deleted_lines>35,36</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>1,7,8,37</added_lines>
 			<deleted_lines>1,2,8,9,37</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
