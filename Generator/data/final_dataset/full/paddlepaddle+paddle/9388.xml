<bug_data>
<bug id='9388' author='JiayiFeng' open_date='2018-03-26T16:50:40Z' closed_time='2018-03-29T16:44:59Z'>
 	<summary>A bug in framework::Channel</summary>
 	<description>
 
 Create a new channel whose capacity is 2.
 Send 2 data(0 and 1) into the new channel.
 Try to send the third data(3) to the channel. For the channel is full, the Send() function will be blocked.
 Receive() data from the channel with another thread. The first received data should be 0 in my understanding. However, in my test I found it's 3 in fact.
 
 In PR &lt;denchmark-link:https://github.com/PaddlePaddle/Paddle/pull/9387&gt;#9387&lt;/denchmark-link&gt;
  I did a few modifications in the  to help you replicate the bug:
 &lt;denchmark-code&gt;[ RUN      ] Channel.RecevingOrderEqualToSendingOrderWithBufferedChannel
 97: /Users/baidu/Documents/git_workspace/Paddle/paddle/fluid/framework/channel_test.cc:52: Failure
 97:       Expected: recv
 97:       Which is: 2
 97: To be equal to: i
 97:       Which is: 0
 97: /Users/baidu/Documents/git_workspace/Paddle/paddle/fluid/framework/channel_test.cc:52: Failure
 97:       Expected: recv
 97:       Which is: 3
 97: To be equal to: i
 97:       Which is: 1
 97: /Users/baidu/Documents/git_workspace/Paddle/paddle/fluid/framework/channel_test.cc:52: Failure
 97:       Expected: recv
 97:       Which is: 4
 97: To be equal to: i
 97:       Which is: 2
 97: /Users/baidu/Documents/git_workspace/Paddle/paddle/fluid/framework/channel_test.cc:52: Failure
 97:       Expected: recv
 97:       Which is: 0
 97: To be equal to: i
 97:       Which is: 3
 97: /Users/baidu/Documents/git_workspace/Paddle/paddle/fluid/framework/channel_test.cc:52: Failure
 97:       Expected: recv
 97:       Which is: 1
 97: To be equal to: i
 97:       Which is: 4
 97: [  FAILED  ] Channel.RecevingOrderEqualToSendingOrderWithBufferedChannel (408 ms)
 &lt;/denchmark-code&gt;
 
 	</description>
 	<comments>
 		<comment id='1' author='JiayiFeng' date='2018-03-26T20:05:03Z'>
 		Hi &lt;denchmark-link:https://github.com/JiayiFeng&gt;@JiayiFeng&lt;/denchmark-link&gt;
  . This is definitely a bug in the implementation. I am looking into it. Thank you for pointing this out
 		</comment>
 	</comments>
 </bug>
<commit id='5f9da86ba562c543a623ff0d99f06bd2e935edb3' author='Abhinav Arora' date='2018-03-29 09:44:58-07:00'>
 	<dmm_unit complexity='0.8260869565217391' interfacing='1.0' size='0.7391304347826086'></dmm_unit>
 	<modification change_type='MODIFY' old_name='paddle\fluid\framework\channel_impl.h' new_name='paddle\fluid\framework\channel_impl.h'>
 		<file_info nloc='270' complexity='52' token_count='1935'></file_info>
 		<method name='paddle::framework::ChannelImpl&lt;T&gt;::Receive' parameters='item'>
 				<method_info nloc='38' complexity='8' token_count='278' nesting_level='2' start_line='192' end_line='253'></method_info>
 			<added_lines>204,205,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231</added_lines>
 			<deleted_lines>204,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229</deleted_lines>
 		</method>
 		<method name='paddle::framework::ChannelImpl::get_first_message' parameters='queue,action'>
 				<method_info nloc='9' complexity='4' token_count='73' nesting_level='3' start_line='90' end_line='103'></method_info>
 			<added_lines>90,91,92,93,94,95,96,97,98,99,100,101,102,103</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='paddle::framework::ChannelImpl&lt;T&gt;::Send' parameters='item'>
 				<method_info nloc='40' complexity='6' token_count='230' nesting_level='2' start_line='135' end_line='189'></method_info>
 			<added_lines>149,150,151,152,154,155,156,157,158</added_lines>
 			<deleted_lines>135,136,137,138,139,140,141,142,143,145,146,147,148,149,150,151,152,158,159,160,161,162,163</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>104</added_lines>
 			<deleted_lines>134</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='paddle\fluid\framework\channel_test.cc' new_name='paddle\fluid\framework\channel_test.cc'>
 		<file_info nloc='753' complexity='138' token_count='5246'></file_info>
 		<method name='TEST' parameters='Channel,RecevingOrderEqualToSendingOrderWithUnBufferedChannel'>
 				<method_info nloc='4' complexity='1' token_count='26' nesting_level='0' start_line='188' end_line='191'></method_info>
 			<added_lines>190,191</added_lines>
 			<deleted_lines>188,191</deleted_lines>
 		</method>
 		<method name='RecevingOrderEqualToSendingOrder' parameters='ch'>
 				<method_info nloc='19' complexity='3' token_count='136' nesting_level='0' start_line='39' end_line='57'></method_info>
 			<added_lines>39,42,47,48,49,56,57</added_lines>
 			<deleted_lines>39,42,47,48,55</deleted_lines>
 		</method>
 		<method name='TEST' parameters='Channel,RecevingOrderEqualToSendingOrderWithBufferedChannel'>
 				<method_info nloc='4' complexity='1' token_count='24' nesting_level='0' start_line='191' end_line='194'></method_info>
 			<added_lines>191,192,193,194</added_lines>
 			<deleted_lines>191,193</deleted_lines>
 		</method>
 		<method name='TEST' parameters='Channel,RecevingOrderEqualToSendingOrderWithBufferedChannel3'>
 				<method_info nloc='4' complexity='1' token_count='26' nesting_level='0' start_line='207' end_line='212'></method_info>
 			<added_lines>207,208,209,211</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='TEST' parameters='Channel,RecevingOrderEqualToSendingOrderWithBufferedChannel2'>
 				<method_info nloc='4' complexity='1' token_count='26' nesting_level='0' start_line='200' end_line='205'></method_info>
 			<added_lines>200,201,202,203,204</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='RecevingOrderEqualToSendingOrder' parameters='ch,num_items'>
 				<method_info nloc='21' complexity='3' token_count='171' nesting_level='0' start_line='39' end_line='59'></method_info>
 			<added_lines>39,42,47,48,49,56,57</added_lines>
 			<deleted_lines>39,42,47,48,55</deleted_lines>
 		</method>
 		<method name='TEST' parameters='Channel,RecevingOrderEqualToSendingOrderWithBufferedChannel1'>
 				<method_info nloc='4' complexity='1' token_count='26' nesting_level='0' start_line='193' end_line='198'></method_info>
 			<added_lines>193,194,195,196,197,198</added_lines>
 			<deleted_lines>193</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>199</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
