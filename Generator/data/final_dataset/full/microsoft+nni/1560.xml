<bug_data>
<bug id='1560' author='ultmaster' open_date='2019-09-19T14:07:40Z' closed_time='2019-09-30T08:49:46Z'>
 	<summary>Inconsistent annotation parsing between codegen and specific_codegen</summary>
 	<description>
 Customer raised.
 specific_code_generator.py Line 305. Inconsistent with code_generator.py. Causing users not to be able to use codegen in 1.0.
 &lt;denchmark-code&gt;Traceback (most recent call last):
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 355, in parse
     transformer.visit(ast_tree)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 278, in visit
     return self._visit_children(node)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 333, in _visit_children
     self.generic_visit(node)
   File "/usr/lib/python3.5/ast.py", line 300, in generic_visit
     value = self.visit(value)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 295, in visit
     return self._visit_children(node)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 333, in _visit_children
     self.generic_visit(node)
   File "/usr/lib/python3.5/ast.py", line 300, in generic_visit
     value = self.visit(value)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 295, in visit
     return self._visit_children(node)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 333, in _visit_children
     self.generic_visit(node)
   File "/usr/lib/python3.5/ast.py", line 300, in generic_visit
     value = self.visit(value)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 295, in visit
     return self._visit_children(node)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 333, in _visit_children
     self.generic_visit(node)
   File "/usr/lib/python3.5/ast.py", line 300, in generic_visit
     value = self.visit(value)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 286, in visit
     return self._visit_string(node)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 328, in _visit_string
     raise AssertionError('Unexpected annotation function')
 AssertionError: Unexpected annotation function
 
 During handling of the above exception, another exception occurred:
 
 Traceback (most recent call last):
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/__init__.py", line 145, in _generate_specific_file
     annotated_code = specific_code_generator.parse(src.read(), para_cfg["parameters"], module)
   File "/data/hdd3/yugzh/ENAS_NLP/venv/lib/python3.5/site-packages/nni_annotation/specific_code_generator.py", line 357, in parse
     raise RuntimeError('%d: %s' % (ast_tree.last_line, exc.args[0]))
 AttributeError: 'Module' object has no attribute 'last_line'
 &lt;/denchmark-code&gt;
 
 I believe the solution should be to refactor, instead of syncing these two files.
 	</description>
 	<comments>
 	</comments>
 </bug>
<commit id='f1210a9cd9be7143ea807b9a36cfc89109097b62' author='Yuge Zhang' date='2019-09-30 16:49:45+08:00'>
 	<dmm_unit complexity='0.0' interfacing='0.875' size='0.0'></dmm_unit>
 	<modification change_type='MODIFY' old_name='tools\nni_annotation\code_generator.py' new_name='tools\nni_annotation\code_generator.py'>
 		<file_info nloc='256' complexity='67' token_count='2203'></file_info>
 		<method name='_visit_string' parameters='self,node'>
 				<method_info nloc='23' complexity='9' token_count='172' nesting_level='1' start_line='317' end_line='344'></method_info>
 			<added_lines>330</added_lines>
 			<deleted_lines>328,344</deleted_lines>
 		</method>
 		<method name='convert_args_to_dict' parameters='call,with_lambda'>
 				<method_info nloc='14' complexity='4' token_count='123' nesting_level='0' start_line='195' end_line='213'></method_info>
 			<added_lines>204</added_lines>
 			<deleted_lines>201</deleted_lines>
 		</method>
 		<method name='parse_annotation_mutable_layers' parameters='code,lineno,nas_mode'>
 				<method_info nloc='88' complexity='15' token_count='763' nesting_level='0' start_line='28' end_line='121'></method_info>
 			<added_lines>83,84</added_lines>
 			<deleted_lines>82</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>25,123</added_lines>
 			<deleted_lines>314</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='tools\nni_annotation\search_space_generator.py' new_name='tools\nni_annotation\search_space_generator.py'>
 		<file_info nloc='90' complexity='24' token_count='698'></file_info>
 		<method name='visit_Call' parameters='self,node'>
 				<method_info nloc='44' complexity='15' token_count='395' nesting_level='1' start_line='67' end_line='131'></method_info>
 			<added_lines>110</added_lines>
 			<deleted_lines>67,111</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='tools\nni_annotation\specific_code_generator.py' new_name='tools\nni_annotation\specific_code_generator.py'>
 		<file_info nloc='239' complexity='62' token_count='2053'></file_info>
 		<method name='test_variable_equal' parameters='node1,node2'>
 				<method_info nloc='15' complexity='9' token_count='122' nesting_level='0' start_line='207' end_line='223'></method_info>
 			<added_lines>222</added_lines>
 			<deleted_lines>220</deleted_lines>
 		</method>
 		<method name='convert_args_to_dict' parameters='call,with_lambda'>
 				<method_info nloc='14' complexity='4' token_count='123' nesting_level='0' start_line='178' end_line='196'></method_info>
 			<added_lines>187</added_lines>
 			<deleted_lines>185</deleted_lines>
 		</method>
 		<method name='_visit_string' parameters='self,node'>
 				<method_info nloc='32' complexity='9' token_count='383' nesting_level='1' start_line='299' end_line='337'></method_info>
 			<added_lines>307,308,310,311,312,313,314,315,320,321,326,327</added_lines>
 			<deleted_lines>306,308,313,318,330</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>31,106</added_lines>
 			<deleted_lines>297</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
