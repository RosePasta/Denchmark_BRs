<bug_data>
<bug id='602' author='mdliyakat-dev' open_date='2020-10-23T11:38:23Z' closed_time='2020-11-18T13:54:54Z'>
 	<summary>Response truncated/incomplete in case of answer the end of the huge context</summary>
 	<description>
 I have come across a situation in which if the answer is at the end of huge context then the prediction response is either incomplete or truncated BUT when I paste the answer part at the beginning then it comes with complete response. Any help in this regard?
 	</description>
 	<comments>
 		<comment id='1' author='mdliyakat-dev' date='2020-10-26T11:01:51Z'>
 		Hey &lt;denchmark-link:https://github.com/mdliyakat-dev&gt;@mdliyakat-dev&lt;/denchmark-link&gt;
 , we've been noticing some issues with answers at the beginning at passages too (cf. &lt;denchmark-link:https://github.com/deepset-ai/FARM/issues/552&gt;#552&lt;/denchmark-link&gt;
 ). I'll be looking into both these issues this sprint.
 		</comment>
 		<comment id='2' author='mdliyakat-dev' date='2020-10-26T15:57:25Z'>
 		In the meantime, it would be really helpful if you had an example script so we could reproduce your problem!
 		</comment>
 		<comment id='3' author='mdliyakat-dev' date='2020-10-28T06:34:47Z'>
 		Examples below:
 Payload 1 for answer at the end of context (highlighted in bold) and response is incomplete.
 {"qas": "What happens if I surrender my Rider",
 "context": "FAQ’s What if I am not happy with the Rider after buying it? (Free look Cancellation) If you are not satisfied with any of the Terms and Conditions of the Rider, you may return the Rider document along with a letter stating the reasons for disagreement to us within 15 days or 30 days (in case of an electronic Policy or if purchased through Distance Marketing mode) from the date of receipt of the Rider document. On cancellation of the Rider within the free look period, we will return the Rider Premium paid under the Rider (including taxes) subject to the deduction of: • Proportionate risk premium (including taxes) and • Expense incurred by us for medical examination (if any) and stamp duty The Rider will terminate on payment of this amount and all rights, benefits and interests under this Rider will stand extinguished. On cancellation of the Base Plan, the Rider will also stand cancelled. What is Distance Marketing? Distance Marketing includes every activity of solicitation (including lead generation) and sale of insurance products through the following modes: (i) Voice mode, which includes telephone-calling (ii) Short Messaging service (SMS) (iii) Electronic mode which includes e-mail, internet and interactive television (DTH) (iv) Physical mode which includes direct postal mail and newspaper &amp; magazine inserts and (v) Solicitation through any means of communication other than in person. What if I missed my premium due date? (Grace period) You are advised to pay premiums on or before the Premium due date to continue enjoying the benefits of this Rider. However, in case you are unable to do so, you have a Grace Period after the premium due date within which you can pay the due premium. Grace Period under this Rider will be same as applicable to the Base Policy. If any premium remains unpaid after the expiry of the Grace Period, the Rider will lapse, and the cover will cease to exist. The Rider will be in force during the Grace Period. In case of contingent event occurs during the grace period, benefit payable will be reduced by the level of Outstanding Instalment Premium (1) (including taxes) as at the date of occurrence of the event. (Outstanding Instalment Premium in the above case is the due instalment premium(s) that were due but unpaid before the death of the Life Insured.) What happens if I stop paying the due premiums? On non-payment of any due premiums within the grace period, the Rider will lapse, and all the benefits will cease to exist. No Benefit shall be payable for lapsed Rider under Regular Pay mode. In case of Limited Pay mode, Unexpired Risk Premium Value (if any) would be payable as Lapse Benefit under the following circumstances whichever is earlier: • The Policyholder voluntarily Surrenders the rider; or • The Life Assured dies; or • The Life Assured survives to the end of the revival period. The Unexpired Risk Premium Value (URPV) is computed as: URPV = 70% * ( Total Rider Premiums Paid / Total Premiums Payable over the Term) * (Outstanding Rider Term/Rider Term) * Total Rider Premium Paid (For the purpose of computation of URPV, the rider premiums shall exclude the underwriting extra premiums, any loadings for modal premiums and taxes.) The Rider will terminate on payment of this benefit. How can I revive my Rider? If your Rider has lapsed, you may revive the Rider along with the Base Policy. The revival period will be same as the revival period of the Base Policy to which the Rider has been attached. The revival will be subject to our underwriting guidelines and payment of all outstanding premiums without any interest. If the Rider is not revived along with the Base Plan, the Rider would be deemed Surrendered and revival of such surrendered Rider will not be allowed at a later stage. However, one or more of the benefit options within the rider can be added anytime during remaining premium payment term, provided the Base Plan is in-force and premiums will be applicable based on attained age of Life Assured. This addition will be subject to underwriting guidelines of the company. \nWhat happens if I surrender my Rider? We advise you to continue your Rider for the complete Rider Term. However, in case if you still decide to surrender your Rider, surrender benefit will be payable in following manner: For Regular Pay Policies, no benefit is payable on surrender of the Rider and For Limited Pay policies, we will pay the Unexpired Risk Premium Value (URPV) which is computed as: URPV = 70% * ( Total Rider Premiums Paid / Total Premiums Payable over the Term) * (Outstanding Rider Term/Rider Term) * Total Rider Premium Paid (For the purpose of computation of URPV, the rider premiums shall exclude the underwriting extra premiums, any loadings for modal premiums and taxes.) The Rider will terminate on payment of this benefit."}
 Response incomplete
 {
 "answer": "surrender benefit will be payable in following manner: For Regular Pay Policies, no benefit is payable",
 "score": 12.446493148803711
 }
 Payload 2 for answer near to middle of context and response is truncated.
 {"qas": "What happens if I surrender my Rider",
 "context": "FAQ’s What if I am not happy with the Rider after buying it? (Free look Cancellation) If you are not satisfied with any of the Terms and Conditions of the Rider, you may return the Rider document along with a letter stating the reasons for disagreement to us within 15 days or 30 days (in case of an electronic Policy or if purchased through Distance Marketing mode) from the date of receipt of the Rider document. On cancellation of the Rider within the free look period, we will return the Rider Premium paid under the Rider (including taxes) subject to the deduction of: • Proportionate risk premium (including taxes) and • Expense incurred by us for medical examination (if any) and stamp duty The Rider will terminate on payment of this amount and all rights, benefits and interests under this Rider will stand extinguished. On cancellation of the Base Plan, the Rider will also stand cancelled. \nWhat happens if I surrender my Rider? We advise you to continue your Rider for the complete Rider Term. However, in case if you still decide to surrender your Rider, surrender benefit will be payable in following manner: For Regular Pay Policies, no benefit is payable on surrender of the Rider and For Limited Pay policies, we will pay the Unexpired Risk Premium Value (URPV) which is computed as: URPV = 70% * ( Total Rider Premiums Paid / Total Premiums Payable over the Term) * (Outstanding Rider Term/Rider Term) * Total Rider Premium Paid (For the purpose of computation of URPV, the rider premiums shall exclude the underwriting extra premiums, any loadings for modal premiums and taxes.) The Rider will terminate on payment of this benefit. What is Distance Marketing? Distance Marketing includes every activity of solicitation (including lead generation) and sale of insurance products through the following modes: (i) Voice mode, which includes telephone-calling (ii) Short Messaging service (SMS) (iii) Electronic mode which includes e-mail, internet and interactive television (DTH) (iv) Physical mode which includes direct postal mail and newspaper &amp; magazine inserts and (v) Solicitation through any means of communication other than in person. What if I missed my premium due date? (Grace period) You are advised to pay premiums on or before the Premium due date to continue enjoying the benefits of this Rider. However, in case you are unable to do so, you have a Grace Period after the premium due date within which you can pay the due premium. Grace Period under this Rider will be same as applicable to the Base Policy. If any premium remains unpaid after the expiry of the Grace Period, the Rider will lapse, and the cover will cease to exist. The Rider will be in force during the Grace Period. In case of contingent event occurs during the grace period, benefit payable will be reduced by the level of Outstanding Instalment Premium (1) (including taxes) as at the date of occurrence of the event. (Outstanding Instalment Premium in the above case is the due instalment premium(s) that were due but unpaid before the death of the Life Insured.) What happens if I stop paying the due premiums? On non-payment of any due premiums within the grace period, the Rider will lapse, and all the benefits will cease to exist. No Benefit shall be payable for lapsed Rider under Regular Pay mode. In case of Limited Pay mode, Unexpired Risk Premium Value (if any) would be payable as Lapse Benefit under the following circumstances whichever is earlier: • The Policyholder voluntarily Surrenders the rider; or • The Life Assured dies; or • The Life Assured survives to the end of the revival period. The Unexpired Risk Premium Value (URPV) is computed as: URPV = 70% * ( Total Rider Premiums Paid / Total Premiums Payable over the Term) * (Outstanding Rider Term/Rider Term) * Total Rider Premium Paid (For the purpose of computation of URPV, the rider premiums shall exclude the underwriting extra premiums, any loadings for modal premiums and taxes.) The Rider will terminate on payment of this benefit. How can I revive my Rider? If your Rider has lapsed, you may revive the Rider along with the Base Policy. The revival period will be same as the revival period of the Base Policy to which the Rider has been attached. The revival will be subject to our underwriting guidelines and payment of all outstanding premiums without any interest. If the Rider is not revived along with the Base Plan, the Rider would be deemed Surrendered and revival of such surrendered Rider will not be allowed at a later stage. However, one or more of the benefit options within the rider can be added anytime during remaining premium payment term, provided the Base Plan is in-force and premiums will be applicable based on attained age of Life Assured. This addition will be subject to underwriting guidelines of the company. "}
 Response truncated
 {
 "answer": "surrender benefit will be payable in following manner: For Regular Pay Policies, no benefit is payable on surrender of the Rider and For Limited Pay policies, we will",
 "score": 13.230949401855469
 }
 Payload 3 for answer near to beginning of context and response is complete.
 {"qas": "What happens if I surrender my Rider",
 "context": "FAQ’s \nWhat happens if I surrender my Rider? We advise you to continue your Rider for the complete Rider Term. However, in case if you still decide to surrender your Rider, surrender benefit will be payable in following manner: For Regular Pay Policies, no benefit is payable on surrender of the Rider and For Limited Pay policies, we will pay the Unexpired Risk Premium Value (URPV) which is computed as: URPV = 70% * ( Total Rider Premiums Paid / Total Premiums Payable over the Term) * (Outstanding Rider Term/Rider Term) * Total Rider Premium Paid (For the purpose of computation of URPV, the rider premiums shall exclude the underwriting extra premiums, any loadings for modal premiums and taxes.) The Rider will terminate on payment of this benefit. What if I am not happy with the Rider after buying it? (Free look Cancellation) If you are not satisfied with any of the Terms and Conditions of the Rider, you may return the Rider document along with a letter stating the reasons for disagreement to us within 15 days or 30 days (in case of an electronic Policy or if purchased through Distance Marketing mode) from the date of receipt of the Rider document. On cancellation of the Rider within the free look period, we will return the Rider Premium paid under the Rider (including taxes) subject to the deduction of: • Proportionate risk premium (including taxes) and • Expense incurred by us for medical examination (if any) and stamp duty The Rider will terminate on payment of this amount and all rights, benefits and interests under this Rider will stand extinguished. On cancellation of the Base Plan, the Rider will also stand cancelled. What is Distance Marketing? Distance Marketing includes every activity of solicitation (including lead generation) and sale of insurance products through the following modes: (i) Voice mode, which includes telephone-calling (ii) Short Messaging service (SMS) (iii) Electronic mode which includes e-mail, internet and interactive television (DTH) (iv) Physical mode which includes direct postal mail and newspaper &amp; magazine inserts and (v) Solicitation through any means of communication other than in person. What if I missed my premium due date? (Grace period) You are advised to pay premiums on or before the Premium due date to continue enjoying the benefits of this Rider. However, in case you are unable to do so, you have a Grace Period after the premium due date within which you can pay the due premium. Grace Period under this Rider will be same as applicable to the Base Policy. If any premium remains unpaid after the expiry of the Grace Period, the Rider will lapse, and the cover will cease to exist. The Rider will be in force during the Grace Period. In case of contingent event occurs during the grace period, benefit payable will be reduced by the level of Outstanding Instalment Premium (1) (including taxes) as at the date of occurrence of the event. (Outstanding Instalment Premium in the above case is the due instalment premium(s) that were due but unpaid before the death of the Life Insured.) What happens if I stop paying the due premiums? On non-payment of any due premiums within the grace period, the Rider will lapse, and all the benefits will cease to exist. No Benefit shall be payable for lapsed Rider under Regular Pay mode. In case of Limited Pay mode, Unexpired Risk Premium Value (if any) would be payable as Lapse Benefit under the following circumstances whichever is earlier: • The Policyholder voluntarily Surrenders the rider; or • The Life Assured dies; or • The Life Assured survives to the end of the revival period. The Unexpired Risk Premium Value (URPV) is computed as: URPV = 70% * ( Total Rider Premiums Paid / Total Premiums Payable over the Term) * (Outstanding Rider Term/Rider Term) * Total Rider Premium Paid (For the purpose of computation of URPV, the rider premiums shall exclude the underwriting extra premiums, any loadings for modal premiums and taxes.) The Rider will terminate on payment of this benefit. How can I revive my Rider? If your Rider has lapsed, you may revive the Rider along with the Base Policy. The revival period will be same as the revival period of the Base Policy to which the Rider has been attached. The revival will be subject to our underwriting guidelines and payment of all outstanding premiums without any interest. If the Rider is not revived along with the Base Plan, the Rider would be deemed Surrendered and revival of such surrendered Rider will not be allowed at a later stage. However, one or more of the benefit options within the rider can be added anytime during remaining premium payment term, provided the Base Plan is in-force and premiums will be applicable based on attained age of Life Assured. This addition will be subject to underwriting guidelines of the company. "}
 Response complete :
 {
 "answer": "surrender benefit will be payable in following manner: For Regular Pay Policies, no benefit is payable on surrender of the Rider and For Limited Pay policies, we will pay the Unexpired Risk Premium Value (URPV) which is computed as: URPV = 70% * ( Total Rider Premiums Paid / Total Premiums Payable over the Term) * (Outstanding Rider Term/Rider Term) * Total Rider Premium Paid (For the purpose of computation of URPV, the rider premiums shall exclude the underwriting extra premiums, any loadings for modal premiums and taxes.) The Rider will terminate on payment of this benefit.",
 "score": 9.938078880310059
 }
 		</comment>
 		<comment id='4' author='mdliyakat-dev' date='2020-11-03T10:34:33Z'>
 		So there could be a few different things at play here.
 
 
 I'm not sure which model you're using, but if it was trained on Squad, it is maybe quite challenging for the model generally to extract longer answers like the one that you have in your example. The answers in the Squad dataset are on average only 10 words long. Also, in Squad, answers more often come at the beginning of passages rather than at the end. This might partially explain why your model does better when the answer is at the beginning of the document.
 
 
 Another angle into this is to do with the sliding window used in QA systems. Long contexts, like the ones you've shown, are split into smaller, overlapping passages. This is so that they can be processed by the transformer models which are limited in the length of their input. The size of this input is set by a max_seq_len parameter. Models cannot return answers that are longer than max_seq_len, and often they are constrained to return answers that are significantly shorter. If you are using a FARM QAInferencer, the default max_seq_len is 256. You could try increasing this to 384 and seeing if that helps.
 
 
 Let us know if this helps or not!
 		</comment>
 		<comment id='5' author='mdliyakat-dev' date='2020-11-18T13:54:54Z'>
 		Closing this for now. Feel free to reopen if you have any questions or updates!
 		</comment>
 	</comments>
 </bug>
<commit id='78fb5cfb02cdb38f01b66d67f9ab640e6da4e79b' author='Branden Chan' date='2020-10-29 17:24:26+01:00'>
 	<dmm_unit complexity='1.0' interfacing='1.0' size='0.08333333333333333'></dmm_unit>
 	<modification change_type='MODIFY' old_name='farm\data_handler\input_features.py' new_name='farm\data_handler\input_features.py'>
 		<file_info nloc='372' complexity='30' token_count='2570'></file_info>
 		<method name='sample_to_features_qa' parameters='sample,tokenizer,max_seq_len,sp_toks_start,sp_toks_mid,answer_type_list,max_answers'>
 				<method_info nloc='2' complexity='1' token_count='21' nesting_level='0' start_line='372' end_line='373'></method_info>
 			<added_lines>372</added_lines>
 			<deleted_lines>372</deleted_lines>
 		</method>
 		<method name='sample_to_features_qa' parameters='sample,tokenizer,max_seq_len,sp_toks_start,sp_toks_mid,sp_toks_end,answer_type_list,max_answers'>
 				<method_info nloc='2' complexity='1' token_count='23' nesting_level='0' start_line='372' end_line='373'></method_info>
 			<added_lines>372</added_lines>
 			<deleted_lines>372</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>475,476,477,478,479,480,481,482,483,493,513,514</added_lines>
 			<deleted_lines>503</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='farm\data_handler\processor.py' new_name='farm\data_handler\processor.py'>
 		<file_info nloc='1538' complexity='227' token_count='8457'></file_info>
 		<method name='_sample_to_features' parameters='self,Sample'>
 				<method_info nloc='11' complexity='1' token_count='67' nesting_level='1' start_line='1569' end_line='1579'></method_info>
 			<added_lines>1576</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='_sample_to_features' parameters='self,sample'>
 				<method_info nloc='10' complexity='1' token_count='59' nesting_level='1' start_line='1264' end_line='1273'></method_info>
 			<added_lines>1271</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='farm\modeling\prediction_head.py' new_name='farm\modeling\prediction_head.py'>
 		<file_info nloc='1009' complexity='243' token_count='7609'></file_info>
 		<method name='logits_to_preds' parameters='self,logits,span_mask,start_of_word,seq_2_start_t,max_answer_length,kwargs'>
 				<method_info nloc='2' complexity='1' token_count='20' nesting_level='1' start_line='1059' end_line='1060'></method_info>
 			<added_lines>1059,1060</added_lines>
 			<deleted_lines>1059</deleted_lines>
 		</method>
 		<method name='get_top_candidates' parameters='self,sorted_candidates,start_end_matrix,sample_idx'>
 				<method_info nloc='28' complexity='5' token_count='175' nesting_level='1' start_line='1132' end_line='1170'></method_info>
 			<added_lines>1132,1152,1153,1154,1155,1156,1157,1158,1159</added_lines>
 			<deleted_lines>1150,1151,1152,1153,1154,1155,1156,1157,1158,1159</deleted_lines>
 		</method>
 		<method name='get_top_candidates' parameters='self,sorted_candidates,start_end_matrix,n_non_padding,max_answer_length,seq_2_start_t,sample_idx'>
 				<method_info nloc='2' complexity='1' token_count='17' nesting_level='1' start_line='1129' end_line='1130'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>1129,1130</deleted_lines>
 		</method>
 		<method name='valid_answer_idxs' parameters='start_idx,end_idx,n_non_padding,max_answer_length,seq_2_start_t'>
 				<method_info nloc='13' complexity='8' token_count='70' nesting_level='1' start_line='1173' end_line='1206'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>1173,1174,1175,1176,1177,1178,1179,1180,1181,1182,1183,1184,1185,1186,1187,1188,1189,1190,1191,1192,1193,1194,1195,1196,1197,1198,1199,1200,1201,1202,1203,1204,1205,1206</deleted_lines>
 		</method>
 		<method name='logits_to_preds' parameters='self,logits,padding_mask,start_of_word,seq_2_start_t,max_answer_length,kwargs'>
 				<method_info nloc='29' complexity='2' token_count='298' nesting_level='1' start_line='1059' end_line='1127'></method_info>
 			<added_lines>1059,1060,1090,1092,1093,1094,1095,1097,1098,1099,1100,1101,1102,1103,1104,1105,1106,1107,1108,1109,1123</added_lines>
 			<deleted_lines>1059,1080,1090,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1117,1121,1122,1123</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines>1172,1207</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='ADD' old_name='None' new_name='test\benchmarks\question_answering_components.html'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 	</modification>
 	<modification change_type='MODIFY' old_name='test\benchmarks\question_answering_components.py' new_name='test\benchmarks\question_answering_components.py'>
 		<file_info nloc='153' complexity='17' token_count='884'></file_info>
 		<modified_lines>
 			<added_lines>13,16,23,24</added_lines>
 			<deleted_lines>14,22</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='test\test_input_features.py' new_name='test\test_input_features.py'>
 		<file_info nloc='35' complexity='7' token_count='250'></file_info>
 		<method name='test_sample_to_features_qa' parameters='caplog'>
 				<method_info nloc='19' complexity='5' token_count='182' nesting_level='0' start_line='20' end_line='43'></method_info>
 			<added_lines>36</added_lines>
 			<deleted_lines>35</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>12</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
