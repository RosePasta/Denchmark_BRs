<bug_data>
<bug id='5062' author='opencv-pushbot' open_date='2015-07-27T11:40:11Z' closed_time='2015-10-06T12:27:19Z'>
 	<summary>Data race may happen between oclCleanupCallback and Mat::GetUMat()</summary>
 	<description>
 Transferred from &lt;denchmark-link:http://code.opencv.org/issues/4468&gt;http://code.opencv.org/issues/4468&lt;/denchmark-link&gt;
 
 &lt;denchmark-code&gt;|| Pavel  Vlasov on 2015-07-07 13:33
 || Priority: Normal
 || Affected: branch 'master' (3.0-dev)
 || Category: None
 || Tracker: Bug
 || Difficulty: 
 || PR: 
 || Platform: Any / Any
 &lt;/denchmark-code&gt;
 
 &lt;denchmark-h:h2&gt;Data race may happen between oclCleanupCallback and Mat::GetUMat()&lt;/denchmark-h&gt;
 
 &lt;denchmark-code&gt;Case 1: reuse of old src Mat in OCL pipe leads to data race with oclCleanupCallback and can result in asser fail or other undefined behavior.
 
 Case 2: concurent deallocation of UMatData between UMat (oclCleanupCallback) and Mat (stack) deallocators.
 
 See: https://github.com/Itseez/opencv/pull/3799 this pull-request contains tests for both cases.
 &lt;/denchmark-code&gt;
 
 &lt;denchmark-h:h2&gt;History&lt;/denchmark-h&gt;
 
 &lt;denchmark-h:h5&gt;Alexander Alekhin on 2015-07-07 13:58&lt;/denchmark-h&gt;
 
 &lt;denchmark-code&gt;Related issue: http://code.opencv.org/issues/4380
 &lt;/denchmark-code&gt;
 
 	</description>
 	<comments>
 	</comments>
 </bug>
<commit id='8293ed7f9b9cbae0c585f191bc80f1910e92b8f8' author='Alexander Alekhin' date='2015-08-06 13:50:13+03:00'>
 	<dmm_unit complexity='1.0' interfacing='1.0' size='0.0'></dmm_unit>
 	<modification change_type='MODIFY' old_name='modules\core\test\test_umat.cpp' new_name='modules\core\test\test_umat.cpp'>
 		<file_info nloc='932' complexity='91' token_count='6820'></file_info>
 		<method name='cvtest::ocl::OCL_TEST' parameters='UMat,OCL_ThreadSafe_CleanupCallback_2_VeryLongTest'>
 				<method_info nloc='24' complexity='4' token_count='134' nesting_level='2' start_line='1067' end_line='1094'></method_info>
 			<added_lines>1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='cvtest::ocl::OCL_TEST' parameters='UMat,OCL_ThreadSafe_CleanupCallback_1_VeryLongTest'>
 				<method_info nloc='26' complexity='4' token_count='170' nesting_level='2' start_line='1032' end_line='1064'></method_info>
 			<added_lines>1032,1033,1034,1035,1036,1037,1038,1039,1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>1029,1030,1031,1065,1066,1095,1096</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
