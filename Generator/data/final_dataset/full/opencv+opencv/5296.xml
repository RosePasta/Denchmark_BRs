<bug_data>
<bug id='5296' author='ghost(ghost)' open_date='2015-09-03T10:11:46Z' closed_time='2019-12-19T14:40:53Z'>
 	<summary>Multiple MOG2_GPU objects share the same parameter values</summary>
 	<description>
 Hi,
 While using MOG2_GPU class, I realized that if you have two MOG2_GPU objets whenever you modify any parameter of one of the objects, the other is affected too.
 Taking a look at OpenCV code, I think that this is related to the declaration of MOG2_GPU parameters in file "opencv/modules/cudabgsegm/src/cuda/mog2.cu", where MOG2_GPU variables are allocated only once, independently from the number of MOG2_GPU objects . As a consequence, each object that calls the loadConstants method, overwrites the variables values affecting every MOG2_GPU object.
 I think that this implementation is similar to other gpu classes, so I suppose the same situation takes place with these classes.
 My question is whether there is any plan to modify this behavior or this was implemented intentionally and there will be no modification in the future.
 	</description>
 	<comments>
 		<comment id='1' author='ghost(ghost)' date='2019-12-04T16:05:21Z'>
 		This one recently bit us... Any ideas if someone is working on it?
 Seems like, at the very least, the API should prevent allowing the creation of multiple instances of this. And/or the documentation should point out that it is unsafe...
 		</comment>
 	</comments>
 </bug>
<commit id='5bf73457431b7d2cb87ac8c107865388dbf66642' author='jeffeDurand' date='2019-12-19 13:02:48+03:00'>
 	<dmm_unit complexity='1.0' interfacing='0.0' size='1.0'></dmm_unit>
 	<modification change_type='MODIFY' old_name='modules\cudabgsegm\src\cuda\mog2.cu' new_name='modules\cudabgsegm\src\cuda\mog2.cu'>
 		<file_info nloc='None' complexity='None' token_count='None'></file_info>
 		<modified_lines>
 			<added_lines>50,52,53,54,55,56,57,58,59,60,61,63,64,65,66,67,68,69,70,71,72,73,74,76,77,78,79,80,81,82,83,84,85,86,87,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,121,122,123,125,126,128,130,132,134,135,137,139,141,142,143,144,145,146,147,149,150,152,154,155,156,158,159,160,162,163,164,165,166,168,170,171,172,174,175,177,178,180,181,182,184,186,187,188,190,191,192,193,194,196,197,198,199,200,203,205,207,208,209,210,211,214,215,216,218,220,221,222,224,226,228,229,230,231,233,234,235,236,237,239,241,242,243,245,247,248,250,251,253,254,255,256,257,258,259,260,261,262,264,266,267,269,270,271,272,274,275,276,277,279,281,282,284,285,286,288,289,290,291,293,295,296,297,299,300,302,303,304,305,308,309,310,312,313,314,315,316,317,319,321,322,323,325,326,327,328,329,330,331,333,334,335,336,338,340,341,342,344,345,346,347,349,351,353,354,356,357,358,359,360,362,363,365,367,368,370,371,372,374,375,377,379,380,381,383,385,386,388,389,390,391,392,394,396,397,399,400,401,403,404,405,407,408,409,410,411,412,413,414,415,416</added_lines>
 			<deleted_lines>50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,107,108,109,110,111,112,113,114,115,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,133,134,135,136,137,138,139,141,142,144,146,147,149,151,153,155,156,158,160,162,164,165,166,167,168,169,170,171,172,173,175,176,177,179,180,181,183,184,185,186,187,189,191,192,193,195,196,198,199,201,202,203,205,207,208,209,211,212,213,214,215,217,218,219,220,221,222,224,226,228,229,230,231,232,235,236,239,241,242,243,245,247,249,250,251,252,254,255,256,257,258,260,262,263,264,266,268,269,271,272,274,275,276,277,278,280,281,282,283,284,287,288,290,291,292,293,295,296,297,298,300,302,303,305,306,307,308,309,310,311,312,314,316,317,318,319,320,321,323,324,326,327,329,332,333,334,335,336,337,338,339,341,342,343,345,346,347,348,349,350,351,353,354,355,356,358,360,361,362,364,365,366,367,369,370,371,372,374,375,377,378,380,381,383,384,386,388,389,391,392,393,395,396,398,400,401,402,404,406,407,409,410,411,412,413,415,417,418,420,421,422,424,425,426,428,429,430,431,433,434,435,436</deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='ADD' old_name='None' new_name='modules\cudabgsegm\src\cuda\mog2.hpp'>
 		<file_info nloc='21' complexity='0' token_count='135'></file_info>
 	</modification>
 	<modification change_type='MODIFY' old_name='modules\cudabgsegm\src\mog2.cpp' new_name='modules\cudabgsegm\src\mog2.cpp'>
 		<file_info nloc='144' complexity='43' token_count='1344'></file_info>
 		<method name='MOG2ImplCV_FINAL::setVarInit' parameters='varInit'>
 				<method_info nloc='1' complexity='1' token_count='17' nesting_level='2' start_line='105' end_line='105'></method_info>
 			<added_lines>105</added_lines>
 			<deleted_lines>105</deleted_lines>
 		</method>
 		<method name='MOG2Impl::MOG2Impl' parameters='history,varThreshold,detectShadows'>
 				<method_info nloc='16' complexity='3' token_count='122' nesting_level='1' start_line='147' end_line='165'></method_info>
 			<added_lines>147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165</added_lines>
 			<deleted_lines>147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getVarMin' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='107' end_line='107'></method_info>
 			<added_lines>107</added_lines>
 			<deleted_lines>107</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setNMixtures' parameters='nmixtures'>
 				<method_info nloc='1' complexity='1' token_count='14' nesting_level='2' start_line='93' end_line='93'></method_info>
 			<added_lines>93</added_lines>
 			<deleted_lines>93</deleted_lines>
 		</method>
 		<method name='MOG2Impl::apply' parameters='_frame,_fgmask,learningRate,stream'>
 				<method_info nloc='17' complexity='7' token_count='214' nesting_level='1' start_line='177' end_line='200'></method_info>
 			<added_lines>177,179,180,181,183,184,186,187,189,190,192,194,195,196,198,199,200</added_lines>
 			<deleted_lines>177,179,180,181,183,185,186,188,189,191,192,194,196,197,198,200</deleted_lines>
 		</method>
 		<method name='MOG2Impl::initialize' parameters='frameSize,frameType'>
 				<method_info nloc='16' complexity='3' token_count='160' nesting_level='1' start_line='219' end_line='245'></method_info>
 			<added_lines>219,221,223,224,225,227,228,230,231,232,233,234,235,236,238,239,240,242,244</added_lines>
 			<deleted_lines>219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,244,245</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getHistory' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='9' nesting_level='2' start_line='89' end_line='89'></method_info>
 			<added_lines>89</added_lines>
 			<deleted_lines>89</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getVarThreshold' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='98' end_line='98'></method_info>
 			<added_lines>98</added_lines>
 			<deleted_lines>98</deleted_lines>
 		</method>
 		<method name='cv::cuda::createBackgroundSubtractorMOG2' parameters='int,double,bool'>
 				<method_info nloc='5' complexity='1' token_count='28' nesting_level='0' start_line='52' end_line='56'></method_info>
 			<added_lines>52,53,54,55,56</added_lines>
 			<deleted_lines>54,56</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getVarMax' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='110' end_line='110'></method_info>
 			<added_lines>110</added_lines>
 			<deleted_lines>110</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setBackgroundRatio' parameters='ratio'>
 				<method_info nloc='1' complexity='1' token_count='17' nesting_level='2' start_line='96' end_line='96'></method_info>
 			<added_lines>96</added_lines>
 			<deleted_lines>96</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setShadowThreshold' parameters='threshold'>
 				<method_info nloc='1' complexity='1' token_count='17' nesting_level='2' start_line='123' end_line='123'></method_info>
 			<added_lines>123</added_lines>
 			<deleted_lines>123</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getVarInit' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='104' end_line='104'></method_info>
 			<added_lines>104</added_lines>
 			<deleted_lines>104</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setVarMax' parameters='varMax'>
 				<method_info nloc='1' complexity='1' token_count='25' nesting_level='2' start_line='111' end_line='111'></method_info>
 			<added_lines>111</added_lines>
 			<deleted_lines>111</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getComplexityReductionThreshold' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='10' nesting_level='2' start_line='113' end_line='113'></method_info>
 			<added_lines>113</added_lines>
 			<deleted_lines>113</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setHistory' parameters='history'>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='90' end_line='90'></method_info>
 			<added_lines>90</added_lines>
 			<deleted_lines>90</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setDetectShadows' parameters='detectShadows'>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='117' end_line='117'></method_info>
 			<added_lines>117</added_lines>
 			<deleted_lines>117</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getVarThresholdGen' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='101' end_line='101'></method_info>
 			<added_lines>101</added_lines>
 			<deleted_lines>101</deleted_lines>
 		</method>
 		<method name='MOG2Impl::initialize' parameters='frameSize,frameType,stream'>
 				<method_info nloc='16' complexity='3' token_count='176' nesting_level='1' start_line='217' end_line='243'></method_info>
 			<added_lines>217,218,219,221,223,224,225,227,228,230,231,232,233,234,235,236,238,239,240,242</added_lines>
 			<deleted_lines>217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242</deleted_lines>
 		</method>
 		<method name='MOG2Impl::apply' parameters='image,fgmask,learningRate'>
 				<method_info nloc='4' complexity='1' token_count='30' nesting_level='1' start_line='172' end_line='175'></method_info>
 			<added_lines>172,173,174,175</added_lines>
 			<deleted_lines>172,174,175</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setVarMin' parameters='varMin'>
 				<method_info nloc='1' complexity='1' token_count='25' nesting_level='2' start_line='108' end_line='108'></method_info>
 			<added_lines>108</added_lines>
 			<deleted_lines>108</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setShadowValue' parameters='value'>
 				<method_info nloc='1' complexity='1' token_count='17' nesting_level='2' start_line='120' end_line='120'></method_info>
 			<added_lines>120</added_lines>
 			<deleted_lines>120</deleted_lines>
 		</method>
 		<method name='MOG2Impl::~MOG2Impl' parameters=''>
 				<method_info nloc='4' complexity='1' token_count='12' nesting_level='1' start_line='167' end_line='170'></method_info>
 			<added_lines>167,168,169,170</added_lines>
 			<deleted_lines>167,168,169,170</deleted_lines>
 		</method>
 		<method name='MOG2Impl::getBackgroundImage' parameters='backgroundImage'>
 				<method_info nloc='4' complexity='1' token_count='21' nesting_level='1' start_line='202' end_line='205'></method_info>
 			<added_lines>202,203,204,205</added_lines>
 			<deleted_lines>202,204,205</deleted_lines>
 		</method>
 		<method name='MOG2Impl::getBackgroundImage' parameters='_backgroundImage,stream'>
 				<method_info nloc='7' complexity='1' token_count='68' nesting_level='1' start_line='207' end_line='215'></method_info>
 			<added_lines>207,208,209,210,211,212,213,214,215</added_lines>
 			<deleted_lines>207,208,209,210,211,212,213,214,215</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setComplexityReductionThreshold' parameters='ct'>
 				<method_info nloc='1' complexity='1' token_count='15' nesting_level='2' start_line='114' end_line='114'></method_info>
 			<added_lines>114</added_lines>
 			<deleted_lines>114</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setVarThreshold' parameters='varThreshold'>
 				<method_info nloc='1' complexity='1' token_count='17' nesting_level='2' start_line='99' end_line='99'></method_info>
 			<added_lines>99</added_lines>
 			<deleted_lines>99</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getDetectShadows' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='10' nesting_level='2' start_line='116' end_line='116'></method_info>
 			<added_lines>116</added_lines>
 			<deleted_lines>116</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getShadowThreshold' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='122' end_line='122'></method_info>
 			<added_lines>122</added_lines>
 			<deleted_lines>122</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getShadowValue' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='119' end_line='119'></method_info>
 			<added_lines>119</added_lines>
 			<deleted_lines>119</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::setVarThresholdGen' parameters='varThresholdGen'>
 				<method_info nloc='1' complexity='1' token_count='17' nesting_level='2' start_line='102' end_line='102'></method_info>
 			<added_lines>102</added_lines>
 			<deleted_lines>102</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getBackgroundRatio' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='95' end_line='95'></method_info>
 			<added_lines>95</added_lines>
 			<deleted_lines>95</deleted_lines>
 		</method>
 		<method name='MOG2ImplCV_FINAL::getNMixtures' parameters=''>
 				<method_info nloc='1' complexity='1' token_count='12' nesting_level='2' start_line='92' end_line='92'></method_info>
 			<added_lines>92</added_lines>
 			<deleted_lines>92</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines>44,48,60,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,83,84,85,86,87,88,91,94,97,100,103,106,109,112,115,118,121,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,166,171,176,201,206,216</added_lines>
 			<deleted_lines>50,57,58,59,60,61,62,64,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,91,94,97,100,103,106,109,112,115,118,121,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,166,171,176,201,206,216</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
