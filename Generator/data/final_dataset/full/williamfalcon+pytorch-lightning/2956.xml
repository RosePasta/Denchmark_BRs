<bug_data>
<bug id='2956' author='lezwon' open_date='2020-08-13T17:37:50Z' closed_time='2020-08-13T22:57:24Z'>
 	<summary>'NoneType' object has no attribute 'lower'  while training on TPU</summary>
 	<description>
 &lt;denchmark-h:h2&gt;üêõ Bug&lt;/denchmark-h&gt;
 
 distributed_backend is not set to 'tpu' which breaks it here: line 
 
 
 pytorch-lightning/pytorch_lightning/trainer/distrib_data_parallel.py
 
 
          Line 412
       in
       2c935d0
 
 
 
 
 
 
  if self.distributed_backend.lower() not in ['ddp_spawn', 'ddp_cpu', 'tpu']: 
 
 
 
 
 
 distributed_backend has to be explicitly specified in Trainer params to have it working which is misleading from the docs: &lt;denchmark-link:https://pytorch-lightning.readthedocs.io/en/latest/tpu.html#distributed-backend-with-tpu&gt;https://pytorch-lightning.readthedocs.io/en/latest/tpu.html#distributed-backend-with-tpu&lt;/denchmark-link&gt;
 
 &lt;denchmark-h:h3&gt;To Reproduce&lt;/denchmark-h&gt;
 
 Steps to reproduce the behavior:
 &lt;denchmark-link:https://www.kaggle.com/lezwon/lightning-mnist-tpu&gt;https://www.kaggle.com/lezwon/lightning-mnist-tpu&lt;/denchmark-link&gt;
 
 &lt;denchmark-h:h3&gt;Expected behavior&lt;/denchmark-h&gt;
 
 Should automatically set distributed_backend and train successfully.
 &lt;denchmark-h:h3&gt;Additional context&lt;/denchmark-h&gt;
 
 Related to :
 &lt;denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/issues/2698#issuecomment-671665202&gt;#2698 (comment)&lt;/denchmark-link&gt;
 
 &lt;denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/issues/2812#issuecomment-668659590&gt;#2812 (comment)&lt;/denchmark-link&gt;
 
 	</description>
 	<comments>
 	</comments>
 </bug>
<commit id='cfd06a083b47b6c5c619f5362441197cb4e93e9e' author='Lezwon Castelino' date='2020-08-13 18:57:23-04:00'>
 	<dmm_unit complexity='0.0' interfacing='0.0' size='0.2'></dmm_unit>
 	<modification change_type='MODIFY' old_name='pytorch_lightning\trainer\distrib_data_parallel.py' new_name='pytorch_lightning\trainer\distrib_data_parallel.py'>
 		<file_info nloc='374' complexity='88' token_count='1552'></file_info>
 		<method name='init_tpu' parameters='self'>
 				<method_info nloc='2' complexity='1' token_count='10' nesting_level='1' start_line='240' end_line='245'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>241,242,243</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='pytorch_lightning\trainer\trainer.py' new_name='pytorch_lightning\trainer\trainer.py'>
 		<file_info nloc='1109' complexity='141' token_count='4911'></file_info>
 		<modified_lines>
 			<added_lines>524</added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='tests\models\test_tpu.py' new_name='tests\models\test_tpu.py'>
 		<file_info nloc='176' complexity='14' token_count='1151'></file_info>
 		<method name='test_dataloaders_passed_to_fit' parameters='tmpdir'>
 				<method_info nloc='9' complexity='1' token_count='55' nesting_level='0' start_line='194' end_line='205'></method_info>
 			<added_lines>199,200,201,202,203</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='test_model_tpu_cores_1' parameters='tmpdir'>
 				<method_info nloc='12' complexity='1' token_count='64' nesting_level='0' start_line='38' end_line='51'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>44</deleted_lines>
 		</method>
 		<method name='test_model_16bit_tpu_index' parameters='tmpdir,tpu_core'>
 				<method_info nloc='17' complexity='1' token_count='107' nesting_level='0' start_line='119' end_line='137'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>128</deleted_lines>
 		</method>
 		<method name='test_tpu_grad_norm' parameters='tmpdir'>
 				<method_info nloc='13' complexity='1' token_count='70' nesting_level='0' start_line='183' end_line='197'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>189</deleted_lines>
 		</method>
 		<method name='test_model_tpu_index' parameters='tmpdir,tpu_core'>
 				<method_info nloc='13' complexity='1' token_count='79' nesting_level='0' start_line='57' end_line='71'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>63</deleted_lines>
 		</method>
 		<method name='test_model_16bit_tpu_cores_8' parameters='tmpdir'>
 				<method_info nloc='15' complexity='1' token_count='78' nesting_level='0' start_line='142' end_line='160'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>149</deleted_lines>
 		</method>
 		<method name='test_exception_when_no_tpu_found' parameters='tmpdir'>
 				<method_info nloc='12' complexity='1' token_count='62' nesting_level='0' start_line='231' end_line='244'></method_info>
 			<added_lines>238,239,240,241,242,243</added_lines>
 			<deleted_lines>239</deleted_lines>
 		</method>
 		<method name='test_model_tpu_early_stop' parameters='tmpdir'>
 				<method_info nloc='13' complexity='1' token_count='54' nesting_level='0' start_line='165' end_line='178'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>175</deleted_lines>
 		</method>
 		<method name='test_model_tpu_cores_8' parameters='tmpdir'>
 				<method_info nloc='14' complexity='1' token_count='74' nesting_level='0' start_line='76' end_line='93'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>82</deleted_lines>
 		</method>
 		<method name='test_distributed_backend_set_when_using_tpu' parameters='tmpdir,tpu_cores'>
 				<method_info nloc='2' complexity='1' token_count='19' nesting_level='0' start_line='241' end_line='243'></method_info>
 			<added_lines>241,242,243</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='test_tpu_misconfiguration' parameters=''>
 				<method_info nloc='3' complexity='1' token_count='27' nesting_level='0' start_line='217' end_line='220'></method_info>
 			<added_lines>220</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<method name='test_model_16bit_tpu_cores_1' parameters='tmpdir'>
 				<method_info nloc='14' complexity='1' token_count='80' nesting_level='0' start_line='98' end_line='113'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>105</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines>207,224,225,226</deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
