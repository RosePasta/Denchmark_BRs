<bug_data>
<bug id='933' author='myungjoo' open_date='2018-11-29T01:48:42Z' closed_time='2018-11-29T08:02:11Z'>
 	<summary>[Sync-Errors in Tensor_Repo] Possible deadlock / data inconsistency</summary>
 	<description>
 By looking at the code again, I'm seeing possible sync-errors that may cause DEADLOCKs:
 
 tensor_repo.c::gst_tensor_repo_add_repodata
 
   GST_REPO_LOCK ();
   gpointer check = g_hash_table_lookup (_repo.hash, GINT_TO_POINTER (nth));
 
   if (check != NULL) {
     return TRUE;
 }
 You are returning without releasing the lock.
 
 
 _repo.hash is often accessed without protection. You need to define which lock is protecting (GST_REPO_LOCK()??) and enforce using it whenever _repo.has is used.
 
 
 When "nth" of _repo.hash is used, you need to ensure that nth's LOCK is ACQUIRED.
 
 
 For 2.3., if an operation can be guaranteed to be atomic, it can be skipped with some special conditions, but it doesn't appear to be applicable in this code.
 	</description>
 	<comments>
 		<comment id='1' author='myungjoo' date='2018-11-29T01:48:44Z'>
 		 : Thank you for posting issue &lt;denchmark-link:https://github.com/nnstreamer/nnstreamer/issues/933&gt;#933&lt;/denchmark-link&gt;
 . The person in charge will reply soon.
 		</comment>
 		<comment id='2' author='myungjoo' date='2018-11-29T02:09:10Z'>
 		
 Return without Releasing. I fixed. (PR #934)
 I think we do not need to get the _repo.hash lock except some cases.
 . remove and add nth TensorRepoData structure into hash table.
 . create and remove has table.
 For the access and wirte the GstBuffer, we could use TensorRepoData-&gt;lock and cond variables.
 In order to make sure set and get the buffer correctly, another cond variable is introduced. (cond_pull, cond_push : PR #922).
 I concerned this when I wrote the code, but I will check again.
 
 		</comment>
 	</comments>
 </bug>
<commit id='d83e7bb63f7b6328ef7e02e5a4e0c55128e612fe' author='jijoong.moon' date='2018-11-29 08:02:10+00:00'>
 	<dmm_unit complexity='1.0' interfacing='1.0' size='0.0'></dmm_unit>
 	<modification change_type='MODIFY' old_name='gst\nnstreamer\tensor_repo.c' new_name='gst\nnstreamer\tensor_repo.c'>
 		<file_info nloc='145' complexity='26' token_count='682'></file_info>
 		<method name='gst_tensor_repo_get_buffer' parameters='nth'>
 				<method_info nloc='29' complexity='6' token_count='130' nesting_level='0' start_line='143' end_line='173'></method_info>
 			<added_lines>150,151</added_lines>
 			<deleted_lines>144</deleted_lines>
 		</method>
 		<method name='gst_tensor_repo_set_buffer' parameters='nth,buffer'>
 				<method_info nloc='17' complexity='3' token_count='86' nesting_level='0' start_line='88' end_line='108'></method_info>
 			<added_lines>93,94,95,96,97</added_lines>
 			<deleted_lines>92</deleted_lines>
 		</method>
 		<method name='gst_tensor_repo_add_repodata' parameters='nth'>
 				<method_info nloc='23' complexity='3' token_count='131' nesting_level='0' start_line='54' end_line='82'></method_info>
 			<added_lines>63</added_lines>
 			<deleted_lines></deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 	<modification change_type='MODIFY' old_name='gst\tensor_reposrc\tensor_reposrc.c' new_name='gst\tensor_reposrc\tensor_reposrc.c'>
 		<file_info nloc='197' complexity='27' token_count='1058'></file_info>
 		<method name='gst_tensor_reposrc_create' parameters='src,buffer'>
 				<method_info nloc='33' complexity='5' token_count='202' nesting_level='0' start_line='262' end_line='298'></method_info>
 			<added_lines></added_lines>
 			<deleted_lines>269,270,271</deleted_lines>
 		</method>
 		<modified_lines>
 			<added_lines></added_lines>
 			<deleted_lines></deleted_lines>
 		</modified_lines>
 	</modification>
 </commit>
</bug_data>
