{"BR": {"BR_id": "543", "BR_author": "Lornatang", "BRopenT": "2020-07-28T14:22:36Z", "BRcloseT": "2020-07-29T21:02:09Z", "BR_text": {"BRsummary": "The old version model configuration file error caused by the new version.", "BRdescription": "\n Before submitting a bug report, please be aware that your issue must be reproducible with all of the following, otherwise it is non-actionable, and we can not help you:\n \n Current repo: run git fetch && git status -uno to check and git pull to update repo\n Common dataset: coco.yaml or coco128.yaml\n Common environment: Colab, Google Cloud, or Docker image. See https://github.com/ultralytics/yolov5#reproduce-our-environment\n \n If this is a custom dataset/training question you must include your train*.jpg, test*.jpg and results.png figures, or we can not help you. You can generate these with utils.plot_results().\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n From models/hub/*.yaml configure file all Invalidation. I think the reason for this is that you no longer output the nn.Conv2d function.\n <denchmark-h:h2>To Reproduce (REQUIRED)</denchmark-h>\n \n Input:\n <denchmark-code># command\n python train.py --cfg models/hub/yolov3-spp.yaml --data data/coco.yaml\n </denchmark-code>\n \n Output:\n <denchmark-code># report error message\n Traceback (most recent call last):\n   File \"train.py\", line 469, in <module>\n     train(hyp, tb_writer, opt, device)\n     ......\n IndexError: index 0 is out of range\n </denchmark-code>\n \n <denchmark-h:h2>Expected behavior</denchmark-h>\n \n Run this program normally.\n <denchmark-h:h2>Environment</denchmark-h>\n \n \n OS: [Ubuntu18.04]\n GPU [2080 Ti]\n \n <denchmark-h:h2>Additional context</denchmark-h>\n \n I have read your model configuration file, I think the new version of the configuration file should be filled out in accordance with it, I am also ready to submit a PR, looking forward to your reply.\n yolov3-spp.yaml\n <denchmark-code># parameters\n nc: 80  # number of classes\n depth_multiple: 1.0  # model depth multiple\n width_multiple: 1.0  # layer channel multiple\n \n # anchors\n anchors:\n   - [10,13, 16,30, 33,23]  # P3/8\n   - [30,61, 62,45, 59,119]  # P4/16\n   - [116,90, 156,198, 373,326]  # P5/32\n \n # darknet53 backbone\n backbone:\n   # [from, number, module, args]\n   [[-1, 1, Conv, [32, 3, 1]],  # 0\n    [-1, 1, Conv, [64, 3, 2]],  # 1-P1/2\n    [-1, 1, Bottleneck, [64]],\n    [-1, 1, Conv, [128, 3, 2]],  # 3-P2/4\n    [-1, 2, Bottleneck, [128]],\n    [-1, 1, Conv, [256, 3, 2]],  # 5-P3/8\n    [-1, 8, Bottleneck, [256]],\n    [-1, 1, Conv, [512, 3, 2]],  # 7-P4/16\n    [-1, 8, Bottleneck, [512]],\n    [-1, 1, Conv, [1024, 3, 2]], # 9-P5/32\n    [-1, 4, Bottleneck, [1024]],  # 10\n   ]\n \n # YOLOv3-SPP head\n head:\n   [[-1, 1, Bottleneck, [1024, False]],\n    [-1, 1, SPP, [512, [5, 9, 13]]],\n    [-1, 1, Conv, [1024, 3, 1]],\n    [-1, 1, Conv, [512, 1, 1]],\n    [-1, 1, Conv, [1024, 3, 1]],  # 15\n \n    [-1, 1, Conv, [256, 1, 1]],\n    [-1, 1, nn.Upsample, [None, 2, 'nearest']],\n    [[-1, 8], 1, Concat, [1]],  # cat backbone P4\n    [-1, 1, Bottleneck, [512, False]],\n    [-1, 1, Bottleneck, [512, False]],\n    [-1, 1, Conv, [256, 1, 1]],\n    [-1, 1, Conv, [512, 3, 1]],  # 22\n \n    [-1, 1, Conv, [128, 1, 1]],\n    [-1, 1, nn.Upsample, [None, 2, 'nearest']],\n    [[-1, 6], 1, Concat, [1]],  # cat backbone P3\n    [-1, 1, Bottleneck, [256, False]],\n    [-1, 2, Bottleneck, [256, False]],  # 27\n \n    [[27, 22, 15], 1, Detect, [nc, anchors]],   # Detect(P3, P4, P5)\n   ]\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "Lornatang", "commentT": "2020-07-28T18:31:33Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Lornatang>@Lornatang</denchmark-link>\n  thanks for the bug report. Yes, you are correct the archived models in the hub/ folder need updating to work correctly with the new yolo.py parser. The main change in v2.0 is that the output nn.Conv2d layers are all integrated into the final Detect layer.\n Actually yes, it looks like your updated yaml file here is correct! Can you submit a PR with it?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "Lornatang", "commentT": "2020-07-29T10:16:01Z", "comment_text": "\n \t\tHi <denchmark-link:https://github.com/glenn-jocher>@glenn-jocher</denchmark-link>\n  , will this new version of yolov5 improve the accuracy or inference time? OR how this new update reflects in the   detection output ?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "Lornatang", "commentT": "2020-07-29T14:27:12Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/Lornatang>@Lornatang</denchmark-link>\n  Will u also update yolov5s yolov5m yolov5l model config in v1 version? It's all broken now.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "Lornatang", "commentT": "2020-07-29T14:44:39Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/jinfagang>@jinfagang</denchmark-link>\n  It's late at night now, I'll take a look for you tomorrow. Can you share your first code with me? I can send you the correct YAML file tomorrow.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "Lornatang", "commentT": "2020-07-29T18:13:59Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/jinfagang>@jinfagang</denchmark-link>\n  <denchmark-link:https://github.com/Lornatang>@Lornatang</denchmark-link>\n  version 1.0 will not be updated. v2.0 introduced breaking changes into the model building process, so previous yamls and pt files will not work with the current.\n You can clone the last v1.0 commit if you want to here:\n <denchmark-link:https://github.com/ultralytics/yolov5/releases/tag/v2.0>https://github.com/ultralytics/yolov5/releases/tag/v2.0</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "Lornatang", "commentT": "2020-07-29T18:14:47Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/PiyalGeorge>@PiyalGeorge</denchmark-link>\n  yes v2.0 improves accuracy of larger models in particular. 5x increased from 48.4 to 49.0. Speed is the same.\n \t\t"}}}, "commit": {"commit_id": "adaf1d8ac109f5c0977c27ceb3c2165a9c619cf2", "commit_author": "Liu Changyu", "commitT": "2020-07-29 14:02:07-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "models\\hub\\yolov3-spp.yaml", "file_new_name": "models\\hub\\yolov3-spp.yaml", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "30,34,36,42,44,48,50", "deleted_lines": "30,34,35,37,43,44,46,50,51,53"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "models\\hub\\yolov5-fpn.yaml", "file_new_name": "models\\hub\\yolov5-fpn.yaml", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "29,31,34,36,39,41", "deleted_lines": "29,30,32,35,36,38,41,42,44"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "models\\hub\\yolov5-panet.yaml", "file_new_name": "models\\hub\\yolov5-panet.yaml", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "24,29,32,34,37,39,41,43,45,47", "deleted_lines": "28,29,30,33,34,38,39,41,43,44,46,48,49,51"}}}}}}