{"BR": {"BR_id": "414", "BR_author": "flesser", "BRopenT": "2020-07-19T07:59:45Z", "BRcloseT": "2020-07-21T13:25:24Z", "BR_text": {"BRsummary": "Indexing aborts when encountering broken symlink that looks like an image file", "BRdescription": "\n I am trying to index my existing collection in read-only mode.\n Somewhere in there I have some broken symlinks (pointing to destinations that don't exist anymore) that are named *.JPG.\n <denchmark-h:h2>Actual Behavior</denchmark-h>\n \n Once Photoprism encounters the first one of them, the indexing process stops and no further images are indexed:\n <denchmark-code>time=\"2020-07-18T17:52:00Z\" level=error msg=\"stat /photoprism/originals/2010/2010 Norwegen/zzPr\u00e4sentation/01/0101.JPG: no such file or directory\"\n time=\"2020-07-18T17:52:08Z\" level=info msg=\"purge: searching index for hidden media files\"\n time=\"2020-07-18T17:52:08Z\" level=info msg=\"indexed 25207 files in 1m25.465540257s\"\n time=\"2020-07-18T17:52:08Z\" level=info msg=\"closed database connection\"\n </denchmark-code>\n \n # docker exec photoprism ls -l \"/photoprism/originals/2010/2010 Norwegen/zzPr\u00e4sentation/01/\"\n total 15976\n lrwxrwxrwx 1 www-data www-data      69 Jun 21  2011 0101.JPG -> /home/Bilder/Fotos/Norwegen 2010/2010-08-18/P1040281.JPG\n Restarting the index process stops at the same place again and no photos after the '2010/' folder are indexed.\n <denchmark-h:h2>Expected Behavior</denchmark-h>\n \n PhotoPrism logs, but ignores those broken \"files\" and continues indexing.\n <denchmark-h:h2>PhotoPrism version</denchmark-h>\n \n Whatever was in docker latest yesterday at that time, but also tried again this morning with the current 200718-24cfa1a-Linux-x86_64.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "flesser", "commentT": "2020-07-19T12:35:56Z", "comment_text": "\n \t\tExcellent catch! Turns out, godirwalk needs an error handler to skip such broken links...\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "flesser", "commentT": "2020-07-19T12:49:23Z", "comment_text": "\n \t\tI'll merge this to master after testing some other potential issues that may have been introduced with recent optimizations.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "flesser", "commentT": "2020-07-19T14:53:06Z", "comment_text": "\n \t\tFixed additional issues with wrong file type extensions, like PNGs that end with \".jpg\". Lots of files imported from Google Photos seem to suffer from this. Also removed a potential deadlock in our log events.\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "flesser", "commentT": "2020-07-20T22:13:34Z", "comment_text": "\n \t\tThis (and much more) should be fixed now.\n \t\t"}}}, "commit": {"commit_id": "0023fdb1e265db2ed68a3a8ad6b5a69ebcfcb7cf", "commit_author": "Michael Mayer", "commitT": "2020-07-19 14:45:49+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "internal\\photoprism\\convert.go", "file_new_name": "internal\\photoprism\\convert.go", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "68,69,70,71", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\photoprism\\files.go", "file_new_name": "internal\\photoprism\\files.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "69,70,71,72,73,74,75,76", "deleted_lines": null, "method_info": {"method_name": "Add", "method_params": "string,Time", "method_startline": "69", "method_endline": "76"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\photoprism\\import.go", "file_new_name": "internal\\photoprism\\import.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "135,136,137,138,141", "deleted_lines": "133", "method_info": {"method_name": "error", "method_params": "", "method_startline": "103", "method_endline": "180"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "internal\\photoprism\\index.go", "file_new_name": "internal\\photoprism\\index.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "143,176", "deleted_lines": "139,154,155,156,157", "method_info": {"method_name": "error", "method_params": "", "method_startline": "120", "method_endline": "195"}}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "internal\\photoprism\\resample.go", "file_new_name": "internal\\photoprism\\resample.go", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "70,71,72,73", "deleted_lines": null}}}, "file_5": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pkg\\fs\\filetype.go", "file_new_name": "pkg\\fs\\filetype.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134", "method_info": {"method_name": "Media", "method_params": "string", "method_startline": "115", "method_endline": "134"}}, "hunk_1": {"Ismethod": 1, "added_lines": null, "deleted_lines": "136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155", "method_info": {"method_name": "Sidecar", "method_params": "string", "method_startline": "136", "method_endline": "155"}}}}, "file_6": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pkg\\fs\\mediatype.go", "file_new_name": "pkg\\fs\\mediatype.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "49,50,51,52,53,54,55,56", "deleted_lines": null, "method_info": {"method_name": "IsMedia", "method_params": "string", "method_startline": "49", "method_endline": "56"}}, "hunk_1": {"Ismethod": 1, "added_lines": "36,37,38,39", "deleted_lines": null, "method_info": {"method_name": "GetMediaType", "method_params": "string", "method_startline": "35", "method_endline": "47"}}}}, "file_7": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pkg\\fs\\walk.go", "file_new_name": "pkg\\fs\\walk.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "27,28", "deleted_lines": null, "method_info": {"method_name": "SkipWalk", "method_params": "string,isDir,bool,Done,IgnoreList", "method_startline": "9", "method_endline": "47"}}}}}}}