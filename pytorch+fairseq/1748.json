{"BR": {"BR_id": "1748", "BR_author": "dugu9sword", "BRopenT": "2020-02-26T00:27:58Z", "BRcloseT": "2020-10-22T19:46:16Z", "BR_text": {"BRsummary": "DenoisingTask object has no attribute build_dataset_for_inference", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n Steps to reproduce the behavior (always include the command you ran):\n When I run the code below, an error raises that AttributeError: 'DenoisingTask' object has no attribute 'build_dataset_for_inference'\n <denchmark-h:h4>Code sample</denchmark-h>\n \n <denchmark-code>import torch\n bart = torch.hub.load('pytorch/fairseq', 'bart.large')\n bart.sample(['Hello world!'])\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "dugu9sword", "commentT": "2020-03-05T18:49:03Z", "comment_text": "\n \t\tI got the same error while trying to reproduce the xsum results. The default task when you initialize Bart is DenoisingTask. I was able to solve this problem by downloading the model weights and manually initializing the model as following:\n <denchmark-code>import torch\n from fairseq.models.bart import BARTModel\n \n bart = BARTModel.from_pretrained(\n             /path/to/bart.large/\n             checkpoint_file='model.pt',\n             data_name_or_path=/path/to/datadir/,\n             task='translation'\n         )\n </denchmark-code>\n \n I get the same error if I don't set task='translation'.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "dugu9sword", "commentT": "2020-03-05T23:18:35Z", "comment_text": "\n \t\tI've found a somehow hacking way:\n <denchmark-code>import torch\n bart = torch.hub.load('pytorch/fairseq', 'bart.large')\n foo = torch.hub.load(...)    # any translation task\n bart.task.build_dataset_for_inference = foo.task.build_dataset_for_inference\n bart.sample(['Hello world!'])\n </denchmark-code>\n \n Seems it works...\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "dugu9sword", "commentT": "2020-08-21T05:32:44Z", "comment_text": "\n \t\tA bit late for the party.\n This can be easily solved by adding the missing method to the denoising task from any translation task.\n I hacked the source code and re-compiled without any problems.\n \t\t"}}}, "commit": {"commit_id": "b8a938e96e08e5b39deb585d6cc6690de062dd4d", "commit_author": "Myle Ott", "commitT": "2020-10-22 12:45:49-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "examples\\bart\\README.md", "file_new_name": "examples\\bart\\README.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 7, "file_old_name": "fairseq\\models\\bart\\hub_interface.py", "file_new_name": "fairseq\\models\\bart\\hub_interface.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "92,93,94", "deleted_lines": null, "method_info": {"method_name": "generate", "method_params": "self,args,inference_step_args,kwargs", "method_startline": "90", "method_endline": "95"}}, "hunk_1": {"Ismethod": 1, "added_lines": "166,167,168,169,170,171", "deleted_lines": null, "method_info": {"method_name": "fill_mask", "method_params": "self,str,int,bool,generate_kwargs", "method_startline": "166", "method_endline": "171"}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "47,48", "method_info": {"method_name": "device", "method_params": "self", "method_startline": "47", "method_endline": "48"}}, "hunk_3": {"Ismethod": 1, "added_lines": "30,31", "deleted_lines": "29,30,31", "method_info": {"method_name": "__init__", "method_params": "self,cfg,task,model", "method_startline": "29", "method_endline": "31"}}, "hunk_4": {"Ismethod": 1, "added_lines": "107,108", "deleted_lines": "107,108", "method_info": {"method_name": "sample", "method_params": "self,int,bool,kwargs", "method_startline": "107", "method_endline": "108"}}, "hunk_5": {"Ismethod": 1, "added_lines": null, "deleted_lines": "143,144", "method_info": {"method_name": "getarg", "method_params": "name,default", "method_startline": "143", "method_endline": "144"}}, "hunk_6": {"Ismethod": 1, "added_lines": null, "deleted_lines": "116,117,118", "method_info": {"method_name": "generate", "method_params": "self,int,bool,kwargs", "method_startline": "114", "method_endline": "119"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "fairseq\\sequence_generator.py", "file_new_name": "fairseq\\sequence_generator.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "641", "deleted_lines": "296,638,639,654"}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "fairseq\\tasks\\denoising.py", "file_new_name": "fairseq\\tasks\\denoising.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236", "deleted_lines": null, "method_info": {"method_name": "build_dataset_for_inference", "method_params": "self,src_tokens,src_lengths,kwargs", "method_startline": "203", "method_endline": "236"}}}}}}}