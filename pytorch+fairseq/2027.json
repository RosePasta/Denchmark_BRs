{"BR": {"BR_id": "2027", "BR_author": "mgaido91", "BRopenT": "2020-04-19T14:42:49Z", "BRcloseT": "2020-04-21T13:01:23Z", "BR_text": {"BRsummary": "max_positions with tuple of size &gt; 2 returns a tuple of size 2", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n This problem appears adding a custom task in which the max_positions is a tuple of size 3 (or more).  In this case, currently fairseq ignores all elements after the 2nd in the tuple, when resolving the actual max_positions.\n The cause is the implementation of _match_types, which assumes tuples to have size 2.\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n Add a custom task with max_postions returning a tuple of 3 and check that the actual max positions used: it is a tuple of 2.\n <denchmark-h:h4>Code sample</denchmark-h>\n \n <denchmark-code>utils.resolve_max_positions(None, (2000, 100, 2000), 12000)  # returns (2000, 100)\n </denchmark-code>\n \n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n <denchmark-code>utils.resolve_max_positions(None, (2000, 100, 2000), 12000)  # should return (2000, 100, 2000)\n </denchmark-code>\n \n <denchmark-h:h3>Environment</denchmark-h>\n \n \n fairseq Version (e.g., 1.0 or master): master\n PyTorch Version (e.g., 1.0) 1.4\n OS (e.g., Linux): ubuntu\n How you installed fairseq (pip, source): source\n Build command you used (if compiling from source): python setup.py install -e .\n Python version: 3.7\n CUDA/cuDNN version: 10.0\n GPU models and configuration: K80\n Any other relevant information:\n \n <denchmark-h:h3>Additional context</denchmark-h>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "4ec169b988b858cd61dcad64211c7a741e8c738c", "commit_author": "Marco Gaido", "commitT": "2020-04-21 06:01:14-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "fairseq\\utils.py", "file_new_name": "fairseq\\utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "282", "deleted_lines": "282", "method_info": {"method_name": "_match_types", "method_params": "arg1,arg2", "method_startline": "277", "method_endline": "296"}}, "hunk_1": {"Ismethod": 1, "added_lines": "282", "deleted_lines": "282", "method_info": {"method_name": "_match_types.upgrade", "method_params": "arg_number,arg_structure", "method_startline": "280", "method_endline": "289"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\test_utils.py", "file_new_name": "tests\\test_utils.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "94,95,96", "deleted_lines": null, "method_info": {"method_name": "test_resolve_max_positions_with_tuple", "method_params": "self", "method_startline": "94", "method_endline": "96"}}}}}}}