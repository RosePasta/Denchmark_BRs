{"BR": {"BR_id": "3066", "BR_author": "takumayagi", "BRopenT": "2017-07-27T15:52:40Z", "BRcloseT": "2017-08-02T07:51:53Z", "BR_text": {"BRsummary": "Error in F.softmax when using non-contiguous array", "BRdescription": "\n F.softmax will produces error when using both F.split_axis and F.softmax, enabling cuDNN.\n I think this is related to <denchmark-link:https://github.com/chainer/chainer/pull/907>#907</denchmark-link>\n  and <denchmark-link:https://github.com/chainer/chainer/issues/2034>#2034</denchmark-link>\n  . I confirmed this occurs both in Chainer v1 and v2.\n <denchmark-h:h2>Conditions</denchmark-h>\n \n \n Chainer 2.0.1 (same error in 1.24.0)\n CuPy 1.0.1\n Ubuntu 16.04\n CUDA 8.0\n cuDNN 5.1\n \n <denchmark-h:h2>Code to reproduce</denchmark-h>\n \n #! /usr/bin/env python\n # -*- coding: utf-8 -*-\n \n import numpy as np\n import chainer.functions as F\n from chainer import Variable, cuda\n \n data = np.ones((2, 2), dtype=np.float32)\n data = cuda.to_gpu(data, 0)\n x = Variable(data)\n ys = F.split_axis(x, 2, axis=1)\n y = F.softmax(ys[0], axis=0)  # Error\n <denchmark-h:h2>Error messages</denchmark-h>\n \n Traceback (most recent call last):\n File \"bug_softmax.py\", line 12, in \n y = F.softmax(ys[0], axis=0)  # Error\n File \"/home/yagi/pyenv/versions/lab/lib/python3.4/site-packages/chainer/functions/activation/softmax.py\", line 106, in softmax\n return Softmax(axis=axis)(x)\n File \"/home/yagi/pyenv/versions/lab/lib/python3.4/site-packages/chainer/function.py\", line 200, in call\n outputs = self.forward(in_data)\n File \"/home/yagi/pyenv/versions/lab/lib/python3.4/site-packages/chainer/functions/activation/softmax.py\", line 42, in forward\n desc = cudnn.create_tensor_descriptor(x_tensor4d)\n File \"/home/yagi/pyenv/versions/lab/lib/python3.4/site-packages/cupy/cudnn.py\", line 75, in create_tensor_descriptor\n raise ValueError('cupy.cudnn supports c-contiguous arrays only')\n ValueError: cupy.cudnn supports c-contiguous arrays only\n \t"}, "comments": {}}, "commit": {"commit_id": "08447d4e6aa0122d7852199c365eb3b7e64dac37", "commit_author": "niboshi", "commitT": "2017-08-02 16:52:28+09:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "chainer\\functions\\activation\\softmax.py", "file_new_name": "chainer\\functions\\activation\\softmax.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "69,70,71,75", "deleted_lines": "68,72", "method_info": {"method_name": "backward", "method_params": "self,x,gy", "method_startline": "59", "method_endline": "82"}}, "hunk_1": {"Ismethod": 1, "added_lines": "41,42", "deleted_lines": "41", "method_info": {"method_name": "forward", "method_params": "self,x", "method_startline": "33", "method_endline": "57"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "tests\\chainer_tests\\functions_tests\\activation_tests\\test_softmax.py", "file_new_name": "tests\\chainer_tests\\functions_tests\\activation_tests\\test_softmax.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "94,95,96,97", "deleted_lines": null, "method_info": {"method_name": "test_backward_gpu_non_contiguous", "method_params": "self", "method_startline": "94", "method_endline": "97"}}, "hunk_1": {"Ismethod": 1, "added_lines": "68,69,70", "deleted_lines": null, "method_info": {"method_name": "test_forward_gpu_non_contiguous", "method_params": "self", "method_startline": "68", "method_endline": "70"}}}}}}}