{"BR": {"BR_id": "1966", "BR_author": "tonyyang-svail", "BRopenT": "2020-03-10T03:28:20Z", "BRcloseT": "2020-03-26T10:04:36Z", "BR_text": {"BRsummary": "Bad substitution error on SQL statement contains ${}", "BRdescription": "\n Description\n If a SQL statement contains ${}, for example\n <denchmark-code>-- ${internal.config}\n select 1;\n </denchmark-code>\n \n In the workflow mode, the job will fail with the following error\n <denchmark-code>bash: -- ${internal.config}\n select 1;: bad substitution\n </denchmark-code>\n \n Reproduction Steps\n Execute the above example.\n Root Cause\n The workflow YAML produced by this SQL is\n <denchmark-code>container:\n   command:\n     - bash\n     - '-c'\n     - \"repl -e \\\"-- ${internal.config}\\nselect 1;\\\" \"\n </denchmark-code>\n \n And the workflow consider this as\n <denchmark-code>bash -c repl -e \"-- ${internal.config} select 1;\"\n </denchmark-code>\n \n So the bash command in the container tries to substitute ${internal.config}. However, according to the bash man page\n <denchmark-code>   name   A  word  consisting  only  of alphanumeric characters and under\u2010\n           scores, and beginning with an alphabetic character or an  under\u2010\n           score.  Also referred to as an identifier.\n </denchmark-code>\n \n So the name  with dot is illegal, then  raises . <denchmark-link:https://unix.stackexchange.com/a/93533>ref</denchmark-link>\n .\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "tonyyang-svail", "commentT": "2020-03-10T03:37:56Z", "comment_text": "\n \t\tDoes the repl need to do substituting?\n If not, shall we change \" to '(a single-quote)?\n ///\n update:\n ~ \u279c bash -c 'echo ${a.b}' \n bash: ${a.b}: bad substitution\n It looks like the single-quote does not fix the problem. Let's find another way out.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "tonyyang-svail", "commentT": "2020-03-10T04:20:04Z", "comment_text": "\n \t\tThanks <denchmark-link:https://github.com/tonyyang-svail>@tonyyang-svail</denchmark-link>\n  's exhaustive analyze, it seems that  is not the bash standard:\n \u279c  sqlflow (develop) \u2717 bash -c \"echo ${internal}\"\n \u279c  sqlflow (develop) \u2717 bash -c \"echo ${internal.aa}\"\n zsh: bad substitution\n how about update the workflow: remove bash -c ?\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "tonyyang-svail", "commentT": "2020-03-10T06:01:27Z", "comment_text": "\n \t\t\n Thanks @tonyyang-svail 's exhaustive analyze, it seems that dot is not the bash standard:\n \u279c  sqlflow (develop) \u2717 bash -c \"echo ${internal}\"\n \u279c  sqlflow (develop) \u2717 bash -c \"echo ${internal.aa}\"\n zsh: bad substitution\n how about update the workflow: remove bash -c ?\n \n Agreed. repl is a standalone program.\n \t\t"}}}, "commit": {"commit_id": "59e5df9a7eeaff936d233053bcc1abfd8a3212e7", "commit_author": "shendiaomo", "commitT": "2020-03-26 18:04:34+08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "cmd\\sqlflowserver\\main_test.go", "file_new_name": "cmd\\sqlflowserver\\main_test.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "2193,2194,2195,2196,2197,2198,2199,2200,2201,2202,2203,2204,2205,2206,2207,2208,2209,2210,2211,2212,2213,2214,2215,2216,2217,2218,2219,2220,2221,2222,2223,2224,2225", "deleted_lines": null, "method_info": {"method_name": "CaseBackticksInSQL", "method_params": "T", "method_startline": "2193", "method_endline": "2225"}}, "hunk_1": {"Ismethod": 1, "added_lines": "2033", "deleted_lines": null, "method_info": {"method_name": "TestEnd2EndWorkflow", "method_params": "T", "method_startline": "1984", "method_endline": "2034"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pkg\\sql\\pai_submitter.go", "file_new_name": "pkg\\sql\\pai_submitter.go", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "151", "deleted_lines": "151"}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 2, "file_old_name": "pkg\\workflow\\couler\\codegen_test.go", "file_new_name": "pkg\\workflow\\couler\\codegen_test.go", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "97,98,99,100,101", "deleted_lines": "92,93,99", "method_info": {"method_name": "TestCoulerCodegen", "method_params": "T", "method_startline": "82", "method_endline": "101"}}, "hunk_1": {"Ismethod": 1, "added_lines": "103,104,105,106,107,108,109,110,112,113", "deleted_lines": null, "method_info": {"method_name": "TestCoulerCodegenSpecialChars", "method_params": "T", "method_startline": "103", "method_endline": "114"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "pkg\\workflow\\couler\\template.go", "file_new_name": "pkg\\workflow\\couler\\template.go", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "43,60,77,78", "deleted_lines": "59,76"}}}}}}