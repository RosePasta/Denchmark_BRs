{"BR": {"BR_id": "1628", "BR_author": "ternaus", "BRopenT": "2020-04-27T00:24:51Z", "BRcloseT": "2020-04-27T11:24:33Z", "BR_text": {"BRsummary": "Bug in DDP, but not DP modes.", "BRdescription": "\n Pytorch 1.5\n <denchmark-code>In [3]: pytorch_lightning.__version__                                                                                                                                                                                                                                                                \n Out[3]: '0.7.5rc1'\n \n </denchmark-code>\n \n In DP everything works.\n In DDP fails with:\n <denchmark-code> File \"/home/vladimir/anaconda3/envs/solaris/lib/python3.7/multiprocessing/popen_fork.py\", line 20, in __init__\n     self._launch(process_obj)\n   File \"/home/vladimir/anaconda3/envs/solaris/lib/python3.7/multiprocessing/popen_spawn_posix.py\", line 47, in _launch\n     reduction.dump(process_obj, fp)\n   File \"/home/vladimir/anaconda3/envs/solaris/lib/python3.7/multiprocessing/reduction.py\", line 60, in dump\n     ForkingPickler(file, protocol).dump(obj)\n _pickle.PicklingError: Can't pickle <class 'torch._C._VariableFunctions'>: it's not the same object as torch._C._VariableFunctions\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ternaus", "commentT": "2020-04-27T00:30:05Z", "comment_text": "\n \t\tcan you post a colab? does 0.7.4 work ok?\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ternaus", "commentT": "2020-04-27T00:31:25Z", "comment_text": "\n \t\t<denchmark-link:https://pytorch-lightning.readthedocs.io/en/latest/multi_gpu.html#make-model-picklable>https://pytorch-lightning.readthedocs.io/en/latest/multi_gpu.html#make-model-picklable</denchmark-link>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "ternaus", "commentT": "2020-04-27T08:29:05Z", "comment_text": "\n \t\tI am getting the same issue.\n \n The model is picklable\n It worked fine on 0.7.2\n It breaks after the update to 0.7.4\n \n My stacktrace:\n <denchmark-code>Traceback (most recent call last):\n   File \"./train_stage3.py\", line 254, in <module>\n     trainer.fit(model)\n   File \"/net/people/plgquinor/venv/lib/python3.6/site-packages/pytorch_lightning/trainer/trainer.py\", line 744, in fit\n     mp.spawn(self.ddp_train, nprocs=self.num_processes, args=(model,))\n   File \"/net/people/plgquinor/venv/lib/python3.6/site-packages/torch/multiprocessing/spawn.py\", line 200, in spawn\n     return start_processes(fn, args, nprocs, join, daemon, start_method='spawn')\n   File \"/net/people/plgquinor/venv/lib/python3.6/site-packages/torch/multiprocessing/spawn.py\", line 149, in start_processes\n     process.start()\n   File \"/net/software/local/python/3.6.5/lib/python3.6/multiprocessing/process.py\", line 105, in start\n     self._popen = self._Popen(self)\n   File \"/net/software/local/python/3.6.5/lib/python3.6/multiprocessing/context.py\", line 284, in _Popen\n     return Popen(process_obj)\n   File \"/net/software/local/python/3.6.5/lib/python3.6/multiprocessing/popen_spawn_posix.py\", line 32, in __init__\n     super().__init__(process_obj)\n   File \"/net/software/local/python/3.6.5/lib/python3.6/multiprocessing/popen_fork.py\", line 19, in __init__\n     self._launch(process_obj)\n   File \"/net/software/local/python/3.6.5/lib/python3.6/multiprocessing/popen_spawn_posix.py\", line 47, in _launch\n     reduction.dump(process_obj, fp)\n   File \"/net/software/local/python/3.6.5/lib/python3.6/multiprocessing/reduction.py\", line 60, in dump\n     ForkingPickler(file, protocol).dump(obj)\n _pickle.PicklingError: Can't pickle <class 'torch._C._VariableFunctions'>: it's not the same object as torch._C._VariableFunctions\n </denchmark-code>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "ternaus", "commentT": "2020-04-27T08:44:11Z", "comment_text": "\n \t\tThe model is picklable - the error appears when I try to pickle the Trainer instance.\n [Update] I had found the culprit. ModelCheckpoint is non-picklable due to:\n <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pytorch_lightning/callbacks/model_checkpoint.py#L118>https://github.com/PyTorchLightning/pytorch-lightning/blob/master/pytorch_lightning/callbacks/model_checkpoint.py#L118</denchmark-link>\n \n torch.lt, torch.gt etc. being non-picklable. It worked previously when those were np.* ops.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "ternaus", "commentT": "2020-04-27T13:37:11Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/quinor>@quinor</denchmark-link>\n  <denchmark-link:https://github.com/ternaus>@ternaus</denchmark-link>\n  thanks for bringing this up! turned out to be a bigger deal haha.\n Released 0.7.5 to fix - please skip 0.7.4\n \t\t"}}}, "commit": {"commit_id": "9604d7bf8994615431af9d86c8de154677237b75", "commit_author": "Wojciech Jab\u0142o\u0144ski", "commitT": "2020-04-27 15:56:20+02:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\callbacks\\model_checkpoint.py", "file_new_name": "pytorch_lightning\\callbacks\\model_checkpoint.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "154,155,156,157,158,159", "deleted_lines": "154", "method_info": {"method_name": "check_monitor_top_k", "method_params": "self,current", "method_startline": "146", "method_endline": "159"}}}}}}}