{"BR": {"BR_id": "2600", "BR_author": "p-wein", "BRopenT": "2020-07-13T13:26:48Z", "BRcloseT": "2020-09-15T09:07:28Z", "BR_text": {"BRsummary": "Trainer flag overfit_batches does not overwrite train dataloaders shuffle flag", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n Setting the trainer flag overfit_batches (e.g. =10) does not overwrite the shuffle flag set in the training dataloader, even though the warning reads:\n UserWarning: You requested to overfit but enabled training dataloader shuffling. We are turning it off for you.\n <denchmark-h:h3>To Reproduce</denchmark-h>\n \n Steps to reproduce the behavior:\n \n Create lightning module with method train_dataloader with flag shuffle=True:\n \n <denchmark-code>   def train_dataloader(self) -> loading.DataLoader:\n         dataset = ProstateX(train=True)\n         batch_transforms, gpu_transforms, sample_transforms = self.get_transformations()\n         dataloader = loading.DataLoader(dataset,\n                                         batch_size=self.hparams.tr_batch_size,\n                                         batch_transforms=batch_transforms,\n                                         shuffle=True,\n                                         sample_transforms= sample_transforms,\n                                         gpu_transforms=gpu_transforms,\n                                         pseudo_batch_dim=True,\n                                         num_workers=self.hparams.num_workers)\n         return dataloader \n </denchmark-code>\n \n ( I use a rising dataloader, bug should also occur with pytorch dataloaders though)\n \n Create main.py with:\n \n <denchmark-code>mymodel = model.Model3D(cfg)\n trainer = pl.Trainer(gpus=1, precision=16, overfit_batches=10)\n trainer.fit(mymodel)`\n </denchmark-code>\n \n \n Run main.py\n Find out that your model does not converge.\n set shuffle=False when creating Dataloader in train_dataloader\n See that your model converges after some epochs.\n \n (Or log the samples loaded by the dataloader and check if they are the same each epoch.)\n <denchmark-h:h4>Code sample</denchmark-h>\n \n <denchmark-h:h3>Expected behavior</denchmark-h>\n \n Either model also converges with shuffle=True, since warning says that it got overwritten (assuming model converges with shuffle=False) or at least warning should read that user has to change shuffle to False.\n <denchmark-h:h3>Environment</denchmark-h>\n \n \n CUDA:\n - GPU:\n - GeForce GTX 1080 Ti\n - available:         True\n - version:           10.1\n Packages:\n - numpy:             1.19.0\n - pyTorch_debug:     False\n - pyTorch_version:   1.7.0.dev20200705+cu101\n - pytorch-lightning: 0.8.5\n - tensorboard:       2.2.2\n - tqdm:              4.47.0\n System:\n - OS:                Linux\n - architecture:\n - 64bit\n -\n - processor:         x86_64\n - python:            3.7.7\n - version:           #109-Ubuntu SMP Fri Jun 19 11:33:10 UTC 2020\n \n <denchmark-h:h3>Additional context</denchmark-h>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "p-wein", "commentT": "2020-07-13T13:27:53Z", "comment_text": "\n \t\tHi! thanks for your contribution!, great first issue!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "p-wein", "commentT": "2020-09-12T11:39:18Z", "comment_text": "\n \t\tThis issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "p-wein", "commentT": "2020-09-28T13:45:33Z", "comment_text": "\n \t\tI am seeing the same issue when using . <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/blob/859ec92da51ff56b49e3e1f1beefa75767edc175/pytorch_lightning/trainer/trainer.py#L132> From a comment in the code, </denchmark-link>\n I believe that option is to be removed in 1.0.0, but is it worth it to fix it anyways? The same code will do fix the issue just checking  instead.\n \t\t"}}}, "commit": {"commit_id": "b5dc6998ae80b026bb6adc4040980a153390307a", "commit_author": "Phil", "commitT": "2020-09-15 05:07:27-04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "54,55", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\data_loading.py", "file_new_name": "pytorch_lightning\\trainer\\data_loading.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "170,171,172,173,174,175", "deleted_lines": null, "method_info": {"method_name": "reset_train_dataloader", "method_params": "self,LightningModule", "method_startline": "162", "method_endline": "219"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "tests\\trainer\\test_trainer_tricks.py", "file_new_name": "tests\\trainer\\test_trainer_tricks.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "59,61,62,92,93", "deleted_lines": "63,90", "method_info": {"method_name": "test_overfit_batch_limits", "method_params": "tmpdir", "method_startline": "41", "method_endline": "142"}}}}}}}