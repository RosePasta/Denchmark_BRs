{"BR": {"BR_id": "367", "BR_author": "VismantasD", "BRopenT": "2019-10-14T05:21:19Z", "BRcloseT": "2019-10-23T10:27:16Z", "BR_text": {"BRsummary": "setting gpus=-1 and gpus='-1' in Trainer give different behaviours", "BRdescription": "\n I discovered this while looking through the code. Trainer constructor does not mention that\n gpus can be -1 or '-1'. However if such values are passed they are accepted and result in\n different behaviour: -1 will result in no gpus used, '-1' will use all available gpus.\n To Reproduce\n \n Run any model first setting trainer gpus parameter to -1. No gpus will be used.\n Run same model setting gpus to '-1'. All available gpus will be used.\n \n Being able to set -1 to indicate that all gpus should be used is and I believe useful behaviour.\n The issue is in function <denchmark-link:https://github.com/williamFalcon/pytorch-lightning/blob/19c2b8fc9e73326c3e320c29e8f932893bd49460/pytorch_lightning/trainer/trainer.py#L340>self.__parse_gpu_ids(gpus)</denchmark-link>\n  where the handling of -1 when passed as int is not implemented.\n Solution would be to implement equivalent logic for -1 as for '-1'.\n Happy to submit a PR.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "VismantasD", "commentT": "2019-10-14T10:57:18Z", "comment_text": "\n \t\tyeah, fair. would love a PR! (also docs update)\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "VismantasD", "commentT": "2019-10-16T21:22:50Z", "comment_text": "\n \t\tQuestion. What is the intended behaviour when setting gpus in the Trainer to an int? (<denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/commit/e2cabb03ba86c4dc0271a4531bce7bf2dff53e94>e2cabb0</denchmark-link>\n ).\n Is it specifying number of gpus to use? Or is it specifying a specific gpu? Depending on the choice one of __set_root_gpu() or num_gpus() needs fixing:\n \n If it is number of gpus, then __set_root_gpu  would be returning 0 but it should be returning None in this case.\n If it is specific gpu (e.g. gpus=3 means running on 3rd gpu) then num_gpus would be returning 3 instead of 1.\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "VismantasD", "commentT": "2019-10-16T21:32:59Z", "comment_text": "\n \t\tnumber is for how many gpus to use. i guess the docs need to be updated to make that clear?\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "VismantasD", "commentT": "2019-10-16T23:33:56Z", "comment_text": "\n \t\tThanks, Yeah, I think they could be more specific and it is hard to read it from code. I'll update the documentation in the PR.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "VismantasD", "commentT": "2019-10-17T06:17:23Z", "comment_text": "\n \t\tawesome!\n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "VismantasD", "commentT": "2019-10-23T10:27:16Z", "comment_text": "\n \t\tOn master\n \t\t"}}}, "commit": {"commit_id": "2aba70e228b427b16e547e030ab3bbad736b5b00", "commit_author": "Vismantas", "commitT": "2019-10-23 05:05:09-04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "docs\\Trainer\\Distributed training.md", "file_new_name": "docs\\Trainer\\Distributed training.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "61,64,65,66,72,73,74,75", "deleted_lines": "61"}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 7, "file_old_name": "pytorch_lightning\\trainer\\dp_mixin.py", "file_new_name": "pytorch_lightning\\trainer\\dp_mixin.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "141,142,143,144,145,146,147,148,149,150,151", "deleted_lines": null, "method_info": {"method_name": "normalize_parse_gpu_input_to_list", "method_params": "gpus", "method_startline": "141", "method_endline": "151"}}, "hunk_1": {"Ismethod": 1, "added_lines": "119,120,121,122,123", "deleted_lines": null, "method_info": {"method_name": "get_all_available_gpus", "method_params": "", "method_startline": "119", "method_endline": "123"}}, "hunk_2": {"Ismethod": 1, "added_lines": "205,206,207,208,209,210,211,212,213,214,215,216,217,218,219", "deleted_lines": null, "method_info": {"method_name": "determine_root_gpu_device", "method_params": "gpus", "method_startline": "205", "method_endline": "219"}}, "hunk_3": {"Ismethod": 1, "added_lines": "109,110,111,112,113,114,115,116", "deleted_lines": null, "method_info": {"method_name": "normalize_parse_gpu_string_input", "method_params": "s", "method_startline": "109", "method_endline": "116"}}, "hunk_4": {"Ismethod": 1, "added_lines": "126,127,128,129,130,131,132,133,134,135,136,137,138", "deleted_lines": null, "method_info": {"method_name": "check_gpus_data_type", "method_params": "gpus", "method_startline": "126", "method_endline": "138"}}, "hunk_5": {"Ismethod": 1, "added_lines": "154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169", "deleted_lines": null, "method_info": {"method_name": "sanitize_gpu_ids", "method_params": "gpus", "method_startline": "154", "method_endline": "169"}}, "hunk_6": {"Ismethod": 1, "added_lines": "172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202", "deleted_lines": null, "method_info": {"method_name": "parse_gpu_ids", "method_params": "gpus", "method_startline": "172", "method_endline": "202"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\trainer.py", "file_new_name": "pytorch_lightning\\trainer\\trainer.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "280", "deleted_lines": "276,278,279,280,281", "method_info": {"method_name": "num_gpus", "method_params": "self", "method_startline": "276", "method_endline": "281"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 14, "file_old_name": "tests\\test_models.py", "file_new_name": "tests\\test_models.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1613,1614,1615", "deleted_lines": null, "method_info": {"method_name": "test_parse_gpu_fail_on_non_existant_id_2", "method_params": "mocked_device_count", "method_startline": "1613", "method_endline": "1615"}}, "hunk_1": {"Ismethod": 1, "added_lines": "1586,1587", "deleted_lines": null, "method_info": {"method_name": "test_determine_root_gpu_device", "method_params": "gpus,expected_root_gpu", "method_startline": "1586", "method_endline": "1587"}}, "hunk_2": {"Ismethod": 1, "added_lines": "1620,1621,1622", "deleted_lines": null, "method_info": {"method_name": "test_parse_gpu_returns_None_when_no_devices_are_available", "method_params": "mocked_device_count_0,gpus", "method_startline": "1620", "method_endline": "1622"}}, "hunk_3": {"Ismethod": 1, "added_lines": "1569,1570", "deleted_lines": null, "method_info": {"method_name": "test_root_gpu_property_0_raising", "method_params": "mocked_device_count_0,gpus,expected_root_gpu,distributed_backend", "method_startline": "1569", "method_endline": "1570"}}, "hunk_4": {"Ismethod": 1, "added_lines": "1508,1509", "deleted_lines": null, "method_info": {"method_name": "test_trainer_gpu_parse", "method_params": "mocked_device_count,gpus,expected_num_gpus,distributed_backend", "method_startline": "1508", "method_endline": "1509"}}, "hunk_5": {"Ismethod": 1, "added_lines": "1490,1491", "deleted_lines": null, "method_info": {"method_name": "mocked_device_count_0.device_count", "method_params": "", "method_startline": "1490", "method_endline": "1491"}}, "hunk_6": {"Ismethod": 1, "added_lines": "1481,1482,1483,1484,1485", "deleted_lines": null, "method_info": {"method_name": "mocked_device_count", "method_params": "monkeypatch", "method_startline": "1481", "method_endline": "1485"}}, "hunk_7": {"Ismethod": 1, "added_lines": "1482,1483", "deleted_lines": null, "method_info": {"method_name": "mocked_device_count.device_count", "method_params": "", "method_startline": "1482", "method_endline": "1483"}}, "hunk_8": {"Ismethod": 1, "added_lines": "1520,1521", "deleted_lines": null, "method_info": {"method_name": "test_trainer_num_gpu_0", "method_params": "mocked_device_count_0,gpus,expected_num_gpus,distributed_backend", "method_startline": "1520", "method_endline": "1521"}}, "hunk_9": {"Ismethod": 1, "added_lines": "1549,1550", "deleted_lines": null, "method_info": {"method_name": "test_root_gpu_property_0_passing", "method_params": "mocked_device_count_0,gpus,expected_root_gpu,distributed_backend", "method_startline": "1549", "method_endline": "1550"}}, "hunk_10": {"Ismethod": 1, "added_lines": "1489,1490,1491,1492,1493", "deleted_lines": null, "method_info": {"method_name": "mocked_device_count_0", "method_params": "monkeypatch", "method_startline": "1489", "method_endline": "1493"}}, "hunk_11": {"Ismethod": 1, "added_lines": "1535,1536", "deleted_lines": null, "method_info": {"method_name": "test_root_gpu_property", "method_params": "mocked_device_count,gpus,expected_root_gpu,distributed_backend", "method_startline": "1535", "method_endline": "1536"}}, "hunk_12": {"Ismethod": 1, "added_lines": "1607,1608,1609", "deleted_lines": null, "method_info": {"method_name": "test_parse_gpu_fail_on_non_existant_id", "method_params": "mocked_device_count_0,gpus", "method_startline": "1607", "method_endline": "1609"}}, "hunk_13": {"Ismethod": 1, "added_lines": "1601,1602", "deleted_lines": null, "method_info": {"method_name": "test_parse_gpu_ids", "method_params": "mocked_device_count,gpus,expected_gpu_ids", "method_startline": "1601", "method_endline": "1602"}}}}}}}