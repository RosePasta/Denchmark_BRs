{"BR": {"BR_id": "1262", "BR_author": "philip-bl", "BRopenT": "2020-03-27T12:38:00Z", "BRcloseT": "2020-04-03T13:25:33Z", "BR_text": {"BRsummary": "incorrect run on the test set with overwritten validation_end and test_epoch_end", "BRdescription": "\n <denchmark-h:h2>\ud83d\udc1b Bug</denchmark-h>\n \n If I override validation_end and test_epoch_end, TrainerEvaluationLoopMixin.evaluate works incorrectly on the test set\n Suppose we override  and , but not  and . (I actually did this since I am a newbie and haven't yet figured out how everything works; also it seems  is the same as , and  seems to be the same as ). Suppose I run . Consider lines 300-312 in <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/blob/6a0b171be4c08982a7a8b45ddffe04a726265323/pytorch_lightning/trainer/evaluation_loop.py#L300>evaluation_loop.py</denchmark-link>\n . Then we have , so the first  block is executed, that is . But look at the second  and its . We have , hence the  of the second  will also be executed, that is . And we will have validation results recorder as test results, which is a mistake.\n This problem is present in the commit <denchmark-link:https://github.com/PyTorchLightning/pytorch-lightning/commit/60b8246bc3d4e22f806780a816878c668ac647c4>60b8246</denchmark-link>\n . And the inverse problem (which happens if we override only  and  is present in 0.7.1.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "philip-bl", "commentT": "2020-03-27T13:00:04Z", "comment_text": "\n \t\tHi! thanks for your contribution!, great first issue!\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "philip-bl", "commentT": "2020-04-02T21:49:23Z", "comment_text": "\n \t\tI can look into this.\n To summarize, there is a problem when we mix *_epoch_end (new version) and *_end (old naming)  for validation and test. There is no problem if we would consequently use only one of the two, either the deprecated or the new way. Is this correct?\n I propose this fix:\n <denchmark-code>if test_mode:\n     if is_overriden(\"test_end\"):\n         # get results and warn user\n     elif is_overriden(\"test_epoch_end\"):\n         # get results\n else: \n     # same as above but with \"validation_end\", \"validation_epoch_end\"\n </denchmark-code>\n \n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "philip-bl", "commentT": "2020-04-02T21:53:57Z", "comment_text": "\n \t\t<denchmark-link:https://github.com/awaelchli>@awaelchli</denchmark-link>\n  yes\n \t\t"}}}, "commit": {"commit_id": "ebd9fc9530242e1c9b5f3093dc62ceb4185735b0", "commit_author": "Adrian W\u00e4lchli", "commitT": "2020-04-03 09:25:32-04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "64", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "pytorch_lightning\\trainer\\evaluation_loop.py", "file_new_name": "pytorch_lightning\\trainer\\evaluation_loop.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316", "deleted_lines": "298,299,300,301,302,303,304,305,306,307,308,309,310,311", "method_info": {"method_name": "_evaluate", "method_params": "self,LightningModule,dataloaders,int,bool", "method_startline": "219", "method_endline": "324"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "tests\\trainer\\test_trainer.py", "file_new_name": "tests\\trainer\\test_trainer.py", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "537,538,539", "deleted_lines": "537,538,539", "method_info": {"method_name": "test_disabled_validation.validation_epoch_end", "method_params": "self,args,kwargs", "method_startline": "537", "method_endline": "539"}}, "hunk_1": {"Ismethod": 1, "added_lines": "537,538,539", "deleted_lines": "537,538,539", "method_info": {"method_name": "test_disabled_validation.validation_end", "method_params": "self,args,kwargs", "method_startline": "537", "method_endline": "539"}}, "hunk_2": {"Ismethod": 1, "added_lines": "531,537,538,539,558,559,560,561,571,572,573,574", "deleted_lines": "531,537,538,539,558,559,569,570", "method_info": {"method_name": "test_disabled_validation", "method_params": "", "method_startline": "524", "method_endline": "574"}}}}}}}