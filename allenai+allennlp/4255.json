{"BR": {"BR_id": "4255", "BR_author": "epwalsh", "BRopenT": "2020-05-19T02:12:52Z", "BRcloseT": "2020-05-21T22:07:52Z", "BR_text": {"BRsummary": "Distributed training bug", "BRdescription": "\n Currently the train command does the following WRT the vocabulary in the distributed setting:\n \n initializes the vocab from the main process and serializes it to file,\n spawns the _train_worker command for each worker, which themselves re-initialize the vocab from file,\n then the master worker re-serializes the vocab to file after initializing the model in case the model has modified the vocab in some way.\n \n But this is potentially really bad because a non-master worker could be initializing their vocab from the files that are currently being written to from the master worker. In fact, I believe this what caused this CI run to fail: <denchmark-link:https://github.com/allenai/allennlp/pull/4253/checks?check_run_id=687029330>https://github.com/allenai/allennlp/pull/4253/checks?check_run_id=687029330</denchmark-link>\n .\n <denchmark-h:hr></denchmark-h>\n \n Potential solutions:\n \n \n Only serialize the vocab once, and do it before initializing the model.\n This has a quick fix. See #4256 for a draft.\n The downside here is that model side-effects on the vocab won't be saved to the vocab files. Is this really a downside? I feel like models should not modify the vocab, and I only know of one that does: CopyNet. But it's really not necessary. See allenai/allennlp-models#55.\n \n \n Refactor the train command so that even in the distributed setting we only serialize the vocab once, but do it after initializing the model. This will definitely take more work.\n \n \n \t"}, "comments": {}}, "commit": {"commit_id": "dacbb7572928c6c2f54a8a7acdcb0aff151cf457", "commit_author": "Evan Pete Walsh", "commitT": "2020-05-21 15:07:51-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "CHANGELOG.md", "file_new_name": "CHANGELOG.md", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "16", "deleted_lines": null}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "allennlp\\commands\\train.py", "file_new_name": "allennlp\\commands\\train.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "635,636,637,638,639,640", "deleted_lines": "635"}}}}}}