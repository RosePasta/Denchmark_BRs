{"BR": {"BR_id": "2117", "BR_author": "fanyangCS", "BRopenT": "2019-02-01T02:39:21Z", "BRcloseT": "2020-01-02T11:32:34Z", "BR_text": {"BRsummary": "node exporter not ready for a few hours in D states", "BRdescription": "\n unknown out of memory<denchmark-link:https://user-images.githubusercontent.com/5820832/52099294-95226380-260d-11e9-826c-cc39203e2c3b.png></denchmark-link>\n , losing data\n points for several hours <denchmark-link:https://user-images.githubusercontent.com/5820832/52099281-89cf3800-260d-11e9-8d7a-f76d51971648.png></denchmark-link>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "fanyangCS", "commentT": "2019-03-17T12:02:04Z", "comment_text": "\n \t\tHappened again, the process is in D state:\n <denchmark-code>core@paigcr-b-infra-10:~$ sudo ps aux | grep node_exporter\n nobody    1141  0.0  0.1 4360512 90660 ?       Dsl  10:51   0:01 /bin/node_exporter --no-collector.arp --no-collector.bcache --no-collector.bonding --no-collector.conntrack --no-collector.edac --no-collector.entropy --no-collector.hwmon --no-collector.infiniband --no-collector.ipvs --no-collector.mdadm --no-collector.nfs --no-collector.nfsd --no-collector.sockstat --no-collector.stat --no-collector.time --no-collector.timex --no-collector.vmstat --no-collector.wifi --no-collector.xfs --no-collector.zfs\n </denchmark-code>\n \n and pstack cannot retrieve its stack.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "fanyangCS", "commentT": "2019-03-19T05:22:35Z", "comment_text": "\n \t\tShould try some other <denchmark-link:https://serverfault.com/a/942525>methods</denchmark-link>\n  to see what the process is doing if D state happened again.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "fanyangCS", "commentT": "2019-03-28T14:38:50Z", "comment_text": "\n \t\tthe stack of node_exporter during D state:\n <denchmark-code>core@paigcr-b-infra-10:~$ sudo cat /proc/32363/stack\n [<0>] rpc_wait_bit_killable+0x24/0xa0 [sunrpc]\n [<0>] __rpc_execute+0x15e/0x420 [sunrpc]\n [<0>] rpc_execute+0x5d/0xc0 [sunrpc]\n [<0>] rpc_run_task+0xf8/0x140 [sunrpc]\n [<0>] rpc_call_sync+0x50/0x90 [sunrpc]\n [<0>] nfs3_rpc_wrapper.constprop.12+0x39/0xb0 [nfsv3]\n [<0>] nfs3_proc_statfs+0x56/0xb0 [nfsv3]\n [<0>] nfs_statfs+0x6e/0x190 [nfs]\n [<0>] statfs_by_dentry+0x72/0x90\n [<0>] vfs_statfs+0x1b/0xb0\n [<0>] user_statfs+0x58/0xa0\n [<0>] SYSC_statfs+0x27/0x60\n [<0>] SyS_statfs+0xe/0x10\n [<0>] do_syscall_64+0x73/0x130\n [<0>] entry_SYSCALL_64_after_hwframe+0x3d/0xa2\n [<0>] 0xffffffffffffffff\n </denchmark-code>\n \n The command of df will also go into D state during the time, the stack of df:\n <denchmark-code>core@paigcr-b-infra-10:~$ sudo cat /proc/2505/stack\n [<0>] rpc_wait_bit_killable+0x24/0xa0 [sunrpc]\n [<0>] __rpc_execute+0x15e/0x420 [sunrpc]\n [<0>] rpc_execute+0x5d/0xc0 [sunrpc]\n [<0>] rpc_run_task+0xf8/0x140 [sunrpc]\n [<0>] rpc_call_sync+0x50/0x90 [sunrpc]\n [<0>] nfs3_rpc_wrapper.constprop.12+0x39/0xb0 [nfsv3]\n [<0>] nfs3_proc_getattr+0x56/0xb0 [nfsv3]\n [<0>] __nfs_revalidate_inode+0xd0/0x360 [nfs]\n [<0>] nfs_getattr+0x9c/0x280 [nfs]\n [<0>] vfs_getattr_nosec+0x73/0x90\n [<0>] vfs_getattr+0x36/0x40\n [<0>] vfs_statx+0x8e/0xe0\n [<0>] SYSC_newstat+0x3d/0x70\n [<0>] SyS_newstat+0xe/0x10\n [<0>] do_syscall_64+0x73/0x130\n [<0>] entry_SYSCALL_64_after_hwframe+0x3d/0xa2\n [<0>] 0xffffffffffffffff\n </denchmark-code>\n \n At the same time, there also have [10.169.8.232-ma] process running,\n <denchmark-code>core@paigcr-b-infra-10:~$ sudo ps ax --format \"state,pid,cmd\" | grep \"^D\"\n D   395 [jbd2/sda1-8]\n D  2505 df\n D  9480 [10.169.8.232-ma]\n D 15034 /bin/node_exporter --no-collector.arp --no-collector.bcache --no-collector.bonding --no-collector.conntrack --no-collector.edac --no-collector.entropy --no-collector.hwmon --no-collector.infiniband --no-collector.ipvs --no-collector.mdadm --no-collector.nfs --no-collector.nfsd --no-collector.sockstat --no-collector.stat --no-collector.time --no-collector.timex --no-collector.vmstat --no-collector.wifi --no-collector.xfs --no-collector.zfs\n </denchmark-code>\n \n the stack of [10.169.8.232-ma] is:\n <denchmark-code>core@paigcr-b-infra-10:~$ sudo cat /proc/9480/stack\n [<0>] rpc_wait_bit_killable+0x24/0xa0 [sunrpc]\n [<0>] __rpc_execute+0x15e/0x420 [sunrpc]\n [<0>] rpc_execute+0x5d/0xc0 [sunrpc]\n [<0>] rpc_run_task+0xf8/0x140 [sunrpc]\n [<0>] rpc_call_sync+0x50/0x90 [sunrpc]\n [<0>] nfs4_proc_renew+0x56/0x90 [nfsv4]\n [<0>] nfs4_state_manager+0x30a/0x7e0 [nfsv4]\n [<0>] nfs4_run_state_manager+0x24/0x40 [nfsv4]\n [<0>] kthread+0x105/0x140\n [<0>] ret_from_fork+0x35/0x40\n [<0>] 0xffffffffffffffff\n </denchmark-code>\n \n Seems this case is someone started a NFSd in 25th Mar. and caused this problem.\n <denchmark-code>root      9781  0.0  0.0      0     0 ?        S    Mar25   0:00 [nfsd]\n </denchmark-code>\n \n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "fanyangCS", "commentT": "2020-01-02T11:32:33Z", "comment_text": "\n \t\tfixed by <denchmark-link:https://github.com/microsoft/pai/pull/2988>#2988</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "0b63e1590f63b9de2f7038900664af4622d22354", "commit_author": "Di Xu", "commitT": "2019-07-01 12:22:29+08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "src\\node-exporter\\deploy\\node-exporter.yaml.template", "file_new_name": "src\\node-exporter\\deploy\\node-exporter.yaml.template", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "81,82", "deleted_lines": null}}}}}}