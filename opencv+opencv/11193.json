{"BR": {"BR_id": "11193", "BR_author": "johnridges", "BRopenT": "2018-03-29T19:56:58Z", "BRcloseT": "2018-05-09T20:45:16Z", "BR_text": {"BRsummary": "Problem using prioritized streams in CUDA canny edge detector", "BRdescription": "\n <denchmark-h:h5>System information (version)</denchmark-h>\n \n \n OpenCV => Master\n Operating System / Platform => Windows 64 Bit\n Compiler => Visual Studio 2015\n \n <denchmark-h:h5>Detailed description</denchmark-h>\n \n The CUDA canny edge detector (cudaimgproc/src/canny.cpp) has a bug on line 221, which is:\n         map_.setTo(Scalar::all(0));\n This call is ignoring the stream, which when using prioritized streams causes synchronization problems. The line should be:\n         map_.setTo(Scalar::all(0), stream);\n <denchmark-h:h5>Steps to reproduce</denchmark-h>\n \n The code is self-evident.\n \t"}, "comments": {}}, "commit": {"commit_id": "ed86bd34b190b2d6dba3f8bccd6070f0e5062b93", "commit_author": "Namgoo Lee", "commitT": "2018-05-09 23:44:34+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "modules\\cudafilters\\src\\cuda\\column_filter.hpp", "file_new_name": "modules\\cudafilters\\src\\cuda\\column_filter.hpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "144,168", "deleted_lines": "146,170", "method_info": {"method_name": "column_filter::caller", "method_params": "src,dst,kernel,anchor,cc,stream", "method_startline": "144", "method_endline": "174"}}, "hunk_1": {"Ismethod": 1, "added_lines": "56,136", "deleted_lines": "56,58,138", "method_info": {"method_name": "column_filter::linearColumnFilter", "method_params": "src,dst,kernel,anchor,brd", "method_startline": "56", "method_endline": "141"}}, "hunk_2": {"Ismethod": 1, "added_lines": "168", "deleted_lines": "146,170", "method_info": {"method_name": "column_filter::caller", "method_params": "src,dst,anchor,cc,stream", "method_startline": "146", "method_endline": "176"}}, "hunk_3": {"Ismethod": 1, "added_lines": "136", "deleted_lines": "58,138", "method_info": {"method_name": "column_filter::linearColumnFilter", "method_params": "src,dst,anchor,brd", "method_startline": "58", "method_endline": "143"}}, "hunk_4": {"Ismethod": 1, "added_lines": "182,363", "deleted_lines": "184", "method_info": {"method_name": "filter::linearColumn", "method_params": "src,dst,kernel,ksize,anchor,brd_type,cc,stream", "method_startline": "180", "method_endline": "364"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 5, "file_old_name": "modules\\cudafilters\\src\\cuda\\row_filter.hpp", "file_new_name": "modules\\cudafilters\\src\\cuda\\row_filter.hpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "168", "deleted_lines": "146,170", "method_info": {"method_name": "row_filter::caller", "method_params": "src,dst,anchor,cc,stream", "method_startline": "146", "method_endline": "175"}}, "hunk_1": {"Ismethod": 1, "added_lines": "144,168", "deleted_lines": "146,170", "method_info": {"method_name": "row_filter::caller", "method_params": "src,dst,kernel,anchor,cc,stream", "method_startline": "144", "method_endline": "173"}}, "hunk_2": {"Ismethod": 1, "added_lines": "181,362", "deleted_lines": "183", "method_info": {"method_name": "filter::linearRow", "method_params": "src,dst,kernel,ksize,anchor,brd_type,cc,stream", "method_startline": "179", "method_endline": "363"}}, "hunk_3": {"Ismethod": 1, "added_lines": "136", "deleted_lines": "58,138", "method_info": {"method_name": "row_filter::linearRowFilter", "method_params": "src,dst,anchor,brd", "method_startline": "58", "method_endline": "143"}}, "hunk_4": {"Ismethod": 1, "added_lines": "56,136", "deleted_lines": "56,58,138", "method_info": {"method_name": "row_filter::linearRowFilter", "method_params": "src,dst,kernel,anchor,brd", "method_startline": "56", "method_endline": "141"}}}}, "file_2": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\cudaimgproc\\src\\canny.cpp", "file_new_name": "modules\\cudaimgproc\\src\\canny.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "223,224,227,228,229,230,231,233", "deleted_lines": "221,224,226", "method_info": {"method_name": "CannyImpl::CannyCaller", "method_params": "edges,stream", "method_startline": "221", "method_endline": "236"}}}}, "file_3": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "modules\\cudaimgproc\\src\\cuda\\canny.cu", "file_new_name": "modules\\cudaimgproc\\src\\cuda\\canny.cu", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "50,106,107,108,109,110,111,112,113,114,115,116,117,118,119,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,161,163,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,207,208,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,380,381,382,383,385,386,387,388,389,390,391,392,393,394,395,396,409,490,495,497,502,517,591,606,609,614,619,625", "deleted_lines": "128,129,131,133,134,138,139,140,142,144,145,168,226,228,229,231,232,240,241,247,328,333,335,336,337,338,343,358,432,447,449,450,451,453,458,463,469"}}}, "file_4": {"file_change_type": "MODIFY", "file_Nmethod": 4, "file_old_name": "modules\\cudaimgproc\\test\\test_canny.cpp", "file_new_name": "modules\\cudaimgproc\\test\\test_canny.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "98,99", "deleted_lines": null, "method_info": {"method_name": "opencv_test::CannyAsyncParallelLoopBody::CannyAsyncParallelLoopBody", "method_params": "d_img_,edges_,low_thresh_,high_thresh_,apperture_size_,useL2gradient_", "method_startline": "98", "method_endline": "99"}}, "hunk_1": {"Ismethod": 1, "added_lines": "100", "deleted_lines": null, "method_info": {"method_name": "opencv_test::CannyAsyncParallelLoopBody::~CannyAsyncParallelLoopBody", "method_params": "", "method_startline": "100", "method_endline": "100"}}, "hunk_2": {"Ismethod": 1, "added_lines": "101,102,103,104,105,106,107,108,109", "deleted_lines": null, "method_info": {"method_name": "opencv_test::CannyAsyncParallelLoopBody::operator ( )", "method_params": "r", "method_startline": "101", "method_endline": "109"}}, "hunk_3": {"Ismethod": 1, "added_lines": "121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150", "deleted_lines": null, "method_info": {"method_name": "opencv_test::CUDA_TEST_P", "method_params": "Canny,Async", "method_startline": "121", "method_endline": "150"}}}}}}}