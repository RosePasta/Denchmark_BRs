{"BR": {"BR_id": "5590", "BR_author": "ajbernal", "BRopenT": "2015-10-29T22:17:25Z", "BRcloseT": "2015-12-09T15:19:38Z", "BR_text": {"BRsummary": "OpenCL BilateralFilter implementation failes to build for some OCL drivers", "BRdescription": "\n ocl_bilateralFilter_8u passes a double constant as compilation argument resulting in the following compilation error:\n <denchmark-code>OpenCL program build log: -D radius=3 -D maxk=29 -D cn=1 -D int_t=int -D uint_t=uint -D convert_int_t=convert_int -D uchar_t=uchar -D float_t=float -D convert_float_t=convert_float -D convert_uchar_t=convert_uchar_sat_rte \n -D gauss_color_coeff=-0.000200 -D INTEL_DEVICE\n 26:73:69: error: scalar operand type has greater rank than the type of the vector element. \n ('float __attribute__((ext_vector_type(4)))' and 'double')\n </denchmark-code>\n \n Some OCL vendors treat implicit scalar-vector conversion for operators as errors when type conversion is needed.\n float4 val, val0;\n float4 w = (val - val0) * gauss_color_coeff;\n in this case since -D gauss_color_coeff=-0.000200 is passed as double the conversion to float4 triggers a compilation error.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "ajbernal", "commentT": "2015-10-30T16:28:39Z", "comment_text": "\n \t\tI'll create a pull request with a fix after testing locally\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "ajbernal", "commentT": "2015-10-30T17:38:56Z", "comment_text": "\n \t\tSince vsnprintf() doesn't append the literal f for floats we can avoid type conversion by explicitly casting gauss_color_coeff to float, a bit more clear than using %ff. Note that vsnprintf() could be silently neglecting any value less than 1E-6.\n \t\t"}}}, "commit": {"commit_id": "cc903d0605d9f2e48d7f1ac026bd9ac3eea0de21", "commit_author": "Ariel Bernal", "commitT": "2015-10-30 09:39:11-07:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\imgproc\\src\\smooth.cpp", "file_new_name": "modules\\imgproc\\src\\smooth.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "3111", "deleted_lines": "3111", "method_info": {"method_name": "cv::ocl_bilateralFilter_8u", "method_params": "_src,_dst,d,sigma_color,sigma_space,borderType", "method_startline": "3044", "method_endline": "3133"}}}}}}}