{"BR": {"BR_id": "7833", "BR_author": "aprowe", "BRopenT": "2016-12-09T21:17:34Z", "BRcloseT": "2017-03-06T10:23:48Z", "BR_text": {"BRsummary": "Cocoa Application VideoCapture crashes on release() using AVFoundation", "BRdescription": "\n <denchmark-h:h5>System information (version)</denchmark-h>\n \n \n OpenCV => Dec 7th HEAD (2341222)\n Operating System / Platform => Mac 10.11 / 10.12\n Compiler => Xcode\n \n <denchmark-h:h5>Detailed description</denchmark-h>\n \n We are trying to use an AVFoundation build of opencv_videoio in our macOS app.\n It is able to open the webcam and read from it, but once release is called, a EXC_BAD_ACCESS Error is thrown. Here are stack traces caught by Zombies. I wasn't sure exactly what is relevant in the zombie report. Here's a screenshot.\n <denchmark-link:https://cloud.githubusercontent.com/assets/7191456/21064782/79e8dcca-be22-11e6-879d-196656173dd1.png></denchmark-link>\n \n Stepping through the code, It successfully turns the camera off, exits release(), and continue program flow, and another thread crashes the program each time.\n It does NOT crash on a blank c++ command line project, only happens in a cocoa app.\n We have tried running both on Sierra and El Capitan.\n We chose to use AVFoundation to support Sierra, and chose to not use FFMpeg. Are there any other build options to consider?\n <denchmark-h:h5>Steps to reproduce</denchmark-h>\n \n Build openCV with\n <denchmark-code>WITH_AVFOUNDATION=YES\n WITH_FFMPEG=NO\n WITH_QT=NO\n WITH_QUICKTIME=NO\n </denchmark-code>\n \n Create an empty Cocoa Project,\n and in ApplicationDidFinishLaunching put basic VideoIO capture calls in\n <denchmark-code>- (void)applicationDidFinishLaunching:(NSNotification *)aNotification {\n   cv::VideoCapture cap(0);\n   cap.release();\n }\n </denchmark-code>\n \n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "aprowe", "commentT": "2016-12-28T08:54:35Z", "comment_text": "\n \t\tIn cap_avfoundation_mac.mm, function CvCaptureCAM::stopCaptureDevice, comment this line [mCaptureDevice release];\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "aprowe", "commentT": "2017-01-10T19:46:09Z", "comment_text": "\n \t\tThis fixed it, thank you!\n \t\t"}}}, "commit": {"commit_id": "276e47afae560b233d16824a1f9067fa66de0848", "commit_author": "abratchik", "commitT": "2017-02-26 15:14:34+04:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\videoio\\src\\cap_avfoundation_mac.mm", "file_new_name": "modules\\videoio\\src\\cap_avfoundation_mac.mm", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "296", "deleted_lines": "296", "method_info": {"method_name": "CvCaptureCAM::stopCaptureDevice", "method_params": "", "method_startline": "289", "method_endline": "302"}}}}}}}