{"BR": {"BR_id": "16689", "BR_author": "alalek", "BRopenT": "2020-02-27T20:52:15Z", "BRcloseT": "2020-03-05T09:09:11Z", "BR_text": {"BRsummary": "core(MatExpr): `.size()` implementation bug", "BRdescription": "\n relates <denchmark-link:https://github.com/opencv/opencv/issues/16655>#16655</denchmark-link>\n  <denchmark-link:https://github.com/opencv/opencv/pull/16653>#16653</denchmark-link>\n \n Test code to FAIL:\n <denchmark-code>Mat a(Size(10, 5), CV_32FC1, 5);\n Mat b(Size(10, 5), CV_32FC1, 2);\n MatExpr r = a * b.t();  // gemm\n cout << r.size() << endl;\n cout << Mat(r).size() << endl;\n Mat dst;\n cv::add(r, Scalar(1), dst);  // Exception raised\n </denchmark-code>\n \n output:\n <denchmark-code>[10 x 5]\n [5 x 5]\n ... matrix_iterator.cpp:72: error: (-215:Assertion failed) A.size == arrays[i0]->size in function 'init'\n </denchmark-code>\n \n <denchmark-h:hr></denchmark-h>\n \n Test code to PASS:\n <denchmark-code>Mat a(Size(10, 5), CV_32FC1, 5);\n Mat b(Size(10, 5), CV_32FC1, 2);\n MatExpr r = a * b.t();  // gemm\n Mat dst;\n cv::add(Mat(r), Scalar(1), dst);\n cout << dst << endl;\n cout << r << endl;\n </denchmark-code>\n \n (but gemm() is called twice due MatExpr \"optimization\")\n <denchmark-h:hr></denchmark-h>\n \n More checks: <denchmark-link:https://github.com/opencv/opencv/compare/master...alalek:check_matexpr_size>master...alalek:check_matexpr_size</denchmark-link>\n \n \t"}, "comments": {}}, "commit": {"commit_id": "4d0f13544db8ea0fd1e439992a7ffd215ce15114", "commit_author": "Alexander Alekhin", "commitT": "2020-03-02 17:13:02+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 3, "file_old_name": "modules\\core\\src\\matrix_expressions.cpp", "file_new_name": "modules\\core\\src\\matrix_expressions.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": null, "deleted_lines": "1243,1244", "method_info": {"method_name": "cv::MatExpr::size", "method_params": "", "method_startline": "1239", "method_endline": "1250"}}, "hunk_1": {"Ismethod": 1, "added_lines": "120,121,122,123,124,125,126", "deleted_lines": null, "method_info": {"method_name": "cv::MatOp_GEMMCV_FINAL::size", "method_params": "expr", "method_startline": "120", "method_endline": "126"}}, "hunk_2": {"Ismethod": 1, "added_lines": null, "deleted_lines": "202", "method_info": {"method_name": "cv::isGEMM", "method_params": "e", "method_startline": "202", "method_endline": "202"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\core\\test\\test_mat.cpp", "file_new_name": "modules\\core\\test\\test_mat.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053", "deleted_lines": null, "method_info": {"method_name": "opencv_test::TEST", "method_params": "Core_MatExpr,issue_16689", "method_startline": "2032", "method_endline": "2053"}}}}}}}