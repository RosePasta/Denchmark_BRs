{"BR": {"BR_id": "13908", "BR_author": "x3lif", "BRopenT": "2019-02-25T16:40:22Z", "BRcloseT": "2019-03-04T16:34:11Z", "BR_text": {"BRsummary": "calib3D : cannot allocate matrix in OpenCV_4.0.1", "BRdescription": "\n <denchmark-h:h5>System information (version)</denchmark-h>\n \n \n OpenCV : 4.0.1\n Operating System / Platform  : Opensuse15\n Compiler => gcc (SUSE Linux) 7.3.1 20180323 [gcc-7-branch revision 258812]\n \n <denchmark-h:h5>Detailed description</denchmark-h>\n \n When updating my codebase from OpenCV 3.2.0 to OpenCV 4.0.1, i see an opencv error (cannot allocate memory) while trying to calibrate cameras with some big input matrices while it wasn't reporting any error on previous version.\n <denchmark-h:hr></denchmark-h>\n \n <denchmark-h:h2>error: (-4:Insufficient memory) Failed to allocate 224616847152 bytes in function 'OutOfMemoryError'</denchmark-h>\n \n <denchmark-h:h5>Steps to reproduce</denchmark-h>\n \n Call cv::calibrateCamera with a total number of objectPoints greater than 300,000 .\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "x3lif", "commentT": "2019-02-25T16:47:25Z", "comment_text": "\n \t\tAfter some research : this regression comes from <denchmark-link:https://github.com/opencv/opencv/pull/12772>#12772</denchmark-link>\n  .\n The size of the matrix named _Jo overflows when i'm trying to allocate it.\n Since this matrix is facultative in some execution cases, i'll propose a patch soon, to disable the matrix allocation when solver.state != CvLevMarq::CALC_J.\n \t\t"}}}, "commit": {"commit_id": "19cf5118957cf9cb86022e44998f652ddaa5d887", "commit_author": "x3lif", "commitT": "2019-03-04 19:34:10+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\calib3d\\src\\calibration.cpp", "file_new_name": "modules\\calib3d\\src\\calibration.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "1586,1587,1588,1589,1590,1591,1592,1726,1731,1732,1733,1734,1735,1736,1737,1738,1739,1740,1741", "deleted_lines": "1523,1524,1525,1526,1723,1724,1725,1726,1727,1728,1733,1734,1735,1736", "method_info": {"method_name": "cvCalibrateCamera2Internal", "method_params": "objectPoints,imagePoints,npoints,imageSize,iFixedPoint,cameraMatrix,distCoeffs,rvecs,tvecs,newObjPoints,stdDevs,perViewErrors,flags,termCrit", "method_startline": "1372", "method_endline": "1861"}}}}}}}