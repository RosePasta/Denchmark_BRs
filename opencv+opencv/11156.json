{"BR": {"BR_id": "11156", "BR_author": "LaurentBerger", "BRopenT": "2018-03-26T07:48:36Z", "BRcloseT": "2018-03-28T12:35:39Z", "BR_text": {"BRsummary": "Behaviour of FIleStorage::APPEND different from flags \"a\" in fopen", "BRdescription": "\n OpenCV => 3.4.1\n Operating System / Platform => Windows 64 Bit\n Compiler => Visual Studio 2017\n My code\n <denchmark-code>    FileStorage f;\n     f.open(\"test.yml\", FileStorage::APPEND+ FileStorage::WRITE);\n     f << \"a\" << 28.54;\n     f.release();\n     f.open(\"test.yml\", FileStorage::READ);\n     cout << \" First read \"<<float(f[\"a\"]) << endl;\n     f.release();\n     f.open(\"test.yml\", FileStorage::APPEND + FileStorage::WRITE);\n     f << \"b\" << 323.54;\n     f.release();\n     f.open(\"test.yml\", FileStorage::APPEND + FileStorage::WRITE);\n     cout << \" second read \"<< float(f[\"a\"]) << endl;\n     cout << \" second read \" << float(f[\"b\"]) << endl;\n     f.release();\n \n </denchmark-code>\n \n result :\n <denchmark-code> First read 28.54\n  second read 0\n  second read 0\n \n </denchmark-code>\n \n Now with APPEND :\n <denchmark-code>    FileStorage f;\n     f.open(\"test1.yml\", FileStorage::APPEND);\n     f << \"a\" << 28.54;\n     f.release();\n     f.open(\"test1.yml\", FileStorage::READ);\n     cout << \" First read \"<<float(f[\"a\"]) << endl;\n     f.release();\n \n </denchmark-code>\n \n there is an exception :\n \n %YAML:1.0 is missing then file is <denchmark-link:https://github.com/opencv/opencv/blob/master/modules/core/src/persistence_c.cpp#L384>empty</denchmark-link>\n \n I think that in APPEND mode signature must be append when file is empty\n \t"}, "comments": {}}, "commit": {"commit_id": "03eb463f1c072581177009df50152533a4ff7c40", "commit_author": "LaurentBerger", "commitT": "2018-03-28 15:35:38+03:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\core\\src\\persistence_c.cpp", "file_new_name": "modules\\core\\src\\persistence_c.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "209,210,212,213,214,308", "deleted_lines": "209,304", "method_info": {"method_name": "cvOpenFileStorage", "method_params": "query,dststorage,flags,encoding", "method_startline": "72", "method_endline": "461"}}}}, "file_1": {"file_change_type": "MODIFY", "file_Nmethod": 1, "file_old_name": "modules\\core\\test\\test_io.cpp", "file_new_name": "modules\\core\\test\\test_io.cpp", "hunks": {"hunk_0": {"Ismethod": 1, "added_lines": "605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622", "deleted_lines": null, "method_info": {"method_name": "opencv_test::TEST", "method_params": "Core_InputOutput,FileStorageSpaces", "method_startline": "591", "method_endline": "623"}}}}}}}