{"BR": {"BR_id": "1455", "BR_author": "barry-jin", "BRopenT": "2020-12-07T22:54:05Z", "BRcloseT": "2020-12-08T22:17:26Z", "BR_text": {"BRsummary": "[BUG] CPU Unittest (macos-python3.7) Failed for ArrowTypeError", "BRdescription": "\n <denchmark-h:h2>Description</denchmark-h>\n \n CPU unittest for macos with python3.7.9 will fail on .\n Probably because numpy has been upgraded to 1.20.0rc1 in the most recent CI tests.\n <denchmark-link:https://user-images.githubusercontent.com/69359374/101414044-39c0fc80-389a-11eb-9415-a0901e813186.png></denchmark-link>\n \n After I fix numpy version to 1.19.4, unittest for macos with python3.7.9 will pass (<denchmark-link:https://github.com/barry-jin/gluon-nlp/runs/1513770044?check_suite_focus=true>link</denchmark-link>\n ).\n <denchmark-h:h3>Error Message</denchmark-h>\n \n <denchmark-code>_______________________________ test_glue[copa] ________________________________\n \n task = 'copa'\n \n     @pytest.mark.remote_required\n     @pytest.mark.parametrize('task', [\"cb\", \"copa\", \"multirc\", \"rte\", \"wic\", \"wsc\", \"boolq\", \"record\",\n                                       'broadcoverage-diagnostic', 'winogender-diagnostic'])\n     def test_glue(task):\n         parser = prepare_glue.get_parser()\n         with tempfile.TemporaryDirectory() as root:\n             args = parser.parse_args(['--benchmark', 'superglue',\n                                       '--tasks', task,\n                                       '--data_dir', root])\n >           prepare_glue.main(args)\n \n tests/data_cli/test_glue.py:28: \n _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n src/gluonnlp/cli/data/general_nlp_benchmark/prepare_glue.py:689: in main\n     df.to_parquet(os.path.join(base_dir, '{}.parquet'.format(key)))\n ../../../hostedtoolcache/Python/3.7.9/x64/lib/python3.7/site-packages/pandas/util/_decorators.py:199: in wrapper\n     return func(*args, **kwargs)\n ../../../hostedtoolcache/Python/3.7.9/x64/lib/python3.7/site-packages/pandas/core/frame.py:2372: in to_parquet\n     **kwargs,\n ../../../hostedtoolcache/Python/3.7.9/x64/lib/python3.7/site-packages/pandas/io/parquet.py:276: in to_parquet\n     **kwargs,\n ../../../hostedtoolcache/Python/3.7.9/x64/lib/python3.7/site-packages/pandas/io/parquet.py:101: in write\n     table = self.api.Table.from_pandas(df, **from_pandas_kwargs)\n pyarrow/table.pxi:1394: in pyarrow.lib.Table.from_pandas\n     ???\n ../../../hostedtoolcache/Python/3.7.9/x64/lib/python3.7/site-packages/pyarrow/pandas_compat.py:588: in dataframe_to_arrays\n     for c, f in zip(columns_to_convert, convert_fields)]\n ../../../hostedtoolcache/Python/3.7.9/x64/lib/python3.7/site-packages/pyarrow/pandas_compat.py:588: in <listcomp>\n     for c, f in zip(columns_to_convert, convert_fields)]\n ../../../hostedtoolcache/Python/3.7.9/x64/lib/python3.7/site-packages/pyarrow/pandas_compat.py:574: in convert_column\n     raise e\n ../../../hostedtoolcache/Python/3.7.9/x64/lib/python3.7/site-packages/pyarrow/pandas_compat.py:568: in convert_column\n     result = pa.array(col, type=type_, from_pandas=True, safe=safe)\n pyarrow/array.pxi:292: in pyarrow.lib.array\n     ???\n pyarrow/array.pxi:79: in pyarrow.lib._ndarray_to_array\n     ???\n pyarrow/array.pxi:67: in pyarrow.lib._ndarray_to_type\n     ???\n _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n \n >   ???\n E   pyarrow.lib.ArrowTypeError: ('Did not pass numpy.dtype object', 'Conversion failed for column label with type int64')\n \n pyarrow/error.pxi:107: ArrowTypeError\n ----------------------------- Captured stdout call -----------------------------\n Downloading superglue to \"/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/tmpdm5pl_ev\". Selected tasks = copa\n Processing copa...\n Downloading /Users/runner/.mxnet/datasets/nlp/glue/superglue/copa.zip from https://dl.fbaipublicfiles.com/glue/superglue/data/v2/COPA.zip...\n ----------------------------- Captured stderr call -----------------------------\n \n   0%|          | 0.00/44.0k [00:00<?, ?iB/s]\n 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 44.0k/44.0k [00:00<00:00, 535kiB/s]\n </denchmark-code>\n \n <denchmark-h:h2>To Reproduce</denchmark-h>\n \n (If you developed your own code, please provide a short script that reproduces the error. For existing examples, please provide link.)\n <denchmark-h:h3>Steps to reproduce</denchmark-h>\n \n (Paste the commands you ran that produced the error.)\n <denchmark-h:h2>What have you tried to solve it?</denchmark-h>\n \n Fix numpy version to 1.19.4 in <denchmark-link:https://github.com/barry-jin/gluon-nlp/actions/runs/406932148/workflow#L58>workflow</denchmark-link>\n .\n Efforts are needed to find the root cause.\n \t"}, "comments": {"comments_0": {"comment_id": 1, "comment_author": "barry-jin", "commentT": "2020-12-07T22:55:29Z", "comment_text": "\n \t\tNeed to fix this.\n \t\t"}, "comments_1": {"comment_id": 2, "comment_author": "barry-jin", "commentT": "2020-12-07T22:56:27Z", "comment_text": "\n \t\tWe may add numpy dependency in our setup.py and ping it to be smaller than 1.20.0.\n \t\t"}, "comments_2": {"comment_id": 3, "comment_author": "barry-jin", "commentT": "2020-12-07T23:39:19Z", "comment_text": "\n \t\tThat can only be a temporary solution. Please also reproduce the bug without gluonnlp and file a bur report upstream so the root cause can be addressed\n \t\t"}, "comments_3": {"comment_id": 4, "comment_author": "barry-jin", "commentT": "2020-12-08T00:05:13Z", "comment_text": "\n \t\tSimilarly, we have also triggered one bug of wikiextractor in which we should report to their repo.\n \t\t"}, "comments_4": {"comment_id": 5, "comment_author": "barry-jin", "commentT": "2020-12-08T22:08:48Z", "comment_text": "\n \t\tShould we close this? <denchmark-link:https://github.com/barry-jin>@barry-jin</denchmark-link>\n \n \t\t"}, "comments_5": {"comment_id": 6, "comment_author": "barry-jin", "commentT": "2020-12-08T22:17:21Z", "comment_text": "\n \t\tYes, Let's close this issue first. I will find the root cause and report to pyarrow. After issues solved, we can revert <denchmark-link:https://github.com/dmlc/gluon-nlp/pull/1456>#1456</denchmark-link>\n \n \t\t"}}}, "commit": {"commit_id": "c6db3653314bb689eff0d25db08d425b2812ddf4", "commit_author": "barry-jin", "commitT": "2020-12-07 19:45:06-08:00", "changed_files": {"file_0": {"file_change_type": "MODIFY", "file_Nmethod": 0, "file_old_name": "setup.py", "file_new_name": "setup.py", "hunks": {"hunk_0": {"Ismethod": 0, "added_lines": "35", "deleted_lines": "35"}}}}}}